const _0x211817=_0x167f;(function(_0x337b04,_0x3f716a){const _0x521535=_0x167f,_0xe21b37=_0x337b04();while(!![]){try{const _0x1e0024=-parseInt(_0x521535(0x1b26))/0x1+parseInt(_0x521535(0xa05))/0x2+parseInt(_0x521535(0x1e6a))/0x3*(-parseInt(_0x521535(0x1be2))/0x4)+parseInt(_0x521535(0x15cf))/0x5*(parseInt(_0x521535(0x202a))/0x6)+-parseInt(_0x521535(0x19f5))/0x7+parseInt(_0x521535(0x1db8))/0x8+-parseInt(_0x521535(0x19e8))/0x9;if(_0x1e0024===_0x3f716a)break;else _0xe21b37['push'](_0xe21b37['shift']());}catch(_0x1695d1){_0xe21b37['push'](_0xe21b37['shift']());}}}(_0x513f,0x234f9));let characters=[],contacts=[],currentChatCharacter=null,chatMessages={},selectedMessageId=null,pinnedConversations=[],personas=[],editingPersona=null,isMultiSelectMode=![],selectedCharacters=[],currentEditingCharacterId=null,groupChats=[];const SoundManager={'sounds':{},'characterSounds':{},'enabled':!![],'currentlyPlaying':{},'isUnlocked':![],'TYPES':{'MESSAGE_RECEIVED':'messageReceived','MESSAGE_SENT':'messageSent','NOTIFICATION':_0x211817(0x165d),'OUTGOING_CALL':_0x211817(0x1d98),'INCOMING_CALL':_0x211817(0x1145)},async 'init'(){const _0x47e254=_0x211817;try{const _0x3115b2=localStorage[_0x47e254(0x15d8)](_0x47e254(0x757));_0x3115b2!==null?this[_0x47e254(0x9f6)]=_0x3115b2===_0x47e254(0x1098):(this[_0x47e254(0x9f6)]=!![],localStorage['setItem'](_0x47e254(0x757),_0x47e254(0x1098))),await this[_0x47e254(0x20ad)](),console['log'](_0x47e254(0x81a),this['enabled']);}catch(_0x4ff347){console[_0x47e254(0x174a)](_0x47e254(0x1684),_0x4ff347);}},async 'loadSettings'(){const _0x89abfc=_0x211817;try{const _0x15a89a=await db[_0x89abfc(0x62a)][_0x89abfc(0xf13)]();for(const _0x19e62d of _0x15a89a){_0x19e62d['enabled']&&_0x19e62d[_0x89abfc(0x62d)]&&await this[_0x89abfc(0xbb2)](_0x19e62d['soundType'],_0x19e62d[_0x89abfc(0x62d)],_0x19e62d[_0x89abfc(0x1cae)]);}const _0x1fa4db=await db['characterSounds']['toArray']();for(const _0x51fc0a of _0x1fa4db){_0x51fc0a['enabled']&&_0x51fc0a['sourceUrl']&&await this[_0x89abfc(0x996)](_0x51fc0a[_0x89abfc(0xaf5)],_0x51fc0a[_0x89abfc(0x5d9)],_0x51fc0a[_0x89abfc(0x62d)],_0x51fc0a['sourceType']);}}catch(_0x22974a){console[_0x89abfc(0x174a)](_0x89abfc(0xacd),_0x22974a);}},async 'loadSound'(_0x4d2285,_0x18bd64,_0x465015=_0x211817(0x40f)){const _0x25c4c9=_0x211817;try{if(!_0x18bd64)return![];const _0x277275=new Audio();return _0x277275[_0x25c4c9(0x786)]='auto',_0x277275[_0x25c4c9(0x45c)]=_0x18bd64,await new Promise((_0x1c77d9,_0x834c7d)=>{const _0x58eac4=_0x25c4c9;_0x277275[_0x58eac4(0x21e9)](_0x58eac4(0xb6b),_0x1c77d9,{'once':!![]}),_0x277275[_0x58eac4(0x21e9)]('error',_0x834c7d,{'once':!![]}),_0x277275['load']();}),this['sounds'][_0x4d2285]=_0x277275,console[_0x25c4c9(0x2187)](_0x25c4c9(0x19da)+_0x4d2285),!![];}catch(_0x2265b1){return console['error'](_0x25c4c9(0xa5c)+_0x4d2285+'):',_0x2265b1),![];}},'play'(_0x463281,_0x19b443=null){const _0x9eaa31=_0x211817;if(!this[_0x9eaa31(0x9f6)])return;try{if(_0x19b443&&this[_0x9eaa31(0x178a)][_0x19b443]&&this['characterSounds'][_0x19b443][_0x9eaa31(0x112f)]){console[_0x9eaa31(0x2187)](_0x9eaa31(0x1e1a)+_0x19b443+_0x9eaa31(0x1811)+_0x463281+_0x9eaa31(0xac2));return;}let _0x54d064=null;if(_0x19b443&&this['characterSounds'][_0x19b443]&&this[_0x9eaa31(0x178a)][_0x19b443][_0x463281])_0x54d064=this[_0x9eaa31(0x178a)][_0x19b443][_0x463281][_0x9eaa31(0x1cdd)](),console['log'](_0x9eaa31(0x1b58)+_0x19b443+'\x20-\x20'+_0x463281);else this[_0x9eaa31(0x2210)][_0x463281]&&(_0x54d064=this[_0x9eaa31(0x2210)][_0x463281][_0x9eaa31(0x1cdd)](),console[_0x9eaa31(0x2187)](_0x9eaa31(0x1f6d)+_0x463281));if(_0x54d064){_0x54d064['volume']=0.7,this['currentlyPlaying'][_0x463281]=_0x54d064,_0x54d064[_0x9eaa31(0x21e9)]('ended',()=>{const _0x4a0ca3=_0x9eaa31;delete this[_0x4a0ca3(0x1956)][_0x463281];});const _0x2254c0=_0x54d064['play']();_0x2254c0!==undefined&&_0x2254c0[_0x9eaa31(0x1c82)](_0x336aa0=>{const _0x4feba8=_0x9eaa31;console[_0x4feba8(0x1f43)](_0x4feba8(0x255)+_0x463281+'):',_0x336aa0),delete this['currentlyPlaying'][_0x463281],_0x336aa0[_0x4feba8(0x1a1c)]===_0x4feba8(0x2045)&&this[_0x4feba8(0x198)](_0x463281,_0x19b443);});}}catch(_0x22642e){console[_0x9eaa31(0x174a)](_0x9eaa31(0x91f)+_0x463281+'):',_0x22642e);}},'scheduleRetryOnUserInteraction'(_0x27d208,_0xcf517d){const _0x12aac0=_0x211817;if(this[_0x12aac0(0x468)])return;const _0xb8eb54=()=>{const _0x3629ed=_0x12aac0;console[_0x3629ed(0x2187)](_0x3629ed(0x150b)+_0x27d208),this[_0x3629ed(0x468)]=!![],this[_0x3629ed(0xaa5)](_0x27d208,_0xcf517d),[_0x3629ed(0x1728),_0x3629ed(0x5ac),_0x3629ed(0xf5c),_0x3629ed(0x1859)][_0x3629ed(0x19fb)](_0x202d00=>{const _0x306a15=_0x3629ed;document[_0x306a15(0xa21)](_0x202d00,_0xb8eb54);});};[_0x12aac0(0x1728),_0x12aac0(0x5ac),_0x12aac0(0xf5c),_0x12aac0(0x1859)]['forEach'](_0x2b82e0=>{const _0x2741e8=_0x12aac0;document[_0x2741e8(0x21e9)](_0x2b82e0,_0xb8eb54,{'once':!![],'passive':!![]});});},'stopSound'(_0xd8b364){const _0x3ede99=_0x211817;try{this[_0x3ede99(0x1956)][_0xd8b364]&&(this[_0x3ede99(0x1956)][_0xd8b364]['pause'](),this['currentlyPlaying'][_0xd8b364]['currentTime']=0x0,delete this[_0x3ede99(0x1956)][_0xd8b364],console['log'](_0x3ede99(0x5f5)+_0xd8b364));}catch(_0x9f56a9){console[_0x3ede99(0x174a)](_0x3ede99(0x20a9)+_0xd8b364+'):',_0x9f56a9);}},'stopAllSounds'(){const _0x332ece=_0x211817;try{Object[_0x332ece(0x1c9f)](this[_0x332ece(0x1956)])[_0x332ece(0x19fb)](_0xed2684=>{const _0xa425ab=_0x332ece;this[_0xa425ab(0x22cc)](_0xed2684);}),console[_0x332ece(0x2187)](_0x332ece(0x221a));}catch(_0x4814b5){console['error'](_0x332ece(0xb90),_0x4814b5);}},'test'(_0x47c39f){const _0x26e8e0=_0x211817;if(!this[_0x26e8e0(0x9f6)]||!this[_0x26e8e0(0x2210)][_0x47c39f])return;try{const _0x3c6bb6=this[_0x26e8e0(0x2210)][_0x47c39f][_0x26e8e0(0x1cdd)]();_0x3c6bb6[_0x26e8e0(0x1ca0)]=0.7;const _0x2c9d3d=setTimeout(()=>{const _0x3dc6ee=_0x26e8e0;_0x3c6bb6['pause'](),_0x3c6bb6[_0x3dc6ee(0x1596)]=0x0;},0x1388);_0x3c6bb6[_0x26e8e0(0x21e9)]('ended',()=>{clearTimeout(_0x2c9d3d);}),_0x3c6bb6[_0x26e8e0(0xaa5)]()[_0x26e8e0(0x1c82)](_0x2da538=>{const _0x3f832f=_0x26e8e0;console[_0x3f832f(0x1f43)](_0x3f832f(0x22b1)+_0x47c39f+'):',_0x2da538),clearTimeout(_0x2c9d3d);});}catch(_0x2046e2){console[_0x26e8e0(0x174a)](_0x26e8e0(0x1e3a)+_0x47c39f+'):',_0x2046e2);}},async 'setSound'(_0x523020,_0x4544a8,_0x11e523=_0x211817(0x40f)){const _0x3fc956=_0x211817;try{this[_0x3fc956(0x2210)][_0x523020]&&(this[_0x3fc956(0x2210)][_0x523020]=null);if(!_0x4544a8)return await db[_0x3fc956(0x62a)][_0x3fc956(0x1f4a)](_0x523020),!![];const _0x1f6a81=await this[_0x3fc956(0xbb2)](_0x523020,_0x4544a8,_0x11e523);return _0x1f6a81&&await db[_0x3fc956(0x62a)][_0x3fc956(0x1561)]({'id':_0x523020,'soundType':_0x523020,'sourceType':_0x11e523,'sourceUrl':_0x4544a8,'enabled':!![],'timestamp':Date[_0x3fc956(0x2eb)]()}),_0x1f6a81;}catch(_0x32ffae){return console['error']('设置音效失败\x20('+_0x523020+'):',_0x32ffae),![];}},async 'clearSound'(_0x2f52ff){const _0xdb57e3=_0x211817;try{return this['sounds'][_0x2f52ff]&&(this[_0xdb57e3(0x2210)][_0x2f52ff]=null),await db['soundSettings'][_0xdb57e3(0x1f4a)](_0x2f52ff),console[_0xdb57e3(0x2187)](_0xdb57e3(0x22e1)+_0x2f52ff),!![];}catch(_0x2638c5){return console[_0xdb57e3(0x174a)](_0xdb57e3(0x1db2)+_0x2f52ff+'):',_0x2638c5),![];}},'setEnabled'(_0x473b1b){const _0x3017be=_0x211817;this['enabled']=_0x473b1b,localStorage[_0x3017be(0x192)]('soundEnabled',_0x473b1b[_0x3017be(0x1878)]());},async 'getSetting'(_0x1e1029){const _0x410cde=_0x211817;try{return await db[_0x410cde(0x62a)][_0x410cde(0xb78)](_0x1e1029);}catch(_0x13898a){return console[_0x410cde(0x174a)](_0x410cde(0x149a)+_0x1e1029+'):',_0x13898a),null;}},async 'loadCharacterSound'(_0x899803,_0x32efd0,_0x3022e2,_0x3d6981=_0x211817(0x40f)){const _0x54eb37=_0x211817;try{if(!_0x3022e2)return![];if(_0x32efd0===_0x54eb37(0x112f)&&_0x3022e2===_0x54eb37(0x112f))return!this['characterSounds'][_0x899803]&&(this['characterSounds'][_0x899803]={}),this[_0x54eb37(0x178a)][_0x899803][_0x54eb37(0x112f)]=!![],console[_0x54eb37(0x2187)]('✅\x20角色静音模式设置成功:\x20'+_0x899803),!![];if(_0x32efd0===_0x54eb37(0x9f6)&&_0x3022e2===_0x54eb37(0x9f6))return!this[_0x54eb37(0x178a)][_0x899803]&&(this[_0x54eb37(0x178a)][_0x899803]={}),this['characterSounds'][_0x899803][_0x54eb37(0x9f6)]=!![],console[_0x54eb37(0x2187)](_0x54eb37(0x1c61)+_0x899803),!![];const _0x3f9ab5=new Audio();return _0x3f9ab5['preload']='auto',_0x3f9ab5['src']=_0x3022e2,await new Promise((_0x5f1705,_0x9ef0e2)=>{const _0x5cedd0=_0x54eb37;_0x3f9ab5[_0x5cedd0(0x21e9)]('canplaythrough',_0x5f1705,{'once':!![]}),_0x3f9ab5[_0x5cedd0(0x21e9)](_0x5cedd0(0x174a),_0x9ef0e2,{'once':!![]}),_0x3f9ab5[_0x5cedd0(0xb53)]();}),!this['characterSounds'][_0x899803]&&(this['characterSounds'][_0x899803]={}),this[_0x54eb37(0x178a)][_0x899803][_0x32efd0]=_0x3f9ab5,console[_0x54eb37(0x2187)](_0x54eb37(0x1c8d)+_0x899803+'\x20-\x20'+_0x32efd0),!![];}catch(_0x3b4cfc){return console['error']('❌\x20角色专属音效加载失败\x20('+_0x899803+'\x20-\x20'+_0x32efd0+'):',_0x3b4cfc),![];}},async 'setCharacterSound'(_0x3c2bf3,_0x32f9f4,_0x5ce7bd,_0x2baa0c=_0x211817(0x40f)){const _0x3f10f2=_0x211817;try{this['characterSounds'][_0x3c2bf3]&&this['characterSounds'][_0x3c2bf3][_0x32f9f4]&&(this['characterSounds'][_0x3c2bf3][_0x32f9f4]=null);if(!_0x5ce7bd)return await db['characterSounds'][_0x3f10f2(0xa24)]({'characterId':_0x3c2bf3,'soundType':_0x32f9f4})[_0x3f10f2(0x1f4a)](),!![];const _0x129977=await this['loadCharacterSound'](_0x3c2bf3,_0x32f9f4,_0x5ce7bd,_0x2baa0c);return _0x129977&&await db[_0x3f10f2(0x178a)][_0x3f10f2(0x1561)]({'characterId':_0x3c2bf3,'soundType':_0x32f9f4,'sourceType':_0x2baa0c,'sourceUrl':_0x5ce7bd,'enabled':!![],'timestamp':Date[_0x3f10f2(0x2eb)]()}),_0x129977;}catch(_0x48ae7f){return console['error']('设置角色专属音效失败\x20('+_0x3c2bf3+_0x3f10f2(0x1811)+_0x32f9f4+'):',_0x48ae7f),![];}},async 'clearCharacterSound'(_0x20b832,_0x3816f1){const _0x5ef1fa=_0x211817;try{return this[_0x5ef1fa(0x178a)][_0x20b832]&&this['characterSounds'][_0x20b832][_0x3816f1]&&(_0x3816f1===_0x5ef1fa(0x112f)||_0x3816f1===_0x5ef1fa(0x9f6)?delete this[_0x5ef1fa(0x178a)][_0x20b832][_0x3816f1]:this[_0x5ef1fa(0x178a)][_0x20b832][_0x3816f1]=null),await db['characterSounds']['where']({'characterId':_0x20b832,'soundType':_0x3816f1})['delete'](),console[_0x5ef1fa(0x2187)](_0x5ef1fa(0x5dd)+_0x20b832+'\x20-\x20'+_0x3816f1),!![];}catch(_0x8226cc){return console[_0x5ef1fa(0x174a)](_0x5ef1fa(0x17bf)+_0x20b832+'\x20-\x20'+_0x3816f1+'):',_0x8226cc),![];}},async 'getCharacterSetting'(_0x15a9a9,_0x53a7e7){const _0x1ebe43=_0x211817;try{return await db['characterSounds']['where']({'characterId':_0x15a9a9,'soundType':_0x53a7e7})[_0x1ebe43(0x1a7b)]();}catch(_0x3c9f17){return console[_0x1ebe43(0x174a)](_0x1ebe43(0x6c5)+_0x15a9a9+_0x1ebe43(0x1811)+_0x53a7e7+'):',_0x3c9f17),null;}},async 'clearAllCharacterSounds'(_0x566068){const _0x3e52dd=_0x211817;try{return this[_0x3e52dd(0x178a)][_0x566068]&&(this[_0x3e52dd(0x178a)][_0x566068]={}),await db[_0x3e52dd(0x178a)]['where'](_0x3e52dd(0xaf5))['equals'](_0x566068)[_0x3e52dd(0x1f4a)](),console['log'](_0x3e52dd(0x2d3)+_0x566068),!![];}catch(_0x3ee66c){return console[_0x3e52dd(0x174a)](_0x3e52dd(0xba5)+_0x566068+'):',_0x3ee66c),![];}}};function toggleSoundSystem(){const _0x58ad29=_0x211817,_0x115bc2=document['getElementById'](_0x58ad29(0x3dc));if(!_0x115bc2){console[_0x58ad29(0x174a)](_0x58ad29(0x1ead));return;}const _0x35ea76=_0x115bc2[_0x58ad29(0x14c1)];console[_0x58ad29(0x2187)](_0x58ad29(0xf82),_0x35ea76),SoundManager[_0x58ad29(0x1a9d)](_0x35ea76);const _0x5a6c3a=document[_0x58ad29(0x1262)](_0x58ad29(0xa38));_0x5a6c3a&&(_0x5a6c3a[_0x58ad29(0x14eb)][_0x58ad29(0x11af)]=_0x35ea76?'1':_0x58ad29(0x1a21),_0x5a6c3a[_0x58ad29(0x14eb)]['pointerEvents']=_0x35ea76?'auto':'none'),showToast(_0x35ea76?_0x58ad29(0x13cd):'音效已禁用',_0x58ad29(0x11cb));}function handleSoundFileUpload(_0x5c45c7,_0x458e48){const _0xf96c19=_0x211817,_0x30dd4d=_0x5c45c7['files'][0x0];if(!_0x30dd4d)return;if(_0x30dd4d[_0xf96c19(0x2d8)]>0x3*0x400*0x400){showToast(_0xf96c19(0xe94),_0xf96c19(0x174a)),_0x5c45c7[_0xf96c19(0x1ebc)]='';return;}if(!_0x30dd4d[_0xf96c19(0x1a4b)][_0xf96c19(0x1b30)](_0xf96c19(0x1cd1))){showToast(_0xf96c19(0x6e0),_0xf96c19(0x174a)),_0x5c45c7[_0xf96c19(0x1ebc)]='';return;}const _0x4b0523=new FileReader();_0x4b0523[_0xf96c19(0xc55)]=async _0x53e5fa=>{const _0x14b05c=_0xf96c19,_0x1f0bf6=await SoundManager[_0x14b05c(0x1e61)](_0x458e48,_0x53e5fa[_0x14b05c(0x193d)]['result'],_0x14b05c(0x1b7a));if(_0x1f0bf6){showToast(_0x14b05c(0x13b1),_0x14b05c(0x11cb));const _0x4587fe=document[_0x14b05c(0x1262)]('sound-'+_0x458e48+'-url');_0x4587fe&&(_0x4587fe['value']=_0x30dd4d[_0x14b05c(0x1a1c)],_0x4587fe[_0x14b05c(0x559)]=!![]);}else showToast('音效设置失败',_0x14b05c(0x174a));_0x5c45c7['value']='';},_0x4b0523[_0xf96c19(0x127c)](_0x30dd4d);}function testSound(_0xac5861){const _0x447a4a=_0x211817;SoundManager[_0x447a4a(0x11b8)](_0xac5861);}async function clearSound(_0x536459){const _0x701beb=_0x211817,_0xc7ceb0=await SoundManager['clearSound'](_0x536459);if(_0xc7ceb0){showToast(_0x701beb(0xfce),_0x701beb(0x11cb));const _0xb197f1=document['getElementById']('sound-'+_0x536459+_0x701beb(0x86c));_0xb197f1&&(_0xb197f1['value']='',_0xb197f1[_0x701beb(0x559)]=![]);}else showToast('清除音效失败',_0x701beb(0x174a));}async function setSoundFromUrl(_0x54b62a){const _0x4b7c28=_0x211817,_0x4730e9=document[_0x4b7c28(0x1262)]('sound-'+_0x54b62a+_0x4b7c28(0x86c));if(!_0x4730e9)return;const _0x4c18ef=_0x4730e9['value']['trim']();if(!_0x4c18ef){showToast(_0x4b7c28(0x6ef),_0x4b7c28(0x174a));return;}const _0x56e2e6=await SoundManager[_0x4b7c28(0x1e61)](_0x54b62a,_0x4c18ef,_0x4b7c28(0x40f));_0x56e2e6?showToast(_0x4b7c28(0x13b1),'success'):showToast(_0x4b7c28(0x2191),'error');}async function initSoundSettings(){const _0x48eb76=_0x211817;try{const _0x1cb798=document[_0x48eb76(0x1262)]('sound-enabled');_0x1cb798&&(_0x1cb798['checked']=SoundManager['enabled'],console['log'](_0x48eb76(0xf82),SoundManager[_0x48eb76(0x9f6)]));const _0xb1d3d9=[_0x48eb76(0x1b7d),_0x48eb76(0x21a2),_0x48eb76(0x165d),_0x48eb76(0x1d98),_0x48eb76(0x1145)];for(const _0x2c2b26 of _0xb1d3d9){const _0x2f3784=await SoundManager[_0x48eb76(0x4f7)](_0x2c2b26),_0x4a9f59=document[_0x48eb76(0x1262)]('sound-'+_0x2c2b26+'-url');_0x2f3784&&_0x4a9f59&&(_0x2f3784[_0x48eb76(0x1cae)]==='file'?(_0x4a9f59[_0x48eb76(0x1ebc)]=_0x48eb76(0x654),_0x4a9f59[_0x48eb76(0x559)]=!![]):(_0x4a9f59[_0x48eb76(0x1ebc)]=_0x2f3784[_0x48eb76(0x62d)]||'',_0x4a9f59[_0x48eb76(0x559)]=![]));}const _0x57f517=document[_0x48eb76(0x1262)](_0x48eb76(0xa38));_0x57f517&&(_0x57f517[_0x48eb76(0x14eb)]['opacity']=SoundManager['enabled']?'1':_0x48eb76(0x1a21),_0x57f517[_0x48eb76(0x14eb)][_0x48eb76(0x18a4)]=SoundManager['enabled']?_0x48eb76(0x1033):_0x48eb76(0x102b)),console[_0x48eb76(0x2187)](_0x48eb76(0x6bd));}catch(_0x592cc9){console[_0x48eb76(0x174a)]('❌\x20音效设置界面初始化失败:',_0x592cc9);}}let soundEventListenersInitialized=![];function initSoundEventListeners(){const _0x14e7af=_0x211817;if(soundEventListenersInitialized)return;const _0x19f62f=['messageReceived',_0x14e7af(0x21a2),_0x14e7af(0x165d),_0x14e7af(0x1d98),_0x14e7af(0x1145)];_0x19f62f[_0x14e7af(0x19fb)](_0x323df6=>{const _0x32da5f=_0x14e7af,_0x45ce78=document[_0x32da5f(0x1262)]('sound-'+_0x323df6+_0x32da5f(0x86c));_0x45ce78&&(_0x45ce78['addEventListener']('keypress',function(_0x1be9fb){const _0x209ef1=_0x32da5f;_0x1be9fb[_0x209ef1(0x213c)]===_0x209ef1(0xdcf)&&setSoundFromUrl(_0x323df6);}),_0x45ce78['addEventListener'](_0x32da5f(0xc53),function(){const _0x26f7d6=_0x32da5f;this[_0x26f7d6(0x1ebc)]['trim']()&&setSoundFromUrl(_0x323df6);}));const _0x203543=document[_0x32da5f(0x1262)](_0x32da5f(0x3d4)+_0x323df6+_0x32da5f(0x86c));_0x203543&&(_0x203543[_0x32da5f(0x21e9)](_0x32da5f(0xf20),_0x1b794b=>{const _0x4dd909=_0x32da5f;_0x1b794b[_0x4dd909(0x213c)]===_0x4dd909(0xdcf)&&setCharacterSoundFromUrl(_0x323df6);}),_0x203543[_0x32da5f(0x21e9)](_0x32da5f(0xc53),_0x5b7b32=>{const _0x10f2c5=_0x32da5f;_0x5b7b32[_0x10f2c5(0x193d)][_0x10f2c5(0x1ebc)]['trim']()&&setCharacterSoundFromUrl(_0x323df6);}));}),soundEventListenersInitialized=!![],console[_0x14e7af(0x2187)](_0x14e7af(0x214c));}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){initSoundEventListeners();});async function toggleCharacterSounds(){const _0x191bfa=_0x211817,_0x2c43e1=document[_0x191bfa(0x1262)]('character-sound-enabled')[_0x191bfa(0x14c1)],_0x214b8e=document['getElementById'](_0x191bfa(0x168c));_0x214b8e&&(_0x214b8e['style'][_0x191bfa(0x4da)]=_0x2c43e1?'block':'none');if(!currentChatCharacter){showToast(_0x191bfa(0x85d),_0x191bfa(0x174a));return;}try{_0x2c43e1?(await SoundManager[_0x191bfa(0xc2c)](currentChatCharacter['id'],_0x191bfa(0x9f6),_0x191bfa(0x9f6),'enabled'),showToast('角色专属音效已启用',_0x191bfa(0x11cb))):(await SoundManager[_0x191bfa(0x1e19)](currentChatCharacter['id']),showToast(_0x191bfa(0x21df),_0x191bfa(0x11cb)));}catch(_0x53fee9){console[_0x191bfa(0x174a)](_0x191bfa(0x1f77),_0x53fee9),showToast(_0x191bfa(0x1d30),_0x191bfa(0x174a));}}function handleCharacterSoundFileUpload(_0x136bde,_0x3af35f){const _0x363305=_0x211817;if(!currentChatCharacter){showToast(_0x363305(0x85d),_0x363305(0x174a));return;}const _0x3677a1=_0x136bde[_0x363305(0xf26)][0x0];if(!_0x3677a1)return;if(_0x3677a1[_0x363305(0x2d8)]>0x3*0x400*0x400){showToast('音效文件不能超过3MB',_0x363305(0x174a)),_0x136bde[_0x363305(0x1ebc)]='';return;}if(!_0x3677a1[_0x363305(0x1a4b)][_0x363305(0x1b30)](_0x363305(0x1cd1))){showToast(_0x363305(0x6e0),_0x363305(0x174a)),_0x136bde[_0x363305(0x1ebc)]='';return;}const _0x5805fc=new FileReader();_0x5805fc['onload']=async _0x4f3455=>{const _0x3bf164=_0x363305,_0x101c12=await SoundManager[_0x3bf164(0xc2c)](currentChatCharacter['id'],_0x3af35f,_0x4f3455[_0x3bf164(0x193d)][_0x3bf164(0x4ee)],_0x3bf164(0x1b7a));if(_0x101c12){showToast(_0x3bf164(0xd16),_0x3bf164(0x11cb));const _0x5cb064=document['getElementById'](_0x3bf164(0x3d4)+_0x3af35f+_0x3bf164(0x86c));_0x5cb064&&(_0x5cb064[_0x3bf164(0x1ebc)]=_0x3677a1[_0x3bf164(0x1a1c)],_0x5cb064[_0x3bf164(0x559)]=!![]);}else showToast(_0x3bf164(0x167b),_0x3bf164(0x174a));_0x136bde['value']='';},_0x5805fc[_0x363305(0x127c)](_0x3677a1);}function testCharacterSound(_0x595e26){const _0x3b1f93=_0x211817;if(!currentChatCharacter){showToast('请先选择角色',_0x3b1f93(0x174a));return;}if(SoundManager['characterSounds'][currentChatCharacter['id']]&&SoundManager[_0x3b1f93(0x178a)][currentChatCharacter['id']][_0x595e26]){const _0x46722f=SoundManager[_0x3b1f93(0x178a)][currentChatCharacter['id']][_0x595e26][_0x3b1f93(0x1cdd)]();_0x46722f[_0x3b1f93(0x1ca0)]=0.7;const _0xb30f47=setTimeout(()=>{const _0x379b43=_0x3b1f93;_0x46722f['pause'](),_0x46722f[_0x379b43(0x1596)]=0x0;},0x1388);_0x46722f[_0x3b1f93(0x21e9)](_0x3b1f93(0x1d9c),()=>{clearTimeout(_0xb30f47);}),_0x46722f[_0x3b1f93(0xaa5)]()['catch'](_0x31aa54=>{const _0x195f3c=_0x3b1f93;console[_0x195f3c(0x1f43)](_0x195f3c(0x1258),_0x31aa54),clearTimeout(_0xb30f47);});}else showToast('请先设置该音效',_0x3b1f93(0x174a));}async function clearCharacterSound(_0x196f8d){const _0x56aa66=_0x211817;if(!currentChatCharacter){showToast(_0x56aa66(0x85d),_0x56aa66(0x174a));return;}const _0x87360e=await SoundManager['clearCharacterSound'](currentChatCharacter['id'],_0x196f8d);if(_0x87360e){showToast(_0x56aa66(0x18e3),_0x56aa66(0x11cb));const _0x46bef8=document['getElementById'](_0x56aa66(0x3d4)+_0x196f8d+_0x56aa66(0x86c));_0x46bef8&&(_0x46bef8[_0x56aa66(0x1ebc)]='',_0x46bef8['disabled']=![]);}else showToast('清除角色专属音效失败',_0x56aa66(0x174a));}async function setCharacterSoundFromUrl(_0x124a04){const _0x33643b=_0x211817;if(!currentChatCharacter){showToast('请先选择角色','error');return;}const _0x43a820=document['getElementById']('character-'+_0x124a04+_0x33643b(0x86c));if(!_0x43a820)return;const _0x524899=_0x43a820[_0x33643b(0x1ebc)][_0x33643b(0x19d7)]();if(!_0x524899){showToast(_0x33643b(0x6ef),_0x33643b(0x174a));return;}const _0xf7c17=await SoundManager['setCharacterSound'](currentChatCharacter['id'],_0x124a04,_0x524899,_0x33643b(0x40f));_0xf7c17?showToast(_0x33643b(0xd16),'success'):showToast(_0x33643b(0x108e),_0x33643b(0x174a));}async function toggleCharacterSilentMode(){const _0x1639ab=_0x211817;if(!currentChatCharacter){showToast('请先选择角色','error');return;}const _0x44576f=document['getElementById'](_0x1639ab(0x140c)),_0x4e502c=_0x44576f[_0x1639ab(0x14c1)];try{if(_0x4e502c){const _0x14e20d=await SoundManager[_0x1639ab(0xc2c)](currentChatCharacter['id'],'silent','silent','silent');_0x14e20d?showToast(currentChatCharacter[_0x1639ab(0x1a1c)]+_0x1639ab(0x4b2),'success'):(showToast(_0x1639ab(0xc54),_0x1639ab(0x174a)),_0x44576f[_0x1639ab(0x14c1)]=![]);}else{const _0x38e25f=await SoundManager[_0x1639ab(0xca1)](currentChatCharacter['id'],_0x1639ab(0x112f));_0x38e25f?showToast(currentChatCharacter[_0x1639ab(0x1a1c)]+'\x20已取消静音',_0x1639ab(0x11cb)):(showToast(_0x1639ab(0xb95),_0x1639ab(0x174a)),_0x44576f[_0x1639ab(0x14c1)]=!![]);}}catch(_0x324053){console['error'](_0x1639ab(0x216),_0x324053),showToast(_0x1639ab(0x11bc),'error'),_0x44576f[_0x1639ab(0x14c1)]=!_0x4e502c;}}function clearCharacterSoundSettingsUI(){const _0x4936c2=_0x211817,_0x11b050=[_0x4936c2(0x1b7d),_0x4936c2(0x1145),'notification'];_0x11b050[_0x4936c2(0x19fb)](_0x53e40a=>{const _0x242708=_0x4936c2,_0x4fde3b=document[_0x242708(0x1262)](_0x242708(0x3d4)+_0x53e40a+_0x242708(0x86c));_0x4fde3b&&(_0x4fde3b[_0x242708(0x1ebc)]='',_0x4fde3b[_0x242708(0x559)]=![]);});const _0x54998e=document[_0x4936c2(0x1262)](_0x4936c2(0xd77));_0x54998e&&(_0x54998e['checked']=![]);const _0x1d90c4=document[_0x4936c2(0x1262)](_0x4936c2(0x168c));_0x1d90c4&&(_0x1d90c4[_0x4936c2(0x14eb)][_0x4936c2(0x4da)]=_0x4936c2(0x102b));const _0x8cb487=document['getElementById']('character-silent-mode');_0x8cb487&&(_0x8cb487['checked']=![]),console[_0x4936c2(0x2187)](_0x4936c2(0xa04));}async function initCharacterSoundSettings(){const _0x17f5e4=_0x211817;if(!currentChatCharacter)return;initSoundEventListeners(),clearCharacterSoundSettingsUI();try{const _0x17be7e=[_0x17f5e4(0x1b7d),_0x17f5e4(0x1145),_0x17f5e4(0x165d)];let _0x5c7336=![];const _0xab97b9=await SoundManager[_0x17f5e4(0xa0b)](currentChatCharacter['id'],_0x17f5e4(0x9f6)),_0x147a50=!!_0xab97b9,_0x2dc34c=await SoundManager[_0x17f5e4(0xa0b)](currentChatCharacter['id'],_0x17f5e4(0x112f)),_0x10af05=!!_0x2dc34c,_0x12da81=document[_0x17f5e4(0x1262)](_0x17f5e4(0x140c));_0x12da81&&(_0x12da81[_0x17f5e4(0x14c1)]=_0x10af05);for(const _0x180e7c of _0x17be7e){const _0x1b13da=await SoundManager[_0x17f5e4(0xa0b)](currentChatCharacter['id'],_0x180e7c),_0x3e6031=document['getElementById'](_0x17f5e4(0x3d4)+_0x180e7c+_0x17f5e4(0x86c));_0x3e6031&&(_0x3e6031[_0x17f5e4(0x1ebc)]='',_0x3e6031['disabled']=![],_0x1b13da&&(_0x5c7336=!![],_0x1b13da[_0x17f5e4(0x1cae)]==='file'?(_0x3e6031['value']='已设置本地文件',_0x3e6031[_0x17f5e4(0x559)]=!![]):(_0x3e6031[_0x17f5e4(0x1ebc)]=_0x1b13da['sourceUrl']||'',_0x3e6031['disabled']=![])));}let _0x59ae67=![];if(_0x147a50)_0x59ae67=!![];else(_0x5c7336||_0x10af05)&&(_0x59ae67=!![]);const _0x528505=document[_0x17f5e4(0x1262)](_0x17f5e4(0xd77)),_0x34d502=document[_0x17f5e4(0x1262)](_0x17f5e4(0x168c));_0x528505&&(_0x528505[_0x17f5e4(0x14c1)]=_0x59ae67),_0x34d502&&(_0x34d502['style'][_0x17f5e4(0x4da)]=_0x59ae67?_0x17f5e4(0x13de):_0x17f5e4(0x102b)),console[_0x17f5e4(0x2187)]('✅\x20角色专属音效设置界面初始化完成:\x20'+currentChatCharacter[_0x17f5e4(0x1a1c)]+_0x17f5e4(0x1adc)+_0x59ae67+_0x17f5e4(0xac5)+_0x10af05+')');}catch(_0x1cfcd2){console[_0x17f5e4(0x174a)](_0x17f5e4(0x1ec7),_0x1cfcd2);}}db['version'](0x28)['stores']({'characters':_0x211817(0x134f),'contacts':_0x211817(0x940),'chatMessages':'&id,\x20characterId,\x20timestamp','personas':_0x211817(0x1b1),'customEmojis':_0x211817(0xf19),'recentEmojis':'&id,\x20lastUsed','worldbooks':'&id,\x20name,\x20isGlobal','worldbookEntries':_0x211817(0x6fa),'characterGroups':_0x211817(0x787),'groupChats':_0x211817(0x1b1),'groupChatMessages':_0x211817(0x1d48),'groupChatMembers':_0x211817(0x2201),'moments':_0x211817(0x1a5),'momentLikes':_0x211817(0x2cc),'momentComments':'&id,\x20momentId,\x20authorId,\x20timestamp','workingMemory':_0x211817(0x832),'episodicMemory':_0x211817(0x208),'episodicMemories':_0x211817(0x1239),'memorySummaries':_0x211817(0x208),'memoryEvents':_0x211817(0x1b77),'coreMemory':'&id,\x20characterId,\x20category,\x20content,\x20timestamp','coreMemories':_0x211817(0x183),'crossAppTimeline':_0x211817(0x1585),'blacklist':_0x211817(0x21d9),'blockedCharacters':_0x211817(0x70e),'friendRequests':_0x211817(0x1f60),'characterStatus':_0x211817(0x916),'characterDiaries':_0x211817(0x13bb),'offlineHistoryRecords':_0x211817(0xfe5),'offlineUISettings':_0x211817(0x1f28),'offlinePresets':'&id,\x20name,\x20content,\x20timestamp','musicPlaylist':_0x211817(0x228c),'musicCovers':_0x211817(0x2221),'apiSettings':_0x211817(0x87e),'globalSettings':_0x211817(0x87e),'wallpapers':_0x211817(0x1b1),'appIcons':_0x211817(0x1444),'chatSettings':'&id,\x20chatId','innerThoughts':_0x211817(0x68a),'forums':'++id,\x20name','forumPosts':_0x211817(0x1567),'forumReplies':'++id,\x20postId,\x20timestamp','forumFavorites':_0x211817(0x124b),'replyLikes':_0x211817(0xc5a),'forumPostImages':_0x211817(0x1e14),'forumMountedWorldbooks':_0x211817(0x1ba0),'smsContacts':'++id,\x20characterId,\x20personaId,\x20createdAt','smsMessages':_0x211817(0x470),'anniversaries':_0x211817(0xcb6),'appointments':_0x211817(0x1645),'momentVisibility':_0x211817(0xd41),'momentLocations':'++id,\x20momentId,\x20locationName,\x20latitude,\x20longitude,\x20timestamp','momentMentions':_0x211817(0x1330),'characterFootprints':'&id,\x20characterId,\x20date,\x20data,\x20timestamp,\x20lastUpdateTime,\x20isComplete','footprintActivities':_0x211817(0x2142),'emojiLibraries':_0x211817(0x119d),'emojiLibraryItems':_0x211817(0x73e),'diarySettings':_0x211817(0x2032),'soundSettings':_0x211817(0xa8e),'characterSounds':_0x211817(0x1989),'globalThemes':_0x211817(0x4dd),'chatThemes':_0x211817(0xbbf),'themeSettings':_0x211817(0x1fe9)})['upgrade'](async _0x2ea36b=>{const _0x13da0d=_0x211817;try{console[_0x13da0d(0x2187)]('🎨\x20开始迁移自定义主题数据到Dexie数据库...');const _0x356eca=localStorage[_0x13da0d(0x15d8)](_0x13da0d(0x1ec6));if(_0x356eca)try{const _0x322116=JSON[_0x13da0d(0x22d3)](_0x356eca);await _0x2ea36b[_0x13da0d(0x1155)][_0x13da0d(0x21e2)]({'id':_0x13da0d(0x1dae),'themeType':_0x13da0d(0x1dae),'themeData':_0x322116,'timestamp':Date[_0x13da0d(0x2eb)]()}),console[_0x13da0d(0x2187)](_0x13da0d(0xd24)),localStorage[_0x13da0d(0x3b2)]('globalCustomTheme');}catch(_0x4c969d){console[_0x13da0d(0x1f43)](_0x13da0d(0xfed),_0x4c969d);}let _0x420c2b=0x0;const _0x3e3ef3=await _0x2ea36b[_0x13da0d(0x2005)][_0x13da0d(0xf13)](),_0x5ed217=await _0x2ea36b[_0x13da0d(0x1076)]['toArray']();for(const _0x990651 of _0x3e3ef3){const _0x540021=_0x13da0d(0x1c00)+_0x990651['id'],_0x5673f2=localStorage[_0x13da0d(0x15d8)](_0x540021);if(_0x5673f2)try{const _0x13b341=JSON[_0x13da0d(0x22d3)](_0x5673f2);await _0x2ea36b[_0x13da0d(0x19bc)]['add']({'chatId':_0x990651['id'],'themeData':_0x13b341,'timestamp':Date[_0x13da0d(0x2eb)]()}),_0x420c2b++,localStorage[_0x13da0d(0x3b2)](_0x540021);}catch(_0x141685){console['warn'](_0x13da0d(0x1f8b)+_0x990651['id']+'):',_0x141685);}}for(const _0x38a594 of _0x5ed217){const _0x5a6b40=_0x13da0d(0x1c00)+_0x38a594['id'],_0x2f9677=localStorage['getItem'](_0x5a6b40);if(_0x2f9677)try{const _0x470502=JSON['parse'](_0x2f9677);await _0x2ea36b[_0x13da0d(0x19bc)]['add']({'chatId':_0x38a594['id'],'themeData':_0x470502,'timestamp':Date[_0x13da0d(0x2eb)]()}),_0x420c2b++,localStorage[_0x13da0d(0x3b2)](_0x5a6b40);}catch(_0x4e1e31){console[_0x13da0d(0x1f43)]('群聊主题数据解析失败\x20('+_0x38a594['id']+'):',_0x4e1e31);}}_0x420c2b>0x0&&console[_0x13da0d(0x2187)](_0x13da0d(0x1ad9)+_0x420c2b+'\x20个聊天自定义主题');const _0x4d1f4f=localStorage[_0x13da0d(0x15d8)]('selectedTheme');_0x4d1f4f&&(await _0x2ea36b[_0x13da0d(0x1dde)][_0x13da0d(0x21e2)]({'id':'selectedTheme','settingName':'selectedTheme','settingValue':_0x4d1f4f,'timestamp':Date[_0x13da0d(0x2eb)]()}),console[_0x13da0d(0x2187)](_0x13da0d(0x33f)+_0x4d1f4f),localStorage[_0x13da0d(0x3b2)](_0x13da0d(0x18b9)));const _0x4b2f17=localStorage['getItem'](_0x13da0d(0x8a9));_0x4b2f17&&(console[_0x13da0d(0x2187)](_0x13da0d(0x7d2)),localStorage[_0x13da0d(0x3b2)]('customThemeData')),console[_0x13da0d(0x2187)](_0x13da0d(0x1ef5));}catch(_0x4bf0bb){console[_0x13da0d(0x174a)](_0x13da0d(0x11a9),_0x4bf0bb);}}),db[_0x211817(0x156e)](0x29)[_0x211817(0xe8e)]({'characters':_0x211817(0x134f),'contacts':_0x211817(0x940),'chatMessages':_0x211817(0x66d),'personas':_0x211817(0x1b1),'customEmojis':_0x211817(0xf19),'recentEmojis':_0x211817(0x1b81),'worldbooks':_0x211817(0x1b54),'worldbookEntries':_0x211817(0x6fa),'characterGroups':'&id,\x20name,\x20order','groupChats':_0x211817(0x1b1),'groupChatMessages':_0x211817(0x1d48),'groupChatMembers':_0x211817(0x2201),'moments':_0x211817(0x1a5),'momentLikes':'[momentId+authorId],\x20momentId,\x20authorId','momentComments':_0x211817(0xa59),'workingMemory':_0x211817(0x832),'episodicMemory':'&id,\x20characterId,\x20date,\x20summary,\x20timestamp,\x20context','episodicMemories':_0x211817(0x1239),'memorySummaries':_0x211817(0x208),'memoryEvents':_0x211817(0x1b77),'coreMemory':_0x211817(0x21ba),'coreMemories':_0x211817(0x183),'crossAppTimeline':_0x211817(0x1585),'blacklist':'&id,\x20blockerId,\x20blockedId,\x20timestamp,\x20reason','blockedCharacters':_0x211817(0x70e),'friendRequests':_0x211817(0x1f60),'characterStatus':_0x211817(0x916),'characterDiaries':_0x211817(0x13bb),'offlineHistoryRecords':_0x211817(0xfe5),'offlineUISettings':_0x211817(0x1f28),'offlinePresets':'&id,\x20name,\x20content,\x20timestamp','musicPlaylist':'&id,\x20title,\x20artist,\x20album,\x20duration,\x20url,\x20coverImage,\x20lyrics,\x20addedTime,\x20isLocalFile','musicCovers':'&id,\x20songId,\x20imageData,\x20timestamp','apiSettings':_0x211817(0x87e),'globalSettings':'&id','wallpapers':_0x211817(0x1b1),'appIcons':_0x211817(0x1444),'chatSettings':'&id,\x20chatId','innerThoughts':_0x211817(0x68a),'forums':'++id,\x20name','forumPosts':_0x211817(0x1567),'forumReplies':_0x211817(0xa56),'forumFavorites':_0x211817(0x124b),'replyLikes':'++id,\x20[userId+replyId],\x20userId,\x20replyId,\x20timestamp','forumPostImages':_0x211817(0x1e14),'forumMountedWorldbooks':'++id,\x20&[forumId+worldbookId],\x20forumId','smsContacts':_0x211817(0x1f81),'smsMessages':_0x211817(0x470),'anniversaries':_0x211817(0xcb6),'appointments':_0x211817(0x1645),'momentVisibility':_0x211817(0xd41),'momentLocations':_0x211817(0xcd9),'momentMentions':_0x211817(0x1330),'characterFootprints':'&id,\x20characterId,\x20date,\x20data,\x20timestamp,\x20lastUpdateTime,\x20isComplete','footprintActivities':_0x211817(0x2142),'emojiLibraries':_0x211817(0x119d),'emojiLibraryItems':_0x211817(0x73e),'diarySettings':_0x211817(0x2032),'soundSettings':_0x211817(0xa8e),'characterSounds':'++id,\x20characterId,\x20soundType,\x20sourceType,\x20sourceUrl,\x20enabled,\x20timestamp','globalThemes':'&id,\x20themeType,\x20themeData,\x20timestamp','chatThemes':_0x211817(0xbbf),'themeSettings':'&id,\x20settingName,\x20settingValue,\x20timestamp','windowChatSettings':'++id,\x20&[chatId+windowId],\x20chatId,\x20windowId,\x20settings,\x20timestamp'});let selectedGroupMembers=[],currentWorldbookTab='global',characterGroups=[],isGroupManageMode=![],selectedGroupId=null,customEmojis=[],recentEmojis=[],currentEmojiTab='recent',pendingPersonalEmojiData=null,isPersonaExpanded=!![],emojiLibraries=[],currentEmojiLibrary=null,isEmojiLibraryExpanded=![],isMessageSelectionMode=![],selectedMessages=new Set(),isMessageListMultiSelectMode=![],selectedConversations=[],commentConversationRounds=new Map(),smsContacts=[],smsMessages={},pendingSMSMessages=[],isSMSMultiSelectMode=![],selectedSMSMessages=new Set(),apiSettings={'type':_0x211817(0x1ad7),'base':'https://api.openai.com/v1','endpoint':_0x211817(0x1bea),'key':'','model':_0x211817(0x1c64),'temperature':0.7},chatSettings={'themeColor':'#007AFF','theirBubbleColor':_0x211817(0x7ae),'myBubbleColor':'#007AFF','bubbleOpacity':0x1,'timestampEnabled':!![],'timestampPosition':_0x211817(0xcef)},selectedAppIcon=null,selectedWallpaper=null,colorPickerContext=null,customIconImage=null;async function loadGlobalWorldbookSettings(){const _0x1682c4=_0x211817;try{const _0x40b59a=await db['globalSettings'][_0x1682c4(0xb78)](_0x1682c4(0x11d7));_0x40b59a&&_0x40b59a[_0x1682c4(0x1a4e)]?window['activeGlobalWorldbooks']=_0x40b59a['activeGlobalWorldbooks']:(window[_0x1682c4(0x1a4e)]=[],await db[_0x1682c4(0x181d)][_0x1682c4(0x1561)]({'id':'main','activeGlobalWorldbooks':[]}));}catch(_0x34a9e9){console[_0x1682c4(0x174a)](_0x1682c4(0x1d16),_0x34a9e9),window[_0x1682c4(0x1a4e)]=[];}}document[_0x211817(0x21e9)](_0x211817(0x20dc),async function(){const _0x455a56=_0x211817;try{await window['db'][_0x455a56(0xc5f)](),console[_0x455a56(0x2187)](_0x455a56(0x485));}catch(_0x41816a){console[_0x455a56(0x174a)]('❌\x20数据库打开失败:',_0x41816a);try{await window['db'][_0x455a56(0x1f4a)](),window['db']=new Dexie(_0x455a56(0x20e2)),db=window['db'],window['db'][_0x455a56(0x156e)](0x29)[_0x455a56(0xe8e)]({'characters':_0x455a56(0x134f),'contacts':_0x455a56(0x940),'chatMessages':_0x455a56(0x66d),'personas':'&id,\x20name','customEmojis':_0x455a56(0xf19),'recentEmojis':_0x455a56(0x1b81)}),await window['db'][_0x455a56(0xc5f)](),console['log']('✅\x20数据库重新创建并打开成功');}catch(_0x31437d){console[_0x455a56(0x174a)](_0x455a56(0x5f7),_0x31437d);}}initializeDataLoadPromise(),updateTime();const _0x32ee1f=()=>{const _0x31afc7=_0x455a56;console['log'](_0x31afc7(0x92b)),SoundManager[_0x31afc7(0x468)]=!![],['touchstart','mousedown',_0x31afc7(0xf5c),_0x31afc7(0x1859)]['forEach'](_0x20d7c1=>{document['removeEventListener'](_0x20d7c1,_0x32ee1f);});};[_0x455a56(0x1728),_0x455a56(0x5ac),_0x455a56(0xf5c),_0x455a56(0x1859)][_0x455a56(0x19fb)](_0x2dd863=>{document['addEventListener'](_0x2dd863,_0x32ee1f,{'once':!![],'passive':!![]});}),console[_0x455a56(0x2187)](_0x455a56(0x1be));const _0x277a69=navigator['userAgent'][_0x455a56(0x1831)](_0x455a56(0xfe7)),_0x8e8a43=navigator['userAgent']['includes']('Safari')&&!navigator[_0x455a56(0x214b)][_0x455a56(0x1831)]('Chrome'),_0x51b5c9=navigator[_0x455a56(0x214b)][_0x455a56(0x1831)](_0x455a56(0x11f2));console['log'](_0x455a56(0xe2d),{'isChrome':_0x277a69,'isSafari':_0x8e8a43,'isFirefox':_0x51b5c9});_0x277a69&&(console[_0x455a56(0x2187)](_0x455a56(0x2267)),window[_0x455a56(0x21e9)]('error',function(_0x15a7f1){const _0x1e3620=_0x455a56;(_0x15a7f1[_0x1e3620(0x1e8e)][_0x1e3620(0x1831)](_0x1e3620(0x1404))||_0x15a7f1[_0x1e3620(0x1e8e)][_0x1e3620(0x1831)](_0x1e3620(0x2005)))&&(console[_0x1e3620(0x1f43)]('🔧\x20检测到数据相关错误，尝试自动修复:',_0x15a7f1[_0x1e3620(0x1e8e)]),setTimeout(()=>{typeof forceFixDataConsistency==='function'&&forceFixDataConsistency();},0x3e8));}));navigator[_0x455a56(0x214b)][_0x455a56(0x1831)](_0x455a56(0x18f6))&&navigator['userAgent'][_0x455a56(0x1831)](_0x455a56(0x1d94))&&(document['addEventListener'](_0x455a56(0x1679),function(_0x2833fa){const _0x1e9501=_0x455a56;if(_0x2833fa[_0x1e9501(0x193d)]&&typeof _0x2833fa[_0x1e9501(0x193d)][_0x1e9501(0x216a)]===_0x1e9501(0xe59)){if(_0x2833fa['target'][_0x1e9501(0x216a)]('.message-menu,\x20.sms-message-menu,\x20.offline-message-menu'))return;if(_0x2833fa[_0x1e9501(0x193d)][_0x1e9501(0x216a)](_0x1e9501(0xc2f)))return _0x2833fa[_0x1e9501(0x36f)](),![];}},{'passive':![]}),document['addEventListener'](_0x455a56(0x1049),function(_0x4917b8){const _0x2b4b5f=_0x455a56;if(_0x4917b8['target']&&typeof _0x4917b8[_0x2b4b5f(0x193d)]['closest']===_0x2b4b5f(0xe59)){if(_0x4917b8[_0x2b4b5f(0x193d)][_0x2b4b5f(0x216a)]('.message-bubble,\x20.offline-message-content')&&!_0x4917b8[_0x2b4b5f(0x193d)]['closest'](_0x2b4b5f(0x1ea2)))return _0x4917b8['preventDefault'](),![];}},{'passive':![]}),document['addEventListener'](_0x455a56(0x1442),function(_0x51b63e){const _0x19acd6=_0x455a56;if(_0x51b63e['target']&&typeof _0x51b63e['target'][_0x19acd6(0x216a)]===_0x19acd6(0xe59)){if(_0x51b63e[_0x19acd6(0x193d)][_0x19acd6(0x216a)](_0x19acd6(0x1a8f))&&!_0x51b63e[_0x19acd6(0x193d)][_0x19acd6(0x216a)]('img,\x20[draggable=\x22true\x22]'))return _0x51b63e[_0x19acd6(0x36f)](),![];}},{'passive':![]}),console[_0x455a56(0x2187)](_0x455a56(0xe07)));if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x455a56(0x11b8)](navigator['userAgent'])){console[_0x455a56(0x2187)](_0x455a56(0x1c11));let _0x2d71f6=null;document['addEventListener'](_0x455a56(0x1728),function(_0x4798c9){const _0xee3fca=_0x455a56;_0x2d71f6=Date['now'](),console[_0xee3fca(0x2187)]('🔍\x20触摸开始:',_0x4798c9[_0xee3fca(0x193d)][_0xee3fca(0x1722)]);},{'passive':!![]}),document[_0x455a56(0x21e9)]('touchend',function(_0x573ae4){const _0x2dd46d=_0x455a56;if(_0x2d71f6){const _0x1e32b5=Date[_0x2dd46d(0x2eb)]()-_0x2d71f6;_0x1e32b5>0x1f4&&console[_0x2dd46d(0x2187)](_0x2dd46d(0x3c8),_0x1e32b5+'ms',_0x573ae4[_0x2dd46d(0x193d)][_0x2dd46d(0x1722)]),_0x2d71f6=null;}},{'passive':!![]});}try{initializeWindowId(),console['log'](_0x455a56(0x104d));const _0x4932e7=await checkDatabaseHealth();if(!_0x4932e7){console[_0x455a56(0x1f43)]('⚠️\x20数据库健康检查失败，尝试重置...');const _0x12c40a=await resetDatabase();if(!_0x12c40a)throw new Error(_0x455a56(0xa16));console[_0x455a56(0x2187)]('✅\x20数据库已重置，继续初始化...');}else console[_0x455a56(0x2187)]('✅\x20数据库健康检查通过');console[_0x455a56(0x2187)](_0x455a56(0x1284)),await Promise['all']([loadCharacterGroups(),loadCharacters(),loadChatMessages(),loadMemoryConfig(),loadChatSettings(),loadApiSettings(),loadCustomEmojis(),loadEmojiLibraries(),loadGlobalWorldbookSettings(),initGlobalMemoryDB(),loadCustomAppIcons(),migrateFootprintsFromLocalStorage(),cleanupFootprintsCache()]),console[_0x455a56(0x2187)]('🧹\x20清理拉黑系统消息...'),cleanupBlockedSystemMessages(),console['log'](_0x455a56(0x815));const _0x469b01=await autoFixCorruptedMessages();_0x469b01>0x0&&console[_0x455a56(0x2187)]('✅\x20自动修复了\x20'+_0x469b01+_0x455a56(0xd67));console[_0x455a56(0x2187)](_0x455a56(0x1bdc)),await loadContacts(),console[_0x455a56(0x2187)](_0x455a56(0xb8c)),await loadSMSContacts(),await loadSMSMessages(),loadPinnedSMSConversations(),loadPinnedConversations(),loadPhoneBorderSetting(),loadScreenSize(),loadFontSizeSettings(),loadGlobalFontSettings(),loadStatusIconSetting(),loadHomeFontColorSetting(),loadClockStyleSetting(),updateGlobalMemoryStatusDisplay(),await loadMomentsImages(),await loadWallpaper(),await loadAppIcons(),await loadSavedTheme(),await loadWorldbooks(),await loadPersonas(),await loadGroupChats(),checkLocalStorageUsage(),await initMemoryViewer(),await loadAnniversaryList(),await loadAppointmentList(),initializeWidgets(),initializeForumApp(),await preloadOfflineUISettings();try{console[_0x455a56(0x2187)](_0x455a56(0x3b6),{'charactersCount':characters?characters[_0x455a56(0x19ee)]:_0x455a56(0xcba),'contactsCount':contacts?contacts[_0x455a56(0x19ee)]:_0x455a56(0xcba),'chatMessagesType':typeof chatMessages,'chatMessagesKeys':chatMessages?Object[_0x455a56(0x1c9f)](chatMessages)[_0x455a56(0x19ee)]:'undefined'});if(!characters)characters=[];if(!contacts)contacts=[];if(!chatMessages)chatMessages={};if(characters[_0x455a56(0x19ee)]>0x0&&contacts[_0x455a56(0x19ee)]===0x0){const _0x3e59ae=Object[_0x455a56(0x1c9f)](chatMessages)[_0x455a56(0x19ee)]>0x0;if(_0x3e59ae){console[_0x455a56(0x1f43)](_0x455a56(0x16a7));const _0x20490e=Object[_0x455a56(0x1c9f)](chatMessages)[_0x455a56(0x1e1f)](_0x4562b6=>characters['some'](_0x37293a=>_0x37293a['id']===_0x4562b6));_0x20490e['length']>0x0&&(contacts=_0x20490e,saveContacts()[_0x455a56(0x1c82)](_0x4e3901=>console[_0x455a56(0x174a)](_0x455a56(0x1a4f),_0x4e3901)),console[_0x455a56(0x2187)]('🔧\x20从聊天记录恢复了\x20'+contacts['length']+_0x455a56(0x164d)));}else console['log']('✅\x20无聊天记录，联系人为空是正常状态');}renderMessageList(),renderContactList(),renderCharacterList(),renderPersonaList(),setTimeout(()=>{const _0xd551a9=_0x455a56,_0x5dcd4d=document[_0xd551a9(0x1897)]('.message-item');console[_0xd551a9(0x2187)](_0xd551a9(0x693)+_0x5dcd4d['length']+_0xd551a9(0x1803)),_0x5dcd4d[_0xd551a9(0x19ee)]===0x0&&characters[_0xd551a9(0x19ee)]>0x0&&(console['warn'](_0xd551a9(0x16af)),diagnoseBrowserCompatibility(),setTimeout(()=>{forceFixDataConsistency();},0x3e8));},0x1f4);}catch(_0x2235f8){console[_0x455a56(0x174a)]('❌\x20界面渲染失败:',_0x2235f8),console['log'](_0x455a56(0x1e5f));if(!chatMessages)chatMessages={};if(!contacts)contacts=[];if(!characters)characters=[];try{renderMessageList(),renderContactList(),renderCharacterList();}catch(_0x4efc9b){console[_0x455a56(0x174a)](_0x455a56(0x153a),_0x4efc9b),setTimeout(()=>{typeof forceFixDataConsistency==='function'&&forceFixDataConsistency();},0x7d0);}}setTimeout(async()=>{const _0x408c7d=_0x455a56;switchChatTab(_0x408c7d(0x1c45));const _0x7ef9aa=document[_0x408c7d(0xb30)](_0x408c7d(0x99c));_0x7ef9aa&&(_0x7ef9aa[_0x408c7d(0x1c1b)]['add'](_0x408c7d(0x1daf)),_0x7ef9aa[_0x408c7d(0x13be)]='💬');initChatSettingsUIEvents(),applyBubbleStyle(),applyCustomBubbleCSS();if(currentChatCharacter)initializeChatSettings(),updateWorldbookMountDisplay();else{}await initGlobalBackgroundInteractionSystem(),initEmojiLibraryUpload(),setupMidnightCacheCleanup(),initAnniversaryReminderSystem(),await SoundManager[_0x408c7d(0x1f97)](),initializeFootprintsAutoUpdate();},0x64);const _0x47999d=document[_0x455a56(0x1262)](_0x455a56(0x2304));_0x47999d&&_0x47999d[_0x455a56(0x21e9)](_0x455a56(0x1823),function(){const _0x1b4459=_0x455a56;document[_0x1b4459(0x1262)](_0x1b4459(0x854))[_0x1b4459(0x13be)]=parseFloat(this[_0x1b4459(0x1ebc)])['toFixed'](0x2);});initializeApiSettings(),document['getElementById']('opacity-slider')[_0x455a56(0x21e9)](_0x455a56(0x1823),function(){const _0x517f7e=_0x455a56;document[_0x517f7e(0x1262)]('opacity-value')[_0x517f7e(0x13be)]=Math[_0x517f7e(0x13e2)](this[_0x517f7e(0x1ebc)]*0x64)+'%';});const _0x2b45b8=document[_0x455a56(0x1262)]('song-cover-input'),_0x4b903f=document[_0x455a56(0xb30)](_0x455a56(0x1c1a));_0x2b45b8&&_0x4b903f&&_0x2b45b8[_0x455a56(0x21e9)](_0x455a56(0x5af),function(_0x3808b8){const _0x1b5076=_0x455a56;_0x3808b8[_0x1b5076(0x193d)]['files']&&_0x3808b8['target']['files'][0x0]?_0x4b903f[_0x1b5076(0x13be)]=_0x3808b8[_0x1b5076(0x193d)][_0x1b5076(0xf26)][0x0]['name']:_0x4b903f[_0x1b5076(0x13be)]='未选封面';});document[_0x455a56(0x1262)](_0x455a56(0x21bd))[_0x455a56(0x21e9)](_0x455a56(0xf20),function(_0x2c42a0){const _0x38f123=_0x455a56;_0x2c42a0['key']===_0x38f123(0xdcf)&&!_0x2c42a0['shiftKey']&&(_0x2c42a0['preventDefault'](),sendApiMessage());});let _0x2e39cc=![],_0xb633a3=-0x1,_0x4d7fbe=-0x1,_0x388ade='';document[_0x455a56(0x1262)]('api-chat-input')[_0x455a56(0x21e9)]('input',function(_0x4ae5ce){handleMentionInput(_0x4ae5ce);}),document[_0x455a56(0x1262)](_0x455a56(0x21bd))[_0x455a56(0x21e9)](_0x455a56(0xf5c),function(_0x4f7881){_0x2e39cc&&handleMentionKeydown(_0x4f7881);}),document[_0x455a56(0x21e9)](_0x455a56(0x1859),function(_0xf5db90){const _0x20efd9=_0x455a56,_0x337e50=document[_0x20efd9(0x1262)]('mention-dropdown'),_0x2fa2c9=document[_0x20efd9(0x1262)](_0x20efd9(0x21bd));_0x2e39cc&&!_0x337e50[_0x20efd9(0x971)](_0xf5db90[_0x20efd9(0x193d)])&&_0xf5db90[_0x20efd9(0x193d)]!==_0x2fa2c9&&hideMentionDropdown();}),initializeAvatarUpload(),initializeEmojiUpload(),initializeIconUpload();const _0x1f8e3a=document[_0x455a56(0x1262)](_0x455a56(0x1d86));_0x1f8e3a&&(_0x1f8e3a[_0x455a56(0x14eb)][_0x455a56(0x4da)]=_0x455a56(0x102b));isMessageSelectionMode=![],selectedMessages[_0x455a56(0xa4f)](),document['getElementById'](_0x455a56(0x1629))[_0x455a56(0x21e9)](_0x455a56(0x5af),function(_0x535346){const _0x3cea5f=_0x455a56;if(_0x535346[_0x3cea5f(0x193d)][_0x3cea5f(0xf26)]&&_0x535346[_0x3cea5f(0x193d)][_0x3cea5f(0xf26)][0x0]){const _0x10eda3=_0x535346[_0x3cea5f(0x193d)][_0x3cea5f(0xf26)][0x0];if(_0x10eda3[_0x3cea5f(0x1a4b)]==='image/gif'){alert(_0x3cea5f(0xca9)),_0x535346[_0x3cea5f(0x193d)][_0x3cea5f(0x1ebc)]='';return;}const _0xacb3d8=new FileReader();_0xacb3d8['onload']=function(_0x5b2947){const _0x287795=_0x3cea5f;sendImageMessage(_0x5b2947[_0x287795(0x193d)][_0x287795(0x4ee)]);},_0xacb3d8['readAsDataURL'](_0x10eda3);}_0x535346[_0x3cea5f(0x193d)][_0x3cea5f(0x1ebc)]='';}),document[_0x455a56(0x1262)](_0x455a56(0x1b8d))['addEventListener'](_0x455a56(0x5af),function(_0x5ceed3){const _0x4a8aa9=_0x455a56;if(_0x5ceed3['target'][_0x4a8aa9(0xf26)]&&_0x5ceed3[_0x4a8aa9(0x193d)][_0x4a8aa9(0xf26)][0x0]){const _0x4e5ebe=new FileReader();_0x4e5ebe['onload']=function(_0x1ef034){const _0x182e8c=_0x4a8aa9;selectedWallpaper=_0x1ef034[_0x182e8c(0x193d)]['result'];const _0xa8fadf=document[_0x182e8c(0x1262)]('wallpaper-preview-container');_0xa8fadf&&(_0xa8fadf[_0x182e8c(0x33a)]=_0x182e8c(0xf7c)+selectedWallpaper+_0x182e8c(0x9ee));},_0x4e5ebe['readAsDataURL'](_0x5ceed3[_0x4a8aa9(0x193d)]['files'][0x0]);}}),document[_0x455a56(0x1262)](_0x455a56(0x1e38))[_0x455a56(0x21e9)]('change',function(_0x192687){const _0x30ba88=_0x455a56;if(_0x192687[_0x30ba88(0x193d)][_0x30ba88(0xf26)]&&_0x192687[_0x30ba88(0x193d)]['files'][0x0]){const _0x3eb198=new FileReader();_0x3eb198[_0x30ba88(0xc55)]=function(_0x52926b){const _0x1f1f3e=_0x30ba88;customIconImage=_0x52926b[_0x1f1f3e(0x193d)][_0x1f1f3e(0x4ee)];const _0x49bfe8=document[_0x1f1f3e(0x1897)]('.icon-preview');_0x49bfe8[_0x1f1f3e(0x19fb)](_0x4b8c3c=>{const _0x50815b=_0x1f1f3e;_0x4b8c3c[_0x50815b(0x14eb)][_0x50815b(0x159c)]=_0x50815b(0x9f1)+customIconImage+')',_0x4b8c3c['innerHTML']='';});},_0x3eb198[_0x30ba88(0x127c)](_0x192687['target'][_0x30ba88(0xf26)][0x0]);}}),setInterval(updateTime,0x3e8),initBatteryManager(),resolveDataLoaded(),console[_0x455a56(0x2187)](_0x455a56(0x893)),setTimeout(async()=>{const _0x4348f4=_0x455a56;try{await initGlobalMomentsSystem(),console[_0x4348f4(0x2187)](_0x4348f4(0x1c55));}catch(_0x1b96ca){console['error'](_0x4348f4(0x1089),_0x1b96ca);}},0xbb8);const _0x5af5b9=sessionStorage[_0x455a56(0x15d8)](_0x455a56(0x888));_0x5af5b9&&(console[_0x455a56(0x2187)](_0x455a56(0x1ca),_0x5af5b9),dataLoadedPromise['then'](()=>{const _0x3b00d3=_0x455a56,_0x2bcd16=characters[_0x3b00d3(0xaf4)](_0x45a59e=>_0x45a59e['id']===_0x5af5b9),_0x5059ad=groupChats[_0x3b00d3(0xaf4)](_0x37bacc=>_0x37bacc['id']===_0x5af5b9),_0x59fa9b=_0x2bcd16||_0x5059ad;_0x59fa9b?setTimeout(()=>{startChat(_0x59fa9b);},0x64):(console[_0x3b00d3(0x1f43)](_0x3b00d3(0x2079),_0x5af5b9),sessionStorage[_0x3b00d3(0x3b2)](_0x3b00d3(0x888)));}));}catch(_0x4ca542){console[_0x455a56(0x174a)]('应用初始化失败:',_0x4ca542),console[_0x455a56(0x174a)](_0x455a56(0xa03),_0x4ca542[_0x455a56(0x1574)]);const _0x26e0f3=_0x455a56(0xe4c)+_0x4ca542['message']+_0x455a56(0x1eac)+_0x4ca542['name'];if(_0x4ca542[_0x455a56(0x1a1c)]==='DataError'||_0x4ca542[_0x455a56(0x1a1c)]===_0x455a56(0x18f8)||_0x4ca542['name']==='DexieError'){console[_0x455a56(0x2187)]('检测到数据库错误，尝试重置数据库...');if(confirm(_0x455a56(0xcfe)))try{await resetDatabase(),location['reload']();}catch(_0x6bea16){console[_0x455a56(0x174a)](_0x455a56(0x1834),_0x6bea16),alert('重置数据库失败，请手动清除浏览器数据后重试。');}}else{alert(_0x26e0f3);try{if(!characters)characters=[];if(!contacts)contacts=[];if(!chatMessages)chatMessages={};showApp(_0x455a56(0x19bd)),setTimeout(()=>{const _0x2e0684=_0x455a56;try{const _0x408607=document['querySelector'](_0x2e0684(0xb56));_0x408607&&_0x408607['click']();}catch(_0x12762f){console[_0x2e0684(0x174a)](_0x2e0684(0x4e5),_0x12762f);}},0x3e8);}catch(_0x503550){console[_0x455a56(0x174a)]('无法显示紧急恢复界面:',_0x503550);}}}});function showApp(_0x4d0bd8){const _0x485f9f=_0x211817;if(event)event[_0x485f9f(0x36f)]();const _0x20c204=document[_0x485f9f(0x1897)](_0x485f9f(0x1c9));_0x20c204['forEach'](_0x250090=>{const _0x74027e=_0x485f9f;_0x250090[_0x74027e(0x14eb)]['display']=_0x74027e(0x102b);});const _0x990b4c=document['getElementById'](_0x485f9f(0x1b73)),_0x528875=document[_0x485f9f(0x1262)](_0x485f9f(0x224)),_0x14302e=document[_0x485f9f(0x1262)](_0x485f9f(0x1523)),_0x5b6de9=document[_0x485f9f(0x1262)](_0x485f9f(0x819));if(_0x990b4c)_0x990b4c[_0x485f9f(0x14eb)][_0x485f9f(0x4da)]=_0x485f9f(0x102b);if(_0x528875)_0x528875['style'][_0x485f9f(0x4da)]='none';if(_0x14302e)_0x14302e[_0x485f9f(0x14eb)][_0x485f9f(0x4da)]=_0x485f9f(0x102b);_0x5b6de9&&(_0x5b6de9['style']['display']=_0x485f9f(0x102b));const _0x1944e4=document['getElementById'](_0x4d0bd8);if(!_0x1944e4){console[_0x485f9f(0x174a)](_0x485f9f(0x20f4)+_0x4d0bd8),showToast(_0x485f9f(0x71a)+_0x4d0bd8+_0x485f9f(0x1872),'error');return;}_0x1944e4[_0x485f9f(0x14eb)][_0x485f9f(0x4da)]='flex',_0x4d0bd8===_0x485f9f(0x1c2a)&&renderMessageList(),_0x4d0bd8===_0x485f9f(0x1c5d)&&renderSMSMessageList(),_0x4d0bd8===_0x485f9f(0x309)&&(loadAnniversaryList(),loadAppointmentList()),_0x4d0bd8==='api-settings-screen'&&setTimeout(()=>{initializeApiSettings();},0x64),_0x4d0bd8===_0x485f9f(0x1bd9)&&setTimeout(()=>{initSoundSettings();},0x64),_0x4d0bd8==='custom-theme-screen'&&setTimeout(async()=>{await initCustomThemeScreen();},0x64);}function hideCharacterForm(){const _0x3ddaea=_0x211817;clearCharacterForm(),hideApp(_0x3ddaea(0x13bf)),showApp('chat-screen'),switchChatTab(_0x3ddaea(0x1838));const _0x2c58bd=document[_0x3ddaea(0x1897)](_0x3ddaea(0xb8a));_0x2c58bd[_0x3ddaea(0x19fb)](_0x1c7532=>{const _0x4579e1=_0x3ddaea;_0x1c7532&&_0x1c7532[_0x4579e1(0x1c1b)]&&_0x1c7532[_0x4579e1(0x1c1b)][_0x4579e1(0x1493)]('active');}),_0x2c58bd[_0x3ddaea(0x19ee)]>0x1&&_0x2c58bd[0x1]&&_0x2c58bd[0x1][_0x3ddaea(0x1c1b)]&&_0x2c58bd[0x1][_0x3ddaea(0x1c1b)]['add']('active');}function hideApp(_0xc994ea){const _0x3ed49e=_0x211817;document['getElementById'](_0xc994ea)[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]='none';const _0x341e6c=document[_0x3ed49e(0x1897)](_0x3ed49e(0x1c9)),_0x292709=Array['from'](_0x341e6c)[_0x3ed49e(0x19fa)](_0x4461b1=>_0x4461b1[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]==='flex'||_0x4461b1[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]===_0x3ed49e(0x13de));if(!_0x292709){const _0xd507e3=document['getElementById']('clock-container'),_0x3028d8=document['getElementById'](_0x3ed49e(0x224)),_0x4fd51e=document[_0x3ed49e(0x1262)](_0x3ed49e(0x1523)),_0x14d0a7=document[_0x3ed49e(0x1262)](_0x3ed49e(0x819));if(_0xd507e3)_0xd507e3[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]='block';if(_0x3028d8)_0x3028d8[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]=_0x3ed49e(0xc00);if(_0x4fd51e)_0x4fd51e['style'][_0x3ed49e(0x4da)]=_0x3ed49e(0x13de);if(_0x14d0a7)_0x14d0a7[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]='flex';}else{const _0x74169e=document[_0x3ed49e(0x1262)]('status-bar');_0x74169e&&(_0x74169e[_0x3ed49e(0x14eb)][_0x3ed49e(0x4da)]=_0x3ed49e(0x102b));}}function showModal(_0x1f6de6){const _0x8c07d1=_0x211817;console['log']('showModal\x20called\x20with:',_0x1f6de6);const _0x45bf1d=document[_0x8c07d1(0x1262)](_0x1f6de6);console[_0x8c07d1(0x2187)]('Modal\x20element:',_0x45bf1d),_0x45bf1d?(_0x45bf1d[_0x8c07d1(0x14eb)][_0x8c07d1(0x4da)]=_0x8c07d1(0x1fb7),console[_0x8c07d1(0x2187)](_0x8c07d1(0x2016))):console['log'](_0x8c07d1(0x1f63));}function hideModal(_0x4ff2fd){const _0x6519b1=_0x211817;document[_0x6519b1(0x1262)](_0x4ff2fd)[_0x6519b1(0x14eb)][_0x6519b1(0x4da)]=_0x6519b1(0x102b);}let anniversaries=[],editingAnniversaryId=null,appointments=[],editingAppointmentId=null;function switchAnniversaryTab(_0x5896b0){const _0x167599=_0x211817;document[_0x167599(0x1897)](_0x167599(0xd9d))['forEach'](_0x94993b=>{const _0x251f91=_0x167599;_0x94993b['classList'][_0x251f91(0x1493)]('active');}),document[_0x167599(0xb30)](_0x167599(0x193a)+_0x5896b0+'\x22]')[_0x167599(0x1c1b)][_0x167599(0x21e2)](_0x167599(0x1a14)),document[_0x167599(0x1262)](_0x167599(0x136e))['style'][_0x167599(0x4da)]=_0x5896b0==='anniversary'?_0x167599(0x13de):_0x167599(0x102b),document[_0x167599(0x1262)](_0x167599(0x106f))[_0x167599(0x14eb)][_0x167599(0x4da)]=_0x5896b0===_0x167599(0x18e0)?_0x167599(0x13de):_0x167599(0x102b);const _0x1b18c9=document[_0x167599(0xb30)](_0x167599(0x718));_0x5896b0==='anniversary'?(_0x1b18c9[_0x167599(0x1f36)]=showAnniversaryForm,_0x1b18c9[_0x167599(0x33a)]=_0x167599(0x1cb2),_0x1b18c9[_0x167599(0x378)]=_0x167599(0x1d08)):(_0x1b18c9['onclick']=()=>showAppointmentForm(),_0x1b18c9[_0x167599(0x33a)]=_0x167599(0x1cb2),_0x1b18c9[_0x167599(0x378)]=_0x167599(0x7e2));}function switchShoppingTab(_0x45970d){const _0x13fbf6=_0x211817;document[_0x13fbf6(0x1897)](_0x13fbf6(0x114b))['forEach'](_0x537733=>{const _0x594c89=_0x13fbf6;_0x537733[_0x594c89(0x1c1b)][_0x594c89(0x1493)](_0x594c89(0x1a14));}),document['querySelector'](_0x13fbf6(0x66f)+_0x45970d+'\x22]')[_0x13fbf6(0x1c1b)]['add']('active');const _0x36ad81=document[_0x13fbf6(0x1262)](_0x13fbf6(0x1692)),_0x41b222=document[_0x13fbf6(0x1262)](_0x13fbf6(0x169d)),_0x1afb7a=document[_0x13fbf6(0xb30)](_0x13fbf6(0xd7a)),_0x48c09b=document[_0x13fbf6(0xb30)](_0x13fbf6(0x219c)),_0xfa5969=document['querySelector'](_0x13fbf6(0x4ba));_0x36ad81[_0x13fbf6(0x14eb)][_0x13fbf6(0x4da)]='block',_0x1afb7a['style']['display']='block',_0x41b222[_0x13fbf6(0x14eb)][_0x13fbf6(0x4da)]=_0x13fbf6(0x102b),_0xfa5969['classList'][_0x13fbf6(0x1493)]('showing-products');if(_0x45970d===_0x13fbf6(0x1563))_0x48c09b[_0x13fbf6(0x13be)]='外卖';else _0x45970d==='shopping'&&(_0x48c09b['textContent']='购物');_0x1afb7a[_0x13fbf6(0x14eb)][_0x13fbf6(0xbc7)]=_0x13fbf6(0x18dc),_0x1afb7a[_0x13fbf6(0x14eb)][_0x13fbf6(0x15dc)]='0',_0x1afb7a[_0x13fbf6(0x14eb)][_0x13fbf6(0x201e)]=_0x13fbf6(0x102b);const _0x48813c=document[_0x13fbf6(0x1262)]('takeout-categories'),_0x15bbe3=document[_0x13fbf6(0x1262)](_0x13fbf6(0xccc));if(_0x45970d===_0x13fbf6(0x1563))_0x48813c[_0x13fbf6(0x14eb)][_0x13fbf6(0x4da)]=_0x13fbf6(0x1fb7),_0x15bbe3[_0x13fbf6(0x14eb)]['display']=_0x13fbf6(0x102b);else _0x45970d===_0x13fbf6(0xf6b)&&(_0x48813c['style'][_0x13fbf6(0x4da)]=_0x13fbf6(0x102b),_0x15bbe3[_0x13fbf6(0x14eb)][_0x13fbf6(0x4da)]=_0x13fbf6(0x1fb7));console[_0x13fbf6(0x2187)](_0x13fbf6(0x83f),_0x45970d);}const productsData={'美食':[{'name':'麻辣香锅','brand':_0x211817(0x2268),'price':45.8,'options':{'size':['小份','中份','大份'],'spicy':['不辣','微辣','中辣','特辣']},'prices':{'size':{'小份':0x26,'中份':0x2e,'大份':0x3a}}},{'name':'宫保鸡丁','brand':_0x211817(0x1163),'price':28.5,'options':{'size':['小份','大份'],'spicy':['不辣','微辣','中辣']},'prices':{'size':{'小份':0x18,'大份':0x24}}},{'name':_0x211817(0x805),'brand':_0x211817(0xe23),'price':0x20,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x1a,'大份':0x2a}}},{'name':_0x211817(0x618),'brand':'太二','price':0x44,'options':{'size':[_0x211817(0x17d4),'3-4人份'],'spicy':['微辣','中辣','特辣']},'prices':{'size':{'1-2人份':0x44,'3-4人份':0x5d}}},{'name':'兰州拉面','brand':'马子禄','price':0x12,'options':{'noodle':['细面','宽面'],'soup':['清汤','红汤']},'prices':{'soup':{'清汤':0x12,'红汤':0x14}}},{'name':_0x211817(0x1a6b),'brand':_0x211817(0x1740),'price':0x23,'options':{'count':['6个','8个',_0x211817(0x632)]},'prices':{'count':{'6个':0x23,'8个':0x2b,'12个':0x35}}},{'name':'烤鸭','brand':_0x211817(0x808),'price':0x80,'options':{'size':['半只','整只']},'prices':{'size':{'半只':0x80,'整只':0xbc}}},{'name':_0x211817(0xb82),'brand':_0x211817(0x611),'price':0x16,'options':{'spicy':['微辣','中辣','特辣']}},{'name':_0x211817(0x76e),'brand':_0x211817(0xd25),'price':0x26,'options':{'size':['小份','大份']}},{'name':_0x211817(0x17fc),'brand':'巴奴','price':0x3a,'options':{'size':[_0x211817(0x17d4),_0x211817(0x18f0)],'spicy':['中辣','特辣',_0x211817(0x2fc)]}},{'name':_0x211817(0xabb),'brand':_0x211817(0x1621),'price':0x2a,'options':{'spicy':['微辣','中辣','特辣']}},{'name':'蒸蛋羹','brand':_0x211817(0x212a),'price':0xf,'options':{'flavor':['原味','肉末','虾仁']},'prices':{'flavor':{'原味':0xf,'肉末':0x12,'虾仁':0x14}}},{'name':_0x211817(0x1eb1),'brand':_0x211817(0x648),'price':0x30,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x26,'大份':0x3f}}},{'name':_0x211817(0x1eb8),'brand':_0x211817(0x105a),'price':0x23,'options':{'spicy':['微辣','中辣']}},{'name':_0x211817(0x19b9),'brand':_0x211817(0x459),'price':0x2d,'options':{'size':['半只','整只']},'prices':{'size':{'半只':0x2d,'整只':0x50}}},{'name':_0x211817(0x1f91),'brand':'扬州炒饭','price':0x19,'options':{'ingredients':['普通','虾仁','叉烧','海鲜']},'prices':{'ingredients':{'普通':0x19,'虾仁':0x21,'叉烧':0x1f,'海鲜':0x25}}},{'name':'担担面','brand':'成都小吃','price':0x14,'options':{'spicy':['微辣','中辣','特辣'],'noodle':['细面','宽面']}},{'name':_0x211817(0x17c9),'brand':'廖记棒棒鸡','price':0x20,'options':{'spicy':['微辣','中辣','特辣']}},{'name':_0x211817(0x2261),'brand':_0x211817(0x50b),'price':0x12,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0xf,'大份':0x17}}},{'name':_0x211817(0x6df),'brand':_0x211817(0x1b07),'price':0x44,'options':{'weight':['1斤',_0x211817(0x2d7),'2斤']},'prices':{'weight':{'1斤':0x44,'1.5斤':0x58,'2斤':0x6c}}}],'甜点饮品':[{'name':_0x211817(0x1e9a),'brand':'喜茶','price':0x19,'options':{'sugar':['无糖',_0x211817(0x61a),_0x211817(0x39e),_0x211817(0xf66),'全糖'],'ice':['多冰','少冰','常温','热'],'size':['小杯','中杯','大杯']},'prices':{'size':{'小杯':0x16,'中杯':0x19,'大杯':0x1e}}},{'name':_0x211817(0x505),'brand':_0x211817(0x1cb5),'price':0x26,'options':{'flavor':['原味','草莓','蓝莓','巧克力']}},{'name':_0x211817(0x126a),'brand':_0x211817(0x65c),'price':0x20,'options':{'size':['小份','大份']},'prices':{'size':{'小份':0x1b,'大份':0x28}}},{'name':_0x211817(0x845),'brand':_0x211817(0x2227),'price':0x1c,'options':{'sugar':['无糖','半糖','全糖'],'ice':['多冰','少冰','常温','热'],'size':['小杯','中杯','大杯']}},{'name':'红豆沙冰','brand':_0x211817(0x681),'price':0x16,'options':{'ice':['多冰','少冰'],'size':['小杯','大杯']}},{'name':_0x211817(0x3ff),'brand':_0x211817(0x22df),'price':0x23,'options':{'count':['1个','2个','4个']},'prices':{'count':{'1个':0x23,'2个':0x32,'4个':0x46}}},{'name':_0x211817(0x15f7),'brand':_0x211817(0x1ed1),'price':0x12,'options':{'flavor':['原味','红豆','芒果']}},{'name':'柠檬茶','brand':_0x211817(0xbf4),'price':0x14,'options':{'sugar':['无糖',_0x211817(0x61a),_0x211817(0x39e),_0x211817(0xf66)],'ice':['多冰','少冰','常温'],'size':['中杯','大杯']}},{'name':_0x211817(0x223b),'brand':_0x211817(0x161e),'price':0x2d,'options':{'flavor':['香草','巧克力','草莓','柠檬'],'count':['3个','6个','12个']}},{'name':'布丁','brand':'优格','price':0xf,'options':{'flavor':['原味','焦糖','芒果','草莓']}},{'name':_0x211817(0x1fc6),'brand':_0x211817(0x1a26),'price':0x12,'options':{'sugar':[_0x211817(0x61a),_0x211817(0x39e),_0x211817(0xf66)],'ice':['多冰','少冰','常温'],'size':['中杯','大杯']}},{'name':'芋圆','brand':_0x211817(0x1063),'price':0x16,'options':{'ice':['多冰','少冰'],'toppings':['红豆','绿豆','花生','椰果']}},{'name':'冰淇淋','brand':'哈根达斯','price':0x3a,'options':{'flavor':['香草',_0x211817(0x478),'草莓','抹茶'],'size':['小杯','大杯']}},{'name':_0x211817(0x1cbb),'brand':_0x211817(0x13f4),'price':0x19,'options':{'flavor':['原味','蓝莓',_0x211817(0x478)]}},{'name':'泡芙','brand':'原麦山丘','price':0x1c,'options':{'flavor':['奶油',_0x211817(0x478),'抹茶'],'count':['3个','6个']}},{'name':'果汁','brand':'鲜果时间','price':0x14,'options':{'flavor':['橙汁','苹果汁','葡萄汁',_0x211817(0x3a0)],'size':['中杯','大杯']}},{'name':'咖啡','brand':_0x211817(0x2227),'price':0x18,'options':{'type':['美式','拿铁',_0x211817(0xe7b)],'sugar':['无糖','半糖','全糖'],'size':['小杯','中杯','大杯']}},{'name':'奶昔','brand':'DQ','price':0x20,'options':{'flavor':['香草',_0x211817(0x478),'草莓','芒果'],'size':['小杯','中杯','大杯']}},{'name':'蛋挞','brand':_0x211817(0x1494),'price':0x8,'options':{'count':['1个','6个',_0x211817(0x632)]}},{'name':_0x211817(0xdaf),'brand':_0x211817(0x8c3),'price':0x2a,'options':{'flavor':['原味','巧克力','抹茶']}}],'蔬菜水果':[{'name':'有机苹果','brand':'佳沛','price':12.8,'options':{'weight':['500g',_0x211817(0xd8a),_0x211817(0x17fb)],'type':[_0x211817(0x16f5),_0x211817(0xf80)]}},{'name':_0x211817(0x198e),'brand':'都乐','price':8.5,'options':{'weight':[_0x211817(0x129e),_0x211817(0xd8a)]}},{'name':_0x211817(0x349),'brand':'丹东草莓','price':0x19,'options':{'weight':['250g','500g',_0x211817(0xd8a)]}},{'name':_0x211817(0x17e3),'brand':_0x211817(0x135d),'price':6.8,'options':{'weight':[_0x211817(0x129e),_0x211817(0xd8a)],'type':['小番茄',_0x211817(0xe2a)]}},{'name':_0x211817(0x1a6),'brand':_0x211817(0x4f8),'price':4.5,'options':{'weight':[_0x211817(0x129e),_0x211817(0xd8a)]}},{'name':_0x211817(0x7c3),'brand':'绿色农场','price':5.2,'options':{'weight':['500g',_0x211817(0xd8a)]}},{'name':_0x211817(0x1c18),'brand':'本地农场','price':3.8,'options':{'weight':[_0x211817(0x1f1d),_0x211817(0x129e)]}},{'name':_0x211817(0x96a),'brand':_0x211817(0x8f9),'price':0x12,'options':{'count':['2个','4个','6个'],'ripeness':['生','半熟','熟']}},{'name':'有机白菜','brand':_0x211817(0x33c),'price':3.2,'options':{'weight':[_0x211817(0x129e),_0x211817(0xd8a),_0x211817(0x17fb)]}},{'name':_0x211817(0x795),'brand':'本地蔬菜','price':0x4,'options':{'weight':['250g',_0x211817(0x129e)]}},{'name':_0x211817(0x1bb4),'brand':_0x211817(0x1889),'price':15.8,'options':{'weight':[_0x211817(0xd8a),_0x211817(0x17fb)],'type':['脐橙','血橙']}},{'name':_0x211817(0x1b37),'brand':_0x211817(0x637),'price':4.8,'options':{'weight':[_0x211817(0xd8a),_0x211817(0x17fb),_0x211817(0x1b4e)]}},{'name':_0x211817(0xf40),'brand':_0x211817(0x8a4),'price':0x6,'options':{'weight':[_0x211817(0x1f1d),_0x211817(0x129e)]}},{'name':_0x211817(0x187d),'brand':'佳沛','price':0x1c,'options':{'count':['6个','12个'],'type':['绿心','黄心','红心']}},{'name':'有机茄子','brand':_0x211817(0x4f8),'price':7.5,'options':{'weight':['500g',_0x211817(0xd8a)],'type':[_0x211817(0x1a02),_0x211817(0x1d4c)]}},{'name':_0x211817(0x5d3),'brand':_0x211817(0xd72),'price':0x16,'options':{'weight':[_0x211817(0x129e),'1kg'],'type':['红提','青提','巨峰']}},{'name':_0x211817(0x9b2),'brand':_0x211817(0x1b3c),'price':0xc,'options':{'weight':[_0x211817(0x1f1d),_0x211817(0x129e)]}},{'name':_0x211817(0x128c),'brand':_0x211817(0x890),'price':8.8,'options':{'count':['3个','6个',_0x211817(0x193)]}},{'name':'进口蓝莓','brand':'智利蓝莓','price':0x23,'options':{'weight':['125g','250g']}},{'name':_0x211817(0x508),'brand':_0x211817(0x8a4),'price':5.5,'options':{'weight':[_0x211817(0x1f1d),_0x211817(0x129e)],'type':['球生菜',_0x211817(0xf45)]}}],'看病买药':[{'name':_0x211817(0x48e),'brand':_0x211817(0x2111),'price':18.5,'options':{'package':[_0x211817(0x21ad),_0x211817(0x1403),_0x211817(0x20b9)]}},{'name':_0x211817(0xfb9),'brand':_0x211817(0x365),'price':0xf,'options':{'package':[_0x211817(0x1d3f),_0x211817(0xe41)]}},{'name':'维生素C','brand':_0x211817(0x16eb),'price':0x44,'options':{'count':[_0x211817(0x1d84),_0x211817(0xffd)],'type':[_0x211817(0x1bd1),_0x211817(0xa60)]}},{'name':_0x211817(0x79c),'brand':'邦迪','price':0xc,'options':{'size':[_0x211817(0x1cf8),'大号',_0x211817(0x5f6)],'count':[_0x211817(0x44a),'20片']}},{'name':_0x211817(0xc90),'brand':_0x211817(0x13b3),'price':0x55,'options':{'type':[_0x211817(0x15f0),_0x211817(0x395)]}},{'name':'碘伏','brand':'利康','price':8.5,'options':{'volume':[_0x211817(0x679),_0x211817(0x2110),'100ml']}},{'name':'止痛片','brand':_0x211817(0x1e2b),'price':0x19,'options':{'count':[_0x211817(0xda2),'24片']}},{'name':'胃药','brand':'达喜','price':0x20,'options':{'count':[_0x211817(0x23c),_0x211817(0x18c0)]}},{'name':'眼药水','brand':'珍视明','price':0x12,'options':{'volume':[_0x211817(0x270),_0x211817(0xc8e)],'type':[_0x211817(0x734),_0x211817(0x15b4)]}},{'name':'口罩','brand':'3M','price':0x2d,'options':{'type':[_0x211817(0xc43),_0x211817(0x1898)],'count':[_0x211817(0x193),_0x211817(0xe54)]}},{'name':'血压计','brand':'欧姆龙','price':0x12a,'options':{'type':[_0x211817(0x1eec),_0x211817(0xa22)]}},{'name':'钙片','brand':_0x211817(0x1405),'price':0x58,'options':{'count':[_0x211817(0x1d84),_0x211817(0xffd)],'type':['碳酸钙','柠檬酸钙']}},{'name':_0x211817(0x1533),'brand':'滴露','price':0x16,'options':{'volume':[_0x211817(0x9a0),'1L'],'type':['衣物消毒',_0x211817(0x1d52)]}},{'name':'纱布','brand':'振德','price':0xf,'options':{'size':['5cm×5m',_0x211817(0x16c5)],'type':['无菌','普通']}},{'name':_0x211817(0x3f6),'brand':'美林','price':0x1c,'options':{'type':[_0x211817(0x21c2),'成人装'],'volume':[_0x211817(0x22ec),_0x211817(0x1353)]}},{'name':_0x211817(0x14e4),'brand':'葵花','price':0x2d,'options':{'count':[_0x211817(0xf8a),_0x211817(0x171e)]}},{'name':_0x211817(0x1031),'brand':_0x211817(0xf83),'price':0x18,'options':{'volume':[_0x211817(0x22ec),_0x211817(0x1353)]}},{'name':'胰岛素笔','brand':_0x211817(0x775),'price':0xb4,'options':{'type':['速效','长效']}},{'name':'血糖试纸','brand':'强生','price':0x78,'options':{'count':['25片',_0x211817(0x27e)]}},{'name':_0x211817(0x376),'brand':_0x211817(0x1e2c),'price':0x4e,'options':{'count':[_0x211817(0x925),_0x211817(0x208b)],'strength':['400IU',_0x211817(0x143a)]}}],'数码产品':[{'name':_0x211817(0x398),'brand':'Apple','price':0x176f,'options':{'storage':[_0x211817(0x1d73),_0x211817(0x100e),_0x211817(0x1d63)],'color':['黑色','白色','蓝色','粉色']}},{'name':'小米13','brand':'小米','price':0xf9f,'options':{'storage':['128GB',_0x211817(0x100e)],'color':['黑色','白色','绿色']}},{'name':_0x211817(0x1e55),'brand':'Apple','price':0x2327,'options':{'chip':['M2','M3'],'storage':['256GB',_0x211817(0x1d63),_0x211817(0x2204)],'color':['银色',_0x211817(0x675),_0x211817(0xe86)]}},{'name':_0x211817(0x1ee7),'brand':'华为','price':0x1188,'options':{'storage':[_0x211817(0x1d73),_0x211817(0x100e),_0x211817(0x1d63)],'color':['黑色','白色','紫色']}},{'name':_0x211817(0x2158),'brand':_0x211817(0x2226),'price':0x1a8f,'options':{'size':[_0x211817(0x1d28),_0x211817(0x241)],'storage':[_0x211817(0x1d73),_0x211817(0x100e),_0x211817(0x1d63),_0x211817(0x2204)]}},{'name':_0x211817(0x19f4),'brand':_0x211817(0x2226),'price':0x76b,'options':{'generation':['第二代','第三代']}},{'name':_0x211817(0x15e0),'brand':'Dell','price':0x1f3f,'options':{'processor':['i5','i7'],'ram':[_0x211817(0x21b0),_0x211817(0xc9d),_0x211817(0x33e)],'storage':['256GB',_0x211817(0x1d63),'1TB']}},{'name':_0x211817(0x65d),'brand':_0x211817(0x16dc),'price':0x95f,'options':{'color':['黑色','银色']}},{'name':_0x211817(0xcbf),'brand':_0x211817(0x14e3),'price':0x833,'options':{'type':['标准版',_0x211817(0x207b)],'color':['红蓝','灰色','白色']}},{'name':_0x211817(0x17f1),'brand':'小米','price':0x12b,'options':{'color':['黑色','蓝色','粉色'],'strap':[_0x211817(0xbca),'皮质表带']}},{'name':'Kindle','brand':'Amazon','price':0x383,'options':{'storage':[_0x211817(0x21b0),_0x211817(0x33e)],'type':[_0x211817(0x21a7),'Paperwhite',_0x211817(0x1d09)]}},{'name':_0x211817(0x1fc9),'brand':'罗技','price':0x12b,'options':{'type':['有线','无线'],'dpi':[_0x211817(0x6a6),_0x211817(0x1d11),_0x211817(0x1469)]}},{'name':_0x211817(0x97a),'brand':'雷蛇','price':0x383,'options':{'switch':['青轴','红轴','茶轴'],'backlight':[_0x211817(0x164f),_0x211817(0x3f5)]}},{'name':_0x211817(0x121c),'brand':_0x211817(0x1902),'price':0x257,'options':{'capacity':[_0x211817(0x2204),_0x211817(0x25b),'4TB'],'type':[_0x211817(0x1781),_0x211817(0x22a6)]}},{'name':_0x211817(0x1ad0),'brand':'小米','price':0x95,'options':{'capacity':[_0x211817(0xf75),'20000mAh'],'type':[_0x211817(0x6e3),_0x211817(0x141d)]}},{'name':_0x211817(0xb45),'brand':_0x211817(0x10bf),'price':0x2bb,'options':{'size':[_0x211817(0xf12),'标准版'],'color':['黑色','蓝色','红色']}},{'name':_0x211817(0x278),'brand':_0x211817(0x1db4),'price':0xbb7,'options':{'size':[_0x211817(0x79b),_0x211817(0x1ee4)],'band':[_0x211817(0xbca),_0x211817(0x1865),_0x211817(0x15d4)]}},{'name':'无线充电器','brand':_0x211817(0x853),'price':0x12b,'options':{'power':['5W',_0x211817(0x343),_0x211817(0x1e46)],'type':['立式',_0x211817(0x1862)]}},{'name':_0x211817(0x197a),'brand':'罗技','price':0x257,'options':{'resolution':[_0x211817(0x1f12),'4K'],'type':['普通版',_0x211817(0x2302)]}},{'name':'路由器','brand':'华硕','price':0x383,'options':{'speed':['AC1200',_0x211817(0x88c),_0x211817(0xe84)],'antenna':['2天线',_0x211817(0x1428),'6天线']}}],'家居百货':[{'name':_0x211817(0x187f),'brand':_0x211817(0x199f),'price':0x12b,'options':{'height':['低枕','中枕','高枕'],'hardness':['软','中等','硬']}},{'name':_0x211817(0xf5e),'brand':'水星家纺','price':0x18f,'options':{'size':[_0x211817(0x1fe7),_0x211817(0x15b0),'2.0m床'],'material':['纯棉','天丝','真丝']}},{'name':'电饭煲','brand':'美的','price':0x257,'options':{'capacity':['3L','4L','5L'],'type':['普通版',_0x211817(0x17a7)]}},{'name':_0x211817(0x1fa8),'brand':'戴森','price':0xbb7,'options':{'type':[_0x211817(0x1056),'立式',_0x211817(0x7bb)],'power':[_0x211817(0x21a7),_0x211817(0xf4d)]}},{'name':_0x211817(0x1a03),'brand':'小米','price':0x513,'options':{'coverage':[_0x211817(0xb27),_0x211817(0x185b),'80㎡'],'filter':[_0x211817(0x1c15),'HEPA滤网']}},{'name':'台灯','brand':'飞利浦','price':0x12b,'options':{'type':['护眼灯',_0x211817(0x1454)],'brightness':[_0x211817(0x2181),_0x211817(0x1760)]}},{'name':_0x211817(0x1bc1),'brand':'膳魔师','price':0xc7,'options':{'capacity':[_0x211817(0x1932),_0x211817(0x9a0),_0x211817(0x32a)],'color':['黑色','白色','蓝色','粉色']}},{'name':'毛巾','brand':'洁丽雅','price':0x27,'options':{'size':['面巾','浴巾'],'material':['纯棉',_0x211817(0x14bb)],'color':['白色','蓝色','粉色']}},{'name':_0x211817(0x155b),'brand':'拓牌','price':0x59,'options':{'capacity':['8L','12L',_0x211817(0x1097)],'type':[_0x211817(0xf5f),'感应式']}},{'name':_0x211817(0x15c7),'brand':_0x211817(0x21d3),'price':0x3b,'options':{'size':['小号','中号','大号'],'material':['塑料','布艺'],'color':['透明','白色','灰色']}},{'name':'拖鞋','brand':_0x211817(0x523),'price':0x1d,'options':{'size':[_0x211817(0xab9),_0x211817(0xb2f),_0x211817(0x706),_0x211817(0x318)],'type':[_0x211817(0xa2e),'浴室拖鞋']}},{'name':'衣架','brand':'太力','price':0x19,'options':{'material':['塑料',_0x211817(0x7cc)],'type':[_0x211817(0x10a4),_0x211817(0xfb2)],'count':[_0x211817(0x193),'20个',_0x211817(0xe54)]}},{'name':_0x211817(0xb42),'brand':_0x211817(0x225d),'price':0x2d,'options':{'volume':[_0x211817(0xd8a),_0x211817(0x17fb),_0x211817(0x63a)],'type':[_0x211817(0x78e),'护色',_0x211817(0x1eee)]}},{'name':'纸巾','brand':'维达','price':0x23,'options':{'type':['抽纸','卷纸'],'layers':['3层','4层'],'count':[_0x211817(0x10e3),_0x211817(0x10a8)]}},{'name':_0x211817(0x18c),'brand':'立白','price':0x12,'options':{'volume':[_0x211817(0x9a0),'1L','2L'],'type':['普通','柠檬香','芦荟']}},{'name':'床垫','brand':'慕思','price':0xbb7,'options':{'size':[_0x211817(0x6db),'1.8m','2.0m'],'type':[_0x211817(0x7f6),'乳胶床垫',_0x211817(0x1c19)]}},{'name':'窗帘','brand':_0x211817(0x1cda),'price':0x12b,'options':{'size':[_0x211817(0x43e),_0x211817(0x176f),_0x211817(0x287)],'material':['棉麻','雪尼尔',_0x211817(0x1229)]}},{'name':'地毯','brand':'山花','price':0xc7,'options':{'size':[_0x211817(0x1460),_0x211817(0x1c94),_0x211817(0x1044)],'material':['化纤','羊毛']}},{'name':'花洒','brand':'九牧','price':0x18f,'options':{'type':[_0x211817(0x16f3),_0x211817(0x1290)],'function':['普通','按摩','节水']}},{'name':_0x211817(0x11c3),'brand':'好人','price':0x19,'options':{'type':['普通刷','一次性刷头'],'handle':['长柄','短柄']}}],'女装男装':[{'name':_0x211817(0x7e0),'brand':_0x211817(0x215b),'price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','蓝色','红色'],'style':['A字裙',_0x211817(0x1418)]}},{'name':_0x211817(0x218f),'brand':_0x211817(0xafa),'price':0x257,'options':{'size':['28','29','30','31','32','33','34'],'color':['深蓝','浅蓝','黑色'],'fit':['修身','直筒','宽松']}},{'name':'T恤','brand':_0x211817(0x1c08),'price':0x63,'options':{'size':['S','M','L','XL',_0x211817(0x109d)],'color':['白色','黑色','灰色','蓝色','红色'],'sleeve':['短袖','长袖']}},{'name':'西装','brand':_0x211817(0x22cb),'price':0xbb7,'options':{'size':['46','48','50','52','54'],'color':['黑色','深蓝','灰色'],'style':['修身','经典']}},{'name':'羽绒服','brand':_0x211817(0xb13),'price':0x1387,'options':{'size':['S','M','L','XL'],'color':['黑色','军绿',_0x211817(0x1ec3)],'length':['短款',_0x211817(0x82c),'长款']}},{'name':'毛衣','brand':_0x211817(0x11d2),'price':0xc7,'options':{'size':['S','M','L','XL'],'color':['米色','灰色','黑色','红色'],'material':['羊毛','棉质','混纺']}},{'name':'衬衫','brand':'CK','price':0x18f,'options':{'size':['S','M','L','XL',_0x211817(0x109d)],'color':['白色','蓝色','粉色'],'collar':['尖领','圆领'],'sleeve':['长袖','短袖']}},{'name':'短裤','brand':_0x211817(0x473),'price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','灰色','蓝色'],'length':['5分','7分'],'type':['运动','休闲']}},{'name':'裙子','brand':'Only','price':0x103,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','花色'],'length':['短裙','中裙','长裙']}},{'name':'外套','brand':_0x211817(0x1081),'price':0x2bb,'options':{'size':['S','M','L','XL',_0x211817(0x109d)],'color':['黑色','白色','蓝色'],'type':['夹克','卫衣','风衣']}},{'name':'内衣','brand':_0x211817(0x2278),'price':0xc7,'options':{'size':['70A','70B','75A',_0x211817(0x276),'80A','80B'],'color':['黑色','白色','肉色'],'type':[_0x211817(0xcf6),_0x211817(0xf99)]}},{'name':'内裤','brand':'CK','price':0x59,'options':{'size':['S','M','L','XL'],'color':['黑色','白色','灰色'],'type':['三角','平角'],'count':['1条','3条装']}},{'name':'袜子','brand':'浪莎','price':0x19,'options':{'size':['均码'],'color':['黑色','白色','灰色','肉色'],'type':['短袜',_0x211817(0xd06),'长筒袜'],'count':['1双',_0x211817(0x1aec)]}},{'name':'睡衣','brand':_0x211817(0x1df1),'price':0x9f,'options':{'size':['S','M','L','XL'],'color':['粉色','蓝色','白色'],'material':['纯棉','丝绸',_0x211817(0x80a)],'style':['套装','连体']}},{'name':_0x211817(0x223a),'brand':_0x211817(0x1df7),'price':0x257,'options':{'size':['S','M','L','XL',_0x211817(0x109d)],'color':['黑色','灰色','蓝色'],'type':['套装','单件'],'function':['速干','保暖']}},{'name':'泳衣','brand':'Speedo','price':0x12b,'options':{'size':['S','M','L','XL'],'color':['黑色','蓝色','红色'],'type':['连体','分体'],'style':['运动','休闲']}},{'name':'围巾','brand':'Burberry','price':0x513,'options':{'material':['羊毛','羊绒','丝绸'],'color':[_0x211817(0x1351),'纯色'],'size':['标准','加长']}},{'name':'帽子','brand':'New\x20Era','price':0xc7,'options':{'type':[_0x211817(0x22dd),'针织帽','渔夫帽'],'color':['黑色','白色','蓝色','红色'],'size':['均码',_0x211817(0x8a3)]}},{'name':'手套','brand':'The\x20North\x20Face','price':0xc7,'options':{'size':['S','M','L'],'color':['黑色','灰色','蓝色'],'type':[_0x211817(0x22a1),_0x211817(0x10d3)],'material':['羊毛','抓绒']}},{'name':'腰带','brand':_0x211817(0x1ce7),'price':0xbb7,'options':{'size':[_0x211817(0x1067),_0x211817(0xbdb),_0x211817(0xc96),_0x211817(0xba3),_0x211817(0xb40)],'color':['黑色','棕色'],'material':['真皮','帆布'],'buckle':['金扣','银扣']}}],'饰品箱包':[{'name':_0x211817(0x499),'brand':'LV','price':0x3e7f,'options':{'size':['小号','中号','大号'],'color':[_0x211817(0x1855),'黑色','白色'],'material':['帆布','真皮']}},{'name':_0x211817(0x18d5),'brand':_0x211817(0xcd3),'price':0x2bb,'options':{'size':[_0x211817(0x224f),_0x211817(0x1097),_0x211817(0xb39)],'color':['黑色','灰色','蓝色','红色'],'material':['帆布','尼龙']}},{'name':'钱包','brand':_0x211817(0x1be3),'price':0x513,'options':{'type':['长款','短款'],'color':['黑色','棕色','红色'],'material':['真皮','帆布']}},{'name':'手表','brand':_0x211817(0x1dcd),'price':0x15f8f,'options':{'type':[_0x211817(0x1553),'石英表'],'material':[_0x211817(0x7cc),'黄金',_0x211817(0x1de4)],'size':[_0x211817(0x1408),_0x211817(0x75e)]}},{'name':'项链','brand':_0x211817(0x3de),'price':0xf9f,'options':{'material':['银','金','铂金'],'length':['40cm',_0x211817(0x1270),'50cm'],'style':['简约','镶钻']}},{'name':'耳环','brand':'Pandora','price':0x257,'options':{'type':['耳钉','耳环','耳夹'],'material':['银','金'],'style':['简约','镶钻','珍珠']}},{'name':'戒指','brand':_0x211817(0xc5c),'price':0x2327,'options':{'size':['6号','7号','8号','9号',_0x211817(0x1b59)],'material':['银','金','铂金'],'style':['简约','镶钻']}},{'name':'手镯','brand':_0x211817(0xda5),'price':0xbb7,'options':{'material':['银','金','玉'],'style':['简约','雕花','镶钻'],'size':['标准','加大']}},{'name':_0x211817(0x1cb1),'brand':_0x211817(0x1ca3),'price':0x513,'options':{'style':[_0x211817(0x18b8),'方框','圆框'],'color':['黑色','棕色','蓝色'],'lens':['偏光','普通']}},{'name':'丝巾','brand':_0x211817(0x1bb0),'price':0xbb7,'options':{'size':[_0x211817(0xab7),_0x211817(0x185)],'color':['经典橙','蓝色','粉色'],'material':['真丝','羊绒']}},{'name':'发夹','brand':_0x211817(0x1d77),'price':0x12b,'options':{'type':['发卡','发箍','发绳'],'color':['金色','银色','玫瑰金'],'style':['简约','镶钻']}},{'name':'胸针','brand':_0x211817(0x14df),'price':0x1387,'options':{'material':['金属','珍珠'],'style':[_0x211817(0x1b3a),'花朵','动物'],'color':['金色','银色']}},{'name':_0x211817(0x2272),'brand':_0x211817(0x7d1),'price':0x7cf,'options':{'size':['20寸',_0x211817(0x10b7),'28寸'],'color':['黑色','银色','蓝色'],'type':['硬壳','软壳'],'wheels':[_0x211817(0x1ab3),'定向轮']}},{'name':_0x211817(0x11e4),'brand':_0x211817(0xfe8),'price':0x383,'options':{'size':['小号','中号','大号'],'color':['黑色','粉色','白色'],'material':['皮质','帆布']}},{'name':_0x211817(0xd94),'brand':_0x211817(0x8f0),'price':0x257,'options':{'material':['金属','皮质'],'color':['黑色','银色','金色'],'style':['简约',_0x211817(0x13fe)]}},{'name':'手机壳','brand':'Apple','price':0x18f,'options':{'model':[_0x211817(0xe63),_0x211817(0x398)],'color':['透明','黑色','白色','蓝色'],'material':['硅胶','皮质','透明']}},{'name':_0x211817(0x1c67),'brand':'周生生','price':0x12b,'options':{'size':['小号','中号','大号'],'color':['红色','黑色','白色'],'material':['绒布','皮质']}},{'name':'香水','brand':_0x211817(0xe04),'price':0x383,'options':{'volume':[_0x211817(0x679),_0x211817(0x1c84),_0x211817(0x22ec)],'type':[_0x211817(0x1233),'香水'],'packaging':[_0x211817(0x21c),_0x211817(0x25f)]}},{'name':'口红','brand':_0x211817(0x697),'price':0x12b,'options':{'color':['正红','玫红','橘红',_0x211817(0x2e2)],'finish':['哑光','丝绒','水润'],'series':['方管','圆管']}},{'name':_0x211817(0x11cc),'brand':_0x211817(0x22d5),'price':0x59,'options':{'color':['红色','粉色','蓝色','黑色','透明'],'finish':['普通','珠光','哑光'],'volume':['15ml','30ml']}}]};function showCategoryProducts(_0x211a3a){const _0x3323b0=_0x211817,_0x12875f=document[_0x3323b0(0x1262)](_0x3323b0(0x1692)),_0x5191f9=document[_0x3323b0(0x1262)](_0x3323b0(0x169d)),_0x54268d=document['querySelector'](_0x3323b0(0xd7a)),_0x502228=document[_0x3323b0(0xb30)](_0x3323b0(0x219c)),_0x265382=document[_0x3323b0(0x1262)]('products-grid'),_0xb90b57=document['querySelector']('.shopping-content');_0x12875f[_0x3323b0(0x14eb)]['display']=_0x3323b0(0x102b),_0x54268d[_0x3323b0(0x14eb)][_0x3323b0(0x4da)]=_0x3323b0(0x102b),_0x5191f9['style'][_0x3323b0(0x4da)]=_0x3323b0(0x13de),_0xb90b57[_0x3323b0(0x1c1b)][_0x3323b0(0x21e2)](_0x3323b0(0x831)),_0x502228[_0x3323b0(0x13be)]=_0x211a3a,_0x265382[_0x3323b0(0x33a)]='';const _0x1c4eb6=productsData[_0x211a3a]||[];_0x1c4eb6['forEach']((_0x261e4c,_0x121c3d)=>{const _0x1c2cd3=_0x3323b0,_0x500e98=_0x261e4c['prices']&&Object[_0x1c2cd3(0x1c9f)](_0x261e4c[_0x1c2cd3(0x1f8f)])[_0x1c2cd3(0x19ee)]>0x0,_0x3f1e8c=_0x500e98?'¥'+_0x261e4c[_0x1c2cd3(0x644)]+'起':'¥'+_0x261e4c['price'],_0x49f028='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-name\x22>'+_0x261e4c[_0x1c2cd3(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-brand\x22>'+_0x261e4c['brand']+_0x1c2cd3(0x9bd)+_0x3f1e8c+_0x1c2cd3(0x15f2)+_0x211a3a+'\x27,\x20'+_0x121c3d+')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20加入购物车\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x265382[_0x1c2cd3(0x33a)]+=_0x49f028;});}function backToCategories(){const _0x36c51a=_0x211817,_0x5e0db2=document[_0x36c51a(0x1262)](_0x36c51a(0x1692)),_0x39b537=document['getElementById'](_0x36c51a(0x169d)),_0x2bfc79=document[_0x36c51a(0xb30)]('.shopping-search-container'),_0x41a8a8=document[_0x36c51a(0xb30)](_0x36c51a(0x219c)),_0x30548e=document[_0x36c51a(0xb30)](_0x36c51a(0x4ba));_0x5e0db2['style'][_0x36c51a(0x4da)]=_0x36c51a(0x13de),_0x2bfc79[_0x36c51a(0x14eb)][_0x36c51a(0x4da)]=_0x36c51a(0x1fb7),_0x39b537['style']['display']=_0x36c51a(0x102b),_0x30548e[_0x36c51a(0x1c1b)][_0x36c51a(0x1493)]('showing-products');const _0x3195c7=document['querySelector'](_0x36c51a(0xafd));_0x3195c7&&_0x3195c7['textContent'][_0x36c51a(0x19d7)]()==='外卖'?_0x41a8a8[_0x36c51a(0x13be)]='外卖':_0x41a8a8[_0x36c51a(0x13be)]='购物';}function handleShoppingBack(){const _0x1ea6d1=_0x211817,_0x17b8da=document['getElementById'](_0x1ea6d1(0x169d));_0x17b8da[_0x1ea6d1(0x14eb)]['display']===_0x1ea6d1(0x13de)?backToCategories():(hideApp('shopping-screen'),showApp(previousScreenBeforeShopping));}let shoppingCart=[];function addToCart(_0x568d43,_0x56f3ab){const _0x36d9f5=_0x211817,_0x2adfab=productsData[_0x568d43][_0x56f3ab];if(!_0x2adfab)return;if(_0x2adfab[_0x36d9f5(0x4cd)]&&Object[_0x36d9f5(0x1c9f)](_0x2adfab[_0x36d9f5(0x4cd)])[_0x36d9f5(0x19ee)]>0x0)showProductOptions(_0x568d43,_0x56f3ab);else{const _0x5db755=shoppingCart[_0x36d9f5(0x150c)](_0x2fde0a=>_0x2fde0a[_0x36d9f5(0x1a1c)]===_0x2adfab[_0x36d9f5(0x1a1c)]&&_0x2fde0a[_0x36d9f5(0xb4e)]===_0x2adfab[_0x36d9f5(0xb4e)]&&Object['keys'](_0x2fde0a['selectedOptions']||{})[_0x36d9f5(0x19ee)]===0x0);if(_0x5db755!==-0x1)shoppingCart[_0x5db755][_0x36d9f5(0xb8d)]+=0x1;else{const _0x2abafa=getProductPrice(_0x2adfab,{}),_0x1d6d4c={'name':_0x2adfab[_0x36d9f5(0x1a1c)],'brand':_0x2adfab[_0x36d9f5(0xb4e)],'price':_0x2abafa,'category':_0x568d43,'selectedOptions':{},'quantity':0x1};shoppingCart['push'](_0x1d6d4c);}updateCartBadge(getTotalCartItems()),showCustomToast(_0x2adfab[_0x36d9f5(0x1a1c)]+'\x20已添加到购物车',_0x36d9f5(0x11cb));}}function showProductOptions(_0x2ecd3e,_0x5f05f5){const _0x1fb3f8=_0x211817,_0x5012a0=productsData[_0x2ecd3e][_0x5f05f5];let _0x2adb4e='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22position:\x20fixed;\x20top:\x200;\x20left:\x200;\x20width:\x20100%;\x20height:\x20100%;\x20background:\x20rgba(0,0,0,0.5);\x20z-index:\x2010000;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x22\x20onclick=\x22closeProductOptions(event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20white;\x20border-radius:\x2015px;\x20padding:\x2020px;\x20max-width:\x20350px;\x20width:\x2090%;\x20max-height:\x2080vh;\x20overflow-y:\x20auto;\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200\x200\x2015px\x200;\x20color:\x20#333;\x22>'+_0x5012a0[_0x1fb3f8(0x1a1c)]+_0x1fb3f8(0x645)+_0x5012a0[_0x1fb3f8(0xb4e)]+_0x1fb3f8(0x137c)+_0x5012a0['price']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22product-options-form\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x259a1f,_0x2798b7]of Object['entries'](_0x5012a0[_0x1fb3f8(0x4cd)])){const _0x9472ce=getOptionLabel(_0x259a1f);_0x2adb4e+=_0x1fb3f8(0x1a5c)+_0x9472ce+':</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22option-'+_0x259a1f+_0x1fb3f8(0x18e1)+_0x2ecd3e+'\x27,\x20'+_0x5f05f5+_0x1fb3f8(0x1e86),_0x2798b7[_0x1fb3f8(0x19fb)](_0x203e54=>{const _0x4e35d7=_0x1fb3f8;_0x2adb4e+='<option\x20value=\x22'+_0x203e54+'\x22>'+_0x203e54+_0x4e35d7(0x109e);}),_0x2adb4e+=_0x1fb3f8(0xebd);}_0x2adb4e+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22closeProductOptions()\x22\x20style=\x22flex:\x201;\x20padding:\x2012px;\x20background:\x20#f0f0f0;\x20border:\x20none;\x20border-radius:\x208px;\x20color:\x20#666;\x20font-weight:\x20600;\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22confirmAddToCart(\x27'+_0x2ecd3e+_0x1fb3f8(0x798)+_0x5f05f5+')\x22\x20style=\x22flex:\x201;\x20padding:\x2012px;\x20background:\x20#5a92c5;\x20border:\x20none;\x20border-radius:\x208px;\x20color:\x20white;\x20font-weight:\x20600;\x22>加入购物车</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x1fb3f8(0x1da9)][_0x1fb3f8(0x1b7)](_0x1fb3f8(0x42e),_0x2adb4e);}function getOptionLabel(_0x29196c){const _0x467feb=_0x211817,_0x5567c6={'size':'尺寸','color':'颜色','sugar':'糖度','ice':'冰度','spicy':'辣度','flavor':'口味','count':'数量','weight':'重量','type':'类型','storage':'存储','material':'材质','style':'款式','volume':'容量','package':'包装','capacity':'容量','strength':'强度','noodle':'面条','soup':'汤底','ingredients':'配料','ripeness':_0x467feb(0x6e2),'toppings':'配菜','finish':'质地','series':'系列','model':'型号','chip':'芯片','processor':_0x467feb(0x17f0),'ram':'内存','generation':'代数','switch':'轴体','backlight':'背光','dpi':_0x467feb(0xba4),'power':'功率','resolution':_0x467feb(0x1386),'antenna':'天线','speed':'速度','hardness':_0x467feb(0x177f),'layers':'层数','function':'功能','coverage':_0x467feb(0x226a),'filter':'滤网','brightness':'亮度','fit':'版型','sleeve':'袖长','collar':'领型','length':'长度','buckle':'扣子','lens':'镜片','wheels':'轮子','packaging':'包装','handle':'手柄'};return _0x5567c6[_0x29196c]||_0x29196c;}function confirmAddToCart(_0x3fdcac,_0x5daf46){const _0x17d595=_0x211817,_0x842047=productsData[_0x3fdcac][_0x5daf46],_0x405787={};for(const _0x253f5e of Object['keys'](_0x842047[_0x17d595(0x4cd)])){const _0x5e9293=document[_0x17d595(0x1262)](_0x17d595(0x19ad)+_0x253f5e);_0x5e9293&&(_0x405787[_0x253f5e]=_0x5e9293['value']);}const _0x3a4097=shoppingCart[_0x17d595(0x150c)](_0x1b4881=>_0x1b4881['name']===_0x842047[_0x17d595(0x1a1c)]&&_0x1b4881[_0x17d595(0xb4e)]===_0x842047[_0x17d595(0xb4e)]&&JSON[_0x17d595(0x6b8)](_0x1b4881[_0x17d595(0xabc)])===JSON['stringify'](_0x405787));if(_0x3a4097!==-0x1)shoppingCart[_0x3a4097][_0x17d595(0xb8d)]+=0x1;else{const _0x282cd7=getProductPrice(_0x842047,_0x405787),_0x329c9d={'name':_0x842047[_0x17d595(0x1a1c)],'brand':_0x842047[_0x17d595(0xb4e)],'price':_0x282cd7,'category':_0x3fdcac,'selectedOptions':_0x405787,'quantity':0x1};shoppingCart['push'](_0x329c9d);}updateCartBadge(getTotalCartItems()),closeProductOptions();const _0x1d0d68=Object[_0x17d595(0x2bc)](_0x405787)[_0x17d595(0x6a4)](([_0x46bed7,_0x490aba])=>getOptionLabel(_0x46bed7)+':\x20'+_0x490aba)[_0x17d595(0x122b)](',\x20'),_0x4cf7c6=_0x1d0d68?'\x20('+_0x1d0d68+')':'';showCustomToast(''+_0x842047['name']+_0x4cf7c6+_0x17d595(0x1411),_0x17d595(0x11cb));}function closeProductOptions(_0x3812c5){const _0x102975=_0x211817;if(_0x3812c5&&_0x3812c5[_0x102975(0x193d)]!==_0x3812c5[_0x102975(0x1fac)])return;const _0xfb47b6=document[_0x102975(0xb30)]('[style*=\x22position:\x20fixed\x22][style*=\x22z-index:\x2010000\x22]');_0xfb47b6&&_0xfb47b6['remove']();}function addCustomItem(){showCustomItemModal();}function showCustomItemModal(){const _0x1e3b6c=_0x211817,_0x2b6ea7=document[_0x1e3b6c(0x1262)](_0x1e3b6c(0x1ae1)),_0x98af74=document['getElementById'](_0x1e3b6c(0x574)),_0xea6312=document[_0x1e3b6c(0x1262)](_0x1e3b6c(0x1ec)),_0x4ce99f=document['getElementById']('custom-item-price');_0x98af74[_0x1e3b6c(0x1ebc)]='',_0xea6312[_0x1e3b6c(0x1ebc)]='',_0x4ce99f[_0x1e3b6c(0x1ebc)]='',_0x2b6ea7[_0x1e3b6c(0x14eb)][_0x1e3b6c(0x4da)]='flex',setTimeout(()=>{const _0x10e425=_0x1e3b6c;_0x98af74[_0x10e425(0x13cf)]();},0x64);}function hideCustomItemModal(_0x32b33c){const _0xd3cc42=_0x211817;if(_0x32b33c&&_0x32b33c[_0xd3cc42(0x193d)]!==_0x32b33c[_0xd3cc42(0x1fac)])return;const _0x3ea769=document[_0xd3cc42(0x1262)]('custom-item-modal');_0x3ea769[_0xd3cc42(0x14eb)][_0xd3cc42(0x4da)]=_0xd3cc42(0x102b);}function confirmAddCustomItem(){const _0x3df01d=_0x211817,_0x4ad4db=document['getElementById']('custom-item-name'),_0x3998d5=document['getElementById']('custom-item-description'),_0x4838fd=document['getElementById'](_0x3df01d(0x1b7f)),_0x1510d1=_0x4ad4db[_0x3df01d(0x1ebc)][_0x3df01d(0x19d7)](),_0x19bc07=_0x3998d5['value'][_0x3df01d(0x19d7)](),_0xfd561a=_0x4838fd[_0x3df01d(0x1ebc)][_0x3df01d(0x19d7)]();if(!_0x1510d1){showCustomToast(_0x3df01d(0x4ad),_0x3df01d(0x174a)),_0x4ad4db[_0x3df01d(0x13cf)]();return;}if(!_0xfd561a||isNaN(_0xfd561a)||parseFloat(_0xfd561a)<=0x0){showCustomToast(_0x3df01d(0x10e9),'error'),_0x4838fd[_0x3df01d(0x13cf)]();return;}const _0x5c9aea=shoppingCart[_0x3df01d(0x150c)](_0x3dac01=>_0x3dac01['name']===_0x1510d1&&_0x3dac01[_0x3df01d(0xb4e)]===_0x3df01d(0x1d45));if(_0x5c9aea!==-0x1)shoppingCart[_0x5c9aea][_0x3df01d(0xb8d)]+=0x1;else{const _0x46eca0={'name':_0x1510d1,'brand':'自定义','description':_0x19bc07||'','unit':'','price':parseFloat(_0xfd561a),'category':_0x3df01d(0x1d45),'selectedOptions':{},'quantity':0x1};shoppingCart[_0x3df01d(0x1cd6)](_0x46eca0);}updateCartBadge(getTotalCartItems()),showCustomToast(_0x1510d1+'\x20已添加到购物车',_0x3df01d(0x11cb)),hideCustomItemModal();}function handleCustomItemKeydown(_0xc05e34){const _0x12cdd9=_0x211817;if(_0xc05e34[_0x12cdd9(0x213c)]==='Enter')_0xc05e34['preventDefault'](),confirmAddCustomItem();else _0xc05e34[_0x12cdd9(0x213c)]==='Escape'&&(_0xc05e34[_0x12cdd9(0x36f)](),hideCustomItemModal());}let previousScreenBeforeCart=_0x211817(0x21da),previousScreenBeforeShopping=_0x211817(0x1c2a),selectedPaymentMethod=_0x211817(0x196d);function openShoppingScreen(){const _0x309b92=_0x211817,_0x58f231=document['querySelector'](_0x309b92(0x1cf1));_0x58f231&&(previousScreenBeforeShopping=_0x58f231['id']),showApp(_0x309b92(0x21da)),switchShoppingTab(_0x309b92(0x1563));}function openShoppingCart(){const _0x183de5=_0x211817,_0x45fa4f=document[_0x183de5(0xb30)](_0x183de5(0x1cf1));_0x45fa4f&&(previousScreenBeforeCart=_0x45fa4f['id']),showApp(_0x183de5(0x742)),renderShoppingCart();}function renderShoppingCart(){const _0x2aaf7c=_0x211817,_0x486ca9=document[_0x2aaf7c(0x1262)](_0x2aaf7c(0x2251)),_0x2cca17=document[_0x2aaf7c(0x1262)](_0x2aaf7c(0x1d0a)),_0x201895=document[_0x2aaf7c(0x1262)](_0x2aaf7c(0xa7f)),_0x467b8b=document[_0x2aaf7c(0x1262)](_0x2aaf7c(0x61f)),_0x31a97f=document[_0x2aaf7c(0x1262)](_0x2aaf7c(0x527));if(shoppingCart[_0x2aaf7c(0x19ee)]===0x0){_0x486ca9[_0x2aaf7c(0x14eb)][_0x2aaf7c(0x4da)]='none',_0x2cca17[_0x2aaf7c(0x14eb)]['display']='flex',_0x201895[_0x2aaf7c(0x14eb)][_0x2aaf7c(0x4da)]=_0x2aaf7c(0x102b);return;}_0x486ca9[_0x2aaf7c(0x14eb)][_0x2aaf7c(0x4da)]='block',_0x2cca17['style']['display']=_0x2aaf7c(0x102b),_0x201895['style'][_0x2aaf7c(0x4da)]='block',_0x486ca9['innerHTML']='';let _0x460913=0x0,_0x57e630=0x0;shoppingCart['forEach']((_0x325f82,_0x1b43d6)=>{const _0x48d1f9=_0x2aaf7c,_0x3a8154=_0x325f82['price']*_0x325f82[_0x48d1f9(0xb8d)];_0x460913+=_0x3a8154,_0x57e630+=_0x325f82['quantity'];const _0x762292=Object['entries'](_0x325f82[_0x48d1f9(0xabc)]||{})[_0x48d1f9(0x6a4)](([_0x566664,_0x13749])=>getOptionLabel(_0x566664)+':\x20'+_0x13749)[_0x48d1f9(0x122b)](',\x20');let _0x2a757b=_0x325f82['brand'];_0x325f82[_0x48d1f9(0xb4e)]!=='自定义'&&_0x325f82[_0x48d1f9(0x175c)]&&(_0x2a757b+=_0x48d1f9(0x1d1e)+_0x325f82[_0x48d1f9(0x175c)]);const _0x111cea='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-name\x22>'+_0x325f82[_0x48d1f9(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-brand\x22>'+_0x2a757b+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x325f82[_0x48d1f9(0x7c9)]?_0x48d1f9(0x18ac)+_0x325f82[_0x48d1f9(0x7c9)]+'</div>':'')+_0x48d1f9(0x137a)+(_0x762292?_0x48d1f9(0x10c4)+_0x762292+_0x48d1f9(0x1844):'')+_0x48d1f9(0x1758)+_0x1b43d6+_0x48d1f9(0x116c)+_0x3a8154['toFixed'](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-quantity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x22\x20onclick=\x22updateCartItemQuantity('+_0x1b43d6+',\x20'+(_0x325f82[_0x48d1f9(0xb8d)]-0x1)+_0x48d1f9(0x18ff)+(_0x325f82[_0x48d1f9(0xb8d)]<=0x1?_0x48d1f9(0x559):'')+_0x48d1f9(0xcac)+_0x325f82[_0x48d1f9(0xb8d)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22quantity-btn\x22\x20onclick=\x22updateCartItemQuantity('+_0x1b43d6+',\x20'+(_0x325f82[_0x48d1f9(0xb8d)]+0x1)+_0x48d1f9(0x6c7);_0x486ca9['innerHTML']+=_0x111cea;}),_0x467b8b[_0x2aaf7c(0x13be)]='¥'+_0x460913['toFixed'](0x2),_0x31a97f['textContent']=_0x57e630;}function removeFromCart(_0x485cba){const _0x26f05c=_0x211817,_0x290cbd=shoppingCart[_0x485cba],_0x4145af=_0x290cbd?_0x290cbd[_0x26f05c(0x1a1c)]:'商品';showCustomConfirm(_0x26f05c(0x4a7),'确定要移除\x20\x22'+_0x4145af+'\x22\x20吗？',()=>{const _0x1aefa4=_0x26f05c;shoppingCart[_0x1aefa4(0x19b2)](_0x485cba,0x1),renderShoppingCart(),updateCartBadge(getTotalCartItems()),showCustomToast(_0x1aefa4(0x743),_0x1aefa4(0x11cb));});}function updateCartItemQuantity(_0x6153c5,_0x350b5b){const _0xcb143f=_0x211817;if(_0x350b5b<=0x0){removeFromCart(_0x6153c5);return;}shoppingCart[_0x6153c5][_0xcb143f(0xb8d)]=_0x350b5b,renderShoppingCart(),updateCartBadge(getTotalCartItems());}function clearShoppingCart(){const _0x5c39cb=_0x211817;if(shoppingCart[_0x5c39cb(0x19ee)]===0x0)return;const _0x263a6d=getTotalCartItems();showCustomConfirm(_0x5c39cb(0xb00),_0x5c39cb(0x1818)+_0x263a6d+_0x5c39cb(0xf46),()=>{const _0x3eb660=_0x5c39cb;shoppingCart=[],renderShoppingCart(),updateCartBadge(0x0),showCustomToast(_0x3eb660(0x1414),_0x3eb660(0x11cb));});}function getTotalCartItems(){const _0x2d40d5=_0x211817;return shoppingCart[_0x2d40d5(0x1122)]((_0x56c705,_0x182d33)=>_0x56c705+_0x182d33[_0x2d40d5(0xb8d)],0x0);}function requestPayment(){const _0x2114b6=_0x211817;showRecipientModal(_0x2114b6(0x1d65));}function showRecipientModal(_0x23cb06){const _0x2ab818=_0x211817;if(shoppingCart['length']===0x0){showCustomToast('购物车是空的',_0x2ab818(0x174a));return;}if(!currentChatCharacter){showCustomToast(_0x2ab818(0x1f19),'error');return;}selectedPaymentMethod=_0x23cb06;const _0xf64e5d=shoppingCart['reduce']((_0xc4e15f,_0x1cd3ad)=>_0xc4e15f+_0x1cd3ad['price']*_0x1cd3ad['quantity'],0x0),_0x42cd05=getTotalCartItems();document['getElementById']('payment-modal-total')[_0x2ab818(0x13be)]='¥'+_0xf64e5d[_0x2ab818(0x13ad)](0x2),document['getElementById']('payment-modal-items-count')[_0x2ab818(0x13be)]=_0x42cd05,document[_0x2ab818(0x1262)]('payment-request-modal')[_0x2ab818(0x14eb)]['display']='flex';}function proceedToCheckout(){const _0x38fe31=_0x211817;showRecipientModal(_0x38fe31(0x196d));}function handleShoppingCartBack(){const _0x43cd26=_0x211817;hideApp(_0x43cd26(0x742)),showApp(previousScreenBeforeCart);}function hidePaymentRequestModal(_0x3b5496){const _0x213082=_0x211817;if(_0x3b5496&&_0x3b5496['target']!==_0x3b5496[_0x213082(0x1fac)])return;document[_0x213082(0x1262)](_0x213082(0x8b8))[_0x213082(0x14eb)][_0x213082(0x4da)]=_0x213082(0x102b);}function processOrder(_0x15c379){const _0x514ff1=_0x211817,_0x1e2f06=shoppingCart[_0x514ff1(0x1122)]((_0x131642,_0xd45d98)=>_0x131642+_0xd45d98['price']*_0xd45d98[_0x514ff1(0xb8d)],0x0),_0x383bb6=getTotalCartItems(),_0x3fba0b=generateOrderDetails();hidePaymentRequestModal(),_0x15c379==='for_self'?selectedPaymentMethod===_0x514ff1(0x196d)?(showCustomToast(_0x514ff1(0x10ed),_0x514ff1(0x477),0x3e8),setTimeout(()=>{const _0x8f38c1=_0x514ff1;sendOrderMessage(_0x3fba0b,_0x8f38c1(0x1ab2)),clearShoppingCart(),showCustomToast(_0x8f38c1(0xa97)+_0x1e2f06['toFixed'](0x2),'success'),setTimeout(()=>handleShoppingCartBack(),0x3e8);},0x5dc)):(sendPaymentRequestMessage(_0x3fba0b,_0x514ff1(0x15cb)),showCustomToast(_0x514ff1(0x4be)+currentChatCharacter['name'],_0x514ff1(0x11cb)),clearShoppingCart(),setTimeout(()=>handleShoppingCartBack(),0x3e8)):selectedPaymentMethod===_0x514ff1(0x196d)?(showCustomToast(_0x514ff1(0x1151)+currentChatCharacter[_0x514ff1(0x1a1c)]+'\x20下单...',_0x514ff1(0x477)),setTimeout(()=>{const _0xb5cc96=_0x514ff1;sendOrderMessage(_0x3fba0b,_0xb5cc96(0x1bcb)),clearShoppingCart(),showCustomToast(_0xb5cc96(0x22fb)+currentChatCharacter[_0xb5cc96(0x1a1c)]+_0xb5cc96(0x1465),_0xb5cc96(0x11cb)),setTimeout(()=>handleShoppingCartBack(),0x3e8);},0x5dc)):(sendPaymentRequestMessage(_0x3fba0b,_0x514ff1(0x207a)),showCustomToast('已发送代付请求给\x20'+currentChatCharacter[_0x514ff1(0x1a1c)],'success'),clearShoppingCart(),setTimeout(()=>handleShoppingCartBack(),0x3e8));}function generateOrderDetails(){const _0x4d8dd7=_0x211817,_0x4289e6=shoppingCart[_0x4d8dd7(0x1122)]((_0x432d5d,_0x39a1c9)=>_0x432d5d+_0x39a1c9['price']*_0x39a1c9[_0x4d8dd7(0xb8d)],0x0),_0x344eef=getTotalCartItems(),_0x56fe6b='SP'+Date['now']()[_0x4d8dd7(0x1878)]()['slice'](-0x8);return{'orderNumber':_0x56fe6b,'items':[...shoppingCart],'total':_0x4289e6,'itemsCount':_0x344eef,'timestamp':Date[_0x4d8dd7(0x2eb)]()};}function sendPaymentRequestMessage(_0x12dab2,_0x4719b7){const _0x5e4f5e=_0x211817;if(!currentChatCharacter)return;const _0x3486d9=_0x12dab2[_0x5e4f5e(0x1775)][_0x5e4f5e(0x6a4)](_0x45e206=>_0x5e4f5e(0x1b05)+_0x45e206[_0x5e4f5e(0x1a1c)]+_0x5e4f5e(0x188a)+(_0x45e206[_0x5e4f5e(0x644)]*_0x45e206['quantity'])[_0x5e4f5e(0x13ad)](0x2)+_0x5e4f5e(0x7ea))[_0x5e4f5e(0x122b)](''),_0x13efbc=_0x4719b7==='request_pay_self'?_0x5e4f5e(0xa41):currentChatCharacter[_0x5e4f5e(0x1a1c)],_0x2a9f57=_0x4719b7===_0x5e4f5e(0x15cb)?_0x5e4f5e(0x22f6):'请帮忙支付这个订单，谢谢！',_0x5345b3=_0x4719b7[_0x5e4f5e(0x81f)]('_self')?'我':currentChatCharacter?.['name']||'用户',_0x2d101b=_0x4719b7[_0x5e4f5e(0x81f)]('_self')?currentChatCharacter?.[_0x5e4f5e(0x1a1c)]||_0x5e4f5e(0x7c1):'我',_0x1a6388=_0x4719b7[_0x5e4f5e(0x81f)](_0x5e4f5e(0x829));let _0x331740;_0x1a6388&&(_0x331740='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-card\x22\x20data-order-id=\x22'+_0x12dab2['orderNumber']+_0x5e4f5e(0xec1)+_0x12dab2['total'][_0x5e4f5e(0x13ad)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-countdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20剩余支付时间\x20<span\x20class=\x22payment-request-countdown-time\x22\x20id=\x22countdown-'+_0x12dab2[_0x5e4f5e(0xea7)]+_0x5e4f5e(0xdff)+_0x12dab2[_0x5e4f5e(0xea7)]+_0x5e4f5e(0xb16),setTimeout(()=>{const _0x230c17=_0x5e4f5e;startPaymentCountdown(_0x12dab2[_0x230c17(0xea7)]);},0x64));const _0x338c28={'id':Date['now'](),'content':_0x331740,'sender':_0x5e4f5e(0x1e6d),'timestamp':Date[_0x5e4f5e(0x2eb)](),'type':_0x5e4f5e(0x1871),'orderDetails':_0x12dab2,'orderType':_0x4719b7,'paymentStatus':null,'paidBy':null,'rejectedBy':null};addMessageToChat(_0x338c28),window[_0x5e4f5e(0xaf9)]=window[_0x5e4f5e(0xaf9)]||{};}function startPaymentCountdown(_0x3f72c8){const _0x4df2b7=_0x211817;window[_0x4df2b7(0xaf9)]&&window[_0x4df2b7(0xaf9)][_0x3f72c8]&&clearInterval(window['paymentCountdowns'][_0x3f72c8]);let _0xedb93a=0xf*0x3c;const _0x507158=document[_0x4df2b7(0x1262)](_0x4df2b7(0x1a8e)+_0x3f72c8);if(!_0x507158)return;const _0x593128=setInterval(()=>{const _0x31af41=_0x4df2b7,_0x2c445c=Math[_0x31af41(0x2180)](_0xedb93a/0x3c),_0x5cff83=_0xedb93a%0x3c,_0x19ea90=_0x2c445c[_0x31af41(0x1878)]()['padStart'](0x2,'0')+':'+_0x5cff83['toString']()['padStart'](0x2,'0');_0x507158[_0x31af41(0x13be)]=_0x19ea90;if(_0xedb93a<=0x0){clearInterval(_0x593128),_0x507158[_0x31af41(0x13be)]=_0x31af41(0x10bc),_0x507158[_0x31af41(0x14eb)]['background']=_0x31af41(0x5e1);const _0x58bf8e=_0x507158[_0x31af41(0x216a)](_0x31af41(0x20bc))['querySelector'](_0x31af41(0x18e7));_0x58bf8e&&(_0x58bf8e[_0x31af41(0x559)]=!![],_0x58bf8e[_0x31af41(0x13be)]='支付超时',_0x58bf8e['style'][_0x31af41(0x11af)]=_0x31af41(0x1a21)),delete window['paymentCountdowns'][_0x3f72c8];}_0xedb93a--;},0x3e8);window[_0x4df2b7(0xaf9)]=window[_0x4df2b7(0xaf9)]||{},window['paymentCountdowns'][_0x3f72c8]=_0x593128;}async function processPaymentRequestResponse(_0x166a9d,_0x1d6638,_0x5d7f14){const _0x341d82=_0x211817;console[_0x341d82(0x2187)](_0x341d82(0xf85),{'paymentMessage':_0x166a9d,'aiMessages':_0x1d6638,'characterId':_0x5d7f14});let _0x532512='';for(const _0x2696c2 of _0x1d6638){if(typeof _0x2696c2==='string')_0x532512+=_0x2696c2+'\x20';else typeof _0x2696c2===_0x341d82(0x28d)&&_0x2696c2[_0x341d82(0x211c)]&&(_0x532512+=_0x2696c2[_0x341d82(0x211c)]+'\x20');}_0x532512=_0x532512[_0x341d82(0x19d7)](),console[_0x341d82(0x2187)]('🛒\x20[代付响应处理]\x20AI完整回复内容:',_0x532512);const _0x3817fc=[_0x341d82(0xef0),'我付','我买单','我帮你付','我帮你买',_0x341d82(0x1c46),_0x341d82(0x172c),'我请你','我来买',_0x341d82(0xa28),_0x341d82(0x1733),'我来结账','我帮你结账',_0x341d82(0x51c),_0x341d82(0x1d82),'我给你付款',_0x341d82(0xda6),_0x341d82(0xa65),'我帮你付款',_0x341d82(0x1fcd),_0x341d82(0xd1f),_0x341d82(0x1780),'我为你买','我出钱',_0x341d82(0x145f),_0x341d82(0x19d0),_0x341d82(0x1dea),_0x341d82(0x20a8),_0x341d82(0xe97),_0x341d82(0x15ce),_0x341d82(0x1d4b),_0x341d82(0x3ea),_0x341d82(0x1c93),_0x341d82(0x10f6),_0x341d82(0x30a),'我来结账',_0x341d82(0x746),_0x341d82(0x1a6e),_0x341d82(0x18f2),_0x341d82(0x1b6d),_0x341d82(0x222e),_0x341d82(0x1fd5),_0x341d82(0x12a1),'我来买单',_0x341d82(0x9f2),_0x341d82(0x7e9),'我给你买单',_0x341d82(0x1fd6),_0x341d82(0x10f6),'我替你下单',_0x341d82(0x10b8),_0x341d82(0x1599),_0x341d82(0xe31),'我来购买','我替你购买','我为你购买',_0x341d82(0x2a5)],_0x4cee24=['不付','不买',_0x341d82(0x1d81),'不帮你买',_0x341d82(0x1337),_0x341d82(0xf00),'不支付',_0x341d82(0x944),_0x341d82(0xd4e),'不给钱',_0x341d82(0x119c),_0x341d82(0x1657),'不下单',_0x341d82(0x1c04),_0x341d82(0x207d),_0x341d82(0x5ce),_0x341d82(0x657),_0x341d82(0x2279),_0x341d82(0x69d),'拒绝给钱',_0x341d82(0x7e4),_0x341d82(0x390),_0x341d82(0x203),_0x341d82(0x12d8),_0x341d82(0x1017),_0x341d82(0x1061),_0x341d82(0x1e0),'不愿意付款',_0x341d82(0xf1c),_0x341d82(0x1bac),_0x341d82(0x11e2),'不愿意结账',_0x341d82(0x71c),_0x341d82(0x22b2),'不想付',_0x341d82(0x19c0),_0x341d82(0xcff),_0x341d82(0x11e9),'不想出钱',_0x341d82(0x590),_0x341d82(0x148f),_0x341d82(0x4b9),_0x341d82(0x13d2),_0x341d82(0x64f),'没钱','没有钱',_0x341d82(0x17b0),_0x341d82(0x483),'买不起','付不起','太贵',_0x341d82(0x3a7),_0x341d82(0x22e2),_0x341d82(0x20db)],_0x482fe0=_0x3817fc[_0x341d82(0x19fa)](_0x328d58=>_0x532512[_0x341d82(0x1831)](_0x328d58)),_0x48602c=_0x4cee24['some'](_0xbd5c66=>_0x532512[_0x341d82(0x1831)](_0xbd5c66));console[_0x341d82(0x2187)](_0x341d82(0xa91),{'isAccepted':_0x482fe0,'isRejected':_0x48602c,'fullAiResponse':_0x532512[_0x341d82(0x17ca)](0x0,0x64)+_0x341d82(0x1520)});if(_0x482fe0)_0x166a9d[_0x341d82(0x21a)]=_0x341d82(0x1636),_0x166a9d[_0x341d82(0x8aa)]=currentChatCharacter?.[_0x341d82(0x1a1c)]||'角色',console['log'](_0x341d82(0x20c6)),updatePaymentRequestDisplay(_0x166a9d[_0x341d82(0x1bdf)][_0x341d82(0xea7)],_0x341d82(0x1636));else _0x48602c&&(_0x166a9d[_0x341d82(0x21a)]='rejected',_0x166a9d[_0x341d82(0x1efe)]=currentChatCharacter?.['name']||'角色',console[_0x341d82(0x2187)]('🛒\x20[代付响应处理]\x20AI拒绝代付，更新状态为已拒绝'),updatePaymentRequestDisplay(_0x166a9d[_0x341d82(0x1bdf)]['orderNumber'],_0x341d82(0xd3b)));if(_0x482fe0||_0x48602c)try{await saveChatMessagesImmediate([_0x5d7f14]),console[_0x341d82(0x2187)]('🛒\x20[代付响应处理]\x20代付状态已保存到数据库');}catch(_0x2ff55e){console[_0x341d82(0x174a)](_0x341d82(0xc7a),_0x2ff55e);}}function generatePaymentRequestContent(_0x2a5483){const _0x213ea7=_0x211817,_0x2ff6d4=_0x2a5483[_0x213ea7(0x1bdf)],_0x225147=_0x2a5483[_0x213ea7(0x21a)];if(!_0x2ff6d4)return _0x2a5483[_0x213ea7(0x211c)];let _0x12ccc5='';if(_0x225147==='paid')_0x12ccc5=_0x213ea7(0x1857)+_0x2ff6d4[_0x213ea7(0x1916)][_0x213ea7(0x13ad)](0x2)+_0x213ea7(0x22f4)+_0x2ff6d4[_0x213ea7(0xea7)]+_0x213ea7(0x51f);else _0x225147===_0x213ea7(0xd3b)?_0x12ccc5=_0x213ea7(0x1857)+_0x2ff6d4[_0x213ea7(0x1916)]['toFixed'](0x2)+_0x213ea7(0x1377)+_0x2ff6d4['orderNumber']+_0x213ea7(0x51f):_0x12ccc5=_0x213ea7(0x1857)+_0x2ff6d4[_0x213ea7(0x1916)][_0x213ea7(0x13ad)](0x2)+_0x213ea7(0x418)+_0x2ff6d4['orderNumber']+'\x22>15:00</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27'+_0x2ff6d4[_0x213ea7(0xea7)]+_0x213ea7(0x51f);const _0xe275ed='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-card\x22\x20data-order-id=\x22'+_0x2ff6d4[_0x213ea7(0xea7)]+_0x213ea7(0x1f02)+_0x12ccc5+_0x213ea7(0x3db);return!_0x225147&&setTimeout(()=>{const _0x59b7dd=_0x213ea7;startPaymentCountdown(_0x2ff6d4[_0x59b7dd(0xea7)]);},0x64),_0xe275ed;}function updatePaymentRequestDisplay(_0x5d99f5,_0x16691d){const _0x21ec72=_0x211817;console[_0x21ec72(0x2187)](_0x21ec72(0x2262),{'orderNumber':_0x5d99f5,'status':_0x16691d});const _0x418cae=document['querySelector'](_0x21ec72(0x340)+_0x5d99f5+'\x22]');if(!_0x418cae){console[_0x21ec72(0x2187)](_0x21ec72(0xaac),_0x5d99f5);return;}window[_0x21ec72(0xaf9)]&&window[_0x21ec72(0xaf9)][_0x5d99f5]&&(clearInterval(window[_0x21ec72(0xaf9)][_0x5d99f5]),delete window[_0x21ec72(0xaf9)][_0x5d99f5]);const _0x15b1ca=chatMessages[currentChatCharacter?.['id']]||[];let _0x2fb931=null;for(const _0x993879 of _0x15b1ca){if(_0x993879[_0x21ec72(0x1a4b)]==='payment_request'&&_0x993879[_0x21ec72(0x1bdf)]&&_0x993879[_0x21ec72(0x1bdf)]['orderNumber']===_0x5d99f5){_0x2fb931=_0x993879[_0x21ec72(0x1bdf)];break;}}if(!_0x2fb931){console[_0x21ec72(0x2187)]('🛒\x20[界面更新]\x20未找到订单详情');return;}let _0x2ba427='';if(_0x16691d===_0x21ec72(0x1636))_0x2ba427=_0x21ec72(0x1857)+_0x2fb931[_0x21ec72(0x1916)][_0x21ec72(0x13ad)](0x2)+_0x21ec72(0x22f4)+_0x5d99f5+_0x21ec72(0x51f);else _0x16691d===_0x21ec72(0xd3b)&&(_0x2ba427='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥'+_0x2fb931[_0x21ec72(0x1916)]['toFixed'](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-rejected-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我拒绝了您的代付请求\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27'+_0x5d99f5+_0x21ec72(0x51f));_0x418cae[_0x21ec72(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2ba427+_0x21ec72(0x204c),console[_0x21ec72(0x2187)](_0x21ec72(0x2138));}function showPaymentDetails(_0x11e5e2){const _0x29d142=_0x211817;let _0x1006df=null;const _0x3f41fa=chatMessages[currentChatCharacter?.['id']]||[];for(const _0x136993 of _0x3f41fa){if(_0x136993[_0x29d142(0x1a4b)]==='payment_request'&&_0x136993[_0x29d142(0x1bdf)]&&_0x136993[_0x29d142(0x1bdf)][_0x29d142(0xea7)]===_0x11e5e2){_0x1006df=_0x136993[_0x29d142(0x1bdf)];break;}}if(!_0x1006df){alert(_0x29d142(0xe6f));return;}const _0x2d9699=_0x1006df[_0x29d142(0x1775)][_0x29d142(0x6a4)](_0x443816=>{const _0x2ce266=_0x29d142;let _0x5e4347=_0x443816[_0x2ce266(0x1a1c)]+'\x20x'+_0x443816[_0x2ce266(0xb8d)];if(_0x443816['selectedOptions']&&Object[_0x2ce266(0x1c9f)](_0x443816['selectedOptions'])[_0x2ce266(0x19ee)]>0x0){const _0x47dc74=Object['entries'](_0x443816[_0x2ce266(0xabc)])[_0x2ce266(0x6a4)](([_0x26ef77,_0x5e8eb2])=>getOptionLabel(_0x26ef77)+':\x20'+_0x5e8eb2)[_0x2ce266(0x122b)](',\x20');_0x5e4347+=_0x2ce266(0x13e4)+_0x47dc74+'</small>';}return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>'+_0x5e4347+_0x2ce266(0xead)+(_0x443816[_0x2ce266(0x644)]*_0x443816[_0x2ce266(0xb8d)])[_0x2ce266(0x13ad)](0x2)+_0x2ce266(0x115b);})['join']('');window['closePaymentModal']=function(){const _0x48132d=_0x29d142,_0x24239a=document['getElementById'](_0x48132d(0xf3e));_0x24239a&&(_0x24239a[_0x48132d(0x14eb)]['display']=_0x48132d(0x102b));};const _0x5ca30b=_0x29d142(0xaf0)+_0x1006df['orderNumber']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2d9699+_0x29d142(0x117d)+_0x1006df['total'][_0x29d142(0x13ad)](0x2)+_0x29d142(0x19fe);let _0x2ffedb=document[_0x29d142(0x1262)](_0x29d142(0xf3e));!_0x2ffedb&&(_0x2ffedb=document[_0x29d142(0xac6)](_0x29d142(0xbbc)),_0x2ffedb['id']=_0x29d142(0xf3e),_0x2ffedb['className']=_0x29d142(0x1b15),document[_0x29d142(0x1da9)][_0x29d142(0x497)](_0x2ffedb)),_0x2ffedb[_0x29d142(0x33a)]=_0x29d142(0x202f)+_0x5ca30b+_0x29d142(0x3db),_0x2ffedb[_0x29d142(0x1f36)]=function(_0x392b1b){const _0x7e563a=_0x29d142;_0x392b1b[_0x7e563a(0x193d)]===_0x2ffedb&&window['closePaymentModal']();},_0x2ffedb[_0x29d142(0x14eb)][_0x29d142(0x4da)]=_0x29d142(0x1fb7);}function sendOrderMessage(_0x51f561,_0x3ba1d1){const _0x1fda66=_0x211817;if(!currentChatCharacter)return;const _0x543bf4=_0x51f561['items'][_0x1fda66(0x6a4)](_0x36b708=>{const _0x16ea8b=_0x1fda66;let _0x4bf338=_0x36b708[_0x16ea8b(0x1a1c)]+'\x20x'+_0x36b708['quantity'];if(_0x36b708[_0x16ea8b(0xabc)]&&Object[_0x16ea8b(0x1c9f)](_0x36b708['selectedOptions'])[_0x16ea8b(0x19ee)]>0x0){const _0x23795a=Object[_0x16ea8b(0x2bc)](_0x36b708[_0x16ea8b(0xabc)])[_0x16ea8b(0x6a4)](([_0x231149,_0x36e4d6])=>getOptionLabel(_0x231149)+':\x20'+_0x36e4d6)[_0x16ea8b(0x122b)](',\x20');_0x4bf338+='\x20('+_0x23795a+')';}return _0x4bf338;})[_0x1fda66(0x122b)]('、');let _0x2e07e=_0x1fda66(0x2186);const _0x3cd372={'id':Date[_0x1fda66(0x2eb)](),'content':_0x2e07e,'sender':_0x1fda66(0x1e6d),'timestamp':Date[_0x1fda66(0x2eb)](),'type':_0x1fda66(0x1c97),'orderDetails':_0x51f561,'orderType':_0x3ba1d1};addMessageToChat(_0x3cd372);}function showCustomToast(_0x6a089c,_0x58ba33=_0x211817(0x1094),_0x50cc3a=0x5dc){const _0x22f25d=_0x211817,_0x3ff539=document[_0x22f25d(0xb30)](_0x22f25d(0x1463));_0x3ff539&&_0x3ff539[_0x22f25d(0x1493)]();const _0x251691=document[_0x22f25d(0xac6)](_0x22f25d(0xbbc));_0x251691[_0x22f25d(0x1722)]=_0x22f25d(0xa43)+_0x58ba33,_0x251691[_0x22f25d(0x13be)]=_0x6a089c,document[_0x22f25d(0x1da9)]['appendChild'](_0x251691),setTimeout(()=>{const _0x426412=_0x22f25d;_0x251691[_0x426412(0x148c)]&&(_0x251691['classList'][_0x426412(0x21e2)](_0x426412(0x1a6d)),setTimeout(()=>{const _0x1313ff=_0x426412;_0x251691[_0x1313ff(0x148c)]&&_0x251691[_0x1313ff(0x1493)]();},0x12c));},_0x50cc3a);}function generateAIOrderConfirmationContent(_0x23f83a){const _0x230747=_0x211817,_0x3fb437=_0x23f83a[_0x230747(0x1bdf)],_0x5c9a00=_0x23f83a[_0x230747(0x1808)];if(!_0x3fb437)return _0x230747(0x137f)+_0x23f83a[_0x230747(0x211c)]+'</div>';const _0x33d002=_0x3fb437[_0x230747(0x1775)][_0x230747(0x6a4)](_0x4b4243=>{const _0x43b97d=_0x230747;let _0x592544=_0x4b4243[_0x43b97d(0x1a1c)]+'\x20x'+_0x4b4243[_0x43b97d(0xb8d)];if(_0x4b4243[_0x43b97d(0xabc)]&&Object[_0x43b97d(0x1c9f)](_0x4b4243[_0x43b97d(0xabc)])[_0x43b97d(0x19ee)]>0x0){const _0x12f886=Object[_0x43b97d(0x2bc)](_0x4b4243[_0x43b97d(0xabc)])[_0x43b97d(0x6a4)](([_0x142ae3,_0x427316])=>getOptionLabel(_0x142ae3)+':\x20'+_0x427316)[_0x43b97d(0x122b)](',\x20');_0x592544+='\x20('+_0x12f886+')';}return _0x43b97d(0x37e)+_0x592544+_0x43b97d(0x58d)+_0x4b4243['price']+_0x43b97d(0x1997);})[_0x230747(0x122b)]('');let _0x40c565='',_0x3a829a='';return _0x5c9a00===_0x230747(0x2133)?(_0x40c565=_0x230747(0x21c0),_0x3a829a='🛍️'):(_0x40c565='订单确认',_0x3a829a='📋'),_0x230747(0x1228)+_0x3a829a+'\x20'+_0x40c565+_0x230747(0x224b)+_0x3fb437[_0x230747(0xea7)]+_0x230747(0xe98)+_0x33d002+_0x230747(0x1e34)+_0x3fb437[_0x230747(0x1916)][_0x230747(0x13ad)](0x2)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-time\x22>下单时间：'+new Date(_0x3fb437['timestamp'])[_0x230747(0xecc)]()+_0x230747(0x12fa);}function getProductPrice(_0x5813e2,_0x34cc5d={}){const _0x5e822d=_0x211817;if(!_0x5813e2[_0x5e822d(0x1f8f)])return _0x5813e2[_0x5e822d(0x644)];for(const [_0x26cba2,_0x58bc89]of Object['entries'](_0x34cc5d)){if(_0x5813e2[_0x5e822d(0x1f8f)][_0x26cba2]&&_0x5813e2['prices'][_0x26cba2][_0x58bc89]!==undefined)return _0x5813e2['prices'][_0x26cba2][_0x58bc89];}return _0x5813e2[_0x5e822d(0x644)];}function updateProductPrice(_0x5029df,_0x212ee5){const _0x46c5f9=_0x211817,_0x651810=productsData[_0x5029df][_0x212ee5],_0x191c88={};for(const _0x2f54b0 of Object[_0x46c5f9(0x1c9f)](_0x651810['options'])){const _0x2a3e96=document['getElementById'](_0x46c5f9(0x19ad)+_0x2f54b0);_0x2a3e96&&(_0x191c88[_0x2f54b0]=_0x2a3e96[_0x46c5f9(0x1ebc)]);}const _0x5a645a=getProductPrice(_0x651810,_0x191c88),_0x343623=document[_0x46c5f9(0x1262)](_0x46c5f9(0x20ac));_0x343623&&(_0x343623[_0x46c5f9(0x13be)]='¥'+_0x5a645a);}function showCustomConfirm(_0x4508a5,_0x5c6497,_0x2c1493,_0x43e134){const _0x5b1d56=_0x211817,_0x2bc1cc=document[_0x5b1d56(0xb30)](_0x5b1d56(0x226c));_0x2bc1cc&&_0x2bc1cc['remove']();const _0x17b0d4=document[_0x5b1d56(0xac6)](_0x5b1d56(0xbbc));_0x17b0d4[_0x5b1d56(0x1722)]=_0x5b1d56(0x1815),_0x17b0d4['innerHTML']=_0x5b1d56(0x572)+_0x4508a5+_0x5b1d56(0x9ad)+_0x5c6497+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22custom-confirm-btn\x20cancel\x22\x20onclick=\x22closeCustomConfirm()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22custom-confirm-btn\x20confirm\x22\x20onclick=\x22confirmCustomAction()\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x5b1d56(0x1da9)][_0x5b1d56(0x497)](_0x17b0d4),window[_0x5b1d56(0x141e)]={'onConfirm':_0x2c1493||(()=>{}),'onCancel':_0x43e134||(()=>{})},_0x17b0d4[_0x5b1d56(0x21e9)](_0x5b1d56(0x1859),_0x272006=>{const _0x1cb8f8=_0x5b1d56;_0x272006[_0x1cb8f8(0x193d)]===_0x17b0d4&&closeCustomConfirm();});}function closeCustomConfirm(){const _0x2670d7=_0x211817,_0x33352b=document[_0x2670d7(0xb30)]('.custom-confirm');_0x33352b&&_0x33352b[_0x2670d7(0x1493)](),window[_0x2670d7(0x141e)]&&window[_0x2670d7(0x141e)][_0x2670d7(0x1d36)]&&window['customConfirmCallbacks']['onCancel']();}function confirmCustomAction(){const _0x545f41=_0x211817,_0x702850=document[_0x545f41(0xb30)](_0x545f41(0x226c));_0x702850&&_0x702850[_0x545f41(0x1493)](),window[_0x545f41(0x141e)]&&window['customConfirmCallbacks'][_0x545f41(0x1222)]&&window[_0x545f41(0x141e)][_0x545f41(0x1222)]();}function updateCartBadge(_0x3cd90d){const _0x5152c8=_0x211817,_0x40474c=document[_0x5152c8(0x1262)](_0x5152c8(0x9c6));_0x40474c&&(_0x3cd90d>0x0?(_0x40474c[_0x5152c8(0x13be)]=_0x3cd90d>0x63?'99+':_0x3cd90d[_0x5152c8(0x1878)](),_0x40474c[_0x5152c8(0x14eb)][_0x5152c8(0x4da)]='flex'):_0x40474c[_0x5152c8(0x14eb)]['display']=_0x5152c8(0x102b));}function showAppointmentForm(_0x2c2331=null){const _0x35963d=_0x211817;editingAppointmentId=_0x2c2331;const _0x947907=document[_0x35963d(0x1262)](_0x35963d(0x19c5)),_0x3e2b56=document[_0x35963d(0x1262)](_0x35963d(0x150d));populateCharacterSelect(_0x35963d(0x1556));if(_0x2c2331){_0x3e2b56[_0x35963d(0x13be)]=_0x35963d(0x220c);const _0x1c7fee=appointments[_0x35963d(0xaf4)](_0x212161=>_0x212161['id']===_0x2c2331);_0x1c7fee&&(document['getElementById'](_0x35963d(0x1402))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0x1a1c)],document['getElementById'](_0x35963d(0x1c42))['value']=_0x1c7fee['date'],document[_0x35963d(0x1262)](_0x35963d(0x1bab))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0x1236)]||'',_0x1c7fee[_0x35963d(0xd1d)]?(document[_0x35963d(0x1262)](_0x35963d(0x1e13))['value']=_0x35963d(0xe56),document[_0x35963d(0x1262)](_0x35963d(0xfaf))['value']=_0x1c7fee[_0x35963d(0xd1d)],toggleCustomTypeInput(_0x35963d(0x18e0))):document[_0x35963d(0x1262)](_0x35963d(0x1e13))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0x1a4b)],document[_0x35963d(0x1262)](_0x35963d(0x1556))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0xaf5)]||'',document[_0x35963d(0x1262)](_0x35963d(0xed7))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0xa11)]||_0x35963d(0x950),document[_0x35963d(0x1262)](_0x35963d(0x1acd))[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0x7c9)]||'',document['getElementById']('appointment-user-quote')[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0xc38)]||'',document[_0x35963d(0x1262)]('appointment-character-quote')[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0xa26)]||'',document['getElementById']('appointment-shared')['checked']=_0x1c7fee[_0x35963d(0x1f11)]===!![],document['getElementById'](_0x35963d(0x2203))[_0x35963d(0x14c1)]=_0x1c7fee[_0x35963d(0x77e)]===!![],document[_0x35963d(0x1262)]('appointment-count-type')[_0x35963d(0x1ebc)]=_0x1c7fee[_0x35963d(0x1710)]||_0x35963d(0x920),document[_0x35963d(0x1262)](_0x35963d(0x1dbd))['checked']=_0x1c7fee[_0x35963d(0x71d)]===!![],_0x1c7fee['neverExpires']&&toggleNeverExpires(_0x35963d(0x18e0)),_0x1c7fee[_0x35963d(0x159c)]&&(document['getElementById'](_0x35963d(0x1b8c))[_0x35963d(0x45c)]=_0x1c7fee[_0x35963d(0x159c)],document[_0x35963d(0x1262)](_0x35963d(0x7cd))[_0x35963d(0x14eb)][_0x35963d(0x4da)]=_0x35963d(0x13de)),_0x1c7fee[_0x35963d(0x865)]&&(document[_0x35963d(0x1262)](_0x35963d(0x8f1))[_0x35963d(0x45c)]=_0x1c7fee[_0x35963d(0x865)],document[_0x35963d(0x1262)](_0x35963d(0xe9c))[_0x35963d(0x14eb)][_0x35963d(0x4da)]=_0x35963d(0x13de)),toggleCharacterQuoteGroup('appointment',_0x1c7fee[_0x35963d(0xaf5)]));}else _0x3e2b56[_0x35963d(0x13be)]=_0x35963d(0x7e2),clearAppointmentForm();_0x947907[_0x35963d(0x14eb)][_0x35963d(0x4da)]='flex';}function closeAppointmentForm(){const _0x49b241=_0x211817;document[_0x49b241(0x1262)](_0x49b241(0x19c5))['style']['display']=_0x49b241(0x102b),clearAppointmentForm(),editingAppointmentId=null;}function clearAppointmentForm(){const _0x1db34f=_0x211817;document[_0x1db34f(0x1262)](_0x1db34f(0x1402))[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x1c42))[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x1bab))[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x1e13))['value']=_0x1db34f(0x20d4),document[_0x1db34f(0x1262)](_0x1db34f(0xfaf))[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x1556))['value']='',document[_0x1db34f(0x1262)](_0x1db34f(0xed7))[_0x1db34f(0x1ebc)]=_0x1db34f(0x950),document[_0x1db34f(0x1262)](_0x1db34f(0x1acd))[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)]('appointment-user-quote')[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)]('appointment-character-quote')[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x7b0))['checked']=![],document[_0x1db34f(0x1262)]('appointment-pinned')['checked']=![],document['getElementById'](_0x1db34f(0x1c17))[_0x1db34f(0x1ebc)]=_0x1db34f(0x920),document[_0x1db34f(0x1262)](_0x1db34f(0x1dbd))['checked']=![];const _0x1e2e63=document[_0x1db34f(0x1262)](_0x1db34f(0x1c42)),_0x349b94=document['getElementById'](_0x1db34f(0x1bab));_0x1e2e63['disabled']=![],_0x349b94['disabled']=![],_0x1e2e63[_0x1db34f(0x14eb)][_0x1db34f(0x11af)]='1',_0x349b94[_0x1db34f(0x14eb)][_0x1db34f(0x11af)]='1',document[_0x1db34f(0x1262)]('appointment-background-upload')[_0x1db34f(0x1ebc)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x8ec))['value']='',document[_0x1db34f(0x1262)]('appointment-background-preview')[_0x1db34f(0x14eb)][_0x1db34f(0x4da)]='none',document[_0x1db34f(0x1262)](_0x1db34f(0xe9c))[_0x1db34f(0x14eb)][_0x1db34f(0x4da)]=_0x1db34f(0x102b),document['getElementById']('appointment-background-img')[_0x1db34f(0x45c)]='',document[_0x1db34f(0x1262)](_0x1db34f(0x8f1))[_0x1db34f(0x45c)]='',toggleCharacterQuoteGroup(_0x1db34f(0x18e0),''),toggleCustomTypeInput(_0x1db34f(0x18e0));}async function saveAppointment(_0x309703){const _0x432ffa=_0x211817;_0x309703&&(_0x309703['preventDefault'](),_0x309703[_0x432ffa(0x902)]());const _0xb73316=document[_0x432ffa(0x1262)](_0x432ffa(0x1402)),_0xd0c5e4=document['getElementById'](_0x432ffa(0x1c42)),_0x20ca18=document[_0x432ffa(0x1262)](_0x432ffa(0x1bab)),_0x5dfde4=document[_0x432ffa(0x1262)](_0x432ffa(0x1e13)),_0x4862eb=document['getElementById'](_0x432ffa(0xfaf)),_0x54dfaf=document[_0x432ffa(0x1262)]('appointment-character'),_0x28339e=document[_0x432ffa(0x1262)]('appointment-priority'),_0x1d40a0=document[_0x432ffa(0x1262)](_0x432ffa(0x1acd)),_0x3557e2=document[_0x432ffa(0x1262)](_0x432ffa(0x8bd)),_0x457bfb=document[_0x432ffa(0x1262)](_0x432ffa(0x924)),_0x359d6e=document[_0x432ffa(0x1262)](_0x432ffa(0x7b0)),_0x2ebadb=document['getElementById'](_0x432ffa(0x2203)),_0x53512f=document[_0x432ffa(0x1262)](_0x432ffa(0x1c17)),_0x1b2f83=document[_0x432ffa(0x1262)](_0x432ffa(0x1dbd)),_0x46ad89=_0xb73316?String(_0xb73316['value']||'')['trim']():'',_0x44e282=_0xd0c5e4?String(_0xd0c5e4[_0x432ffa(0x1ebc)]||''):'',_0x2b7345=_0x20ca18?String(_0x20ca18['value']||''):'',_0x21ddf6=_0x5dfde4?String(_0x5dfde4['value']||''):'',_0x4859fa=_0x4862eb?String(_0x4862eb[_0x432ffa(0x1ebc)]||'')['trim']():'',_0x36c2d4=_0x54dfaf?String(_0x54dfaf[_0x432ffa(0x1ebc)]||''):'',_0x4e97c1=_0x28339e?String(_0x28339e['value']||'medium'):_0x432ffa(0x950),_0x32f1bd=_0x1d40a0?String(_0x1d40a0['value']||'')[_0x432ffa(0x19d7)]():'',_0x114710=_0x3557e2?String(_0x3557e2[_0x432ffa(0x1ebc)]||'')[_0x432ffa(0x19d7)]():'',_0x4f1c70=_0x457bfb?String(_0x457bfb[_0x432ffa(0x1ebc)]||'')['trim']():'',_0x44c36a=_0x359d6e?Boolean(_0x359d6e[_0x432ffa(0x14c1)]):![],_0xf8cf6=_0x2ebadb?Boolean(_0x2ebadb[_0x432ffa(0x14c1)]):![],_0x2f4ec0=_0x53512f?String(_0x53512f[_0x432ffa(0x1ebc)]||_0x432ffa(0x920)):'countdown',_0x39b4b6=_0x1b2f83?Boolean(_0x1b2f83[_0x432ffa(0x14c1)]):![];console[_0x432ffa(0x2187)](_0x432ffa(0x202b),{'name':_0x46ad89,'date':_0x44e282,'time':_0x2b7345,'type':_0x21ddf6,'customType':_0x4859fa,'characterId':_0x36c2d4,'priority':_0x4e97c1,'description':_0x32f1bd,'userQuote':_0x114710,'characterQuote':_0x4f1c70,'isShared':_0x44c36a,'isPinned':_0xf8cf6,'countType':_0x2f4ec0,'neverExpires':_0x39b4b6});if(!_0x46ad89||!_0x39b4b6&&!_0x44e282){showToast(_0x39b4b6?_0x432ffa(0x22b6):_0x432ffa(0x4cb),'error');return;}if(_0x21ddf6==='other'&&!_0x4859fa){showToast(_0x432ffa(0x1309),_0x432ffa(0x174a));return;}const _0x1667d6=document[_0x432ffa(0x1262)](_0x432ffa(0x1b8c)),_0xce3d5=document[_0x432ffa(0x1262)](_0x432ffa(0x8f1)),_0x39b148=_0x1667d6&&_0x1667d6[_0x432ffa(0x45c)]&&_0x1667d6[_0x432ffa(0x45c)]!==window[_0x432ffa(0x2184)][_0x432ffa(0x1f9)]?_0x1667d6[_0x432ffa(0x45c)]:null,_0x24ceeb=_0xce3d5&&_0xce3d5[_0x432ffa(0x45c)]&&_0xce3d5['src']!==window['location']['href']?_0xce3d5[_0x432ffa(0x45c)]:null;try{const _0xd096cb={'name':String(_0x46ad89||''),'date':_0x39b4b6?null:String(_0x44e282||''),'time':_0x39b4b6?null:String(_0x2b7345||''),'type':String(_0x21ddf6===_0x432ffa(0xe56)?'other':_0x21ddf6||''),'customType':_0x21ddf6===_0x432ffa(0xe56)?String(_0x4859fa||''):null,'characterId':_0x36c2d4?String(_0x36c2d4):null,'priority':String(_0x4e97c1||_0x432ffa(0x950)),'description':String(_0x32f1bd||''),'userQuote':_0x114710?String(_0x114710):null,'characterQuote':_0x4f1c70?String(_0x4f1c70):null,'isShared':Boolean(_0x44c36a),'isPinned':Boolean(_0xf8cf6),'backgroundImage':_0x39b148?String(_0x39b148):null,'userAvatar':_0x24ceeb?String(_0x24ceeb):null,'countType':String(_0x2f4ec0||'countdown'),'neverExpires':Boolean(_0x39b4b6),'completed':![],'createdBy':_0x432ffa(0xa80),'timestamp':Date[_0x432ffa(0x2eb)]()};if(_0xf8cf6){const _0x1d5b0b=appointments[_0x432ffa(0x1e1f)](_0x6c8106=>_0x6c8106['isPinned']&&_0x6c8106['id']!==_0xd096cb['id']);for(const _0x3e8f07 of _0x1d5b0b){_0x3e8f07[_0x432ffa(0x77e)]=![],await db['appointments'][_0x432ffa(0x1561)](_0x3e8f07);}_0x1d5b0b[_0x432ffa(0x19ee)]>0x0&&console['log']('取消了\x20'+_0x1d5b0b[_0x432ffa(0x19ee)]+_0x432ffa(0x94c));}if(editingAppointmentId){_0xd096cb['id']=String(editingAppointmentId),console[_0x432ffa(0x2187)](_0x432ffa(0x1174),JSON[_0x432ffa(0x6b8)](_0xd096cb,null,0x2)),await db[_0x432ffa(0x22d4)][_0x432ffa(0x1561)](_0xd096cb);const _0x3fea47=appointments[_0x432ffa(0x150c)](_0x479018=>_0x479018['id']===editingAppointmentId);_0x3fea47!==-0x1&&(appointments[_0x3fea47]=_0xd096cb);showToast(_0x432ffa(0x130e),_0x432ffa(0x11cb)),closeAppointmentForm(),loadAppointmentList();if(_0xd096cb['isShared']&&_0xd096cb[_0x432ffa(0xaf5)])try{await recordCrossAppEvent(_0xd096cb[_0x432ffa(0xaf5)],_0x432ffa(0x18e0),_0x432ffa(0x96d),{'id':_0xd096cb['id'],'type':_0x432ffa(0x15ad),'content':_0x432ffa(0x1fc2)+_0xd096cb[_0x432ffa(0x1a1c)]+'\x22（'+_0xd096cb['date']+(_0xd096cb['time']?'\x20'+_0xd096cb[_0x432ffa(0x1236)]:'')+'）'+(_0xd096cb[_0x432ffa(0x7c9)]?'：'+_0xd096cb[_0x432ffa(0x7c9)]:''),'appointmentName':_0xd096cb['name'],'appointmentDate':_0xd096cb['date'],'appointmentTime':_0xd096cb[_0x432ffa(0x1236)],'appointmentType':_0xd096cb[_0x432ffa(0x1a4b)],'description':_0xd096cb['description'],'priority':_0xd096cb[_0x432ffa(0xa11)]}),console['log'](_0x432ffa(0x73a));}catch(_0x2b4b00){console[_0x432ffa(0x174a)]('❌\x20[约定时间线]\x20记录约定更新事件失败:',_0x2b4b00);}}else{_0xd096cb['id']=Date[_0x432ffa(0x2eb)]()[_0x432ffa(0x1878)]()+'_'+Math['random']()[_0x432ffa(0x1878)](0x24)['substr'](0x2,0x9),console['log'](_0x432ffa(0x212),JSON[_0x432ffa(0x6b8)](_0xd096cb,null,0x2)),await db['appointments'][_0x432ffa(0x21e2)](_0xd096cb),appointments['push'](_0xd096cb),showToast(_0x432ffa(0x90b),_0x432ffa(0x11cb));const _0x4ac5da=await db[_0x432ffa(0x22d4)]['toArray']();console[_0x432ffa(0x2187)]('🔍\x20数据库中的所有约定:',_0x4ac5da[_0x432ffa(0x19ee)],_0x4ac5da);if(_0xd096cb[_0x432ffa(0x1f11)]&&_0xd096cb['characterId'])try{await recordCrossAppEvent(_0xd096cb[_0x432ffa(0xaf5)],_0x432ffa(0x18e0),_0x432ffa(0x1207),{'id':_0xd096cb['id'],'type':'appointment_create','content':_0x432ffa(0x2293)+_0xd096cb[_0x432ffa(0x1a1c)]+'\x22（'+_0xd096cb['date']+(_0xd096cb[_0x432ffa(0x1236)]?'\x20'+_0xd096cb[_0x432ffa(0x1236)]:'')+'）'+(_0xd096cb['description']?'：'+_0xd096cb[_0x432ffa(0x7c9)]:''),'appointmentName':_0xd096cb['name'],'appointmentDate':_0xd096cb[_0x432ffa(0x20d4)],'appointmentTime':_0xd096cb['time'],'appointmentType':_0xd096cb['type'],'description':_0xd096cb['description'],'priority':_0xd096cb[_0x432ffa(0xa11)]},_0xd096cb['id']),console['log']('📝\x20[约定时间线]\x20已记录约定创建事件到跨应用时间线');}catch(_0x47b7de){console['error'](_0x432ffa(0xc3b),_0x47b7de);}}!editingAppointmentId&&(closeAppointmentForm(),loadAppointmentList());}catch(_0x285aba){console['error'](_0x432ffa(0x5de),_0x285aba),showToast('保存失败，请重试',_0x432ffa(0x174a));}}function showAnniversaryForm(_0x5595c3=null){const _0x4e95b8=_0x211817;editingAnniversaryId=_0x5595c3;const _0x2124ec=document[_0x4e95b8(0x1262)]('anniversary-form-modal'),_0x1df2ec=document[_0x4e95b8(0x1262)](_0x4e95b8(0x1b1e));populateCharacterSelect(_0x4e95b8(0x573));if(_0x5595c3){_0x1df2ec[_0x4e95b8(0x13be)]=_0x4e95b8(0x18ba);const _0x3b9910=anniversaries[_0x4e95b8(0xaf4)](_0x4e2a8d=>_0x4e2a8d['id']===_0x5595c3);_0x3b9910&&(document[_0x4e95b8(0x1262)](_0x4e95b8(0x261))[_0x4e95b8(0x1ebc)]=_0x3b9910['name'],document[_0x4e95b8(0x1262)](_0x4e95b8(0xfef))[_0x4e95b8(0x1ebc)]=_0x3b9910['date'],_0x3b9910['customType']?(document['getElementById'](_0x4e95b8(0x91a))[_0x4e95b8(0x1ebc)]='other',document[_0x4e95b8(0x1262)]('anniversary-custom-type')[_0x4e95b8(0x1ebc)]=_0x3b9910[_0x4e95b8(0xd1d)],toggleCustomTypeInput(_0x4e95b8(0x1644))):document[_0x4e95b8(0x1262)](_0x4e95b8(0x91a))['value']=_0x3b9910['type'],document['getElementById']('anniversary-character')[_0x4e95b8(0x1ebc)]=_0x3b9910[_0x4e95b8(0xaf5)]||'',document[_0x4e95b8(0x1262)](_0x4e95b8(0x7b1))[_0x4e95b8(0x1ebc)]=_0x3b9910[_0x4e95b8(0x7c9)]||'',document[_0x4e95b8(0x1262)]('anniversary-user-quote')[_0x4e95b8(0x1ebc)]=_0x3b9910[_0x4e95b8(0xc38)]||'',document[_0x4e95b8(0x1262)](_0x4e95b8(0x3c4))['value']=_0x3b9910[_0x4e95b8(0xa26)]||'',document[_0x4e95b8(0x1262)]('anniversary-yearly')[_0x4e95b8(0x14c1)]=_0x3b9910[_0x4e95b8(0x20aa)]!==![],document['getElementById'](_0x4e95b8(0x22e6))[_0x4e95b8(0x14c1)]=_0x3b9910[_0x4e95b8(0x1f11)]===!![],document[_0x4e95b8(0x1262)](_0x4e95b8(0x9e7))[_0x4e95b8(0x14c1)]=_0x3b9910[_0x4e95b8(0x77e)]===!![],document[_0x4e95b8(0x1262)](_0x4e95b8(0x87c))['value']=_0x3b9910['countType']||_0x4e95b8(0x920),_0x3b9910['backgroundImage']&&(document['getElementById'](_0x4e95b8(0x1594))[_0x4e95b8(0x45c)]=_0x3b9910['backgroundImage'],document[_0x4e95b8(0x1262)](_0x4e95b8(0x124e))[_0x4e95b8(0x14eb)][_0x4e95b8(0x4da)]=_0x4e95b8(0x13de)),_0x3b9910[_0x4e95b8(0x865)]&&(document[_0x4e95b8(0x1262)](_0x4e95b8(0x1af0))[_0x4e95b8(0x45c)]=_0x3b9910[_0x4e95b8(0x865)],document[_0x4e95b8(0x1262)](_0x4e95b8(0x7ed))[_0x4e95b8(0x14eb)][_0x4e95b8(0x4da)]='block'),toggleCharacterQuoteGroup(_0x4e95b8(0x1644),_0x3b9910['characterId']));}else _0x1df2ec[_0x4e95b8(0x13be)]=_0x4e95b8(0x1d08),clearAnniversaryForm();_0x2124ec['style'][_0x4e95b8(0x4da)]=_0x4e95b8(0x1fb7);}function closeAnniversaryForm(){const _0x4e08ef=_0x211817;document['getElementById'](_0x4e08ef(0x336))['style']['display']=_0x4e08ef(0x102b),clearAnniversaryForm(),editingAnniversaryId=null;}function clearAnniversaryForm(){const _0x3c060e=_0x211817;document[_0x3c060e(0x1262)]('anniversary-name')[_0x3c060e(0x1ebc)]='',document[_0x3c060e(0x1262)](_0x3c060e(0xfef))[_0x3c060e(0x1ebc)]='',document[_0x3c060e(0x1262)](_0x3c060e(0x91a))['value']='birthday',document[_0x3c060e(0x1262)](_0x3c060e(0x1110))['value']='',document[_0x3c060e(0x1262)](_0x3c060e(0x573))[_0x3c060e(0x1ebc)]='',document[_0x3c060e(0x1262)](_0x3c060e(0x7b1))['value']='',document[_0x3c060e(0x1262)]('anniversary-user-quote')[_0x3c060e(0x1ebc)]='',document[_0x3c060e(0x1262)](_0x3c060e(0x3c4))[_0x3c060e(0x1ebc)]='',document['getElementById'](_0x3c060e(0x649))[_0x3c060e(0x14c1)]=!![],document[_0x3c060e(0x1262)](_0x3c060e(0x22e6))[_0x3c060e(0x14c1)]=![],document[_0x3c060e(0x1262)]('anniversary-pinned')[_0x3c060e(0x14c1)]=![],document['getElementById'](_0x3c060e(0x87c))[_0x3c060e(0x1ebc)]=_0x3c060e(0x920),document[_0x3c060e(0x1262)]('anniversary-background-upload')[_0x3c060e(0x1ebc)]='',document['getElementById'](_0x3c060e(0x1f6a))[_0x3c060e(0x1ebc)]='',document[_0x3c060e(0x1262)](_0x3c060e(0x124e))[_0x3c060e(0x14eb)]['display']=_0x3c060e(0x102b),document[_0x3c060e(0x1262)]('anniversary-user-avatar-preview')[_0x3c060e(0x14eb)][_0x3c060e(0x4da)]=_0x3c060e(0x102b),toggleCharacterQuoteGroup(_0x3c060e(0x1644),''),toggleCustomTypeInput('anniversary');}function populateCharacterSelect(_0x1e38d6){const _0x2fa5e4=_0x211817,_0x5603e0=document[_0x2fa5e4(0x1262)](_0x1e38d6),_0x30ceec=_0x5603e0[_0x2fa5e4(0x1ebc)];_0x5603e0[_0x2fa5e4(0x33a)]=_0x2fa5e4(0xd76),characters[_0x2fa5e4(0x19fb)](_0x136aa7=>{const _0xc2257c=_0x2fa5e4,_0x3788a0=document[_0xc2257c(0xac6)](_0xc2257c(0x627));_0x3788a0[_0xc2257c(0x1ebc)]=_0x136aa7['id'],_0x3788a0['textContent']=_0x136aa7[_0xc2257c(0x1a1c)],_0x5603e0[_0xc2257c(0x497)](_0x3788a0);}),_0x30ceec&&(_0x5603e0[_0x2fa5e4(0x1ebc)]=_0x30ceec);}function toggleCharacterQuoteGroup(_0x44f401,_0x10f894){const _0xd79fb6=_0x211817,_0x1f3aec=document[_0xd79fb6(0x1262)](_0x44f401+_0xd79fb6(0x55b)),_0x1a723b=document['getElementById'](_0x44f401+'-character-quote'),_0x4bd63a=document[_0xd79fb6(0x1262)](_0x44f401+'-quote-label');if(_0x10f894){const _0x34650b=characters[_0xd79fb6(0xaf4)](_0xc4c454=>_0xc4c454['id']===_0x10f894);_0x34650b&&(_0x1f3aec[_0xd79fb6(0x14eb)]['display']='block',_0x4bd63a[_0xd79fb6(0x13be)]=_0xd79fb6(0x202d),_0x1a723b['placeholder']=_0x34650b[_0xd79fb6(0x1a1c)]+_0xd79fb6(0x20da)+(_0x44f401===_0xd79fb6(0x1644)?_0xd79fb6(0x2a9):'约定')+_0xd79fb6(0x15b8));}else _0x1f3aec['style']['display']=_0xd79fb6(0x102b),_0x1a723b[_0xd79fb6(0x1ebc)]='';}function toggleCustomTypeInput(_0x566e9b){const _0x57eaf2=_0x211817,_0xfcfe79=document['getElementById'](_0x566e9b+_0x57eaf2(0x10ec)),_0x4999f5=document[_0x57eaf2(0x1262)](_0x566e9b+_0x57eaf2(0x2f0)),_0x4b5064=document[_0x57eaf2(0x1262)](_0x566e9b+'-custom-type');_0xfcfe79[_0x57eaf2(0x1ebc)]===_0x57eaf2(0xe56)?(_0x4999f5['style'][_0x57eaf2(0x4da)]=_0x57eaf2(0x13de),_0x4b5064[_0x57eaf2(0x13cf)]()):(_0x4999f5[_0x57eaf2(0x14eb)][_0x57eaf2(0x4da)]=_0x57eaf2(0x102b),_0x4b5064[_0x57eaf2(0x1ebc)]='');}function toggleNeverExpires(_0x1f5309){const _0x66aa0d=_0x211817,_0x57ac2c=document[_0x66aa0d(0x1262)](_0x1f5309+_0x66aa0d(0x177c)),_0x2518b6=document[_0x66aa0d(0x1262)](_0x1f5309+'-date'),_0x5769eb=document[_0x66aa0d(0x1262)](_0x1f5309+_0x66aa0d(0xd9f));_0x57ac2c[_0x66aa0d(0x14c1)]?(_0x2518b6['disabled']=!![],_0x5769eb[_0x66aa0d(0x559)]=!![],_0x2518b6[_0x66aa0d(0x14eb)]['opacity']=_0x66aa0d(0x1a21),_0x5769eb[_0x66aa0d(0x14eb)]['opacity']=_0x66aa0d(0x1a21),_0x2518b6[_0x66aa0d(0x1ebc)]='',_0x5769eb[_0x66aa0d(0x1ebc)]=''):(_0x2518b6[_0x66aa0d(0x559)]=![],_0x5769eb[_0x66aa0d(0x559)]=![],_0x2518b6['style'][_0x66aa0d(0x11af)]='1',_0x5769eb['style'][_0x66aa0d(0x11af)]='1');}async function saveAnniversary(_0x5a0dd9){const _0x5c193b=_0x211817;_0x5a0dd9&&(_0x5a0dd9[_0x5c193b(0x36f)](),_0x5a0dd9[_0x5c193b(0x902)]());const _0x52d974=document[_0x5c193b(0x1262)](_0x5c193b(0x261))[_0x5c193b(0x1ebc)][_0x5c193b(0x19d7)](),_0x5adece=document[_0x5c193b(0x1262)](_0x5c193b(0xfef))['value'],_0x430b59=document['getElementById'](_0x5c193b(0x91a))[_0x5c193b(0x1ebc)],_0x24a640=document[_0x5c193b(0x1262)](_0x5c193b(0x1110))[_0x5c193b(0x1ebc)][_0x5c193b(0x19d7)](),_0x462b73=document[_0x5c193b(0x1262)](_0x5c193b(0x573))['value'],_0x12d257=document['getElementById'](_0x5c193b(0x7b1))['value'][_0x5c193b(0x19d7)](),_0x3eff3c=document[_0x5c193b(0x1262)](_0x5c193b(0x44d))[_0x5c193b(0x1ebc)]['trim'](),_0x1c83a5=document[_0x5c193b(0x1262)](_0x5c193b(0x3c4))[_0x5c193b(0x1ebc)][_0x5c193b(0x19d7)](),_0x107ab8=document['getElementById'](_0x5c193b(0x649))[_0x5c193b(0x14c1)],_0x54676d=document[_0x5c193b(0x1262)](_0x5c193b(0x22e6))[_0x5c193b(0x14c1)],_0x315c66=document['getElementById'](_0x5c193b(0x9e7))['checked'],_0x25ac2c=document[_0x5c193b(0x1262)](_0x5c193b(0x87c))[_0x5c193b(0x1ebc)];if(!_0x52d974||!_0x5adece){showToast(_0x5c193b(0x1118),_0x5c193b(0x174a));return;}if(_0x430b59===_0x5c193b(0xe56)&&!_0x24a640){showToast(_0x5c193b(0x1309),_0x5c193b(0x174a));return;}const _0x5d0549=document[_0x5c193b(0x1262)](_0x5c193b(0x1594)),_0x4cc36f=document['getElementById']('anniversary-user-avatar-img'),_0x5113c0=_0x5d0549&&_0x5d0549[_0x5c193b(0x45c)]&&_0x5d0549[_0x5c193b(0x45c)]!==window['location'][_0x5c193b(0x1f9)]?_0x5d0549[_0x5c193b(0x45c)]:null,_0x83dee9=_0x4cc36f&&_0x4cc36f[_0x5c193b(0x45c)]&&_0x4cc36f[_0x5c193b(0x45c)]!==window[_0x5c193b(0x2184)][_0x5c193b(0x1f9)]?_0x4cc36f[_0x5c193b(0x45c)]:null,_0x1ec552={'id':String(editingAnniversaryId||Date[_0x5c193b(0x2eb)]()[_0x5c193b(0x1878)]()),'name':String(_0x52d974||''),'date':String(_0x5adece||''),'type':String(_0x430b59===_0x5c193b(0xe56)?'other':_0x430b59||''),'customType':_0x430b59===_0x5c193b(0xe56)?String(_0x24a640||''):null,'characterId':_0x462b73?String(_0x462b73):null,'description':String(_0x12d257||''),'userQuote':_0x3eff3c?String(_0x3eff3c):null,'characterQuote':_0x1c83a5?String(_0x1c83a5):null,'yearly':Boolean(_0x107ab8),'isShared':Boolean(_0x54676d),'isPinned':Boolean(_0x315c66),'backgroundImage':_0x5113c0?String(_0x5113c0):null,'userAvatar':_0x83dee9?String(_0x83dee9):null,'countType':String(_0x25ac2c||_0x5c193b(0x920)),'createdBy':_0x5c193b(0xa80),'createdAt':editingAnniversaryId?anniversaries[_0x5c193b(0xaf4)](_0x17792b=>_0x17792b['id']===editingAnniversaryId)?.['createdAt']||new Date()[_0x5c193b(0x1034)]():new Date()[_0x5c193b(0x1034)]()};try{if(_0x315c66){const _0x2317e6=anniversaries[_0x5c193b(0x1e1f)](_0xe6d68d=>_0xe6d68d['isPinned']&&_0xe6d68d['id']!==_0x1ec552['id']);for(const _0x117328 of _0x2317e6){_0x117328['isPinned']=![],await db[_0x5c193b(0x1d0c)][_0x5c193b(0x1561)](_0x117328);}_0x2317e6[_0x5c193b(0x19ee)]>0x0&&console[_0x5c193b(0x2187)](_0x5c193b(0x1ff7)+_0x2317e6[_0x5c193b(0x19ee)]+_0x5c193b(0xb34));}if(editingAnniversaryId){await db[_0x5c193b(0x1d0c)][_0x5c193b(0x1561)](_0x1ec552);const _0x5fd81=anniversaries[_0x5c193b(0x150c)](_0x319607=>_0x319607['id']===editingAnniversaryId);_0x5fd81!==-0x1&&(anniversaries[_0x5fd81]=_0x1ec552);showToast(_0x5c193b(0xb89),'success');if(_0x1ec552['isShared']&&_0x1ec552[_0x5c193b(0xaf5)])try{await recordCrossAppEvent(_0x1ec552[_0x5c193b(0xaf5)],_0x5c193b(0x1644),'update',{'id':_0x1ec552['id'],'type':_0x5c193b(0x10f1),'content':_0x5c193b(0x3ad)+_0x1ec552['name']+'\x22（'+_0x1ec552[_0x5c193b(0x20d4)]+'）'+(_0x1ec552['description']?'：'+_0x1ec552[_0x5c193b(0x7c9)]:''),'anniversaryName':_0x1ec552['name'],'anniversaryDate':_0x1ec552[_0x5c193b(0x20d4)],'anniversaryType':_0x1ec552[_0x5c193b(0x1a4b)],'description':_0x1ec552[_0x5c193b(0x7c9)],'countType':_0x1ec552[_0x5c193b(0x1710)]}),console[_0x5c193b(0x2187)](_0x5c193b(0x101d));}catch(_0x486370){console['error']('❌\x20[纪念日时间线]\x20记录纪念日更新事件失败:',_0x486370);}}else{await db[_0x5c193b(0x1d0c)][_0x5c193b(0x21e2)](_0x1ec552),anniversaries['push'](_0x1ec552),showToast(_0x5c193b(0x7bf),_0x5c193b(0x11cb));if(_0x1ec552[_0x5c193b(0x1f11)]&&_0x1ec552[_0x5c193b(0xaf5)])try{await recordCrossAppEvent(_0x1ec552[_0x5c193b(0xaf5)],_0x5c193b(0x1644),_0x5c193b(0x1207),{'id':_0x1ec552['id'],'type':_0x5c193b(0x157f),'content':_0x5c193b(0x10ae)+_0x1ec552[_0x5c193b(0x1a1c)]+'\x22（'+_0x1ec552[_0x5c193b(0x20d4)]+'）'+(_0x1ec552[_0x5c193b(0x7c9)]?'：'+_0x1ec552[_0x5c193b(0x7c9)]:''),'anniversaryName':_0x1ec552[_0x5c193b(0x1a1c)],'anniversaryDate':_0x1ec552[_0x5c193b(0x20d4)],'anniversaryType':_0x1ec552['type'],'description':_0x1ec552[_0x5c193b(0x7c9)],'countType':_0x1ec552['countType']},_0x1ec552['id']),console[_0x5c193b(0x2187)]('📝\x20[纪念日时间线]\x20已记录纪念日创建事件到跨应用时间线');}catch(_0x2a3f89){console[_0x5c193b(0x174a)](_0x5c193b(0x1e6e),_0x2a3f89);}}closeAnniversaryForm(),loadAnniversaryList(),_0x1ec552[_0x5c193b(0x77e)]&&setTimeout(()=>{const _0x3cb405=_0x5c193b;localStorage[_0x3cb405(0x192)](_0x3cb405(0x48d),_0x1ec552['id']),displayAnniversaryWidget(_0x1ec552);},0x64);}catch(_0x389b2a){console[_0x5c193b(0x174a)](_0x5c193b(0x740),_0x389b2a),showToast(_0x5c193b(0x963),_0x5c193b(0x174a));}}async function loadAnniversaryList(){const _0x1d75c8=_0x211817;try{if(!db||!db[_0x1d75c8(0x1d0c)]){console[_0x1d75c8(0x1f43)](_0x1d75c8(0x1292)),anniversaries=[],renderAnniversaryList();return;}anniversaries=await db[_0x1d75c8(0x1d0c)][_0x1d75c8(0xe30)](_0x1d75c8(0x20d4))['toArray'](),renderAnniversaryList();}catch(_0x5754cc){console[_0x1d75c8(0x174a)](_0x1d75c8(0x15b5),_0x5754cc),anniversaries=[],renderAnniversaryList();}}function renderAnniversaryList(){const _0x1c9a7e=_0x211817,_0x5ad488=document[_0x1c9a7e(0x1262)](_0x1c9a7e(0x1ac9)),_0x4cb85a=document[_0x1c9a7e(0x1262)](_0x1c9a7e(0x1f16)),_0x50766f=document[_0x1c9a7e(0x1262)]('pinned-anniversary-card'),_0x100e69=anniversaries[_0x1c9a7e(0x1e1f)](_0x592d51=>_0x592d51[_0x1c9a7e(0x77e)]),_0x1fb283=anniversaries[_0x1c9a7e(0x1e1f)](_0x1e8078=>!_0x1e8078[_0x1c9a7e(0x77e)]);if(_0x100e69[_0x1c9a7e(0x19ee)]>0x0){const _0x304df5=_0x100e69[0x0];renderPinnedAnniversary(_0x304df5),_0x4cb85a['style'][_0x1c9a7e(0x4da)]='block';}else _0x4cb85a['style'][_0x1c9a7e(0x4da)]='none';if(_0x1fb283[_0x1c9a7e(0x19ee)]===0x0&&_0x100e69[_0x1c9a7e(0x19ee)]===0x0){_0x5ad488[_0x1c9a7e(0x33a)]=_0x1c9a7e(0xd4c);return;}const _0x3d3123=new Date(),_0x4cca52=_0x3d3123[_0x1c9a7e(0x16a0)]();_0x5ad488[_0x1c9a7e(0x33a)]=_0x1fb283['map'](_0x4719d5=>{const _0x288414=_0x1c9a7e,_0x5da253=new Date(_0x4719d5[_0x288414(0x20d4)]),_0x50c8ac=_0x4719d5[_0x288414(0x1710)]||_0x288414(0x920);let _0x29fab0='';if(_0x50c8ac==='countup'){const _0x4e2a0e=new Date(_0x3d3123[_0x288414(0x16a0)](),_0x3d3123[_0x288414(0x1da)](),_0x3d3123[_0x288414(0x520)]()),_0x33a925=new Date(_0x5da253[_0x288414(0x16a0)](),_0x5da253[_0x288414(0x1da)](),_0x5da253[_0x288414(0x520)]()),_0x73b51a=Math['floor']((_0x4e2a0e-_0x33a925)/(0x3e8*0x3c*0x3c*0x18));_0x29fab0=_0x73b51a===0x0?'今天':_0x288414(0x391)+_0x73b51a+'\x20天';}else{const _0x2bdb90=new Date(_0x3d3123[_0x288414(0x16a0)](),_0x3d3123[_0x288414(0x1da)](),_0x3d3123['getDate']());let _0x2d29c2=new Date(_0x4cca52,_0x5da253[_0x288414(0x1da)](),_0x5da253[_0x288414(0x520)]());_0x2d29c2<_0x2bdb90&&_0x2d29c2[_0x288414(0x17e7)](_0x4cca52+0x1);const _0x5b5040=Math[_0x288414(0x2180)]((_0x2d29c2-_0x2bdb90)/(0x3e8*0x3c*0x3c*0x18));_0x29fab0=_0x5b5040===0x0?'今天':_0x5b5040===0x1?'明天':'还有\x20'+_0x5b5040+'\x20天';}const _0x51a90f=_0x4719d5[_0x288414(0xaf5)]?characters[_0x288414(0xaf4)](_0x35934c=>_0x35934c['id']===_0x4719d5[_0x288414(0xaf5)]):null,_0x15132e=_0x51a90f?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x51a90f['avatar']||_0x51a90f[_0x288414(0x1994)]||createDefaultAvatar(_0x51a90f['name']))+_0x288414(0x222c)+_0x51a90f['name']+_0x288414(0xac0)+_0x51a90f['name'][_0x288414(0xcc3)](0x0)+_0x288414(0x13e1)+_0x51a90f[_0x288414(0x1a1c)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'',_0x1b8d06=_0x4719d5[_0x288414(0xc38)]?_0x288414(0x145a)+escapeHtml(_0x4719d5['userQuote'])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'',_0xd274f4=_0x4719d5[_0x288414(0xa26)]?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-character-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+escapeHtml(_0x4719d5[_0x288414(0xa26)])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';return _0x288414(0x1cca)+(_0x4719d5[_0x288414(0x1f11)]?_0x288414(0x219e):'')+_0x288414(0x7d6)+_0x4719d5['id']+_0x288414(0xc6e)+_0x4719d5['id']+_0x288414(0x403)+escapeHtml(_0x4719d5[_0x288414(0x1a1c)])+_0x288414(0x1bec)+_0x29fab0+_0x288414(0x1b47)+escapeHtml(_0x4719d5[_0x288414(0x1a1c)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-date\x22>'+formatDate(_0x4719d5[_0x288414(0x20d4)])+_0x288414(0x15d1)+_0x15132e+_0x288414(0x1e1b)+_0x4719d5['type']+'\x22>'+getTypeText(_0x4719d5)+_0x288414(0x17f2)+(_0x4719d5[_0x288414(0x7c9)]?_0x288414(0xc52)+escapeHtml(_0x4719d5[_0x288414(0x7c9)])+_0x288414(0x1844):'')+_0x288414(0x1255)+_0x1b8d06+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xd274f4+_0x288414(0x3b9)+_0x4719d5['id']+'\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22anniversary-action-btn\x20anniversary-delete-btn\x22\x20onclick=\x22deleteAnniversary(\x27'+_0x4719d5['id']+_0x288414(0x12be);})['join']('');const _0x15d3e7=localStorage[_0x1c9a7e(0x15d8)](_0x1c9a7e(0x48d));let _0x50c35d=null;_0x15d3e7&&(_0x50c35d=anniversaries[_0x1c9a7e(0xaf4)](_0x9d2f94=>_0x9d2f94['id']===_0x15d3e7));if(!_0x50c35d&&anniversaries[_0x1c9a7e(0x19ee)]>0x0){const _0x5864c7=anniversaries[_0x1c9a7e(0xaf4)](_0x338faa=>_0x338faa[_0x1c9a7e(0x77e)]);_0x5864c7&&(_0x50c35d=_0x5864c7,localStorage[_0x1c9a7e(0x192)](_0x1c9a7e(0x48d),_0x5864c7['id']));}if(_0x50c35d)displayAnniversaryWidget(_0x50c35d);else anniversaries[_0x1c9a7e(0x19ee)]===0x0&&clearAnniversaryWidget();}async function deleteAnniversary(_0x12afbf){const _0x3eb0d0=_0x211817;if(confirm(_0x3eb0d0(0x11c6)))try{await db[_0x3eb0d0(0x1d0c)]['delete'](_0x12afbf),anniversaries=anniversaries[_0x3eb0d0(0x1e1f)](_0x167493=>_0x167493['id']!==_0x12afbf),renderAnniversaryList(),setTimeout(()=>{refreshAnniversaryWidget();},0x64),showToast(_0x3eb0d0(0x55e),_0x3eb0d0(0x11cb));}catch(_0xe5c11c){console['error'](_0x3eb0d0(0xb22),_0xe5c11c),showToast(_0x3eb0d0(0x1fcf),'error');}}async function unpinAnniversary(_0x53979c){const _0xf618a4=_0x211817;try{const _0x30722f=anniversaries[_0xf618a4(0xaf4)](_0x368935=>_0x368935['id']===_0x53979c);_0x30722f&&(_0x30722f[_0xf618a4(0x77e)]=![],await db[_0xf618a4(0x1d0c)][_0xf618a4(0x1561)](_0x30722f),renderAnniversaryList(),showToast(_0xf618a4(0x20ea),_0xf618a4(0x11cb)));}catch(_0x17afd2){console[_0xf618a4(0x174a)]('取消置顶失败:',_0x17afd2),showToast('操作失败，请重试','error');}}function toggleAnniversaryItem(_0x132728,_0x567d13){const _0x20f50c=_0x211817;_0x132728[_0x20f50c(0x902)]();const _0x135c1e=_0x132728['currentTarget'],_0x3dfadf=_0x135c1e[_0x20f50c(0x1c1b)][_0x20f50c(0x971)](_0x20f50c(0x10de));document['querySelectorAll'](_0x20f50c(0xbbd))[_0x20f50c(0x19fb)](_0x570fc6=>{const _0x57e185=_0x20f50c;_0x570fc6!==_0x135c1e&&_0x570fc6[_0x57e185(0x1c1b)][_0x57e185(0x1493)](_0x57e185(0x10de));}),_0x3dfadf?_0x135c1e[_0x20f50c(0x1c1b)]['remove']('expanded'):_0x135c1e[_0x20f50c(0x1c1b)][_0x20f50c(0x21e2)]('expanded');}async function loadAppointmentList(){const _0x15777b=_0x211817;try{if(!db||!db[_0x15777b(0x22d4)]){console[_0x15777b(0x1f43)](_0x15777b(0x1b38)),appointments=[],renderAppointmentList();return;}appointments=await db[_0x15777b(0x22d4)][_0x15777b(0xf13)](),console[_0x15777b(0x2187)](_0x15777b(0x2f2),appointments[_0x15777b(0x19ee)]),console['log'](_0x15777b(0x11a1),appointments),renderAppointmentList();}catch(_0x4bc559){console[_0x15777b(0x174a)](_0x15777b(0x18b0),_0x4bc559),appointments=[],renderAppointmentList();}}function renderAppointmentList(){const _0x1a7024=_0x211817,_0x2e8219=document[_0x1a7024(0x1262)](_0x1a7024(0x3e6));if(appointments['length']===0x0){_0x2e8219[_0x1a7024(0x33a)]=_0x1a7024(0x4d8);return;}const _0x49e8f7=appointments[_0x1a7024(0x1e1f)](_0x4eab17=>_0x4eab17[_0x1a7024(0x77e)]),_0x47460f=appointments[_0x1a7024(0x1e1f)](_0x4cd7c3=>!_0x4cd7c3[_0x1a7024(0x77e)]);if(_0x49e8f7[_0x1a7024(0x19ee)]>0x0){const _0x38263e=_0x49e8f7[0x0];renderPinnedAppointment(_0x38263e),document['getElementById'](_0x1a7024(0x1c52))[_0x1a7024(0x14eb)][_0x1a7024(0x4da)]=_0x1a7024(0x13de);}else document['getElementById'](_0x1a7024(0x1c52))[_0x1a7024(0x14eb)]['display']='none';const _0x33ab48=[..._0x47460f]['sort']((_0x39478d,_0x1d8b88)=>{const _0x3f4276=_0x1a7024;if(_0x39478d[_0x3f4276(0x1743)]!==_0x1d8b88[_0x3f4276(0x1743)])return _0x39478d[_0x3f4276(0x1743)]?0x1:-0x1;if(_0x39478d['neverExpires']!==_0x1d8b88[_0x3f4276(0x71d)])return _0x39478d[_0x3f4276(0x71d)]?0x1:-0x1;if(!_0x39478d['neverExpires']&&!_0x1d8b88[_0x3f4276(0x71d)])return new Date(_0x39478d[_0x3f4276(0x20d4)]+'\x20'+(_0x39478d[_0x3f4276(0x1236)]||'00:00'))-new Date(_0x1d8b88[_0x3f4276(0x20d4)]+'\x20'+(_0x1d8b88['time']||_0x3f4276(0x73f)));return(_0x39478d['timestamp']||0x0)-(_0x1d8b88[_0x3f4276(0x1716)]||0x0);});_0x2e8219[_0x1a7024(0x33a)]=_0x33ab48['map'](_0x155e02=>{const _0x3490c9=_0x1a7024;let _0x3b18b7=_0x3490c9(0x37b),_0x26d8ab='',_0x425126=![];if(_0x155e02[_0x3490c9(0x71d)])_0x3b18b7=_0x155e02['completed']?_0x3490c9(0x1743):_0x3490c9(0x1f64),_0x26d8ab=_0x155e02[_0x3490c9(0x1743)]?'已完成':'永不过期';else{const _0x58944e=new Date(_0x155e02[_0x3490c9(0x20d4)]+'\x20'+(_0x155e02[_0x3490c9(0x1236)]||_0x3490c9(0x73f))),_0x242083=new Date();_0x425126=_0x58944e<_0x242083&&!_0x155e02[_0x3490c9(0x1743)];if(_0x155e02[_0x3490c9(0x1743)])_0x3b18b7=_0x3490c9(0x1743),_0x26d8ab=_0x3490c9(0xa90);else{if(_0x425126){_0x3b18b7=_0x3490c9(0x13f1);const _0x375443=Math['floor']((_0x242083-_0x58944e)/(0x3e8*0x3c*0x3c*0x18));_0x26d8ab=_0x3490c9(0x1047)+_0x375443+'\x20天';}else{const _0x37cab2=_0x58944e-_0x242083,_0x2ad0a4=Math[_0x3490c9(0x708)](_0x37cab2/(0x3e8*0x3c*0x3c*0x18));if(_0x2ad0a4===0x0)_0x26d8ab='今天';else _0x2ad0a4===0x1?_0x26d8ab='明天':_0x26d8ab=_0x3490c9(0x157e)+_0x2ad0a4+'\x20天';}}}const _0x459740=_0x155e02['characterId']?characters[_0x3490c9(0xaf4)](_0x1c3ca3=>_0x1c3ca3['id']===_0x155e02[_0x3490c9(0xaf5)]):null,_0x1abae7=_0x155e02['userQuote']?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+escapeHtml(_0x155e02[_0x3490c9(0xc38)])+_0x3490c9(0x115b):'';return _0x3490c9(0x18e)+(_0x155e02[_0x3490c9(0x1743)]?_0x3490c9(0x1743):'')+'\x20'+(_0x425126?_0x3490c9(0x13f1):'')+'\x20'+(_0x155e02[_0x3490c9(0x1f11)]?_0x3490c9(0x219e):'')+_0x3490c9(0x59f)+_0x155e02['id']+_0x3490c9(0x16c9)+escapeHtml(_0x155e02[_0x3490c9(0x1a1c)])+_0x3490c9(0x1551)+_0x3b18b7+'\x22>'+_0x26d8ab+_0x3490c9(0x1f6b)+escapeHtml(_0x155e02['name'])+_0x3490c9(0x997)+(_0x155e02['neverExpires']?_0x3490c9(0x169e):formatAppointmentDate(_0x155e02['date'],_0x155e02[_0x3490c9(0x1236)]))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22appointment-type-tag\x22>'+getAppointmentTypeText(_0x155e02)+_0x3490c9(0x1bf1)+_0x155e02['id']+_0x3490c9(0x1cfa)+(_0x155e02['description']?_0x3490c9(0x1e7)+escapeHtml(_0x155e02[_0x3490c9(0x7c9)])+_0x3490c9(0xea9):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x459740?'<p><strong>相关角色：</strong>'+_0x459740[_0x3490c9(0x1a1c)]+_0x3490c9(0xea9):'')+_0x3490c9(0x1255)+(_0x155e02[_0x3490c9(0xa26)]?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-character-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+escapeHtml(_0x155e02[_0x3490c9(0xa26)])+_0x3490c9(0x1468):'')+_0x3490c9(0x133c)+(!_0x155e02[_0x3490c9(0x1743)]?_0x3490c9(0x149e)+_0x155e02['id']+_0x3490c9(0x1a18):_0x3490c9(0x133a))+_0x3490c9(0x1e39)+_0x155e02['id']+_0x3490c9(0xe0c);})[_0x1a7024(0x122b)]('');}function getStatusText(_0x1ec4e4){const _0x45c352=_0x211817;switch(_0x1ec4e4){case _0x45c352(0x1743):return'已完成';case'overdue':return _0x45c352(0x12ef);case _0x45c352(0x37b):return'待完成';default:return _0x45c352(0xfb3);}}function toggleAppointmentExpansion(_0x439a94){const _0x5f3373=_0x211817,_0x50ccf4=document[_0x5f3373(0xb30)](_0x5f3373(0xde1)+_0x439a94+'\x22]');_0x50ccf4&&_0x50ccf4[_0x5f3373(0x1c1b)][_0x5f3373(0x1e3f)]('expanded');}function renderPinnedAppointment(_0x352239){const _0x4d62bc=_0x211817,_0x24d0dc=document[_0x4d62bc(0x1262)]('pinned-appointment-card'),_0x4882b6=new Date(),_0x4dbf19=_0x4882b6[_0x4d62bc(0x16a0)](),_0x1a53bb=_0x352239['countType']||_0x4d62bc(0x920);let _0x47697b='',_0x53bbe5='';if(_0x352239[_0x4d62bc(0x71d)])_0x47697b='∞',_0x53bbe5='';else{const _0x4b4729=new Date(_0x352239[_0x4d62bc(0x20d4)]+'\x20'+(_0x352239[_0x4d62bc(0x1236)]||_0x4d62bc(0x73f)));if(_0x1a53bb===_0x4d62bc(0x1f15)){const _0x10e129=new Date(_0x4882b6[_0x4d62bc(0x16a0)](),_0x4882b6['getMonth'](),_0x4882b6['getDate']()),_0x58a092=new Date(_0x4b4729[_0x4d62bc(0x16a0)](),_0x4b4729[_0x4d62bc(0x1da)](),_0x4b4729[_0x4d62bc(0x520)]()),_0x3ccaeb=Math[_0x4d62bc(0x2180)]((_0x10e129-_0x58a092)/(0x3e8*0x3c*0x3c*0x18));_0x47697b=_0x3ccaeb===0x0?'今天':''+_0x3ccaeb,_0x53bbe5=_0x3ccaeb===0x0?'':'天';}else{const _0x5818dc=new Date(_0x4882b6[_0x4d62bc(0x16a0)](),_0x4882b6[_0x4d62bc(0x1da)](),_0x4882b6[_0x4d62bc(0x520)]()),_0x177107=new Date(_0x4b4729[_0x4d62bc(0x16a0)](),_0x4b4729[_0x4d62bc(0x1da)](),_0x4b4729['getDate']()),_0x4a4699=Math[_0x4d62bc(0x2180)]((_0x177107-_0x5818dc)/(0x3e8*0x3c*0x3c*0x18));_0x47697b=_0x4a4699===0x0?'今天':_0x4a4699===0x1?'明天':_0x4a4699<0x0?''+Math[_0x4d62bc(0x1b24)](_0x4a4699):''+_0x4a4699,_0x53bbe5=_0x4a4699===0x0?'':_0x4a4699===0x1?'':_0x4a4699<0x0?'天前':'天';}}const _0x56b84d=_0x352239['characterId']?characters['find'](_0x312a4d=>_0x312a4d['id']===_0x352239[_0x4d62bc(0xaf5)]):null,_0xf0bd19=_0x352239[_0x4d62bc(0x159c)]?'<div\x20class=\x22pinned-card-background\x22\x20style=\x22background-image:\x20url(\x27'+_0x352239[_0x4d62bc(0x159c)]+'\x27)\x22></div>':'';let _0xf07f71='';(_0x352239[_0x4d62bc(0x865)]||_0x56b84d)&&(_0xf07f71=_0x4d62bc(0x479),_0x56b84d&&(_0xf07f71+=_0x4d62bc(0x1039)+(_0x56b84d[_0x4d62bc(0x1f8a)]||_0x56b84d[_0x4d62bc(0x1994)]||createDefaultAvatar(_0x56b84d['name']))+_0x4d62bc(0x222c)+_0x56b84d[_0x4d62bc(0x1a1c)]+_0x4d62bc(0x9d9)+_0x56b84d['name'][_0x4d62bc(0xcc3)](0x0)+_0x4d62bc(0x1ac)),_0x352239[_0x4d62bc(0x865)]&&(_0xf07f71+=_0x4d62bc(0x1039)+_0x352239[_0x4d62bc(0x865)]+_0x4d62bc(0x21e6)),_0xf07f71+=_0x4d62bc(0x1844));const _0x384ed2=_0x352239[_0x4d62bc(0x1a4b)]||_0x4d62bc(0xe56),_0xd686c8=getAppointmentTypeText(_0x352239),_0x343d4d=getPriorityText(_0x352239['priority']),_0x416a35=_0x352239[_0x4d62bc(0xa11)]||_0x4d62bc(0x950),_0x2e35aa=_0x352239[_0x4d62bc(0xc38)]?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quote-author\x22>你：</span>'+escapeHtml(_0x352239[_0x4d62bc(0xc38)])+_0x4d62bc(0x3db):'',_0x1824bd=_0x352239['characterQuote']?_0x4d62bc(0x1466)+(_0x56b84d?_0x56b84d['name']:'角色')+_0x4d62bc(0x14d0)+escapeHtml(_0x352239[_0x4d62bc(0xa26)])+_0x4d62bc(0x3db):'';_0x24d0dc[_0x4d62bc(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xf0bd19+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xf07f71+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-type\x20'+_0x384ed2+'\x22>'+_0xd686c8+_0x4d62bc(0x67d)+escapeHtml(_0x352239[_0x4d62bc(0x1a1c)])+_0x4d62bc(0x2037)+_0x47697b+_0x4d62bc(0xdde)+_0x53bbe5+_0x4d62bc(0x12cf)+(_0x352239[_0x4d62bc(0x71d)]?_0x4d62bc(0x169e):(_0x1a53bb===_0x4d62bc(0x1f15)?'起始日':_0x4d62bc(0x7e1))+'\x20'+formatAppointmentDate(_0x352239[_0x4d62bc(0x20d4)],_0x352239[_0x4d62bc(0x1236)]))+_0x4d62bc(0x406)+_0x2e35aa+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1824bd+_0x4d62bc(0xe15)+_0x352239['id']+_0x4d62bc(0xaf1)+_0x416a35+'\x22>'+_0x343d4d+_0x4d62bc(0xee4),_0x24d0dc[_0x4d62bc(0x1ecd)][_0x4d62bc(0x10f5)]=_0x352239['id'],_0x24d0dc['onclick']=function(_0x593920){const _0x5116a8=_0x4d62bc;!_0x593920[_0x5116a8(0x193d)][_0x5116a8(0x216a)]('.pinned-card-actions')&&showAppointmentForm(_0x352239['id']);};}async function toggleAppointmentComplete(_0x4559de){const _0x2d4052=_0x211817;try{const _0x140fdd=appointments[_0x2d4052(0xaf4)](_0x26866a=>_0x26866a['id']===_0x4559de);_0x140fdd&&(_0x140fdd[_0x2d4052(0x1743)]=!_0x140fdd[_0x2d4052(0x1743)],await db[_0x2d4052(0x22d4)][_0x2d4052(0x1561)](_0x140fdd),renderAppointmentList(),showToast(_0x140fdd[_0x2d4052(0x1743)]?_0x2d4052(0x296):_0x2d4052(0x11fe),'success'));}catch(_0x449332){console[_0x2d4052(0x174a)]('更新约定状态失败:',_0x449332),showToast(_0x2d4052(0x12bd),_0x2d4052(0x174a));}}async function deleteAppointment(_0x577279){const _0x5c4b39=_0x211817;if(confirm(_0x5c4b39(0xe62)))try{await db['appointments'][_0x5c4b39(0x1f4a)](_0x577279),appointments=appointments[_0x5c4b39(0x1e1f)](_0x3d26=>_0x3d26['id']!==_0x577279),renderAppointmentList(),showToast('约定已删除',_0x5c4b39(0x11cb));}catch(_0xf100de){console[_0x5c4b39(0x174a)](_0x5c4b39(0x12a9),_0xf100de),showToast(_0x5c4b39(0x1fcf),_0x5c4b39(0x174a));}}async function unpinAppointment(_0x3407f8){const _0x27fbb1=_0x211817;try{const _0x2681c6=appointments['find'](_0x2d4012=>_0x2d4012['id']===_0x3407f8);_0x2681c6&&(_0x2681c6[_0x27fbb1(0x77e)]=![],await db[_0x27fbb1(0x22d4)]['put'](_0x2681c6),renderAppointmentList(),showToast(_0x27fbb1(0x20ea),_0x27fbb1(0x11cb)));}catch(_0x2ff373){console[_0x27fbb1(0x174a)](_0x27fbb1(0x1f2e),_0x2ff373),showToast('操作失败，请重试','error');}}function formatAppointmentDate(_0x582492,_0x4e9e38){const _0x3a7127=_0x211817,_0x4872aa=new Date(_0x582492);let _0x53ea13=_0x4872aa[_0x3a7127(0x1da)]()+0x1+'月'+_0x4872aa['getDate']()+'日';if(_0x4e9e38){const [_0x5066e4,_0xb9c980]=_0x4e9e38[_0x3a7127(0x204b)](':');_0x53ea13+='\x20'+_0x5066e4+':'+_0xb9c980;}return _0x53ea13;}function getPriorityText(_0xc432fb){const _0x101baf={'low':'低','medium':'中','high':'高','urgent':'紧急'};return _0x101baf[_0xc432fb]||'中';}function getAppointmentTypeText(_0x3ee989){const _0x4ba9cf=_0x211817;if(_0x3ee989[_0x4ba9cf(0xd1d)])return _0x3ee989['customType'];const _0x49d176={'date':'约会','promise':'承诺','activity':'活动','meeting':'见面','task':'任务','other':'其他'};return _0x49d176[_0x3ee989[_0x4ba9cf(0x1a4b)]]||'其他';}async function createAnniversaryByCharacter(_0x32a9cf,_0x4054a2){const _0x5fde8f=_0x211817;try{const _0x324698=characters[_0x5fde8f(0xaf4)](_0x5dadce=>_0x5dadce['id']===_0x32a9cf);if(!_0x324698)return console[_0x5fde8f(0x174a)](_0x5fde8f(0x117b),_0x32a9cf),![];let _0x5352a9=_0x4054a2[_0x5fde8f(0xa26)];!_0x5352a9&&(_0x5352a9=generatePersonalizedQuote(_0x324698,'anniversary',_0x4054a2));const _0x46a646={'id':_0x5fde8f(0x1a2f)+Date['now']()+'_'+Math['random']()['toString'](0x24)[_0x5fde8f(0x15fb)](0x2,0x9),'name':_0x4054a2['name'],'date':_0x4054a2[_0x5fde8f(0x20d4)],'type':_0x4054a2['type']||_0x5fde8f(0xe56),'characterId':_0x32a9cf,'description':_0x4054a2[_0x5fde8f(0x7c9)]||'','characterQuote':_0x5352a9,'yearly':_0x4054a2[_0x5fde8f(0x20aa)]!==![],'isShared':!![],'createdBy':'character','timestamp':Date[_0x5fde8f(0x2eb)]()};return await db[_0x5fde8f(0x1d0c)][_0x5fde8f(0x21e2)](_0x46a646),anniversaries[_0x5fde8f(0x1cd6)](_0x46a646),document[_0x5fde8f(0x1262)](_0x5fde8f(0x309))[_0x5fde8f(0x14eb)][_0x5fde8f(0x4da)]!=='none'&&renderAnniversaryList(),createAnniversaryNotification(_0x324698,_0x46a646,_0x5fde8f(0x519)),console[_0x5fde8f(0x2187)]('✅\x20'+_0x324698['name']+'\x20创建了一个纪念日：'+_0x4054a2[_0x5fde8f(0x1a1c)]),!![];}catch(_0x34f107){return console[_0x5fde8f(0x174a)]('角色创建纪念日失败:',_0x34f107),![];}}async function createAppointmentByCharacter(_0x418654,_0x2004e4){const _0x126ac6=_0x211817;try{const _0x3cc013=characters[_0x126ac6(0xaf4)](_0x2b0e99=>_0x2b0e99['id']===_0x418654);if(!_0x3cc013)return console[_0x126ac6(0x174a)](_0x126ac6(0x117b),_0x418654),![];let _0x23ea44=_0x2004e4['characterQuote'];!_0x23ea44&&(_0x23ea44=generatePersonalizedQuote(_0x3cc013,_0x126ac6(0x18e0),_0x2004e4));const _0x37846f=_0x2004e4[_0x126ac6(0x71d)]===!![],_0x55be41={'id':'appointment_'+Date['now']()+'_'+Math[_0x126ac6(0x11a8)]()[_0x126ac6(0x1878)](0x24)['substr'](0x2,0x9),'name':_0x2004e4[_0x126ac6(0x1a1c)],'date':_0x37846f?null:_0x2004e4[_0x126ac6(0x20d4)],'time':_0x37846f?null:_0x2004e4[_0x126ac6(0x1236)]||'','type':_0x2004e4[_0x126ac6(0x1a4b)]||_0x126ac6(0xe56),'characterId':_0x418654,'description':_0x2004e4[_0x126ac6(0x7c9)]||'','characterQuote':_0x23ea44,'priority':_0x2004e4['priority']||_0x126ac6(0x950),'completed':![],'isShared':!![],'createdBy':_0x126ac6(0x1dbb),'neverExpires':_0x37846f,'timestamp':Date['now']()};return await db[_0x126ac6(0x22d4)][_0x126ac6(0x21e2)](_0x55be41),appointments[_0x126ac6(0x1cd6)](_0x55be41),document[_0x126ac6(0x1262)](_0x126ac6(0x309))[_0x126ac6(0x14eb)][_0x126ac6(0x4da)]!==_0x126ac6(0x102b)&&renderAppointmentList(),createAppointmentNotification(_0x3cc013,_0x55be41,_0x126ac6(0x519)),console[_0x126ac6(0x2187)]('✅\x20'+_0x3cc013[_0x126ac6(0x1a1c)]+_0x126ac6(0x115f)+_0x2004e4[_0x126ac6(0x1a1c)]),!![];}catch(_0x84f08c){return console[_0x126ac6(0x174a)]('角色创建约定失败:',_0x84f08c),![];}}function generatePersonalizedQuote(_0x2366ae,_0x374d72,_0x1f44e6){const _0x4d2dce=_0x211817,_0x1f2a05=_0x2366ae[_0x4d2dce(0x1a1c)],_0x5a33ba=_0x2366ae['personality']||'',_0xfa3098=_0x5a33ba[_0x4d2dce(0x1831)]('温柔')||_0x5a33ba[_0x4d2dce(0x1831)]('温和')||_0x5a33ba['includes']('善良'),_0x4d1220=_0x5a33ba[_0x4d2dce(0x1831)]('活泼')||_0x5a33ba['includes']('开朗')||_0x5a33ba[_0x4d2dce(0x1831)]('调皮'),_0x7c127e=_0x5a33ba[_0x4d2dce(0x1831)]('冷酷')||_0x5a33ba['includes']('高冷')||_0x5a33ba['includes']('傲娇'),_0x584fc5=_0x5a33ba[_0x4d2dce(0x1831)]('严肃')||_0x5a33ba[_0x4d2dce(0x1831)]('认真')||_0x5a33ba[_0x4d2dce(0x1831)]('正经'),_0x4e4cf7={'anniversary':{'birthday':[..._0xfa3098?[_0x1f2a05+_0x4d2dce(0x1763),_0x1f2a05+_0x4d2dce(0x1020),_0x1f2a05+_0x4d2dce(0x337)]:[],..._0x4d1220?[_0x1f2a05+_0x4d2dce(0x195b),_0x1f2a05+_0x4d2dce(0x112e),_0x1f2a05+_0x4d2dce(0x615)]:[],..._0x7c127e?[_0x1f2a05+_0x4d2dce(0xbfb),_0x1f2a05+_0x4d2dce(0x15f3),_0x1f2a05+_0x4d2dce(0x199c)]:[],..._0x584fc5?[_0x1f2a05+_0x4d2dce(0x133f),_0x1f2a05+_0x4d2dce(0x13a0),_0x1f2a05+_0x4d2dce(0x7e5)]:[],_0x1f2a05+_0x4d2dce(0x1f32),_0x1f2a05+_0x4d2dce(0xbf6),_0x1f2a05+'：\x22生日是值得庆祝的日子，我会记住的。\x22'],'relationship':[..._0xfa3098?[_0x1f2a05+_0x4d2dce(0x2119),_0x1f2a05+_0x4d2dce(0x45f)]:[],..._0x4d1220?[_0x1f2a05+_0x4d2dce(0xeff),_0x1f2a05+_0x4d2dce(0xeeb)]:[],..._0x7c127e?[_0x1f2a05+_0x4d2dce(0x17bb),_0x1f2a05+_0x4d2dce(0x948)]:[],_0x1f2a05+_0x4d2dce(0x1f86),_0x1f2a05+_0x4d2dce(0x206)],'anniversary':[_0x1f2a05+_0x4d2dce(0x13d7),_0x1f2a05+_0x4d2dce(0x2275),_0x1f2a05+'：\x22这是值得纪念的美好时光。\x22'],'other':[_0x1f2a05+_0x4d2dce(0x1e79),_0x1f2a05+_0x4d2dce(0xeae),_0x1f2a05+'：\x22这一天值得我们铭记。\x22']},'appointment':{'date':[..._0xfa3098?[_0x1f2a05+_0x4d2dce(0x1023),_0x1f2a05+_0x4d2dce(0x1ae)]:[],..._0x4d1220?[_0x1f2a05+_0x4d2dce(0x21f7),_0x1f2a05+'：\x22我已经超级期待了！\x22']:[],..._0x7c127e?[_0x1f2a05+'：\x22约定就是约定，我会去的。\x22',_0x1f2a05+_0x4d2dce(0xb24)]:[],_0x1f2a05+'：\x22我们约好了，不见不散。\x22',_0x1f2a05+_0x4d2dce(0xfd8)],'promise':[..._0x584fc5?[_0x1f2a05+'：\x22我会严格遵守这个承诺。\x22',_0x1f2a05+_0x4d2dce(0x1be4)]:[],_0x1f2a05+'：\x22我会遵守这个承诺的。\x22',_0x1f2a05+'：\x22说到做到，这是我的原则。\x22'],'activity':[_0x1f2a05+'：\x22一起做这件事一定很有趣。\x22',_0x1f2a05+_0x4d2dce(0xccf)],'other':[_0x1f2a05+_0x4d2dce(0x1a7d),_0x1f2a05+_0x4d2dce(0x7a3)]}},_0x51685c=_0x4e4cf7[_0x374d72]||{},_0x48a0a8=_0x51685c[_0x1f44e6[_0x4d2dce(0x1a4b)]]||_0x51685c[_0x4d2dce(0xe56)]||[];if(_0x48a0a8[_0x4d2dce(0x19ee)]===0x0)return _0x374d72==='anniversary'?_0x1f2a05+_0x4d2dce(0x1e79):_0x1f2a05+_0x4d2dce(0x1a7d);return _0x48a0a8[Math[_0x4d2dce(0x2180)](Math[_0x4d2dce(0x11a8)]()*_0x48a0a8[_0x4d2dce(0x19ee)])];}function createAnniversaryNotification(_0x5a7c3d,_0xb22fbe,_0x3b823e){const _0x1358d3=_0x211817;let _0x4351f9='',_0x27ac31='';if(_0x3b823e==='created'){_0x27ac31='🎉';switch(_0xb22fbe[_0x1358d3(0x1a4b)]){case _0x1358d3(0x20a5):_0x4351f9=_0x27ac31+'\x20'+_0x5a7c3d[_0x1358d3(0x1a1c)]+_0x1358d3(0xdce)+_0xb22fbe[_0x1358d3(0x1a1c)];break;case'relationship':_0x4351f9=_0x27ac31+'\x20'+_0x5a7c3d[_0x1358d3(0x1a1c)]+_0x1358d3(0x1655)+_0xb22fbe[_0x1358d3(0x1a1c)];break;case _0x1358d3(0x1644):_0x4351f9=_0x27ac31+'\x20'+_0x5a7c3d['name']+'\x20创建了纪念日：'+_0xb22fbe[_0x1358d3(0x1a1c)];break;default:_0x4351f9=_0x27ac31+'\x20'+_0x5a7c3d[_0x1358d3(0x1a1c)]+_0x1358d3(0x1254)+_0xb22fbe[_0x1358d3(0x1a1c)];}}else{if(_0x3b823e==='reminder'){_0x27ac31='📅';const _0x337a90=new Date(),_0x537ffc=new Date(_0xb22fbe['date']),_0x17b04a=_0x537ffc[_0x1358d3(0x1ecb)]()===_0x337a90['toDateString']();_0x17b04a?_0x4351f9=_0x27ac31+_0x1358d3(0x16d7)+_0xb22fbe[_0x1358d3(0x1a1c)]+'！'+_0x5a7c3d[_0x1358d3(0x1a1c)]+_0x1358d3(0x1de3):_0x4351f9=_0x27ac31+'\x20'+_0x5a7c3d[_0x1358d3(0x1a1c)]+_0x1358d3(0xc7f)+_0xb22fbe['name'];}}createPushNotification(_0x5a7c3d,_0x4351f9,0x96);}function createAppointmentNotification(_0x176489,_0x4ba069,_0x533553){const _0x293578=_0x211817;let _0x5a1877='',_0x5e9e4a='';if(_0x533553===_0x293578(0x519)){_0x5e9e4a='📝';switch(_0x4ba069['type']){case _0x293578(0x20d4):_0x5a1877=_0x5e9e4a+'\x20'+_0x176489[_0x293578(0x1a1c)]+_0x293578(0xc14)+_0x4ba069[_0x293578(0x1a1c)];break;case _0x293578(0xa2f):_0x5a1877=_0x5e9e4a+'\x20'+_0x176489[_0x293578(0x1a1c)]+'\x20和你许下承诺：'+_0x4ba069[_0x293578(0x1a1c)];break;case _0x293578(0x1219):_0x5a1877=_0x5e9e4a+'\x20'+_0x176489['name']+_0x293578(0x811)+_0x4ba069[_0x293578(0x1a1c)];break;case _0x293578(0x16f6):_0x5a1877=_0x5e9e4a+'\x20'+_0x176489[_0x293578(0x1a1c)]+'\x20约定了活动：'+_0x4ba069[_0x293578(0x1a1c)];break;default:_0x5a1877=_0x5e9e4a+'\x20'+_0x176489[_0x293578(0x1a1c)]+'\x20创建了约定：'+_0x4ba069[_0x293578(0x1a1c)];}}else{if(_0x533553===_0x293578(0x151f)){_0x5e9e4a='⏰';const _0x59c956=new Date(),_0x3975aa=new Date(_0x4ba069['date']),_0x425396=_0x3975aa['toDateString']()===_0x59c956[_0x293578(0x1ecb)]();if(_0x425396){const _0x1538ab=_0x4ba069[_0x293578(0x1236)]?'\x20'+_0x4ba069[_0x293578(0x1236)]:'';_0x5a1877=_0x5e9e4a+_0x293578(0x5d0)+_0x1538ab+'是'+_0x4ba069[_0x293578(0x1a1c)]+'！'+_0x176489['name']+_0x293578(0x1608);}else _0x5a1877=_0x5e9e4a+'\x20'+_0x176489[_0x293578(0x1a1c)]+_0x293578(0xc7f)+_0x4ba069['name'];}}createPushNotification(_0x176489,_0x5a1877,0x96);}async function detectAnniversaryCreationInAIReply(_0x5a5547,_0x4a4fa8,_0x356157){const _0xa294f2=_0x211817,_0xda7b73=characters[_0xa294f2(0xaf4)](_0x44fd20=>_0x44fd20['id']===_0x5a5547);if(!_0xda7b73)return;console[_0xa294f2(0x2187)](_0xa294f2(0x2b2)),console[_0xa294f2(0x2187)](_0xa294f2(0xc5e),_0x4a4fa8),console[_0xa294f2(0x2187)](_0xa294f2(0x1cb6),_0x356157);const _0x729d5=[_0xa294f2(0x7ad),_0xa294f2(0x2099),_0xa294f2(0x21c3),_0xa294f2(0x1f65),'创建约定',_0xa294f2(0x2168),'记录约定',_0xa294f2(0x1ee3),'我想记录',_0xa294f2(0xce1),_0xa294f2(0x190c),_0xa294f2(0xf0a)],_0x4f9f49=_0x729d5[_0xa294f2(0x19fa)](_0x3e0331=>_0x4a4fa8['includes'](_0x3e0331));if(_0x4f9f49){console[_0xa294f2(0x2187)](_0xa294f2(0x1ae4));let _0x1f297e='特别的日子',_0x1f9627=_0xa294f2(0xe56),_0xa3e39b=new Date()['toISOString']()[_0xa294f2(0x204b)]('T')[0x0];const _0x5a28c3=_0x4a4fa8[_0xa294f2(0x1b87)](/(\d{4})年(\d{1,2})月(\d{1,2})日|(\d{1,2})月(\d{1,2})日/);if(_0x5a28c3){if(_0x5a28c3[0x1]&&_0x5a28c3[0x2]&&_0x5a28c3[0x3])_0xa3e39b=_0x5a28c3[0x1]+'-'+_0x5a28c3[0x2]['padStart'](0x2,'0')+'-'+_0x5a28c3[0x3][_0xa294f2(0xdfe)](0x2,'0');else{if(_0x5a28c3[0x4]&&_0x5a28c3[0x5]){const _0xc3d2a1=new Date()[_0xa294f2(0x16a0)]();_0xa3e39b=_0xc3d2a1+'-'+_0x5a28c3[0x4][_0xa294f2(0xdfe)](0x2,'0')+'-'+_0x5a28c3[0x5][_0xa294f2(0xdfe)](0x2,'0');}}}const _0x2994ce=_0x4a4fa8[_0xa294f2(0x1b87)](/纪念日.*?[：:]\s*([^。！？\n]+)|名称.*?[：:]\s*([^。！？\n]+)|叫做\s*([^。！？\n]+)/);_0x2994ce&&(_0x1f297e=(_0x2994ce[0x1]||_0x2994ce[0x2]||_0x2994ce[0x3])[_0xa294f2(0x19d7)]());if(_0x4a4fa8[_0xa294f2(0x1831)]('生日')||_0x356157[_0xa294f2(0x1831)]('生日')){_0x1f9627='birthday';if(!_0x2994ce)_0x1f297e='生日';}else{if(_0x4a4fa8[_0xa294f2(0x1831)](_0xa294f2(0x14d3))||_0x356157['includes']('第一次')){_0x1f9627=_0xa294f2(0xaed);if(!_0x2994ce)_0x1f297e=_0xa294f2(0xf2e);}else{if(_0x4a4fa8[_0xa294f2(0x1831)]('相遇')||_0x4a4fa8[_0xa294f2(0x1831)]('认识')){_0x1f9627=_0xa294f2(0x1219);if(!_0x2994ce)_0x1f297e=_0xa294f2(0xcca);}}}console['log'](_0xa294f2(0x7d0),{'name':_0x1f297e,'date':_0xa3e39b,'type':_0x1f9627});const _0xf88510={'name':_0x1f297e,'date':_0xa3e39b,'type':_0x1f9627,'description':'由'+_0xda7b73['name']+_0xa294f2(0x1e7f)},_0x1e4753=await createAnniversaryByCharacter(_0x5a5547,_0xf88510);_0x1e4753?console[_0xa294f2(0x2187)](_0xa294f2(0x2305)):console[_0xa294f2(0x174a)](_0xa294f2(0x13ec));}}async function checkAnniversaryReminders(){const _0x1c1f57=_0x211817,_0x3bbaeb=new Date(),_0x4b8f20=_0x3bbaeb[_0x1c1f57(0x1034)]()[_0x1c1f57(0x204b)]('T')[0x0],_0x8dedf1=new Date(_0x3bbaeb);_0x8dedf1[_0x1c1f57(0x20ae)](_0x8dedf1[_0x1c1f57(0x520)]()+0x1);const _0x37a29a=_0x8dedf1[_0x1c1f57(0x1034)]()[_0x1c1f57(0x204b)]('T')[0x0];console[_0x1c1f57(0x2187)](_0x1c1f57(0x917));const _0x2ab29e=_0x3bbaeb['getHours'](),_0x26a36a=_0x2ab29e===0x8||_0x2ab29e===0x14;for(const _0x12a81a of anniversaries){if(_0x12a81a[_0x1c1f57(0xaf5)]&&_0x12a81a['isShared']){const _0x3a7649=characters['find'](_0x2d1868=>_0x2d1868['id']===_0x12a81a[_0x1c1f57(0xaf5)]);if(!_0x3a7649)continue;const _0x3fd21f=new Date(_0x12a81a[_0x1c1f57(0x20d4)]),_0x58a46e=new Date(_0x3bbaeb['getFullYear'](),_0x3fd21f[_0x1c1f57(0x1da)](),_0x3fd21f[_0x1c1f57(0x520)]()),_0x293bd3=_0x58a46e[_0x1c1f57(0x1034)]()[_0x1c1f57(0x204b)]('T')[0x0];if(_0x293bd3===_0x4b8f20&&_0x26a36a){const _0x22f847=await checkIfAlreadyReminded(_0x3a7649['id'],_0x12a81a['id'],_0x1c1f57(0x11a5));!_0x22f847&&(await triggerAnniversaryReminder(_0x3a7649,_0x12a81a,_0x1c1f57(0x11a5)),await markAsReminded(_0x3a7649['id'],_0x12a81a['id'],_0x1c1f57(0x11a5)));}else{if(_0x293bd3===_0x37a29a&&_0x2ab29e===0x14){const _0xdd76b7=await checkIfAlreadyReminded(_0x3a7649['id'],_0x12a81a['id'],_0x1c1f57(0x1853));!_0xdd76b7&&(await triggerAnniversaryReminder(_0x3a7649,_0x12a81a,_0x1c1f57(0x1853)),await markAsReminded(_0x3a7649['id'],_0x12a81a['id'],_0x1c1f57(0x1853)));}}}}for(const _0x124a85 of appointments){if(_0x124a85[_0x1c1f57(0xaf5)]&&_0x124a85[_0x1c1f57(0x1f11)]&&!_0x124a85['completed']&&!_0x124a85['neverExpires']){const _0x59261a=characters[_0x1c1f57(0xaf4)](_0x41a132=>_0x41a132['id']===_0x124a85[_0x1c1f57(0xaf5)]);if(!_0x59261a)continue;if(_0x124a85[_0x1c1f57(0x20d4)]===_0x4b8f20&&_0x26a36a){const _0x562637=await checkIfAlreadyReminded(_0x59261a['id'],_0x124a85['id'],_0x1c1f57(0x11a5));!_0x562637&&(await triggerAppointmentReminder(_0x59261a,_0x124a85,_0x1c1f57(0x11a5)),await markAsReminded(_0x59261a['id'],_0x124a85['id'],_0x1c1f57(0x11a5)));}else{if(_0x124a85[_0x1c1f57(0x20d4)]===_0x37a29a&&_0x2ab29e===0x14){const _0x509052=await checkIfAlreadyReminded(_0x59261a['id'],_0x124a85['id'],_0x1c1f57(0x1853));!_0x509052&&(await triggerAppointmentReminder(_0x59261a,_0x124a85,_0x1c1f57(0x1853)),await markAsReminded(_0x59261a['id'],_0x124a85['id'],_0x1c1f57(0x1853)));}}}}}async function checkIfAlreadyReminded(_0x38c8f6,_0xe51c35,_0x34ff70){const _0x541ddc=_0x211817,_0x3b6ddf=new Date()[_0x541ddc(0x1034)]()[_0x541ddc(0x204b)]('T')[0x0],_0x20e8b8='reminder_'+_0x38c8f6+'_'+_0xe51c35+'_'+_0x34ff70+'_'+_0x3b6ddf;return localStorage[_0x541ddc(0x15d8)](_0x20e8b8)!==null;}async function markAsReminded(_0x36b9b5,_0x3996e2,_0x433316){const _0x2fe7b4=_0x211817,_0x70abb2=new Date()['toISOString']()[_0x2fe7b4(0x204b)]('T')[0x0],_0x23a403='reminder_'+_0x36b9b5+'_'+_0x3996e2+'_'+_0x433316+'_'+_0x70abb2;localStorage[_0x2fe7b4(0x192)](_0x23a403,_0x2fe7b4(0x1098));}async function triggerAnniversaryReminder(_0x3aad79,_0x523936,_0x36b5bd){const _0x5dc72e=_0x211817,_0x1267c2=_0x36b5bd===_0x5dc72e(0x11a5)?'今天':'明天',_0x523509=_0x3aad79[_0x5dc72e(0x198b)]||'',_0x2e360c=_0x523509[_0x5dc72e(0x1831)]('温柔')||_0x523509[_0x5dc72e(0x1831)]('温和'),_0x270d43=_0x523509[_0x5dc72e(0x1831)]('活泼')||_0x523509[_0x5dc72e(0x1831)]('开朗'),_0x4f9a76=_0x523509[_0x5dc72e(0x1831)]('冷酷')||_0x523509['includes']('高冷');let _0x281e0=[];if(_0x2e360c)_0x281e0=[_0x1267c2+'是'+_0x523936[_0x5dc72e(0x1a1c)]+_0x5dc72e(0x18b6),_0x1267c2+_0x5dc72e(0x186b)+_0x523936['name']+'。',_0x5dc72e(0x2159)+_0x1267c2+'是'+_0x523936[_0x5dc72e(0x1a1c)]+_0x5dc72e(0x7e7)];else{if(_0x270d43)_0x281e0=[_0x5dc72e(0x1975)+_0x1267c2+'是'+_0x523936['name']+_0x5dc72e(0x10f2),_0x1267c2+'是'+_0x523936['name']+'呢～时间过得好快！',_0x523936[_0x5dc72e(0x1a1c)]+'就在'+_0x1267c2+'！要庆祝一下吗？'];else _0x4f9a76?_0x281e0=[_0x1267c2+'是'+_0x523936[_0x5dc72e(0x1a1c)]+_0x5dc72e(0x1e57),_0x523936[_0x5dc72e(0x1a1c)]+'，'+_0x1267c2+'。',_0x1267c2+'...'+_0x523936[_0x5dc72e(0x1a1c)]+'呢。']:_0x281e0=[_0x1267c2+'是'+_0x523936['name']+_0x5dc72e(0x18b6),_0x1267c2+'是个特别的日子——'+_0x523936[_0x5dc72e(0x1a1c)]+'。',_0x5dc72e(0x89d)+_0x1267c2+'是'+_0x523936['name']+'哦。',_0x523936[_0x5dc72e(0x1a1c)]+'就在'+_0x1267c2+_0x5dc72e(0x1256)];}const _0x51bfd4=_0x281e0[Math['floor'](Math['random']()*_0x281e0[_0x5dc72e(0x19ee)])];await sendCharacterReminderMessage(_0x3aad79['id'],_0x51bfd4),createAnniversaryNotification(_0x3aad79,_0x523936,_0x5dc72e(0x151f));}async function triggerAppointmentReminder(_0xa3dfe1,_0x1125ae,_0x4ba4d1){const _0x21db27=_0x211817,_0x1b9b82=_0x4ba4d1==='today'?'今天':'明天',_0x26ab96=_0x1125ae[_0x21db27(0x1236)]?'\x20'+_0x1125ae[_0x21db27(0x1236)]:'',_0xc6aca8=_0xa3dfe1['personality']||'',_0x530d46=_0xc6aca8['includes']('温柔')||_0xc6aca8[_0x21db27(0x1831)]('温和'),_0x3b7b31=_0xc6aca8['includes']('活泼')||_0xc6aca8[_0x21db27(0x1831)]('开朗'),_0x4c431f=_0xc6aca8[_0x21db27(0x1831)]('冷酷')||_0xc6aca8['includes']('高冷');let _0x424eb2=[];if(_0x530d46)_0x424eb2=[''+_0x1b9b82+_0x26ab96+_0x21db27(0xb04)+_0x1125ae[_0x21db27(0x1a1c)]+'，记得哦。',_0x21db27(0x14a9)+_0x1b9b82+_0x26ab96+'是'+_0x1125ae['name']+_0x21db27(0xe46),_0x1125ae[_0x21db27(0x1a1c)]+'就在'+_0x1b9b82+_0x26ab96+_0x21db27(0x1322)];else{if(_0x3b7b31)_0x424eb2=[''+_0x1b9b82+_0x26ab96+_0x21db27(0xb04)+_0x1125ae[_0x21db27(0x1a1c)]+'，别忘了哦！','哇！'+_0x1125ae['name']+'就在'+_0x1b9b82+_0x26ab96+_0x21db27(0x496),_0x21db27(0x2ee)+_0x1125ae[_0x21db27(0x1a1c)]+'是'+_0x1b9b82+_0x26ab96+'呢～超期待的！'];else _0x4c431f?_0x424eb2=[''+_0x1b9b82+_0x26ab96+_0x21db27(0x1520)+_0x1125ae[_0x21db27(0x1a1c)]+'。',_0x1125ae[_0x21db27(0x1a1c)]+'，'+_0x1b9b82+_0x26ab96+_0x21db27(0x20ec),_0x21db27(0x1500)+_0x1b9b82+_0x26ab96+'。']:_0x424eb2=[''+_0x1b9b82+_0x26ab96+_0x21db27(0xb04)+_0x1125ae[_0x21db27(0x1a1c)]+'，别忘了哦。','提醒你一下，'+_0x1b9b82+_0x26ab96+'是'+_0x1125ae['name']+_0x21db27(0xe46),_0x1125ae[_0x21db27(0x1a1c)]+'就在'+_0x1b9b82+_0x26ab96+_0x21db27(0x496),_0x21db27(0x2ee)+_0x1125ae[_0x21db27(0x1a1c)]+'是'+_0x1b9b82+_0x26ab96+'呢。'];}const _0x3930ec=_0x424eb2[Math['floor'](Math[_0x21db27(0x11a8)]()*_0x424eb2[_0x21db27(0x19ee)])];await sendCharacterReminderMessage(_0xa3dfe1['id'],_0x3930ec),createAppointmentNotification(_0xa3dfe1,_0x1125ae,_0x21db27(0x151f));}async function sendCharacterReminderMessage(_0x5b9b86,_0x372b08){const _0x4b1847=_0x211817,_0x225b92=characters[_0x4b1847(0xaf4)](_0x4d1801=>_0x4d1801['id']===_0x5b9b86);if(!_0x225b92)return;const _0x283085={'id':_0x4b1847(0x1ea9)+Date['now']()+'-'+Math[_0x4b1847(0x11a8)]()[_0x4b1847(0x1878)](0x24)[_0x4b1847(0x15fb)](0x2,0x9),'content':[{'type':_0x4b1847(0x1378),'text':_0x372b08}],'text':_0x372b08,'timestamp':Date['now'](),'isUser':![],'isReminder':!![],'sender':'received'};!chatMessages[_0x5b9b86]&&(chatMessages[_0x5b9b86]=[]);chatMessages[_0x5b9b86][_0x4b1847(0x1cd6)](_0x283085);try{const _0x1f991e=_0x5b9b86+'_reminder_'+_0x283085[_0x4b1847(0x1716)]+'_'+Math[_0x4b1847(0x11a8)]()['toString'](0x24)['substr'](0x2,0x9)+'_'+(chatMessages[_0x5b9b86]['length']-0x1);await db[_0x4b1847(0x19a2)][_0x4b1847(0x21e2)]({'id':_0x1f991e,'characterId':_0x5b9b86,'timestamp':_0x283085[_0x4b1847(0x1716)],'messageOrder':chatMessages[_0x5b9b86][_0x4b1847(0x19ee)]-0x1,'originalMessageId':_0x283085['id'],'messageData':_0x283085});}catch(_0x2cd6f3){console[_0x4b1847(0x174a)]('保存提醒消息失败:',_0x2cd6f3);}currentChatCharacter&&currentChatCharacter['id']===_0x5b9b86&&(addMessageWithAnimation(_0x283085,_0x5b9b86),setTimeout(()=>{const _0xe3a86b=_0x4b1847,_0x2fd800=document[_0xe3a86b(0x1897)](_0xe3a86b(0x12bf)),_0x2b9d5b=_0x2fd800[_0x2fd800[_0xe3a86b(0x19ee)]-0x1];if(_0x2b9d5b){const _0x1a3df1=_0x2b9d5b['querySelector'](_0xe3a86b(0xa99));_0x1a3df1&&_0x1a3df1['classList'][_0xe3a86b(0x21e2)](_0xe3a86b(0x1b5b));}},0x64));renderMessageList();const _0x5b8c49=_0x4b1847(0x2197)+_0x225b92[_0x4b1847(0x1a1c)]+':\x20'+_0x372b08;createPushNotification(_0x225b92,_0x5b8c49,0xb4);}function initAnniversaryReminderSystem(){const _0x5d1660=_0x211817;console[_0x5d1660(0x2187)](_0x5d1660(0x18d0));const _0x4b75ef=()=>{const _0x2ba16b=_0x5d1660,_0x372a4c=new Date(),_0x1250ed=_0x372a4c[_0x2ba16b(0xe2e)](),_0x54cd7e=_0x372a4c[_0x2ba16b(0xe80)]();(_0x1250ed===0x8||_0x1250ed===0x14)&&_0x54cd7e<0x5&&(console[_0x2ba16b(0x2187)](_0x2ba16b(0x76f)+_0x1250ed+':'+_0x54cd7e['toString']()['padStart'](0x2,'0')),checkAnniversaryReminders());};setTimeout(()=>{_0x4b75ef();},0x1388),setInterval(_0x4b75ef,0x5*0x3c*0x3e8),console[_0x5d1660(0x2187)](_0x5d1660(0xec6));}window[_0x211817(0x4cf)]=createAnniversaryByCharacter,window[_0x211817(0x1a6f)]=createAppointmentByCharacter,window[_0x211817(0x1dd0)]=async function(_0x475632){const _0x550cc6=_0x211817,_0x3eedca=characters[_0x550cc6(0xaf4)](_0xb31a1=>_0xb31a1['id']===_0x475632);if(!_0x3eedca){console[_0x550cc6(0x174a)](_0x550cc6(0x2090));return;}const _0xb816c7={'name':_0x550cc6(0x1778),'date':new Date()['toISOString']()[_0x550cc6(0x204b)]('T')[0x0],'type':'other','description':_0x550cc6(0x280)};await createAnniversaryByCharacter(_0x475632,_0xb816c7),console['log'](_0x550cc6(0x1fef));},window[_0x211817(0x266)]=async function(_0x244373){const _0xdb2620=_0x211817,_0x4c51fe=characters[_0xdb2620(0xaf4)](_0xf40318=>_0xf40318['id']===_0x244373);if(!_0x4c51fe){console[_0xdb2620(0x174a)]('角色不存在');return;}const _0x4515e7={'name':_0xdb2620(0x1ddc),'date':new Date()[_0xdb2620(0x1034)]()['split']('T')[0x0],'type':_0xdb2620(0xe56),'description':_0xdb2620(0x537)};await createAppointmentByCharacter(_0x244373,_0x4515e7),console['log'](_0xdb2620(0x221e));};async function checkForNaturalAnniversaryMention(_0x522538,_0xa2e0df){const _0x3dc307=_0x211817,_0x130ebe=characters[_0x3dc307(0xaf4)](_0x3d3d4b=>_0x3d3d4b['id']===_0x522538);if(!_0x130ebe)return;const _0x8bde4e=[_0x3dc307(0x1eed),_0x3dc307(0xfb1),_0x3dc307(0x5dc),'什么时候','哪天',_0x3dc307(0x12f7),_0x3dc307(0x1f89),_0x3dc307(0x99d)],_0x2c584d=_0x8bde4e[_0x3dc307(0x19fa)](_0x9e0a17=>_0xa2e0df[_0x3dc307(0x1831)](_0x9e0a17));if(_0x2c584d&&Math['random']()<0.1){const _0x661a5f=new Date(),_0x671c8e=anniversaries[_0x3dc307(0x1e1f)](_0x2ce8e4=>_0x2ce8e4['characterId']===_0x522538&&_0x2ce8e4[_0x3dc307(0x1f11)]),_0x3cdc7e=appointments[_0x3dc307(0x1e1f)](_0x6a7a7d=>_0x6a7a7d[_0x3dc307(0xaf5)]===_0x522538&&_0x6a7a7d[_0x3dc307(0x1f11)]&&!_0x6a7a7d[_0x3dc307(0x1743)]),_0x4b769f=[..._0x671c8e,..._0x3cdc7e][_0x3dc307(0x6a4)](_0x45aa97=>{const _0x9ea3a2=_0x3dc307,_0x39c0c5=new Date(_0x45aa97[_0x9ea3a2(0x20d4)]),_0x29479c=Math['ceil']((_0x39c0c5-_0x661a5f)/(0x3e8*0x3c*0x3c*0x18));return{..._0x45aa97,'daysDiff':_0x29479c,'isAnniversary':!!_0x45aa97[_0x9ea3a2(0x20aa)]};})[_0x3dc307(0x1e1f)](_0x43e946=>_0x43e946[_0x3dc307(0x2230)]>=0x0&&_0x43e946[_0x3dc307(0x2230)]<=0x3)[_0x3dc307(0x1104)]((_0x5aea02,_0x364f4e)=>_0x5aea02[_0x3dc307(0x2230)]-_0x364f4e[_0x3dc307(0x2230)]);if(_0x4b769f[_0x3dc307(0x19ee)]>0x0){const _0x3d9e03=_0x4b769f[0x0];let _0x5244b5='';if(_0x3d9e03[_0x3dc307(0x2230)]===0x0)_0x5244b5='对了，今天是'+_0x3d9e03['name']+'呢。';else _0x3d9e03['daysDiff']===0x1?_0x5244b5='说起来，明天是'+_0x3d9e03[_0x3dc307(0x1a1c)]+'。':_0x5244b5='想起来，'+_0x3d9e03[_0x3dc307(0x2230)]+_0x3dc307(0x1176)+_0x3d9e03[_0x3dc307(0x1a1c)]+'。';await sendCharacterReminderMessage(_0x522538,_0x5244b5);}}}window[_0x211817(0x93b)]=async function(_0xc5c38e,_0x267d0f,_0x225417,_0x65aefd=_0x211817(0xe56)){const _0x14df4a=_0x211817,_0x97c5b2={'name':_0x267d0f,'date':_0x225417,'type':_0x65aefd,'description':'手动创建的'+(_0x65aefd===_0x14df4a(0x20a5)?'生日':_0x14df4a(0x2a9))};return await createAnniversaryByCharacter(_0xc5c38e,_0x97c5b2);},window[_0x211817(0x1b12)]=async function(_0x4ea713,_0x5515d2,_0x45553e,_0x3a11d7='other',_0x4352b2=![]){const _0x386298={'name':_0x5515d2,'date':_0x45553e,'type':_0x3a11d7,'description':'手动创建的约定','neverExpires':_0x4352b2};return await createAppointmentByCharacter(_0x4ea713,_0x386298);},window['anniversaryDebug']={'checkReminders':()=>checkAnniversaryReminders(),'createTestAnniversary':async(_0x1390c9,_0x308059=_0x211817(0x1778))=>{const _0xda2bc2=_0x211817,_0x1a94f5=new Date()[_0xda2bc2(0x1034)]()[_0xda2bc2(0x204b)]('T')[0x0];return await window['manualCreateAnniversary'](_0x1390c9,_0x308059,_0x1a94f5,'other');},'createTestAppointment':async(_0x411d2a,_0x16f52c=_0x211817(0x1ddc),_0x2b1d9c=![])=>{const _0x491f4e=_0x211817,_0x5342a9=new Date()[_0x491f4e(0x1034)]()['split']('T')[0x0];return await window[_0x491f4e(0x1b12)](_0x411d2a,_0x16f52c,_0x5342a9,_0x491f4e(0xe56),_0x2b1d9c);},'listAnniversaries':()=>{const _0x2035e3=_0x211817;console['table'](anniversaries[_0x2035e3(0x6a4)](_0x5258c1=>({'id':_0x5258c1['id'],'name':_0x5258c1[_0x2035e3(0x1a1c)],'date':_0x5258c1[_0x2035e3(0x20d4)],'character':characters[_0x2035e3(0xaf4)](_0x136c28=>_0x136c28['id']===_0x5258c1[_0x2035e3(0xaf5)])?.[_0x2035e3(0x1a1c)]||'未知','quote':_0x5258c1[_0x2035e3(0xa26)]})));},'listAppointments':()=>{const _0x462a35=_0x211817;console['table'](appointments[_0x462a35(0x6a4)](_0x50509b=>({'id':_0x50509b['id'],'name':_0x50509b[_0x462a35(0x1a1c)],'date':_0x50509b[_0x462a35(0x20d4)],'character':characters[_0x462a35(0xaf4)](_0x2ef053=>_0x2ef053['id']===_0x50509b[_0x462a35(0xaf5)])?.[_0x462a35(0x1a1c)]||'未知','quote':_0x50509b[_0x462a35(0xa26)],'completed':_0x50509b['completed']})));}},console[_0x211817(0x2187)](_0x211817(0x1698)),window[_0x211817(0x9de)]=async function(){const _0x30b336=_0x211817;if(characters[_0x30b336(0x19ee)]===0x0){console[_0x30b336(0x174a)](_0x30b336(0x1e6c));return;}const _0x45adbd=characters[0x0];console[_0x30b336(0x2187)](_0x30b336(0x9ea),_0x45adbd[_0x30b336(0x1a1c)]);const _0x3707ee={'name':_0x30b336(0x1778),'date':new Date()[_0x30b336(0x1034)]()[_0x30b336(0x204b)]('T')[0x0],'type':_0x30b336(0xe56),'description':_0x30b336(0x280)};console['log']('📝\x20创建纪念日数据:',_0x3707ee);try{const _0x324c35=await createAnniversaryByCharacter(_0x45adbd['id'],_0x3707ee);return console[_0x30b336(0x2187)](_0x30b336(0x1a0),_0x324c35),console['log'](_0x30b336(0x10e1),anniversaries[_0x30b336(0x19ee)]),console[_0x30b336(0x2187)](_0x30b336(0x105b),anniversaries[anniversaries[_0x30b336(0x19ee)]-0x1]),_0x324c35;}catch(_0x3bba0f){return console[_0x30b336(0x174a)](_0x30b336(0x3f3),_0x3bba0f),![];}},window['testCreateAppointment']=async function(){const _0x4e7f57=_0x211817;if(characters[_0x4e7f57(0x19ee)]===0x0){console['error'](_0x4e7f57(0x1e6c));return;}const _0x162587=characters[0x0];console[_0x4e7f57(0x2187)]('🧪\x20使用角色进行测试:',_0x162587[_0x4e7f57(0x1a1c)]);const _0x2ee3e0={'name':_0x4e7f57(0x1ddc),'date':new Date()[_0x4e7f57(0x1034)]()['split']('T')[0x0],'type':_0x4e7f57(0xe56),'description':_0x4e7f57(0x537)};console['log'](_0x4e7f57(0x1854),_0x2ee3e0);try{const _0x16b40c=await createAppointmentByCharacter(_0x162587['id'],_0x2ee3e0);return console[_0x4e7f57(0x2187)](_0x4e7f57(0x1a0),_0x16b40c),console[_0x4e7f57(0x2187)](_0x4e7f57(0x13a1),appointments[_0x4e7f57(0x19ee)]),console[_0x4e7f57(0x2187)]('📋\x20最新的约定:',appointments[appointments[_0x4e7f57(0x19ee)]-0x1]),_0x16b40c;}catch(_0x2e3f78){return console[_0x4e7f57(0x174a)]('❌\x20测试失败:',_0x2e3f78),![];}};function formatDate(_0x5cb494){const _0x28870f=_0x211817,_0x55d0f7=new Date(_0x5cb494),_0xe4224=['星期日',_0x28870f(0xdfa),_0x28870f(0x364),'星期三',_0x28870f(0x1a9f),_0x28870f(0x1152),'星期六'],_0x179551=_0x55d0f7[_0x28870f(0x16a0)](),_0x51102e=_0x55d0f7[_0x28870f(0x1da)]()+0x1,_0x74d976=_0x55d0f7[_0x28870f(0x520)](),_0x5e6b7b=_0xe4224[_0x55d0f7[_0x28870f(0x641)]()];return _0x179551+'-'+_0x51102e+'-'+_0x74d976+'\x20'+_0x5e6b7b;}function getTypeText(_0x4bbfc9){const _0x410d15=_0x211817;if(_0x4bbfc9[_0x410d15(0xd1d)])return _0x4bbfc9[_0x410d15(0xd1d)];const _0x381f7f={'birthday':'生日','relationship':'确定关系','anniversary':'纪念日','holiday':'节日','family':_0x410d15(0x173d),'other':'其他'};return _0x381f7f[_0x4bbfc9[_0x410d15(0x1a4b)]]||'其他';}function getAppointmentTypeText(_0x19cab0){const _0x1b605c=_0x211817;if(_0x19cab0['customType'])return _0x19cab0[_0x1b605c(0xd1d)];const _0xb34c5a={'date':'约会','meeting':'会面','travel':'旅行','event':'活动','work':'工作','study':'学习','health':'健康','other':'其他'};return _0xb34c5a[_0x19cab0[_0x1b605c(0x1a4b)]]||'其他';}function handleAnniversaryBackgroundUpload(_0x307ecd){const _0x147b24=_0x211817;if(_0x307ecd['files']&&_0x307ecd[_0x147b24(0xf26)][0x0]){const _0x47f134=_0x307ecd[_0x147b24(0xf26)][0x0],_0x48726c=new FileReader();_0x48726c[_0x147b24(0xc55)]=function(_0x47c7b4){const _0x5eed85=_0x147b24;document[_0x5eed85(0x1262)](_0x5eed85(0x1594))[_0x5eed85(0x45c)]=_0x47c7b4[_0x5eed85(0x193d)][_0x5eed85(0x4ee)],document[_0x5eed85(0x1262)](_0x5eed85(0x124e))[_0x5eed85(0x14eb)]['display']=_0x5eed85(0x13de);},_0x48726c[_0x147b24(0x127c)](_0x47f134);}}function handleAnniversaryUserAvatarUpload(_0x4cd0f2){const _0x3ffb3e=_0x211817;if(_0x4cd0f2[_0x3ffb3e(0xf26)]&&_0x4cd0f2[_0x3ffb3e(0xf26)][0x0]){const _0x306743=_0x4cd0f2['files'][0x0],_0x366365=new FileReader();_0x366365['onload']=function(_0x73ae76){const _0x1f7c47=_0x3ffb3e;document[_0x1f7c47(0x1262)]('anniversary-user-avatar-img')[_0x1f7c47(0x45c)]=_0x73ae76['target'][_0x1f7c47(0x4ee)],document[_0x1f7c47(0x1262)](_0x1f7c47(0x7ed))['style']['display']=_0x1f7c47(0x13de);},_0x366365[_0x3ffb3e(0x127c)](_0x306743);}}function removeAnniversaryBackground(){const _0x158055=_0x211817;document['getElementById'](_0x158055(0xf62))['value']='',document[_0x158055(0x1262)](_0x158055(0x124e))[_0x158055(0x14eb)][_0x158055(0x4da)]=_0x158055(0x102b),document[_0x158055(0x1262)]('anniversary-background-img')[_0x158055(0x45c)]='';}function removeAnniversaryUserAvatar(){const _0x6d646b=_0x211817;document[_0x6d646b(0x1262)](_0x6d646b(0x1f6a))[_0x6d646b(0x1ebc)]='',document[_0x6d646b(0x1262)]('anniversary-user-avatar-preview')[_0x6d646b(0x14eb)][_0x6d646b(0x4da)]='none',document[_0x6d646b(0x1262)]('anniversary-user-avatar-img')['src']='';}function handleAppointmentBackgroundUpload(_0x4e521b){const _0x59a824=_0x211817;if(_0x4e521b[_0x59a824(0xf26)]&&_0x4e521b[_0x59a824(0xf26)][0x0]){const _0x1bff22=_0x4e521b[_0x59a824(0xf26)][0x0],_0x3be2fd=new FileReader();_0x3be2fd['onload']=function(_0x4baeaf){const _0x123703=_0x59a824;document[_0x123703(0x1262)]('appointment-background-img')['src']=_0x4baeaf[_0x123703(0x193d)][_0x123703(0x4ee)],document[_0x123703(0x1262)](_0x123703(0x7cd))[_0x123703(0x14eb)]['display']='block';},_0x3be2fd['readAsDataURL'](_0x1bff22);}}function handleAppointmentUserAvatarUpload(_0x225327){const _0x5ded9c=_0x211817;if(_0x225327[_0x5ded9c(0xf26)]&&_0x225327[_0x5ded9c(0xf26)][0x0]){const _0x2377f5=_0x225327[_0x5ded9c(0xf26)][0x0],_0x46a7f7=new FileReader();_0x46a7f7[_0x5ded9c(0xc55)]=function(_0x74514f){const _0xab97c=_0x5ded9c;document[_0xab97c(0x1262)](_0xab97c(0x8f1))[_0xab97c(0x45c)]=_0x74514f[_0xab97c(0x193d)][_0xab97c(0x4ee)],document[_0xab97c(0x1262)](_0xab97c(0xe9c))['style'][_0xab97c(0x4da)]=_0xab97c(0x13de);},_0x46a7f7[_0x5ded9c(0x127c)](_0x2377f5);}}function removeAppointmentBackground(){const _0x29206b=_0x211817;document[_0x29206b(0x1262)]('appointment-background-upload')[_0x29206b(0x1ebc)]='',document[_0x29206b(0x1262)](_0x29206b(0x7cd))['style'][_0x29206b(0x4da)]=_0x29206b(0x102b),document[_0x29206b(0x1262)](_0x29206b(0x1b8c))[_0x29206b(0x45c)]='';}function removeAppointmentUserAvatar(){const _0x3aa81c=_0x211817;document[_0x3aa81c(0x1262)](_0x3aa81c(0x8ec))[_0x3aa81c(0x1ebc)]='',document[_0x3aa81c(0x1262)]('appointment-user-avatar-preview')['style']['display']='none',document['getElementById'](_0x3aa81c(0x8f1))[_0x3aa81c(0x45c)]='';}function renderPinnedAnniversary(_0x1c2248){const _0x59dab3=_0x211817,_0xf69613=document[_0x59dab3(0x1262)](_0x59dab3(0x1e76)),_0x285c06=new Date(),_0x194780=_0x285c06['getFullYear'](),_0x1add4a=new Date(_0x1c2248[_0x59dab3(0x20d4)]),_0x1406af=_0x1c2248['countType']||_0x59dab3(0x920);let _0x16c456='',_0x1cc7bd='';if(_0x1406af===_0x59dab3(0x1f15)){const _0x564c82=new Date(_0x285c06[_0x59dab3(0x16a0)](),_0x285c06[_0x59dab3(0x1da)](),_0x285c06[_0x59dab3(0x520)]()),_0x574530=new Date(_0x1add4a['getFullYear'](),_0x1add4a['getMonth'](),_0x1add4a[_0x59dab3(0x520)]()),_0x1bed38=Math[_0x59dab3(0x2180)]((_0x564c82-_0x574530)/(0x3e8*0x3c*0x3c*0x18));_0x16c456=_0x1bed38===0x0?'今天':''+_0x1bed38,_0x1cc7bd=_0x1bed38===0x0?'':'天';}else{const _0x1c2f23=new Date(_0x285c06[_0x59dab3(0x16a0)](),_0x285c06[_0x59dab3(0x1da)](),_0x285c06[_0x59dab3(0x520)]());let _0x1d5b7e=new Date(_0x194780,_0x1add4a[_0x59dab3(0x1da)](),_0x1add4a['getDate']());_0x1d5b7e<_0x1c2f23&&_0x1d5b7e[_0x59dab3(0x17e7)](_0x194780+0x1);const _0x325e33=Math[_0x59dab3(0x2180)]((_0x1d5b7e-_0x1c2f23)/(0x3e8*0x3c*0x3c*0x18));_0x16c456=_0x325e33===0x0?'今天':_0x325e33===0x1?'明天':''+_0x325e33,_0x1cc7bd=_0x325e33===0x0?'':_0x325e33===0x1?'':'天';}const _0x4451ca=_0x1c2248[_0x59dab3(0xaf5)]?characters[_0x59dab3(0xaf4)](_0x59ac7e=>_0x59ac7e['id']===_0x1c2248[_0x59dab3(0xaf5)]):null,_0x3e99b4=_0x1c2248['backgroundImage']?_0x59dab3(0x21f3)+_0x1c2248[_0x59dab3(0x159c)]+'\x27)\x22></div>':'';let _0xe0d439='';(_0x1c2248[_0x59dab3(0x865)]||_0x4451ca)&&(_0xe0d439=_0x59dab3(0x479),_0x4451ca&&(_0xe0d439+=_0x59dab3(0x1039)+(_0x4451ca['avatar']||_0x4451ca[_0x59dab3(0x1994)]||createDefaultAvatar(_0x4451ca[_0x59dab3(0x1a1c)]))+_0x59dab3(0x222c)+_0x4451ca[_0x59dab3(0x1a1c)]+'\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>'+_0x4451ca[_0x59dab3(0x1a1c)][_0x59dab3(0xcc3)](0x0)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'),_0x1c2248[_0x59dab3(0x865)]&&(_0xe0d439+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x1c2248[_0x59dab3(0x865)]+'\x22\x20alt=\x22你\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>你</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'),_0xe0d439+=_0x59dab3(0x1844));const _0x3e2125=_0x1c2248[_0x59dab3(0x1a4b)]||_0x59dab3(0xe56),_0x2b0645=getTypeText(_0x1c2248),_0x36f71f=_0x1c2248[_0x59dab3(0xc38)]?_0x59dab3(0xd9c)+escapeHtml(_0x1c2248[_0x59dab3(0xc38)])+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'',_0xee8b92=_0x1c2248['characterQuote']?_0x59dab3(0x1466)+(_0x4451ca?_0x4451ca[_0x59dab3(0x1a1c)]:'角色')+'：</span>'+escapeHtml(_0x1c2248[_0x59dab3(0xa26)])+_0x59dab3(0x3db):'';_0xf69613['innerHTML']=_0x59dab3(0x19d9)+_0x3e99b4+_0x59dab3(0x1a3c)+_0xe0d439+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-type\x20'+_0x3e2125+'\x22>'+_0x2b0645+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-title\x22>'+escapeHtml(_0x1c2248[_0x59dab3(0x1a1c)])+_0x59dab3(0x2037)+_0x16c456+_0x59dab3(0xdde)+_0x1cc7bd+_0x59dab3(0x12cf)+(_0x1406af===_0x59dab3(0x1f15)?_0x59dab3(0x1c96):_0x59dab3(0x7e1))+'\x20'+formatDate(_0x1c2248[_0x59dab3(0x20d4)])+_0x59dab3(0x406)+_0x36f71f+_0x59dab3(0xb33)+_0xee8b92+_0x59dab3(0x1fb1)+_0x1c2248['id']+_0x59dab3(0x93f),_0xf69613[_0x59dab3(0x1ecd)][_0x59dab3(0x635)]=_0x1c2248['id'],_0xf69613[_0x59dab3(0x1f36)]=function(_0x363461){const _0x1df035=_0x59dab3;!_0x363461['target'][_0x1df035(0x216a)](_0x1df035(0x198f))&&showAnniversaryForm(_0x1c2248['id']);};}function showNewMessageForm(){const _0x4eddac=_0x211817;window['selectedPersonaForSMS']=null,window[_0x4eddac(0x63c)]=null,showSMSPersonaSelector();}function showSMSPersonaSelector(){const _0x5e9767=_0x211817;renderSMSPersonaSelector(),document[_0x5e9767(0x1262)]('sms-persona-selector-modal')['style'][_0x5e9767(0x4da)]='flex';}function hideSMSPersonaSelector(_0x159259){const _0x301951=_0x211817;if(_0x159259&&_0x159259[_0x301951(0x193d)]!==_0x159259[_0x301951(0x1fac)])return;document['getElementById'](_0x301951(0x535))[_0x301951(0x14eb)][_0x301951(0x4da)]='none';}function showSMSCharacterSelector(){const _0x1df158=_0x211817;renderSMSCharacterSelector(),document[_0x1df158(0x1262)](_0x1df158(0x213b))[_0x1df158(0x14eb)]['display']='flex';}function hideSMSCharacterSelector(_0x3a2cb2){const _0x234f1b=_0x211817;if(_0x3a2cb2&&_0x3a2cb2[_0x234f1b(0x193d)]!==_0x3a2cb2[_0x234f1b(0x1fac)])return;document[_0x234f1b(0x1262)](_0x234f1b(0x213b))[_0x234f1b(0x14eb)][_0x234f1b(0x4da)]=_0x234f1b(0x102b);}function renderSMSPersonaSelector(){const _0x8e838b=_0x211817,_0x4795cd=document['getElementById']('sms-persona-selector-body');if(!_0x4795cd)return;if(!personas||personas[_0x8e838b(0x19ee)]===0x0){_0x4795cd[_0x8e838b(0x33a)]=_0x8e838b(0x1c87);return;}const _0x7fbc03=personas[_0x8e838b(0x6a4)](_0x1e72ca=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-persona-item\x22\x20onclick=\x22selectSMSPersona(\x27'+_0x1e72ca['id']+_0x8e838b(0x22a)+(_0x1e72ca[_0x8e838b(0x1994)]?_0x8e838b(0xf7c)+_0x1e72ca['avatarUrl']+_0x8e838b(0x222c)+_0x1e72ca[_0x8e838b(0x1a1c)]+'\x22>':_0x8e838b(0x752))+_0x8e838b(0x1dc1)+_0x1e72ca[_0x8e838b(0x1a1c)]+_0x8e838b(0x1186)+(_0x1e72ca[_0x8e838b(0x7c9)]?_0x1e72ca[_0x8e838b(0x7c9)][_0x8e838b(0x17ca)](0x0,0x32)+_0x8e838b(0x1520):_0x8e838b(0x1dab))+_0x8e838b(0x19dd))[_0x8e838b(0x122b)]('');_0x4795cd[_0x8e838b(0x33a)]=_0x7fbc03;}function renderSMSCharacterSelector(){const _0x228dbe=_0x211817,_0x42022e=document['getElementById'](_0x228dbe(0xd86));if(!_0x42022e)return;if(!characters||characters[_0x228dbe(0x19ee)]===0x0){_0x42022e[_0x228dbe(0x33a)]='<div\x20class=\x22sms-empty-state\x22>暂无角色</div>';return;}_0x42022e[_0x228dbe(0x33a)]=characters[_0x228dbe(0x6a4)](_0x4fbf27=>_0x228dbe(0xc77)+_0x4fbf27['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4fbf27[_0x228dbe(0x1994)]?_0x228dbe(0xf7c)+_0x4fbf27['avatarUrl']+_0x228dbe(0x222c)+_0x4fbf27[_0x228dbe(0x1a1c)]+'\x22>':_0x228dbe(0x752))+_0x228dbe(0x1dc1)+_0x4fbf27['name']+_0x228dbe(0x1186)+(_0x4fbf27['bio']?_0x4fbf27[_0x228dbe(0x1f0b)][_0x228dbe(0x17ca)](0x0,0x32)+_0x228dbe(0x1520):_0x228dbe(0x1054))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')['join']('');}function selectSMSPersona(_0x2f72d7){const _0x839838=_0x211817,_0xf57abe=personas[_0x839838(0xaf4)](_0x8e597a=>_0x8e597a['id']===_0x2f72d7);if(!_0xf57abe){showToast(_0x839838(0x17de),_0x839838(0x174a));return;}window[_0x839838(0x9a2)]=_0xf57abe,hideSMSPersonaSelector(),showSMSCharacterSelector();}function selectSMSCharacter(_0xc84794){const _0xb28686=_0x211817,_0x5d4761=characters[_0xb28686(0xaf4)](_0x18271a=>_0x18271a['id']===_0xc84794);if(!_0x5d4761)return;window[_0xb28686(0x63c)]=_0x5d4761,hideSMSCharacterSelector(),createSMSChatWithPersona(_0x5d4761,window[_0xb28686(0x9a2)]);}async function createSMSChatWithPersona(_0x1435e3,_0x281105){const _0x5653b8=_0x211817;try{if(!_0x281105){showToast(_0x5653b8(0x14ae),'error');return;}if(smsContacts[_0x5653b8(0x1831)](_0x1435e3['id'])){startSMSChat(_0x1435e3),showToast('已进入与\x20'+_0x1435e3[_0x5653b8(0x1a1c)]+_0x5653b8(0x1eb0),'success');return;}const _0x362b3c=_0x1435e3['id'];!chatSettings[_0x362b3c]&&(chatSettings[_0x362b3c]={}),chatSettings[_0x362b3c][_0x5653b8(0x145e)]=_0x281105['id'],await saveChatSettings(_0x1435e3['id'],chatSettings[_0x362b3c]),console[_0x5653b8(0x2187)](_0x5653b8(0x15a0),_0x281105['name']),!smsContacts[_0x5653b8(0x1831)](_0x1435e3['id'])&&(smsContacts[_0x5653b8(0x1cd6)](_0x1435e3['id']),await saveSMSContacts()),!smsMessages[_0x1435e3['id']]&&(smsMessages[_0x1435e3['id']]=[]),renderSMSMessageList(),startSMSChat(_0x1435e3),showToast('已创建与\x20'+_0x1435e3[_0x5653b8(0x1a1c)]+_0x5653b8(0x588)+_0x281105['name']+'）',_0x5653b8(0x11cb));}catch(_0x54ea48){console[_0x5653b8(0x174a)](_0x5653b8(0x1da1),_0x54ea48),showToast(_0x5653b8(0x5b0),_0x5653b8(0x174a));}}function startSMSChat(_0x2429ac){const _0x2f510a=_0x211817;window[_0x2f510a(0xb69)]=_0x2429ac,updateSMSChatHeader(_0x2429ac),renderSMSMessages(_0x2429ac['id']),document[_0x2f510a(0x1262)]('messages-screen')[_0x2f510a(0x14eb)]['display']=_0x2f510a(0x102b),document['getElementById'](_0x2f510a(0x659))[_0x2f510a(0x14eb)][_0x2f510a(0x4da)]=_0x2f510a(0x13de),initSMSInput();}function updateSMSChatHeader(_0x909ee9){const _0x53ab83=_0x211817,_0x12d525=document[_0x53ab83(0x1262)]('sms-chat-name'),_0x4bc574=document[_0x53ab83(0x1262)](_0x53ab83(0x1082));_0x12d525[_0x53ab83(0x13be)]=_0x909ee9['name'],_0x909ee9[_0x53ab83(0x1994)]?(_0x4bc574[_0x53ab83(0x14eb)][_0x53ab83(0x159c)]=_0x53ab83(0x9f1)+_0x909ee9[_0x53ab83(0x1994)]+')',_0x4bc574['innerHTML']=''):(_0x4bc574['style'][_0x53ab83(0x159c)]='',_0x4bc574[_0x53ab83(0x33a)]=_0x53ab83(0x752));}function showSMSTypingIndicator(){const _0x12eb37=_0x211817,_0x4a8587=document[_0x12eb37(0x1262)](_0x12eb37(0x12d2));if(!_0x4a8587)return;hideSMSTypingIndicator();const _0x5f8326=document[_0x12eb37(0xac6)]('div');_0x5f8326[_0x12eb37(0x1722)]='sms-typing-indicator',_0x5f8326['id']='sms-typing-indicator',_0x5f8326[_0x12eb37(0x33a)]=_0x12eb37(0x2257),_0x4a8587['appendChild'](_0x5f8326),setTimeout(()=>{const _0x26227c=_0x12eb37;_0x4a8587[_0x26227c(0x98c)]=_0x4a8587[_0x26227c(0xfe3)];},0x64);}function hideSMSTypingIndicator(){const _0xaaecf7=_0x211817,_0x30b6ac=document[_0xaaecf7(0x1262)](_0xaaecf7(0x593));_0x30b6ac&&_0x30b6ac[_0xaaecf7(0x1493)]();}function enterSMSMultiSelectMode(_0x124b8b){const _0x312211=_0x211817;console[_0x312211(0x2187)](_0x312211(0x1c5a),_0x124b8b),isSMSMultiSelectMode=!![],selectedSMSMessages=new Set([_0x124b8b]);const _0x513608=document[_0x312211(0x1262)](_0x312211(0x1cd4)),_0x4e5b36=document[_0x312211(0x1262)](_0x312211(0x683));if(_0x513608)_0x513608[_0x312211(0x14eb)][_0x312211(0x4da)]=_0x312211(0x102b);if(_0x4e5b36)_0x4e5b36['style'][_0x312211(0x4da)]=_0x312211(0x1fb7);const _0x5162f7=window[_0x312211(0xb69)]?.['id'];_0x5162f7&&renderSMSMessages(_0x5162f7);}function exitSMSMultiSelectMode(){const _0x22d185=_0x211817;isSMSMultiSelectMode=![],selectedSMSMessages['clear']();const _0x4affc8=document['getElementById']('sms-chat-normal-actions'),_0x217037=document['getElementById'](_0x22d185(0x683));if(_0x4affc8)_0x4affc8[_0x22d185(0x14eb)][_0x22d185(0x4da)]='flex';if(_0x217037)_0x217037[_0x22d185(0x14eb)]['display']=_0x22d185(0x102b);const _0x1c1134=window[_0x22d185(0xb69)]?.['id'];_0x1c1134&&renderSMSMessages(_0x1c1134);}function toggleSMSMessageSelection(_0x522ae2){const _0x1496f6=_0x211817;selectedSMSMessages[_0x1496f6(0x975)](_0x522ae2)?selectedSMSMessages[_0x1496f6(0x1f4a)](_0x522ae2):selectedSMSMessages[_0x1496f6(0x21e2)](_0x522ae2);const _0x23daf5=window[_0x1496f6(0xb69)]?.['id'];_0x23daf5&&renderSMSMessages(_0x23daf5),selectedSMSMessages['size']===0x0&&exitSMSMultiSelectMode();}async function deleteSelectedSMSMessages(){const _0x49c6b8=_0x211817;if(selectedSMSMessages[_0x49c6b8(0x2d8)]===0x0){showToast(_0x49c6b8(0x334),_0x49c6b8(0x174a));return;}const _0x90c545=selectedSMSMessages['size'],_0x326668=_0x49c6b8(0xda3)+_0x90c545+_0x49c6b8(0x1b69);if(confirm(_0x326668))try{const _0x12d569=window[_0x49c6b8(0xb69)]?.['id'];if(!_0x12d569)return;for(const _0x301532 of selectedSMSMessages){let _0x51cc81=null;if(smsMessages[_0x12d569]){const _0x29c359=smsMessages[_0x12d569][_0x49c6b8(0x150c)](_0x54f577=>_0x54f577['id']===_0x301532);_0x29c359>-0x1&&(_0x51cc81=smsMessages[_0x12d569][_0x29c359]);}if(_0x51cc81)try{await deleteSMSRelatedTimelineEvents(_0x51cc81,_0x12d569),console['log'](_0x49c6b8(0x1801));}catch(_0x1b7937){console['error'](_0x49c6b8(0x1511),_0x1b7937);}if(smsMessages[_0x12d569]){const _0x10e215=smsMessages[_0x12d569]['findIndex'](_0x1bdbff=>_0x1bdbff['id']===_0x301532);_0x10e215>-0x1&&smsMessages[_0x12d569]['splice'](_0x10e215,0x1);}await db['smsMessages'][_0x49c6b8(0xa24)]('id')[_0x49c6b8(0x1694)](_0x301532)['delete']();}exitSMSMultiSelectMode(),renderSMSMessages(_0x12d569),renderSMSMessageList(),showToast(_0x49c6b8(0x1af)+_0x90c545+_0x49c6b8(0xd49),'success');}catch(_0x1f9dac){console[_0x49c6b8(0x174a)](_0x49c6b8(0x141c),_0x1f9dac),showToast(_0x49c6b8(0xd2d),'error');}}async function deleteSMSMessage(_0x1f04f3,_0x25a74e){const _0x3386d7=_0x211817;try{if(!confirm(_0x3386d7(0x1b04)))return;let _0x55b887=null;if(smsMessages[_0x25a74e]){const _0x5ea8ea=smsMessages[_0x25a74e]['findIndex'](_0x505f93=>_0x505f93['id']===_0x1f04f3);_0x5ea8ea>-0x1&&(_0x55b887=smsMessages[_0x25a74e][_0x5ea8ea]);}if(_0x55b887)try{await deleteSMSRelatedTimelineEvents(_0x55b887,_0x25a74e),console['log'](_0x3386d7(0x1801));}catch(_0x29a4b8){console['error']('删除短信时间线记录失败:',_0x29a4b8);}if(smsMessages[_0x25a74e]){const _0x39af4e=smsMessages[_0x25a74e]['findIndex'](_0x91d6f4=>_0x91d6f4['id']===_0x1f04f3);_0x39af4e>-0x1&&smsMessages[_0x25a74e][_0x3386d7(0x19b2)](_0x39af4e,0x1);}await db[_0x3386d7(0x1b6a)][_0x3386d7(0xa24)]('id')['equals'](_0x1f04f3)[_0x3386d7(0x1f4a)](),renderSMSMessages(_0x25a74e),renderSMSMessageList(),console[_0x3386d7(0x2187)](_0x3386d7(0xefe)+_0x1f04f3);}catch(_0x19144d){console[_0x3386d7(0x174a)]('删除短信消息失败:',_0x19144d),showToast(_0x3386d7(0xd2d),'error');}}function renderSMSMessages(_0x5761f8){const _0x5c8e4f=_0x211817,_0x570102=document[_0x5c8e4f(0x1262)]('sms-messages-container');if(!_0x570102)return;const _0x35bfbc=getSMSChatSetting(_0x5c8e4f(0x1d06),_0x5c8e4f(0x6a8));_0x570102[_0x5c8e4f(0x1c1b)]['remove'](_0x5c8e4f(0xd08));_0x35bfbc===_0x5c8e4f(0x38d)&&_0x570102[_0x5c8e4f(0x1c1b)][_0x5c8e4f(0x21e2)](_0x5c8e4f(0xd08));const _0x320a70=smsMessages[_0x5761f8]||[];if(_0x320a70[_0x5c8e4f(0x19ee)]===0x0){_0x570102[_0x5c8e4f(0x33a)]=_0x5c8e4f(0x1393);return;}let _0x4e2bb5='',_0x23dac2=null;_0x320a70[_0x5c8e4f(0x19fb)]((_0x445f53,_0xdd0977)=>{const _0x34b45b=_0x5c8e4f,_0x30c525=_0x445f53['isUser']?_0x34b45b(0xd2c):_0x34b45b(0x1e20),_0x5e532c=new Date(_0x445f53[_0x34b45b(0x1716)]),_0x3e67fe=new Date(),_0x2f9041=new Date(_0x3e67fe[_0x34b45b(0x16a0)](),_0x3e67fe[_0x34b45b(0x1da)](),_0x3e67fe[_0x34b45b(0x520)]()),_0x5e73b5=new Date(_0x2f9041[_0x34b45b(0x704)]()-0x18*0x3c*0x3c*0x3e8),_0x32e310=new Date(_0x2f9041[_0x34b45b(0x704)]()-0x2*0x18*0x3c*0x3c*0x3e8),_0x56ae88=new Date(_0x5e532c['getFullYear'](),_0x5e532c[_0x34b45b(0x1da)](),_0x5e532c[_0x34b45b(0x520)]()),_0x3b4c4f=_0x2f9041[_0x34b45b(0x704)]()-_0x56ae88[_0x34b45b(0x704)](),_0x35bd4e=Math[_0x34b45b(0x2180)](_0x3b4c4f/(0x3e8*0x3c*0x3c*0x18));let _0x22fadc='';const _0x1354ac=_0x5e532c[_0x34b45b(0x314)](_0x34b45b(0x156c),{'hour':'2-digit','minute':_0x34b45b(0xc79)});if(_0x56ae88[_0x34b45b(0x704)]()===_0x2f9041[_0x34b45b(0x704)]())_0x22fadc=_0x1354ac;else{if(_0x56ae88['getTime']()===_0x5e73b5[_0x34b45b(0x704)]())_0x22fadc=_0x34b45b(0xa75)+_0x1354ac;else{if(_0x56ae88['getTime']()===_0x32e310['getTime']())_0x22fadc='前天\x20'+_0x1354ac;else{if(_0x35bd4e<0x7){const _0x327a6b=['星期日',_0x34b45b(0xdfa),_0x34b45b(0x364),_0x34b45b(0x1847),_0x34b45b(0x1a9f),'星期五',_0x34b45b(0x818)],_0x45c471=_0x327a6b[_0x5e532c[_0x34b45b(0x641)]()];_0x22fadc=_0x45c471+'\x20'+_0x1354ac;}else{const _0x4d3c42=_0x5e532c[_0x34b45b(0xbf7)]('zh-CN',{'month':_0x34b45b(0x94d),'day':_0x34b45b(0x94d)});_0x22fadc=_0x4d3c42+'\x20'+_0x1354ac;}}}}const _0x2625d7=!_0x23dac2||_0x5e532c-_0x23dac2>0x5*0x3c*0x3e8||_0xdd0977===0x0;_0x2625d7&&(_0x4e2bb5+='<div\x20class=\x22sms-timestamp\x22>'+_0x22fadc+_0x34b45b(0x1844),_0x23dac2=_0x5e532c);let _0x592461='',_0xf37308='';if(Array['isArray'](_0x445f53[_0x34b45b(0x211c)])){const _0x56cb51=_0x445f53[_0x34b45b(0x211c)][_0x34b45b(0xaf4)](_0x18aa4e=>_0x18aa4e['type']===_0x34b45b(0x1378));_0xf37308=_0x56cb51?_0x56cb51[_0x34b45b(0x1378)]:'';}else _0x445f53['text']&&(_0xf37308=_0x445f53[_0x34b45b(0x1378)]);if(_0x445f53[_0x34b45b(0x1b62)]&&_0x445f53[_0x34b45b(0xb17)]){const _0x57c68c=isSMSMultiSelectMode?'':_0x34b45b(0x17c6)+_0x445f53[_0x34b45b(0xb17)]+_0x34b45b(0xda7)+(_0x445f53[_0x34b45b(0x63f)]||'图片')+'\x27)\x22';_0x592461=_0x34b45b(0xa8f)+_0x445f53['imageUrl']+_0x34b45b(0x222c)+(_0x445f53[_0x34b45b(0x63f)]||'图片')+_0x34b45b(0xc76)+_0x57c68c+_0x34b45b(0x4a6);}else{const _0x3e22fd=_0xf37308[_0x34b45b(0xe16)](/&/g,_0x34b45b(0x3e8))[_0x34b45b(0xe16)](/</g,'&lt;')[_0x34b45b(0xe16)](/>/g,_0x34b45b(0xe4b))[_0x34b45b(0xe16)](/"/g,'&quot;')[_0x34b45b(0xe16)](/'/g,_0x34b45b(0x2021));_0x592461=_0x34b45b(0x1362)+_0x3e22fd+_0x34b45b(0x1085);}_0x4e2bb5+=_0x34b45b(0x4ab)+_0x30c525+'\x20'+(selectedSMSMessages[_0x34b45b(0x975)](_0x445f53['id'])?_0x34b45b(0x176b):'')+'\x22\x20data-message-id=\x22'+_0x445f53['id']+_0x34b45b(0xa8d)+_0x5761f8+_0x34b45b(0x1e29)+_0x592461+_0x34b45b(0x14cf);}),_0x570102['innerHTML']=_0x4e2bb5,addSMSMessageEventListeners(_0x5761f8),setTimeout(()=>{const _0xd5a987=_0x5c8e4f;_0x570102[_0xd5a987(0x98c)]=_0x570102[_0xd5a987(0xfe3)];},0x64);}function addSingleSMSMessageEventListener(_0x8b82a3,_0x44e5ca){const _0x4282fd=_0x211817,_0x583762=_0x8b82a3[_0x4282fd(0x1ecd)][_0x4282fd(0x21c8)];if(!_0x583762)return;if(isSMSMultiSelectMode)_0x8b82a3[_0x4282fd(0x21e9)](_0x4282fd(0x1859),_0x1754f9=>{const _0x4aeabb=_0x4282fd;_0x1754f9[_0x4aeabb(0x36f)](),_0x1754f9[_0x4aeabb(0x902)](),toggleSMSMessageSelection(_0x583762);});else{let _0x5b1300=null,_0x280ebd={'x':0x0,'y':0x0};_0x8b82a3[_0x4282fd(0x21e9)](_0x4282fd(0x1728),_0x5ef9bc=>{const _0x409a67=_0x4282fd,_0xf6f6f4=_0x5ef9bc[_0x409a67(0x2c6)][0x0];_0x280ebd['x']=_0xf6f6f4[_0x409a67(0x230)],_0x280ebd['y']=_0xf6f6f4[_0x409a67(0xcb0)],_0x5b1300=setTimeout(()=>{const _0x1414f8=_0x409a67;navigator[_0x1414f8(0xe3e)]&&navigator[_0x1414f8(0xe3e)](0x32),enterSMSMultiSelectMode(_0x583762);},0x320);}),_0x8b82a3['addEventListener'](_0x4282fd(0x1c63),_0x2aab5b=>{_0x5b1300&&(clearTimeout(_0x5b1300),_0x5b1300=null);}),_0x8b82a3[_0x4282fd(0x21e9)](_0x4282fd(0x20a4),_0x4b4c91=>{const _0x4dcced=_0x4282fd;if(_0x5b1300){const _0x9869f=_0x4b4c91[_0x4dcced(0x2c6)][0x0],_0x23f4ce=Math['abs'](_0x9869f[_0x4dcced(0x230)]-_0x280ebd['x']),_0x2d5c58=Math[_0x4dcced(0x1b24)](_0x9869f[_0x4dcced(0xcb0)]-_0x280ebd['y']);(_0x23f4ce>0xa||_0x2d5c58>0xa)&&(clearTimeout(_0x5b1300),_0x5b1300=null);}}),_0x8b82a3[_0x4282fd(0x21e9)](_0x4282fd(0x5ac),_0x20cc0c=>{_0x20cc0c['button']===0x0&&(_0x5b1300=setTimeout(()=>{enterSMSMultiSelectMode(_0x583762);},0x320));}),_0x8b82a3['addEventListener']('mouseup',_0x552226=>{_0x5b1300&&(clearTimeout(_0x5b1300),_0x5b1300=null);}),_0x8b82a3[_0x4282fd(0x21e9)](_0x4282fd(0x1e80),_0x38f88e=>{_0x5b1300&&(clearTimeout(_0x5b1300),_0x5b1300=null);});}}function addSMSMessageEventListeners(_0x4b39de){const _0x702810=_0x211817,_0x3d3977=document[_0x702810(0x1897)](_0x702810(0xc8f));_0x3d3977[_0x702810(0x19fb)](_0x9e2eda=>{const _0x731294=_0x702810,_0x2cdb7d=_0x9e2eda[_0x731294(0x1ecd)][_0x731294(0x21c8)];if(!_0x2cdb7d)return;addSingleSMSMessageEventListener(_0x9e2eda,_0x4b39de);});}function addSMSMessageWithAnimation(_0x1fdf51,_0x14ebac){const _0x3c7311=_0x211817,_0x35d513=document[_0x3c7311(0x1262)](_0x3c7311(0x12d2));if(!_0x35d513||!window['currentSMSCharacter']||_0x14ebac!==window[_0x3c7311(0xb69)]['id'])return;!_0x1fdf51[_0x3c7311(0x714)]&&SoundManager[_0x3c7311(0xaa5)](SoundManager[_0x3c7311(0xf4e)]['MESSAGE_RECEIVED'],_0x14ebac);const _0x33222c=getSMSChatSetting('bubbleColor','blue');_0x35d513['classList'][_0x3c7311(0x1493)](_0x3c7311(0xd08));_0x33222c===_0x3c7311(0x38d)&&_0x35d513['classList'][_0x3c7311(0x21e2)]('green-bubble');const _0x27d52d=_0x1fdf51['isUser']?_0x3c7311(0xd2c):_0x3c7311(0x1e20),_0x169e44=new Date(_0x1fdf51[_0x3c7311(0x1716)]),_0x13eff2=_0x169e44['toLocaleTimeString'](_0x3c7311(0x156c),{'hour':_0x3c7311(0xc79),'minute':_0x3c7311(0xc79)}),_0x4ee3f5=_0x35d513[_0x3c7311(0x1897)]('.sms-message');let _0x5402cd=![];if(_0x4ee3f5[_0x3c7311(0x19ee)]===0x0)_0x5402cd=!![];else{const _0x25543b=_0x4ee3f5[_0x4ee3f5[_0x3c7311(0x19ee)]-0x1],_0x2ec758=_0x25543b[_0x3c7311(0x1ecd)][_0x3c7311(0x1716)];(!_0x2ec758||_0x169e44-new Date(parseInt(_0x2ec758))>0x5*0x3c*0x3e8)&&(_0x5402cd=!![]);}if(_0x5402cd){const _0x2bc892=document['createElement']('div');_0x2bc892[_0x3c7311(0x1722)]=_0x3c7311(0x130b),_0x2bc892[_0x3c7311(0x13be)]=_0x13eff2,_0x35d513['appendChild'](_0x2bc892);}const _0x59a6e0=document[_0x3c7311(0xac6)](_0x3c7311(0xbbc));_0x59a6e0[_0x3c7311(0x1722)]=_0x3c7311(0x21ee)+_0x27d52d,_0x59a6e0['dataset'][_0x3c7311(0x21c8)]=_0x1fdf51['id'],_0x59a6e0['dataset'][_0x3c7311(0xaf5)]=_0x14ebac,_0x59a6e0[_0x3c7311(0x1ecd)][_0x3c7311(0x1716)]=_0x1fdf51[_0x3c7311(0x1716)];let _0x5ac5d1='',_0x13cad5='';if(Array[_0x3c7311(0x1496)](_0x1fdf51[_0x3c7311(0x211c)])){const _0x53f30b=_0x1fdf51[_0x3c7311(0x211c)]['find'](_0x542f4e=>_0x542f4e['type']===_0x3c7311(0x1378));_0x13cad5=_0x53f30b?_0x53f30b[_0x3c7311(0x1378)]:'';}else _0x1fdf51[_0x3c7311(0x1378)]&&(_0x13cad5=_0x1fdf51['text']);if(_0x1fdf51[_0x3c7311(0x1b62)]&&_0x1fdf51['imageUrl']){const _0x3d12d6=isSMSMultiSelectMode?'':_0x3c7311(0x17c6)+_0x1fdf51['imageUrl']+_0x3c7311(0xda7)+(_0x1fdf51[_0x3c7311(0x63f)]||'图片')+'\x27)\x22';_0x5ac5d1='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x1fdf51[_0x3c7311(0xb17)]+_0x3c7311(0x222c)+(_0x1fdf51[_0x3c7311(0x63f)]||'图片')+_0x3c7311(0xc76)+_0x3d12d6+_0x3c7311(0x750);}else{const _0x41b36e=_0x13cad5[_0x3c7311(0xe16)](/&/g,_0x3c7311(0x3e8))['replace'](/</g,_0x3c7311(0x1dfa))[_0x3c7311(0xe16)](/>/g,_0x3c7311(0xe4b))[_0x3c7311(0xe16)](/"/g,_0x3c7311(0xb65))[_0x3c7311(0xe16)](/'/g,_0x3c7311(0x2021));_0x5ac5d1=_0x3c7311(0x171b)+_0x41b36e+_0x3c7311(0x14cf);}_0x59a6e0['innerHTML']=_0x5ac5d1,selectedSMSMessages[_0x3c7311(0x975)](_0x1fdf51['id'])?_0x59a6e0[_0x3c7311(0x1c1b)][_0x3c7311(0x21e2)](_0x3c7311(0x176b)):_0x59a6e0['classList'][_0x3c7311(0x1493)]('selected'),_0x59a6e0[_0x3c7311(0x14eb)][_0x3c7311(0x11af)]='0',_0x59a6e0[_0x3c7311(0x14eb)][_0x3c7311(0x201e)]=_0x3c7311(0x702),_0x35d513[_0x3c7311(0x497)](_0x59a6e0),addSingleSMSMessageEventListener(_0x59a6e0,_0x14ebac),requestAnimationFrame(()=>{const _0x4c69f7=_0x3c7311;_0x59a6e0['style'][_0x4c69f7(0x11af)]='1',_0x59a6e0[_0x4c69f7(0x14eb)][_0x4c69f7(0x201e)]=_0x4c69f7(0x18f9),_0x59a6e0[_0x4c69f7(0x14eb)][_0x4c69f7(0x1022)]=_0x4c69f7(0x1026);}),setTimeout(()=>{const _0xb564bf=_0x3c7311;_0x35d513[_0xb564bf(0x98c)]=_0x35d513[_0xb564bf(0xfe3)];},0x64);}function hideSMSChat(){const _0x1ca7d2=_0x211817;isSMSMultiSelectMode&&exitSMSMultiSelectMode(),document['getElementById']('sms-chat-screen')['style'][_0x1ca7d2(0x4da)]=_0x1ca7d2(0x102b),document[_0x1ca7d2(0x1262)]('messages-screen')[_0x1ca7d2(0x14eb)][_0x1ca7d2(0x4da)]=_0x1ca7d2(0x13de),window[_0x1ca7d2(0xb69)]=null;}function initSMSInput(){const _0x3d5e27=_0x211817,_0x3d435a=document[_0x3d5e27(0x1262)]('sms-message-input');if(!_0x3d435a)return;_0x3d435a[_0x3d5e27(0x21e9)](_0x3d5e27(0x1823),function(){const _0x3c8881=_0x3d5e27,_0x3e097a=document[_0x3c8881(0x1262)](_0x3c8881(0x14d4));this[_0x3c8881(0x1ebc)][_0x3c8881(0x19d7)]()?_0x3e097a[_0x3c8881(0x14eb)]['display']=_0x3c8881(0x1fb7):_0x3e097a[_0x3c8881(0x14eb)][_0x3c8881(0x4da)]=_0x3c8881(0x102b);});}function openSMSImagePicker(){const _0x345e30=_0x211817,_0x25b4f4=document['getElementById'](_0x345e30(0x1624));_0x25b4f4&&_0x25b4f4[_0x345e30(0x1859)]();}function handleSMSImageSelect(_0x48ed63){const _0x4fd0ac=_0x211817,_0x55abaa=_0x48ed63[_0x4fd0ac(0x193d)]['files'][0x0];if(!_0x55abaa)return;if(!_0x55abaa[_0x4fd0ac(0x1a4b)][_0x4fd0ac(0x1b30)](_0x4fd0ac(0x1d60))){showToast(_0x4fd0ac(0x118e),'warning');return;}const _0x40b1d9=0x5*0x400*0x400;if(_0x55abaa[_0x4fd0ac(0x2d8)]>_0x40b1d9){showToast(_0x4fd0ac(0x6e9),_0x4fd0ac(0x1816));return;}if(!window['currentSMSCharacter']){showToast(_0x4fd0ac(0x1346),_0x4fd0ac(0x174a));return;}const _0x52ad01=new FileReader();_0x52ad01[_0x4fd0ac(0xc55)]=function(_0x283fab){const _0x1f87c6=_0x4fd0ac;sendSMSImage(_0x283fab[_0x1f87c6(0x193d)][_0x1f87c6(0x4ee)],_0x55abaa['name']);},_0x52ad01[_0x4fd0ac(0x127c)](_0x55abaa),_0x48ed63['target'][_0x4fd0ac(0x1ebc)]='';}async function sendSMSImage(_0x6edcc0,_0x22ff11){const _0x3812d7=_0x211817;if(!window[_0x3812d7(0xb69)]){showToast(_0x3812d7(0x1015),_0x3812d7(0x174a));return;}const _0x46cd0a=window[_0x3812d7(0xb69)]['id'];try{const _0x339807=document[_0x3812d7(0x1262)]('sms-message-input'),_0x39a806=_0x339807?_0x339807[_0x3812d7(0x1ebc)][_0x3812d7(0x19d7)]():'';console[_0x3812d7(0x2187)](_0x3812d7(0xb1a),_0x39a806),console[_0x3812d7(0x2187)](_0x3812d7(0x1bcd),_0x6edcc0?_0x6edcc0[_0x3812d7(0x19ee)]:0x0);const _0x221e21=[{'type':_0x3812d7(0x1378),'text':_0x39a806}];_0x6edcc0&&_0x221e21[_0x3812d7(0x1cd6)]({'type':_0x3812d7(0x910),'image_url':{'url':_0x6edcc0}});console[_0x3812d7(0x2187)](_0x3812d7(0xe61),_0x221e21),console[_0x3812d7(0x2187)](_0x3812d7(0x1382),_0x221e21[_0x3812d7(0x19ee)]);const _0x1bb147={'id':_0x3812d7(0x1a0d)+Date[_0x3812d7(0x2eb)]()+'-'+Math['random']()[_0x3812d7(0x1878)](0x24)[_0x3812d7(0x15fb)](0x2,0x9),'content':_0x221e21,'text':_0x39a806,'timestamp':Date['now'](),'isUser':!![],'isImage':!![],'imageUrl':_0x6edcc0,'fileName':_0x22ff11};_0x339807&&(_0x339807['value']='',_0x339807[_0x3812d7(0x1912)](new Event(_0x3812d7(0x1823))));!smsMessages[_0x46cd0a]&&(smsMessages[_0x46cd0a]=[]);smsMessages[_0x46cd0a]['push'](_0x1bb147),await saveSingleSMSMessage(_0x46cd0a,_0x1bb147);try{await recordCrossAppEvent(_0x46cd0a,_0x3812d7(0x322),_0x3812d7(0x85f),{'id':_0x46cd0a,'type':_0x3812d7(0x2178),'fileName':_0x22ff11,'fileSize':_0x6edcc0[_0x3812d7(0x19ee)],'chatId':_0x46cd0a,'sender':_0x3812d7(0xa80)},_0x1bb147['id']),console[_0x3812d7(0x2187)](_0x3812d7(0x8a2));}catch(_0x21c32a){console[_0x3812d7(0x174a)](_0x3812d7(0x2174),_0x21c32a);}addSMSMessageWithAnimation(_0x1bb147,_0x46cd0a),renderSMSMessageList(),console[_0x3812d7(0x2187)]('🔥\x20[短信图片]\x20用户图片消息发送成功');}catch(_0x424d45){console[_0x3812d7(0x174a)](_0x3812d7(0x1c3c),_0x424d45),showToast(_0x3812d7(0xeba),_0x3812d7(0x174a));}}function showImagePreview(_0x4ceeff,_0x28a555){showImage(_0x4ceeff);}function handleSMSInputKeydown(_0x4ed4a6){const _0x2bfee3=_0x211817;_0x4ed4a6[_0x2bfee3(0x213c)]===_0x2bfee3(0xdcf)&&(_0x4ed4a6[_0x2bfee3(0x36f)](),sendSMSMessage());}async function sendSMSMessage(){const _0x27e038=_0x211817,_0x3f1aa6=document[_0x27e038(0x1262)](_0x27e038(0x1cb7)),_0x8c630b=_0x3f1aa6[_0x27e038(0x1ebc)][_0x27e038(0x19d7)]();if(!_0x8c630b){showToast(_0x27e038(0x113a),_0x27e038(0x1816));return;}if(!window[_0x27e038(0xb69)]){showToast(_0x27e038(0x1015),'error');return;}SoundManager[_0x27e038(0xaa5)](SoundManager[_0x27e038(0xf4e)][_0x27e038(0x56b)],window['currentSMSCharacter']?.['id']);const _0xc638b3=window[_0x27e038(0xb69)]['id'],_0x1728f7={'id':_0x27e038(0xa48)+Date[_0x27e038(0x2eb)]()+'-'+Math[_0x27e038(0x11a8)]()[_0x27e038(0x1878)](0x24)[_0x27e038(0x15fb)](0x2,0x9),'content':[{'type':_0x27e038(0x1378),'text':_0x8c630b}],'text':_0x8c630b,'timestamp':Date['now'](),'isUser':!![]};!smsMessages[_0xc638b3]&&(smsMessages[_0xc638b3]=[]);smsMessages[_0xc638b3][_0x27e038(0x1cd6)](_0x1728f7),await saveSingleSMSMessage(_0xc638b3,_0x1728f7);try{await recordCrossAppEvent(_0xc638b3,_0x27e038(0x322),_0x27e038(0x20fe),{'id':_0xc638b3,'type':_0x27e038(0xfa9),'content':_0x8c630b[_0x27e038(0x17ca)](0x0,0x64),'messageLength':_0x8c630b[_0x27e038(0x19ee)],'chatId':_0xc638b3,'sender':_0x27e038(0xa80)},_0x1728f7['id']),console[_0x27e038(0x2187)]('📝\x20[短信时间线]\x20已记录用户发送短信事件到跨应用时间线');}catch(_0x46e6ea){console[_0x27e038(0x174a)]('❌\x20[短信时间线]\x20记录用户发送短信事件失败:',_0x46e6ea);}_0x3f1aa6[_0x27e038(0x1ebc)]='',document[_0x27e038(0x1262)](_0x27e038(0x14d4))[_0x27e038(0x14eb)][_0x27e038(0x4da)]=_0x27e038(0x102b),addSMSMessageWithAnimation(_0x1728f7,_0xc638b3),renderSMSMessageList();}async function triggerSMSReply(){const _0x5066fd=_0x211817;if(!window[_0x5066fd(0xb69)]){showToast(_0x5066fd(0x1346),_0x5066fd(0x174a));return;}const _0x155967=window[_0x5066fd(0xb69)]['id'],_0x1ebf48=smsMessages[_0x155967]||[];if(_0x1ebf48['length']===0x0){showToast(_0x5066fd(0x3f8),'info');return;}const _0x29adac=_0x1ebf48[_0x1ebf48['length']-0x1];if(!_0x29adac||!_0x29adac[_0x5066fd(0x714)]){showToast('请先发送消息','info');return;}const _0x2026bf=[];for(let _0x4b56b0=_0x1ebf48[_0x5066fd(0x19ee)]-0x1;_0x4b56b0>=0x0;_0x4b56b0--){const _0x5cf51a=_0x1ebf48[_0x4b56b0];if(_0x5cf51a[_0x5066fd(0x714)])_0x2026bf[_0x5066fd(0x5ed)](_0x5cf51a);else break;}try{await generateSMSReply(window[_0x5066fd(0xb69)],_0x2026bf);}catch(_0x4c341b){console[_0x5066fd(0x174a)](_0x5066fd(0x1ef2),_0x4c341b),showToast(_0x5066fd(0x1f1b)+_0x4c341b[_0x5066fd(0x1e8e)],_0x5066fd(0x174a));}}async function buildSMSPrompt(_0x8157bb,_0x2e1445){const _0x2ba684=_0x211817;console[_0x2ba684(0x2187)](_0x2ba684(0x20cc),_0x8157bb['name']);const _0x5beea5=getSMSChatSetting(_0x2ba684(0x1157),0x32);console['log']('🔥\x20[短信提示词]\x20历史消息回合数:',_0x5beea5);const _0x2be191=_0x8157bb['id'],_0x548f16=smsMessages[_0x2be191]||[],_0x4c7c8b=_0x548f16[_0x2ba684(0x6d5)](-_0x5beea5);console[_0x2ba684(0x2187)]('🔥\x20[短信提示词]\x20短信历史消息数量:',_0x4c7c8b[_0x2ba684(0x19ee)]);const _0x795739=_0x8157bb['id'],_0x5ac353=chatSettings[_0x795739]||{},_0x37c0df=_0x5ac353[_0x2ba684(0x145e)]?personas[_0x2ba684(0xaf4)](_0x128b86=>_0x128b86['id']===_0x5ac353[_0x2ba684(0x145e)]):null;console[_0x2ba684(0x2187)]('🔥\x20[短信提示词]\x20用户身份面具:',_0x37c0df?.[_0x2ba684(0x1a1c)]||_0x2ba684(0x226d));const _0xc41c82=isBlocked(_0x2ba684(0xa80),_0x8157bb['id']),_0x337486=isBlocked(_0x8157bb['id'],_0x2ba684(0xa80)),_0x5b6908=new Date(),_0x480e75=_0x5b6908[_0x2ba684(0xecc)]('zh-CN',{'year':_0x2ba684(0x94d),'month':_0x2ba684(0x14a2),'day':'numeric','hour':_0x2ba684(0xc79),'minute':_0x2ba684(0xc79),'weekday':'long'}),_0x5dd1d0=_0x5b6908[_0x2ba684(0x1da)]()+0x1;let _0x5f458b='';if(_0x5dd1d0>=0x3&&_0x5dd1d0<=0x5)_0x5f458b='春季';else{if(_0x5dd1d0>=0x6&&_0x5dd1d0<=0x8)_0x5f458b='夏季';else{if(_0x5dd1d0>=0x9&&_0x5dd1d0<=0xb)_0x5f458b='秋季';else _0x5f458b='冬季';}}const _0x379e02=_0x5b6908[_0x2ba684(0xe2e)]();let _0x486767='';if(_0x379e02>=0x5&&_0x379e02<0x8)_0x486767='清晨';else{if(_0x379e02>=0x8&&_0x379e02<0xb)_0x486767='上午';else{if(_0x379e02>=0xb&&_0x379e02<0xe)_0x486767='中午';else{if(_0x379e02>=0xe&&_0x379e02<0x11)_0x486767='下午';else{if(_0x379e02>=0x11&&_0x379e02<0x13)_0x486767='傍晚';else{if(_0x379e02>=0x13&&_0x379e02<0x16)_0x486767='晚上';else{if(_0x379e02>=0x16||_0x379e02<0x2)_0x486767='深夜';else _0x486767='凌晨';}}}}}}const _0x48ae9a='-\x20**当前时间:**\x20'+_0x480e75+_0x2ba684(0xd58)+_0x5f458b+'，'+_0x486767+'时分';let _0x49ee6c=_0x2ba684(0x1d38)+_0x8157bb[_0x2ba684(0x1a1c)]+_0x2ba684(0x9c9)+_0x8157bb[_0x2ba684(0x1a1c)]+'\x22的角色，通过短信与用户进行对话。\x0a\x0a##\x20**角色设定:**\x0a'+(_0x8157bb[_0x2ba684(0x1f0b)]||_0x8157bb[_0x2ba684(0x7a1)]||_0x2ba684(0x1fbc))+_0x2ba684(0x22e7)+_0x48ae9a+_0x2ba684(0x14fe);if(_0xc41c82)_0x49ee6c+=_0x2ba684(0xd4a);else _0x337486&&(_0x49ee6c+=_0x2ba684(0x20c1));_0x37c0df&&(_0x49ee6c+='\x0a\x0a##\x20对话者身份\x0a用户在这个短信聊天中的身份是：'+_0x37c0df[_0x2ba684(0x1a1c)]+_0x2ba684(0x446)+(_0x37c0df['description']||_0x2ba684(0x1008))+_0x2ba684(0x1e02));const _0x48459a=_0x5ac353[_0x2ba684(0x1a45)]||[],_0x3d2c7c=window['activeGlobalWorldbooks']||[],_0x37d859=[...new Set([..._0x3d2c7c,..._0x48459a])];return _0x37d859[_0x2ba684(0x19ee)]>0x0&&(_0x49ee6c+='\x0a\x0a##\x20背景知识/世界观\x0a以下是相关的设定信息，请在短信对话中自然地运用：\x0a',_0x37d859[_0x2ba684(0x19fb)](_0x368864=>{const _0x2b1698=_0x2ba684,_0x530c5d=worldbooks[_0x2b1698(0xaf4)](_0x24cd0e=>_0x24cd0e['id']===_0x368864);_0x530c5d&&(_0x49ee6c+=_0x2b1698(0x146e)+_0x530c5d[_0x2b1698(0x378)]+_0x2b1698(0xb72)+_0x530c5d[_0x2b1698(0x211c)]+'\x0a');})),_0x5ac353[_0x2ba684(0x189f)]!==![]&&(_0x49ee6c+=_0x2ba684(0x10e6)),_0x49ee6c;}async function callSMSAPI(_0x192196,_0x393c7c){const _0x22f110=_0x211817;try{console[_0x22f110(0x2187)](_0x22f110(0x1b9c),_0x393c7c['name']);const _0x24783d=_0x393c7c['id'],_0x1dabe8=smsMessages[_0x24783d]||[],_0x3a3d1a=getSMSChatSetting(_0x22f110(0x1157),0x32),_0x5939ee=_0x1dabe8['slice'](-_0x3a3d1a);let _0x76fc09='';_0x5939ee[_0x22f110(0x19ee)]>0x0&&(_0x76fc09=_0x22f110(0xa3d),_0x5939ee[_0x22f110(0x19fb)](_0x5ee15d=>{const _0x1a8f2e=_0x22f110,_0x416451=_0x5ee15d[_0x1a8f2e(0x714)]?'用户':_0x393c7c[_0x1a8f2e(0x1a1c)];_0x76fc09+=_0x416451+':\x20'+_0x5ee15d[_0x1a8f2e(0x1378)]+'\x0a';}));let _0x15dde7='';if(_0x192196[_0x22f110(0x1831)](_0x22f110(0xb81))||_0x192196[_0x22f110(0x1831)](_0x22f110(0x1a55))||_0x192196[_0x22f110(0x1831)](_0x22f110(0x16d0))){const _0x57607c=await buildSMSPrompt(_0x393c7c,'');_0x15dde7=_0x57607c+_0x76fc09+(_0x22f110(0x1394)+_0x192196+'\x0a\x0a##\x20回复要求\x0a请以'+_0x393c7c[_0x22f110(0x1a1c)]+_0x22f110(0x155e));}else{const _0x281074=await buildSMSPrompt(_0x393c7c,_0x192196);_0x15dde7=_0x281074+_0x76fc09+('\x0a\x0a##\x20当前用户消息\x0a用户:\x20'+_0x192196+_0x22f110(0xb5e)+_0x393c7c[_0x22f110(0x1a1c)]+'的身份回复这条短信。要求：\x0a-\x20体现短信聊天的简洁特点，通常1-3条消息\x0a-\x20保持与ChatApp中相同的角色性格和记忆连贯性\x0a-\x20可以延续之前在ChatApp中的话题或情感状态\x0a-\x20【重要】必须使用JSON数组格式回复\x0a-\x20体现\x22真人对话\x22的自然感\x0a-\x20如果需要发送多条消息，请分别放在数组中\x0a\x0a请回复JSON格式的短信内容：');}if(_0x15dde7[_0x22f110(0x1831)](_0x22f110(0x10a9)))try{let _0x4d5817='';const _0x1c7e11=await db[_0x22f110(0x127e)][_0x22f110(0xa24)]('characterId')[_0x22f110(0x1694)](_0x393c7c['id'])[_0x22f110(0xf13)]();if(_0x1c7e11[_0x22f110(0x19ee)]>0x0){const _0x2da611=_0x1c7e11[_0x22f110(0x1104)]((_0x45d38f,_0x3c73f7)=>_0x3c73f7[_0x22f110(0x146c)]-_0x45d38f['importance']);_0x4d5817+=_0x22f110(0x894),_0x2da611[_0x22f110(0x19fb)]((_0x29f95d,_0x39350b)=>{_0x4d5817+=_0x39350b+0x1+'.\x20'+_0x29f95d['fact']+'\x0a';});}const _0x5a7de4=await db[_0x22f110(0x156f)]['where']('characterId')['equals'](_0x393c7c['id'])['toArray'](),_0x40f2c8=_0x5a7de4['sort']((_0x416027,_0x148681)=>_0x148681[_0x22f110(0x1716)]-_0x416027['timestamp'])[_0x22f110(0x6d5)](0x0,0x5);_0x40f2c8[_0x22f110(0x19ee)]>0x0&&(_0x4d5817+=_0x22f110(0x162e),_0x40f2c8['forEach']((_0xd19ed0,_0x187ea6)=>{const _0x4663ef=_0x22f110;_0x4d5817+=_0x187ea6+0x1+'.\x20'+_0xd19ed0[_0x4663ef(0x13e5)]+'\x0a';}));const _0x43cab2=await getVisibleMomentsForCharacter(_0x393c7c['id'],0x3);_0x43cab2[_0x22f110(0x19ee)]>0x0&&(_0x4d5817+=_0x22f110(0x21a4),_0x43cab2[_0x22f110(0x19fb)]((_0x5b590d,_0x36a144)=>{const _0x166a6b=_0x22f110,_0x47610a=_0x5b590d[_0x166a6b(0x22d2)]===_0x166a6b(0xa80)?'用户':_0x5b590d[_0x166a6b(0x215c)];let _0x4254ee='';if(_0x5b590d[_0x166a6b(0x1716)]){const _0x4c0313=Date[_0x166a6b(0x2eb)](),_0x5c6151=_0x4c0313-_0x5b590d[_0x166a6b(0x1716)],_0x4d075b=Math[_0x166a6b(0x2180)](_0x5c6151/(0x3e8*0x3c*0x3c)),_0x15c8d2=Math[_0x166a6b(0x2180)](_0x5c6151/(0x3e8*0x3c*0x3c*0x18));if(_0x15c8d2>0x0)_0x4254ee='\x20('+_0x15c8d2+_0x166a6b(0x1d2);else _0x4d075b>0x0?_0x4254ee='\x20('+_0x4d075b+_0x166a6b(0x188f):_0x4254ee=_0x166a6b(0x1481);}const _0xfcbaa5=_0x36a144+0x1+'.\x20'+_0x47610a+':\x20'+_0x5b590d[_0x166a6b(0x1378)]+_0x4254ee+(_0x5b590d[_0x166a6b(0x1135)]||'');_0x4d5817+=_0xfcbaa5;}));const _0x5d6b00=await getCrossAppTimeline(_0x393c7c['id'],0x5);_0x5d6b00[_0x22f110(0x19ee)]>0x0&&(_0x4d5817+=_0x22f110(0x1030),_0x5d6b00[_0x22f110(0x19fb)]((_0x23967d,_0x540764)=>{const _0x29640d=_0x22f110,_0x2c3762=new Date(_0x23967d['timestamp'])['toLocaleTimeString']('zh-CN',{'hour':'2-digit','minute':'2-digit'});let _0x3a7d66='';switch(_0x23967d[_0x29640d(0x741)]){case _0x29640d(0x210c):_0x3a7d66=_0x29640d(0x13e7)+(_0x23967d['context']['action']===_0x29640d(0xf4a)?_0x29640d(0x21bc):_0x29640d(0x1d03));break;case'game':_0x3a7d66=_0x29640d(0x1d2e)+(_0x23967d['context'][_0x29640d(0x211f)]===_0x29640d(0xa12)?_0x29640d(0x1e88):'互动');break;case _0x29640d(0x1a70):_0x3a7d66=_0x23967d[_0x29640d(0x211f)]==='message'?_0x29640d(0x1a95):'AI回复消息';break;case _0x29640d(0x322):if(_0x23967d[_0x29640d(0x211f)]===_0x29640d(0x20fe))_0x3a7d66=_0x29640d(0x184a);else{if(_0x23967d['action']===_0x29640d(0x120e))_0x3a7d66=_0x29640d(0x70d);else _0x23967d[_0x29640d(0x211f)]===_0x29640d(0x11d3)?_0x3a7d66=_0x29640d(0x1505):_0x3a7d66='短信互动';}break;default:_0x3a7d66='在'+_0x23967d[_0x29640d(0x741)]+_0x29640d(0x16ed)+_0x23967d['action'];}_0x4d5817+=_0x2c3762+_0x29640d(0x1811)+_0x3a7d66+'\x0a';})),_0x4d5817?_0x15dde7=_0x15dde7[_0x22f110(0xe16)](_0x22f110(0x10a9),_0x4d5817):_0x15dde7=_0x15dde7[_0x22f110(0xe16)](_0x22f110(0x10a9),'');}catch(_0x465d47){console[_0x22f110(0x174a)](_0x22f110(0xee7),_0x465d47),_0x15dde7=_0x15dde7[_0x22f110(0xe16)](_0x22f110(0x10a9),'');}console[_0x22f110(0x2187)](_0x22f110(0x1727),_0x15dde7);const _0x431a93=apiSettings[_0x22f110(0x1208)]['includes'](_0x22f110(0x1d80));let _0x5d4980,_0x1593af,_0x4c000d;if(_0x431a93){const _0x350201=apiSettings[_0x22f110(0x1208)]+_0x22f110(0x1107)+apiSettings['model']+_0x22f110(0x40c)+apiSettings[_0x22f110(0x213c)];_0x5d4980=await fetch(_0x350201,{'method':_0x22f110(0x1dd5),'headers':{'Content-Type':'application/json'},'body':JSON[_0x22f110(0x6b8)]({'contents':[{'role':_0x22f110(0xa80),'parts':[{'text':_0x15dde7}]}],'generationConfig':{'temperature':0.8}})});if(!_0x5d4980['ok'])throw new Error(_0x22f110(0x288)+_0x5d4980[_0x22f110(0x12e2)]+'\x20'+_0x5d4980[_0x22f110(0x2035)]);_0x1593af=await _0x5d4980[_0x22f110(0xe52)](),_0x4c000d=_0x1593af['candidates']?.[0x0]?.[_0x22f110(0x211c)]?.[_0x22f110(0x2308)]?.[0x0]?.[_0x22f110(0x1378)];if(!_0x4c000d){console[_0x22f110(0x2187)](_0x22f110(0x827),_0x1593af);throw new Error(_0x22f110(0x1c44));}}else{let _0x39aa05;if(apiSettings[_0x22f110(0x1208)]['endsWith']('/v1'))_0x39aa05=apiSettings[_0x22f110(0x1208)]+_0x22f110(0x1bea);else apiSettings[_0x22f110(0x1208)][_0x22f110(0x1831)](_0x22f110(0x1dac))?_0x39aa05=apiSettings[_0x22f110(0x1208)]+_0x22f110(0x1bea):_0x39aa05=apiSettings[_0x22f110(0x1208)]+_0x22f110(0x666);_0x5d4980=await fetch(_0x39aa05,{'method':_0x22f110(0x1dd5),'headers':{'Content-Type':'application/json','Authorization':_0x22f110(0x1e3c)+apiSettings['key']},'body':JSON['stringify']({'model':apiSettings[_0x22f110(0x1976)],'messages':[{'role':_0x22f110(0xa80),'content':_0x15dde7}],'temperature':0.8,'max_tokens':0xc8,'stream':![]})});if(!_0x5d4980['ok'])throw new Error(_0x22f110(0x61b)+_0x5d4980[_0x22f110(0x12e2)]+'\x20'+_0x5d4980['statusText']);_0x1593af=await _0x5d4980[_0x22f110(0xe52)](),_0x4c000d=_0x1593af['choices']?.[0x0]?.['message']?.[_0x22f110(0x211c)];if(!_0x4c000d){console[_0x22f110(0x2187)](_0x22f110(0x3cc),_0x1593af);throw new Error('API返回了空内容');}}return _0x4c000d=_0x4c000d['trim'](),console[_0x22f110(0x2187)](_0x22f110(0xfd4),_0x4c000d),_0x4c000d;}catch(_0xb51f78){console[_0x22f110(0x174a)](_0x22f110(0xd87),_0xb51f78);throw _0xb51f78;}}async function generateSMSReply(_0x240e5e,_0x42f993){const _0x12abb5=_0x211817;try{console['log'](_0x12abb5(0x23e),_0x240e5e[_0x12abb5(0x1a1c)],_0x12abb5(0x1cb6),_0x42f993),showSMSTypingIndicator(),console['log'](_0x12abb5(0xd7f),_0x42f993);let _0x4c8e3d=![],_0x306eef=[];Array[_0x12abb5(0x1496)](_0x42f993)?_0x42f993[_0x12abb5(0x19fb)](_0x202e51=>{const _0x5a97e1=_0x12abb5;if(Array[_0x5a97e1(0x1496)](_0x202e51['content'])){_0x306eef[_0x5a97e1(0x1cd6)](..._0x202e51[_0x5a97e1(0x211c)]);const _0x10b2c0=_0x202e51['content'][_0x5a97e1(0x19fa)](_0x24f2fa=>_0x24f2fa['type']==='image_url');_0x10b2c0&&(_0x4c8e3d=!![],console['log'](_0x5a97e1(0x973)));}else _0x306eef['push']({'type':_0x5a97e1(0x1378),'text':_0x202e51[_0x5a97e1(0x1378)]||_0x202e51});}):Array[_0x12abb5(0x1496)](_0x42f993[_0x12abb5(0x211c)])?(_0x306eef=_0x42f993[_0x12abb5(0x211c)],_0x4c8e3d=_0x42f993['content'][_0x12abb5(0x19fa)](_0x1eba82=>_0x1eba82[_0x12abb5(0x1a4b)]==='image_url')):_0x306eef=[{'type':'text','text':_0x42f993[_0x12abb5(0x1378)]||_0x42f993}];console['log'](_0x12abb5(0xe69),_0x306eef),console[_0x12abb5(0x2187)](_0x12abb5(0x7ba),_0x4c8e3d);let _0x121717;if(_0x4c8e3d){console[_0x12abb5(0x2187)](_0x12abb5(0xbfc));const _0x54265e=await buildSMSPrompt(_0x240e5e,_0x42f993),_0x5e4799=_0x306eef[_0x12abb5(0xaf4)](_0x4c4565=>_0x4c4565['type']==='text')?.[_0x12abb5(0x1378)]||'',_0x50a322=_0x306eef[_0x12abb5(0xaf4)](_0x3a731a=>_0x3a731a['type']===_0x12abb5(0x910)),_0x240d75=[{'type':_0x12abb5(0x1378),'text':_0x54265e+_0x12abb5(0xa83)+(_0x5e4799?_0x12abb5(0x6e4)+_0x5e4799:'')+'\x0a\x0a##\x20回复要求\x0a请以'+_0x240e5e[_0x12abb5(0x1a1c)]+_0x12abb5(0x12f4)}];_0x50a322&&_0x240d75['push'](_0x50a322),_0x121717=await callChatAPI(_0x240d75,_0x240e5e);}else{console['log'](_0x12abb5(0x1bbc));const _0x298c5c=await buildSMSPrompt(_0x240e5e,_0x42f993),_0x362708=_0x240e5e['id'],_0x1eb082=smsMessages[_0x362708]||[],_0x56d12d=getSMSChatSetting('historyRounds',0x32),_0x131d09=_0x1eb082['slice'](-_0x56d12d);let _0x25599a='';_0x131d09[_0x12abb5(0x19ee)]>0x0&&(_0x25599a=_0x12abb5(0xa3d),_0x131d09[_0x12abb5(0x19fb)](_0x320e6b=>{const _0x3e164b=_0x12abb5,_0x2dd5ef=_0x320e6b['isUser']?'用户':_0x240e5e[_0x3e164b(0x1a1c)],_0x4d0b5a=Array[_0x3e164b(0x1496)](_0x320e6b[_0x3e164b(0x211c)])?_0x320e6b[_0x3e164b(0x211c)][_0x3e164b(0xaf4)](_0x4a79b7=>_0x4a79b7['type']===_0x3e164b(0x1378))?.[_0x3e164b(0x1378)]||'[多媒体消息]':_0x320e6b['text']||_0x3e164b(0x1bad);_0x25599a+=_0x2dd5ef+':\x20'+_0x4d0b5a+'\x0a';}));let _0x419d4d='\x0a\x0a##\x20当前用户消息\x0a';Array[_0x12abb5(0x1496)](_0x42f993)?_0x42f993[_0x12abb5(0x19fb)](_0x2c7227=>{const _0xeb3974=_0x12abb5,_0x393333=Array['isArray'](_0x2c7227[_0xeb3974(0x211c)])?_0x2c7227[_0xeb3974(0x211c)]['find'](_0x3f6e08=>_0x3f6e08[_0xeb3974(0x1a4b)]===_0xeb3974(0x1378))?.[_0xeb3974(0x1378)]||_0xeb3974(0x1ced):_0x2c7227[_0xeb3974(0x1378)]||_0x2c7227;_0x419d4d+=_0xeb3974(0x623)+_0x393333+'\x0a';}):_0x419d4d+=_0x12abb5(0x623)+_0x42f993+'\x0a';const _0x3ae545=_0x298c5c+_0x25599a+_0x419d4d+(_0x12abb5(0x1331)+_0x240e5e['name']+'的身份回复这些短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格和记忆连贯性\x0a-\x20直接输出JSON数组，不要代码块标记\x0a\x0a请回复：');_0x121717=await generateAIResponse(_0x3ae545,_0x240e5e);}console[_0x12abb5(0x2187)](_0x12abb5(0x18fd),_0x121717);if(_0x121717&&_0x121717['trim']()){let _0x417cb3=[];try{let _0x28d428=_0x121717[_0x12abb5(0x19d7)]();_0x28d428=_0x28d428[_0x12abb5(0xe16)](/^```json\s*/,'')[_0x12abb5(0xe16)](/\s*```$/,''),_0x28d428=_0x28d428[_0x12abb5(0xe16)](/^```\s*/,'')[_0x12abb5(0xe16)](/\s*```$/,'');const _0x1edd37=JSON[_0x12abb5(0x22d3)](_0x28d428);if(Array[_0x12abb5(0x1496)](_0x1edd37))_0x417cb3=_0x1edd37[_0x12abb5(0x1e1f)](_0xd69056=>{const _0xcb397b=_0x12abb5;return _0xd69056&&typeof _0xd69056===_0xcb397b(0x11b7)&&_0xd69056['trim']();});else typeof _0x1edd37==='string'?_0x417cb3=[_0x1edd37]:_0x417cb3=[_0x121717[_0x12abb5(0x19d7)]()];}catch(_0x2bc955){console[_0x12abb5(0x2187)]('🔥\x20[短信AI回复]\x20JSON解析失败，尝试提取文本:',_0x2bc955);const _0x159675=_0x121717[_0x12abb5(0x1b87)](/"([^"]+)"/g);_0x159675?_0x417cb3=_0x159675[_0x12abb5(0x6a4)](_0x375350=>_0x375350[_0x12abb5(0x6d5)](0x1,-0x1))[_0x12abb5(0x1e1f)](_0x341f2f=>_0x341f2f[_0x12abb5(0x19d7)]()):_0x417cb3=_0x121717[_0x12abb5(0x19d7)]()[_0x12abb5(0x204b)]('\x0a')[_0x12abb5(0x1e1f)](_0x1e8a43=>_0x1e8a43['trim']());}!smsMessages[_0x240e5e['id']]&&(smsMessages[_0x240e5e['id']]=[]);for(let _0x3cf0e5=0x0;_0x3cf0e5<_0x417cb3['length'];_0x3cf0e5++){const _0x1598a1=_0x417cb3[_0x3cf0e5][_0x12abb5(0x19d7)]();if(_0x1598a1){if(_0x3cf0e5>0x0){showSMSTypingIndicator();const _0x5b75d4=Math[_0x12abb5(0x11a8)]()*0x3e8+0x1f4;await new Promise(_0x384331=>setTimeout(_0x384331,_0x5b75d4)),hideSMSTypingIndicator();}const _0x4e8f20={'id':'sms-ai-'+Date[_0x12abb5(0x2eb)]()+'-'+_0x3cf0e5+'-'+Math['random']()[_0x12abb5(0x1878)](0x24)[_0x12abb5(0x15fb)](0x2,0x9),'content':[{'type':_0x12abb5(0x1378),'text':_0x1598a1}],'text':_0x1598a1,'timestamp':Date[_0x12abb5(0x2eb)]()+_0x3cf0e5*0x64,'isUser':![]};smsMessages[_0x240e5e['id']][_0x12abb5(0x1cd6)](_0x4e8f20),await saveSingleSMSMessage(_0x240e5e['id'],_0x4e8f20),addSMSMessageWithAnimation(_0x4e8f20,_0x240e5e['id']),createSMSPushNotification(_0x240e5e,_0x4e8f20[_0x12abb5(0x1378)],_0x3cf0e5*0x1f4),await new Promise(_0x23d711=>setTimeout(_0x23d711,0xc8));}}console[_0x12abb5(0x2187)]('🔥\x20[短信AI回复]\x20已逐条添加并保存'+_0x417cb3[_0x12abb5(0x19ee)]+_0x12abb5(0x1425));try{await recordCrossAppEvent(_0x240e5e['id'],'sms',_0x12abb5(0x120e),{'id':_0x240e5e['id'],'type':_0x12abb5(0x9bf),'content':_0x121717[_0x12abb5(0x19d7)]()[_0x12abb5(0x17ca)](0x0,0x64),'messageCount':_0x417cb3[_0x12abb5(0x19ee)],'userMessage':Array[_0x12abb5(0x1496)](_0x42f993)?_0x42f993[_0x12abb5(0x122b)]('\x20')[_0x12abb5(0x17ca)](0x0,0x32):_0x42f993[_0x12abb5(0x17ca)](0x0,0x32),'chatId':_0x240e5e['id'],'sender':'ai'},smsMessages[_0x240e5e['id']][smsMessages[_0x240e5e['id']][_0x12abb5(0x19ee)]-0x1]['id']),console[_0x12abb5(0x2187)](_0x12abb5(0x123e));}catch(_0x4e247f){console[_0x12abb5(0x174a)]('❌\x20[短信时间线]\x20记录AI回复事件失败:',_0x4e247f);}}hideSMSTypingIndicator(),renderSMSMessageList();}catch(_0x3933d9){console[_0x12abb5(0x174a)]('生成短信AI回复失败:',_0x3933d9),hideSMSTypingIndicator();throw _0x3933d9;}}async function characterInitiateSMS(_0x3d4af0,_0x1bcf9a=_0x211817(0x185f)){const _0x5b87c7=_0x211817;try{const _0x3bf773=characters['find'](_0x28d4d7=>_0x28d4d7['id']===_0x3d4af0);if(!_0x3bf773){console[_0x5b87c7(0x174a)]('角色不存在:',_0x3d4af0);return;}console['log'](_0x5b87c7(0x17c3),_0x1bcf9a);!smsContacts[_0x5b87c7(0x1831)](_0x3d4af0)&&(smsContacts[_0x5b87c7(0x1cd6)](_0x3d4af0),await saveSMSContacts());!smsMessages[_0x3d4af0]&&(smsMessages[_0x3d4af0]=[]);let _0x523d07='';if(_0x1bcf9a===_0x5b87c7(0x185f))_0x523d07=_0x5b87c7(0x1c31);else _0x1bcf9a===_0x5b87c7(0x1467)?_0x523d07='用户拒绝了你的好友申请，但你想通过短信继续尝试联系，希望用户能给你一个机会。请发送一条短信给用户。消息要礼貌、不强求，符合短信的特点。':_0x523d07=_0x5b87c7(0x824);const _0x125739=await buildSMSPrompt(_0x3bf773,''),_0x431bdb=_0x125739+(_0x5b87c7(0x1394)+_0x523d07+_0x5b87c7(0xb5e)+_0x3bf773['name']+_0x5b87c7(0x1302)),_0x1b9e52=await generateAIResponse(_0x431bdb,_0x3bf773);if(_0x1b9e52&&_0x1b9e52['trim']()){let _0x52febd=_0x1b9e52[_0x5b87c7(0x19d7)]();try{let _0x3c682f=_0x1b9e52['trim']();_0x3c682f=_0x3c682f[_0x5b87c7(0xe16)](/^```json\s*/,'')[_0x5b87c7(0xe16)](/\s*```$/,''),_0x3c682f=_0x3c682f['replace'](/^```\s*/,'')[_0x5b87c7(0xe16)](/\s*```$/,'');const _0x2b26f2=JSON['parse'](_0x3c682f);if(Array[_0x5b87c7(0x1496)](_0x2b26f2)&&_0x2b26f2[_0x5b87c7(0x19ee)]>0x0){const _0x160b69=_0x2b26f2[_0x5b87c7(0xaf4)](_0x94c3ee=>typeof _0x94c3ee===_0x5b87c7(0x11b7)&&_0x94c3ee[_0x5b87c7(0x19d7)]());_0x160b69&&(_0x52febd=_0x160b69);}else typeof _0x2b26f2===_0x5b87c7(0x11b7)&&(_0x52febd=_0x2b26f2);}catch(_0x3784a5){console[_0x5b87c7(0x2187)](_0x5b87c7(0x15ee),_0x3784a5);const _0x5a23e9=_0x1b9e52[_0x5b87c7(0x1b87)](/"([^"]+)"/);_0x5a23e9&&(_0x52febd=_0x5a23e9[0x1]);}const _0x588614={'id':'sms-initiate-'+Date[_0x5b87c7(0x2eb)]()+'-'+Math[_0x5b87c7(0x11a8)]()[_0x5b87c7(0x1878)](0x24)[_0x5b87c7(0x15fb)](0x2,0x9),'content':[{'type':'text','text':_0x52febd}],'text':_0x52febd,'timestamp':Date[_0x5b87c7(0x2eb)](),'isUser':![]};smsMessages[_0x3d4af0][_0x5b87c7(0x1cd6)](_0x588614),await saveSingleSMSMessage(_0x3d4af0,_0x588614);window[_0x5b87c7(0xb69)]&&window[_0x5b87c7(0xb69)]['id']===_0x3d4af0&&addSMSMessageWithAnimation(_0x588614,_0x3d4af0);createSMSPushNotification(_0x3bf773,_0x588614[_0x5b87c7(0x1378)],0x64);try{await recordCrossAppEvent(_0x3d4af0,_0x5b87c7(0x322),_0x5b87c7(0x11d3),{'id':_0x3d4af0,'type':_0x5b87c7(0x1fa0),'content':_0x1b9e52[_0x5b87c7(0x19d7)]()[_0x5b87c7(0x17ca)](0x0,0x64),'reason':_0x1bcf9a,'initiateType':_0x5b87c7(0x1622),'chatId':_0x3d4af0,'sender':'ai'},_0x588614['id']),console[_0x5b87c7(0x2187)](_0x5b87c7(0x1f21));}catch(_0x5d9c05){console['error'](_0x5b87c7(0x1830),_0x5d9c05);}}await saveSMSContacts(),renderSMSMessageList(),console['log'](_0x5b87c7(0x16a4)+_0x3bf773[_0x5b87c7(0x1a1c)]+_0x5b87c7(0xeed)),showToast(_0x3bf773['name']+_0x5b87c7(0x1528),_0x5b87c7(0x477));}catch(_0x7dfffc){console[_0x5b87c7(0x174a)](_0x5b87c7(0x1f5d),_0x7dfffc);}}window[_0x211817(0x1e53)]=async function(_0x5157dc){const _0x5cf164=_0x211817;if(Math[_0x5cf164(0x11a8)]()<0.3){const _0x310192=Math[_0x5cf164(0x11a8)]()*0x4*0x3c*0x3e8+0x3c*0x3e8;setTimeout(()=>{const _0x2c6e5a=_0x5cf164;characterInitiateSMS(_0x5157dc,_0x2c6e5a(0x185f));},_0x310192),console[_0x5cf164(0x2187)](_0x5cf164(0x1ffb)+_0x5157dc+'\x20将在\x20'+Math['round'](_0x310192/0x3e8/0x3c)+'\x20分钟后通过短信联系用户');}},window[_0x211817(0x93a)]=async function(_0x8b20ad){const _0x1fa0a1=_0x211817;console[_0x1fa0a1(0x2187)](_0x1fa0a1(0x1f34)+_0x8b20ad+_0x1fa0a1(0x15e6));const _0x30f917=_0x1fa0a1(0x736)+_0x8b20ad;let _0x48b733=parseInt(localStorage[_0x1fa0a1(0x15d8)](_0x30f917)||'0')+0x1;localStorage[_0x1fa0a1(0x192)](_0x30f917,_0x48b733[_0x1fa0a1(0x1878)]());let _0x41d5c5=0.6,_0x5a1e8a=0.3;_0x48b733>=0x2&&(_0x41d5c5=0.8,_0x5a1e8a=0.5);_0x48b733>=0x3&&(_0x41d5c5=0.9,_0x5a1e8a=0.2);if(Math[_0x1fa0a1(0x11a8)]()<_0x41d5c5){const _0x453f4d=Math['random']()*0x1e*0x3c*0x3e8+0xa*0x3c*0x3e8;setTimeout(()=>{characterInitiateSMS(_0x8b20ad,'friend_request_rejected');},_0x453f4d),console[_0x1fa0a1(0x2187)](_0x1fa0a1(0x139f)+_0x8b20ad+_0x1fa0a1(0x1b6c)+Math[_0x1fa0a1(0x13e2)](_0x453f4d/0x3e8/0x3c)+_0x1fa0a1(0x16b4));}if(Math[_0x1fa0a1(0x11a8)]()<_0x5a1e8a&&_0x48b733<0x4){const _0x28c478=Math[_0x1fa0a1(0x11a8)]()*0x78*0x3c*0x3e8+0x3c*0x3c*0x3e8;setTimeout(async()=>{await characterRetryFriendRequest(_0x8b20ad,_0x48b733);},_0x28c478),console[_0x1fa0a1(0x2187)]('🔄\x20[重试策略]\x20'+_0x8b20ad+_0x1fa0a1(0x1b6c)+Math[_0x1fa0a1(0x13e2)](_0x28c478/0x3e8/0x3c)+_0x1fa0a1(0x217e));}setTimeout(async()=>{await expressRejectionFeelings(_0x8b20ad,_0x48b733);},Math[_0x1fa0a1(0x11a8)]()*0xa*0x3c*0x3e8+0x5*0x3c*0x3e8);};async function characterRetryFriendRequest(_0x251500,_0x291668){const _0x5caf71=_0x211817;try{const _0x31a0d3=characters[_0x5caf71(0xaf4)](_0x30a76c=>_0x30a76c['id']===_0x251500);if(!_0x31a0d3)return;const _0x115e1d='你是'+_0x31a0d3['name']+_0x5caf71(0x91b)+_0x291668+_0x5caf71(0x4af)+_0x31a0d3[_0x5caf71(0x1f0b)]+_0x5caf71(0x3c0)+_0x291668+_0x5caf71(0x125a),_0x4d9d3f=await generateAIResponse(_0x115e1d,_0x31a0d3),_0x340d73=await parseAiResponse(_0x4d9d3f);for(const _0x264404 of _0x340d73){if(typeof _0x264404===_0x5caf71(0x28d)&&_0x264404[_0x5caf71(0x1a4b)]===_0x5caf71(0x2051)){const _0x4a92ff={'id':Date[_0x5caf71(0x2eb)]()[_0x5caf71(0x1878)](),'sender':_0x5caf71(0xb11),'type':_0x5caf71(0x2051),'message':_0x264404[_0x5caf71(0x1e8e)]||_0x5caf71(0x107c),'timestamp':Date[_0x5caf71(0x2eb)](),'isRetryRequest':!![],'retryCount':_0x291668};!chatMessages[_0x251500]&&(chatMessages[_0x251500]=[]);chatMessages[_0x251500]['push'](_0x4a92ff);currentChatCharacter&&currentChatCharacter['id']===_0x251500&&addMessageWithAnimation(_0x4a92ff,_0x251500);await saveChatMessagesImmediate([_0x251500]),console['log'](_0x5caf71(0x290)+_0x31a0d3['name']+_0x5caf71(0xaeb)+(_0x291668+0x1)+_0x5caf71(0x1227));break;}else{if(typeof _0x264404===_0x5caf71(0x11b7)){const _0x534961={'id':Date[_0x5caf71(0x2eb)]()['toString'](),'sender':_0x5caf71(0xb11),'content':_0x264404,'timestamp':Date[_0x5caf71(0x2eb)](),'isGiveUpMessage':!![]};!chatMessages[_0x251500]&&(chatMessages[_0x251500]=[]);chatMessages[_0x251500][_0x5caf71(0x1cd6)](_0x534961);currentChatCharacter&&currentChatCharacter['id']===_0x251500&&addMessageWithAnimation(_0x534961,_0x251500);await saveChatMessagesImmediate([_0x251500]),console[_0x5caf71(0x2187)](_0x5caf71(0x2082)+_0x31a0d3[_0x5caf71(0x1a1c)]+'\x20决定放弃重试好友申请');break;}}}}catch(_0x3cda4c){console[_0x5caf71(0x174a)](_0x5caf71(0xad3),_0x3cda4c);}}async function expressRejectionFeelings(_0x4aa9bf,_0x5e807c){const _0x136f9b=_0x211817;try{const _0x2ff4f2=characters['find'](_0x2265f5=>_0x2265f5['id']===_0x4aa9bf);if(!_0x2ff4f2)return;const _0x5e6c1e='你是'+_0x2ff4f2['name']+_0x136f9b(0x11de)+_0x5e807c+_0x136f9b(0x640)+_0x2ff4f2[_0x136f9b(0x1f0b)]+_0x136f9b(0xb4f),_0x4f1361=await generateAIResponse(_0x5e6c1e,_0x2ff4f2),_0x55a926=await parseAiResponse(_0x4f1361);for(const _0x4bf950 of _0x55a926){if(typeof _0x4bf950===_0x136f9b(0x11b7)){const _0xae3a3e={'id':Date[_0x136f9b(0x2eb)]()[_0x136f9b(0x1878)](),'sender':_0x136f9b(0xb11),'content':_0x4bf950,'timestamp':Date[_0x136f9b(0x2eb)](),'isRejectionFeeling':!![]};!chatMessages[_0x4aa9bf]&&(chatMessages[_0x4aa9bf]=[]),chatMessages[_0x4aa9bf][_0x136f9b(0x1cd6)](_0xae3a3e),currentChatCharacter&&currentChatCharacter['id']===_0x4aa9bf&&addMessageWithAnimation(_0xae3a3e,_0x4aa9bf),await saveChatMessagesImmediate([_0x4aa9bf]),console[_0x136f9b(0x2187)]('💭\x20'+_0x2ff4f2[_0x136f9b(0x1a1c)]+_0x136f9b(0x447));}}}catch(_0x335375){console[_0x136f9b(0x174a)](_0x136f9b(0x1b0e),_0x335375);}}function showSMSChatInfo(){const _0x3d6527=_0x211817;if(!window[_0x3d6527(0xb69)])return;document['getElementById'](_0x3d6527(0x659))[_0x3d6527(0x14eb)]['display']=_0x3d6527(0x102b),document[_0x3d6527(0x1262)]('sms-chat-settings-screen')[_0x3d6527(0x14eb)]['display']='block',initSMSChatSettings();}function hideSMSChatSettings(){const _0x1bffe9=_0x211817;document[_0x1bffe9(0x1262)](_0x1bffe9(0x907))[_0x1bffe9(0x14eb)]['display']=_0x1bffe9(0x102b),document[_0x1bffe9(0x1262)](_0x1bffe9(0x659))[_0x1bffe9(0x14eb)][_0x1bffe9(0x4da)]=_0x1bffe9(0x13de);}function initSMSChatSettings(){const _0x2da278=_0x211817;if(!window['currentSMSCharacter'])return;const _0x3e7e9d=getSMSChatSetting(_0x2da278(0x1157),0x32);document['getElementById'](_0x2da278(0x13df))['value']=_0x3e7e9d,document['getElementById'](_0x2da278(0x106c))[_0x2da278(0x13be)]=_0x3e7e9d+'轮';const _0x37e658=getSMSChatSetting(_0x2da278(0x1d06),_0x2da278(0x6a8));updateBubbleColorSelection(_0x37e658);}function getSMSChatSetting(_0x12b822,_0x193f73){const _0x385bc3=_0x211817;if(!window[_0x385bc3(0xb69)])return _0x193f73;const _0x2e51c5=_0x385bc3(0x18aa)+window[_0x385bc3(0xb69)]['id']+'-'+_0x12b822,_0x4a3222=localStorage['getItem'](_0x2e51c5);return _0x4a3222!==null?_0x4a3222:_0x193f73;}function setSMSChatSetting(_0x116372,_0x8198ef){const _0x2f88cc=_0x211817;if(!window[_0x2f88cc(0xb69)])return;const _0x1ebe2f=_0x2f88cc(0x18aa)+window[_0x2f88cc(0xb69)]['id']+'-'+_0x116372;localStorage[_0x2f88cc(0x192)](_0x1ebe2f,_0x8198ef);}function updateSMSHistoryRounds(){const _0x232fd0=_0x211817,_0x206213=document[_0x232fd0(0x1262)](_0x232fd0(0x13df)),_0x24948b=_0x206213[_0x232fd0(0x1ebc)];document[_0x232fd0(0x1262)]('sms-history-rounds-value')[_0x232fd0(0x13be)]=_0x24948b+'轮',setSMSChatSetting('historyRounds',_0x24948b);}function setSMSBubbleColor(_0x39c791){setSMSChatSetting('bubbleColor',_0x39c791),updateBubbleColorSelection(_0x39c791),updateSMSChatBubbleColors(_0x39c791);}function updateBubbleColorSelection(_0x2a6a66){const _0x28469f=_0x211817;document['querySelectorAll'](_0x28469f(0x2289))[_0x28469f(0x19fb)](_0x5009ad=>{const _0x481e0f=_0x28469f;_0x5009ad[_0x481e0f(0x1c1b)]['remove']('active');}),document['querySelector'](_0x28469f(0x282)+_0x2a6a66+'\x22]')['classList'][_0x28469f(0x21e2)](_0x28469f(0x1a14));}function updateSMSChatBubbleColors(_0x358051){const _0x5294b2=_0x211817,_0xa99664=document[_0x5294b2(0x1262)](_0x5294b2(0x12d2));_0xa99664&&(_0xa99664[_0x5294b2(0x1c1b)][_0x5294b2(0x1493)](_0x5294b2(0xd08)),_0x358051==='green'&&_0xa99664['classList'][_0x5294b2(0x21e2)](_0x5294b2(0xd08)));}async function clearSMSChatHistory(){const _0x1413ee=_0x211817;if(!window[_0x1413ee(0xb69)]){showToast('请先选择一个短信对话','error');return;}const _0x57a1cb=window[_0x1413ee(0xb69)],_0x39e44b=_0x1413ee(0x1e73)+_0x57a1cb[_0x1413ee(0x1a1c)]+_0x1413ee(0x1f7f);if(confirm(_0x39e44b))try{const _0x189bf8=_0x57a1cb['id'];console[_0x1413ee(0x2187)](_0x1413ee(0x8c9)+_0x57a1cb[_0x1413ee(0x1a1c)]+_0x1413ee(0x355));smsMessages[_0x189bf8]&&delete smsMessages[_0x189bf8];await db[_0x1413ee(0x1b6a)][_0x1413ee(0xa24)](_0x1413ee(0xaf5))['equals'](_0x189bf8)['delete']();const _0x3e52c2=await db[_0x1413ee(0x8ac)][_0x1413ee(0xa24)]('characterId')[_0x1413ee(0x1694)](_0x189bf8)['and'](_0x1b4b44=>_0x1b4b44[_0x1413ee(0x741)]==='sms')[_0x1413ee(0xf13)]();if(_0x3e52c2[_0x1413ee(0x19ee)]>0x0){const _0x29e51b=_0x3e52c2[_0x1413ee(0x6a4)](_0x3c37a9=>_0x3c37a9['id']);await db[_0x1413ee(0x8ac)][_0x1413ee(0x1aaa)](_0x29e51b),console[_0x1413ee(0x2187)](_0x1413ee(0x1638)+_0x3e52c2[_0x1413ee(0x19ee)]+'\x20条短信相关时间线记忆');}const _0x268499=await db[_0x1413ee(0x156f)][_0x1413ee(0xa24)](_0x1413ee(0xaf5))['equals'](_0x189bf8)['toArray']();if(_0x268499[_0x1413ee(0x19ee)]>0x0){const _0x272bb1=_0x268499[_0x1413ee(0x6a4)](_0x295d54=>_0x295d54['id']);await db[_0x1413ee(0x156f)][_0x1413ee(0x1aaa)](_0x272bb1),console[_0x1413ee(0x2187)](_0x1413ee(0x1638)+_0x268499[_0x1413ee(0x19ee)]+_0x1413ee(0xbc2));}const _0x25442a=await db[_0x1413ee(0x127e)][_0x1413ee(0xa24)](_0x1413ee(0xaf5))['equals'](_0x189bf8)['toArray']();if(_0x25442a[_0x1413ee(0x19ee)]>0x0){const _0x3520be=_0x25442a[_0x1413ee(0x6a4)](_0x2bcb44=>_0x2bcb44['id']);await db[_0x1413ee(0x127e)]['bulkDelete'](_0x3520be),console[_0x1413ee(0x2187)](_0x1413ee(0x1638)+_0x25442a[_0x1413ee(0x19ee)]+'\x20条核心记忆');}renderSMSMessages(_0x189bf8),renderSMSMessageList(),showToast(_0x1413ee(0x1592)+_0x57a1cb[_0x1413ee(0x1a1c)]+'\x20的所有短信记录和记忆',_0x1413ee(0x11cb)),console['log'](_0x1413ee(0x16cc)+_0x3e52c2[_0x1413ee(0x19ee)]+_0x1413ee(0xa18)+_0x268499['length']+'条情景记忆、'+_0x25442a[_0x1413ee(0x19ee)]+_0x1413ee(0x1982));}catch(_0x157d54){console[_0x1413ee(0x174a)]('清空短信聊天记录失败:',_0x157d54),showToast('清空聊天记录失败',_0x1413ee(0x174a));}}function renderSMSMessageList(){const _0x4b4fbb=_0x211817,_0x59dadf=document[_0x4b4fbb(0x1262)]('messages-list');if(!_0x59dadf)return;_0x59dadf[_0x4b4fbb(0x33a)]='';if(!smsContacts||smsContacts[_0x4b4fbb(0x19ee)]===0x0){_0x59dadf[_0x4b4fbb(0x33a)]=_0x4b4fbb(0x8c1);return;}const _0x5ed4ff=[...smsContacts]['sort']((_0x18ea0e,_0x47dbe0)=>{const _0x57fd74=_0x4b4fbb,_0x2eb93f=pinnedSMSConversations[_0x57fd74(0x975)](_0x18ea0e),_0x47c9da=pinnedSMSConversations[_0x57fd74(0x975)](_0x47dbe0);if(_0x2eb93f&&!_0x47c9da)return-0x1;if(!_0x2eb93f&&_0x47c9da)return 0x1;return 0x0;});_0x5ed4ff[_0x4b4fbb(0x19fb)](_0x3eedce=>{const _0x377a0d=_0x4b4fbb,_0x174191=characters[_0x377a0d(0xaf4)](_0x13c97b=>_0x13c97b['id']===_0x3eedce);if(!_0x174191)return;const _0x1c24fc=smsMessages[_0x3eedce]||[],_0x1acb93=_0x1c24fc[_0x1c24fc[_0x377a0d(0x19ee)]-0x1];let _0x5d88d0='';if(_0x1acb93){const _0x1e974c=new Date(_0x1acb93[_0x377a0d(0x1716)]),_0x19c276=new Date(),_0x3be3ff=new Date(_0x19c276['getFullYear'](),_0x19c276['getMonth'](),_0x19c276[_0x377a0d(0x520)]()),_0x3517cd=new Date(_0x3be3ff[_0x377a0d(0x704)]()-0x18*0x3c*0x3c*0x3e8),_0x3bc5c6=new Date(_0x1e974c[_0x377a0d(0x16a0)](),_0x1e974c[_0x377a0d(0x1da)](),_0x1e974c[_0x377a0d(0x520)]()),_0x11119c=_0x19c276[_0x377a0d(0x704)]()-_0x1e974c[_0x377a0d(0x704)](),_0xd0adb9=Math[_0x377a0d(0x2180)](_0x11119c/(0x3e8*0x3c*0x3c*0x18));if(_0x3bc5c6[_0x377a0d(0x704)]()===_0x3be3ff[_0x377a0d(0x704)]())_0x5d88d0=_0x1e974c['toLocaleTimeString'](_0x377a0d(0x156c),{'hour':'2-digit','minute':_0x377a0d(0xc79)});else{if(_0x3bc5c6['getTime']()===_0x3517cd['getTime']())_0x5d88d0='昨天';else{if(_0xd0adb9<0x7){const _0x322556=[_0x377a0d(0x1669),_0x377a0d(0xdfa),_0x377a0d(0x364),'星期三',_0x377a0d(0x1a9f),_0x377a0d(0x1152),_0x377a0d(0x818)];_0x5d88d0=_0x322556[_0x1e974c['getDay']()];}else _0x5d88d0=_0x1e974c['toLocaleDateString'](_0x377a0d(0x156c),{'year':_0x377a0d(0x94d),'month':_0x377a0d(0x94d),'day':_0x377a0d(0x94d)});}}}else _0x5d88d0=new Date()[_0x377a0d(0xbf7)]('zh-CN',{'year':'numeric','month':_0x377a0d(0x94d),'day':_0x377a0d(0x94d)});let _0x286832='';if(_0x1acb93){if(_0x1acb93[_0x377a0d(0x1b62)])_0x286832=_0x377a0d(0x1bb6);else{let _0x4f3662='';if(Array[_0x377a0d(0x1496)](_0x1acb93[_0x377a0d(0x211c)])){const _0x591274=_0x1acb93[_0x377a0d(0x211c)][_0x377a0d(0xaf4)](_0x552885=>_0x552885['type']===_0x377a0d(0x1378));_0x4f3662=_0x591274?_0x591274['text']:'';}else _0x1acb93['text']&&(_0x4f3662=_0x1acb93[_0x377a0d(0x1378)]);_0x4f3662?_0x286832=_0x4f3662[_0x377a0d(0x19ee)]>0x14?_0x4f3662[_0x377a0d(0x17ca)](0x0,0x14)+_0x377a0d(0x1520):_0x4f3662:_0x286832='[图片]';}}else _0x286832=_0x377a0d(0x791);const _0x1be32d=document[_0x377a0d(0xac6)](_0x377a0d(0xbbc)),_0x37e545=pinnedSMSConversations[_0x377a0d(0x975)](_0x3eedce),_0x59a7f1=selectedSMSConversations[_0x377a0d(0x975)](_0x3eedce);_0x1be32d['className']=_0x377a0d(0xb20)+(_0x37e545?_0x377a0d(0x469):'')+'\x20'+(_0x59a7f1?_0x377a0d(0x176b):''),isSMSListMultiSelectMode?_0x1be32d[_0x377a0d(0x1f36)]=()=>toggleSMSConversationSelection(_0x3eedce):_0x1be32d[_0x377a0d(0x1f36)]=()=>startSMSChat(_0x174191),_0x1be32d[_0x377a0d(0x33a)]=_0x377a0d(0x1ec2)+(_0x174191[_0x377a0d(0x1994)]?'<img\x20src=\x22'+_0x174191[_0x377a0d(0x1994)]+'\x22\x20alt=\x22'+_0x174191[_0x377a0d(0x1a1c)]+'\x22>':_0x377a0d(0x104a)+_0x174191[_0x377a0d(0x1a1c)]['charAt'](0x0)+_0x377a0d(0x1844))+_0x377a0d(0x1df4)+_0x174191[_0x377a0d(0x1a1c)]+_0x377a0d(0x201c)+_0x5d88d0+_0x377a0d(0x1d47)+_0x286832+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!isSMSListMultiSelectMode?_0x377a0d(0x1dcc):'')+_0x377a0d(0x19d9),_0x59dadf['appendChild'](_0x1be32d);});}async function deleteSMSConversation(_0x58b996){const _0x1cc038=_0x211817,_0x11e888=characters[_0x1cc038(0xaf4)](_0x38c2e9=>_0x38c2e9['id']===_0x58b996);if(!_0x11e888)return;const _0xfc6052=_0x1cc038(0x1c2f)+_0x11e888['name']+_0x1cc038(0x918);if(confirm(_0xfc6052))try{console[_0x1cc038(0x2187)](_0x1cc038(0x1a34)+_0x11e888['name']+_0x1cc038(0xc5d));const _0x19f45d=smsContacts[_0x1cc038(0x13c5)](_0x58b996);_0x19f45d>-0x1&&smsContacts[_0x1cc038(0x19b2)](_0x19f45d,0x1);smsMessages[_0x58b996]&&delete smsMessages[_0x58b996];await db[_0x1cc038(0x1464)]('rw',[db[_0x1cc038(0xdaa)],db[_0x1cc038(0x1b6a)]],async()=>{const _0x539831=_0x1cc038;await db[_0x539831(0xdaa)][_0x539831(0xa24)]('characterId')['equals'](_0x58b996)[_0x539831(0x1f4a)](),await db['smsMessages'][_0x539831(0xa24)]('characterId')['equals'](_0x58b996)[_0x539831(0x1f4a)]();});const _0x43e052=await db[_0x1cc038(0x8ac)][_0x1cc038(0xa24)](_0x1cc038(0xaf5))['equals'](_0x58b996)[_0x1cc038(0x82f)](_0x1de5fc=>_0x1de5fc[_0x1cc038(0x741)]===_0x1cc038(0x322))[_0x1cc038(0xf13)]();if(_0x43e052[_0x1cc038(0x19ee)]>0x0){const _0xef1e26=_0x43e052[_0x1cc038(0x6a4)](_0x431f54=>_0x431f54['id']);await db[_0x1cc038(0x8ac)][_0x1cc038(0x1aaa)](_0xef1e26),console[_0x1cc038(0x2187)]('✅\x20删除了\x20'+_0x43e052[_0x1cc038(0x19ee)]+_0x1cc038(0x188));}const _0xce61bf=await db['episodicMemories'][_0x1cc038(0xa24)](_0x1cc038(0xaf5))[_0x1cc038(0x1694)](_0x58b996)['toArray']();if(_0xce61bf[_0x1cc038(0x19ee)]>0x0){const _0x2919ab=_0xce61bf[_0x1cc038(0x6a4)](_0x281211=>_0x281211['id']);await db['episodicMemories'][_0x1cc038(0x1aaa)](_0x2919ab),console['log'](_0x1cc038(0x1638)+_0xce61bf[_0x1cc038(0x19ee)]+'\x20条情景记忆');}const _0x1dccbf=await db[_0x1cc038(0x127e)][_0x1cc038(0xa24)](_0x1cc038(0xaf5))['equals'](_0x58b996)[_0x1cc038(0xf13)]();if(_0x1dccbf[_0x1cc038(0x19ee)]>0x0){const _0x5316bb=_0x1dccbf[_0x1cc038(0x6a4)](_0x851dd6=>_0x851dd6['id']);await db['coreMemories']['bulkDelete'](_0x5316bb),console[_0x1cc038(0x2187)](_0x1cc038(0x1638)+_0x1dccbf[_0x1cc038(0x19ee)]+_0x1cc038(0x15de));}renderSMSMessageList(),window[_0x1cc038(0xb69)]&&window[_0x1cc038(0xb69)]['id']===_0x58b996&&hideSMSChat(),showToast(_0x1cc038(0x2160)+_0x11e888['name']+_0x1cc038(0x1138),'success'),console[_0x1cc038(0x2187)]('✅\x20删除完成:\x20短信对话、'+_0x43e052[_0x1cc038(0x19ee)]+_0x1cc038(0xa18)+_0xce61bf[_0x1cc038(0x19ee)]+_0x1cc038(0x297)+_0x1dccbf[_0x1cc038(0x19ee)]+_0x1cc038(0x1982));}catch(_0xedb9e7){console[_0x1cc038(0x174a)]('删除短信对话失败:',_0xedb9e7),showToast(_0x1cc038(0x1d0d),'error');}}let isSMSListMultiSelectMode=![],selectedSMSConversations=new Set(),pinnedSMSConversations=new Set();function showSMSManageOptions(){const _0x23aa85=_0x211817,_0x46a291=document[_0x23aa85(0x1262)](_0x23aa85(0x1ac3));_0x46a291&&(_0x46a291[_0x23aa85(0x14eb)][_0x23aa85(0x4da)]=_0x23aa85(0x1fb7));}function hideSMSManageOptions(_0x3e4699){const _0x33f24c=_0x211817;if(_0x3e4699&&_0x3e4699[_0x33f24c(0x193d)]!==_0x3e4699[_0x33f24c(0x1fac)])return;const _0xc31550=document['getElementById'](_0x33f24c(0x1ac3));_0xc31550&&(_0xc31550[_0x33f24c(0x14eb)][_0x33f24c(0x4da)]=_0x33f24c(0x102b));}function enterSMSListMultiSelectMode(){const _0x11e5ed=_0x211817;hideSMSManageOptions(),isSMSListMultiSelectMode=!![],selectedSMSConversations[_0x11e5ed(0xa4f)]();const _0x409a31=document[_0x11e5ed(0x1262)](_0x11e5ed(0x20bb)),_0x56ae53=document[_0x11e5ed(0x1262)]('sms-list-multiselect-actions');if(_0x409a31)_0x409a31[_0x11e5ed(0x14eb)]['display']=_0x11e5ed(0x102b);if(_0x56ae53)_0x56ae53[_0x11e5ed(0x14eb)]['display']=_0x11e5ed(0x1fb7);renderSMSMessageList();}function enterSMSPinMode(){const _0x2426e8=_0x211817;hideSMSManageOptions(),isSMSListMultiSelectMode=!![],selectedSMSConversations['clear']();const _0x3e5de1=document[_0x2426e8(0x1262)](_0x2426e8(0x20bb)),_0x46c646=document[_0x2426e8(0x1262)](_0x2426e8(0x94a));if(_0x3e5de1)_0x3e5de1[_0x2426e8(0x14eb)][_0x2426e8(0x4da)]=_0x2426e8(0x102b);if(_0x46c646){_0x46c646[_0x2426e8(0x14eb)][_0x2426e8(0x4da)]=_0x2426e8(0x1fb7);const _0x340588=_0x46c646[_0x2426e8(0xb30)]('.delete-btn');_0x340588&&(_0x340588[_0x2426e8(0x33a)]=_0x2426e8(0x1c2d),_0x340588[_0x2426e8(0x1f36)]=pinSelectedSMSConversations,_0x340588[_0x2426e8(0x14eb)][_0x2426e8(0x619)]=_0x2426e8(0x220f),_0x340588['style'][_0x2426e8(0xc3d)]=_0x2426e8(0x10d4));}renderSMSMessageList();}function exitSMSListMultiSelectMode(){const _0x4a92bd=_0x211817;isSMSListMultiSelectMode=![],selectedSMSConversations[_0x4a92bd(0xa4f)]();const _0x2853be=document[_0x4a92bd(0x1262)]('sms-normal-actions'),_0x2deb2f=document[_0x4a92bd(0x1262)]('sms-list-multiselect-actions');if(_0x2853be)_0x2853be['style'][_0x4a92bd(0x4da)]=_0x4a92bd(0x1fb7);if(_0x2deb2f){_0x2deb2f[_0x4a92bd(0x14eb)]['display']=_0x4a92bd(0x102b);const _0x5e2060=_0x2deb2f[_0x4a92bd(0xb30)](_0x4a92bd(0x934));_0x5e2060&&(_0x5e2060['innerHTML']=_0x4a92bd(0x1af9),_0x5e2060[_0x4a92bd(0x1f36)]=deleteSelectedSMSConversations,_0x5e2060[_0x4a92bd(0x14eb)][_0x4a92bd(0x619)]=_0x4a92bd(0x780),_0x5e2060['style'][_0x4a92bd(0xc3d)]=_0x4a92bd(0xf3a));}renderSMSMessageList();}function toggleSMSConversationSelection(_0xd09eac){const _0x578e93=_0x211817;selectedSMSConversations['has'](_0xd09eac)?selectedSMSConversations[_0x578e93(0x1f4a)](_0xd09eac):selectedSMSConversations[_0x578e93(0x21e2)](_0xd09eac),renderSMSMessageList(),selectedSMSConversations[_0x578e93(0x2d8)]===0x0&&exitSMSListMultiSelectMode();}async function deleteSelectedSMSConversations(){const _0x2f3345=_0x211817;if(selectedSMSConversations[_0x2f3345(0x2d8)]===0x0){showToast('请先选择要删除的对话',_0x2f3345(0x174a));return;}const _0x9c4320=selectedSMSConversations[_0x2f3345(0x2d8)],_0x5b20c5=_0x2f3345(0xda3)+_0x9c4320+'\x20个短信对话吗？\x0a\x0a此操作将同时删除：\x0a•\x20所有短信记录\x0a•\x20相关的时间线记忆\x0a•\x20相关的情景记忆\x0a•\x20相关的核心记忆\x0a\x0a此操作不可恢复！';if(confirm(_0x5b20c5))try{console[_0x2f3345(0x2187)](_0x2f3345(0x9a3)+_0x9c4320+_0x2f3345(0x1ef4));let _0x4ed336=0x0,_0x16a418=0x0,_0x39a7bf=0x0;for(const _0x555303 of selectedSMSConversations){const _0x522fac=smsContacts[_0x2f3345(0x13c5)](_0x555303);_0x522fac>-0x1&&smsContacts['splice'](_0x522fac,0x1);smsMessages[_0x555303]&&delete smsMessages[_0x555303];await db['transaction']('rw',[db[_0x2f3345(0xdaa)],db['smsMessages']],async()=>{const _0x11ba0e=_0x2f3345;await db[_0x11ba0e(0xdaa)][_0x11ba0e(0xa24)]('characterId')[_0x11ba0e(0x1694)](_0x555303)[_0x11ba0e(0x1f4a)](),await db['smsMessages'][_0x11ba0e(0xa24)](_0x11ba0e(0xaf5))['equals'](_0x555303)[_0x11ba0e(0x1f4a)]();});const _0x41a992=await db[_0x2f3345(0x8ac)][_0x2f3345(0xa24)]('characterId')['equals'](_0x555303)[_0x2f3345(0x82f)](_0x3094f8=>_0x3094f8[_0x2f3345(0x741)]===_0x2f3345(0x322))['toArray']();if(_0x41a992[_0x2f3345(0x19ee)]>0x0){const _0x572397=_0x41a992[_0x2f3345(0x6a4)](_0x4a087b=>_0x4a087b['id']);await db[_0x2f3345(0x8ac)][_0x2f3345(0x1aaa)](_0x572397),_0x4ed336+=_0x41a992['length'];}const _0x290718=await db[_0x2f3345(0x156f)][_0x2f3345(0xa24)](_0x2f3345(0xaf5))[_0x2f3345(0x1694)](_0x555303)[_0x2f3345(0xf13)]();if(_0x290718['length']>0x0){const _0x474a3c=_0x290718[_0x2f3345(0x6a4)](_0x54bcff=>_0x54bcff['id']);await db['episodicMemories'][_0x2f3345(0x1aaa)](_0x474a3c),_0x16a418+=_0x290718[_0x2f3345(0x19ee)];}const _0x462ad9=await db['coreMemories'][_0x2f3345(0xa24)](_0x2f3345(0xaf5))['equals'](_0x555303)[_0x2f3345(0xf13)]();if(_0x462ad9[_0x2f3345(0x19ee)]>0x0){const _0x36212d=_0x462ad9[_0x2f3345(0x6a4)](_0x4d2987=>_0x4d2987['id']);await db['coreMemories'][_0x2f3345(0x1aaa)](_0x36212d),_0x39a7bf+=_0x462ad9[_0x2f3345(0x19ee)];}}exitSMSListMultiSelectMode(),showToast(_0x2f3345(0x1af)+_0x9c4320+_0x2f3345(0xde0),'success'),console[_0x2f3345(0x2187)](_0x2f3345(0xcc4)+_0x9c4320+_0x2f3345(0x77d)+_0x4ed336+_0x2f3345(0xa18)+_0x16a418+'条情景记忆、'+_0x39a7bf+_0x2f3345(0x1982));}catch(_0x4feddf){console[_0x2f3345(0x174a)]('批量删除短信对话失败:',_0x4feddf),showToast('删除对话失败',_0x2f3345(0x174a));}}async function pinSelectedSMSConversations(){const _0x90f44a=_0x211817;if(selectedSMSConversations[_0x90f44a(0x2d8)]===0x0){showToast('请先选择要置顶的对话',_0x90f44a(0x174a));return;}try{for(const _0x1a6d53 of selectedSMSConversations){pinnedSMSConversations[_0x90f44a(0x975)](_0x1a6d53)?pinnedSMSConversations['delete'](_0x1a6d53):pinnedSMSConversations[_0x90f44a(0x21e2)](_0x1a6d53);}localStorage[_0x90f44a(0x192)](_0x90f44a(0x16d4),JSON['stringify']([...pinnedSMSConversations])),exitSMSListMultiSelectMode();const _0x57a1c6=selectedSMSConversations['size'];showToast(_0x90f44a(0xc69)+_0x57a1c6+_0x90f44a(0xd2e),_0x90f44a(0x11cb));}catch(_0x2a287b){console['error']('置顶短信对话失败:',_0x2a287b),showToast(_0x90f44a(0x19f8),_0x90f44a(0x174a));}}function loadPinnedSMSConversations(){const _0x3f87b8=_0x211817;try{const _0x4fece5=localStorage[_0x3f87b8(0x15d8)](_0x3f87b8(0x16d4));_0x4fece5&&(pinnedSMSConversations=new Set(JSON[_0x3f87b8(0x22d3)](_0x4fece5)));}catch(_0x4556a7){console[_0x3f87b8(0x174a)](_0x3f87b8(0x1e97),_0x4556a7),pinnedSMSConversations=new Set();}}function showPhotoWidgetOptions(){const _0x10bb1d=_0x211817;document[_0x10bb1d(0x1262)](_0x10bb1d(0x19cb))['style'][_0x10bb1d(0x4da)]='flex';}function closePhotoWidgetModal(){const _0x1f8408=_0x211817;document[_0x1f8408(0x1262)](_0x1f8408(0x19cb))[_0x1f8408(0x14eb)][_0x1f8408(0x4da)]=_0x1f8408(0x102b);}function handlePhotoWidgetUpload(_0x29dbc2){const _0xef7031=_0x211817;if(_0x29dbc2[_0xef7031(0xf26)]&&_0x29dbc2[_0xef7031(0xf26)][0x0]){const _0x12d3f3=_0x29dbc2[_0xef7031(0xf26)][0x0],_0x49d092=new FileReader();_0x49d092['onload']=function(_0x104abc){const _0x33e0b5=_0xef7031,_0x11672d=_0x104abc[_0x33e0b5(0x193d)]['result'];localStorage['setItem'](_0x33e0b5(0x1ef7),_0x11672d),updatePhotoWidget(_0x11672d),showToast(_0x33e0b5(0x1c7b),_0x33e0b5(0x11cb)),closePhotoWidgetModal();},_0x49d092[_0xef7031(0x127c)](_0x12d3f3);}}function updatePhotoWidget(_0x3a5053){const _0x36507a=_0x211817,_0x4c7822=document[_0x36507a(0x1262)]('photo-placeholder'),_0x559c7f=document[_0x36507a(0x1262)](_0x36507a(0x1b66));_0x3a5053?(_0x4c7822['style'][_0x36507a(0x4da)]='none',_0x559c7f[_0x36507a(0x45c)]=_0x3a5053,_0x559c7f[_0x36507a(0x14eb)][_0x36507a(0x4da)]=_0x36507a(0x13de),_0x559c7f[_0x36507a(0xc55)]=function(){}):(_0x4c7822['style']['display']=_0x36507a(0x13de),_0x559c7f['style'][_0x36507a(0x4da)]=_0x36507a(0x102b));}function clearPhotoWidget(){const _0x4537af=_0x211817;localStorage['removeItem'](_0x4537af(0x1ef7)),updatePhotoWidget(null),showToast(_0x4537af(0x10c9),_0x4537af(0x11cb)),closePhotoWidgetModal();}function showAnniversaryWidgetOptions(){const _0x5459ab=_0x211817;updateAnniversaryWidgetSelect(),document[_0x5459ab(0x1262)](_0x5459ab(0x1958))[_0x5459ab(0x14eb)][_0x5459ab(0x4da)]='flex';}function closeAnniversaryWidgetModal(){const _0x184f0f=_0x211817;document[_0x184f0f(0x1262)]('anniversary-widget-modal')[_0x184f0f(0x14eb)]['display']=_0x184f0f(0x102b);}function updateAnniversaryWidgetSelect(){const _0x1d2eef=_0x211817,_0x44eec0=document['getElementById']('widget-anniversary-select'),_0x27cecc=localStorage[_0x1d2eef(0x15d8)](_0x1d2eef(0x48d));_0x44eec0[_0x1d2eef(0x33a)]='<option\x20value=\x22\x22>请选择纪念日</option>';const _0xa7bdf7=anniversaries[_0x1d2eef(0x1e1f)](_0x5ac78c=>_0x5ac78c[_0x1d2eef(0x77e)]),_0x4cf64b=anniversaries[_0x1d2eef(0x1e1f)](_0x152f9d=>!_0x152f9d[_0x1d2eef(0x77e)]);if(_0xa7bdf7['length']>0x0){const _0x169a29=document['createElement'](_0x1d2eef(0x1198));_0x169a29[_0x1d2eef(0x8d3)]=_0x1d2eef(0xb25),_0xa7bdf7[_0x1d2eef(0x19fb)](_0x11431e=>{const _0x3de318=_0x1d2eef,_0x5eb783=document['createElement']('option');_0x5eb783[_0x3de318(0x1ebc)]=_0x11431e['id'],_0x5eb783[_0x3de318(0x13be)]=_0x11431e[_0x3de318(0x1a1c)],_0x11431e['id']===_0x27cecc&&(_0x5eb783['selected']=!![]),_0x169a29['appendChild'](_0x5eb783);}),_0x44eec0[_0x1d2eef(0x497)](_0x169a29);}if(_0x4cf64b[_0x1d2eef(0x19ee)]>0x0){const _0x143aef=document['createElement']('optgroup');_0x143aef[_0x1d2eef(0x8d3)]='📅\x20其他纪念日',_0x4cf64b[_0x1d2eef(0x19fb)](_0x4fed09=>{const _0x3c52aa=_0x1d2eef,_0x47d505=document[_0x3c52aa(0xac6)](_0x3c52aa(0x627));_0x47d505['value']=_0x4fed09['id'],_0x47d505[_0x3c52aa(0x13be)]=_0x4fed09[_0x3c52aa(0x1a1c)],_0x4fed09['id']===_0x27cecc&&(_0x47d505[_0x3c52aa(0x176b)]=!![]),_0x143aef['appendChild'](_0x47d505);}),_0x44eec0[_0x1d2eef(0x497)](_0x143aef);}}function updateAnniversaryWidget(){const _0x3bb103=_0x211817,_0xd51027=document[_0x3bb103(0x1262)]('widget-anniversary-select'),_0x297f37=_0xd51027['value'];if(_0x297f37){const _0x2a2752=anniversaries[_0x3bb103(0xaf4)](_0x39ddbc=>_0x39ddbc['id']===_0x297f37);_0x2a2752&&(localStorage[_0x3bb103(0x192)](_0x3bb103(0x48d),_0x297f37),displayAnniversaryWidget(_0x2a2752),showToast('纪念日小组件已更新',_0x3bb103(0x11cb)));}else clearAnniversaryWidget();}function displayAnniversaryWidget(_0x40e8aa){const _0x4a886e=_0x211817,_0x77518e=document['getElementById']('anniversary-placeholder'),_0xe564b6=document[_0x4a886e(0x1262)](_0x4a886e(0xe34)),_0x269837=document[_0x4a886e(0x1262)](_0x4a886e(0x21f1)),_0x40a187=document[_0x4a886e(0x1262)](_0x4a886e(0x15e7)),_0x409d96=document[_0x4a886e(0x1262)](_0x4a886e(0x1fc1)),_0x35787a=document[_0x4a886e(0xb30)]('.anniversary-widget-content')[_0x4a886e(0x1b01)],_0x3d870e=new Date(),_0x18c712=_0x3d870e[_0x4a886e(0x16a0)](),_0x47b73d=new Date(_0x40e8aa[_0x4a886e(0x20d4)]),_0x384e25=_0x40e8aa[_0x4a886e(0x1710)]||_0x4a886e(0x920);let _0x37ff16='';if(_0x384e25===_0x4a886e(0x1f15)){const _0xa357d=new Date(_0x3d870e['getFullYear'](),_0x3d870e[_0x4a886e(0x1da)](),_0x3d870e[_0x4a886e(0x520)]()),_0x3d9448=new Date(_0x47b73d[_0x4a886e(0x16a0)](),_0x47b73d[_0x4a886e(0x1da)](),_0x47b73d[_0x4a886e(0x520)]()),_0x2e2a1a=Math[_0x4a886e(0x2180)]((_0xa357d-_0x3d9448)/(0x3e8*0x3c*0x3c*0x18));_0x37ff16=_0x2e2a1a===0x0?'今天':''+_0x2e2a1a;}else{const _0x2af02e=new Date(_0x3d870e['getFullYear'](),_0x3d870e[_0x4a886e(0x1da)](),_0x3d870e[_0x4a886e(0x520)]());let _0x3134c0=new Date(_0x18c712,_0x47b73d[_0x4a886e(0x1da)](),_0x47b73d[_0x4a886e(0x520)]());_0x3134c0<_0x2af02e&&_0x3134c0[_0x4a886e(0x17e7)](_0x18c712+0x1);const _0x4512f4=Math[_0x4a886e(0x2180)]((_0x3134c0-_0x2af02e)/(0x3e8*0x3c*0x3c*0x18));_0x37ff16=_0x4512f4===0x0?'今天':_0x4512f4===0x1?'明天':''+_0x4512f4;}_0x269837[_0x4a886e(0x13be)]=_0x40e8aa[_0x4a886e(0x1a1c)],_0x40a187[_0x4a886e(0x13be)]=_0x37ff16,_0x409d96[_0x4a886e(0x13be)]=formatDate(_0x40e8aa[_0x4a886e(0x20d4)]);if(_0x40e8aa[_0x4a886e(0x159c)]){_0x35787a['style'][_0x4a886e(0x159c)]=_0x4a886e(0x14a3)+_0x40e8aa[_0x4a886e(0x159c)]+'\x27)',_0x35787a[_0x4a886e(0x14eb)][_0x4a886e(0x15d0)]=_0x4a886e(0x12bb),_0x35787a['style'][_0x4a886e(0x1530)]=_0x4a886e(0xcef),_0x35787a[_0x4a886e(0x14eb)][_0x4a886e(0x80f)]=_0x4a886e(0x24f),_0x35787a[_0x4a886e(0x14eb)][_0x4a886e(0xbc7)]='relative';if(!_0x35787a[_0x4a886e(0xb30)](_0x4a886e(0x1a9e))){const _0x1d3c06=document[_0x4a886e(0xac6)](_0x4a886e(0xbbc));_0x1d3c06[_0x4a886e(0x1722)]='widget-overlay',_0x1d3c06[_0x4a886e(0x14eb)][_0x4a886e(0x1f87)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x35787a[_0x4a886e(0x497)](_0x1d3c06);}const _0x4be317=_0x35787a[_0x4a886e(0xb30)]('.anniversary-widget-content');if(_0x4be317){_0x4be317[_0x4a886e(0x14eb)][_0x4a886e(0xbc7)]=_0x4a886e(0x18dc),_0x4be317[_0x4a886e(0x14eb)]['zIndex']='2';const _0x486090=_0x4be317[_0x4a886e(0xb30)](_0x4a886e(0xf8b)),_0x3e493b=_0x4be317['querySelector'](_0x4a886e(0x1ae8)),_0x19401a=_0x4be317[_0x4a886e(0xb30)](_0x4a886e(0x1e6f));_0x486090&&(_0x486090[_0x4a886e(0x14eb)]['cssText']+=_0x4a886e(0xf6c)),_0x3e493b&&(_0x3e493b[_0x4a886e(0x14eb)][_0x4a886e(0x1f87)]+=_0x4a886e(0x2076)),_0x19401a&&(_0x19401a[_0x4a886e(0x14eb)][_0x4a886e(0x1f87)]+=_0x4a886e(0xeb3));}}else{_0x35787a[_0x4a886e(0x14eb)][_0x4a886e(0x159c)]='';const _0x1a2826=_0x35787a['querySelector'](_0x4a886e(0x1a9e));_0x1a2826&&_0x1a2826['remove']();}_0x77518e['style']['display']=_0x4a886e(0x102b),_0xe564b6[_0x4a886e(0x14eb)]['display']=_0x4a886e(0x13de);}function clearAnniversaryWidget(){const _0x199c41=_0x211817;localStorage[_0x199c41(0x3b2)]('anniversaryWidgetSelection');const _0x149d60=document[_0x199c41(0x1262)](_0x199c41(0xe8a)),_0x5e5fce=document[_0x199c41(0x1262)](_0x199c41(0xe34)),_0x3ecc37=document[_0x199c41(0xb30)](_0x199c41(0x12b4))['parentElement'];if(_0x3ecc37){_0x3ecc37['style'][_0x199c41(0x159c)]='';const _0x2c4abd=_0x3ecc37['querySelector'](_0x199c41(0x1a9e));_0x2c4abd&&_0x2c4abd[_0x199c41(0x1493)]();}_0x149d60[_0x199c41(0x14eb)]['display']=_0x199c41(0x13de),_0x5e5fce[_0x199c41(0x14eb)][_0x199c41(0x4da)]='none',showToast('纪念日小组件已清除',_0x199c41(0x11cb));}function refreshAnniversaryWidget(){const _0x17023f=_0x211817;if(anniversaries&&anniversaries['length']>0x0){const _0x231dce=anniversaries['find'](_0x325ded=>_0x325ded[_0x17023f(0x77e)]);if(_0x231dce){localStorage[_0x17023f(0x192)](_0x17023f(0x48d),_0x231dce['id']),displayAnniversaryWidget(_0x231dce);return;}const _0xb1a916=anniversaries[0x0];_0xb1a916&&(localStorage[_0x17023f(0x192)](_0x17023f(0x48d),_0xb1a916['id']),displayAnniversaryWidget(_0xb1a916));}else clearAnniversaryWidget();}window[_0x211817(0x207e)]=refreshAnniversaryWidget,window[_0x211817(0x5c3)]={'listAnniversaries':()=>{const _0x1b4a50=_0x211817;console[_0x1b4a50(0x33d)](anniversaries[_0x1b4a50(0x6a4)](_0x2681e2=>({'id':_0x2681e2['id'],'name':_0x2681e2['name'],'isPinned':_0x2681e2['isPinned'],'hasBackground':!!_0x2681e2[_0x1b4a50(0x159c)],'hasUserAvatar':!!_0x2681e2[_0x1b4a50(0x865)]})));},'checkWidget':()=>{const _0x3d3bcf=_0x211817,_0x207c88=localStorage[_0x3d3bcf(0x15d8)](_0x3d3bcf(0x48d)),_0x45ebaf=anniversaries['find'](_0x5a115a=>_0x5a115a['id']===_0x207c88);console[_0x3d3bcf(0x2187)]('小组件状态:',{'savedId':_0x207c88,'currentAnniversary':_0x45ebaf?_0x45ebaf[_0x3d3bcf(0x1a1c)]:_0x3d3bcf(0x396),'isPinned':_0x45ebaf?_0x45ebaf[_0x3d3bcf(0x77e)]:![],'hasBackground':_0x45ebaf?!!_0x45ebaf['backgroundImage']:![]});},'refresh':refreshAnniversaryWidget,'clear':clearAnniversaryWidget};function initializeWidgets(){const _0x3dc39c=_0x211817;try{const _0x49265b=localStorage[_0x3dc39c(0x15d8)](_0x3dc39c(0x1ef7));_0x49265b&&updatePhotoWidget(_0x49265b);const _0x301abb=localStorage[_0x3dc39c(0x15d8)](_0x3dc39c(0x48d));if(anniversaries&&anniversaries['length']>0x0){let _0x4b0f42=null;_0x301abb&&(_0x4b0f42=anniversaries[_0x3dc39c(0xaf4)](_0x2176c2=>_0x2176c2['id']===_0x301abb));if(!_0x4b0f42){const _0x563d55=anniversaries['find'](_0xd4d5f4=>_0xd4d5f4[_0x3dc39c(0x77e)]);_0x563d55&&(_0x4b0f42=_0x563d55,localStorage['setItem'](_0x3dc39c(0x48d),_0x563d55['id']));}_0x4b0f42&&displayAnniversaryWidget(_0x4b0f42);}}catch(_0x571e9f){console[_0x3dc39c(0x174a)]('初始化小组件失败:',_0x571e9f);}}function togglePhotoText(_0x135600,_0x553c05){const _0xd26bd5=_0x211817,_0x190bf0=_0x135600[_0xd26bd5(0xb30)](_0xd26bd5(0x57c)),_0xf0c68b=_0x135600[_0xd26bd5(0xb30)](_0xd26bd5(0x14dd)),_0x3d8b47=_0x135600['querySelector'](_0xd26bd5(0x20d7));_0x190bf0[_0xd26bd5(0x14eb)][_0xd26bd5(0x4da)]===_0xd26bd5(0x102b)?(_0x190bf0[_0xd26bd5(0x14eb)][_0xd26bd5(0x4da)]=_0xd26bd5(0x1fb7),_0xf0c68b[_0xd26bd5(0x14eb)][_0xd26bd5(0x11af)]='0',_0x3d8b47[_0xd26bd5(0x14eb)][_0xd26bd5(0x11af)]='0.3'):(_0x190bf0[_0xd26bd5(0x14eb)]['display']=_0xd26bd5(0x102b),_0xf0c68b[_0xd26bd5(0x14eb)]['opacity']='1',_0x3d8b47[_0xd26bd5(0x14eb)][_0xd26bd5(0x11af)]='1');}function showUserPhotoDescription(_0x1a4900){const _0x20aafd=_0x211817,_0x282e7d=_0x20aafd(0x1861)+_0x1a4900+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22photo-modal-btn\x22\x20id=\x22photo-description-close\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkles\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-6\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-7\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-sparkle\x20modal-sparkle-8\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document[_0x20aafd(0x1da9)][_0x20aafd(0x1b7)](_0x20aafd(0x42e),_0x282e7d);const _0x16866f=document[_0x20aafd(0x1262)](_0x20aafd(0xded)),_0x594cea=document[_0x20aafd(0x1262)](_0x20aafd(0x217));_0x594cea[_0x20aafd(0x1f36)]=()=>{const _0x24938a=_0x20aafd;_0x16866f[_0x24938a(0x1493)]();},_0x16866f['onclick']=_0x4d30c5=>{_0x4d30c5['target']===_0x16866f&&_0x16866f['remove']();};}function showCustomPrompt(_0x2eea85,_0x590874,_0x40f994='',_0x20e53b=_0x211817(0x1378)){return new Promise(_0x2579d4=>{const _0x4b242c=_0x167f,_0x34f7ae=_0x4b242c(0x1c59)+_0x2eea85+_0x4b242c(0x1a9a)+_0x20e53b+_0x4b242c(0x1e06)+_0x590874+_0x4b242c(0x136b)+_0x40f994+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22width:\x20100%;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20id=\x22custom-prompt-cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20id=\x22custom-prompt-confirm\x22>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document[_0x4b242c(0x1da9)]['insertAdjacentHTML'](_0x4b242c(0x42e),_0x34f7ae);const _0x5dfe0b=document[_0x4b242c(0x1262)](_0x4b242c(0x1fb6)),_0x1034b5=document[_0x4b242c(0x1262)](_0x4b242c(0x1c03)),_0x3fd00d=document['getElementById'](_0x4b242c(0x200)),_0x422e66=document[_0x4b242c(0x1262)](_0x4b242c(0xbba));_0x3fd00d[_0x4b242c(0x1f36)]=()=>{const _0x3ac9af=_0x4b242c,_0x442e8b=_0x1034b5[_0x3ac9af(0x1ebc)];_0x5dfe0b['remove'](),_0x2579d4(_0x442e8b);},_0x422e66['onclick']=()=>{const _0x925c1d=_0x4b242c;_0x5dfe0b[_0x925c1d(0x1493)](),_0x2579d4(null);},_0x1034b5['onkeydown']=_0x1d443e=>{const _0x53536c=_0x4b242c;_0x1d443e[_0x53536c(0x213c)]===_0x53536c(0xdcf)&&_0x3fd00d[_0x53536c(0x1859)]();},setTimeout(()=>_0x1034b5[_0x4b242c(0x13cf)](),0x64);});}function switchChatTab(_0x69b45d){const _0x51fd65=_0x211817;document['querySelectorAll'](_0x51fd65(0xb8a))['forEach'](_0x5a883a=>{const _0x1d1412=_0x51fd65;_0x5a883a&&_0x5a883a[_0x1d1412(0x1c1b)]&&_0x5a883a['classList'][_0x1d1412(0x1493)]('active');});if(event&&event[_0x51fd65(0x1fac)]&&event[_0x51fd65(0x1fac)][_0x51fd65(0x1c1b)])event['currentTarget']['classList']['add']('active');else{if(_0x69b45d===_0x51fd65(0x1c45)){const _0x2f7e49=document[_0x51fd65(0x1262)](_0x51fd65(0x64b));_0x2f7e49&&_0x2f7e49[_0x51fd65(0x1c1b)]&&_0x2f7e49[_0x51fd65(0x1c1b)][_0x51fd65(0x21e2)](_0x51fd65(0x1a14));}else{if(_0x69b45d==='contact-list'){const _0xf6016c=document[_0x51fd65(0x1897)](_0x51fd65(0xb8a));_0xf6016c['length']>0x1&&_0xf6016c[0x1]&&_0xf6016c[0x1][_0x51fd65(0x1c1b)]&&_0xf6016c[0x1]['classList'][_0x51fd65(0x21e2)](_0x51fd65(0x1a14));}else{if(_0x69b45d==='moments-page'){const _0x396a88=document[_0x51fd65(0x1897)](_0x51fd65(0xb8a));_0x396a88[_0x51fd65(0x19ee)]>0x2&&_0x396a88[0x2]&&_0x396a88[0x2]['classList']&&_0x396a88[0x2][_0x51fd65(0x1c1b)][_0x51fd65(0x21e2)](_0x51fd65(0x1a14));}else{if(_0x69b45d===_0x51fd65(0xedf)){const _0x4f09e1=document[_0x51fd65(0x1897)](_0x51fd65(0xb8a));_0x4f09e1[_0x51fd65(0x19ee)]>0x3&&_0x4f09e1[0x3]&&_0x4f09e1[0x3][_0x51fd65(0x1c1b)]&&_0x4f09e1[0x3][_0x51fd65(0x1c1b)][_0x51fd65(0x21e2)](_0x51fd65(0x1a14));}}}}}const _0xb5d68c=document[_0x51fd65(0x1262)](_0x51fd65(0x1c45)),_0x5f28e8=document[_0x51fd65(0x1262)](_0x51fd65(0x1838)),_0x1005f8=document[_0x51fd65(0x1262)](_0x51fd65(0xedf)),_0x4a120a=document['getElementById']('moments-page'),_0x2f1208=document[_0x51fd65(0x1262)](_0x69b45d);if(_0xb5d68c)_0xb5d68c[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b);if(_0x5f28e8)_0x5f28e8[_0x51fd65(0x14eb)]['display']='none';if(_0x1005f8)_0x1005f8[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b);if(_0x4a120a)_0x4a120a['style'][_0x51fd65(0x4da)]=_0x51fd65(0x102b);if(_0x2f1208)_0x2f1208['style'][_0x51fd65(0x4da)]=_0x51fd65(0x13de);const _0x44c06d=document[_0x51fd65(0xb30)](_0x51fd65(0x99c));if(_0x44c06d){if(_0x69b45d==='message-list')_0x44c06d[_0x51fd65(0x1c1b)][_0x51fd65(0x21e2)](_0x51fd65(0x1daf)),_0x44c06d[_0x51fd65(0x13be)]='💬';else{if(_0x69b45d==='contact-list')_0x44c06d[_0x51fd65(0x1c1b)][_0x51fd65(0x1493)](_0x51fd65(0x1daf)),_0x44c06d['textContent']='角色';else{if(_0x69b45d===_0x51fd65(0x1fbe))_0x44c06d[_0x51fd65(0x1c1b)][_0x51fd65(0x1493)](_0x51fd65(0x1daf)),_0x44c06d[_0x51fd65(0x13be)]='动态',loadMomentsImages();else _0x69b45d===_0x51fd65(0xedf)&&(_0x44c06d[_0x51fd65(0x1c1b)][_0x51fd65(0x1493)]('chat-mode'),_0x44c06d[_0x51fd65(0x13be)]='我');}}}const _0x530ad6=document[_0x51fd65(0x1262)](_0x51fd65(0x13d5)),_0x3448a9=document[_0x51fd65(0x1262)](_0x51fd65(0x2120)),_0x106d0b=document[_0x51fd65(0x1262)](_0x51fd65(0x1843));if(_0x530ad6&&_0x3448a9&&_0x106d0b){if(_0x69b45d===_0x51fd65(0x1838))_0x530ad6[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x1fb7),_0x3448a9[_0x51fd65(0x14eb)]['display']='none',_0x106d0b[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=isGroupManageMode?_0x51fd65(0x102b):_0x51fd65(0x1fb7),_0x530ad6[_0x51fd65(0x1f36)]=()=>showCharacterForm();else{if(_0x69b45d===_0x51fd65(0x1c45))_0x530ad6[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b),_0x3448a9[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x1fb7),_0x106d0b[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b);else _0x69b45d===_0x51fd65(0x1fbe)?(_0x530ad6[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x1fb7),_0x3448a9['style'][_0x51fd65(0x4da)]=_0x51fd65(0x102b),_0x106d0b['style']['display']=_0x51fd65(0x102b),_0x530ad6[_0x51fd65(0x1f36)]=()=>showPublishMoment()):(_0x530ad6[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b),_0x3448a9[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b),_0x106d0b[_0x51fd65(0x14eb)][_0x51fd65(0x4da)]=_0x51fd65(0x102b));}}if(_0x69b45d===_0x51fd65(0x1fbe)){const _0x1425de=document[_0x51fd65(0x1262)](_0x51fd65(0x12b1));_0x1425de&&_0x1425de[_0x51fd65(0xe48)][_0x51fd65(0x19ee)]===0x0&&loadMoments();const _0x3d8f8c=document['getElementById'](_0x51fd65(0xf68));_0x3d8f8c&&(_0x3d8f8c[_0x51fd65(0x14eb)][_0x51fd65(0xbf2)]='0');}else{const _0x4d6c36=document[_0x51fd65(0x1262)]('chat-content');_0x4d6c36&&(_0x4d6c36[_0x51fd65(0x14eb)][_0x51fd65(0xbf2)]=_0x51fd65(0x1a05)),stopTimeUpdater();}}function updateTime(){const _0x59ba2f=_0x211817,_0x3a38f6=new Date(),_0x5971f2=_0x3a38f6[_0x59ba2f(0xe2e)]()[_0x59ba2f(0x1878)]()[_0x59ba2f(0xdfe)](0x2,'0'),_0x1932b5=_0x3a38f6['getMinutes']()['toString']()['padStart'](0x2,'0'),_0x605326=_0x5971f2+':'+_0x1932b5,_0x3fd621=document[_0x59ba2f(0x1262)](_0x59ba2f(0x120c));_0x3fd621&&(_0x3fd621[_0x59ba2f(0x13be)]=_0x605326);const _0x29dc99=document[_0x59ba2f(0x1897)](_0x59ba2f(0x19bb));_0x29dc99[_0x59ba2f(0x19fb)](_0x5e9212=>{const _0x126515=_0x59ba2f;_0x5e9212[_0x126515(0x13be)]=_0x605326;});const _0x412001=document[_0x59ba2f(0x1262)]('main-time');_0x412001&&(_0x412001[_0x59ba2f(0x13be)]=_0x605326);const _0x20a940=document[_0x59ba2f(0x1262)](_0x59ba2f(0xe1d));if(_0x20a940){const _0x38d99f=document[_0x59ba2f(0x1da9)][_0x59ba2f(0x2139)](_0x59ba2f(0x362))||_0x59ba2f(0x1094);let _0x44132b='';switch(_0x38d99f){case _0x59ba2f(0x3bb):_0x44132b=_0x3a38f6[_0x59ba2f(0xbf7)]('en-US',{'weekday':_0x59ba2f(0x450),'month':_0x59ba2f(0x450),'day':_0x59ba2f(0x94d)})[_0x59ba2f(0x6e1)]();break;case _0x59ba2f(0x13d0):const _0x8058fe=_0x3a38f6[_0x59ba2f(0xbf7)](_0x59ba2f(0x156c),{'month':_0x59ba2f(0x94d),'day':_0x59ba2f(0x94d)}),_0x56ff31=_0x3a38f6[_0x59ba2f(0xbf7)](_0x59ba2f(0x156c),{'weekday':_0x59ba2f(0x450)});_0x44132b=_0x8058fe+'\x20'+_0x56ff31;break;case _0x59ba2f(0x504):_0x44132b=_0x3a38f6[_0x59ba2f(0xbf7)]('zh-CN',{'month':'long','day':_0x59ba2f(0x94d),'weekday':_0x59ba2f(0x14a2)});break;default:_0x44132b=_0x3a38f6[_0x59ba2f(0xbf7)]('zh-CN',{'month':'long','day':_0x59ba2f(0x94d),'weekday':_0x59ba2f(0x14a2)});break;}_0x20a940['textContent']=_0x44132b;}}async function loadCharacterGroups(){const _0x3c4353=_0x211817;try{const _0x5b2687=await db[_0x3c4353(0x12e9)][_0x3c4353(0xe30)](_0x3c4353(0x2224))['toArray']();if(_0x5b2687['length']===0x0){const _0x518c8a=[{'id':'my_friends','name':_0x3c4353(0x602),'order':0x3e7,'isDefault':!![],'canInteract':![]},{'id':_0x3c4353(0x15bc),'name':_0x3c4353(0x661),'order':0x1,'isDefault':![],'canInteract':!![]},{'id':_0x3c4353(0x1802),'name':'亲密朋友','order':0x2,'isDefault':![],'canInteract':!![]},{'id':_0x3c4353(0x49a),'name':'家人','order':0x3,'isDefault':![],'canInteract':!![]},{'id':_0x3c4353(0x55d),'name':'同学','order':0x4,'isDefault':![],'canInteract':!![]},{'id':_0x3c4353(0x8e2),'name':'同事','order':0x5,'isDefault':![],'canInteract':!![]}];await db[_0x3c4353(0x12e9)][_0x3c4353(0x2a3)](_0x518c8a),characterGroups=_0x518c8a;}else characterGroups=_0x5b2687;}catch(_0x472874){console[_0x3c4353(0x174a)](_0x3c4353(0x1432),_0x472874),characterGroups=[{'id':_0x3c4353(0xa74),'name':'我的好友','order':0x3e7,'isDefault':!![],'canInteract':![]}];}}async function saveCharacterGroups(){const _0x13255e=_0x211817;try{await db[_0x13255e(0x12e9)][_0x13255e(0xa4f)](),await db['characterGroups'][_0x13255e(0x2a3)](characterGroups);}catch(_0x200d34){console[_0x13255e(0x174a)](_0x13255e(0xffc),_0x200d34);}}async function loadCharacters(){const _0x1a4ce8=_0x211817;try{const _0x3505aa=await db[_0x1a4ce8(0x2005)]['toArray']();if(_0x3505aa[_0x1a4ce8(0x19ee)]===0x0){const _0x137871=localStorage[_0x1a4ce8(0x15d8)](_0x1a4ce8(0x2005));if(_0x137871){const _0x42bcd1=JSON[_0x1a4ce8(0x22d3)](_0x137871);_0x42bcd1['length']>0x0?(_0x42bcd1[_0x1a4ce8(0x19fb)](_0x4424ca=>{const _0x5d4f4f=_0x1a4ce8;!_0x4424ca[_0x5d4f4f(0x22be)]&&(_0x4424ca[_0x5d4f4f(0x22be)]=_0x5d4f4f(0xa74));}),await db[_0x1a4ce8(0x2005)][_0x1a4ce8(0x2a3)](_0x42bcd1),characters=_0x42bcd1):characters=[];}else characters=[];}else _0x3505aa[_0x1a4ce8(0x19fb)](_0x69fc=>{const _0x572225=_0x1a4ce8;!_0x69fc['groupId']&&(_0x69fc[_0x572225(0x22be)]=_0x572225(0xa74));}),characters=_0x3505aa;}catch(_0x123823){console[_0x1a4ce8(0x174a)](_0x1a4ce8(0x29a),_0x123823);const _0x4a077e=localStorage[_0x1a4ce8(0x15d8)](_0x1a4ce8(0x2005));_0x4a077e?(characters=JSON[_0x1a4ce8(0x22d3)](_0x4a077e),characters[_0x1a4ce8(0x19fb)](_0x21173a=>{const _0x30a9a4=_0x1a4ce8;!_0x21173a[_0x30a9a4(0x22be)]&&(_0x21173a[_0x30a9a4(0x22be)]=_0x30a9a4(0xa74));})):characters=[];}}async function saveCharacters(){const _0xb06e3e=_0x211817;try{const _0x2af5d1=new Set(),_0x57dc62=[];for(const _0x4c29a3 of characters){if(!_0x4c29a3['id']){console[_0xb06e3e(0x1f43)](_0xb06e3e(0x1dcf),_0x4c29a3);continue;}!_0x2af5d1['has'](_0x4c29a3['id'])?(_0x2af5d1[_0xb06e3e(0x21e2)](_0x4c29a3['id']),_0x57dc62['push'](_0x4c29a3)):console['warn'](_0xb06e3e(0x1083)+_0x4c29a3['id']+_0xb06e3e(0x142d),_0x4c29a3);}if(_0x57dc62[_0xb06e3e(0x19ee)]===0x0){console[_0xb06e3e(0x1f43)](_0xb06e3e(0x846));return;}await db[_0xb06e3e(0x1464)]('rw',db['characters'],async()=>{const _0x2fc1ab=_0xb06e3e;await db[_0x2fc1ab(0x2005)][_0x2fc1ab(0xa4f)](),await db['characters'][_0x2fc1ab(0x1883)](_0x57dc62);}),console[_0xb06e3e(0x2187)](_0xb06e3e(0x408)+_0x57dc62[_0xb06e3e(0x19ee)]+'\x20个角色到数据库');}catch(_0x30c31f){console['error']('保存角色时发生错误:',_0x30c31f),alert(_0xb06e3e(0x2266)+_0x30c31f[_0xb06e3e(0x1e8e)]);throw _0x30c31f;}}function showStorageUsage(){const _0x22de9b=_0x211817,_0x18af25=[],_0x59cbd0=localStorage[_0x22de9b(0x15d8)](_0x22de9b(0x2005))||'[]',_0x11b153=localStorage['getItem'](_0x22de9b(0x19a2))||'{}',_0x22582c=localStorage[_0x22de9b(0x15d8)](_0x22de9b(0x223))||'[]';_0x18af25[_0x22de9b(0x1cd6)](_0x22de9b(0x167f)+(_0x59cbd0[_0x22de9b(0x19ee)]/0x400)[_0x22de9b(0x13ad)](0x1)+_0x22de9b(0x3a4)),_0x18af25['push'](_0x22de9b(0x191d)+(_0x11b153[_0x22de9b(0x19ee)]/0x400)[_0x22de9b(0x13ad)](0x1)+_0x22de9b(0x3a4)),_0x18af25[_0x22de9b(0x1cd6)](_0x22de9b(0x1bd8)+(_0x22582c[_0x22de9b(0x19ee)]/0x400)[_0x22de9b(0x13ad)](0x1)+_0x22de9b(0x3a4));const _0x3d07b9=_0x59cbd0[_0x22de9b(0x19ee)]+_0x11b153['length']+_0x22582c[_0x22de9b(0x19ee)];_0x18af25[_0x22de9b(0x1cd6)](_0x22de9b(0x1b91)+(_0x3d07b9/0x400)[_0x22de9b(0x13ad)](0x1)+_0x22de9b(0x3a4)),alert(_0x22de9b(0xc3c)+_0x18af25[_0x22de9b(0x122b)]('\x0a'));}async function loadContacts(){const _0x30fb69=_0x211817;try{console[_0x30fb69(0x2187)](_0x30fb69(0x91d));const _0x573343=await db['contacts'][_0x30fb69(0xf13)]();if(_0x573343['length']===0x0){const _0x4ea615=localStorage[_0x30fb69(0x15d8)](_0x30fb69(0x1404));if(_0x4ea615){const _0xeaef82=JSON[_0x30fb69(0x22d3)](_0x4ea615);contacts=Array[_0x30fb69(0x1496)](_0xeaef82)?_0xeaef82:[],console['log']('✅\x20从localStorage迁移了\x20'+contacts[_0x30fb69(0x19ee)]+_0x30fb69(0x164d)),await saveContacts();}else contacts=[],console[_0x30fb69(0x2187)](_0x30fb69(0x7f3));}else{contacts=_0x573343[_0x30fb69(0x6a4)](_0xf0eb6=>_0xf0eb6[_0x30fb69(0xaf5)])[_0x30fb69(0x1e1f)](_0x3520e9=>_0x3520e9),console['log']('✅\x20从数据库加载了\x20'+contacts['length']+_0x30fb69(0x164d));if(characters&&characters[_0x30fb69(0x19ee)]>0x0){const _0x43f51c=characters[_0x30fb69(0x6a4)](_0x528767=>_0x528767['id']),_0x27dc41=contacts[_0x30fb69(0x1e1f)](_0xff34b6=>_0x43f51c[_0x30fb69(0x1831)](_0xff34b6));if(_0x27dc41['length']!==contacts[_0x30fb69(0x19ee)]){const _0x5b211b=contacts['length']-_0x27dc41[_0x30fb69(0x19ee)];console[_0x30fb69(0x2187)](_0x30fb69(0x1c43)+_0x5b211b+_0x30fb69(0x70b)),contacts=_0x27dc41,await saveContacts();}}}}catch(_0x1a3c15){console['error'](_0x30fb69(0x1cd3),_0x1a3c15),characters&&characters[_0x30fb69(0x19ee)]>0x0?(console['log'](_0x30fb69(0x1243)),contacts=characters[_0x30fb69(0x6a4)](_0x539cf2=>_0x539cf2['id'])):contacts=[];}}async function saveContacts(){const _0x49cd3a=_0x211817;try{const _0x50d52b=contacts['filter'](_0x28db9d=>_0x28db9d),_0x3ee5aa=_0x50d52b['map'](_0x45a094=>({'characterId':_0x45a094}));await db[_0x49cd3a(0x1464)]('rw',db['contacts'],async()=>{const _0x3f7107=_0x49cd3a;await db['contacts'][_0x3f7107(0xa4f)](),_0x3ee5aa['length']>0x0&&await db[_0x3f7107(0x1404)]['bulkAdd'](_0x3ee5aa);});}catch(_0x20dd49){console[_0x49cd3a(0x174a)](_0x49cd3a(0x1a4f),_0x20dd49);}}async function loadSMSContacts(){const _0x37d9c3=_0x211817;try{console[_0x37d9c3(0x2187)](_0x37d9c3(0xb35));const _0x5165e4=await db['smsContacts'][_0x37d9c3(0xf13)]();smsContacts=_0x5165e4[_0x37d9c3(0x6a4)](_0xde9e70=>_0xde9e70[_0x37d9c3(0xaf5)])[_0x37d9c3(0x1e1f)](_0x248595=>_0x248595),console['log']('✅\x20从数据库加载了\x20'+smsContacts['length']+'\x20个短信联系人');if(characters&&characters[_0x37d9c3(0x19ee)]>0x0){const _0x53ab94=characters[_0x37d9c3(0x6a4)](_0x178d7b=>_0x178d7b['id']),_0x5a3bc2=smsContacts[_0x37d9c3(0x1e1f)](_0x22f9ae=>_0x53ab94[_0x37d9c3(0x1831)](_0x22f9ae));if(_0x5a3bc2[_0x37d9c3(0x19ee)]!==smsContacts[_0x37d9c3(0x19ee)]){const _0x234017=smsContacts['length']-_0x5a3bc2[_0x37d9c3(0x19ee)];console['log'](_0x37d9c3(0x1c43)+_0x234017+_0x37d9c3(0x651)),smsContacts=_0x5a3bc2,await saveSMSContacts();}}}catch(_0x38bf1e){console['error'](_0x37d9c3(0x1d90),_0x38bf1e),smsContacts=[];}}async function saveSMSContacts(){const _0x2c477e=_0x211817;try{const _0x5b3bc8=smsContacts[_0x2c477e(0x1e1f)](_0x4d0ffb=>_0x4d0ffb),_0x5acce5=_0x5b3bc8['map'](_0x10749f=>({'characterId':_0x10749f,'createdAt':Date[_0x2c477e(0x2eb)]()}));await db['transaction']('rw',db[_0x2c477e(0xdaa)],async()=>{const _0x2782ee=_0x2c477e;await db[_0x2782ee(0xdaa)][_0x2782ee(0xa4f)](),_0x5acce5[_0x2782ee(0x19ee)]>0x0&&await db[_0x2782ee(0xdaa)]['bulkAdd'](_0x5acce5);}),console[_0x2c477e(0x2187)](_0x2c477e(0x1aa6)+_0x5b3bc8['length']+_0x2c477e(0x1161));}catch(_0x6de84d){console[_0x2c477e(0x174a)]('保存短信联系人失败:',_0x6de84d);}}async function loadSMSMessages(){const _0x489ed1=_0x211817;try{console[_0x489ed1(0x2187)](_0x489ed1(0xe5f));const _0x44281c=await db['smsMessages']['toArray']();smsMessages={},_0x44281c[_0x489ed1(0x19fb)](_0x3a605a=>{const _0x2f1370=_0x489ed1;!smsMessages[_0x3a605a[_0x2f1370(0xaf5)]]&&(smsMessages[_0x3a605a[_0x2f1370(0xaf5)]]=[]);let _0x274fac=[];_0x3a605a[_0x2f1370(0x1b62)]&&_0x3a605a[_0x2f1370(0xb17)]?_0x274fac=[{'type':_0x2f1370(0x1378),'text':_0x3a605a[_0x2f1370(0x211c)]||''},{'type':_0x2f1370(0x910),'image_url':{'url':_0x3a605a[_0x2f1370(0xb17)]}}]:_0x274fac=[{'type':_0x2f1370(0x1378),'text':_0x3a605a[_0x2f1370(0x211c)]||''}];const _0x3b7146={'id':_0x3a605a['id'],'content':_0x274fac,'text':_0x3a605a[_0x2f1370(0x211c)],'timestamp':_0x3a605a['timestamp'],'isUser':_0x3a605a['isUser'],'isImage':_0x3a605a[_0x2f1370(0x1b62)]||![],'imageUrl':_0x3a605a['imageUrl']||null,'fileName':_0x3a605a[_0x2f1370(0x63f)]||null};smsMessages[_0x3a605a[_0x2f1370(0xaf5)]][_0x2f1370(0x1cd6)](_0x3b7146);}),Object[_0x489ed1(0x1c9f)](smsMessages)[_0x489ed1(0x19fb)](_0x5bb5cd=>{const _0x3add5d=_0x489ed1;smsMessages[_0x5bb5cd]['sort']((_0x37c49e,_0x49b449)=>_0x37c49e[_0x3add5d(0x1716)]-_0x49b449['timestamp']);});const _0x1052c9=_0x44281c[_0x489ed1(0x1e1f)](_0xb34ef7=>_0xb34ef7[_0x489ed1(0x1b62)])[_0x489ed1(0x19ee)];console['log'](_0x489ed1(0x489)+_0x44281c[_0x489ed1(0x19ee)]+_0x489ed1(0xd49)+(_0x1052c9>0x0?_0x489ed1(0x1bbf)+_0x1052c9+'\x20张图片）':''));}catch(_0x326d36){console[_0x489ed1(0x174a)](_0x489ed1(0x112b),_0x326d36),smsMessages={};}}async function saveSingleSMSMessage(_0x381f88,_0x4fd778){const _0x33324b=_0x211817;try{let _0x4d5321='';if(Array[_0x33324b(0x1496)](_0x4fd778[_0x33324b(0x211c)])){const _0x5bde15=_0x4fd778[_0x33324b(0x211c)][_0x33324b(0xaf4)](_0x548f7c=>_0x548f7c[_0x33324b(0x1a4b)]===_0x33324b(0x1378));_0x4d5321=_0x5bde15?_0x5bde15[_0x33324b(0x1378)]:'';}else _0x4fd778[_0x33324b(0x1378)]?_0x4d5321=_0x4fd778[_0x33324b(0x1378)]:_0x4d5321='';const _0x51eb6e={'id':_0x4fd778['id'],'characterId':_0x381f88,'timestamp':_0x4fd778['timestamp'],'content':_0x4d5321,'isUser':_0x4fd778[_0x33324b(0x714)],'isImage':_0x4fd778[_0x33324b(0x1b62)]||![],'imageUrl':_0x4fd778[_0x33324b(0xb17)]||null,'fileName':_0x4fd778[_0x33324b(0x63f)]||null};await db[_0x33324b(0x1b6a)]['add'](_0x51eb6e),console[_0x33324b(0x2187)]('✅\x20保存了角色\x20'+_0x381f88+'\x20的单条短信消息'+(_0x4fd778[_0x33324b(0x1b62)]?_0x33324b(0x6a1):''));}catch(_0x597d80){console[_0x33324b(0x174a)](_0x33324b(0x5ee),_0x597d80);throw _0x597d80;}}async function saveSMSMessages(_0xf2fc42){const _0x219a40=_0x211817;try{if(!smsMessages[_0xf2fc42])return;const _0x1374a5=smsMessages[_0xf2fc42][_0x219a40(0x6a4)](_0x27f567=>{const _0x28b359=_0x219a40;let _0x42e4c5='';if(Array[_0x28b359(0x1496)](_0x27f567[_0x28b359(0x211c)])){const _0x4e4b5a=_0x27f567[_0x28b359(0x211c)][_0x28b359(0xaf4)](_0x467cec=>_0x467cec['type']===_0x28b359(0x1378));_0x42e4c5=_0x4e4b5a?_0x4e4b5a[_0x28b359(0x1378)]:'';}else _0x27f567[_0x28b359(0x1378)]?_0x42e4c5=_0x27f567[_0x28b359(0x1378)]:_0x42e4c5='';return{'id':_0x27f567['id'],'characterId':_0xf2fc42,'timestamp':_0x27f567['timestamp'],'content':_0x42e4c5,'isUser':_0x27f567[_0x28b359(0x714)],'isImage':_0x27f567[_0x28b359(0x1b62)]||![],'imageUrl':_0x27f567[_0x28b359(0xb17)]||null,'fileName':_0x27f567['fileName']||null};});await db['transaction']('rw',db['smsMessages'],async()=>{const _0x9f24cb=_0x219a40;await db['smsMessages'][_0x9f24cb(0xa24)](_0x9f24cb(0xaf5))[_0x9f24cb(0x1694)](_0xf2fc42)[_0x9f24cb(0x1f4a)](),_0x1374a5[_0x9f24cb(0x19ee)]>0x0&&await db['smsMessages'][_0x9f24cb(0x2a3)](_0x1374a5);});const _0x1be15e=_0x1374a5[_0x219a40(0x1e1f)](_0xfcea53=>_0xfcea53[_0x219a40(0x1b62)])[_0x219a40(0x19ee)];console[_0x219a40(0x2187)]('✅\x20批量保存了角色\x20'+_0xf2fc42+_0x219a40(0x512)+_0x1374a5[_0x219a40(0x19ee)]+_0x219a40(0xd49)+(_0x1be15e>0x0?_0x219a40(0x1bbf)+_0x1be15e+_0x219a40(0x1d8f):''));}catch(_0x18c87a){console[_0x219a40(0x174a)](_0x219a40(0x2027),_0x18c87a);}}async function loadChatMessages(){const _0x411efe=_0x211817;try{const _0x54197a=await db['chatMessages'][_0x411efe(0xf13)]();chatMessages={};if(_0x54197a['length']===0x0){const _0x37a4e0=localStorage[_0x411efe(0x15d8)](_0x411efe(0x19a2));if(_0x37a4e0){const _0x1ca056=JSON[_0x411efe(0x22d3)](_0x37a4e0),_0x3bbab5=[];for(const [_0xd8913b,_0x148ace]of Object[_0x411efe(0x2bc)](_0x1ca056)){for(const _0x12f2bb of _0x148ace){_0x3bbab5[_0x411efe(0x1cd6)]({'id':_0xd8913b+'_'+(_0x12f2bb['id']||_0x12f2bb[_0x411efe(0x1716)]),'characterId':_0xd8913b,'timestamp':_0x12f2bb[_0x411efe(0x1716)],'messageData':_0x12f2bb});}}_0x3bbab5[_0x411efe(0x19ee)]>0x0&&await db['chatMessages'][_0x411efe(0x2a3)](_0x3bbab5),chatMessages=_0x1ca056;}}else{for(const _0x53af72 of _0x54197a){const _0x354473=_0x53af72[_0x411efe(0xaf5)];!chatMessages[_0x354473]&&(chatMessages[_0x354473]=[]),_0x53af72['messageData']&&typeof _0x53af72[_0x411efe(0x1ea3)]==='object'&&chatMessages[_0x354473][_0x411efe(0x1cd6)](_0x53af72['messageData']);}for(const _0x14f9a7 in chatMessages){console['log'](_0x411efe(0x212e)+_0x14f9a7+':\x20'+chatMessages[_0x14f9a7][_0x411efe(0x19ee)]+_0x411efe(0x441));const _0x1c3b2e=[],_0x14cf23=new Set(),_0x2ee63a=new Set();chatMessages[_0x14f9a7][_0x411efe(0x1e1f)](_0x4c82c3=>{const _0xaf2e61=_0x411efe;if(!_0x4c82c3||typeof _0x4c82c3!==_0xaf2e61(0x28d)||!_0x4c82c3[_0xaf2e61(0x1716)])return![];return!![];})['sort']((_0x169299,_0x9fc72f)=>_0x169299[_0x411efe(0x1716)]-_0x9fc72f[_0x411efe(0x1716)])['forEach'](_0x2dd29f=>{const _0x27fe29=_0x411efe;if(_0x2dd29f['id']&&_0x14cf23['has'](_0x2dd29f['id']))return;const _0x15cf7b=(_0x2dd29f['content']||'')+'_'+_0x2dd29f[_0x27fe29(0x1716)]+'_'+(_0x2dd29f[_0x27fe29(0x8a1)]||'')+'_'+(_0x2dd29f['isProactive']||'')+'_'+(_0x2dd29f[_0x27fe29(0x208c)]||'');if(_0x2ee63a[_0x27fe29(0x975)](_0x15cf7b))return;if(_0x2dd29f['id'])_0x14cf23['add'](_0x2dd29f['id']);_0x2ee63a['add'](_0x15cf7b),_0x1c3b2e['push'](_0x2dd29f);}),chatMessages[_0x14f9a7]=_0x1c3b2e,console[_0x411efe(0x2187)](_0x411efe(0x204e)+_0x14f9a7+':\x20'+_0x1c3b2e['length']+_0x411efe(0x1b2b)+(_0x54197a[_0x411efe(0x1e1f)](_0x52e8ac=>_0x52e8ac[_0x411efe(0xaf5)]===_0x14f9a7)[_0x411efe(0x19ee)]-_0x1c3b2e[_0x411efe(0x19ee)])+_0x411efe(0x240));}await cleanupBlockedSystemMessages();}lastSavedMessageHashes={};for(const [_0x2fa96c,_0x3639d8]of Object[_0x411efe(0x2bc)](chatMessages)){lastSavedMessageHashes[_0x2fa96c]=generateMessagesHash(_0x3639d8);}console[_0x411efe(0x2187)]('✅\x20已初始化消息哈希检测器:',Object[_0x411efe(0x1c9f)](lastSavedMessageHashes));}catch(_0x1c8a4c){console['error'](_0x411efe(0x22ba),_0x1c8a4c);const _0x1429cb=localStorage[_0x411efe(0x15d8)](_0x411efe(0x19a2));_0x1429cb?chatMessages=JSON[_0x411efe(0x22d3)](_0x1429cb):chatMessages={};}}async function cleanupBlockedSystemMessages(){const _0x62f573=_0x211817;try{const _0x551916=await db['chatMessages'][_0x62f573(0xf13)](),_0x25f898=[],_0x459e37={};for(const _0x2784a4 of _0x551916){if(_0x2784a4[_0x62f573(0x1ea3)]&&_0x2784a4[_0x62f573(0x1ea3)][_0x62f573(0x8a1)]===_0x62f573(0x1744)&&_0x2784a4[_0x62f573(0x1ea3)][_0x62f573(0x1144)]){const _0x53b7de=_0x2784a4[_0x62f573(0xaf5)];!_0x459e37[_0x53b7de]&&(_0x459e37[_0x53b7de]=[]),_0x459e37[_0x53b7de][_0x62f573(0x1cd6)](_0x2784a4);}}for(const _0x59e1fc in _0x459e37){const _0x368c47=_0x459e37[_0x59e1fc];if(_0x368c47[_0x62f573(0x19ee)]>0x1){_0x368c47[_0x62f573(0x1104)]((_0x25c91b,_0x2e70ef)=>(_0x2e70ef[_0x62f573(0x1ea3)][_0x62f573(0x1716)]||0x0)-(_0x25c91b[_0x62f573(0x1ea3)][_0x62f573(0x1716)]||0x0));const _0x5b0c88=_0x368c47[_0x62f573(0x6d5)](0x1);_0x25f898[_0x62f573(0x1cd6)](..._0x5b0c88[_0x62f573(0x6a4)](_0x48c00c=>_0x48c00c['id']));}}_0x25f898['length']>0x0&&(await db[_0x62f573(0x19a2)]['bulkDelete'](_0x25f898),console[_0x62f573(0x2187)](_0x62f573(0x1efb)+_0x25f898[_0x62f573(0x19ee)]+'\x20条重复的拉黑系统消息'));}catch(_0x1a47ae){console[_0x62f573(0x174a)](_0x62f573(0xeac),_0x1a47ae);}}let saveMessagesTimer=null,isSaving=![],saveQueue=[],lastSavedMessageHashes={},nextSequentialId=0x0;function generateMessagesHash(_0x37c4af){const _0x37b0d5=_0x211817;if(!_0x37c4af||_0x37c4af[_0x37b0d5(0x19ee)]===0x0)return'';const _0x3b8c8c=_0x37c4af[_0x37b0d5(0x6a4)](_0x7857c5=>(_0x7857c5['id']||'')+':'+(_0x7857c5[_0x37b0d5(0x211c)]||'')+':'+(_0x7857c5[_0x37b0d5(0x1a4b)]||'')+':'+(_0x7857c5[_0x37b0d5(0x8a1)]||'')+':'+(_0x7857c5['isProactive']||'')+':'+(_0x7857c5[_0x37b0d5(0x208c)]||''))[_0x37b0d5(0x122b)]('|');let _0x4f2638=0x0;for(let _0xe55f11=0x0;_0xe55f11<_0x3b8c8c[_0x37b0d5(0x19ee)];_0xe55f11++){const _0x216813=_0x3b8c8c[_0x37b0d5(0x1833)](_0xe55f11);_0x4f2638=(_0x4f2638<<0x5)-_0x4f2638+_0x216813,_0x4f2638=_0x4f2638&_0x4f2638;}return _0x4f2638[_0x37b0d5(0x1878)]();}function saveChatMessages(_0x4c3236=null){const _0x273025=_0x211817,_0x26e5e8={'timestamp':Date[_0x273025(0x2eb)](),'id':Math['random']()[_0x273025(0x1878)](0x24)['substr'](0x2,0x9),'forceResyncFor':_0x4c3236};saveQueue[_0x273025(0x1cd6)](_0x26e5e8),saveMessagesTimer&&clearTimeout(saveMessagesTimer),saveMessagesTimer=setTimeout(async()=>{const _0x2c2b64=_0x273025;if(isSaving){setTimeout(()=>saveChatMessages(),0x64);return;}const _0xc67414=new Set();saveQueue[_0x2c2b64(0x19fb)](_0x59c89e=>{const _0x458ebe=_0x2c2b64;_0x59c89e['forceResyncFor']&&_0xc67414['add'](_0x59c89e[_0x458ebe(0x17cd)]);});const _0x4c34f3=[...saveQueue];saveQueue=[],_0x4c34f3[_0x2c2b64(0x19ee)]>0x0&&(console[_0x2c2b64(0x2187)](_0x2c2b64(0x1732)+_0x4c34f3['length']+'\x20个请求'),await saveChatMessagesImmediate(Array[_0x2c2b64(0x13c0)](_0xc67414)));},0x1f4);}async function saveChatMessagesImmediate(_0x59f7b7=[]){const _0x4f4254=_0x211817;if(isSaving)return;isSaving=!![];try{const _0x36ac34=await checkStorageUsage();_0x36ac34&&_0x36ac34['needCleanup']&&(console['warn'](_0x4f4254(0x1562)),await performSmartDataCleanup());const _0x5f0b78=[],_0x3d449d=new Set(_0x59f7b7);if(nextSequentialId===0x0){const _0x5d1d85=await db['chatMessages'][_0x4f4254(0xf13)]();nextSequentialId=_0x5d1d85['length'];}for(const [_0x17fe49,_0x566b37]of Object['entries'](chatMessages)){const _0x4538a9=generateMessagesHash(_0x566b37),_0x34603b=lastSavedMessageHashes[_0x17fe49]||'';if(_0x3d449d['has'](_0x17fe49)){console[_0x4f4254(0x2187)](_0x4f4254(0x19b5)+_0x17fe49+_0x4f4254(0x1b70)),_0x3d449d[_0x4f4254(0x21e2)](_0x17fe49);for(let _0x4dfb8b=0x0;_0x4dfb8b<_0x566b37[_0x4f4254(0x19ee)];_0x4dfb8b++){const _0x5c185b=_0x566b37[_0x4dfb8b],_0x3b07e4=_0x17fe49+_0x4f4254(0x183a)+(_0x5c185b[_0x4f4254(0x1716)]||Date['now']())+'_'+_0x4dfb8b+'_'+Math['random']()[_0x4f4254(0x1878)](0x24)['substr'](0x2,0x6);_0x5f0b78['push']({'id':_0x3b07e4,'characterId':_0x17fe49,'timestamp':_0x5c185b[_0x4f4254(0x1716)],'messageOrder':_0x4dfb8b,'originalMessageId':_0x5c185b['id'],'messageData':_0x5c185b});}lastSavedMessageHashes[_0x17fe49]=_0x4538a9;continue;}if(_0x4538a9!==_0x34603b){console[_0x4f4254(0x2187)]('📝\x20角色\x20'+_0x17fe49+_0x4f4254(0x104b)),_0x3d449d[_0x4f4254(0x21e2)](_0x17fe49);for(let _0x58c9b4=0x0;_0x58c9b4<_0x566b37[_0x4f4254(0x19ee)];_0x58c9b4++){const _0x5ad5e1=_0x566b37[_0x58c9b4],_0x3722fb=_0x17fe49+_0x4f4254(0xcc0)+(_0x5ad5e1[_0x4f4254(0x1716)]||Date[_0x4f4254(0x2eb)]())+'_'+_0x58c9b4+'_'+Math[_0x4f4254(0x11a8)]()[_0x4f4254(0x1878)](0x24)[_0x4f4254(0x15fb)](0x2,0x6);_0x5f0b78['push']({'id':_0x3722fb,'characterId':_0x17fe49,'timestamp':_0x5ad5e1[_0x4f4254(0x1716)],'messageOrder':_0x58c9b4,'originalMessageId':_0x5ad5e1['id'],'messageData':_0x5ad5e1});}lastSavedMessageHashes[_0x17fe49]=_0x4538a9;}}const _0x291892=Array[_0x4f4254(0x13c0)](_0x3d449d);if(_0x291892[_0x4f4254(0x19ee)]===0x0&&_0x5f0b78[_0x4f4254(0x19ee)]===0x0){console[_0x4f4254(0x2187)](_0x4f4254(0x1860)),isSaving=![];return;}let _0x25782a=0x0;const _0x21324d=0x3;while(_0x25782a<_0x21324d){try{await db[_0x4f4254(0x1464)]('rw',db['chatMessages'],async()=>{const _0x22cc27=_0x4f4254;if(_0x291892['length']>0x0)for(const _0x459d73 of _0x291892){const _0x54d8e6=await db['chatMessages'][_0x22cc27(0xa24)](_0x22cc27(0xaf5))[_0x22cc27(0x1694)](_0x459d73)[_0x22cc27(0x1f4a)]();console[_0x22cc27(0x2187)](_0x22cc27(0x1b44)+_0x459d73+'\x20的\x20'+_0x54d8e6+_0x22cc27(0x17a5));}_0x5f0b78['length']>0x0&&(await db[_0x22cc27(0x19a2)]['bulkAdd'](_0x5f0b78),console[_0x22cc27(0x2187)](_0x22cc27(0x1a68)+_0x5f0b78[_0x22cc27(0x19ee)]+_0x22cc27(0xd51)));});break;}catch(_0x2cd214){_0x25782a++,console['warn'](_0x4f4254(0x1c3e)+_0x25782a+'/'+_0x21324d+':',_0x2cd214);if(_0x25782a>=_0x21324d)throw _0x2cd214;await new Promise(_0x4fb674=>setTimeout(_0x4fb674,0x64*_0x25782a));}}console['log'](_0x4f4254(0x1795)+_0x291892['length']+_0x4f4254(0x227d)+_0x5f0b78['length']+_0x4f4254(0x197b));}catch(_0xa4da62){console[_0x4f4254(0x174a)](_0x4f4254(0x88a),_0xa4da62);}finally{isSaving=![];}}async function loadChatSettings(){const _0x418ffa=_0x211817;try{const _0x4c8e23=await db['chatSettings'][_0x418ffa(0xf13)](),_0x2f3b5c=await db[_0x418ffa(0x1742)][_0x418ffa(0xf13)]();if(_0x4c8e23[_0x418ffa(0x19ee)]>0x0||_0x2f3b5c[_0x418ffa(0x19ee)]>0x0){console[_0x418ffa(0x2187)](_0x418ffa(0xa50)+_0x4c8e23['length']+'\x20个聊天设置和\x20'+_0x2f3b5c[_0x418ffa(0x19ee)]+'\x20个窗口隔离设置'),chatSettings={},_0x4c8e23[_0x418ffa(0x19fb)](_0x296947=>{const _0x4c0faf=_0x418ffa;chatSettings[_0x296947[_0x4c0faf(0x20e1)]]=_0x296947[_0x4c0faf(0x1512)];}),_0x2f3b5c[_0x418ffa(0x19fb)](_0x43ced6=>{const _0x42794f=_0x418ffa,_0x1fea36=_0x43ced6['chatId']+'_'+_0x43ced6[_0x42794f(0x72a)];chatSettings[_0x1fea36]=_0x43ced6['settings'];});return;}console['log']('🔄\x20IndexedDB中无数据，尝试从localStorage迁移...');const _0x383550=localStorage[_0x418ffa(0x15d8)](_0x418ffa(0x1789));if(_0x383550){const _0x3866d2=JSON[_0x418ffa(0x22d3)](_0x383550);await migrateChatSettingsToIndexedDB(_0x3866d2);return;}const _0x312a32={};let _0x2ce929=![];for(let _0x199f52=0x0;_0x199f52<localStorage[_0x418ffa(0x19ee)];_0x199f52++){const _0x4674be=localStorage[_0x418ffa(0x213c)](_0x199f52);if(_0x4674be&&_0x4674be['startsWith'](_0x418ffa(0xa25))&&!_0x4674be['includes'](_0x418ffa(0x1729)))try{const _0x5fdd8b=_0x4674be[_0x418ffa(0xe16)]('chatSettings_',''),_0x4f56f4=localStorage[_0x418ffa(0x15d8)](_0x4674be);_0x4f56f4&&(_0x312a32[_0x5fdd8b]=JSON[_0x418ffa(0x22d3)](_0x4f56f4),_0x2ce929=!![]);}catch(_0x37cc1c){console['warn']('跳过无效的localStorage键:\x20'+_0x4674be,_0x37cc1c);}}if(_0x2ce929){console['log']('🔄\x20发现旧格式数据，正在迁移...'),await migrateChatSettingsToIndexedDB(_0x312a32);return;}chatSettings={},console[_0x418ffa(0x2187)](_0x418ffa(0x1a56));}catch(_0x3b70e3){console[_0x418ffa(0x174a)]('🚨\x20加载聊天设置失败:',_0x3b70e3);try{const _0x40f2c3=localStorage[_0x418ffa(0x15d8)]('chatSettings_emergency_backup');if(_0x40f2c3){chatSettings=JSON['parse'](_0x40f2c3),console[_0x418ffa(0x2187)]('🆘\x20从紧急备份恢复聊天设置'),showToast(_0x418ffa(0x1af5),_0x418ffa(0x1816));return;}}catch(_0x4c2932){console[_0x418ffa(0x174a)](_0x418ffa(0xcd7),_0x4c2932);}chatSettings={},showToast(_0x418ffa(0x1093),_0x418ffa(0x174a));}}async function migrateChatSettingsToIndexedDB(_0x5b4ec4){const _0xa1f63c=_0x211817;try{const _0xa487b=Object['keys'](_0x5b4ec4)['map'](_0x1055ca=>({'id':_0x1055ca,'chatId':_0x1055ca,'settings':_0x5b4ec4[_0x1055ca]}));_0xa487b[_0xa1f63c(0x19ee)]>0x0&&(await db[_0xa1f63c(0x1789)][_0xa1f63c(0x1883)](_0xa487b),console[_0xa1f63c(0x2187)](_0xa1f63c(0x1461)+_0xa487b[_0xa1f63c(0x19ee)]+_0xa1f63c(0x1607)),chatSettings=_0x5b4ec4);}catch(_0x497ad3){console['error'](_0xa1f63c(0x1e7a),_0x497ad3),chatSettings=_0x5b4ec4;}}let autoSaveTimer=null,pendingSettingsChanges=new Set();function scheduleAutoSave(_0xe62d88){const _0x2278e2=_0x211817;_0xe62d88&&pendingSettingsChanges[_0x2278e2(0x21e2)](_0xe62d88),autoSaveTimer&&clearTimeout(autoSaveTimer),autoSaveTimer=setTimeout(async()=>{const _0x41d730=_0x2278e2;if(pendingSettingsChanges[_0x41d730(0x2d8)]>0x0){console['log']('🔄\x20自动保存\x20'+pendingSettingsChanges['size']+_0x41d730(0xd18));try{await saveChatSettings(),console[_0x41d730(0x2187)](_0x41d730(0x2df)),pendingSettingsChanges[_0x41d730(0xa4f)]();}catch(_0x47eb4d){console[_0x41d730(0x174a)](_0x41d730(0x1d22),_0x47eb4d);}}autoSaveTimer=null;},0x1388);}window[_0x211817(0x21e9)](_0x211817(0x2040),async _0xd7e2d3=>{const _0x3a8531=_0x211817;if(pendingSettingsChanges[_0x3a8531(0x2d8)]>0x0){console['log'](_0x3a8531(0xc70));try{await saveChatSettings(),console[_0x3a8531(0x2187)](_0x3a8531(0x1930));}catch(_0x1f6ef7){console[_0x3a8531(0x174a)](_0x3a8531(0xa82),_0x1f6ef7);}}}),document[_0x211817(0x21e9)]('visibilitychange',async()=>{const _0xd7f9e2=_0x211817;if(document[_0xd7f9e2(0xa52)]&&pendingSettingsChanges['size']>0x0){console[_0xd7f9e2(0x2187)](_0xd7f9e2(0x1ecf));try{await saveChatSettings(),console['log'](_0xd7f9e2(0xfda)),pendingSettingsChanges[_0xd7f9e2(0xa4f)]();}catch(_0x4ff24f){console['error'](_0xd7f9e2(0x18c5),_0x4ff24f);}}});async function debugChatMessagesFormat(){const _0x16a082=_0x211817;try{const _0x406262=await db['chatMessages']['toArray']();console['log'](_0x16a082(0x5a1)),console[_0x16a082(0x2187)](_0x16a082(0x1035)+_0x406262['length']+'\x20条');if(_0x406262[_0x16a082(0x19ee)]>0x0){const _0x2a2c57=_0x406262[0x0];console['log'](_0x16a082(0x669),Object[_0x16a082(0x1c9f)](_0x2a2c57)),console[_0x16a082(0x2187)](_0x16a082(0x1019),_0x2a2c57);const _0x270dc7=_0x406262['some'](_0xfba032=>_0xfba032['messageData']),_0x56613f=_0x406262[_0x16a082(0x19fa)](_0x4b0053=>_0x4b0053[_0x16a082(0x211c)]);console[_0x16a082(0x2187)]('包含messageData字段:\x20'+_0x270dc7),console[_0x16a082(0x2187)](_0x16a082(0x1091)+_0x56613f);}console[_0x16a082(0x2187)](_0x16a082(0xae8));const _0x449c84=Object[_0x16a082(0xc6f)](chatMessages)[_0x16a082(0x1122)]((_0x243f3c,_0x5233de)=>_0x243f3c+_0x5233de[_0x16a082(0x19ee)],0x0);console['log'](_0x16a082(0x1035)+_0x449c84+'\x20条');if(_0x449c84>0x0){const _0xfb30ae=Object[_0x16a082(0x1c9f)](chatMessages)[0x0],_0x2f6946=chatMessages[_0xfb30ae]?.[0x0];_0x2f6946&&(console[_0x16a082(0x2187)](_0x16a082(0x1eef),Object[_0x16a082(0x1c9f)](_0x2f6946)),console[_0x16a082(0x2187)](_0x16a082(0x1120),_0x2f6946));}showToast(_0x16a082(0x74e),_0x16a082(0x477));}catch(_0x45134f){console[_0x16a082(0x174a)](_0x16a082(0x1a63),_0x45134f),showToast(_0x16a082(0x1f20)+_0x45134f['message'],_0x16a082(0x174a));}}async function cleanupOldChatSettingsFromLocalStorage(){const _0x39f4cc=_0x211817;try{let _0x594948=0x0;const _0x4be43e=[];for(let _0x5441e7=0x0;_0x5441e7<localStorage[_0x39f4cc(0x19ee)];_0x5441e7++){const _0x31bed9=localStorage[_0x39f4cc(0x213c)](_0x5441e7);_0x31bed9&&(_0x31bed9===_0x39f4cc(0x1789)||_0x31bed9[_0x39f4cc(0x1b30)](_0x39f4cc(0xa25)))&&!_0x31bed9[_0x39f4cc(0x1831)]('emergency')&&_0x4be43e[_0x39f4cc(0x1cd6)](_0x31bed9);}const _0x4c0a7c=await db['chatSettings']['toArray']();if(_0x4c0a7c['length']>0x0&&_0x4be43e[_0x39f4cc(0x19ee)]>0x0){const _0x2bf7e0=confirm(_0x39f4cc(0x1794)+_0x4be43e['length']+_0x39f4cc(0x691)+(_0x39f4cc(0x1dee)+_0x4c0a7c[_0x39f4cc(0x19ee)]+_0x39f4cc(0xcc8))+_0x39f4cc(0x5a8));_0x2bf7e0&&(_0x4be43e[_0x39f4cc(0x19fb)](_0xa193ab=>{const _0x1cb4a7=_0x39f4cc;localStorage[_0x1cb4a7(0x3b2)](_0xa193ab),_0x594948++;}),console[_0x39f4cc(0x2187)](_0x39f4cc(0xc36)+_0x594948+'\x20个旧的localStorage聊天设置'),showToast('🧹\x20已清理\x20'+_0x594948+_0x39f4cc(0x16b2),_0x39f4cc(0x11cb)));}}catch(_0x101127){console[_0x39f4cc(0x174a)]('清理旧chatSettings数据失败:',_0x101127);}}async function saveChatSettings(){const _0x35f0e7=_0x211817;try{const _0xdc5d9=Object[_0x35f0e7(0x1c9f)](chatSettings)[_0x35f0e7(0x6a4)](_0x52966a=>({'id':_0x52966a,'chatId':_0x52966a,'settings':chatSettings[_0x52966a]}));if(_0xdc5d9['length']===0x0){console[_0x35f0e7(0x1f43)]('⚠️\x20聊天设置数据为空，跳过保存操作');return;}await db['chatSettings'][_0x35f0e7(0x1883)](_0xdc5d9),console[_0x35f0e7(0x2187)](_0x35f0e7(0x408)+_0xdc5d9['length']+_0x35f0e7(0x1607));}catch(_0x3bad46){console['error']('🚨\x20保存聊天设置到IndexedDB失败:',_0x3bad46);try{console['warn']('⚠️\x20正在进行紧急备份到localStorage...');const _0x580c4d={};Object[_0x35f0e7(0x1c9f)](chatSettings)['forEach'](_0x3340ef=>{const _0x5b8a76=_0x35f0e7;_0x580c4d[_0x3340ef]={'bubbleStyle':chatSettings[_0x3340ef][_0x5b8a76(0x1813)],'aiChatAvatar':chatSettings[_0x3340ef]['aiChatAvatar'],'myChatAvatar':chatSettings[_0x3340ef][_0x5b8a76(0x11cd)],'aiChatNickname':chatSettings[_0x3340ef][_0x5b8a76(0x4e7)],'myChatNickname':chatSettings[_0x3340ef][_0x5b8a76(0x567)],'hideAvatars':chatSettings[_0x3340ef][_0x5b8a76(0xdea)],'selectedIdentityId':chatSettings[_0x3340ef][_0x5b8a76(0x145e)],'timestampEnabled':chatSettings[_0x3340ef][_0x5b8a76(0x17eb)],'timestampPosition':chatSettings[_0x3340ef]['timestampPosition']};}),localStorage[_0x35f0e7(0x192)](_0x35f0e7(0x1a73),JSON[_0x35f0e7(0x6b8)](_0x580c4d)),console[_0x35f0e7(0x2187)](_0x35f0e7(0x1ba6)),showToast(_0x35f0e7(0x15a5),_0x35f0e7(0x1816));}catch(_0x1f7de2){console[_0x35f0e7(0x174a)]('🚨\x20紧急备份也失败了:',_0x1f7de2),showToast('❌\x20设置保存失败！请检查存储空间',_0x35f0e7(0x174a));throw _0x1f7de2;}}}let backgroundTimers={};async function initGlobalBackgroundInteractionSystem(){const _0x1dad0c=_0x211817;console['log']('🚀\x20启动全局后台互动系统...');for(const _0x49c93f of characters){try{const _0x32e931=await getChatSettings(_0x49c93f['id']),_0x192d5d=_0x32e931['backgroundInteractionEnabled']===!![],_0x16d1f9=_0x32e931[_0x1dad0c(0x2ac)]===!![],_0x539938=_0x32e931['backgroundMomentsEnabled']===!![];if(!_0x192d5d){console['log']('角色\x20'+_0x49c93f[_0x1dad0c(0x1a1c)]+'\x20的后台互动已禁用，跳过');continue;}console[_0x1dad0c(0x2187)]('为角色\x20'+_0x49c93f['name']+_0x1dad0c(0x1293));if(_0x192d5d&&_0x16d1f9){const _0x43d0f6=chatMessages[_0x49c93f['id']]||[],_0x359e87=_0x43d0f6['some'](_0x5adcfb=>_0x5adcfb['sender']===_0x1dad0c(0x1e6d));_0x359e87?(await scheduleProactiveChatForCharacter(_0x49c93f['id']),console[_0x1dad0c(0x2187)](_0x1dad0c(0xac7)+_0x49c93f[_0x1dad0c(0x1a1c)]+'\x20动态主动聊天定时器已设置')):console['log']('⏸️\x20[全局初始化]\x20'+_0x49c93f[_0x1dad0c(0x1a1c)]+_0x1dad0c(0x600));}else console[_0x1dad0c(0x2187)](_0x1dad0c(0x2e5)+_0x49c93f['name']+_0x1dad0c(0x30b));if(_0x192d5d&&_0x539938){const _0x1765a9=getBackgroundMomentsInterval(_0x32e931[_0x1dad0c(0xed6)]||_0x1dad0c(0x113f));backgroundTimers[_0x49c93f['id']+_0x1dad0c(0x1b6e)]=setInterval(()=>{triggerBackgroundMoments(_0x49c93f['id']);},_0x1765a9),console['log'](_0x49c93f[_0x1dad0c(0x1a1c)]+_0x1dad0c(0xb7d)+_0x1765a9+'ms');}await initBackgroundDiarySystem(_0x49c93f['id']);}catch(_0x5399ba){console[_0x1dad0c(0x174a)]('为角色\x20'+_0x49c93f[_0x1dad0c(0x1a1c)]+'\x20设置后台互动定时器失败:',_0x5399ba);}}}async function initBackgroundInteractionSystem(){const _0x21f189=_0x211817;console[_0x21f189(0x2187)](_0x21f189(0x1734)),console[_0x21f189(0x2187)](_0x21f189(0x307));}function clearAllBackgroundTimers(){const _0x2dbf73=_0x211817;Object['values'](backgroundTimers)[_0x2dbf73(0x19fb)](_0x330bcd=>{if(_0x330bcd)clearInterval(_0x330bcd);}),backgroundTimers={},Object[_0x2dbf73(0xc6f)](backgroundDiaryTimers)[_0x2dbf73(0x19fb)](_0x41f8c5=>{if(_0x41f8c5)clearTimeout(_0x41f8c5);}),backgroundDiaryTimers={};}let backgroundDiaryTimers={};async function saveDiaryTime(){const _0x4b73b6=_0x211817;if(!currentChatCharacter){showToast('请先选择角色',_0x4b73b6(0x174a));return;}const _0x427a8a=document['getElementById']('diary-time-input'),_0x1a30fe=_0x427a8a[_0x4b73b6(0x1ebc)];if(!_0x1a30fe){showToast(_0x4b73b6(0x1e7b),_0x4b73b6(0x174a));return;}const _0x2601ce=getCurrentChatSettings();_0x2601ce[_0x4b73b6(0x1927)]=_0x1a30fe,await saveCurrentChatSettings(_0x2601ce),currentChatCharacter&&(backgroundDiaryTimers[currentChatCharacter['id']]&&(clearTimeout(backgroundDiaryTimers[currentChatCharacter['id']]),delete backgroundDiaryTimers[currentChatCharacter['id']]),_0x2601ce[_0x4b73b6(0x4f2)]&&_0x2601ce[_0x4b73b6(0xe72)]&&(console['log'](_0x4b73b6(0x6ea)+currentChatCharacter[_0x4b73b6(0x1a1c)]+_0x4b73b6(0x401)+_0x1a30fe),scheduleBackgroundDiary(currentChatCharacter['id'],_0x1a30fe))),showToast(_0x4b73b6(0x883)+currentChatCharacter[_0x4b73b6(0x1a1c)]+_0x4b73b6(0x210a)+_0x1a30fe+_0x4b73b6(0x1d20),'success');}async function initBackgroundDiarySystem(_0x103c99){const _0x431f09=_0x211817;backgroundDiaryTimers[_0x103c99]&&(clearTimeout(backgroundDiaryTimers[_0x103c99]),delete backgroundDiaryTimers[_0x103c99]);const _0x57b33f=characters[_0x431f09(0xaf4)](_0x58d9b4=>_0x58d9b4['id']===_0x103c99);if(!_0x57b33f)return;if(_0x57b33f[_0x431f09(0x1f68)]){console['log'](_0x431f09(0xa6e)+_0x57b33f[_0x431f09(0x1a1c)]+_0x431f09(0x8d5));return;}const _0x38c518=await getChatSettings(_0x103c99),_0x4e3e44=_0x38c518[_0x431f09(0x4f2)]===!![],_0x30f819=_0x38c518['backgroundDiaryEnabled']===!![],_0x424332=_0x38c518['backgroundDiaryTime'];if(!_0x4e3e44||!_0x30f819||!_0x424332){console[_0x431f09(0x2187)](_0x431f09(0x151d)+_0x57b33f[_0x431f09(0x1a1c)]+_0x431f09(0x79a));return;}console[_0x431f09(0x2187)](_0x431f09(0x1cbf)+_0x57b33f[_0x431f09(0x1a1c)]+_0x431f09(0x401)+_0x424332),scheduleBackgroundDiary(_0x103c99,_0x424332);}function scheduleBackgroundDiary(_0x4d4250,_0x206990){const _0x1c34d9=_0x211817,_0x48ea82=characters['find'](_0x5c1fbf=>_0x5c1fbf['id']===_0x4d4250);if(!_0x48ea82)return;const [_0x48a6ea,_0x46a13b]=_0x206990['split'](':')[_0x1c34d9(0x6a4)](Number);console['log'](_0x1c34d9(0xcdd)+_0x48a6ea+':'+_0x46a13b);const _0x552e37=new Date(),_0x2832a5=new Date();_0x2832a5['setHours'](_0x48a6ea,_0x46a13b,0x0,0x0),console[_0x1c34d9(0x2187)](_0x1c34d9(0x162b)+_0x552e37[_0x1c34d9(0xecc)]()),console['log'](_0x1c34d9(0x5aa)+_0x2832a5[_0x1c34d9(0xecc)]());_0x2832a5<=_0x552e37&&(_0x2832a5[_0x1c34d9(0x20ae)](_0x2832a5[_0x1c34d9(0x520)]()+0x1),console[_0x1c34d9(0x2187)](_0x1c34d9(0xb32)+_0x2832a5[_0x1c34d9(0xecc)]()));const _0x4e77fc=(Math[_0x1c34d9(0x11a8)]()-0.5)*0xa*0x3c*0x3e8;_0x2832a5[_0x1c34d9(0xb3d)](_0x2832a5[_0x1c34d9(0x704)]()+_0x4e77fc);const _0x304686=_0x2832a5[_0x1c34d9(0x704)]()-_0x552e37[_0x1c34d9(0x704)]();console['log'](_0x1c34d9(0x1503)+_0x48ea82[_0x1c34d9(0x1a1c)]+_0x1c34d9(0x1b6c)+_0x2832a5[_0x1c34d9(0xecc)]()+_0x1c34d9(0x98b)+Math[_0x1c34d9(0x13e2)](_0x304686/0xea60)+_0x1c34d9(0x1c38)),console[_0x1c34d9(0x2187)](_0x1c34d9(0xf36)+_0x304686+'ms');if(_0x304686<=0x0){console[_0x1c34d9(0x1f43)](_0x1c34d9(0x215)),setTimeout(async()=>{await triggerBackgroundDiary(_0x4d4250);},0x3e8);return;}backgroundDiaryTimers[_0x4d4250]=setTimeout(async()=>{const _0x11d961=_0x1c34d9;console['log'](_0x11d961(0xbb0)+_0x48ea82['name']+_0x11d961(0x1a2e)),await triggerBackgroundDiary(_0x4d4250),scheduleBackgroundDiary(_0x4d4250,_0x206990);},_0x304686),console[_0x1c34d9(0x2187)](_0x1c34d9(0x463)+_0x48ea82['name']+_0x1c34d9(0x22f0)+backgroundDiaryTimers[_0x4d4250]);}async function triggerBackgroundDiary(_0x4c2b9c){const _0xe42439=_0x211817,_0x24a469=characters[_0xe42439(0xaf4)](_0x8b3631=>_0x8b3631['id']===_0x4c2b9c);if(!_0x24a469){console['error'](_0xe42439(0x3b3)+_0x4c2b9c);return;}console[_0xe42439(0x2187)](_0xe42439(0x1503)+_0x24a469[_0xe42439(0x1a1c)]+_0xe42439(0x684));try{const _0x3142e5=new Date()[_0xe42439(0x1034)]()[_0xe42439(0x204b)]('T')[0x0],_0x218981=_0x4c2b9c+'_'+_0x3142e5;console['log'](_0xe42439(0x1134)+_0x218981);const _0x3cc547=await db['characterDiaries'][_0xe42439(0xb78)](_0x218981);if(_0x3cc547&&_0x3cc547[_0xe42439(0x211c)]){console[_0xe42439(0x2187)]('📝\x20'+_0x24a469[_0xe42439(0x1a1c)]+_0xe42439(0x1aa8));return;}console[_0xe42439(0x2187)](_0xe42439(0x1503)+_0x24a469[_0xe42439(0x1a1c)]+_0xe42439(0xf89));const _0x386242=await generateBackgroundDiary(_0x24a469);console[_0xe42439(0x2187)]('📝\x20'+_0x24a469['name']+_0xe42439(0x22d1),_0x386242?'成功':'失败');if(_0x386242){const _0x161661={'id':_0x218981,'characterId':_0x4c2b9c,'date':_0x3142e5,'content':_0x386242,'timestamp':Date[_0xe42439(0x2eb)](),'weather':getRandomWeather()};console[_0xe42439(0x2187)]('📝\x20'+_0x24a469[_0xe42439(0x1a1c)]+'\x20保存日记到数据库...',_0x161661),await db[_0xe42439(0x2077)][_0xe42439(0x1561)](_0x161661),console[_0xe42439(0x2187)]('✅\x20'+_0x24a469[_0xe42439(0x1a1c)]+'\x20后台写日记完成！内容:\x20'+_0x386242[_0xe42439(0x17ca)](0x0,0x32)+'...'),createDiaryNotification(_0x24a469);}else console[_0xe42439(0x174a)]('❌\x20'+_0x24a469['name']+_0xe42439(0x1f2c));}catch(_0x294a6b){console['error']('❌\x20'+_0x24a469[_0xe42439(0x1a1c)]+_0xe42439(0x217a),_0x294a6b);}}async function generateBackgroundDiary(_0x1e5e7a){const _0x3832f1=_0x211817;try{console[_0x3832f1(0x2187)](_0x3832f1(0x1364)+_0x1e5e7a[_0x3832f1(0x1a1c)]+'\x20生成日记内容...');const _0x27d3fb=chatMessages[_0x1e5e7a['id']]||[],_0xb2f169=_0x27d3fb[_0x3832f1(0x6d5)](-0x14);console[_0x3832f1(0x2187)](_0x3832f1(0x1f0d)+_0xb2f169[_0x3832f1(0x19ee)]+_0x3832f1(0x1ef0));const _0x48aa7d=new Date()[_0x3832f1(0xbf7)](_0x3832f1(0x156c),{'year':_0x3832f1(0x94d),'month':_0x3832f1(0x14a2),'day':_0x3832f1(0x94d),'weekday':_0x3832f1(0x14a2)}),_0x386bf2=getRandomWeather();let _0xdbf4a3='';_0xb2f169[_0x3832f1(0x19ee)]>0x0&&(_0xdbf4a3='\x0a\x0a最近的聊天内容：\x0a'+_0xb2f169[_0x3832f1(0x6a4)](_0x1504f3=>{const _0x3a1f28=_0x3832f1,_0x29ef33=_0x1504f3[_0x3a1f28(0x8a1)]===_0x3a1f28(0x1e6d)?'用户':_0x1e5e7a[_0x3a1f28(0x1a1c)];return _0x29ef33+':\x20'+(_0x1504f3[_0x3a1f28(0x1378)]||_0x1504f3[_0x3a1f28(0x211c)]||_0x3a1f28(0x424));})['join']('\x0a'));const _0x1eebcd='你是'+_0x1e5e7a[_0x3832f1(0x1a1c)]+_0x3832f1(0xaca)+_0x1e5e7a[_0x3832f1(0x1f0b)]+_0x3832f1(0x2e1)+_0x48aa7d+_0x3832f1(0x40e)+_0x48aa7d+'，天气：'+_0x386bf2+'\x22\x0a-\x20用你的口吻和性格来写\x0a-\x20记录你今天的想法、感受和经历\x0a-\x20可以提及对用户的真实感情\x0a-\x20基于最近的聊天记录，可适当考虑与用户的互动\x0a-\x20保持角色的一致性和真实性\x0a-\x20内容要自然、真实，像真正的私人日记\x0a-\x20字数在100-200字之间，根据你的性格和当天的心情自由发挥'+_0xdbf4a3+_0x3832f1(0xd30)+_0x1e5e7a['name']+_0x3832f1(0x14bc);console['log'](_0x3832f1(0x1e07)+_0x1eebcd['length']);const _0x39b804=await generateAIResponse(_0x1eebcd,_0x1e5e7a);console[_0x3832f1(0x2187)](_0x3832f1(0xfbe),_0x39b804?_0x3832f1(0x10b9)+_0x39b804[_0x3832f1(0x19ee)]:_0x3832f1(0x18b2));if(_0x39b804&&_0x39b804['trim']()){let _0x40c91a=_0x39b804['trim']();return _0x40c91a=cleanDiaryContent(_0x40c91a),console[_0x3832f1(0x2187)](_0x3832f1(0x7b8)+_0x1e5e7a['name']+_0x3832f1(0x14e0)),_0x40c91a;}return console[_0x3832f1(0x1f43)](_0x3832f1(0x7b8)+_0x1e5e7a['name']+'\x20日记内容为空'),null;}catch(_0x4a3f61){return console[_0x3832f1(0x174a)]('📝\x20[日记生成]\x20'+_0x1e5e7a[_0x3832f1(0x1a1c)]+_0x3832f1(0x1bb7),_0x4a3f61),null;}}function createDiaryNotification(_0x1aebe4){const _0x21d870=_0x211817,_0x4bed63=_0x21d870(0x1ccb)+_0x1aebe4['name']+'写日记啦~\x0a快来看看吧',_0x41f65f=_0x21d870(0x10da)+_0x4bed63;createPushNotification(_0x1aebe4,_0x41f65f,0x64);}function getRandomWeather(){const _0x2f4fb9=_0x211817,_0x40d9a9=['☀️','⛅','☁️',_0x2f4fb9(0x216e),'⛈️',_0x2f4fb9(0xca3),'🌤️',_0x2f4fb9(0xbcc)];return _0x40d9a9[Math[_0x2f4fb9(0x2180)](Math[_0x2f4fb9(0x11a8)]()*_0x40d9a9[_0x2f4fb9(0x19ee)])];}async function testBackgroundDiary(){const _0x468d35=_0x211817;if(!currentChatCharacter){showToast(_0x468d35(0x85d),_0x468d35(0x174a));return;}if(currentChatCharacter['isGroup']){showToast('群聊不支持日记功能',_0x468d35(0x174a));return;}console[_0x468d35(0x2187)](_0x468d35(0x8fa)+currentChatCharacter[_0x468d35(0x1a1c)]+'\x20写日记...'),await triggerBackgroundDiary(currentChatCharacter['id']);}function debugBackgroundTimers(){const _0x25cce0=_0x211817;console[_0x25cce0(0x2187)]('🔍\x20[调试]\x20当前后台定时器状态:'),console['log'](_0x25cce0(0x1b52),Object['keys'](backgroundTimers)),console[_0x25cce0(0x2187)](_0x25cce0(0x3f9),Object[_0x25cce0(0x1c9f)](backgroundDiaryTimers)),Object[_0x25cce0(0x1c9f)](backgroundDiaryTimers)[_0x25cce0(0x19fb)](_0x5a28ee=>{const _0x18a582=_0x25cce0,_0x59aeff=characters[_0x18a582(0xaf4)](_0x1d3477=>_0x1d3477['id']===_0x5a28ee),_0xd422d4=backgroundDiaryTimers[_0x5a28ee]!==null&&backgroundDiaryTimers[_0x5a28ee]!==undefined;console[_0x18a582(0x2187)](_0x18a582(0x1503)+(_0x59aeff?.[_0x18a582(0x1a1c)]||_0x5a28ee)+_0x18a582(0xb19)+(_0xd422d4?'存在':'不存在'));});}let globalMomentsTimers={},globalMomentsCheckInterval=null;async function initGlobalMomentsSystem(){const _0x38ea3a=_0x211817;console[_0x38ea3a(0x2187)]('🚀\x20初始化全局动态发布系统'),clearGlobalMomentsTimers();let _0x2187ee=0x0;if(characters&&characters[_0x38ea3a(0x19ee)]>0x0)for(const _0x68737f of characters){const _0x22251c=await getChatSettings(_0x68737f['id']);if(_0x22251c[_0x38ea3a(0x4f2)]===!![]&&_0x22251c[_0x38ea3a(0x354)]===!![]){const _0x518a97=_0x22251c['backgroundMomentsFrequency']||'low',_0x30f2a0=getBackgroundMomentsInterval(_0x518a97);globalMomentsTimers[_0x68737f['id']]=setInterval(async()=>{const _0x138789=_0x38ea3a;console['log'](_0x138789(0x492)+_0x68737f[_0x138789(0x1a1c)]+'\x20准备发布动态'),await triggerBackgroundMoments(_0x68737f['id']);},_0x30f2a0),_0x2187ee++,console[_0x38ea3a(0x2187)]('✅\x20为角色\x20'+_0x68737f[_0x38ea3a(0x1a1c)]+_0x38ea3a(0x974)+Math[_0x38ea3a(0x13e2)](_0x30f2a0/0x3e8/0x3c)+'分钟');}_0x22251c[_0x38ea3a(0x1d5f)]&&_0x22251c[_0x38ea3a(0xb66)]&&_0x22251c[_0x38ea3a(0xb66)][_0x38ea3a(0x19ee)]>0x0&&console[_0x38ea3a(0x2187)](_0x38ea3a(0x1bf6)+_0x68737f[_0x38ea3a(0x1a1c)]+_0x38ea3a(0x20c2),_0x22251c['scheduledMomentsTimes']);}!globalMomentsCheckInterval&&(globalMomentsCheckInterval=setInterval(async()=>{await checkScheduledMomentsTime();},0xea60),console['log'](_0x38ea3a(0x1ace))),console[_0x38ea3a(0x2187)](_0x38ea3a(0x2055)+_0x2187ee+_0x38ea3a(0x5b9));}async function checkScheduledMomentsTime(){const _0xe95f79=_0x211817,_0x9497c4=new Date(),_0x60285a=String(_0x9497c4[_0xe95f79(0xe2e)]())[_0xe95f79(0xdfe)](0x2,'0')+':'+String(_0x9497c4['getMinutes']())[_0xe95f79(0xdfe)](0x2,'0');if(characters&&characters['length']>0x0)for(const _0x420187 of characters){const _0x165b40=await getChatSettings(_0x420187['id']);_0x165b40['scheduledMomentsEnabled']&&_0x165b40['scheduledMomentsTimes']&&_0x165b40[_0xe95f79(0xb66)][_0xe95f79(0x1831)](_0x60285a)&&(console[_0xe95f79(0x2187)]('⏰\x20定时发布时间到：'+_0x420187['name']+'\x20在\x20'+_0x60285a+_0xe95f79(0x1b74)),await triggerBackgroundMoments(_0x420187['id'],!![]));}}function clearGlobalMomentsTimers(){const _0x589e5d=_0x211817;Object['values'](globalMomentsTimers)[_0x589e5d(0x19fb)](_0x288a50=>{if(_0x288a50)clearInterval(_0x288a50);}),globalMomentsTimers={},globalMomentsCheckInterval&&(clearInterval(globalMomentsCheckInterval),globalMomentsCheckInterval=null);}function getBackgroundInterval(_0x16a93d){const _0x41f6aa=_0x211817;switch(_0x16a93d){case _0x41f6aa(0x113f):return Math[_0x41f6aa(0x11a8)]()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;case _0x41f6aa(0x950):return Math[_0x41f6aa(0x11a8)]()*0x1e*0x3c*0x3e8+0x1e*0x3c*0x3e8;case _0x41f6aa(0x224d):return Math[_0x41f6aa(0x11a8)]()*0x14*0x3c*0x3e8+0xa*0x3c*0x3e8;default:return Math[_0x41f6aa(0x11a8)]()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;}}async function scheduleProactiveChatForCharacter(_0x5ef32c){const _0x585246=_0x211817;backgroundTimers[_0x5ef32c+_0x585246(0x1d3a)]&&(clearTimeout(backgroundTimers[_0x5ef32c+_0x585246(0x1d3a)]),delete backgroundTimers[_0x5ef32c+_0x585246(0x1d3a)]);const _0xe24929=characters[_0x585246(0xaf4)](_0x48c7e9=>_0x48c7e9['id']===_0x5ef32c);if(!_0xe24929){console[_0x585246(0x2187)](_0x585246(0x1ac1)+_0x5ef32c);return;}const _0x743483=await getAsyncChatSettings(_0x5ef32c),_0x61c153=_0x743483[_0x585246(0x4f2)]===!![],_0x5b4716=_0x743483[_0x585246(0x2ac)]===!![];console[_0x585246(0x2187)](_0x585246(0x942)+_0xe24929[_0x585246(0x1a1c)]+':',{'backgroundInteractionEnabled':_0x61c153,'backgroundChatEnabled':_0x5b4716});if(!_0x61c153||!_0x5b4716){console[_0x585246(0x2187)]('🚫\x20[定时器设置]\x20'+_0xe24929[_0x585246(0x1a1c)]+'\x20开关未开启，不设置定时器');return;}const _0x4c3339=chatMessages[_0x5ef32c]||[],_0x2d1a4e=_0x4c3339[_0x585246(0x6d5)]()['reverse']()[_0x585246(0xaf4)](_0x544aac=>_0x544aac['sender']===_0x585246(0x1e6d));if(!_0x2d1a4e){console['log'](_0x585246(0xce6)+_0xe24929['name']+_0x585246(0x198d));return;}const _0x51b9c1=Date[_0x585246(0x2eb)]()-_0x2d1a4e[_0x585246(0x1716)],_0x10e46c=0xa*0x3c*0x3e8;console['log'](_0x585246(0xcd0)+_0xe24929[_0x585246(0x1a1c)]+_0x585246(0x1da7)+Math[_0x585246(0x13e2)](_0x51b9c1/0xea60)+_0x585246(0x116b));let _0x1a501f;_0x51b9c1<_0x10e46c?(_0x1a501f=_0x10e46c-_0x51b9c1,console['log'](_0x585246(0x1a15)+_0xe24929[_0x585246(0x1a1c)]+_0x585246(0xe53)+Math[_0x585246(0x13e2)](_0x1a501f/0xea60)+_0x585246(0x12db))):(_0x1a501f=0x0,console[_0x585246(0x2187)](_0x585246(0x1a15)+_0xe24929[_0x585246(0x1a1c)]+_0x585246(0x11e7))),backgroundTimers[_0x5ef32c+_0x585246(0x1d3a)]=setTimeout(async()=>{const _0x3d3afa=_0x585246,_0x19ae2b=characters[_0x3d3afa(0xaf4)](_0x3b96c7=>_0x3b96c7['id']===_0x5ef32c);if(!_0x19ae2b)return;const _0x1b7bd3=await getAsyncChatSettings(_0x5ef32c),_0x6fa03a=_0x1b7bd3[_0x3d3afa(0x4f2)]===!![],_0x5dba7b=_0x1b7bd3[_0x3d3afa(0x2ac)]===!![];console['log'](_0x3d3afa(0x399)+_0x19ae2b[_0x3d3afa(0x1a1c)]+':',{'currentBackgroundInteractionEnabled':_0x6fa03a,'currentBackgroundChatEnabled':_0x5dba7b});if(!_0x6fa03a||!_0x5dba7b){console[_0x3d3afa(0x2187)]('🚫\x20[定时器执行]\x20'+_0x19ae2b[_0x3d3afa(0x1a1c)]+_0x3d3afa(0x1e27));return;}const _0x320a48=getBackgroundInterval(_0x1b7bd3['backgroundChatFrequency']||_0x3d3afa(0x113f));console[_0x3d3afa(0x2187)](_0x3d3afa(0x41a)+_0x19ae2b['name']+_0x3d3afa(0xe53)+Math[_0x3d3afa(0x13e2)](_0x320a48/0xea60)+'分钟后发送主动消息'),backgroundTimers[_0x5ef32c+_0x3d3afa(0x1d3a)]=setTimeout(()=>{triggerBackgroundChat(_0x5ef32c),scheduleProactiveChatForCharacter(_0x5ef32c);},_0x320a48);},_0x1a501f);}function onUserMessageSent(_0xe48790){const _0x3f0d8d=_0x211817,_0x4aa126=characters[_0x3f0d8d(0xaf4)](_0x23cc5f=>_0x23cc5f['id']===_0xe48790);console['log'](_0x3f0d8d(0x20ab)+_0x4aa126?.['name']+_0x3f0d8d(0x18de)),scheduleProactiveChatForCharacter(_0xe48790);}async function reinitializeProactiveChatTimers(){const _0x13d7be=_0x211817;console[_0x13d7be(0x2187)](_0x13d7be(0x169f));for(const _0x157148 of characters){try{const _0x4cd005=await getChatSettings(_0x157148['id']),_0x49a3c9=_0x4cd005[_0x13d7be(0x4f2)]===!![],_0xd49c0d=_0x4cd005[_0x13d7be(0x2ac)]===!![];if(_0x49a3c9&&_0xd49c0d){const _0x1ec063=chatMessages[_0x157148['id']]||[],_0x1e3da3=_0x1ec063[_0x13d7be(0x19fa)](_0x365090=>_0x365090[_0x13d7be(0x8a1)]===_0x13d7be(0x1e6d));_0x1e3da3?(await scheduleProactiveChatForCharacter(_0x157148['id']),console[_0x13d7be(0x2187)]('✅\x20'+_0x157148['name']+'\x20主动聊天定时器已重新设置')):console[_0x13d7be(0x2187)]('⏸️\x20'+_0x157148['name']+_0x13d7be(0x1000));}else console[_0x13d7be(0x2187)](_0x13d7be(0x151d)+_0x157148['name']+_0x13d7be(0x20b0));}catch(_0x5db350){console[_0x13d7be(0x174a)](_0x13d7be(0x1beb)+_0x157148[_0x13d7be(0x1a1c)]+_0x13d7be(0x1ed7),_0x5db350);}}console[_0x13d7be(0x2187)](_0x13d7be(0x606));}function getBackgroundMomentsInterval(_0xc12cfb){const _0x8f064=_0x211817;switch(_0xc12cfb){case'low':return Math[_0x8f064(0x11a8)]()*0x4*0x3c*0x3c*0x3e8+0x4*0x3c*0x3c*0x3e8;case _0x8f064(0x950):return Math[_0x8f064(0x11a8)]()*0x2*0x3c*0x3c*0x3e8+0x2*0x3c*0x3c*0x3e8;case _0x8f064(0x224d):return Math['random']()*0x3c*0x3c*0x3e8+0x3c*0x3c*0x3e8;default:return Math[_0x8f064(0x11a8)]()*0x4*0x3c*0x3c*0x3e8+0x4*0x3c*0x3c*0x3e8;}}async function triggerBackgroundChat(_0x166f8c,_0x42cfed=![]){const _0x115eb4=_0x211817;try{const _0x5b9deb=characters[_0x115eb4(0xaf4)](_0xe8f046=>_0xe8f046['id']===_0x166f8c);if(!_0x5b9deb){console['log']('🚫\x20[主动聊天]\x20角色不存在:\x20'+_0x166f8c);return;}const _0x4161eb=await getAsyncChatSettings(_0x166f8c),_0x37f6e2=_0x4161eb[_0x115eb4(0x4f2)]===!![],_0x118eb8=_0x4161eb[_0x115eb4(0x2ac)]===!![];console[_0x115eb4(0x2187)]('🔍\x20[主动聊天检查]\x20'+_0x5b9deb['name']+':',{'backgroundInteractionEnabled':_0x37f6e2,'backgroundChatEnabled':_0x118eb8,'skipTimeCheck':_0x42cfed});if(!_0x37f6e2||!_0x118eb8){console[_0x115eb4(0x2187)](_0x115eb4(0x17db)+_0x5b9deb[_0x115eb4(0x1a1c)]+_0x115eb4(0x74f));return;}if(!_0x42cfed){const _0x3336f5=chatMessages[_0x166f8c]||[],_0x54d382=_0x3336f5['slice']()['reverse']()['find'](_0x1099f6=>_0x1099f6[_0x115eb4(0x8a1)]==='sent');if(_0x54d382){const _0x113dbc=Date[_0x115eb4(0x2eb)]()-_0x54d382['timestamp'],_0x260bb7=0xa*0x3c*0x3e8;console[_0x115eb4(0x2187)](_0x115eb4(0x3c7)+_0x5b9deb['name']+':\x20距离用户最后回复\x20'+Math[_0x115eb4(0x13e2)](_0x113dbc/0xea60)+_0x115eb4(0x116b));if(_0x113dbc<_0x260bb7){console[_0x115eb4(0x2187)](_0x115eb4(0x17db)+_0x5b9deb[_0x115eb4(0x1a1c)]+_0x115eb4(0x1672)+Math[_0x115eb4(0x13e2)](_0x113dbc/0xea60)+'分钟前有回复');return;}const _0x14a21a=_0x3336f5['slice']()[_0x115eb4(0x16b0)]()['find'](_0x2456ab=>_0x2456ab['sender']===_0x115eb4(0xb11));if(_0x14a21a&&_0x14a21a[_0x115eb4(0x19ae)]){const _0x54d276=Date['now']()-_0x14a21a[_0x115eb4(0x1716)],_0x3fa98=getBackgroundInterval(_0x4161eb[_0x115eb4(0xd8d)]||_0x115eb4(0x113f));if(_0x54d276<_0x3fa98){console['log'](_0x5b9deb['name']+_0x115eb4(0xfbb)+Math[_0x115eb4(0x13e2)](_0x54d276/0xea60)+'分钟');return;}}}}else console[_0x115eb4(0x2187)](_0x5b9deb[_0x115eb4(0x1a1c)]+_0x115eb4(0x18a2));const _0x2632d6=_0x4161eb[_0x115eb4(0x2062)]||0x5,_0x338ef6=_0x4161eb[_0x115eb4(0xa62)]||0x3,_0x59f8f3=chatMessages[_0x166f8c]||[];let _0x1d5d5a;_0x59f8f3[_0x115eb4(0x19ee)]>0x0?_0x1d5d5a=calculateMessagesByRounds(_0x59f8f3,_0x2632d6):_0x1d5d5a=[];const _0x3f4d91=await getVisibleMomentsForCharacter(_0x166f8c,_0x338ef6);let _0x133fed='';_0x3f4d91[_0x115eb4(0x19ee)]>0x0&&(_0x133fed=_0x115eb4(0x2228),_0x3f4d91['forEach']((_0x474767,_0x146000)=>{const _0x5aa6de=_0x115eb4,_0x5cc6a3=_0x474767['authorId']===_0x5aa6de(0xa80)?'用户':_0x474767[_0x5aa6de(0x215c)];let _0x49979a='';if(_0x474767[_0x5aa6de(0x1716)]){const _0x2c172d=Date[_0x5aa6de(0x2eb)](),_0x310021=_0x2c172d-_0x474767[_0x5aa6de(0x1716)],_0x26d9e5=Math[_0x5aa6de(0x2180)](_0x310021/(0x3e8*0x3c)),_0x1c9377=Math['floor'](_0x310021/(0x3e8*0x3c*0x3c)),_0x3703f6=Math[_0x5aa6de(0x2180)](_0x310021/(0x3e8*0x3c*0x3c*0x18));if(_0x3703f6>0x0)_0x49979a='（'+_0x3703f6+_0x5aa6de(0x91c);else{if(_0x1c9377>0x0)_0x49979a='（'+_0x1c9377+'小时前发布）';else _0x26d9e5>0x0?_0x49979a='（'+_0x26d9e5+_0x5aa6de(0x9ae):_0x49979a=_0x5aa6de(0x20c5);}}const _0x57c18d=_0x5cc6a3+':\x20'+_0x474767['text']+_0x49979a+(_0x474767[_0x5aa6de(0x1135)]||'');_0x133fed+=_0x57c18d;}));let _0x3dd0d8='';_0x1d5d5a[_0x115eb4(0x19ee)]>0x0&&(_0x3dd0d8='\x0a\x0a最近的聊天记录：\x0a'+_0x1d5d5a[_0x115eb4(0x6a4)](_0x2d27c5=>{const _0x1f0e1b=_0x115eb4;if(_0x2d27c5[_0x1f0e1b(0x8a1)]===_0x1f0e1b(0x1e6d))return _0x1f0e1b(0x4ec)+_0x2d27c5[_0x1f0e1b(0x211c)];if(_0x2d27c5[_0x1f0e1b(0x8a1)]===_0x1f0e1b(0xb11))return _0x5b9deb[_0x1f0e1b(0x1a1c)]+'：'+_0x2d27c5[_0x1f0e1b(0x211c)];return'';})['filter'](Boolean)[_0x115eb4(0x122b)]('\x0a'));console['log']('🔍\x20[主动聊天调试]\x20'+_0x5b9deb[_0x115eb4(0x1a1c)]+':'),console[_0x115eb4(0x2187)](_0x115eb4(0x227e)+_0x59f8f3[_0x115eb4(0x19ee)]),console['log']('\x20\x20📊\x20最近消息数:\x20'+_0x1d5d5a[_0x115eb4(0x19ee)]),console[_0x115eb4(0x2187)](_0x115eb4(0x183d)+_0x3dd0d8[_0x115eb4(0x19ee)]);_0x1d5d5a[_0x115eb4(0x19ee)]>0x0&&(console[_0x115eb4(0x2187)](_0x115eb4(0x209c)+_0x1d5d5a[_0x1d5d5a[_0x115eb4(0x19ee)]-0x1][_0x115eb4(0x211c)]['substring'](0x0,0x32)+'...'),console[_0x115eb4(0x2187)](_0x115eb4(0x10ab),_0x3dd0d8));let _0x36d0ec='';_0x5b9deb[_0x115eb4(0x15e3)]&&_0x5b9deb['worldbook']['length']>0x0&&(_0x36d0ec='\x0a\x0a世界书信息：\x0a'+_0x5b9deb[_0x115eb4(0x15e3)][_0x115eb4(0x6a4)](_0x645a24=>_0x645a24['key']+':\x20'+_0x645a24[_0x115eb4(0x1ebc)])[_0x115eb4(0x122b)]('\x0a'));const _0x56fb06='你是'+_0x5b9deb[_0x115eb4(0x1a1c)]+'，你的人设如下：'+_0x5b9deb[_0x115eb4(0x1f0b)]+_0x36d0ec+'\x0a\x0a现在你要主动给用户发送一条消息。这条消息应该是：\x0a1.\x20严格符合你的人设和性格特点\x0a2.\x20自然、有趣、有互动性\x0a3.\x20可以是问候、分享、询问、关心等\x0a4.\x20不要过于正式，要像朋友间的日常聊天\x0a5.\x20**重要**：如果有聊天历史，必须仔细阅读并基于历史内容进行自然的延续或回应，绝对不要重复之前已经说过的内容\x0a6.\x20可以适当提及最近的动态内容，让对话更自然\x0a7.\x20考虑当前时间和情境，让消息更贴合实际\x0a8.\x20保持角色的一致性和连贯性\x0a9.\x20**禁止重复**：不要发送与聊天历史中相同或相似的消息内容'+_0x3dd0d8+_0x133fed+_0x115eb4(0x2ba),_0x3fcd72=await generateAIResponse(_0x56fb06,_0x5b9deb);if(_0x3fcd72&&_0x3fcd72[_0x115eb4(0x19d7)]()){const _0x11813c=await parseAiResponse(_0x3fcd72);!chatMessages[_0x166f8c]&&(chatMessages[_0x166f8c]=[]);for(let _0x2b2044=0x0;_0x2b2044<_0x11813c[_0x115eb4(0x19ee)];_0x2b2044++){const _0x207ce7=_0x11813c[_0x2b2044];let _0x102318;if(typeof _0x207ce7===_0x115eb4(0x28d)&&_0x207ce7!==null&&_0x207ce7[_0x115eb4(0x1a4b)]===_0x115eb4(0x21f)){console['log'](_0x115eb4(0x6bf),_0x207ce7);continue;}if(typeof _0x207ce7===_0x115eb4(0x28d)&&_0x207ce7!==null){if(_0x207ce7[_0x115eb4(0x1a4b)]==='voice_message')_0x102318={'id':(Date[_0x115eb4(0x2eb)]()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':_0x115eb4(0xb11),'type':_0x115eb4(0x13ed),'content':_0x207ce7[_0x115eb4(0x211c)],'timestamp':Date[_0x115eb4(0x2eb)]()+_0x2b2044*0x64};else{if(_0x207ce7[_0x115eb4(0x1a4b)]===_0x115eb4(0x1a36))_0x102318={'id':(Date['now']()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':_0x115eb4(0xb11),'type':_0x115eb4(0x1a36),'content':_0x207ce7[_0x115eb4(0x7c9)]||_0x115eb4(0xbb8),'imageDescription':_0x207ce7[_0x115eb4(0x7c9)],'timestamp':Date[_0x115eb4(0x2eb)]()+_0x2b2044*0x64};else{if(_0x207ce7['type']==='transfer')_0x102318={'id':(Date[_0x115eb4(0x2eb)]()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':_0x115eb4(0xb11),'type':'transfer','amount':_0x207ce7[_0x115eb4(0x2018)],'note':_0x207ce7[_0x115eb4(0x1814)],'timestamp':Date[_0x115eb4(0x2eb)]()+_0x2b2044*0x64};else{if(_0x207ce7['type']===_0x115eb4(0x11b3)){console[_0x115eb4(0x2187)](_0x115eb4(0x1342),_0x207ce7);const _0x36c443=getCurrentChatSettings(),_0x458f70=_0x36c443['myChatNickname']||'你',_0x3b6b99=_0x36c443[_0x115eb4(0x12e6)]||'';_0x102318={'id':(Date[_0x115eb4(0x2eb)]()+_0x2b2044)['toString'](),'sender':_0x115eb4(0x1744),'content':currentChatCharacter['name']+_0x115eb4(0xf90)+_0x458f70+_0x3b6b99,'timestamp':Date['now']()+_0x2b2044*0x64,'isPoke':!![]};}else{if(_0x207ce7[_0x115eb4(0x1a4b)]===_0x115eb4(0x172b)){const _0x15b35f=await findEmojiForAI(_0x207ce7[_0x115eb4(0x7c9)]);if(_0x15b35f){_0x102318={'id':(Date['now']()+_0x2b2044)['toString'](),'sender':'received','content':'','image':_0x15b35f[_0x115eb4(0x40f)],'isEmoji':!![],'emojiDescription':_0x15b35f[_0x115eb4(0x7c9)],'timestamp':Date[_0x115eb4(0x2eb)]()+_0x2b2044*0x64};if(_0x207ce7[_0x115eb4(0x1a1c)]){_0x102318[_0x115eb4(0x1a1c)]=_0x207ce7[_0x115eb4(0x1a1c)];const _0x4240a1=groupChats[_0x115eb4(0xaf4)](_0x40c2a6=>_0x40c2a6['id']===_0x166f8c);if(_0x4240a1&&_0x4240a1[_0x115eb4(0x12a6)]){const _0x380747=_0x4240a1[_0x115eb4(0x12a6)]['find'](_0x1dfb4c=>_0x1dfb4c['name']===_0x207ce7[_0x115eb4(0x1a1c)]);_0x380747&&(_0x102318['senderId']=_0x380747['id']);}}}else _0x102318={'id':(Date['now']()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':'received','content':_0x115eb4(0x1fab)+_0x207ce7[_0x115eb4(0x7c9)]+'\x22不存在]','timestamp':Date['now']()+_0x2b2044*0x64};}else{if(_0x207ce7[_0x115eb4(0x211c)]){let _0x9e2048;if(typeof _0x207ce7[_0x115eb4(0x211c)]===_0x115eb4(0x11b7))_0x9e2048=_0x207ce7['content'];else{if(Array[_0x115eb4(0x1496)](_0x207ce7[_0x115eb4(0x211c)])&&_0x207ce7['content'][_0x115eb4(0x19ee)]>0x0){const _0x5ddf54=_0x207ce7['content'][0x0];_0x5ddf54&&_0x5ddf54[_0x115eb4(0x1a4b)]===_0x115eb4(0x1378)&&_0x5ddf54['text']?_0x9e2048=_0x5ddf54[_0x115eb4(0x1378)]:_0x9e2048=_0x115eb4(0x1ced);}else{if(_0x207ce7[_0x115eb4(0x211c)]&&typeof _0x207ce7[_0x115eb4(0x211c)]===_0x115eb4(0x28d)){if(_0x207ce7['content'][_0x115eb4(0x1a1c)]&&typeof _0x207ce7['content'][_0x115eb4(0x1a1c)]===_0x115eb4(0x11b7)){if(_0x207ce7['content'][_0x115eb4(0x1a4b)]===_0x115eb4(0x16fc))_0x9e2048=_0x115eb4(0x1f42)+_0x207ce7[_0x115eb4(0x211c)][_0x115eb4(0x1a1c)];else _0x207ce7[_0x115eb4(0x211c)][_0x115eb4(0x1a4b)]===_0x115eb4(0x1fe3)?_0x9e2048=_0x115eb4(0x1f98)+_0x207ce7['content'][_0x115eb4(0x1a1c)]:_0x9e2048=_0x115eb4(0x65e)+_0x207ce7[_0x115eb4(0x211c)][_0x115eb4(0x1a1c)];}else _0x9e2048=_0x207ce7[_0x115eb4(0x211c)][_0x115eb4(0x1e8e)]||_0x207ce7['content'][_0x115eb4(0x1378)]||_0x115eb4(0x1ced);}else _0x9e2048=String(_0x207ce7['content']||'');}}_0x102318={'id':(Date['now']()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':'received','content':_0x9e2048,'timestamp':Date['now']()+_0x2b2044*0x64};}else{console[_0x115eb4(0x2187)](_0x115eb4(0x751),_0x207ce7);continue;}}}}}}}else{if(typeof _0x207ce7===_0x115eb4(0x11b7))_0x102318={'id':(Date[_0x115eb4(0x2eb)]()+_0x2b2044)[_0x115eb4(0x1878)](),'sender':_0x115eb4(0xb11),'content':_0x207ce7,'timestamp':Date[_0x115eb4(0x2eb)]()+_0x2b2044*0x64};else{console[_0x115eb4(0x2187)](_0x115eb4(0x223d),_0x207ce7);continue;}}_0x102318&&(_0x102318[_0x115eb4(0x19ae)]=!![],chatMessages[_0x166f8c][_0x115eb4(0x1cd6)](_0x102318));}try{const _0x165c48=[],_0x3f66d6=chatMessages[_0x166f8c][_0x115eb4(0x6d5)](-_0x11813c[_0x115eb4(0x19ee)]),_0x31a924=chatMessages[_0x166f8c][_0x115eb4(0x19ee)]-_0x11813c[_0x115eb4(0x19ee)];for(let _0x2285d1=0x0;_0x2285d1<_0x3f66d6[_0x115eb4(0x19ee)];_0x2285d1++){const _0x728bdc=_0x3f66d6[_0x2285d1],_0x29eaaf=_0x166f8c+_0x115eb4(0xdb2)+_0x728bdc[_0x115eb4(0x1716)]+'_'+Math[_0x115eb4(0x11a8)]()[_0x115eb4(0x1878)](0x24)[_0x115eb4(0x15fb)](0x2,0x9)+'_'+(_0x31a924+_0x2285d1);_0x165c48[_0x115eb4(0x1cd6)]({'id':_0x29eaaf,'characterId':_0x166f8c,'timestamp':_0x728bdc[_0x115eb4(0x1716)],'messageOrder':_0x31a924+_0x2285d1,'originalMessageId':_0x728bdc['id'],'messageData':_0x728bdc});}await db[_0x115eb4(0x19a2)][_0x115eb4(0x2a3)](_0x165c48),console[_0x115eb4(0x2187)](_0x115eb4(0x157a)+_0x3f66d6[_0x115eb4(0x19ee)]+_0x115eb4(0x1602));}catch(_0x129d5c){console[_0x115eb4(0x174a)](_0x115eb4(0x703),_0x129d5c);try{await saveChatMessagesImmediate([_0x166f8c]),console['log'](_0x115eb4(0x1799));}catch(_0x2d6b33){console[_0x115eb4(0x174a)](_0x115eb4(0x10cc),_0x2d6b33);}}console[_0x115eb4(0x2187)](_0x115eb4(0x11d5)+_0x5b9deb['name']+_0x115eb4(0x677)+_0x11813c[_0x115eb4(0x19ee)]+_0x115eb4(0x197b)),setTimeout(async()=>{const _0x3a614a=_0x115eb4;try{for(let _0xb64465=0x0;_0xb64465<_0x11813c[_0x3a614a(0x19ee)];_0xb64465++){const _0x1fbb79=_0x11813c[_0xb64465];let _0x2b75eb='';if(typeof _0x1fbb79===_0x3a614a(0x11b7))_0x2b75eb=_0x1fbb79;else{if(typeof _0x1fbb79===_0x3a614a(0x28d)&&_0x1fbb79[_0x3a614a(0x211c)])_0x2b75eb=_0x1fbb79[_0x3a614a(0x211c)];else{if(typeof _0x1fbb79===_0x3a614a(0x28d)&&_0x1fbb79[_0x3a614a(0x1a4b)]===_0x3a614a(0x13ed))_0x2b75eb=_0x1fbb79[_0x3a614a(0x211c)];else{if(typeof _0x1fbb79===_0x3a614a(0x28d)&&_0x1fbb79[_0x3a614a(0x1a4b)]===_0x3a614a(0x78a))_0x2b75eb=_0x3a614a(0xe3f)+_0x1fbb79[_0x3a614a(0x2018)]+(_0x1fbb79['note']?_0x3a614a(0x1811)+_0x1fbb79[_0x3a614a(0x1814)]:'');else{if(typeof _0x1fbb79===_0x3a614a(0x28d)&&_0x1fbb79[_0x3a614a(0x1a4b)]==='poke')_0x2b75eb=_0x3a614a(0x138b);else typeof _0x1fbb79===_0x3a614a(0x28d)&&_0x1fbb79['type']===_0x3a614a(0x172b)&&(_0x2b75eb=_0x3a614a(0x66c)+_0x1fbb79[_0x3a614a(0x7c9)]);}}}}_0x2b75eb&&(await recordCrossAppEvent(_0x166f8c,_0x3a614a(0x1a70),_0x3a614a(0x271),{'id':_0x166f8c,'type':'private_chat','sender':'ai','content':_0x2b75eb,'chatType':_0x3a614a(0xdf3),'isProactive':!![]}),console[_0x3a614a(0x2187)]('🔥\x20[主动聊天]\x20已记录时间线事件\x20-\x20角色:\x20'+_0x5b9deb[_0x3a614a(0x1a1c)]+_0x3a614a(0x1f73)+_0x2b75eb[_0x3a614a(0x17ca)](0x0,0x32)+_0x3a614a(0x1520)));}}catch(_0xbec064){console['error']('🔥\x20[主动聊天]\x20记录时间线事件失败:',_0xbec064);}},0x3e8),currentChatCharacter&&currentChatCharacter['id']===_0x166f8c&&renderChatMessages(_0x166f8c),renderMessageList();}}catch(_0x221598){console['error'](_0x115eb4(0x227b),_0x221598);}}async function testActiveChat(){const _0x5a7d90=_0x211817;if(!currentChatCharacter){showToast('请先选择一个聊天角色','error');return;}console[_0x5a7d90(0x2187)]('🧪\x20测试主动聊天功能\x20-\x20角色:\x20'+currentChatCharacter[_0x5a7d90(0x1a1c)]),showToast(_0x5a7d90(0x76b)+currentChatCharacter[_0x5a7d90(0x1a1c)]+'\x20的主动聊天功能...',_0x5a7d90(0x477));try{const _0x4670c9=(chatMessages[currentChatCharacter['id']]||[])['length'];console[_0x5a7d90(0x2187)](_0x5a7d90(0x2131)+_0x4670c9),await triggerBackgroundChat(currentChatCharacter['id'],!![]);const _0x225b75=(chatMessages[currentChatCharacter['id']]||[])[_0x5a7d90(0x19ee)];console[_0x5a7d90(0x2187)](_0x5a7d90(0x92f)+_0x225b75),_0x225b75>_0x4670c9?showToast(_0x5a7d90(0x20c7),_0x5a7d90(0x11cb)):showToast(_0x5a7d90(0x8a5),_0x5a7d90(0x1816));}catch(_0x47688e){console[_0x5a7d90(0x174a)](_0x5a7d90(0x1936),_0x47688e),showToast('主动聊天测试失败:\x20'+_0x47688e[_0x5a7d90(0x1e8e)],'error');}}async function testActiveMoments(){const _0x1378ff=_0x211817;if(!currentChatCharacter){showToast(_0x1378ff(0xe7e),_0x1378ff(0x174a));return;}console[_0x1378ff(0x2187)](_0x1378ff(0xe6a)+currentChatCharacter[_0x1378ff(0x1a1c)]),showToast(_0x1378ff(0x76b)+currentChatCharacter[_0x1378ff(0x1a1c)]+_0x1378ff(0x6f3),_0x1378ff(0x477));try{const _0x1f9adc=await getRecentMoments(0x32),_0x133166=_0x1f9adc['length'];console[_0x1378ff(0x2187)](_0x1378ff(0x140b)+_0x133166),await triggerBackgroundMoments(currentChatCharacter['id'],!![]);const _0x64e84=await getRecentMoments(0x32),_0x59bc37=_0x64e84['length'];console[_0x1378ff(0x2187)](_0x1378ff(0x9c3)+_0x59bc37),_0x59bc37>_0x133166?showToast('主动发动态测试成功！已发布新动态','success'):showToast(_0x1378ff(0x10b1),_0x1378ff(0x1816));}catch(_0x2439f7){console['error'](_0x1378ff(0x2028),_0x2439f7),showToast(_0x1378ff(0x110c)+_0x2439f7['message'],_0x1378ff(0x174a));}}function checkBackgroundTimers(){const _0x23ee2c=_0x211817;console[_0x23ee2c(0x2187)](_0x23ee2c(0x1b65)),console[_0x23ee2c(0x2187)](_0x23ee2c(0x1b52),backgroundTimers);const _0x488f07=Object[_0x23ee2c(0x1c9f)](backgroundTimers)[_0x23ee2c(0x19ee)];console['log']('活跃定时器数量:\x20'+_0x488f07);if(_0x488f07===0x0)console[_0x23ee2c(0x2187)]('⚠️\x20没有活跃的后台定时器'),console[_0x23ee2c(0x2187)](_0x23ee2c(0x1f79));else for(const [_0x126cf4,_0x2dd602]of Object[_0x23ee2c(0x2bc)](backgroundTimers)){console[_0x23ee2c(0x2187)]('-\x20'+_0x126cf4+':\x20'+(_0x2dd602?_0x23ee2c(0x1276):'已停止'));}showToast('当前有\x20'+_0x488f07+_0x23ee2c(0x57f),_0x23ee2c(0x477));}async function restartBackgroundSystem(){const _0x5818c7=_0x211817;console[_0x5818c7(0x2187)](_0x5818c7(0x1c27)),await initGlobalBackgroundInteractionSystem(),checkBackgroundTimers();}function pauseProactiveChatTimer(_0x56850b){const _0x3acba1=_0x211817,_0x31adc2=_0x56850b+_0x3acba1(0x1d3a);backgroundTimers[_0x31adc2]&&(clearTimeout(backgroundTimers[_0x31adc2]),backgroundTimers[_0x31adc2+'_paused']=!![],delete backgroundTimers[_0x31adc2],console[_0x3acba1(0x2187)]('⏸️\x20已暂停角色\x20'+characters[_0x3acba1(0xaf4)](_0x2a1b2b=>_0x2a1b2b['id']===_0x56850b)?.['name']+_0x3acba1(0x16ae)));}function resumeProactiveChatTimer(_0x47db6a){const _0x23b2ec=_0x211817,_0x57fbfc=_0x47db6a+'_chat_paused';backgroundTimers[_0x57fbfc]&&(delete backgroundTimers[_0x57fbfc],scheduleProactiveChatForCharacter(_0x47db6a),console['log'](_0x23b2ec(0x828)+characters[_0x23b2ec(0xaf4)](_0x2f353b=>_0x2f353b['id']===_0x47db6a)?.[_0x23b2ec(0x1a1c)]+_0x23b2ec(0x16ae)));}window[_0x211817(0x46c)]=reinitializeProactiveChatTimers,window[_0x211817(0x4c1)]=testActiveChat,window[_0x211817(0x14f3)]=testActiveMoments,window[_0x211817(0x857)]=checkBackgroundTimers,window[_0x211817(0x597)]=initGlobalBackgroundInteractionSystem,window[_0x211817(0x1577)]=restartBackgroundSystem,window['triggerPublisherReplyToComments']=triggerPublisherReplyToComments,window['testPublisherReply']=async function(_0x58f9cd){const _0x450d7d=_0x211817;try{console[_0x450d7d(0x2187)](_0x450d7d(0x20b5));const _0xe3a7d8=typeof _0x58f9cd==='string'?parseInt(_0x58f9cd):_0x58f9cd;console['log'](_0x450d7d(0x1b60)+_0xe3a7d8+_0x450d7d(0x13c9)+_0x58f9cd+')');const _0x20104d=await db['moments']['get'](_0xe3a7d8);if(!_0x20104d){console[_0x450d7d(0x174a)]('❌\x20未找到动态:',_0xe3a7d8);const _0x283419=await db['moments'][_0x450d7d(0xf13)]();console[_0x450d7d(0x2187)](_0x450d7d(0xe3b),_0x283419[_0x450d7d(0x6a4)](_0x3ea8c8=>_0x3ea8c8['id']+'\x20('+typeof _0x3ea8c8['id']+')'));return;}const _0x376622=characters['find'](_0x41dd60=>_0x41dd60['id']===_0x20104d[_0x450d7d(0xaf5)]);if(!_0x376622){console[_0x450d7d(0x174a)](_0x450d7d(0x11ac),_0x20104d[_0x450d7d(0xaf5)]),console[_0x450d7d(0x2187)](_0x450d7d(0x85e),characters[_0x450d7d(0x6a4)](_0x31b149=>_0x31b149['name']+_0x450d7d(0x1d3e)+_0x31b149['id']+')'));return;}console[_0x450d7d(0x2187)]('📝\x20测试动态:\x20'+_0x20104d['text']),console[_0x450d7d(0x2187)](_0x450d7d(0x3b7)+_0x376622[_0x450d7d(0x1a1c)]+_0x450d7d(0x1d3e)+_0x376622['id']+')'),await triggerPublisherReplyToComments(_0xe3a7d8,_0x376622),console[_0x450d7d(0x2187)](_0x450d7d(0xa19));}catch(_0x12f62b){console['error'](_0x450d7d(0x3f3),_0x12f62b);}},window['listRecentMoments']=async function(){const _0x2d29bf=_0x211817;try{const _0x3ecb49=await db[_0x2d29bf(0x9c7)]['orderBy'](_0x2d29bf(0x1716))[_0x2d29bf(0x16b0)]()[_0x2d29bf(0x163e)](0xa)['toArray']();console[_0x2d29bf(0x2187)](_0x2d29bf(0x124d)),_0x3ecb49[_0x2d29bf(0x19fb)]((_0x3255a3,_0x2fed50)=>{const _0xfb70e7=_0x2d29bf;console[_0xfb70e7(0x2187)](_0x2fed50+0x1+'.\x20ID:\x20'+_0x3255a3['id']+_0xfb70e7(0x9c8)+_0x3255a3[_0xfb70e7(0x215c)]+_0xfb70e7(0xea6)+_0x3255a3[_0xfb70e7(0x1378)][_0xfb70e7(0x17ca)](0x0,0x1e)+_0xfb70e7(0x1520));}),console[_0x2d29bf(0x2187)](_0x2d29bf(0x80b)),console[_0x2d29bf(0x2187)](_0x2d29bf(0x1126));}catch(_0x46c787){console['error']('❌\x20获取动态列表失败:',_0x46c787);}},window['forcePublisherReply']=async function(_0x3b0a2a){const _0x2352e9=_0x211817;try{console['log']('🧪\x20强制发布者回复测试...');const _0x16cb41=typeof _0x3b0a2a===_0x2352e9(0x11b7)?parseInt(_0x3b0a2a):_0x3b0a2a,_0x3e1a0f=await db[_0x2352e9(0x9c7)][_0x2352e9(0xb78)](_0x16cb41);if(!_0x3e1a0f){console['error'](_0x2352e9(0xd83),_0x16cb41);return;}const _0x4c08fa=characters[_0x2352e9(0xaf4)](_0x47b4b9=>_0x47b4b9['id']===_0x3e1a0f[_0x2352e9(0xaf5)]);if(!_0x4c08fa){console[_0x2352e9(0x174a)]('❌\x20未找到发布者角色:',_0x3e1a0f[_0x2352e9(0xaf5)]);return;}const _0x5f1cc2=await db[_0x2352e9(0x17d5)][_0x2352e9(0xa24)](_0x2352e9(0x9ba))[_0x2352e9(0x1694)](_0x16cb41)[_0x2352e9(0xf13)](),_0x33b995=_0x5f1cc2[_0x2352e9(0x1e1f)](_0x59bdde=>_0x59bdde['authorId']!==_0x4c08fa['id']&&_0x59bdde[_0x2352e9(0x22d2)]!==_0x2352e9(0xa80)&&_0x59bdde[_0x2352e9(0x22d2)]);if(_0x33b995['length']===0x0){console['log'](_0x2352e9(0x455));return;}const _0x523cc8=_0x33b995[Math['floor'](Math[_0x2352e9(0x11a8)]()*_0x33b995[_0x2352e9(0x19ee)])];console['log'](_0x2352e9(0x18df)+_0x4c08fa['name']+'\x20回复\x20'+_0x523cc8[_0x2352e9(0x215c)]+_0x2352e9(0x964));const _0x5438ab=await generatePublisherReply(_0x4c08fa,_0x523cc8,_0x16cb41);if(_0x5438ab){const _0x2a5424={'id':Date['now']()+Math[_0x2352e9(0x11a8)](),'nickname':_0x4c08fa[_0x2352e9(0x1a1c)],'avatar':_0x4c08fa[_0x2352e9(0x1994)],'text':_0x5438ab,'time':formatTime(new Date()),'timestamp':Date[_0x2352e9(0x2eb)](),'characterId':_0x4c08fa['id'],'replyTo':_0x523cc8['nickname']};await saveCommentToMoment(_0x16cb41,_0x2a5424),await updateMomentCommentCount(_0x16cb41),displayCommentUnderMoment(_0x16cb41,_0x2a5424),console[_0x2352e9(0x2187)](_0x2352e9(0x26d)+_0x5438ab+'\x22');}else console['log']('❌\x20生成回复失败');}catch(_0x46dac1){console[_0x2352e9(0x174a)]('❌\x20强制回复测试失败:',_0x46dac1);}};async function triggerBackgroundMomentsTest(_0x1e93bf){await triggerBackgroundMoments(_0x1e93bf,!![]);}async function triggerBackgroundMoments(_0x349f7d,_0x3f7f10=![]){const _0x122315=_0x211817;try{const _0x4228b1=characters[_0x122315(0xaf4)](_0xba5add=>_0xba5add['id']===_0x349f7d);if(!_0x4228b1)return;if(!_0x3f7f10){const _0x3e9982=_0x4228b1[_0x122315(0x1fda)]||0x0,_0x2dc583=0x1e*0x3c*0x3e8;if(Date['now']()-_0x3e9982<_0x2dc583)return;}else{}const _0x334c95=getCurrentChatSettings(),_0x31d1ba=chatMessages[_0x349f7d]||[],_0x2c2e0a=_0x334c95[_0x122315(0x2062)]||0x5,_0xb127f5=_0x31d1ba[_0x122315(0x6d5)](-_0x2c2e0a),_0x182016=await getVisibleMomentsForCharacter(_0x349f7d,0x5);let _0x2022e6='';_0xb127f5[_0x122315(0x19ee)]>0x0&&(_0x2022e6='\x0a\x0a最近的聊天记录：\x0a'+_0xb127f5[_0x122315(0x6a4)](_0x2e2ae6=>{const _0x4a3b59=_0x122315;if(_0x2e2ae6['sender']===_0x4a3b59(0x1e6d))return _0x4a3b59(0x4ec)+_0x2e2ae6[_0x4a3b59(0x211c)];if(_0x2e2ae6[_0x4a3b59(0x8a1)]==='received')return _0x4228b1['name']+'：'+_0x2e2ae6[_0x4a3b59(0x211c)];return'';})['filter'](Boolean)[_0x122315(0x122b)]('\x0a'));let _0x565406='';_0x182016[_0x122315(0x19ee)]>0x0&&(_0x565406=_0x122315(0x2228),_0x182016[_0x122315(0x19fb)]((_0xd52f,_0x5f46f4)=>{const _0x5f412e=_0x122315,_0x569439=_0xd52f[_0x5f412e(0x22d2)]===_0x5f412e(0xa80)?'用户':_0xd52f['nickname'];let _0x563c0f='';if(_0xd52f[_0x5f412e(0x1716)]){const _0x14d5cc=Date['now'](),_0x5748a1=_0x14d5cc-_0xd52f[_0x5f412e(0x1716)],_0x460b8c=Math[_0x5f412e(0x2180)](_0x5748a1/(0x3e8*0x3c)),_0x1520d2=Math[_0x5f412e(0x2180)](_0x5748a1/(0x3e8*0x3c*0x3c)),_0x3203ad=Math['floor'](_0x5748a1/(0x3e8*0x3c*0x3c*0x18));if(_0x3203ad>0x0)_0x563c0f='（'+_0x3203ad+'天前发布）';else{if(_0x1520d2>0x0)_0x563c0f='（'+_0x1520d2+_0x5f412e(0x2281);else _0x460b8c>0x0?_0x563c0f='（'+_0x460b8c+_0x5f412e(0x9ae):_0x563c0f=_0x5f412e(0x20c5);}}const _0x3a6ac3=_0x569439+':\x20'+_0xd52f['text']+_0x563c0f+(_0xd52f[_0x5f412e(0x1135)]||'');_0x565406+=_0x3a6ac3;}));const _0x20cbeb='你是'+_0x4228b1[_0x122315(0x1a1c)]+'，你的人设如下：'+_0x4228b1[_0x122315(0x1f0b)]+_0x122315(0xfc0)+_0x2022e6+_0x565406+_0x122315(0xeb9),_0x5d752f=await generateAIResponse(_0x20cbeb,_0x4228b1);if(_0x5d752f&&_0x5d752f[_0x122315(0x19d7)]()){let _0xaceda5=_0x5d752f[_0x122315(0x19d7)]();if(_0xaceda5[_0x122315(0x1b30)]('[')||_0xaceda5[_0x122315(0x1b30)]('{'))try{const _0x449a7f=JSON[_0x122315(0x22d3)](_0xaceda5);console['log'](_0x4228b1[_0x122315(0x1a1c)]+_0x122315(0x2115),_0x449a7f);if(Array[_0x122315(0x1496)](_0x449a7f)&&_0x449a7f[_0x122315(0x19ee)]>0x0)_0xaceda5=_0x449a7f[_0x122315(0x6a4)](_0x499bab=>{const _0x571b75=_0x122315;if(typeof _0x499bab==='string')return _0x499bab[_0x571b75(0x19d7)]();else{if(typeof _0x499bab===_0x571b75(0x28d)&&_0x499bab[_0x571b75(0x211c)])return _0x499bab['content']['trim']();else{if(typeof _0x499bab===_0x571b75(0x28d)&&_0x499bab[_0x571b75(0x1378)])return _0x499bab[_0x571b75(0x1378)]['trim']();}}return'';})[_0x122315(0x1e1f)](_0x227641=>_0x227641)[_0x122315(0x122b)]('\x0a');else typeof _0x449a7f===_0x122315(0x28d)&&(_0xaceda5=_0x449a7f['content']||_0x449a7f['text']||_0x449a7f[_0x122315(0x1e8e)]||JSON[_0x122315(0x6b8)](_0x449a7f));console[_0x122315(0x2187)](_0x4228b1[_0x122315(0x1a1c)]+_0x122315(0x20d1),_0xaceda5);}catch(_0x2feb4a){console[_0x122315(0x2187)](_0x4228b1[_0x122315(0x1a1c)]+_0x122315(0xd8b)),_0xaceda5=_0x5d752f[_0x122315(0x19d7)]();}_0xaceda5=_0xaceda5[_0x122315(0xe16)](/^```[\s\S]*?\n/,'')['replace'](/\n```$/,'')[_0x122315(0xe16)](/^\*\*动态内容\*\*:?\s*/i,'')['replace'](/^动态内容:?\s*/i,'')['trim']();if(_0xaceda5){const _0x571302=getCharacterAvatar(_0x4228b1),_0x2c89b8={'id':Date['now'](),'authorId':_0x349f7d,'nickname':_0x4228b1['name'],'avatar':_0x571302,'text':_0xaceda5,'time':formatTime(new Date()),'timestamp':Date[_0x122315(0x2eb)](),'characterId':_0x349f7d};await db[_0x122315(0x9c7)][_0x122315(0x21e2)](_0x2c89b8),_0x4228b1[_0x122315(0x22be)]&&await db[_0x122315(0x367)][_0x122315(0x21e2)]({'momentId':_0x2c89b8['id'],'visibility':_0x122315(0x1e04),'visibleGroups':[_0x4228b1[_0x122315(0x22be)]],'timestamp':new Date()}),createPushNotification(_0x4228b1,_0x122315(0x5b7)+(_0xaceda5[_0x122315(0x19ee)]>0xf?_0xaceda5[_0x122315(0x17ca)](0x0,0xf)+_0x122315(0x1520):_0xaceda5),0x1f4),_0x4228b1['lastMomentTime']=Date[_0x122315(0x2eb)](),saveCharacters(),setTimeout(()=>{loadMoments();},0x64),setTimeout(()=>{const _0x141d55=_0x122315;triggerAIInteractions(_0x2c89b8['id'],_0x141d55(0x7e3));},0x7d0+Math['random']()*0xbb8),setTimeout(()=>{const _0x4b79db=_0x122315;triggerAIInteractions(_0x2c89b8['id'],_0x4b79db(0x945));},0x1388+Math[_0x122315(0x11a8)]()*0x1388);}}}catch(_0x59b1fa){console[_0x122315(0x174a)]('后台发动态失败:',_0x59b1fa);}}async function getRecentMoments(_0x59583c=0x5){const _0x4cf238=_0x211817;try{const _0xb927e9=await db['moments'][_0x4cf238(0xe30)](_0x4cf238(0x1716))[_0x4cf238(0x16b0)]()[_0x4cf238(0x163e)](_0x59583c)[_0x4cf238(0xf13)]();return _0xb927e9||[];}catch(_0x262ce5){return console['error'](_0x4cf238(0xd69),_0x262ce5),[];}}async function getVisibleMomentsForCharacter(_0x154595,_0x3496ea=0x5){const _0xbcad=_0x211817;try{const _0x3009fd=await db[_0xbcad(0x9c7)][_0xbcad(0xe30)](_0xbcad(0x1716))[_0xbcad(0x16b0)]()['limit'](_0x3496ea*0x3)[_0xbcad(0xf13)](),_0x28ec4b=[],_0x26506e=characters['find'](_0x2ab5a6=>_0x2ab5a6['id']===_0x154595);for(const _0x1904a2 of _0x3009fd){if(_0x28ec4b[_0xbcad(0x19ee)]>=_0x3496ea)break;const _0x39e3a0=await checkMomentVisibilityForCharacter(_0x1904a2['id'],_0x154595);if(!_0x39e3a0)continue;if(_0x1904a2[_0xbcad(0x22d2)]==='user'){const _0x3a57c8=await enrichMomentWithComments(_0x1904a2,_0x154595);_0x28ec4b[_0xbcad(0x1cd6)](_0x3a57c8);continue;}if(_0x1904a2[_0xbcad(0x22d2)]===_0x154595||_0x1904a2['characterId']===_0x154595){const _0x46ca71=await enrichMomentWithComments(_0x1904a2,_0x154595);_0x28ec4b[_0xbcad(0x1cd6)](_0x46ca71);continue;}if(_0x26506e&&_0x1904a2[_0xbcad(0xaf5)]){const _0x515a36=characters[_0xbcad(0xaf4)](_0x557566=>_0x557566['id']===_0x1904a2[_0xbcad(0xaf5)]);if(_0x515a36&&areCharactersInSameGroup(_0x26506e,_0x515a36)){const _0x5b6e43=await enrichMomentWithComments(_0x1904a2,_0x154595);_0x28ec4b[_0xbcad(0x1cd6)](_0x5b6e43);continue;}}}return _0x28ec4b;}catch(_0x1e81f1){return console[_0xbcad(0x174a)]('获取角色可见动态失败:',_0x1e81f1),[];}}async function enrichMomentWithComments(_0x21d067,_0xa96d1a){const _0x1dce6d=_0x211817;try{const _0x3a24a1=await db[_0x1dce6d(0x17d5)][_0x1dce6d(0xa24)](_0x1dce6d(0x9ba))[_0x1dce6d(0x1694)](_0x21d067['id'])[_0x1dce6d(0xf13)]();_0x3a24a1[_0x1dce6d(0x1104)]((_0x1ce956,_0x5c6fe6)=>_0x1ce956['timestamp']-_0x5c6fe6[_0x1dce6d(0x1716)]);const _0x3aa0da=[],_0x2a4d05=characters[_0x1dce6d(0xaf4)](_0x2b7dfd=>_0x2b7dfd['id']===_0xa96d1a);for(const _0x34606a of _0x3a24a1){if(_0x34606a[_0x1dce6d(0x22d2)]===_0x1dce6d(0xa80)){_0x3aa0da[_0x1dce6d(0x1cd6)](_0x34606a);continue;}if(_0x34606a[_0x1dce6d(0x22d2)]===_0xa96d1a){_0x3aa0da[_0x1dce6d(0x1cd6)](_0x34606a);continue;}if(_0x2a4d05&&_0x34606a[_0x1dce6d(0x22d2)]){const _0x23a740=characters[_0x1dce6d(0xaf4)](_0x426847=>_0x426847['id']===_0x34606a[_0x1dce6d(0x22d2)]);_0x23a740&&areCharactersInSameGroup(_0x2a4d05,_0x23a740)&&_0x3aa0da[_0x1dce6d(0x1cd6)](_0x34606a);}}let _0x48a1a3='';return _0x3aa0da[_0x1dce6d(0x19ee)]>0x0&&(_0x48a1a3=_0x1dce6d(0xaa1),_0x3aa0da[_0x1dce6d(0x19fb)]((_0x1556ed,_0x3dffd5)=>{const _0x1d6c60=_0x1dce6d,_0x2e0557=_0x1556ed['authorId']===_0x1d6c60(0xa80)?'用户':_0x1556ed[_0x1d6c60(0x215c)];_0x48a1a3+='\x20\x20'+(_0x3dffd5+0x1)+'.\x20'+_0x2e0557+':\x20'+_0x1556ed[_0x1d6c60(0x1378)]+'\x0a';})),{..._0x21d067,'commentsText':_0x48a1a3,'commentsCount':_0x3aa0da['length'],'visibleComments':_0x3aa0da};}catch(_0x5022c3){return console['error'](_0x1dce6d(0xaff),_0x5022c3),{..._0x21d067,'commentsText':'','commentsCount':0x0,'visibleComments':[]};}}async function checkMomentVisibilityForCharacter(_0x5cf0bb,_0x12e0fb){const _0x23aa89=_0x211817;try{const _0x483f8a=await db[_0x23aa89(0x367)][_0x23aa89(0xa24)]('momentId')[_0x23aa89(0x1694)](_0x5cf0bb)[_0x23aa89(0x1a7b)]();if(!_0x483f8a)return!![];const {visibility:_0x20d567,visibleGroups:_0x51c256}=_0x483f8a;if(_0x20d567===_0x23aa89(0x88e))return!![];if(_0x20d567===_0x23aa89(0x9db)){const _0x34f2fc=await db[_0x23aa89(0x9c7)]['get'](_0x5cf0bb),_0x55c0c5=_0x34f2fc&&(_0x34f2fc[_0x23aa89(0x22d2)]===_0x12e0fb||_0x34f2fc[_0x23aa89(0xaf5)]===_0x12e0fb);return _0x55c0c5;}if(_0x20d567==='partial'){const _0x697fba=characters[_0x23aa89(0xaf4)](_0x1e264b=>_0x1e264b['id']===_0x12e0fb);if(!_0x697fba||!_0x697fba[_0x23aa89(0x22be)])return![];const _0x1706aa=_0x51c256[_0x23aa89(0x1831)](_0x697fba[_0x23aa89(0x22be)]);return _0x1706aa;}return![];}catch(_0x3d725d){return console[_0x23aa89(0x174a)](_0x23aa89(0x88b),_0x3d725d),!![];}}function areCharactersInSameGroup(_0x5a289f,_0x5f5594){const _0x2ebb1f=_0x211817;if(_0x5a289f[_0x2ebb1f(0x22be)]&&_0x5f5594[_0x2ebb1f(0x22be)]&&_0x5a289f[_0x2ebb1f(0x22be)]===_0x5f5594[_0x2ebb1f(0x22be)])return!![];return contacts[_0x2ebb1f(0x1831)](_0x5a289f['id'])&&contacts[_0x2ebb1f(0x1831)](_0x5f5594['id']);}async function generateAIResponse(_0x3ba26e,_0x253828){const _0x2780ad=_0x211817;try{const _0x54132b=await callChatAPI(_0x3ba26e,_0x253828);return _0x54132b;}catch(_0x1aff6d){return console['error'](_0x2780ad(0x1c07),_0x1aff6d),null;}}function isValidAvatarUrl(_0x46a319){const _0x37c3b9=_0x211817;if(!_0x46a319||typeof _0x46a319!=='string')return![];if(_0x46a319['startsWith'](_0x37c3b9(0x158e))){const _0x505f04=_0x46a319[_0x37c3b9(0x204b)](',');if(_0x505f04[_0x37c3b9(0x19ee)]!==0x2)return console[_0x37c3b9(0x1f43)](_0x37c3b9(0x1060),_0x46a319[_0x37c3b9(0x17ca)](0x0,0x32)+'...'),![];const _0x2489bf=_0x505f04[0x0],_0x26b420=_0x505f04[0x1];if(!_0x2489bf[_0x37c3b9(0x1831)]('data:image/')||!_0x2489bf[_0x37c3b9(0x1831)](_0x37c3b9(0x3e5)))return console[_0x37c3b9(0x1f43)](_0x37c3b9(0x1e18),_0x2489bf),![];if(!_0x26b420||_0x26b420[_0x37c3b9(0x19ee)]<0x32)return console[_0x37c3b9(0x1f43)](_0x37c3b9(0x187),_0x26b420[_0x37c3b9(0x19ee)]),![];_0x26b420[_0x37c3b9(0x19ee)]>0x1e8480&&console[_0x37c3b9(0x1f43)](_0x37c3b9(0x9b4),_0x26b420['length'],'建议压缩后重新上传以提高性能');const _0x579822=/^[A-Za-z0-9+/]*={0,2}$/;if(!_0x579822[_0x37c3b9(0x11b8)](_0x26b420))return console[_0x37c3b9(0x1f43)](_0x37c3b9(0xa0f)),![];return!![];}if(_0x46a319[_0x37c3b9(0x1b30)](_0x37c3b9(0x4fa))||_0x46a319[_0x37c3b9(0x1b30)](_0x37c3b9(0x797)))try{return new URL(_0x46a319),!![];}catch(_0x34127a){return console[_0x37c3b9(0x1f43)](_0x37c3b9(0x1b5c),_0x46a319),![];}return console[_0x37c3b9(0x1f43)](_0x37c3b9(0xe2f),_0x46a319['substring'](0x0,0x32)+_0x37c3b9(0x1520)),![];}function getCharacterAvatar(_0xd49bc0){const _0x461d98=_0x211817,_0x32abeb=getChatSettingsSync(_0xd49bc0['id']);if(_0x32abeb['aiChatAvatar']&&_0x32abeb[_0x461d98(0x179f)][_0x461d98(0x19d7)]()){const _0x156f16=_0x32abeb[_0x461d98(0x179f)];if(isValidAvatarUrl(_0x156f16))return _0x156f16;else console[_0x461d98(0x1f43)]('角色'+_0xd49bc0[_0x461d98(0x1a1c)]+_0x461d98(0x175a));}if(_0xd49bc0[_0x461d98(0x1994)]&&_0xd49bc0[_0x461d98(0x1994)][_0x461d98(0x19d7)]()){const _0x4791b4=_0xd49bc0['avatarUrl'];if(isValidAvatarUrl(_0x4791b4))return _0x4791b4;else console[_0x461d98(0x1f43)]('角色'+_0xd49bc0[_0x461d98(0x1a1c)]+_0x461d98(0xbd8));}return console[_0x461d98(0x2187)]('角色'+_0xd49bc0[_0x461d98(0x1a1c)]+_0x461d98(0x298)),null;}async function getChatSettings(_0x52da6b){const _0x7c25e=_0x211817;try{const _0x297f43=await db[_0x7c25e(0x1789)][_0x7c25e(0xb78)](_0x52da6b);if(_0x297f43)return _0x297f43['settings'];const _0x2014e6=localStorage[_0x7c25e(0x15d8)](_0x7c25e(0xa25)+_0x52da6b);if(_0x2014e6){console[_0x7c25e(0x2187)](_0x7c25e(0x28b)+_0x52da6b+_0x7c25e(0x190a));const _0x369acb=JSON[_0x7c25e(0x22d3)](_0x2014e6);return await db['chatSettings'][_0x7c25e(0x1561)]({'id':_0x52da6b,'chatId':_0x52da6b,'settings':_0x369acb}),_0x369acb;}return{};}catch(_0x355a46){console['error']('获取聊天设置失败:',_0x355a46);const _0x4d0ce0=localStorage[_0x7c25e(0x15d8)](_0x7c25e(0xa25)+_0x52da6b);return _0x4d0ce0?JSON['parse'](_0x4d0ce0):{};}}function getChatSettingsSync(_0x254874){const _0x7457f=_0x211817,_0x4b8549=localStorage[_0x7457f(0x15d8)](_0x7457f(0xa25)+_0x254874);return _0x4b8549?JSON[_0x7457f(0x22d3)](_0x4b8549):{};}function formatMomentText(_0x555150){const _0x15914a=_0x211817;if(!_0x555150)return'';let _0x43004f=_0x555150[_0x15914a(0xe16)](/\n/g,_0x15914a(0xa71));return _0x43004f=_0x43004f[_0x15914a(0xe16)](/\*\[配图：([^\]]+)\]\*/g,function(_0x8c5f1b,_0x53274a){const _0x59d546=_0x15914a;return _0x59d546(0xce0)+_0x53274a+']</span>';}),_0x43004f;}function debugMomentAvatar(_0x21dca3){const _0x3a3ea2=_0x211817,_0x4c2f18=document[_0x3a3ea2(0xb30)](_0x3a3ea2(0x1338)+_0x21dca3+'\x22]');if(!_0x4c2f18){console[_0x3a3ea2(0x2187)]('找不到动态元素');return;}db[_0x3a3ea2(0x9c7)][_0x3a3ea2(0xb78)](parseInt(_0x21dca3))[_0x3a3ea2(0x63d)](_0x37dcdd=>{const _0x429477=_0x3a3ea2;console[_0x429477(0x2187)](_0x429477(0x155c)),console[_0x429477(0x2187)](_0x429477(0x930),_0x21dca3),console[_0x429477(0x2187)](_0x429477(0x262),_0x37dcdd[_0x429477(0xaf5)]),console['log'](_0x429477(0xc0f),_0x37dcdd[_0x429477(0x1f8a)]?_0x37dcdd['avatar'][_0x429477(0x17ca)](0x0,0x32)+_0x429477(0x1520):_0x429477(0x188d));if(_0x37dcdd['characterId']&&_0x37dcdd[_0x429477(0xaf5)]!==_0x429477(0xa80)){const _0x3ea8e5=characters['find'](_0x3ab609=>_0x3ab609['id']===_0x37dcdd[_0x429477(0xaf5)]);_0x3ea8e5?(console['log']('找到角色:',_0x3ea8e5[_0x429477(0x1a1c)]),console['log']('角色卡头像:',_0x3ea8e5[_0x429477(0x1994)]?_0x3ea8e5[_0x429477(0x1994)][_0x429477(0x17ca)](0x0,0x32)+_0x429477(0x1520):_0x429477(0x188d))):console['log']('找不到角色数据');}const _0x48bd12=_0x4c2f18[_0x429477(0xb30)](_0x429477(0x5ca));_0x48bd12&&console[_0x429477(0x2187)]('当前显示的头像URL:',_0x48bd12['src']?_0x48bd12[_0x429477(0x45c)][_0x429477(0x17ca)](0x0,0x32)+_0x429477(0x1520):_0x429477(0x188d));});}async function fixAvatarData(){const _0x3536ff=_0x211817;console['log'](_0x3536ff(0x2067));let _0x417ef8=0x0;try{for(const _0x126c3a of characters){const _0x1ddbdb=await getChatSettings(_0x126c3a['id']);let _0x22f236=![];if(_0x1ddbdb['aiChatAvatar']){const _0x242f84=_0x1ddbdb[_0x3536ff(0x179f)];_0x242f84[_0x3536ff(0x1b30)](_0x3536ff(0x158e))&&!_0x242f84[_0x3536ff(0x1831)]('=')&&_0x242f84['split'](',')[_0x3536ff(0x19ee)]===0x2&&(console[_0x3536ff(0x2187)]('清理'+_0x126c3a[_0x3536ff(0x1a1c)]+'的聊天头像设置'),delete _0x1ddbdb[_0x3536ff(0x179f)],_0x22f236=!![],_0x417ef8++);}if(_0x1ddbdb['aiChatAvatar']){const _0x5473eb=_0x1ddbdb[_0x3536ff(0x179f)];_0x5473eb[_0x3536ff(0x1b30)]('data:image/')&&!_0x5473eb['includes']('=')&&_0x5473eb[_0x3536ff(0x204b)](',')[_0x3536ff(0x19ee)]===0x2&&(console[_0x3536ff(0x2187)]('清理'+_0x126c3a[_0x3536ff(0x1a1c)]+_0x3536ff(0xc30)),delete _0x1ddbdb[_0x3536ff(0x179f)],_0x22f236=!![],_0x417ef8++);}_0x22f236&&await db[_0x3536ff(0x1789)]['put']({'id':_0x126c3a['id'],'chatId':_0x126c3a['id'],'settings':_0x1ddbdb});}const _0x5dc161=await db[_0x3536ff(0x9c7)][_0x3536ff(0xf13)]();let _0x5cf55c=0x0;for(const _0x545b1a of _0x5dc161){_0x545b1a[_0x3536ff(0x1f8a)]&&_0x545b1a[_0x3536ff(0x1f8a)][_0x3536ff(0x1b30)](_0x3536ff(0x158e))&&((_0x545b1a[_0x3536ff(0x1f8a)][_0x3536ff(0x81f)]('VNEKhsVJik')||_0x545b1a[_0x3536ff(0x1f8a)][_0x3536ff(0x81f)](_0x3536ff(0x19cc))||!_0x545b1a[_0x3536ff(0x1f8a)][_0x3536ff(0x1831)]('=')&&_0x545b1a[_0x3536ff(0x1f8a)][_0x3536ff(0x204b)](',')[_0x3536ff(0x19ee)]===0x2)&&(console[_0x3536ff(0x2187)](_0x3536ff(0xf51)+_0x545b1a['id']+_0x3536ff(0x1aac)),await db[_0x3536ff(0x9c7)][_0x3536ff(0x96d)](_0x545b1a['id'],{'avatar':null}),_0x5cf55c++));}const _0x1cd7a9=_0x417ef8+_0x5cf55c;console['log'](_0x3536ff(0x502)+_0x417ef8+_0x3536ff(0x8a8)+_0x5cf55c+'个动态头像'),alert('修复完成！\x0a清理了\x20'+_0x417ef8+_0x3536ff(0x10b4)+_0x5cf55c+'\x20个动态中的截断头像\x0a\x0a请重新为角色设置头像'),_0x1cd7a9>0x0&&loadMoments();}catch(_0x590b09){console['error'](_0x3536ff(0x2d5),_0x590b09),alert(_0x3536ff(0x1f1c)+_0x590b09[_0x3536ff(0x1e8e)]);}}window[_0x211817(0x21e9)](_0x211817(0x2040),function(){clearAllBackgroundTimers(),clearGlobalMomentsTimers();}),window[_0x211817(0x17f3)]=async function(){const _0x139f00=_0x211817;try{const _0x5d65fb=await db[_0x139f00(0x9c7)][_0x139f00(0xf13)](),_0x2576f7=await db[_0x139f00(0x367)][_0x139f00(0xf13)]();console[_0x139f00(0x2187)]('📊\x20总共有\x20'+_0x2576f7[_0x139f00(0x19ee)]+_0x139f00(0x164a));for(const _0x3b4bc1 of characters){const _0x1cb52e=await getVisibleMomentsForCharacter(_0x3b4bc1['id'],0xa);console[_0x139f00(0x2187)]('👤\x20'+_0x3b4bc1[_0x139f00(0x1a1c)]+_0x139f00(0x161f)+_0x3b4bc1[_0x139f00(0x22be)]+')\x20可以看到\x20'+_0x1cb52e['length']+_0x139f00(0x15e9)),_0x1cb52e[_0x139f00(0x19fb)]((_0x32d943,_0x4973ef)=>{const _0x3b1c3b=_0x139f00,_0x52f657=_0x32d943[_0x3b1c3b(0x22d2)]===_0x3b1c3b(0xa80)?'用户':_0x32d943['nickname'];console[_0x3b1c3b(0x2187)]('\x20\x20'+(_0x4973ef+0x1)+'.\x20'+_0x52f657+':\x20'+_0x32d943[_0x3b1c3b(0x1378)][_0x3b1c3b(0x17ca)](0x0,0x1e)+_0x3b1c3b(0x1520));});}}catch(_0x44058e){console['error'](_0x139f00(0x1905),_0x44058e);}};function debugMomentsSystem(){const _0x238e8a=_0x211817;console[_0x238e8a(0x2187)](_0x238e8a(0x9df)),console[_0x238e8a(0x2187)](_0x238e8a(0x331),characters?characters[_0x238e8a(0x19ee)]:0x0),console[_0x238e8a(0x2187)](_0x238e8a(0x218d),Object[_0x238e8a(0x1c9f)](globalMomentsTimers)),console[_0x238e8a(0x2187)](_0x238e8a(0x209b),globalMomentsCheckInterval?_0x238e8a(0x1276):_0x238e8a(0x341)),characters&&characters[_0x238e8a(0x19ee)]>0x0&&(console[_0x238e8a(0x2187)](_0x238e8a(0x1a1d)),characters[_0x238e8a(0x19fb)](async(_0x346513,_0x2b4cac)=>{const _0x50b4a6=_0x238e8a,_0x29f208=await getChatSettings(_0x346513['id']);console[_0x50b4a6(0x2187)](_0x2b4cac+0x1+'.\x20'+_0x346513['name']+':',{'backgroundMomentsEnabled':_0x29f208['backgroundMomentsEnabled'],'backgroundMomentsFrequency':_0x29f208[_0x50b4a6(0xed6)],'scheduledMomentsEnabled':_0x29f208[_0x50b4a6(0x1d5f)],'scheduledMomentsTimes':_0x29f208[_0x50b4a6(0xb66)]});})),console[_0x238e8a(0x2187)](_0x238e8a(0xcb8));}window[_0x211817(0xda0)]=debugMomentsSystem;async function loadWallpaper(){const _0x143335=_0x211817;try{const _0x2a4aa2=await db[_0x143335(0x13c7)][_0x143335(0xb78)](_0x143335(0x11d7));if(_0x2a4aa2){selectedWallpaper=_0x2a4aa2[_0x143335(0x22c0)];if(_0x2a4aa2[_0x143335(0x1a4b)]===_0x143335(0x68e)&&_0x2a4aa2[_0x143335(0x22c0)][_0x143335(0x1b30)](_0x143335(0x13c6)))document[_0x143335(0xb30)](_0x143335(0xf87))[_0x143335(0x14eb)][_0x143335(0x159c)]=_0x143335(0x9f1)+_0x2a4aa2['data']+')';else _0x2a4aa2[_0x143335(0x1a4b)]==='gradient'||_0x2a4aa2[_0x143335(0x22c0)]['startsWith']('linear-gradient')?document[_0x143335(0xb30)]('.wallpaper')[_0x143335(0x14eb)][_0x143335(0x159c)]=_0x2a4aa2[_0x143335(0x22c0)]:(document[_0x143335(0xb30)](_0x143335(0xf87))[_0x143335(0x14eb)][_0x143335(0x577)]=_0x2a4aa2['data'],document[_0x143335(0xb30)]('.wallpaper')['style'][_0x143335(0x159c)]=_0x143335(0x102b));document[_0x143335(0xb30)]('.wallpaper')[_0x143335(0x14eb)][_0x143335(0x15d0)]=_0x143335(0xe57),document['querySelector'](_0x143335(0xf87))['style'][_0x143335(0x1530)]=_0x143335(0xcef);}else{const _0x54817b=localStorage[_0x143335(0x15d8)](_0x143335(0x1b6b)),_0x1c2e75=localStorage['getItem']('wallpaperType');if(_0x54817b){console[_0x143335(0x2187)](_0x143335(0x1b9f)),selectedWallpaper=_0x54817b,await db[_0x143335(0x13c7)][_0x143335(0x21e2)]({'id':_0x143335(0x11d7),'type':_0x1c2e75||_0x143335(0x12d4),'data':_0x54817b});if(_0x1c2e75===_0x143335(0x68e)&&_0x54817b[_0x143335(0x1b30)](_0x143335(0x13c6)))document['querySelector'](_0x143335(0xf87))[_0x143335(0x14eb)][_0x143335(0x159c)]=_0x143335(0x9f1)+_0x54817b+')';else _0x1c2e75===_0x143335(0x12d4)||_0x54817b['startsWith'](_0x143335(0x526))?document['querySelector']('.wallpaper')[_0x143335(0x14eb)][_0x143335(0x159c)]=_0x54817b:(document['querySelector']('.wallpaper')[_0x143335(0x14eb)][_0x143335(0x577)]=_0x54817b,document[_0x143335(0xb30)](_0x143335(0xf87))[_0x143335(0x14eb)]['backgroundImage']=_0x143335(0x102b));document[_0x143335(0xb30)](_0x143335(0xf87))['style'][_0x143335(0x15d0)]=_0x143335(0xe57),document['querySelector'](_0x143335(0xf87))['style'][_0x143335(0x1530)]=_0x143335(0xcef),console['log'](_0x143335(0x1bda));}}}catch(_0x242c53){console[_0x143335(0x174a)](_0x143335(0x1eda),_0x242c53);const _0x8b341e=localStorage[_0x143335(0x15d8)](_0x143335(0x1b6b)),_0x1f5c12=localStorage[_0x143335(0x15d8)](_0x143335(0x18d8));if(_0x8b341e){selectedWallpaper=_0x8b341e;if(_0x1f5c12===_0x143335(0x68e)&&_0x8b341e['startsWith'](_0x143335(0x13c6)))document[_0x143335(0xb30)](_0x143335(0xf87))['style'][_0x143335(0x159c)]='url('+_0x8b341e+')';else _0x1f5c12===_0x143335(0x12d4)||_0x8b341e[_0x143335(0x1b30)](_0x143335(0x526))?document[_0x143335(0xb30)](_0x143335(0xf87))['style']['backgroundImage']=_0x8b341e:(document[_0x143335(0xb30)]('.wallpaper')[_0x143335(0x14eb)]['backgroundColor']=_0x8b341e,document['querySelector'](_0x143335(0xf87))[_0x143335(0x14eb)][_0x143335(0x159c)]=_0x143335(0x102b));document['querySelector'](_0x143335(0xf87))[_0x143335(0x14eb)]['backgroundSize']=_0x143335(0xe57),document[_0x143335(0xb30)](_0x143335(0xf87))[_0x143335(0x14eb)][_0x143335(0x1530)]=_0x143335(0xcef);}}}async function loadAppIcons(){const _0x597813=_0x211817;try{const _0x3a99fd=await db[_0x597813(0x11fd)][_0x597813(0xf13)]();if(_0x3a99fd[_0x597813(0x19ee)]===0x0){const _0xa2a91e=localStorage['getItem'](_0x597813(0x11fd));if(_0xa2a91e){console['log'](_0x597813(0x15f8));const _0x329d8a=JSON['parse'](_0xa2a91e),_0x28dfb6=Object[_0x597813(0x1c9f)](_0x329d8a)['map'](_0x813f81=>({'id':_0x813f81,'appId':_0x813f81,'iconClass':_0x329d8a[_0x813f81]}));_0x28dfb6[_0x597813(0x19ee)]>0x0&&(await db['appIcons'][_0x597813(0x2a3)](_0x28dfb6),console['log']('应用图标数据迁移完成:',_0x28dfb6)),Object['keys'](_0x329d8a)[_0x597813(0x19fb)](_0x39e70b=>{const _0x2d3da7=_0x597813,_0x57f929=document[_0x2d3da7(0xb30)](_0x2d3da7(0x2c5)+_0x39e70b+_0x2d3da7(0xda9));_0x57f929&&(_0x57f929['className']=_0x329d8a[_0x39e70b]);});}}else console[_0x597813(0x2187)](_0x597813(0x1f5e),_0x3a99fd),_0x3a99fd[_0x597813(0x19fb)](_0x16dc09=>{const _0xec7d2=_0x597813,_0x3ee3b3=document[_0xec7d2(0xb30)](_0xec7d2(0x2c5)+_0x16dc09[_0xec7d2(0x1952)]+_0xec7d2(0xda9));_0x3ee3b3&&(_0x3ee3b3[_0xec7d2(0x1722)]=_0x16dc09['iconClass']);});}catch(_0x47cc96){console[_0x597813(0x174a)](_0x597813(0x1c25),_0x47cc96);const _0x446805=localStorage[_0x597813(0x15d8)](_0x597813(0x11fd));if(_0x446805){const _0x4c0321=JSON[_0x597813(0x22d3)](_0x446805);Object[_0x597813(0x1c9f)](_0x4c0321)[_0x597813(0x19fb)](_0x3c0045=>{const _0x18ffe2=_0x597813,_0x30f7b8=document[_0x18ffe2(0xb30)]('.app[onclick=\x22showApp(\x27'+_0x3c0045+_0x18ffe2(0xda9));_0x30f7b8&&(_0x30f7b8[_0x18ffe2(0x1722)]=_0x4c0321[_0x3c0045]);});}}}async function loadApiSettings(){const _0x35e00e=_0x211817;try{const _0x259282=await db[_0x35e00e(0x1f0c)]['get'](_0x35e00e(0x11d7));if(_0x259282)apiSettings=_0x259282['settings'],console[_0x35e00e(0x2187)]('🔧\x20[应用启动]\x20从IndexedDB加载API设置:',apiSettings);else{const _0x36e53b=localStorage['getItem'](_0x35e00e(0x1f0c));_0x36e53b?(console[_0x35e00e(0x2187)](_0x35e00e(0x14f1)),apiSettings=JSON[_0x35e00e(0x22d3)](_0x36e53b),await db[_0x35e00e(0x1f0c)][_0x35e00e(0x1561)]({'id':'main','settings':apiSettings}),console[_0x35e00e(0x2187)]('🔧\x20[应用启动]\x20迁移完成，当前API设置:',apiSettings)):(console[_0x35e00e(0x2187)](_0x35e00e(0x1fb0)),apiSettings={'type':_0x35e00e(0x16a6),'base':'https://generativelanguage.googleapis.com/v1beta','endpoint':'/chat/completions','key':'','model':'gemini-2.0-flash-exp','temperature':0.7});}}catch(_0x22818e){console['error'](_0x35e00e(0xcbd),_0x22818e);}}async function saveAppIcons(){const _0x4a2813=_0x211817;try{console[_0x4a2813(0x2187)]('保存应用图标数据到IndexedDB...');const _0x145769={'chat-screen':_0x4a2813(0x2f8),'forum-screen':_0x4a2813(0x2169),'diary-book-screen':_0x4a2813(0x21cc),'characters-screen':_0x4a2813(0x1214),'shop-screen':_0x4a2813(0x1f57),'settings-screen':'fas\x20fa-cog'};selectedAppIcon&&(_0x145769[selectedAppIcon[_0x4a2813(0x1952)]]=selectedAppIcon[_0x4a2813(0xdf0)]);const _0x25d1bd=Object[_0x4a2813(0x1c9f)](_0x145769)[_0x4a2813(0x6a4)](_0x3989a1=>({'id':_0x3989a1,'appId':_0x3989a1,'iconClass':_0x145769[_0x3989a1]}));await db[_0x4a2813(0x11fd)][_0x4a2813(0xa4f)](),await db[_0x4a2813(0x11fd)][_0x4a2813(0x2a3)](_0x25d1bd),console['log'](_0x4a2813(0x68c)),await loadAppIcons();}catch(_0x32ffe8){console[_0x4a2813(0x174a)](_0x4a2813(0x72d),_0x32ffe8);const _0x1e33db={'chat-screen':'fas\x20fa-comment-dots','weibo-screen':'fab\x20fa-weibo','album-screen':_0x4a2813(0x937),'characters-screen':'fas\x20fa-user-friends','shop-screen':_0x4a2813(0x1f57),'settings-screen':_0x4a2813(0x1187)};selectedAppIcon&&(_0x1e33db[selectedAppIcon['appId']]=selectedAppIcon['iconClass']),localStorage[_0x4a2813(0x192)](_0x4a2813(0x11fd),JSON[_0x4a2813(0x6b8)](_0x1e33db)),loadAppIcons();}}function renderMessageList(){const _0x1ab526=_0x211817,_0x1c80af=document[_0x1ab526(0x1262)](_0x1ab526(0x1c45));_0x1c80af[_0x1ab526(0x33a)]='';const _0x463215=document[_0x1ab526(0xb30)](_0x1ab526(0x382));if(isMessageListMultiSelectMode){_0x463215&&(_0x463215[_0x1ab526(0x14eb)][_0x1ab526(0x4da)]=_0x1ab526(0x102b));let _0x3869bf=document[_0x1ab526(0xb30)](_0x1ab526(0x16e5));if(!_0x3869bf){const _0x10b264=document[_0x1ab526(0xac6)]('div');_0x10b264[_0x1ab526(0x1722)]='chat-header-multiselect-actions',_0x10b264[_0x1ab526(0x33a)]=_0x1ab526(0x10c8),_0x10b264['onclick']=function(_0x801fba){const _0x6402a5=_0x1ab526,_0x3c7fe1=_0x801fba['target'][_0x6402a5(0x216a)](_0x6402a5(0x1b67))?.[_0x6402a5(0x1ecd)]['action'];if(_0x3c7fe1===_0x6402a5(0x1f4a))deleteSelectedConversations();else{if(_0x3c7fe1===_0x6402a5(0x1373))exitMessageListMultiSelectMode();else _0x3c7fe1===_0x6402a5(0xe66)&&pinSelectedConversations();}};const _0x2d4d91=document[_0x1ab526(0xb30)](_0x1ab526(0x26a));_0x2d4d91&&_0x2d4d91[_0x1ab526(0x497)](_0x10b264);}}else{_0x463215&&(_0x463215['style'][_0x1ab526(0x4da)]=_0x1ab526(0x1fb7));const _0xdebbd0=document[_0x1ab526(0xb30)]('.chat-header-multiselect-actions');_0xdebbd0&&_0xdebbd0[_0x1ab526(0x1493)]();}console[_0x1ab526(0x2187)](_0x1ab526(0x1508),{'charactersCount':characters[_0x1ab526(0x19ee)],'contactsCount':contacts['length'],'contactsArray':contacts,'chatMessagesKeys':Object['keys'](chatMessages)[_0x1ab526(0x19ee)]});if(contacts[_0x1ab526(0x19ee)]===0x0&&characters['length']>0x0){const _0x191262=Object[_0x1ab526(0x1c9f)](chatMessages)[_0x1ab526(0x19ee)]>0x0;if(_0x191262){console['warn']('⚠️\x20检测到有聊天记录但无联系人，可能是数据不一致，尝试从聊天记录恢复联系人');const _0x4e6b35=Object[_0x1ab526(0x1c9f)](chatMessages),_0x29b87e=_0x4e6b35[_0x1ab526(0x1e1f)](_0x459cbe=>characters['some'](_0x10f549=>_0x10f549['id']===_0x459cbe));_0x29b87e[_0x1ab526(0x19ee)]>0x0&&(contacts=_0x29b87e,saveContacts()[_0x1ab526(0x1c82)](_0x52fd=>console[_0x1ab526(0x174a)]('保存联系人失败:',_0x52fd)),console['log'](_0x1ab526(0x991)+_0x29b87e['length']+'\x20个联系人'));}else console[_0x1ab526(0x2187)](_0x1ab526(0xd2f));}const _0x30fd1b=characters[_0x1ab526(0x1e1f)](_0x12203a=>{if(!_0x12203a||!_0x12203a['id'])return![];return contacts['includes'](_0x12203a['id']);}),_0x4a4109=_0x30fd1b[_0x1ab526(0x1104)]((_0x59d1a4,_0x51a2f0)=>{const _0x4437d7=isPinned(_0x59d1a4['id']),_0x487d3f=isPinned(_0x51a2f0['id']);if(_0x4437d7&&!_0x487d3f)return-0x1;if(!_0x4437d7&&_0x487d3f)return 0x1;return 0x0;});_0x4a4109['forEach'](_0x5b81e1=>{const _0x33c0de=_0x1ab526;if(_0x5b81e1){const _0x564142=window[_0x33c0de(0x1789)]&&window[_0x33c0de(0x1789)][_0x5b81e1['id']]?window[_0x33c0de(0x1789)][_0x5b81e1['id']]:{},_0x10f09b=_0x564142[_0x33c0de(0x4e7)]||_0x5b81e1[_0x33c0de(0x1a1c)],_0x1cbb40=chatMessages[_0x5b81e1['id']]||[],_0x43f086=_0x1cbb40[_0x33c0de(0x1e1f)](_0x9992f6=>!_0x9992f6[_0x33c0de(0x20f5)]&&!_0x9992f6['isGameContext']&&!_0x9992f6[_0x33c0de(0x208c)]);let _0x564e2b='暂无消息';if(_0x43f086[_0x33c0de(0x19ee)]>0x0){const _0x117a4e=_0x43f086[_0x43f086['length']-0x1];if(!_0x117a4e)_0x564e2b=_0x33c0de(0x1c88);else{if(_0x117a4e[_0x33c0de(0x1a4b)]===_0x33c0de(0xd38))_0x564e2b=_0x33c0de(0x101e);else{if(_0x117a4e['type']===_0x33c0de(0x1a36))_0x564e2b='[图片]';else{if(_0x117a4e[_0x33c0de(0x1a4b)]===_0x33c0de(0x13ed))_0x564e2b=_0x33c0de(0x281);else{if(_0x117a4e[_0x33c0de(0x1a4b)]===_0x33c0de(0x78a))_0x564e2b=_0x33c0de(0xff9);else{if(_0x117a4e['type']===_0x33c0de(0x21f6))_0x564e2b=_0x33c0de(0x215f);else{if(_0x117a4e['type']==='location')_0x564e2b=_0x33c0de(0x128b);else{if(_0x117a4e[_0x33c0de(0x1a4b)]===_0x33c0de(0x2023))_0x564e2b=_0x33c0de(0xcc5);else{if(_0x117a4e[_0x33c0de(0x8a1)]===_0x33c0de(0x1744))_0x564e2b=_0x117a4e[_0x33c0de(0x211c)]||'[系统消息]';else{if(_0x117a4e[_0x33c0de(0x8e7)])_0x564e2b='[表情]';else{if(typeof _0x117a4e[_0x33c0de(0x211c)]==='string')_0x564e2b=_0x117a4e[_0x33c0de(0x211c)];else{if(Array[_0x33c0de(0x1496)](_0x117a4e[_0x33c0de(0x211c)])){const _0x1c4050=_0x117a4e[_0x33c0de(0x211c)][_0x33c0de(0xaf4)](_0x57db63=>_0x57db63[_0x33c0de(0x1a4b)]===_0x33c0de(0x1378));_0x564e2b=_0x1c4050?_0x1c4050[_0x33c0de(0x1378)]:_0x33c0de(0x1ced);}else{if(typeof _0x117a4e[_0x33c0de(0x211c)]==='object'&&_0x117a4e[_0x33c0de(0x211c)]!==null){if(_0x117a4e[_0x33c0de(0x211c)]['text'])_0x564e2b=_0x117a4e[_0x33c0de(0x211c)][_0x33c0de(0x1378)];else _0x117a4e['content'][_0x33c0de(0x211c)]?_0x564e2b=_0x117a4e[_0x33c0de(0x211c)][_0x33c0de(0x211c)]:_0x564e2b=_0x33c0de(0x424);}else _0x564e2b=_0x117a4e[_0x33c0de(0x211c)]||'';}}}}}}}}}}}}}const _0x405105=truncateText(String(_0x564e2b||_0x33c0de(0x1c88)),0x1e),_0xc560b=_0x1cbb40[_0x33c0de(0x19ee)]>0x0?formatTime(_0x1cbb40[_0x1cbb40[_0x33c0de(0x19ee)]-0x1][_0x33c0de(0x1716)]):'刚刚',_0x318b4d=document[_0x33c0de(0xac6)](_0x33c0de(0xbbc)),_0x8be3d6=isPinned(_0x5b81e1['id']);_0x318b4d[_0x33c0de(0x1722)]='message-item\x20'+(_0x8be3d6?_0x33c0de(0x469):'')+'\x20'+(isMessageListMultiSelectMode&&selectedConversations['includes'](_0x5b81e1['id'])?_0x33c0de(0x176b):''),_0x318b4d['dataset'][_0x33c0de(0x1f41)]=_0x5b81e1['id'];if(isMessageListMultiSelectMode)_0x318b4d['onclick']=()=>toggleConversationSelection(_0x5b81e1['id']);else{let _0x3c091b=![];_0x318b4d[_0x33c0de(0x1f36)]=_0x5bebd5=>{!_0x3c091b&&startChat(_0x5b81e1),_0x3c091b=![];};let _0x36fdec;_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x1728),_0x38090c=>{const _0xcb398c=_0x33c0de;_0x38090c[_0xcb398c(0x902)](),_0x36fdec=setTimeout(()=>{const _0x4366d3=_0xcb398c;console[_0x4366d3(0x2187)](_0x4366d3(0x8ea),_0x5b81e1['id']),_0x3c091b=!![],enterMessageListMultiSelectMode(_0x5b81e1['id']),_0x38090c[_0x4366d3(0x36f)]();},0x320);}),_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x1c63),_0x46ded0=>{_0x36fdec&&(clearTimeout(_0x36fdec),_0x36fdec=null);}),_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x20a4),_0x2881a2=>{_0x36fdec&&(clearTimeout(_0x36fdec),_0x36fdec=null);}),_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x5ac),_0x301bf3=>{const _0x4f9487=_0x33c0de;_0x301bf3[_0x4f9487(0xca7)]===0x0&&(_0x301bf3[_0x4f9487(0x902)](),_0x36fdec=setTimeout(()=>{const _0x17ebe8=_0x4f9487;console[_0x17ebe8(0x2187)](_0x17ebe8(0x5f0),_0x5b81e1['id']),_0x3c091b=!![],enterMessageListMultiSelectMode(_0x5b81e1['id']),_0x301bf3[_0x17ebe8(0x36f)]();},0x320));}),_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x2276),_0x5870f0=>{_0x36fdec&&(clearTimeout(_0x36fdec),_0x36fdec=null);}),_0x318b4d[_0x33c0de(0x21e9)](_0x33c0de(0x1e80),_0x85bcf2=>{_0x36fdec&&(clearTimeout(_0x36fdec),_0x36fdec=null);}),_0x318b4d['addEventListener']('contextmenu',_0x227b1c=>{const _0x342500=_0x33c0de;_0x227b1c[_0x342500(0x36f)](),enterMessageListMultiSelectMode(_0x5b81e1['id']);});}let _0x25115e='';if(_0x5b81e1[_0x33c0de(0x1f68)]===!![]){const _0x81cd3f=isGroupMuted(_0x5b81e1['id']);_0x81cd3f&&(_0x25115e='<div\x20class=\x22message-status-indicator\x20muted\x22\x20title=\x22已屏蔽\x22><i\x20class=\x22fas\x20fa-volume-mute\x22></i></div>');}else{const _0x54abbc=isBlocked(_0x33c0de(0xa80),_0x5b81e1['id']),_0xbd60f9=isBlocked(_0x5b81e1['id'],_0x33c0de(0xa80));if(_0x54abbc)_0x25115e='<div\x20class=\x22message-status-indicator\x20blocked\x22\x20title=\x22已拉黑\x22><i\x20class=\x22fas\x20fa-ban\x22></i></div>';else _0xbd60f9&&(_0x25115e=_0x33c0de(0x11be));}let _0x19e3ff='';const _0x18e408=getUnreadCount(_0x5b81e1['id']);if(_0x18e408>0x0){const _0x476dde=_0x18e408>0x63?_0x33c0de(0x953):_0x18e408['toString'](),_0x3d63b3=_0x18e408>0x63?_0x33c0de(0x1c35):_0x33c0de(0x2033);_0x19e3ff=_0x33c0de(0x1560)+_0x3d63b3+'\x22\x20title=\x22'+_0x18e408+_0x33c0de(0x134a)+_0x476dde+_0x33c0de(0x1844);}_0x318b4d[_0x33c0de(0x33a)]=_0x33c0de(0xb33)+(_0x8be3d6?'<div\x20class=\x22pin-indicator\x22><i\x20class=\x22fas\x20fa-thumbtack\x22></i></div>':'')+_0x33c0de(0xb33)+(isMessageListMultiSelectMode?_0x33c0de(0x1eae)+(selectedConversations['includes'](_0x5b81e1['id'])?'selected':'')+_0x33c0de(0x127f)+(selectedConversations[_0x33c0de(0x1831)](_0x5b81e1['id'])?_0x33c0de(0x126b):'')+_0x33c0de(0x1a39):'')+_0x33c0de(0x1999)+_0x5b81e1[_0x33c0de(0xc3d)]+';\x20'+(_0x5b81e1['avatarUrl']?_0x33c0de(0x2236)+_0x5b81e1[_0x33c0de(0x1994)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x5b81e1['avatarUrl']?'':_0x10f09b[_0x33c0de(0xcc3)](0x0))+_0x33c0de(0xa9a)+_0x19e3ff+_0x33c0de(0x1255)+_0x25115e+_0x33c0de(0x14d1)+_0x10f09b+_0x33c0de(0x1c29)+_0x405105+_0x33c0de(0x99a)+_0xc560b+_0x33c0de(0x19f3),_0x1c80af[_0x33c0de(0x497)](_0x318b4d),_0x8be3d6&&(_0x318b4d[_0x33c0de(0x14eb)][_0x33c0de(0x619)]='rgba(0,\x200,\x200,\x200.05)',_0x318b4d[_0x33c0de(0x14eb)][_0x33c0de(0x54e)]=_0x33c0de(0x102b));}});const _0xa0b487=[...groupChats]['sort']((_0x537cd7,_0x4f9710)=>{const _0xf2f829=isPinned(_0x537cd7['id']),_0xe9bacc=isPinned(_0x4f9710['id']);if(_0xf2f829&&!_0xe9bacc)return-0x1;if(!_0xf2f829&&_0xe9bacc)return 0x1;return 0x0;});_0xa0b487[_0x1ab526(0x19fb)](_0x8a96ae=>{const _0x2b0f59=_0x1ab526,_0x6432e=chatMessages[_0x8a96ae['id']]||[];let _0x538fb0=_0x2b0f59(0x1c88);if(_0x6432e[_0x2b0f59(0x19ee)]>0x0){const _0x4853b4=_0x6432e[_0x6432e[_0x2b0f59(0x19ee)]-0x1];if(!_0x4853b4)_0x538fb0='暂无消息';else{if(_0x4853b4[_0x2b0f59(0x1a4b)]===_0x2b0f59(0xd38))_0x538fb0=_0x2b0f59(0x101e);else{if(_0x4853b4[_0x2b0f59(0x1a4b)]===_0x2b0f59(0x1a36))_0x538fb0=_0x2b0f59(0x1bb6);else{if(_0x4853b4['type']==='voice_message')_0x538fb0=_0x2b0f59(0x281);else{if(_0x4853b4[_0x2b0f59(0x1a4b)]==='transfer')_0x538fb0=_0x2b0f59(0xff9);else{if(_0x4853b4[_0x2b0f59(0x1a4b)]===_0x2b0f59(0x21f6))_0x538fb0='[撤回了一条消息]';else{if(_0x4853b4[_0x2b0f59(0x1a4b)]===_0x2b0f59(0x2184))_0x538fb0=_0x2b0f59(0x128b);else{if(_0x4853b4[_0x2b0f59(0x1a4b)]===_0x2b0f59(0x2023))_0x538fb0=_0x2b0f59(0xcc5);else{if(_0x4853b4[_0x2b0f59(0x8a1)]===_0x2b0f59(0x1744))_0x538fb0=_0x4853b4[_0x2b0f59(0x211c)]||_0x2b0f59(0x16de);else{if(_0x4853b4['isEmoji'])_0x538fb0=_0x2b0f59(0xaf8);else{if(typeof _0x4853b4['content']==='string')_0x538fb0=_0x4853b4['content'];else{if(Array[_0x2b0f59(0x1496)](_0x4853b4['content'])){const _0x3027a9=_0x4853b4[_0x2b0f59(0x211c)][_0x2b0f59(0xaf4)](_0x140352=>_0x140352[_0x2b0f59(0x1a4b)]==='text');_0x538fb0=_0x3027a9?_0x3027a9[_0x2b0f59(0x1378)]:_0x2b0f59(0x1ced);}else{if(typeof _0x4853b4[_0x2b0f59(0x211c)]==='object'&&_0x4853b4[_0x2b0f59(0x211c)]!==null){if(_0x4853b4[_0x2b0f59(0x211c)]['text'])_0x538fb0=_0x4853b4['content'][_0x2b0f59(0x1378)];else _0x4853b4[_0x2b0f59(0x211c)][_0x2b0f59(0x211c)]?_0x538fb0=_0x4853b4[_0x2b0f59(0x211c)][_0x2b0f59(0x211c)]:_0x538fb0=_0x2b0f59(0x424);}else _0x538fb0=_0x4853b4[_0x2b0f59(0x211c)]||'';}}}}}}}}}}}}}const _0x165e71=truncateText(String(_0x538fb0||_0x2b0f59(0x1c88)),0x1e),_0x263a5f=_0x6432e[_0x2b0f59(0x19ee)]>0x0?formatTime(_0x6432e[_0x6432e['length']-0x1][_0x2b0f59(0x1716)]):'刚刚',_0x59f80c=document[_0x2b0f59(0xac6)](_0x2b0f59(0xbbc)),_0x33eef0=isPinned(_0x8a96ae['id']);_0x59f80c['className']=_0x2b0f59(0x70f)+(_0x33eef0?_0x2b0f59(0x469):'')+'\x20'+(isMessageListMultiSelectMode&&selectedConversations[_0x2b0f59(0x1831)](_0x8a96ae['id'])?'selected':''),_0x59f80c[_0x2b0f59(0x1ecd)]['conversationId']=_0x8a96ae['id'];if(isMessageListMultiSelectMode)_0x59f80c['onclick']=()=>toggleConversationSelection(_0x8a96ae['id']);else{_0x59f80c[_0x2b0f59(0x1f36)]=()=>startChat(_0x8a96ae);let _0x417d21;_0x59f80c[_0x2b0f59(0x21e9)]('touchstart',_0x459d9b=>{const _0x3a30c8=_0x2b0f59;_0x459d9b[_0x3a30c8(0x902)](),_0x417d21=setTimeout(()=>{const _0x29dcf7=_0x3a30c8;console[_0x29dcf7(0x2187)](_0x29dcf7(0x1810),_0x8a96ae['id']),enterMessageListMultiSelectMode(_0x8a96ae['id']),_0x459d9b[_0x29dcf7(0x36f)]();},0x320);}),_0x59f80c[_0x2b0f59(0x21e9)](_0x2b0f59(0x1c63),_0x81a359=>{_0x417d21&&(clearTimeout(_0x417d21),_0x417d21=null);}),_0x59f80c[_0x2b0f59(0x21e9)]('touchmove',_0x954e7b=>{_0x417d21&&(clearTimeout(_0x417d21),_0x417d21=null);}),_0x59f80c['addEventListener'](_0x2b0f59(0x5ac),_0x4b3821=>{const _0x120fb3=_0x2b0f59;_0x4b3821[_0x120fb3(0xca7)]===0x0&&(_0x4b3821['stopPropagation'](),_0x417d21=setTimeout(()=>{const _0x478741=_0x120fb3;console[_0x478741(0x2187)](_0x478741(0x1acb),_0x8a96ae['id']),enterMessageListMultiSelectMode(_0x8a96ae['id']),_0x4b3821[_0x478741(0x36f)]();},0x320));}),_0x59f80c[_0x2b0f59(0x21e9)](_0x2b0f59(0x2276),_0x536c15=>{_0x417d21&&(clearTimeout(_0x417d21),_0x417d21=null);}),_0x59f80c['addEventListener'](_0x2b0f59(0x1e80),_0x367f74=>{_0x417d21&&(clearTimeout(_0x417d21),_0x417d21=null);}),_0x59f80c[_0x2b0f59(0x21e9)]('contextmenu',_0x4bd59d=>{const _0x20cd3e=_0x2b0f59;_0x4bd59d[_0x20cd3e(0x36f)](),enterMessageListMultiSelectMode(_0x8a96ae['id']);});}let _0x32f456='';const _0x32c330=isGroupMuted(_0x8a96ae['id']);_0x32c330&&(_0x32f456=_0x2b0f59(0x6a7));let _0x508ee0='';const _0x1a0d3e=getUnreadCount(_0x8a96ae['id']);if(_0x1a0d3e>0x0){const _0x55b1c8=_0x1a0d3e>0x63?_0x2b0f59(0x953):_0x1a0d3e['toString'](),_0x1a2727=_0x1a0d3e>0x63?'unread-badge\x20large-count':_0x2b0f59(0x2033);_0x508ee0=_0x2b0f59(0x1560)+_0x1a2727+_0x2b0f59(0x1db9)+_0x1a0d3e+_0x2b0f59(0x134a)+_0x55b1c8+'</div>';}_0x59f80c['innerHTML']=_0x2b0f59(0x1578)+(_0x33eef0?'<div\x20class=\x22pin-indicator\x22><i\x20class=\x22fas\x20fa-thumbtack\x22></i></div>':'')+_0x2b0f59(0x1578)+(isMessageListMultiSelectMode?_0x2b0f59(0x1856)+(selectedConversations['includes'](_0x8a96ae['id'])?_0x2b0f59(0x176b):'')+_0x2b0f59(0x1ada)+(selectedConversations[_0x2b0f59(0x1831)](_0x8a96ae['id'])?_0x2b0f59(0x126b):'')+_0x2b0f59(0x1085):'')+_0x2b0f59(0x11b4)+(_0x8a96ae[_0x2b0f59(0x1994)]?_0x2b0f59(0x2236)+_0x8a96ae[_0x2b0f59(0x1994)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':_0x2b0f59(0x1abf))+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x8a96ae[_0x2b0f59(0x1994)]?'':'群')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x508ee0+_0x2b0f59(0xb33)+_0x32f456+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>'+_0x8a96ae[_0x2b0f59(0x1a1c)]+_0x2b0f59(0x1b75)+(_0x8a96ae[_0x2b0f59(0x12a6)]?_0x8a96ae[_0x2b0f59(0x12a6)]['length']+0x1:0x1)+_0x2b0f59(0x1f18)+_0x165e71+_0x2b0f59(0x1996)+_0x263a5f+_0x2b0f59(0x1f39),_0x1c80af[_0x2b0f59(0x497)](_0x59f80c),_0x33eef0&&(_0x59f80c[_0x2b0f59(0x14eb)][_0x2b0f59(0x619)]=_0x2b0f59(0x1e8c),_0x59f80c[_0x2b0f59(0x14eb)]['borderLeft']='none');});if(window[_0x1ab526(0x2184)][_0x1ab526(0x20fb)]===_0x1ab526(0x3a9)){const _0x49328a=characters[_0x1ab526(0xaf4)](_0x4f60eb=>_0x4f60eb[_0x1ab526(0x1a1c)]==='一号');if(_0x49328a){const _0xd5c93f=Date[_0x1ab526(0x2eb)]()-0x3c*0x3c*0x3e8;localStorage[_0x1ab526(0x192)](_0x1ab526(0x1604)+_0x49328a['id'],_0xd5c93f[_0x1ab526(0x1878)]());}}}function getUnreadCount(_0x565632){const _0x1df993=_0x211817,_0x48227a=chatMessages[_0x565632]||[],_0x1fe8c7=localStorage[_0x1df993(0x15d8)](_0x1df993(0x1604)+_0x565632);if(!_0x1fe8c7)return 0x0;const _0x9a8027=parseInt(_0x1fe8c7),_0x4aeb5f=_0x48227a[_0x1df993(0x1e1f)](_0x1ae564=>_0x1ae564[_0x1df993(0x1716)]>_0x9a8027&&_0x1ae564[_0x1df993(0x8a1)]!==_0x1df993(0xa80));return _0x4aeb5f['length'];}function markAsRead(_0x371220){const _0x59f5e7=_0x211817,_0x522a34=Date['now']();localStorage[_0x59f5e7(0x192)]('lastRead_'+_0x371220,_0x522a34[_0x59f5e7(0x1878)]());}function loadPinnedConversations(){const _0x50e334=_0x211817,_0x846352=localStorage['getItem'](_0x50e334(0xdef));pinnedConversations=_0x846352?JSON['parse'](_0x846352):[];}function savePinnedConversations(){const _0xc7fd91=_0x211817;localStorage[_0xc7fd91(0x192)](_0xc7fd91(0xdef),JSON[_0xc7fd91(0x6b8)](pinnedConversations));}function togglePinConversation(_0x9b5765){const _0x42f6ee=_0x211817,_0x18b3c0=pinnedConversations['indexOf'](_0x9b5765);_0x18b3c0>-0x1?pinnedConversations[_0x42f6ee(0x19b2)](_0x18b3c0,0x1):pinnedConversations[_0x42f6ee(0x1cd6)](_0x9b5765),savePinnedConversations();}function isPinned(_0x559ac0){const _0x3fa39e=_0x211817;return pinnedConversations[_0x3fa39e(0x1831)](_0x559ac0);}async function pinSelectedConversations(){const _0x5e8c7b=_0x211817;pinnedConversations=[...selectedConversations],savePinnedConversations(),renderMessageList(),exitMessageListMultiSelectMode();const _0x554de4=selectedConversations[_0x5e8c7b(0x19ee)];showToast(_0x5e8c7b(0x54f)+_0x554de4+_0x5e8c7b(0x1803),_0x5e8c7b(0x11cb));}function renderContactList(){const _0x4e3b5a=_0x211817,_0x3883ea=document[_0x4e3b5a(0xb30)](_0x4e3b5a(0x1787));if(!_0x3883ea)return;_0x3883ea[_0x4e3b5a(0x33a)]='';if(isMultiSelectMode){const _0x5823e6=document['createElement']('div');_0x5823e6[_0x4e3b5a(0x1722)]=_0x4e3b5a(0x53d),_0x5823e6['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22multiselect-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-circle\x20multiselect-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22multiselect-text\x22>已选择\x20'+selectedCharacters['length']+_0x4e3b5a(0x223e),_0x3883ea[_0x4e3b5a(0x497)](_0x5823e6);}if(isGroupManageMode){const _0x7efa4e=document[_0x4e3b5a(0xac6)](_0x4e3b5a(0xbbc));_0x7efa4e[_0x4e3b5a(0x1722)]='group-manage-header',_0x7efa4e['innerHTML']=_0x4e3b5a(0x1078),_0x3883ea[_0x4e3b5a(0x497)](_0x7efa4e);}const _0x3576bb=characterGroups['sort']((_0x23765e,_0x9aa0ec)=>_0x23765e[_0x4e3b5a(0x2224)]-_0x9aa0ec[_0x4e3b5a(0x2224)]);_0x3576bb[_0x4e3b5a(0x19fb)](_0x331209=>{const _0x4a5ade=_0x4e3b5a,_0x222092=characters[_0x4a5ade(0x1e1f)](_0x3b7947=>_0x3b7947[_0x4a5ade(0x22be)]===_0x331209['id']);if(_0x222092[_0x4a5ade(0x19ee)]===0x0&&!isGroupManageMode)return;const _0x2c828a=document['createElement'](_0x4a5ade(0xbbc));_0x2c828a[_0x4a5ade(0x1722)]=_0x4a5ade(0x1dbc)+(_0x331209[_0x4a5ade(0x1d6)]?_0x4a5ade(0x7c8):_0x4a5ade(0x1bc7));let _0x147469='';_0x331209[_0x4a5ade(0x11c0)]&&!_0x331209[_0x4a5ade(0x1d6)]&&(_0x147469=_0x4a5ade(0xe28));if(isGroupManageMode)_0x2c828a['innerHTML']=_0x4a5ade(0x2087)+_0x331209[_0x4a5ade(0x1a1c)]+'\x20('+_0x222092[_0x4a5ade(0x19ee)]+_0x4a5ade(0x151c)+_0x147469+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-count\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!_0x331209[_0x4a5ade(0x1d6)]?_0x4a5ade(0x330)+_0x331209['id']+_0x4a5ade(0x113c)+_0x331209['id']+_0x4a5ade(0x49c):'')+_0x4a5ade(0x1085);else{const _0x5438c5=localStorage[_0x4a5ade(0x15d8)]('group_collapsed_'+_0x331209['id'])===_0x4a5ade(0x1098);_0x2c828a[_0x4a5ade(0x33a)]=_0x4a5ade(0x3e4)+_0x331209['id']+_0x4a5ade(0x1333)+(_0x5438c5?'right':_0x4a5ade(0x550))+_0x4a5ade(0x61c)+_0x331209[_0x4a5ade(0x1a1c)]+_0x4a5ade(0x5db)+_0x147469+_0x4a5ade(0x1cff)+_0x222092['length']+'/'+_0x222092[_0x4a5ade(0x19ee)]+_0x4a5ade(0x13f8);}_0x3883ea[_0x4a5ade(0x497)](_0x2c828a);const _0x19edf8=document[_0x4a5ade(0xac6)](_0x4a5ade(0xbbc));_0x19edf8[_0x4a5ade(0x1722)]=_0x4a5ade(0x3e2),_0x19edf8['id']=_0x4a5ade(0xf16)+_0x331209['id'];const _0x46c022=localStorage[_0x4a5ade(0x15d8)](_0x4a5ade(0xd80)+_0x331209['id'])===_0x4a5ade(0x1098);_0x46c022&&!isGroupManageMode&&(_0x19edf8['style']['display']=_0x4a5ade(0x102b));_0x222092[_0x4a5ade(0x19fb)](_0x360ae5=>{const _0x55a67f=_0x4a5ade,_0x4221e3=window['chatSettings']&&window[_0x55a67f(0x1789)][_0x360ae5['id']]?window[_0x55a67f(0x1789)][_0x360ae5['id']]:{},_0x2aa716=_0x4221e3[_0x55a67f(0x4e7)]||_0x360ae5[_0x55a67f(0x1a1c)],_0x5bac29=_0x4221e3['avatarShape']||_0x55a67f(0x22e0),_0x233631=_0x5bac29===_0x55a67f(0xca6)?_0x55a67f(0x1701):'',_0x1805f9=document[_0x55a67f(0xac6)](_0x55a67f(0xbbc));_0x1805f9[_0x55a67f(0x1722)]=_0x55a67f(0x1fe2)+(isMultiSelectMode&&selectedCharacters['includes'](_0x360ae5['id'])?_0x55a67f(0x176b):''),_0x1805f9[_0x55a67f(0x1ecd)][_0x55a67f(0xaf5)]=_0x360ae5['id'];if(isMultiSelectMode)_0x1805f9[_0x55a67f(0x1f36)]=()=>toggleCharacterSelection(_0x360ae5['id']);else{_0x1805f9[_0x55a67f(0x1f36)]=()=>editCharacterFromContactList(_0x360ae5['id']);let _0x14b12a;const _0x25f467=_0x1aa634=>{_0x14b12a=setTimeout(()=>{const _0x4fde1a=_0x167f;showMoveCharacterModal(_0x360ae5['id']),_0x1aa634[_0x4fde1a(0x36f)]();},0x320);},_0x25b4b6=()=>{clearTimeout(_0x14b12a);};_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x1728),_0x25f467),_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x1c63),_0x25b4b6),_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x20a4),_0x25b4b6),_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x5ac),_0x25f467),_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x2276),_0x25b4b6),_0x1805f9[_0x55a67f(0x21e9)](_0x55a67f(0x1e80),_0x25b4b6),_0x1805f9['addEventListener'](_0x55a67f(0x1679),_0x11cb6c=>{_0x11cb6c['preventDefault'](),showMoveCharacterModal(_0x360ae5['id']);});}let _0x5b698a='';if(_0x360ae5[_0x55a67f(0x1f68)]===!![]){const _0x190d07=isGroupMuted(_0x360ae5['id']);_0x190d07&&(_0x5b698a=_0x55a67f(0x1e74));}else{const _0x2a0517=isBlocked('user',_0x360ae5['id']),_0xe655e4=isBlocked(_0x360ae5['id'],_0x55a67f(0xa80));if(_0x2a0517)_0x5b698a=_0x55a67f(0x14e2);else _0xe655e4&&(_0x5b698a=_0x55a67f(0x2020));}_0x1805f9['innerHTML']=_0x55a67f(0xb33)+(isMultiSelectMode?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-checkbox\x20'+(selectedCharacters[_0x55a67f(0x1831)](_0x360ae5['id'])?_0x55a67f(0x176b):'')+_0x55a67f(0x127f)+(selectedCharacters[_0x55a67f(0x1831)](_0x360ae5['id'])?_0x55a67f(0x126b):'')+_0x55a67f(0x1a39):'')+_0x55a67f(0x1a37)+_0x233631+_0x55a67f(0x14c3)+_0x360ae5[_0x55a67f(0xc3d)]+';\x20'+(_0x360ae5[_0x55a67f(0x1994)]?_0x55a67f(0x2236)+_0x360ae5[_0x55a67f(0x1994)]+_0x55a67f(0x1dd):'')+_0x55a67f(0x1ada)+(_0x360ae5[_0x55a67f(0x1994)]?'':_0x2aa716[_0x55a67f(0xcc3)](0x0))+_0x55a67f(0x34c)+_0x2aa716+_0x55a67f(0x1e0d)+truncateText(_0x360ae5[_0x55a67f(0x1f0b)]||_0x55a67f(0x1054),0x19)+_0x55a67f(0x1e16)+_0x5b698a+_0x55a67f(0xb33)+(isGroupManageMode?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22move-character-btn\x22\x20onclick=\x22showMoveCharacterModal(\x27'+_0x360ae5['id']+'\x27)\x22\x20title=\x22移动到其他分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-arrows-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+_0x55a67f(0x1578),_0x19edf8[_0x55a67f(0x497)](_0x1805f9);});if(_0x222092[_0x4a5ade(0x19ee)]===0x0&&isGroupManageMode){const _0x2c25e7=document[_0x4a5ade(0xac6)]('div');_0x2c25e7['className']=_0x4a5ade(0xdf4),_0x2c25e7[_0x4a5ade(0x13be)]=_0x4a5ade(0x1a72),_0x19edf8[_0x4a5ade(0x497)](_0x2c25e7);}_0x3883ea[_0x4a5ade(0x497)](_0x19edf8);});if(characters[_0x4e3b5a(0x19ee)]===0x0){const _0x4d8e9b=document['createElement'](_0x4e3b5a(0xbbc));_0x4d8e9b[_0x4e3b5a(0x1722)]='empty-message',_0x4d8e9b[_0x4e3b5a(0x13be)]='还没有角色，点击右上角+号创建角色吧！',_0x3883ea[_0x4e3b5a(0x497)](_0x4d8e9b);}}function enterGroupManageMode(){const _0x3c0b95=_0x211817;isGroupManageMode=!![],renderContactList();const _0x2f6def=document[_0x3c0b95(0x1262)]('group-manage-btn');_0x2f6def&&(_0x2f6def[_0x3c0b95(0x14eb)][_0x3c0b95(0x4da)]=_0x3c0b95(0x102b));}function exitGroupManageMode(){const _0x32d063=_0x211817;isGroupManageMode=![],renderContactList();const _0x171fd7=document[_0x32d063(0x1262)](_0x32d063(0x1843));_0x171fd7&&(_0x171fd7['style']['display']='flex');}function toggleGroupCollapse(_0x3a6777){const _0x44ce05=_0x211817,_0x5dad14=document[_0x44ce05(0x1262)](_0x44ce05(0xf16)+_0x3a6777);if(!_0x5dad14)return;const _0x4c2b5e=_0x5dad14[_0x44ce05(0x14eb)][_0x44ce05(0x4da)]==='none';_0x5dad14['style'][_0x44ce05(0x4da)]=_0x4c2b5e?_0x44ce05(0x13de):'none',localStorage[_0x44ce05(0x192)](_0x44ce05(0xd80)+_0x3a6777,!_0x4c2b5e);const _0x2879d8=document[_0x44ce05(0xb30)](_0x44ce05(0x71b)+_0x3a6777+_0x44ce05(0xc84));_0x2879d8&&(_0x2879d8['className']='fas\x20fa-chevron-'+(_0x4c2b5e?'down':_0x44ce05(0x117c))+'\x20group-chevron');}function showCreateGroupModal(){const _0x24c089=_0x211817,_0x2449d6=_0x24c089(0x1b84);document['body'][_0x24c089(0x1b7)](_0x24c089(0x42e),_0x2449d6),setTimeout(()=>{const _0x207676=_0x24c089;document[_0x207676(0x1262)](_0x207676(0x2280))[_0x207676(0x13cf)]();},0x64);}function hideCreateGroupModal(){const _0x6f3132=_0x211817,_0x1445aa=document[_0x6f3132(0x1262)](_0x6f3132(0xf9b));if(_0x1445aa)_0x1445aa[_0x6f3132(0x1493)]();}async function createNewGroup(){const _0x5023bd=_0x211817,_0x9580cd=document[_0x5023bd(0x1262)]('new-group-name'),_0xec93f0=document['getElementById'](_0x5023bd(0x190f)),_0x20bbf0=_0x9580cd[_0x5023bd(0x1ebc)][_0x5023bd(0x19d7)]();if(!_0x20bbf0){alert(_0x5023bd(0xf34)),_0x9580cd[_0x5023bd(0x13cf)]();return;}if(characterGroups['find'](_0x15cd56=>_0x15cd56['name']===_0x20bbf0)){alert(_0x5023bd(0x1470)),_0x9580cd['focus']();return;}const _0x33378e={'id':'group_'+Date['now'](),'name':_0x20bbf0,'order':characterGroups['length']+0x1,'isDefault':![],'canInteract':_0xec93f0[_0x5023bd(0x14c1)]};characterGroups[_0x5023bd(0x1cd6)](_0x33378e),await saveCharacterGroups(),hideCreateGroupModal(),renderContactList(),showToast(_0x5023bd(0x5ef),_0x5023bd(0x11cb));}function editGroup(_0x58e4c0){const _0x3497f4=_0x211817,_0x4d69ff=characterGroups[_0x3497f4(0xaf4)](_0x511e86=>_0x511e86['id']===_0x58e4c0);if(!_0x4d69ff||_0x4d69ff[_0x3497f4(0x1d6)])return;const _0x15dfcf='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22edit-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>编辑分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>分组名称</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22edit-group-name\x22\x20class=\x22form-input\x22\x20value=\x22'+_0x4d69ff['name']+_0x3497f4(0xa3f)+(_0x4d69ff[_0x3497f4(0x11c0)]?_0x3497f4(0x14c1):'')+_0x3497f4(0x15d7)+_0x58e4c0+_0x3497f4(0x19a1);document[_0x3497f4(0x1da9)][_0x3497f4(0x1b7)]('beforeend',_0x15dfcf),setTimeout(()=>{const _0x5d725c=_0x3497f4;document[_0x5d725c(0x1262)](_0x5d725c(0xf4b))['focus']();},0x64);}function hideEditGroupModal(){const _0x52d3e7=_0x211817,_0x5b143c=document['getElementById'](_0x52d3e7(0x347));if(_0x5b143c)_0x5b143c[_0x52d3e7(0x1493)]();}async function updateGroup(_0x4d49d8){const _0x2c04ea=_0x211817,_0x301872=document[_0x2c04ea(0x1262)](_0x2c04ea(0xf4b)),_0x2ae19a=document[_0x2c04ea(0x1262)](_0x2c04ea(0x1738)),_0x22f166=_0x301872['value'][_0x2c04ea(0x19d7)]();if(!_0x22f166){alert('请输入分组名称'),_0x301872[_0x2c04ea(0x13cf)]();return;}if(characterGroups[_0x2c04ea(0xaf4)](_0xdf65a=>_0xdf65a['name']===_0x22f166&&_0xdf65a['id']!==_0x4d49d8)){alert(_0x2c04ea(0x1470)),_0x301872[_0x2c04ea(0x13cf)]();return;}const _0x301573=characterGroups[_0x2c04ea(0x150c)](_0x4a4f28=>_0x4a4f28['id']===_0x4d49d8);_0x301573!==-0x1&&(characterGroups[_0x301573][_0x2c04ea(0x1a1c)]=_0x22f166,characterGroups[_0x301573][_0x2c04ea(0x11c0)]=_0x2ae19a[_0x2c04ea(0x14c1)],await saveCharacterGroups(),hideEditGroupModal(),renderContactList(),showToast(_0x2c04ea(0x1554),_0x2c04ea(0x11cb)));}async function deleteGroup(_0x4e16af){const _0x31b4f4=_0x211817,_0x388587=characterGroups[_0x31b4f4(0xaf4)](_0x53f2ef=>_0x53f2ef['id']===_0x4e16af);if(!_0x388587||_0x388587[_0x31b4f4(0x1d6)])return;const _0x53f29a=characters[_0x31b4f4(0x1e1f)](_0x12728f=>_0x12728f[_0x31b4f4(0x22be)]===_0x4e16af);let _0x2bfc58=_0x31b4f4(0x157c)+_0x388587[_0x31b4f4(0x1a1c)]+'\x22吗？';_0x53f29a['length']>0x0&&(_0x2bfc58+=_0x31b4f4(0x21a9)+_0x53f29a[_0x31b4f4(0x19ee)]+'\x20个角色，将被移动到\x22我的好友\x22分组。');if(!confirm(_0x2bfc58))return;_0x53f29a['forEach'](_0x1875d3=>{const _0x4a8935=_0x31b4f4;_0x1875d3[_0x4a8935(0x22be)]=_0x4a8935(0xa74);});const _0x683453=characterGroups['findIndex'](_0x4ee7ec=>_0x4ee7ec['id']===_0x4e16af);_0x683453!==-0x1&&characterGroups[_0x31b4f4(0x19b2)](_0x683453,0x1),await Promise[_0x31b4f4(0x1a47)]([saveCharacterGroups(),saveCharacters()]),renderContactList(),showToast('分组删除成功',_0x31b4f4(0x11cb));}function showMoveCharacterModal(_0x9d94a6){const _0x2ab79e=_0x211817,_0x307da7=characters[_0x2ab79e(0xaf4)](_0x1acda2=>_0x1acda2['id']===_0x9d94a6);if(!_0x307da7)return;const _0x5ba237=characterGroups['filter'](_0x3ff577=>_0x3ff577['id']!==_0x307da7['groupId']),_0x2494cb=_0x2ab79e(0x19c2)+_0x307da7['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5ba237[_0x2ab79e(0x6a4)](_0x408651=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22moveCharacterToGroup(\x27'+_0x9d94a6+_0x2ab79e(0xda7)+_0x408651['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>'+_0x408651['name']+_0x2ab79e(0x1175))[_0x2ab79e(0x122b)]('')+_0x2ab79e(0x14e5)+_0x9d94a6+'\x27);\x22\x20style=\x22color:\x20#007AFF;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-square\x22\x20style=\x22margin-right:\x206px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20进入多选模式\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMoveCharacterModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document[_0x2ab79e(0x1da9)][_0x2ab79e(0x1b7)](_0x2ab79e(0x42e),_0x2494cb);}function hideMoveCharacterModal(){const _0x7afbcb=_0x211817,_0x478d9a=document[_0x7afbcb(0x1262)](_0x7afbcb(0x1bca));if(_0x478d9a)_0x478d9a[_0x7afbcb(0x1493)]();}async function moveCharacterToGroup(_0x2a8f31,_0x10c1b5){const _0x1de16e=_0x211817,_0x7352cb=characters[_0x1de16e(0x150c)](_0x1e1cbe=>_0x1e1cbe['id']===_0x2a8f31);if(_0x7352cb!==-0x1){const _0x5be485=characters[_0x7352cb][_0x1de16e(0x22be)];characters[_0x7352cb][_0x1de16e(0x22be)]=_0x10c1b5,await saveCharacters(),hideMoveCharacterModal(),renderContactList();const _0x399175=characterGroups[_0x1de16e(0xaf4)](_0x1d6bcb=>_0x1d6bcb['id']===_0x10c1b5);showToast('已移动到\x22'+_0x399175[_0x1de16e(0x1a1c)]+_0x1de16e(0x4c4),_0x1de16e(0x11cb));}}function showMoveToGroupModal(){const _0x3fc058=_0x211817;if(selectedCharacters[_0x3fc058(0x19ee)]===0x0){alert(_0x3fc058(0x731));return;}const _0xe2ef83=_0x3fc058(0x1264)+selectedCharacters[_0x3fc058(0x19ee)]+'\x20个角色到分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+characterGroups[_0x3fc058(0x6a4)](_0x5e63ff=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22moveSelectedCharactersToGroup(\x27'+_0x5e63ff['id']+_0x3fc058(0xd8c)+_0x5e63ff[_0x3fc058(0x1a1c)]+_0x3fc058(0x1175))[_0x3fc058(0x122b)]('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMoveToGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document['body'][_0x3fc058(0x1b7)]('beforeend',_0xe2ef83);}function hideMoveToGroupModal(){const _0x87795d=_0x211817,_0x527919=document[_0x87795d(0x1262)](_0x87795d(0x1c9c));if(_0x527919)_0x527919[_0x87795d(0x1493)]();}async function moveSelectedCharactersToGroup(_0x10f50a){const _0x272ffd=_0x211817;selectedCharacters[_0x272ffd(0x19fb)](_0x1048c5=>{const _0x55ea01=_0x272ffd,_0x280716=characters[_0x55ea01(0x150c)](_0x298ffa=>_0x298ffa['id']===_0x1048c5);_0x280716!==-0x1&&(characters[_0x280716][_0x55ea01(0x22be)]=_0x10f50a);}),await saveCharacters(),hideMoveToGroupModal(),exitMultiSelectMode();const _0x24fa42=characterGroups[_0x272ffd(0xaf4)](_0x5259c3=>_0x5259c3['id']===_0x10f50a);showToast(_0x272ffd(0x165a)+selectedCharacters[_0x272ffd(0x19ee)]+_0x272ffd(0x2196)+_0x24fa42['name']+_0x272ffd(0x4c4),_0x272ffd(0x11cb));}function renderCharacterList(){const _0x3096e3=_0x211817,_0xbe3680=document[_0x3096e3(0x1262)](_0x3096e3(0x1c99));if(!_0xbe3680){console[_0x3096e3(0x2187)](_0x3096e3(0x1c68));return;}_0xbe3680[_0x3096e3(0x33a)]='',characters[_0x3096e3(0x19fb)](_0x399716=>{const _0x223fec=_0x3096e3,_0x5f1285=document['createElement']('div');_0x5f1285[_0x223fec(0x1722)]=_0x223fec(0xd39),_0x5f1285['onclick']=()=>editCharacter(_0x399716['id']),_0x5f1285[_0x223fec(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22\x20style=\x22background-color:\x20'+_0x399716[_0x223fec(0xc3d)]+';\x20'+(_0x399716[_0x223fec(0x1994)]?_0x223fec(0x2236)+_0x399716[_0x223fec(0x1994)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+_0x223fec(0x1e29)+(_0x399716[_0x223fec(0x1994)]?'':_0x399716['name']['charAt'](0x0))+_0x223fec(0x652)+_0x399716[_0x223fec(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-bio\x22>'+truncateText(_0x399716[_0x223fec(0x1f0b)],0x32)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xbe3680[_0x223fec(0x497)](_0x5f1285);});}let currentMessageOffset=0x0;const MESSAGE_LIMIT=0x32;function renderChatMessages(_0x5424dc,_0x1d7358=![]){const _0xad7080=_0x211817;renderChatMessagesAsync(_0x5424dc,_0x1d7358)[_0xad7080(0x1c82)](_0x4a3b63=>{const _0x563710=_0xad7080;console[_0x563710(0x174a)]('渲染聊天消息失败:',_0x4a3b63);});}function addBubbleTail(_0xd9cfa2,_0x395fb2){const _0x3d7369=_0x211817,_0x22ad7c=document[_0x3d7369(0xb30)](_0x3d7369(0x2284));if(!_0x22ad7c||!_0x22ad7c[_0x3d7369(0x1c1b)][_0x3d7369(0x971)]('bubble-style-tail'))return;const _0x36a127=_0xd9cfa2[_0x3d7369(0xb30)](_0x3d7369(0xa99));if(!_0x36a127)return;const _0xd51db=document[_0x3d7369(0xac6)]('div');_0xd51db[_0x3d7369(0x1722)]='bubble-tail-js',_0xd51db[_0x3d7369(0x14eb)][_0x3d7369(0x1f87)]=_0x3d7369(0x15d3);if(_0x395fb2[_0x3d7369(0x8a1)]===_0x3d7369(0xb11))_0xd51db[_0x3d7369(0x14eb)][_0x3d7369(0x1f87)]+=_0x3d7369(0x1809)+getComputedStyle(_0x36a127)[_0x3d7369(0x577)]+_0x3d7369(0x1b13);else _0x395fb2['sender']==='sent'&&(_0xd51db['style']['cssText']+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-width:\x2010px\x208px\x200\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20'+getComputedStyle(_0x36a127)[_0x3d7369(0x577)]+_0x3d7369(0x11f0));_0x36a127[_0x3d7369(0x497)](_0xd51db);}async function renderChatMessagesAsync(_0x3d6a72,_0x3e77bd=![]){const _0x43c943=_0x211817,_0x9ca3a6=document[_0x43c943(0x1262)](_0x43c943(0x19a8)),_0x8445bd=chatMessages[_0x3d6a72]||[],_0xd9c64b=await getAsyncChatSettings(_0x3d6a72);!_0x3e77bd&&(_0x9ca3a6[_0x43c943(0x33a)]='',currentMessageOffset=Math[_0x43c943(0x658)](0x0,_0x8445bd[_0x43c943(0x19ee)]-MESSAGE_LIMIT));applyChatBackground(undefined,!![]),applyBubbleStyle();if(_0x8445bd[_0x43c943(0x19ee)]===0x0){const _0xce52d4=_0xd9c64b['aiChatNickname']||currentChatCharacter['name'],_0x47bdeb=document[_0x43c943(0xac6)](_0x43c943(0xbbc));_0x47bdeb[_0x43c943(0x1722)]=_0x43c943(0x1675),_0x47bdeb[_0x43c943(0x33a)]=_0x43c943(0x1786)+_0xce52d4+_0x43c943(0x9ac),_0x9ca3a6['appendChild'](_0x47bdeb);return;}if(!_0x3e77bd&&currentMessageOffset>0x0){const _0x5e06ce=document[_0x43c943(0xac6)](_0x43c943(0xbbc));_0x5e06ce[_0x43c943(0x1722)]='load-more-messages',_0x5e06ce[_0x43c943(0x33a)]=_0x43c943(0x737)+currentMessageOffset+_0x43c943(0x1de2),_0x5e06ce[_0x43c943(0x1f36)]=()=>loadMoreMessages(_0x3d6a72),_0x9ca3a6[_0x43c943(0x497)](_0x5e06ce);}const _0x165e2b=_0x8445bd['filter'](_0x356550=>!_0x356550['isOfflineMode']&&!_0x356550[_0x43c943(0x20f5)]&&!_0x356550[_0x43c943(0x1eb4)]),_0x526723=_0x3e77bd?Math['max'](0x0,_0x165e2b[_0x43c943(0x19ee)]-MESSAGE_LIMIT):Math[_0x43c943(0x658)](0x0,_0x165e2b[_0x43c943(0x19ee)]-MESSAGE_LIMIT),_0x1d651f=_0x3e77bd?_0x165e2b[_0x43c943(0x6d5)](Math[_0x43c943(0x658)](0x0,_0x526723-MESSAGE_LIMIT),_0x526723):_0x165e2b['slice'](_0x526723),_0x3e3b3e=_0xd9c64b[_0x43c943(0x17eb)]!==![],_0x2721ff=_0xd9c64b['timestampPosition']||'center';let _0x163b85=0x0;_0x1d651f[_0x43c943(0x19fb)]((_0x18dba3,_0x154cca)=>{const _0x3eaafa=_0x43c943;if(_0x18dba3[_0x3eaafa(0x8a1)]==='system'){if(_0x18dba3[_0x3eaafa(0x1b0b)]){const _0x3cd713=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x3cd713[_0x3eaafa(0x1722)]=_0x3eaafa(0x1c28);const _0x4d80ac=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x4d80ac[_0x3eaafa(0x1722)]=_0x3eaafa(0x1f4d),_0x4d80ac['textContent']=_0x18dba3['content'],_0x3cd713['appendChild'](_0x4d80ac),_0x9ca3a6[_0x3eaafa(0x497)](_0x3cd713);}else{if(_0x18dba3['type']===_0x3eaafa(0x2c3)){const _0x3ceae1=document['createElement']('div');_0x3ceae1['style'][_0x3eaafa(0x4da)]=_0x3eaafa(0x1fb7),_0x3ceae1[_0x3eaafa(0x14eb)]['justifyContent']=_0x3eaafa(0xcef),_0x3ceae1[_0x3eaafa(0x14eb)][_0x3eaafa(0xfe0)]=_0x3eaafa(0x20a1),_0x3ceae1[_0x3eaafa(0x1ecd)][_0x3eaafa(0x21c8)]=_0x18dba3['id'];const _0x24873f=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x24873f['className']=_0x3eaafa(0x1cc7),_0x24873f[_0x3eaafa(0x14eb)][_0x3eaafa(0x1f87)]=_0x3eaafa(0x1358),_0x24873f[_0x3eaafa(0x13be)]=_0x18dba3['content'],_0x3ceae1[_0x3eaafa(0x497)](_0x24873f),_0x9ca3a6['appendChild'](_0x3ceae1);}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x21f6)){const _0x4abd67=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x4abd67[_0x3eaafa(0x14eb)][_0x3eaafa(0x4da)]=_0x3eaafa(0x1fb7),_0x4abd67[_0x3eaafa(0x14eb)]['justifyContent']='center',_0x4abd67[_0x3eaafa(0x14eb)][_0x3eaafa(0xfe0)]=_0x3eaafa(0x20a1),_0x4abd67[_0x3eaafa(0x1ecd)][_0x3eaafa(0x21c8)]=_0x18dba3['id'];const _0x514cef=document['createElement'](_0x3eaafa(0xbbc));_0x514cef[_0x3eaafa(0x1722)]=_0x3eaafa(0xc37);const _0x1c4844=_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x204b)]('\x0a'),_0x5ba70c=_0x1c4844[0x0];let _0x53a57b=_0x1c4844[0x1];_0x514cef['textContent']=_0x5ba70c;if(_0x53a57b){if(_0x53a57b['startsWith'](_0x3eaafa(0x2234))){const _0x2ce783=document[_0x3eaafa(0xac6)]('div');_0x2ce783['className']=_0x3eaafa(0x1a35),_0x2ce783[_0x3eaafa(0x13be)]=_0x53a57b,_0x514cef[_0x3eaafa(0x497)](_0x2ce783);}else{const _0xe2f955=document['createElement'](_0x3eaafa(0xbbc));_0xe2f955['className']=_0x3eaafa(0x1a35),_0xe2f955['textContent']='原文：'+_0x53a57b,_0x514cef['appendChild'](_0xe2f955);}}else{if(_0x18dba3[_0x3eaafa(0x122d)]){const _0x336e14=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x336e14[_0x3eaafa(0x1722)]=_0x3eaafa(0x1a35),_0x336e14[_0x3eaafa(0x13be)]=_0x3eaafa(0x2234)+_0x18dba3[_0x3eaafa(0x122d)],_0x514cef[_0x3eaafa(0x497)](_0x336e14);}}_0x4abd67['appendChild'](_0x514cef),_0x9ca3a6[_0x3eaafa(0x497)](_0x4abd67),addMessageLongPressListener(_0x4abd67,_0x18dba3['id']);}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1e64)){const _0x4491e4=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x4491e4[_0x3eaafa(0x1722)]=_0x3eaafa(0x220a),_0x4491e4[_0x3eaafa(0x1ecd)][_0x3eaafa(0x21c8)]=_0x18dba3['id'];const _0x2fd650=document['createElement']('div');_0x2fd650[_0x3eaafa(0x1722)]=_0x3eaafa(0x19be),_0x2fd650[_0x3eaafa(0x14eb)]['textAlign']=_0x3eaafa(0xcef),_0x2fd650[_0x3eaafa(0x14eb)][_0x3eaafa(0xc3d)]=_0x3eaafa(0x12df),_0x2fd650[_0x3eaafa(0x14eb)][_0x3eaafa(0x3f4)]='13px',_0x2fd650[_0x3eaafa(0x14eb)][_0x3eaafa(0xbf2)]='8px\x200',_0x2fd650[_0x3eaafa(0x13be)]=_0x18dba3[_0x3eaafa(0x211c)],_0x4491e4[_0x3eaafa(0x497)](_0x2fd650),_0x9ca3a6[_0x3eaafa(0x497)](_0x4491e4);}else{if(_0x18dba3['type']===_0x3eaafa(0x2023)){const _0x2141b7=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x2141b7['className']=_0x3eaafa(0x220a),_0x2141b7[_0x3eaafa(0x1ecd)][_0x3eaafa(0x21c8)]=_0x18dba3['id'];const _0x57ab53=document['createElement']('div');_0x57ab53[_0x3eaafa(0x1722)]=_0x3eaafa(0x1213),_0x57ab53[_0x3eaafa(0x14eb)][_0x3eaafa(0xc3d)]=_0x3eaafa(0x12df),_0x57ab53[_0x3eaafa(0x14eb)][_0x3eaafa(0x3f4)]=_0x3eaafa(0x196f),_0x57ab53[_0x3eaafa(0x14eb)]['textAlign']=_0x3eaafa(0xcef),_0x57ab53['style'][_0x3eaafa(0xbf2)]=_0x3eaafa(0x176e),_0x57ab53[_0x3eaafa(0x13be)]=_0x18dba3[_0x3eaafa(0x211c)],_0x2141b7[_0x3eaafa(0x497)](_0x57ab53),_0x9ca3a6[_0x3eaafa(0x497)](_0x2141b7);}else{const _0x293d9a=document[_0x3eaafa(0xac6)]('div');_0x293d9a[_0x3eaafa(0x14eb)][_0x3eaafa(0x4da)]=_0x3eaafa(0x1fb7),_0x293d9a[_0x3eaafa(0x14eb)][_0x3eaafa(0x1b5f)]=_0x3eaafa(0xcef),_0x293d9a['style']['margin']=_0x3eaafa(0x20a1);const _0x2bd3c2=document['createElement']('div');_0x18dba3['isFriendAddedMessage']?_0x2bd3c2[_0x3eaafa(0x1722)]='friend-added-system-message':_0x2bd3c2[_0x3eaafa(0x1722)]=_0x3eaafa(0x319),_0x2bd3c2[_0x3eaafa(0x13be)]=_0x18dba3[_0x3eaafa(0x211c)],_0x293d9a[_0x3eaafa(0x497)](_0x2bd3c2),_0x9ca3a6[_0x3eaafa(0x497)](_0x293d9a);}}}}}return;}if(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0xcef)){const _0x2a576e=new Date(_0x18dba3[_0x3eaafa(0x1716)]),_0x2d7e3f=_0x2a576e-_0x163b85;if(_0x154cca===0x0||_0x2d7e3f>0x5*0x3c*0x3e8){const _0x22b682=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc));_0x22b682[_0x3eaafa(0x1722)]=_0x3eaafa(0x2002),_0x22b682['textContent']=formatTimestamp(_0x18dba3['timestamp']),_0x9ca3a6['appendChild'](_0x22b682),_0x163b85=_0x2a576e;}}const _0xf50175=document[_0x3eaafa(0xac6)](_0x3eaafa(0xbbc)),_0x5b7380=_0x18dba3[_0x3eaafa(0x8e7)]&&!_0x18dba3[_0x3eaafa(0x211c)];_0xf50175[_0x3eaafa(0x1722)]=_0x3eaafa(0x1f05)+_0x18dba3[_0x3eaafa(0x8a1)]+(_0xd9c64b[_0x3eaafa(0xdea)]?_0x3eaafa(0x1263):'')+(_0x5b7380?_0x3eaafa(0x1086):''),_0xf50175[_0x3eaafa(0x1ecd)][_0x3eaafa(0x21c8)]=_0x18dba3['id'];if(_0x18dba3['sender']==='received'){let _0x5b623c=characters['find'](_0x1422e7=>_0x1422e7['id']===_0x3d6a72),_0x176c7c=![],_0x35df77=null;!_0x5b623c&&(_0x35df77=groupChats['find'](_0x3c5778=>_0x3c5778['id']===_0x3d6a72),_0x35df77&&(_0x176c7c=!![]));let _0x250b75='',_0x30dc1c='',_0x2eb58f=_0x3eaafa(0x1d8c);if(_0x176c7c&&_0x35df77){let _0x5282c6=null;console[_0x3eaafa(0x2187)](_0x3eaafa(0x103c),_0x18dba3[_0x3eaafa(0x12c8)],_0x3eaafa(0xa77),_0x18dba3['name']),console[_0x3eaafa(0x2187)](_0x3eaafa(0x1c85),_0x35df77[_0x3eaafa(0x12a6)]),console[_0x3eaafa(0x2187)]('🔍\x20[消息渲染]\x20完整消息对象:',_0x18dba3);if(_0x18dba3[_0x3eaafa(0x12c8)])_0x5282c6=_0x35df77['members'][_0x3eaafa(0xaf4)](_0x36a901=>_0x36a901['id']===_0x18dba3[_0x3eaafa(0x12c8)]),console[_0x3eaafa(0x2187)]('🔍\x20[消息渲染]\x20通过senderId找到成员:',_0x5282c6),console[_0x3eaafa(0x2187)]('🔍\x20[消息渲染]\x20senderId查找详情:',{'messageSenderId':_0x18dba3[_0x3eaafa(0x12c8)],'memberIds':_0x35df77[_0x3eaafa(0x12a6)][_0x3eaafa(0x6a4)](_0x130c85=>_0x130c85['id']),'foundMember':_0x5282c6});else _0x18dba3[_0x3eaafa(0x1a1c)]&&(_0x5282c6=_0x35df77[_0x3eaafa(0x12a6)]['find'](_0x10ec9f=>_0x10ec9f[_0x3eaafa(0x1a1c)]===_0x18dba3[_0x3eaafa(0x1a1c)]),console[_0x3eaafa(0x2187)](_0x3eaafa(0xc48),_0x5282c6),console[_0x3eaafa(0x2187)](_0x3eaafa(0xe09),{'messageName':_0x18dba3['name'],'memberNames':_0x35df77[_0x3eaafa(0x12a6)][_0x3eaafa(0x6a4)](_0x141c5d=>_0x141c5d[_0x3eaafa(0x1a1c)]),'foundMember':_0x5282c6}));_0x5282c6?(_0x250b75=_0x5282c6[_0x3eaafa(0x1994)]||'',_0x30dc1c=_0x5282c6['name'],_0x2eb58f=_0x5282c6['color']||_0x3eaafa(0x1d8c)):(_0x250b75='',_0x30dc1c=_0x18dba3['name']||_0x3eaafa(0xaae),_0x2eb58f='#4CAF50',console[_0x3eaafa(0x1f43)](_0x3eaafa(0x21ab),_0x18dba3[_0x3eaafa(0x1a1c)]));}else _0x5b623c?(_0x250b75=_0xd9c64b[_0x3eaafa(0x179f)]||_0x5b623c[_0x3eaafa(0x1994)],_0x30dc1c=_0xd9c64b[_0x3eaafa(0x4e7)]||_0x5b623c[_0x3eaafa(0x1a1c)],_0x2eb58f=_0x5b623c['color']||_0x3eaafa(0x1d8c)):(_0x250b75='',_0x30dc1c='未知',_0x2eb58f=_0x3eaafa(0x1d8c));let _0x2472a2=_0xd9c64b[_0x3eaafa(0xeaf)]||'#f0f0f0';if(_0x176c7c&&_0x35df77&&_0x18dba3[_0x3eaafa(0x12c8)]&&_0xd9c64b[_0x3eaafa(0x1541)]){const _0x153989=_0xd9c64b['memberBubbleColors'][_0x18dba3[_0x3eaafa(0x12c8)]];_0x153989&&(_0x2472a2=_0x153989);}const _0x230d09=_0xd9c64b[_0x3eaafa(0x2fd)]||'1',_0x1592c1=isLightColor(_0x2472a2)?_0x3eaafa(0x22d0):_0x3eaafa(0x1a7),_0x5e0c25=_0xd9c64b[_0x3eaafa(0x735)]||'12',_0xf90d7f=convertColorWithOpacity(_0x2472a2,_0x230d09);let _0x443c2a='';if(_0x18dba3[_0x3eaafa(0x1a4b)]==='user_photo')_0x443c2a=_0x3eaafa(0x760)+(_0x18dba3[_0x3eaafa(0x1b98)]||_0x18dba3['content'])[_0x3eaafa(0xe16)](/'/g,'\x5c\x27')[_0x3eaafa(0xe16)](/"/g,_0x3eaafa(0xb65))+_0x3eaafa(0x1154)+(_0x18dba3['photoDescription']||_0x18dba3[_0x3eaafa(0x211c)])+_0x3eaafa(0x12aa);else{if(_0x18dba3[_0x3eaafa(0x1a4b)]==='location')_0x443c2a=_0x3eaafa(0xe36)+_0x18dba3[_0x3eaafa(0x1b93)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x18dba3[_0x3eaafa(0x1b93)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2025%;\x20left:\x2060%;\x20width:\x2014px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2050%;\x20left:\x2015%;\x20width:\x208px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2070%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2010%;\x20left:\x2075%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2075%;\x20left:\x2025%;\x20width:\x207px;\x20height:\x207px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x13ed)){const _0x39ac56=_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0xe16)](/\([^)]*\)\s*/g,'')[_0x3eaafa(0x19d7)](),_0x1c6579=_0x18dba3['duration']||Math[_0x3eaafa(0x658)](0x1,Math[_0x3eaafa(0x708)](_0x39ac56[_0x3eaafa(0x19ee)]/0x8));_0x443c2a=_0x3eaafa(0xcb7)+_0xf90d7f+_0x3eaafa(0xe1f)+_0x1592c1+_0x3eaafa(0x3a1)+_0x5e0c25+_0x3eaafa(0x19f1)+_0x39ac56+_0x3eaafa(0x113b)+_0x1c6579+_0x3eaafa(0x1f33)+_0x39ac56+_0x3eaafa(0xc80);}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1a36)){const _0x5e5c5e=_0x18dba3[_0x3eaafa(0x646)]||_0x18dba3[_0x3eaafa(0x211c)]||_0x3eaafa(0xbb8);_0x443c2a=_0x3eaafa(0x760)+_0x5e5c5e[_0x3eaafa(0xe16)](/'/g,'\x5c\x27')[_0x3eaafa(0xe16)](/"/g,'&quot;')+_0x3eaafa(0x1154)+_0x5e5c5e+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x78a)){const _0x3823fe=_0x18dba3[_0x3eaafa(0x464)]===_0x3eaafa(0xa80),_0x1bf682=_0x3823fe?'💕':'💖',_0x9e126f=_0x3823fe?_0x3eaafa(0x771):_0x3eaafa(0x196a);let _0x461b77='',_0x249e8c='',_0xfdf563='';if(_0x18dba3[_0x3eaafa(0x12e2)]==='accepted')_0x249e8c=_0x3eaafa(0x39f)+(_0x3823fe?_0x3eaafa(0x1c0f):_0x3eaafa(0xeb8))+'</div>',_0x461b77=_0x3eaafa(0xdfc);else{if(_0x18dba3[_0x3eaafa(0x12e2)]===_0x3eaafa(0xd3b))_0x249e8c=_0x3eaafa(0x39f)+(_0x3823fe?_0x3eaafa(0x1c36):_0x3eaafa(0x9e0))+'</div>',_0x461b77='rejected';else!_0x3823fe&&(_0xfdf563=_0x3eaafa(0xaee)+JSON[_0x3eaafa(0x6b8)](_0x18dba3)[_0x3eaafa(0xe16)](/"/g,_0x3eaafa(0xb65))+')\x22');}_0x443c2a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20'+_0x461b77+_0x3eaafa(0x1415)+_0x18dba3[_0x3eaafa(0x1716)]+'\x22\x20'+_0xfdf563+_0x3eaafa(0x1ad3)+_0x1bf682+'\x20'+_0x9e126f+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20'+Number(_0x18dba3['amount'])['toFixed'](0x2)+_0x3eaafa(0x1311)+(_0x18dba3[_0x3eaafa(0x1814)]||'转账')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x249e8c+_0x3eaafa(0xf74);}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2051)){let _0x336658;if(_0x18dba3['friendRequestProcessed']){const _0x4c03de=_0x18dba3[_0x3eaafa(0x2ca)]?'已同意':_0x3eaafa(0x17d8),_0x201fb5=_0x18dba3['friendRequestAccepted']?_0x3eaafa(0xdfc):_0x3eaafa(0xd3b);_0x336658=_0x3eaafa(0xcb4)+_0x201fb5+'\x22>'+_0x4c03de+'</div>',console['log'](_0x3eaafa(0x1436),_0x18dba3['id'],_0x4c03de);}else _0x336658=_0x3eaafa(0x13d6)+currentChatCharacter?.['id']+'\x27,\x20true,\x20\x27'+_0x18dba3['id']+'\x27)\x22>同意</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20reject\x22\x20onclick=\x22handleAIFriendRequest(\x27'+currentChatCharacter?.['id']+_0x3eaafa(0x1d4)+_0x18dba3['id']+'\x27)\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',console[_0x3eaafa(0x2187)](_0x3eaafa(0x1b03),_0x18dba3['id']);_0x443c2a=_0x3eaafa(0x19c7)+(_0x18dba3[_0x3eaafa(0x1e8e)]||_0x3eaafa(0x160b))+_0x3eaafa(0x130d)+_0x336658+_0x3eaafa(0x1f71);}else{const _0x2ef08c=_0xd9c64b['chatMode']||_0x3eaafa(0x38b);let _0x309c09;if(typeof _0x18dba3[_0x3eaafa(0x211c)]===_0x3eaafa(0x11b7))_0x309c09=_0x18dba3[_0x3eaafa(0x211c)];else{if(Array['isArray'](_0x18dba3['content'])&&_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x19ee)]>0x0){const _0x24d370=_0x18dba3['content'][0x0];_0x24d370&&_0x24d370[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1378)&&_0x24d370[_0x3eaafa(0x1378)]?_0x309c09=_0x24d370[_0x3eaafa(0x1378)]:_0x309c09=_0x3eaafa(0x1ced);}else{if(_0x18dba3[_0x3eaafa(0x211c)]&&typeof _0x18dba3[_0x3eaafa(0x211c)]===_0x3eaafa(0x28d)){if(_0x18dba3[_0x3eaafa(0x211c)]['name']&&typeof _0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x1a1c)]==='string'){if(_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x1a4b)]===_0x3eaafa(0x16fc))_0x309c09=_0x3eaafa(0x1f42)+_0x18dba3['content'][_0x3eaafa(0x1a1c)];else _0x18dba3['content'][_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1fe3)?_0x309c09=_0x3eaafa(0x1f98)+_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x1a1c)]:_0x309c09=_0x3eaafa(0x65e)+_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x1a1c)];}else _0x309c09=_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x1e8e)]||_0x18dba3['content'][_0x3eaafa(0x1378)]||_0x3eaafa(0x1ced);}else _0x309c09=String(_0x18dba3[_0x3eaafa(0x211c)]||'');}}_0x2ef08c===_0x3eaafa(0x1d8d)&&(_0x309c09=processOfflineContent(_0x309c09)),_0x309c09=processMentions(_0x309c09),_0x18dba3[_0x3eaafa(0x1dbe)]?_0x443c2a=generateReplyHTML(_0x18dba3['replyTo'])+_0x309c09:_0x443c2a=_0x309c09;}}}}}}let _0x433399='';!_0xd9c64b[_0x3eaafa(0xdea)]&&(_0x433399=generateAvatarHtml({'avatarUrl':_0x250b75,'backgroundColor':_0x2eb58f,'displayName':_0x30dc1c,'timestamp':_0x18dba3['timestamp'],'timestampEnabled':_0x3e3b3e,'timestampPosition':_0x2721ff,'chatSettings':_0xd9c64b,'onClick':_0x5b623c?_0x3eaafa(0x1f4c)+_0x5b623c['id']+'\x27)':'','title':_0x5b623c?_0x3eaafa(0xfd9):_0x30dc1c}));let _0x5303e3='';_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x13ed)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x78a)||_0x18dba3['type']===_0x3eaafa(0xd38)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2184)||_0x18dba3[_0x3eaafa(0x1a4b)]==='ai_image'||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2051)?_0x5303e3=_0x443c2a:_0x5303e3=_0x3eaafa(0x2072)+_0xf90d7f+_0x3eaafa(0xe1f)+_0x1592c1+_0x3eaafa(0x3a1)+_0x5e0c25+_0x3eaafa(0x2206)+_0x443c2a+_0x3eaafa(0x137a)+(_0x18dba3[_0x3eaafa(0x68e)]&&!_0x18dba3[_0x3eaafa(0x1a4b)]?_0x3eaafa(0xf7c)+_0x18dba3[_0x3eaafa(0x68e)]+_0x3eaafa(0x794)+(_0x18dba3[_0x3eaafa(0x8e7)]?_0x3eaafa(0x1c8a):_0x3eaafa(0x1a8a))+'\x22\x20onclick=\x22showImage(\x27'+_0x18dba3[_0x3eaafa(0x68e)]+_0x3eaafa(0x13d8):'')+_0x3eaafa(0xc17)+(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0x84c)?_0x3eaafa(0x1281)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+_0x3eaafa(0x1844):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0x1220)?_0x3eaafa(0x3d5)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+'</div>':'')+_0x3eaafa(0xbb3);if(_0x176c7c&&_0x35df77&&_0x30dc1c!==_0x3eaafa(0xaae)){_0xf50175[_0x3eaafa(0x1c1b)]['add']('group-message-item');const _0x5cf2b1=_0x3eaafa(0x67f)+_0x30dc1c+_0x3eaafa(0x1844);_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x13ed)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x78a)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1a36)||_0x18dba3[_0x3eaafa(0x1a4b)]==='user_photo'||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2184)||_0x18dba3['type']===_0x3eaafa(0x2051)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1c97)?_0xf50175[_0x3eaafa(0x33a)]=_0x433399+('<div\x20class=\x22bubble-wrapper\x22>'+_0x5cf2b1+_0x5303e3+'</div>'):_0xf50175[_0x3eaafa(0x33a)]=_0x433399+(_0x3eaafa(0x14c7)+_0x5cf2b1+_0x5303e3+_0x3eaafa(0x1844));}else _0xf50175[_0x3eaafa(0x33a)]=_0x433399+_0x5303e3;}else{let _0x1b5762=_0xd9c64b[_0x3eaafa(0x11cd)],_0x24e6be=_0xd9c64b['myChatNickname'];if((!_0x1b5762||!_0x24e6be)&&_0xd9c64b[_0x3eaafa(0x145e)]){const _0x4afd34=personas[_0x3eaafa(0xaf4)](_0x341fb3=>_0x341fb3['id']===_0xd9c64b[_0x3eaafa(0x145e)]);if(_0x4afd34){if(!_0x1b5762)_0x1b5762=_0x4afd34[_0x3eaafa(0x1994)];if(!_0x24e6be)_0x24e6be=_0x4afd34[_0x3eaafa(0x1a1c)];}}const _0x473b94=_0xd9c64b[_0x3eaafa(0xbfa)]||'#007AFF',_0x4f8cf2=_0xd9c64b[_0x3eaafa(0x1dff)]||'1',_0x4bb534=isLightColor(_0x473b94)?_0x3eaafa(0x22d0):_0x3eaafa(0x1a7),_0x4a6947=_0xd9c64b[_0x3eaafa(0x735)]||'12',_0x5d9251=convertColorWithOpacity(_0x473b94,_0x4f8cf2);let _0x3e6c19='';if(_0x18dba3[_0x3eaafa(0x1a4b)]==='user_photo')_0x3e6c19=_0x3eaafa(0x760)+(_0x18dba3['photoDescription']||_0x18dba3[_0x3eaafa(0x211c)])[_0x3eaafa(0xe16)](/'/g,'\x5c\x27')[_0x3eaafa(0xe16)](/"/g,_0x3eaafa(0xb65))+_0x3eaafa(0x1154)+(_0x18dba3[_0x3eaafa(0x1b98)]||_0x18dba3[_0x3eaafa(0x211c)])+_0x3eaafa(0x12aa);else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x561))_0x3e6c19=_0x3eaafa(0x1476)+_0x5d9251+';\x20color:\x20'+_0x4bb534+_0x3eaafa(0x3a1)+_0x4a6947+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22'+_0x18dba3[_0x3eaafa(0x211c)]+_0x3eaafa(0x113b)+(_0x18dba3[_0x3eaafa(0x5a4)]||Math[_0x3eaafa(0x658)](0x1,Math[_0x3eaafa(0x708)](_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0x19ee)]/0x8)))+'\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0x84c)?_0x3eaafa(0x1281)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+'</div>':'')+_0x3eaafa(0xbe0)+(_0x3e3b3e&&_0x2721ff==='inside'?_0x3eaafa(0x3d5)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+_0x3eaafa(0x1844):'')+_0x3eaafa(0x1aa5)+_0x18dba3[_0x3eaafa(0x211c)]+_0x3eaafa(0xc80);else{if(_0x18dba3['type']==='transfer'){let _0x4b72e3='',_0x1a9e93='';if(_0x18dba3[_0x3eaafa(0x12e2)]===_0x3eaafa(0xdfc))_0x1a9e93='<div\x20class=\x22transfer-status\x22>对方已收款</div>',_0x4b72e3='accepted';else _0x18dba3['status']===_0x3eaafa(0xd3b)&&(_0x1a9e93=_0x3eaafa(0x1ce2),_0x4b72e3='rejected');_0x3e6c19=_0x3eaafa(0x1109)+_0x4b72e3+_0x3eaafa(0x1415)+_0x18dba3[_0x3eaafa(0x1716)]+_0x3eaafa(0x70a)+Number(_0x18dba3[_0x3eaafa(0x2018)])[_0x3eaafa(0x13ad)](0x2)+_0x3eaafa(0x1311)+(_0x18dba3[_0x3eaafa(0x1814)]||'转账')+_0x3eaafa(0x15d1)+_0x1a9e93+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0x18dba3['type']==='order_confirmation'){const _0x30a7d7=_0x18dba3[_0x3eaafa(0x1bdf)]||{},_0x34dfde=_0x18dba3[_0x3eaafa(0x1808)]||'';let _0x4b16e9='',_0x46efc7='',_0x285f15='';if(_0x34dfde===_0x3eaafa(0x1ab2))_0x4b16e9=_0x3eaafa(0x1a51),_0x46efc7='',_0x285f15=_0x3eaafa(0x11cb);else _0x34dfde===_0x3eaafa(0x1bcb)&&(_0x4b16e9=_0x3eaafa(0x206d),_0x46efc7='',_0x285f15='success');const _0x3ee28e=_0x30a7d7[_0x3eaafa(0x1775)]?_0x30a7d7[_0x3eaafa(0x1775)][_0x3eaafa(0x6a4)](_0x13509c=>{const _0x17aadb=_0x3eaafa;let _0x1857e0=_0x13509c[_0x17aadb(0x1a1c)];if(_0x13509c[_0x17aadb(0xabc)]&&Object['keys'](_0x13509c[_0x17aadb(0xabc)])[_0x17aadb(0x19ee)]>0x0){const _0x53b146=Object[_0x17aadb(0x2bc)](_0x13509c[_0x17aadb(0xabc)])['map'](([_0x3fcfc5,_0x54b992])=>getOptionLabel(_0x3fcfc5)+':\x20'+_0x54b992)[_0x17aadb(0x122b)](',\x20');_0x1857e0+=_0x17aadb(0x1c2b)+_0x53b146+'</small>';}return _0x17aadb(0x1745)+_0x1857e0+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-quantity\x22>x'+_0x13509c[_0x17aadb(0xb8d)]+_0x17aadb(0x22fe)+(_0x13509c['price']*_0x13509c['quantity'])['toFixed'](0x2)+_0x17aadb(0x1468);})[_0x3eaafa(0x122b)](''):'';_0x3e6c19=_0x3eaafa(0x1de1)+_0x285f15+_0x3eaafa(0x14ad)+_0x4b16e9+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>订单号</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>'+(_0x30a7d7[_0x3eaafa(0xea7)]||_0x3eaafa(0xf4f))+_0x3eaafa(0x636)+(_0x34dfde[_0x3eaafa(0x81f)](_0x3eaafa(0x829))?_0x3eaafa(0xa41):currentChatCharacter?.['name']||'Ta')+_0x3eaafa(0x1140)+new Date(_0x18dba3[_0x3eaafa(0x1716)])[_0x3eaafa(0xecc)]('zh-CN',{'month':_0x3eaafa(0xc79),'day':_0x3eaafa(0xc79),'hour':'2-digit','minute':_0x3eaafa(0xc79)})+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-items\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22items-header\x22>商品清单</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3ee28e+_0x3eaafa(0x1de0)+(_0x30a7d7[_0x3eaafa(0x1916)]?_0x30a7d7['total'][_0x3eaafa(0x13ad)](0x2):_0x3eaafa(0x17c0))+_0x3eaafa(0x1142);}else{if(_0x18dba3['type']==='payment_request')_0x3e6c19=generatePaymentRequestContent(_0x18dba3);else{if(_0x18dba3[_0x3eaafa(0x1a4b)]==='shared_post'){const _0xd8b931=_0x18dba3[_0x3eaafa(0x22a3)]||{};_0x3e6c19=_0x3eaafa(0xa63)+_0xd8b931['id']+_0x3eaafa(0x22ef)+(_0xd8b931[_0x3eaafa(0x378)]||_0x3eaafa(0x7be))+_0x3eaafa(0x1da0)+truncateText(_0xd8b931['content']||'',0x32)+_0x3eaafa(0xc80);}else{if(_0x18dba3[_0x3eaafa(0x1a4b)]==='forwarded_message')_0x3e6c19=renderForwardedMessage(_0x18dba3);else{if(_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2184))_0x3e6c19=_0x3eaafa(0xdc9)+_0x18dba3[_0x3eaafa(0x1b93)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x18dba3[_0x3eaafa(0x1b93)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2025%;\x20left:\x2060%;\x20width:\x2014px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2050%;\x20left:\x2015%;\x20width:\x208px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2070%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2010%;\x20left:\x2075%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2075%;\x20left:\x2025%;\x20width:\x207px;\x20height:\x207px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(Array['isArray'](_0x18dba3[_0x3eaafa(0x211c)])){const _0x6f360=_0x18dba3[_0x3eaafa(0x211c)]['find'](_0x50ae13=>_0x50ae13[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1378)),_0x47d757=_0x18dba3[_0x3eaafa(0x211c)][_0x3eaafa(0xaf4)](_0x296f36=>_0x296f36['type']===_0x3eaafa(0x910));let _0x1d90fe=_0x6f360?.['text']||'';_0x1d90fe=processMentions(_0x1d90fe),_0x18dba3[_0x3eaafa(0x1dbe)]?_0x3e6c19=generateReplyHTML(_0x18dba3['replyTo'])+_0x1d90fe:_0x3e6c19=_0x1d90fe,_0x47d757?.['image_url']?.[_0x3eaafa(0x40f)]&&(_0x3e6c19&&(_0x3e6c19+=_0x3eaafa(0xa71)),_0x3e6c19+=_0x3eaafa(0xf7c)+_0x47d757[_0x3eaafa(0x910)]['url']+_0x3eaafa(0x794)+(_0x18dba3[_0x3eaafa(0x8e7)]?_0x3eaafa(0x1c8a):_0x3eaafa(0x1a8a))+_0x3eaafa(0x12cb)+_0x47d757[_0x3eaafa(0x910)][_0x3eaafa(0x40f)]+_0x3eaafa(0x13d8));}else{let _0x33be17=_0x18dba3[_0x3eaafa(0x211c)];_0x33be17=processMentions(_0x33be17),_0x18dba3[_0x3eaafa(0x1dbe)]?_0x3e6c19=generateReplyHTML(_0x18dba3[_0x3eaafa(0x1dbe)])+_0x33be17:_0x3e6c19=_0x33be17;}}}}}}}}}let _0x2d8cc2='';_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0xd38)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x561)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x78a)||_0x18dba3[_0x3eaafa(0x1a4b)]==='location'||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x2051)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1c97)||_0x18dba3[_0x3eaafa(0x1a4b)]===_0x3eaafa(0x1871)?_0x2d8cc2=_0x3e6c19:_0x2d8cc2=_0x3eaafa(0x1a7e)+_0x5d9251+';\x20color:\x20'+_0x4bb534+_0x3eaafa(0x3a1)+_0x4a6947+_0x3eaafa(0x2206)+_0x3e6c19+_0x3eaafa(0x137a)+(_0x18dba3[_0x3eaafa(0x68e)]&&!_0x18dba3[_0x3eaafa(0x1a4b)]&&!Array['isArray'](_0x18dba3[_0x3eaafa(0x211c)])?_0x3eaafa(0xf7c)+_0x18dba3[_0x3eaafa(0x68e)]+_0x3eaafa(0x794)+(_0x18dba3[_0x3eaafa(0x8e7)]?_0x3eaafa(0x1c8a):_0x3eaafa(0x1a8a))+_0x3eaafa(0x12cb)+_0x18dba3[_0x3eaafa(0x68e)]+_0x3eaafa(0x13d8):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0x84c)?_0x3eaafa(0x1281)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+'</div>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3e3b3e&&_0x2721ff===_0x3eaafa(0x1220)?_0x3eaafa(0x3d5)+formatTimeOnly(_0x18dba3[_0x3eaafa(0x1716)])+'</div>':'')+_0x3eaafa(0x1a39);let _0x22b0c6='';!_0xd9c64b['hideAvatars']&&(_0x22b0c6=generateAvatarHtml({'avatarUrl':_0x1b5762,'backgroundColor':_0x3eaafa(0xa44),'displayName':'','timestamp':_0x18dba3['timestamp'],'timestampEnabled':_0x3e3b3e,'timestampPosition':_0x2721ff,'chatSettings':_0xd9c64b})),_0xf50175[_0x3eaafa(0x33a)]=_0x2d8cc2+_0x22b0c6;}_0xf50175[_0x3eaafa(0x14eb)][_0x3eaafa(0x11af)]='0',_0xf50175[_0x3eaafa(0x14eb)]['transform']=_0x3eaafa(0x702),_0xf50175[_0x3eaafa(0x14eb)][_0x3eaafa(0x1022)]=_0x3eaafa(0x1fe4),_0x9ca3a6[_0x3eaafa(0x497)](_0xf50175),addBubbleTail(_0xf50175,_0x18dba3),requestAnimationFrame(()=>{const _0x261d7c=_0x3eaafa;_0xf50175[_0x261d7c(0x14eb)]['opacity']='1',_0xf50175[_0x261d7c(0x14eb)][_0x261d7c(0x201e)]=_0x261d7c(0x18f9);}),addBlockedIndicatorToMessage(_0xf50175,_0x18dba3,_0x3d6a72),addMessageLongPressListener(_0xf50175,_0x18dba3['id']);const _0x35d43e=_0xf50175[_0x3eaafa(0xb30)](_0x3eaafa(0xa99));_0x35d43e&&(_0x35d43e[_0x3eaafa(0x21e9)](_0x3eaafa(0x1679),_0x2ffe3c=>{_0x2ffe3c['preventDefault'](),showMessageMenu(_0x18dba3['id'],_0x2ffe3c);}),_0x35d43e[_0x3eaafa(0x1f36)]=_0x2400c5=>{const _0x362de6=_0x3eaafa;_0x2400c5['target'][_0x362de6(0x62e)]==='IMG'&&_0x2400c5[_0x362de6(0x193d)]['classList'][_0x362de6(0x971)]('message-image')&&showImage(_0x2400c5[_0x362de6(0x193d)][_0x362de6(0x45c)]);});}),!_0x3e77bd&&setTimeout(()=>{const _0x545673=_0x43c943;_0x9ca3a6[_0x545673(0x98c)]=_0x9ca3a6[_0x545673(0xfe3)];},0x64),setTimeout(()=>{const _0x5d0471=_0x43c943,_0x4ba39f=_0x9ca3a6[_0x5d0471(0x1897)]('.message-container.sent');_0x4ba39f[_0x5d0471(0x19fb)](_0x47cfae=>{const _0x5048ef=_0x5d0471,_0x43d957=_0x47cfae[_0x5048ef(0xb30)](_0x5048ef(0x14bd));if(_0x43d957&&_0x47cfae[_0x5048ef(0xb30)](_0x5048ef(0xa99))){const _0x54f57c=_0x47cfae['querySelector'](_0x5048ef(0xa99)),_0x4eb49d=_0x47cfae[_0x5048ef(0xb30)](_0x5048ef(0x15aa));if(_0x54f57c&&_0x43d957[_0x5048ef(0x216a)](_0x5048ef(0xa99))){const _0x3e73f4=_0x43d957['closest'](_0x5048ef(0x138f));_0x3e73f4&&(_0x47cfae[_0x5048ef(0x33a)]=_0x3e73f4[_0x5048ef(0xc25)]+(_0x4eb49d?_0x4eb49d[_0x5048ef(0xc25)]:''));}}});if(currentChatCharacter){const _0x4b8f3a=document['querySelector']('#api-chat-screen\x20.header');_0x4b8f3a&&renderCharacterStatus(currentChatCharacter['id'],_0x4b8f3a);}},0x32);}function loadMoreMessages(_0x14022c){const _0xb3391c=_0x211817,_0x28376a=document[_0xb3391c(0x1262)](_0xb3391c(0x19a8)),_0x48edb2=chatMessages[_0x14022c]||[],_0x2a45=getCurrentChatSettings(),_0x57174e=_0x28376a[_0xb3391c(0xfe3)],_0x40c94f=_0x28376a[_0xb3391c(0x98c)],_0x4e8187=Math[_0xb3391c(0x658)](0x0,currentMessageOffset-MESSAGE_LIMIT),_0x203559=_0x48edb2[_0xb3391c(0x6d5)](_0x4e8187,currentMessageOffset),_0x27d78f=_0x28376a[_0xb3391c(0xb30)](_0xb3391c(0xc63));_0x27d78f&&_0x27d78f[_0xb3391c(0x1493)]();if(_0x4e8187>0x0){const _0x5a63be=document[_0xb3391c(0xac6)](_0xb3391c(0xbbc));_0x5a63be[_0xb3391c(0x1722)]=_0xb3391c(0x1706),_0x5a63be[_0xb3391c(0x33a)]=_0xb3391c(0x737)+_0x4e8187+_0xb3391c(0x1de2),_0x5a63be[_0xb3391c(0x1f36)]=()=>loadMoreMessages(_0x14022c),_0x28376a[_0xb3391c(0x1f04)](_0x5a63be,_0x28376a['firstChild']);}const _0x56d4f6=_0x2a45['timestampEnabled']!==![],_0x13e97c=_0x2a45[_0xb3391c(0x1c3)]||_0xb3391c(0xcef);let _0x31c476=0x0;for(let _0xb24fd1=_0x203559[_0xb3391c(0x19ee)]-0x1;_0xb24fd1>=0x0;_0xb24fd1--){const _0x581db3=_0x203559[_0xb24fd1];if(_0x581db3[_0xb3391c(0x8a1)]===_0xb3391c(0x1744)){if(_0x581db3[_0xb3391c(0x1144)]){const _0x292c4b=document[_0xb3391c(0xac6)](_0xb3391c(0xbbc));_0x292c4b[_0xb3391c(0x14eb)]['display']='flex',_0x292c4b[_0xb3391c(0x14eb)][_0xb3391c(0x1b5f)]=_0xb3391c(0xcef),_0x292c4b['style'][_0xb3391c(0xfe0)]=_0xb3391c(0x20a1),_0x292c4b[_0xb3391c(0x1ecd)][_0xb3391c(0x21c8)]=_0x581db3['id'];const _0x42e90e=document[_0xb3391c(0xac6)](_0xb3391c(0xbbc));_0x42e90e[_0xb3391c(0x1722)]=_0xb3391c(0x319),_0x42e90e[_0xb3391c(0x13be)]=_0x581db3[_0xb3391c(0x211c)]||'消息已发出，但被对方拒收了',_0x292c4b[_0xb3391c(0x497)](_0x42e90e);const _0x169277=_0x28376a[_0xb3391c(0xb30)](_0xb3391c(0xc63));_0x169277?_0x169277[_0xb3391c(0x148c)][_0xb3391c(0x1f04)](_0x292c4b,_0x169277[_0xb3391c(0x1b0a)]):_0x28376a[_0xb3391c(0x1f04)](_0x292c4b,_0x28376a[_0xb3391c(0xb60)]);continue;}let _0x3d866a;if(_0x581db3[_0xb3391c(0x1b0b)]){const _0x588875=document['createElement'](_0xb3391c(0xbbc));_0x588875[_0xb3391c(0x1722)]=_0xb3391c(0x1c28);const _0x334812=document['createElement'](_0xb3391c(0xbbc));_0x334812[_0xb3391c(0x1722)]=_0xb3391c(0x1f4d),_0x334812[_0xb3391c(0x13be)]=_0x581db3[_0xb3391c(0x211c)],_0x588875['appendChild'](_0x334812),_0x3d866a=_0x588875;}else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x21f6)){const _0x34cb74=document[_0xb3391c(0xac6)]('div');_0x34cb74[_0xb3391c(0x14eb)]['display']=_0xb3391c(0x1fb7),_0x34cb74['style'][_0xb3391c(0x1b5f)]=_0xb3391c(0xcef),_0x34cb74['style']['margin']=_0xb3391c(0x20a1),_0x34cb74['dataset'][_0xb3391c(0x21c8)]=_0x581db3['id'];const _0x5ea848=document[_0xb3391c(0xac6)]('div');_0x5ea848[_0xb3391c(0x1722)]='recalled-message';const _0x1db9d5=_0x581db3[_0xb3391c(0x211c)]['split']('\x0a'),_0xc17dda=_0x1db9d5[0x0];let _0x3d20b8=_0x1db9d5[0x1];_0x5ea848[_0xb3391c(0x13be)]=_0xc17dda;if(_0x3d20b8){if(_0x3d20b8[_0xb3391c(0x1b30)](_0xb3391c(0x2234))){const _0x528722=document['createElement'](_0xb3391c(0xbbc));_0x528722[_0xb3391c(0x1722)]=_0xb3391c(0x1a35),_0x528722['textContent']=_0x3d20b8,_0x5ea848['appendChild'](_0x528722);}else{const _0x149fd3=document[_0xb3391c(0xac6)](_0xb3391c(0xbbc));_0x149fd3[_0xb3391c(0x1722)]=_0xb3391c(0x1a35),_0x149fd3[_0xb3391c(0x13be)]=_0xb3391c(0x2234)+_0x3d20b8,_0x5ea848[_0xb3391c(0x497)](_0x149fd3);}}else{if(_0x581db3[_0xb3391c(0x122d)]){const _0x206542=document[_0xb3391c(0xac6)]('div');_0x206542[_0xb3391c(0x1722)]=_0xb3391c(0x1a35),_0x206542[_0xb3391c(0x13be)]=_0xb3391c(0x2234)+_0x581db3[_0xb3391c(0x122d)],_0x5ea848[_0xb3391c(0x497)](_0x206542);}}_0x34cb74[_0xb3391c(0x497)](_0x5ea848),_0x3d866a=_0x34cb74;}else{const _0x437be4=document['createElement'](_0xb3391c(0xbbc));_0x437be4[_0xb3391c(0x14eb)]['display']=_0xb3391c(0x1fb7),_0x437be4[_0xb3391c(0x14eb)][_0xb3391c(0x1b5f)]=_0xb3391c(0xcef),_0x437be4['style'][_0xb3391c(0xfe0)]=_0xb3391c(0x20a1);const _0xd216a9=document[_0xb3391c(0xac6)]('div');_0x581db3['isFriendAddedMessage']?_0xd216a9[_0xb3391c(0x1722)]='friend-added-system-message':_0xd216a9[_0xb3391c(0x1722)]=_0xb3391c(0x319),_0xd216a9[_0xb3391c(0x13be)]=_0x581db3[_0xb3391c(0x211c)],_0x437be4[_0xb3391c(0x497)](_0xd216a9),_0x3d866a=_0x437be4;}}const _0x30375e=_0x28376a['querySelector'](_0xb3391c(0xc63));_0x30375e?_0x30375e[_0xb3391c(0x148c)][_0xb3391c(0x1f04)](_0x3d866a,_0x30375e[_0xb3391c(0x1b0a)]):_0x28376a['insertBefore'](_0x3d866a,_0x28376a[_0xb3391c(0xb60)]);_0x581db3[_0xb3391c(0x1a4b)]==='recalled_message'&&addMessageLongPressListener(_0x3d866a,_0x581db3['id']);continue;}const _0x26d18f=document[_0xb3391c(0xac6)](_0xb3391c(0xbbc)),_0x498310=_0x581db3[_0xb3391c(0x8e7)]&&!_0x581db3[_0xb3391c(0x211c)];_0x26d18f['className']=_0xb3391c(0x1f05)+_0x581db3[_0xb3391c(0x8a1)]+(_0x2a45[_0xb3391c(0xdea)]?'\x20no-avatar':'')+(_0x498310?'\x20emoji-only':''),_0x26d18f[_0xb3391c(0x1ecd)][_0xb3391c(0x21c8)]=_0x581db3['id'];if(_0x581db3[_0xb3391c(0x8a1)]===_0xb3391c(0xb11)){let _0x458815=characters[_0xb3391c(0xaf4)](_0x78cee0=>_0x78cee0['id']===_0x14022c),_0x4758fc=![],_0x4a3f68=null;!_0x458815&&(_0x4a3f68=groupChats[_0xb3391c(0xaf4)](_0x2581fa=>_0x2581fa['id']===_0x14022c),_0x4a3f68&&(_0x4758fc=!![]));let _0x4e3e20='',_0x43620c='',_0x4d9aca='#4CAF50';if(_0x4758fc&&_0x4a3f68){let _0x2b830a=null;if(_0x581db3[_0xb3391c(0x12c8)])_0x2b830a=_0x4a3f68['members']['find'](_0x1a7b05=>_0x1a7b05['id']===_0x581db3[_0xb3391c(0x12c8)]);else _0x581db3[_0xb3391c(0x1a1c)]&&(_0x2b830a=_0x4a3f68[_0xb3391c(0x12a6)][_0xb3391c(0xaf4)](_0x2083de=>_0x2083de['name']===_0x581db3[_0xb3391c(0x1a1c)]));_0x2b830a?(_0x4e3e20=_0x2b830a[_0xb3391c(0x1994)]||'',_0x43620c=_0x2b830a[_0xb3391c(0x1a1c)],_0x4d9aca=_0x2b830a[_0xb3391c(0xc3d)]||_0xb3391c(0x1d8c)):(_0x4e3e20='',_0x43620c=_0x581db3[_0xb3391c(0x1a1c)]||'群成员',_0x4d9aca=_0xb3391c(0x1d8c));}else _0x458815?(_0x4e3e20=_0x2a45[_0xb3391c(0x179f)]||_0x458815[_0xb3391c(0x1994)],_0x43620c=_0x2a45[_0xb3391c(0x4e7)]||_0x458815[_0xb3391c(0x1a1c)],_0x4d9aca=_0x458815[_0xb3391c(0xc3d)]||_0xb3391c(0x1d8c)):(_0x4e3e20='',_0x43620c='未知',_0x4d9aca=_0xb3391c(0x1d8c));let _0x2d2cea=_0x2a45[_0xb3391c(0xeaf)]||_0xb3391c(0x7ae);if(_0x4758fc&&_0x4a3f68&&_0x581db3[_0xb3391c(0x12c8)]&&_0x2a45[_0xb3391c(0x1541)]){const _0x322440=_0x2a45['memberBubbleColors'][_0x581db3[_0xb3391c(0x12c8)]];_0x322440&&(_0x2d2cea=_0x322440);}const _0x3812c2=_0x2a45[_0xb3391c(0x2fd)]||'1',_0xe3f88c=isLightColor(_0x2d2cea)?_0xb3391c(0x22d0):_0xb3391c(0x1a7),_0x5eb43d=_0x2a45['bubblePadding']||'12',_0x2ba4a3=convertColorWithOpacity(_0x2d2cea,_0x3812c2);let _0x3b6887='';if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x13ed)){const _0x1c31bc=_0x581db3[_0xb3391c(0x211c)]['replace'](/\([^)]*\)\s*/g,'')[_0xb3391c(0x19d7)](),_0x139032=_0x581db3[_0xb3391c(0x5a4)]||Math[_0xb3391c(0x658)](0x1,Math[_0xb3391c(0x708)](_0x1c31bc[_0xb3391c(0x19ee)]/0x8));_0x3b6887=_0xb3391c(0xcb7)+_0x2ba4a3+_0xb3391c(0xe1f)+_0xe3f88c+';\x20position:\x20relative;\x20padding:\x20'+_0x5eb43d+_0xb3391c(0x19f1)+_0x1c31bc+_0xb3391c(0x113b)+_0x139032+_0xb3391c(0x1f33)+_0x1c31bc+_0xb3391c(0xc80);}else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1a36)){const _0x2ed83f=_0x581db3[_0xb3391c(0x646)]||_0x581db3[_0xb3391c(0x211c)]||_0xb3391c(0xbb8);_0x3b6887='<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27'+_0x2ed83f[_0xb3391c(0xe16)](/'/g,'\x5c\x27')[_0xb3391c(0xe16)](/"/g,_0xb3391c(0xb65))+_0xb3391c(0xe6d)+_0x2ed83f+'</div></div></div></div>';}else{if(_0x581db3['type']===_0xb3391c(0x78a)){const _0x38fcce=_0x581db3[_0xb3391c(0x464)]==='user',_0x446ef6=_0x38fcce?'💕':'💖',_0x39978b=_0x38fcce?_0xb3391c(0x771):_0xb3391c(0x196a);let _0x389896='',_0x2c5464='',_0x26d85c='';if(_0x581db3['status']==='accepted')_0x2c5464=_0xb3391c(0x39f)+(_0x38fcce?_0xb3391c(0x1c0f):_0xb3391c(0xeb8))+_0xb3391c(0x1844),_0x389896=_0xb3391c(0xdfc);else{if(_0x581db3[_0xb3391c(0x12e2)]===_0xb3391c(0xd3b))_0x2c5464=_0xb3391c(0x39f)+(_0x38fcce?'对方已退回':_0xb3391c(0x9e0))+_0xb3391c(0x1844),_0x389896=_0xb3391c(0xd3b);else!_0x38fcce&&(_0x26d85c=_0xb3391c(0xaee)+JSON['stringify'](_0x581db3)['replace'](/"/g,_0xb3391c(0xb65))+')\x22');}_0x3b6887=_0xb3391c(0x1aaf)+_0x389896+_0xb3391c(0x1415)+_0x581db3['timestamp']+'\x22\x20'+_0x26d85c+_0xb3391c(0x1a46)+_0x446ef6+'\x20'+_0x39978b+_0xb3391c(0x565)+Number(_0x581db3[_0xb3391c(0x2018)])[_0xb3391c(0x13ad)](0x2)+_0xb3391c(0xb41)+(_0x581db3['note']||'转账')+_0xb3391c(0x1844)+_0x2c5464+'</div></div>';}else{if(_0x581db3['type']===_0xb3391c(0xa0c)){const _0x47c666=_0x581db3[_0xb3391c(0x22a3)]||{};_0x3b6887=_0xb3391c(0xa63)+_0x47c666['id']+_0xb3391c(0x22ef)+(_0x47c666[_0xb3391c(0x378)]||_0xb3391c(0x7be))+_0xb3391c(0x1da0)+truncateText(_0x47c666['content']||'',0x32)+_0xb3391c(0xc80);}else{if(_0x581db3[_0xb3391c(0x1a4b)]==='forwarded_message')_0x3b6887=renderForwardedMessage(_0x581db3);else{if(_0x581db3['type']===_0xb3391c(0x2051)){let _0x596555;if(_0x581db3['friendRequestProcessed']){const _0x36b61e=_0x581db3[_0xb3391c(0x2ca)]?'已同意':_0xb3391c(0x17d8),_0x1d4700=_0x581db3[_0xb3391c(0x2ca)]?_0xb3391c(0xdfc):_0xb3391c(0xd3b);_0x596555=_0xb3391c(0xcb4)+_0x1d4700+'\x22>'+_0x36b61e+_0xb3391c(0x1844);}else _0x596555=_0xb3391c(0x13d6)+currentChatCharacter?.['id']+_0xb3391c(0x16d8)+_0x581db3['id']+'\x27)\x22>同意</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20reject\x22\x20onclick=\x22handleAIFriendRequest(\x27'+currentChatCharacter?.['id']+'\x27,\x20false,\x20\x27'+_0x581db3['id']+'\x27)\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';_0x3b6887=_0xb3391c(0x19c7)+(_0x581db3[_0xb3391c(0x1e8e)]||'想和你重新做朋友')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x596555+_0xb3391c(0x1f71);}else{if(_0x581db3['type']===_0xb3391c(0x1871))_0x3b6887=_0xb3391c(0x137f)+(_0x581db3['content']||_0xb3391c(0x1e4c))+'</div>';else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1c97))_0x3b6887=generateAIOrderConfirmationContent(_0x581db3);else{const _0x37e806=_0x2a45['chatMode']||_0xb3391c(0x38b);let _0x17beba=_0x37e806===_0xb3391c(0x1d8d)?processOfflineContent(_0x581db3['content']):_0x581db3[_0xb3391c(0x211c)];_0x581db3['replyTo']?_0x3b6887=generateReplyHTML(_0x581db3[_0xb3391c(0x1dbe)])+_0x17beba:_0x3b6887=_0x17beba;}}}}}}}}let _0x355c74='';!_0x2a45[_0xb3391c(0xdea)]&&(_0x355c74=generateAvatarHtml({'avatarUrl':_0x4e3e20,'backgroundColor':_0x4d9aca,'displayName':_0x43620c,'onClick':_0x458815?_0xb3391c(0x1f4c)+_0x458815['id']+'\x27)':null,'title':_0x458815?_0xb3391c(0xfd9):_0x43620c,'timestamp':_0x581db3[_0xb3391c(0x1716)],'timestampEnabled':_0x56d4f6,'timestampPosition':_0x13e97c,'chatSettings':_0x2a45}));let _0x35581a='';_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x13ed)||_0x581db3[_0xb3391c(0x1a4b)]==='transfer'||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1a36)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0xd38)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x2184)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x2051)?_0x35581a=_0x3b6887:_0x35581a=_0xb3391c(0x903)+_0x2ba4a3+_0xb3391c(0xe1f)+_0xe3f88c+_0xb3391c(0x3a1)+_0x5eb43d+_0xb3391c(0xa86)+_0x3b6887+(_0x581db3[_0xb3391c(0x68e)]&&!_0x581db3[_0xb3391c(0x1a4b)]?_0xb3391c(0xf7c)+_0x581db3[_0xb3391c(0x68e)]+_0xb3391c(0x794)+(_0x581db3['isEmoji']?'message-emoji':_0xb3391c(0x1a8a))+_0xb3391c(0x12cb)+_0x581db3[_0xb3391c(0x68e)]+_0xb3391c(0x13d8):'')+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x84c)?'<div\x20class=\x22timestamp\x20timestamp-bubble\x22>'+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+'</div>':'')+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x1220)?_0xb3391c(0x3d5)+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+_0xb3391c(0x1844):'')+'</div>';if(_0x4758fc&&_0x4a3f68&&_0x43620c!==_0xb3391c(0xaae)){_0x26d18f[_0xb3391c(0x1c1b)][_0xb3391c(0x21e2)](_0xb3391c(0x1da3));const _0x4b676d=_0xb3391c(0x67f)+_0x43620c+_0xb3391c(0x1844);_0x581db3['type']===_0xb3391c(0x13ed)||_0x581db3['type']===_0xb3391c(0x78a)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1a36)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0xd38)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x2184)||_0x581db3['type']===_0xb3391c(0x2051)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1c97)?_0x26d18f['innerHTML']=_0x355c74+(_0xb3391c(0x14c7)+_0x4b676d+_0x35581a+_0xb3391c(0x1844)):_0x26d18f[_0xb3391c(0x33a)]=_0x355c74+(_0xb3391c(0x14c7)+_0x4b676d+_0x35581a+_0xb3391c(0x1844));}else _0x26d18f[_0xb3391c(0x33a)]=_0x355c74+_0x35581a;}else{let _0x3724ad=_0x2a45['myChatAvatar'];if(!_0x3724ad&&_0x2a45[_0xb3391c(0x145e)]){const _0x5dbcba=personas['find'](_0x8d9d06=>_0x8d9d06['id']===_0x2a45[_0xb3391c(0x145e)]);_0x5dbcba&&_0x5dbcba['avatarUrl']&&(_0x3724ad=_0x5dbcba[_0xb3391c(0x1994)]);}const _0x3092cb=_0x2a45[_0xb3391c(0xbfa)]||_0xb3391c(0xa44),_0x300556=_0x2a45[_0xb3391c(0x1dff)]||'1',_0x4ec539=isLightColor(_0x3092cb)?'#333':_0xb3391c(0x1a7),_0x107950=_0x2a45[_0xb3391c(0x735)]||'12',_0x54f560=convertColorWithOpacity(_0x3092cb,_0x300556);let _0x40f2a4='';if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0xd38))_0x40f2a4=_0xb3391c(0x107f)+(_0x581db3['photoDescription']||_0x581db3['content'])[_0xb3391c(0xe16)](/'/g,'\x5c\x27')[_0xb3391c(0xe16)](/"/g,'&quot;')+'\x27)\x22><div\x20class=\x22dreamy-photo\x22><div\x20class=\x22photo-misty-bg\x22></div><div\x20class=\x22photo-badge\x22><i\x20class=\x22fas\x20fa-image\x22></i></div><div\x20class=\x22sparkle-container\x22><div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div></div><div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22><div\x20class=\x22photo-description\x22>'+(_0x581db3[_0xb3391c(0x1b98)]||_0x581db3[_0xb3391c(0x211c)])+'</div></div></div></div>';else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x561))_0x40f2a4=_0xb3391c(0x1476)+_0x54f560+_0xb3391c(0xe1f)+_0x4ec539+';\x20position:\x20relative;\x20padding:\x20'+_0x107950+_0xb3391c(0x19f1)+_0x581db3[_0xb3391c(0x211c)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>'+(_0x581db3[_0xb3391c(0x5a4)]||Math[_0xb3391c(0x658)](0x1,Math[_0xb3391c(0x708)](_0x581db3[_0xb3391c(0x211c)][_0xb3391c(0x19ee)]/0x8)))+_0xb3391c(0x217b)+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x84c)?_0xb3391c(0x1281)+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+'</div>':'')+_0xb3391c(0xbe0)+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x1220)?'<div\x20class=\x22timestamp\x20timestamp-inside\x22>'+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+_0xb3391c(0x1844):'')+_0xb3391c(0x1aa5)+_0x581db3[_0xb3391c(0x211c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x78a)){let _0x255e32='',_0x47fc63='';if(_0x581db3[_0xb3391c(0x12e2)]==='accepted')_0x47fc63=_0xb3391c(0x8dc),_0x255e32='accepted';else _0x581db3[_0xb3391c(0x12e2)]===_0xb3391c(0xd3b)&&(_0x47fc63=_0xb3391c(0x1ce2),_0x255e32=_0xb3391c(0xd3b));_0x40f2a4=_0xb3391c(0x1109)+_0x255e32+_0xb3391c(0x1415)+_0x581db3[_0xb3391c(0x1716)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>💕\x20你发起的转账</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20'+Number(_0x581db3[_0xb3391c(0x2018)])[_0xb3391c(0x13ad)](0x2)+_0xb3391c(0x1311)+(_0x581db3[_0xb3391c(0x1814)]||'转账')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x47fc63+_0xb3391c(0xf74);}else{if(_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x2184))_0x40f2a4=_0xb3391c(0xdc9)+_0x581db3['locationName']+_0xb3391c(0x105d)+_0x581db3['locationName']+_0xb3391c(0x1307);else{if(Array[_0xb3391c(0x1496)](_0x581db3[_0xb3391c(0x211c)])){const _0x3dffa5=_0x581db3[_0xb3391c(0x211c)][_0xb3391c(0xaf4)](_0x3faa9f=>_0x3faa9f[_0xb3391c(0x1a4b)]===_0xb3391c(0x1378)),_0x1e834e=_0x581db3[_0xb3391c(0x211c)][_0xb3391c(0xaf4)](_0x39dc3a=>_0x39dc3a[_0xb3391c(0x1a4b)]===_0xb3391c(0x910));let _0x569bd0=_0x3dffa5?.['text']||'';_0x569bd0=processMentions(_0x569bd0),_0x581db3[_0xb3391c(0x1dbe)]?_0x40f2a4=generateReplyHTML(_0x581db3[_0xb3391c(0x1dbe)])+_0x569bd0:_0x40f2a4=_0x569bd0,_0x1e834e?.[_0xb3391c(0x910)]?.[_0xb3391c(0x40f)]&&(_0x40f2a4&&(_0x40f2a4+=_0xb3391c(0xa71)),_0x40f2a4+=_0xb3391c(0xf7c)+_0x1e834e['image_url'][_0xb3391c(0x40f)]+_0xb3391c(0x794)+(_0x581db3[_0xb3391c(0x8e7)]?'message-emoji':_0xb3391c(0x1a8a))+_0xb3391c(0x12cb)+_0x1e834e['image_url'][_0xb3391c(0x40f)]+'\x27)\x22>');}else{let _0xf14fd=_0x581db3[_0xb3391c(0x211c)];_0xf14fd=processMentions(_0xf14fd),_0x581db3[_0xb3391c(0x1dbe)]?_0x40f2a4=generateReplyHTML(_0x581db3[_0xb3391c(0x1dbe)])+_0xf14fd:_0x40f2a4=_0xf14fd;}}}}}let _0x2587e1='';_0x581db3['type']===_0xb3391c(0xd38)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x561)||_0x581db3['type']===_0xb3391c(0x78a)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x2184)||_0x581db3['type']===_0xb3391c(0x2051)||_0x581db3[_0xb3391c(0x1a4b)]===_0xb3391c(0x1c97)||_0x581db3['type']===_0xb3391c(0x1871)?_0x2587e1=_0x40f2a4:_0x2587e1=_0xb3391c(0x903)+_0x54f560+_0xb3391c(0xe1f)+_0x4ec539+_0xb3391c(0x3a1)+_0x107950+_0xb3391c(0xa86)+_0x40f2a4+(_0x581db3['image']&&!_0x581db3[_0xb3391c(0x1a4b)]&&!Array[_0xb3391c(0x1496)](_0x581db3[_0xb3391c(0x211c)])?_0xb3391c(0xf7c)+_0x581db3[_0xb3391c(0x68e)]+_0xb3391c(0x794)+(_0x581db3[_0xb3391c(0x8e7)]?_0xb3391c(0x1c8a):_0xb3391c(0x1a8a))+'\x22\x20onclick=\x22showImage(\x27'+_0x581db3['image']+_0xb3391c(0x13d8):'')+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x84c)?_0xb3391c(0x1281)+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+'</div>':'')+(_0x56d4f6&&_0x13e97c===_0xb3391c(0x1220)?_0xb3391c(0x3d5)+formatTimeOnly(_0x581db3[_0xb3391c(0x1716)])+_0xb3391c(0x1844):'')+_0xb3391c(0x1844);let _0x436b4b='';!_0x2a45[_0xb3391c(0xdea)]&&(_0x436b4b=generateAvatarHtml({'avatarUrl':_0x3724ad,'backgroundColor':_0xb3391c(0xa44),'displayName':'','timestamp':_0x581db3['timestamp'],'timestampEnabled':_0x56d4f6,'timestampPosition':_0x13e97c,'chatSettings':_0x2a45})),_0x26d18f['innerHTML']=_0x2587e1+_0x436b4b;}addBlockedIndicatorToMessage(_0x26d18f,_0x581db3,_0x14022c),addMessageLongPressListener(_0x26d18f,_0x581db3['id']);const _0x247027=_0x26d18f['querySelector'](_0xb3391c(0xa99));_0x247027&&(_0x247027[_0xb3391c(0x21e9)](_0xb3391c(0x1679),_0x2a5e83=>{const _0x24cf71=_0xb3391c;_0x2a5e83[_0x24cf71(0x36f)](),showMessageMenu(_0x581db3['id'],_0x2a5e83);}),_0x247027[_0xb3391c(0x1f36)]=_0x23c8a8=>{const _0x15e29e=_0xb3391c;_0x23c8a8['target'][_0x15e29e(0x62e)]===_0x15e29e(0x21b4)&&_0x23c8a8['target'][_0x15e29e(0x1c1b)][_0x15e29e(0x971)](_0x15e29e(0x1a8a))&&showImage(_0x23c8a8['target']['src']);});const _0x1cd30c=_0x28376a[_0xb3391c(0xb30)](_0xb3391c(0xc63));_0x1cd30c?_0x1cd30c[_0xb3391c(0x148c)]['insertBefore'](_0x26d18f,_0x1cd30c[_0xb3391c(0x1b0a)]):_0x28376a[_0xb3391c(0x1f04)](_0x26d18f,_0x28376a['firstChild']);}currentMessageOffset=_0x4e8187,setTimeout(()=>{const _0x392070=_0xb3391c,_0xbd5ee2=_0x28376a[_0x392070(0xfe3)];_0x28376a[_0x392070(0x98c)]=_0x40c94f+(_0xbd5ee2-_0x57174e);},0x32);}function showCharacterForm(_0x3f5c42=null){const _0x4b6f3f=_0x211817;currentEditingCharacterId=_0x3f5c42,document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x18c6))[_0x4b6f3f(0x13be)]=_0x3f5c42?_0x4b6f3f(0x1a61):'新建人物',document[_0x4b6f3f(0x1262)](_0x4b6f3f(0xc9e))[_0x4b6f3f(0x1ebc)]='',document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x10b5))['value']='',document['getElementById'](_0x4b6f3f(0xf6d))[_0x4b6f3f(0x1ebc)]='';const _0x13231a=document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x21a3)),_0xd695d9=document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x1fb9));_0x13231a[_0x4b6f3f(0x1c1b)][_0x4b6f3f(0x1493)]('has-image'),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x1674)](_0x4b6f3f(0x619)),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x1674)](_0x4b6f3f(0xd64)),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x1674)](_0x4b6f3f(0x153c)),_0x13231a[_0x4b6f3f(0x14eb)]['removeProperty']('background-repeat'),_0xd695d9['style'][_0x4b6f3f(0x4da)]=_0x4b6f3f(0x13de),_0xd695d9['textContent']='A',window['selectedAvatarData']=null;if(_0x3f5c42){const _0x27b092=characters['find'](_0x49003c=>_0x49003c['id']===_0x3f5c42);_0x27b092&&(document[_0x4b6f3f(0x1262)](_0x4b6f3f(0xc9e))[_0x4b6f3f(0x1ebc)]=_0x27b092[_0x4b6f3f(0x1a1c)],document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x10b5))[_0x4b6f3f(0x1ebc)]=_0x27b092['bio'],_0x27b092[_0x4b6f3f(0x1994)]?(_0x13231a[_0x4b6f3f(0x1c1b)][_0x4b6f3f(0x21e2)](_0x4b6f3f(0x14fb)),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0xcf0)](_0x4b6f3f(0x619),_0x4b6f3f(0x9f1)+_0x27b092['avatarUrl']+')',_0x4b6f3f(0xd42)),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0xcf0)](_0x4b6f3f(0xd64),_0x4b6f3f(0x12bb),'important'),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0xcf0)]('background-position',_0x4b6f3f(0xcef),_0x4b6f3f(0xd42)),_0x13231a[_0x4b6f3f(0x14eb)][_0x4b6f3f(0xcf0)](_0x4b6f3f(0x81c),'no-repeat',_0x4b6f3f(0xd42)),_0xd695d9[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x4da)]=_0x4b6f3f(0x102b),window[_0x4b6f3f(0x201a)]=_0x27b092[_0x4b6f3f(0x1994)]):_0xd695d9['textContent']=_0x27b092[_0x4b6f3f(0x1a1c)][_0x4b6f3f(0xcc3)](0x0));}const _0x40f9d7=document[_0x4b6f3f(0x1262)](_0x4b6f3f(0x16cd)),_0x1f2288=document[_0x4b6f3f(0x1262)](_0x4b6f3f(0xbf3)),_0x590a9d=document['getElementById'](_0x4b6f3f(0xc98));console[_0x4b6f3f(0x2187)](_0x4b6f3f(0x95b),_0x3f5c42);if(_0x3f5c42){document[_0x4b6f3f(0xb30)](_0x4b6f3f(0x1d46))[_0x4b6f3f(0x1f36)]=async()=>await saveCharacter(_0x3f5c42);if(_0x40f9d7)_0x40f9d7[_0x4b6f3f(0x14eb)]['display']=_0x4b6f3f(0x13de);if(_0x1f2288)_0x1f2288[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x4da)]=_0x4b6f3f(0x102b);if(_0x590a9d)_0x590a9d[_0x4b6f3f(0x14eb)]['display']='flex';console[_0x4b6f3f(0x2187)]('设置为编辑模式，角色ID:',_0x3f5c42);}else{document[_0x4b6f3f(0xb30)](_0x4b6f3f(0x1d46))[_0x4b6f3f(0x1f36)]=async()=>await saveCharacter();if(_0x40f9d7)_0x40f9d7['style'][_0x4b6f3f(0x4da)]='none';if(_0x1f2288)_0x1f2288[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x4da)]=_0x4b6f3f(0x1fb7);if(_0x590a9d)_0x590a9d[_0x4b6f3f(0x14eb)][_0x4b6f3f(0x4da)]=_0x4b6f3f(0x102b);console['log'](_0x4b6f3f(0x36b));}showApp('character-form-screen'),setTimeout(()=>{initializeAvatarUpload();},0x64);}async function saveCharacter(_0x25527e=null){const _0x4820e0=_0x211817;try{console[_0x4820e0(0x2187)](_0x4820e0(0x1e5c));const _0x103d61=document['getElementById'](_0x4820e0(0xc9e))['value']['trim'](),_0x5cdecf=document[_0x4820e0(0x1262)](_0x4820e0(0x10b5))[_0x4820e0(0x1ebc)][_0x4820e0(0x19d7)](),_0x4b3103=window[_0x4820e0(0x201a)];console['log'](_0x4820e0(0x1cdf),_0x103d61,_0x4820e0(0x1a76),!!_0x4b3103);_0x4b3103&&console[_0x4820e0(0x2187)](_0x4820e0(0xaea),_0x4b3103['length'],_0x4820e0(0x22ea),_0x4b3103[_0x4820e0(0x17ca)](0x0,0x32));if(!_0x103d61){alert(_0x4820e0(0x20bd));return;}if(_0x25527e){console[_0x4820e0(0x2187)](_0x4820e0(0x1c4f));const _0x5366cb=characters['findIndex'](_0x38f9e9=>_0x38f9e9['id']===_0x25527e);if(_0x5366cb!==-0x1){const _0x3a7fb1=characters[_0x5366cb][_0x4820e0(0x1994)];characters[_0x5366cb]={...characters[_0x5366cb],'name':_0x103d61,'bio':_0x5cdecf,'avatarUrl':_0x4b3103||characters[_0x5366cb][_0x4820e0(0x1994)]||'','color':characters[_0x5366cb][_0x4820e0(0xc3d)]||getRandomColor()},console['log'](_0x4820e0(0x1f0),characters[_0x5366cb]),_0x4b3103&&_0x4b3103!==_0x3a7fb1&&updateCharacterAvatarInGroups(_0x25527e,_0x4b3103),await saveCharacters(),renderContactList(),renderMessageList(),currentChatCharacter&&currentChatCharacter['id']===_0x25527e&&renderChatMessages(currentChatCharacter['id']),showToast(_0x4820e0(0xced)+_0x103d61+_0x4820e0(0x14de),_0x4820e0(0x11cb)),hideCharacterForm();}}else{console[_0x4820e0(0x2187)](_0x4820e0(0x1a90));const _0x40d10d={'id':Date['now']()[_0x4820e0(0x1878)](),'name':_0x103d61,'bio':_0x5cdecf,'avatarUrl':_0x4b3103||'','color':getRandomColor(),'groupId':_0x4820e0(0xa74)};console[_0x4820e0(0x2187)](_0x4820e0(0x1d4f),_0x40d10d),console[_0x4820e0(0x2187)](_0x4820e0(0x64d),_0x40d10d['avatarUrl']),console[_0x4820e0(0x2187)](_0x4820e0(0x762),_0x40d10d[_0x4820e0(0x1994)]?_0x40d10d['avatarUrl']['length']:0x0),console[_0x4820e0(0x2187)](_0x4820e0(0x674),characters[_0x4820e0(0x19ee)]),characters[_0x4820e0(0x1cd6)](_0x40d10d),console[_0x4820e0(0x2187)](_0x4820e0(0x7b2),characters[_0x4820e0(0x19ee)]),console[_0x4820e0(0x2187)]('角色数组最新状态:',characters),console[_0x4820e0(0x2187)](_0x4820e0(0xdfb)),await saveCharacters(),console[_0x4820e0(0x2187)](_0x4820e0(0xc02),characters),console[_0x4820e0(0x2187)]('开始渲染界面...'),renderContactList(),renderMessageList(),console['log'](_0x4820e0(0x689)),hideCharacterForm(),showToast(_0x4820e0(0xced)+_0x40d10d[_0x4820e0(0x1a1c)]+'\x22\x20创建成功！',_0x4820e0(0x11cb)),console['log'](_0x4820e0(0x759));}}catch(_0x5985f0){console[_0x4820e0(0x174a)]('保存角色时发生错误:',_0x5985f0),alert(_0x4820e0(0x2266)+_0x5985f0[_0x4820e0(0x1e8e)]);}}function clearCharacterForm(){const _0x2c833d=_0x211817;console['log'](_0x2c833d(0x1335)),document[_0x2c833d(0x1262)](_0x2c833d(0xc9e))[_0x2c833d(0x1ebc)]='',document[_0x2c833d(0x1262)](_0x2c833d(0x10b5))['value']='',document[_0x2c833d(0x1262)](_0x2c833d(0xf6d))[_0x2c833d(0x1ebc)]='';const _0x59f869=document[_0x2c833d(0x1262)](_0x2c833d(0x21a3)),_0x20497a=document['getElementById']('avatar-preview-text');_0x59f869[_0x2c833d(0x1c1b)][_0x2c833d(0x1493)](_0x2c833d(0x14fb)),_0x59f869[_0x2c833d(0x14eb)][_0x2c833d(0x1674)](_0x2c833d(0x619)),_0x59f869['style']['removeProperty'](_0x2c833d(0xd64)),_0x59f869[_0x2c833d(0x14eb)][_0x2c833d(0x1674)](_0x2c833d(0x153c)),_0x59f869[_0x2c833d(0x14eb)][_0x2c833d(0x1674)](_0x2c833d(0x81c)),_0x20497a&&(_0x20497a[_0x2c833d(0x14eb)][_0x2c833d(0x4da)]='block',_0x20497a['textContent']='A'),console[_0x2c833d(0x2187)](_0x2c833d(0x2164)),window[_0x2c833d(0x201a)]=null;}function editCharacter(_0xfa3bc0){showCharacterForm(_0xfa3bc0);}function editCharacterFromContactList(_0x3b91d0){showCharacterForm(_0x3b91d0);}function enterMultiSelectMode(_0x3b9413){isMultiSelectMode=!![],selectedCharacters=[_0x3b9413],renderContactList();}function exitMultiSelectMode(){isMultiSelectMode=![],selectedCharacters=[],renderContactList();}function toggleCharacterSelection(_0x2e44dc){const _0x4eb9d4=_0x211817,_0x31cd8a=selectedCharacters['indexOf'](_0x2e44dc);_0x31cd8a>-0x1?selectedCharacters[_0x4eb9d4(0x19b2)](_0x31cd8a,0x1):selectedCharacters['push'](_0x2e44dc),renderContactList();}async function deleteSelectedCharacters(){const _0x3b35c7=_0x211817;if(selectedCharacters['length']===0x0){alert(_0x3b35c7(0x1e1));return;}const _0x55b175=selectedCharacters[_0x3b35c7(0x6a4)](_0x59fea4=>{const _0x122180=_0x3b35c7,_0x329f0e=characters[_0x122180(0xaf4)](_0x11cc98=>_0x11cc98['id']===_0x59fea4);return _0x329f0e?_0x329f0e[_0x122180(0x1a1c)]:'';})['filter'](_0x26f4bc=>_0x26f4bc)[_0x3b35c7(0x122b)]('、');if(confirm(_0x3b35c7(0x4f3)+_0x55b175+_0x3b35c7(0x12f3))){selectedCharacters[_0x3b35c7(0x19fb)](_0x2cef67=>{const _0x2596a6=_0x3b35c7;characters=characters[_0x2596a6(0x1e1f)](_0xe085f=>_0xe085f['id']!==_0x2cef67),contacts=contacts[_0x2596a6(0x1e1f)](_0x36a0a2=>_0x36a0a2!==_0x2cef67),chatMessages[_0x2cef67]&&delete chatMessages[_0x2cef67];}),await saveCharacters(),await saveContacts();try{await saveChatMessagesImmediate(selectedCharacterIds),console[_0x3b35c7(0x2187)](_0x3b35c7(0x15e4));}catch(_0x28a540){console[_0x3b35c7(0x174a)](_0x3b35c7(0xf0c),_0x28a540),await saveChatMessages();}exitMultiSelectMode(),renderMessageList(),alert(_0x3b35c7(0x1640));}}async function deleteCurrentCharacter(){const _0x53e010=_0x211817;if(currentEditingCharacterId){const _0x500f7b=characters['find'](_0xc312b6=>_0xc312b6['id']===currentEditingCharacterId);if(_0x500f7b&&confirm('确定要删除角色\x22'+_0x500f7b[_0x53e010(0x1a1c)]+'\x22吗？\x0a\x0a此操作将删除角色数据、聊天记录和所有设置，不可恢复！')){characters=characters[_0x53e010(0x1e1f)](_0x3502a0=>_0x3502a0['id']!==_0x500f7b['id']),contacts=contacts[_0x53e010(0x1e1f)](_0x1092be=>_0x1092be!==_0x500f7b['id']);chatMessages[_0x500f7b['id']]&&delete chatMessages[_0x500f7b['id']];try{await db['chatSettings'][_0x53e010(0x1f4a)](_0x500f7b['id']),chatSettings[_0x500f7b['id']]&&delete chatSettings[_0x500f7b['id']],localStorage[_0x53e010(0x3b2)](_0x53e010(0xa25)+_0x500f7b['id']),console[_0x53e010(0x2187)](_0x53e010(0x2085)+_0x500f7b[_0x53e010(0x1a1c)]+_0x53e010(0x1357));}catch(_0x119db0){console[_0x53e010(0x174a)](_0x53e010(0x1aa4)+_0x500f7b[_0x53e010(0x1a1c)]+_0x53e010(0x1d56),_0x119db0);}await saveCharacters(),await saveContacts();try{await saveChatMessagesImmediate([currentEditingCharacterId]),console[_0x53e010(0x2187)]('✅\x20[高效单个删除]\x20消息已保存到数据库');}catch(_0x467844){console['error'](_0x53e010(0x2103),_0x467844),await saveChatMessages();}renderContactList(),renderMessageList(),hideCharacterForm(),showToast(_0x53e010(0x150a)+_0x500f7b[_0x53e010(0x1a1c)]+_0x53e010(0x9d4),'success');}}}function updateCharacterAvatarInGroups(_0x379fc2,_0x475689){const _0x55fa8f=_0x211817;characters[_0x55fa8f(0x19fb)](_0x19ce56=>{const _0xca9508=_0x55fa8f;if(_0x19ce56['isGroup']&&_0x19ce56[_0xca9508(0x12a6)]){const _0x289f36=_0x19ce56['members'][_0xca9508(0x150c)](_0x596fb9=>_0x596fb9['id']===_0x379fc2);_0x289f36!==-0x1&&(_0x19ce56[_0xca9508(0x12a6)][_0x289f36]['avatarUrl']=_0x475689,console[_0xca9508(0x2187)](_0xca9508(0x119b)+_0x19ce56[_0xca9508(0x1a1c)]+_0xca9508(0x1ede)+_0x19ce56[_0xca9508(0x12a6)][_0x289f36][_0xca9508(0x1a1c)]+_0xca9508(0xe55)));}}),saveCharacters();}function getRandomColor(){const _0x29833e=_0x211817,_0x5476c3=[_0x29833e(0xf3a),_0x29833e(0xf50),_0x29833e(0x4c2),_0x29833e(0x2171),_0x29833e(0x42f),_0x29833e(0xa44),_0x29833e(0x1133),'#AF52DE'];return _0x5476c3[Math[_0x29833e(0x2180)](Math[_0x29833e(0x11a8)]()*_0x5476c3[_0x29833e(0x19ee)])];}async function startChat(_0x229d34){const _0x212514=_0x211817;await dataLoadedPromise;const _0x336a1f=currentChatCharacter?currentChatCharacter['id']:null;_0x336a1f&&markAsRead(_0x336a1f);hideTypingIndicator();_0x336a1f&&currentReplyTo&&(chatReplyStates[_0x336a1f]={...currentReplyTo});currentChatCharacter=_0x229d34,sessionStorage['setItem'](_0x212514(0x888),_0x229d34['id']);const _0x477657=await getAsyncChatSettings(_0x229d34['id']);let _0x17b393=_0x477657[_0x212514(0x4e7)]||_0x229d34[_0x212514(0x1a1c)];if(_0x229d34[_0x212514(0x1f68)]&&_0x229d34[_0x212514(0x12a6)]){const _0x4dad67=_0x229d34[_0x212514(0x12a6)]['length']+0x1;_0x17b393=_0x17b393+'（'+_0x4dad67+'）';}const _0x40b925=document[_0x212514(0x1262)]('api-chat-title');_0x40b925&&(_0x40b925[_0x212514(0x13be)]=_0x17b393,_0x40b925[_0x212514(0x1c1b)][_0x212514(0x1493)](_0x212514(0x10f8)),_0x40b925['dataset'][_0x212514(0x417)]=_0x17b393);const _0x2973b2=document['querySelector']('#api-chat-screen\x20.header');_0x2973b2&&renderCharacterStatus(_0x229d34['id'],_0x2973b2);updateAiHeartrate(),setTimeout(async()=>{const _0x2dd845=_0x212514,_0xf8957=await getAsyncChatSettings(_0x229d34['id']);if(_0xf8957[_0x2dd845(0x22aa)]){const _0x592403=getCharacterStatus(_0x229d34['id']);(!_0x592403[_0x2dd845(0x16f6)]||_0x592403['activity']==='在线')&&(await generateCharacterStatus(_0x229d34['id']),renderCharacterStatus(_0x229d34['id'],_0x2973b2));}},0x1f4),startCharacterStatusTimer(),updateBlockManageLabel(_0x229d34['isGroup']);!chatMessages[_0x229d34['id']]&&(chatMessages[_0x229d34['id']]=[],console[_0x212514(0x2187)](_0x212514(0x1e67)));resetFloatingButtonsState(),updateChatBlockedStatus();document['getElementById']('api-chat-settings-screen')[_0x212514(0x14eb)]['display']===_0x212514(0x1fb7)&&updateChatSettingsDisplay();const _0x536561=document[_0x212514(0x1262)](_0x212514(0x1cd8));if(_0x536561){const _0x241999=await getAsyncChatSettings(_0x229d34['id']);_0x536561['value']=_0x241999[_0x212514(0x1927)]||'',console[_0x212514(0x2187)](_0x212514(0x1ceb)+_0x229d34[_0x212514(0x1a1c)]+_0x212514(0x992)+(_0x241999['backgroundDiaryTime']||_0x212514(0xd5b)));}const _0x8b452=document['getElementById'](_0x212514(0xcf2));if(_0x8b452){_0x8b452[_0x212514(0x14eb)][_0x212514(0x159c)]=_0x212514(0x102b),_0x8b452['style'][_0x212514(0x577)]=_0x212514(0x2167);_0x229d34[_0x212514(0x1f68)]?_0x8b452['classList'][_0x212514(0x21e2)](_0x212514(0x304)):_0x8b452[_0x212514(0x1c1b)]['remove'](_0x212514(0x304));const _0x2ed920=document[_0x212514(0x1897)](_0x212514(0x2238));_0x2ed920[_0x212514(0x19fb)](_0x42ab8a=>{const _0x2e6f56=_0x212514;_0x229d34[_0x2e6f56(0x1f68)]?_0x42ab8a[_0x2e6f56(0x14eb)]['display']='none':_0x42ab8a['style']['display']='';});const _0x58d6fc=document[_0x212514(0x1262)](_0x212514(0x19a8));if(_0x58d6fc)_0x58d6fc[_0x212514(0x14eb)][_0x212514(0x619)]='';}console[_0x212514(0x2187)](_0x212514(0x585)+_0x229d34[_0x212514(0x1a1c)]+_0x212514(0x1d3e)+_0x229d34['id']+')'),await applyChatBackground(),applyBubbleStyle(),applyCustomBubbleCSS(),applyCustomThemeStyles()[_0x212514(0x1c82)](_0x3770d4=>console[_0x212514(0x174a)](_0x212514(0x1753),_0x3770d4)),initScheduledMomentsSystem(),renderChatMessages(_0x229d34['id']);if(chatReplyStates[_0x229d34['id']])currentReplyTo={...chatReplyStates[_0x229d34['id']]},showReplyPreview();else{currentReplyTo=null;const _0x4c0ef2=document[_0x212514(0x1262)]('reply-preview');_0x4c0ef2&&_0x4c0ef2[_0x212514(0x1493)]();}showApp(_0x212514(0xcf2));}async function backToChatApp(){const _0x321cd8=_0x211817;currentChatCharacter&&markAsRead(currentChatCharacter['id']);sessionStorage[_0x321cd8(0x3b2)]('currentChatCharacterId');currentChatCharacter&&currentReplyTo&&(chatReplyStates[currentChatCharacter['id']]={...currentReplyTo});const _0x4974f9=document[_0x321cd8(0x1262)](_0x321cd8(0xcf2));_0x4974f9&&_0x4974f9[_0x321cd8(0x1c1b)][_0x321cd8(0x1493)]('group-chat');if(currentChatCharacter)try{const _0x4e6a3d=await db[_0x321cd8(0x19bc)][_0x321cd8(0xa24)](_0x321cd8(0x20e1))[_0x321cd8(0x1694)](currentChatCharacter['id'])[_0x321cd8(0x1a7b)]();if(_0x4e6a3d&&_0x4e6a3d[_0x321cd8(0xfa8)]){console['log']('🎨\x20当前聊天\x20'+currentChatCharacter['id']+_0x321cd8(0xebb)),clearCustomThemeStyles();const _0x43f7a7=await db[_0x321cd8(0x1dde)][_0x321cd8(0xb78)]('selectedTheme'),_0x10a226=_0x43f7a7?_0x43f7a7[_0x321cd8(0x245)]:null;(!_0x10a226||_0x10a226===_0x321cd8(0x2b0))&&await applyGlobalCustomTheme();}else console[_0x321cd8(0x2187)](_0x321cd8(0x20e9)+currentChatCharacter['id']+_0x321cd8(0x2207));}catch(_0x49cab8){console[_0x321cd8(0x174a)](_0x321cd8(0x1b33),_0x49cab8);}clearCharacterStatusTimer(),hideAiHeartrate(),hideApp(_0x321cd8(0xcf2)),showApp(_0x321cd8(0x1c2a));}function backToSettings(_0x29696f){const _0x282417=_0x211817;hideApp(_0x29696f),showApp(_0x282417(0x19bd));}function showTypingIndicator(){const _0x53ecbd=_0x211817;console['log']('🔧\x20尝试显示正在输入提示...');const _0x573fc3=document[_0x53ecbd(0x1262)](_0x53ecbd(0x2053));if(!_0x573fc3){console['error'](_0x53ecbd(0xc88));return;}!_0x573fc3['dataset'][_0x53ecbd(0x417)]&&(_0x573fc3[_0x53ecbd(0x1ecd)][_0x53ecbd(0x417)]=_0x573fc3[_0x53ecbd(0x13be)]),_0x573fc3['textContent']=_0x53ecbd(0x2059),_0x573fc3[_0x53ecbd(0x1c1b)][_0x53ecbd(0x21e2)]('typing-status'),console[_0x53ecbd(0x2187)](_0x53ecbd(0x1990));}function hideTypingIndicator(){const _0x4a09c9=_0x211817;console['log'](_0x4a09c9(0x1f17));const _0x37db65=document[_0x4a09c9(0x1262)]('api-chat-title');if(!_0x37db65){console['error'](_0x4a09c9(0xc88));return;}_0x37db65['dataset'][_0x4a09c9(0x417)]?(_0x37db65['textContent']=_0x37db65[_0x4a09c9(0x1ecd)][_0x4a09c9(0x417)],_0x37db65[_0x4a09c9(0x1c1b)]['remove'](_0x4a09c9(0x10f8)),console[_0x4a09c9(0x2187)](_0x4a09c9(0x6dc))):console[_0x4a09c9(0x2187)](_0x4a09c9(0xd52));}function addSystemMessageToChat(_0x23a069){const _0x24f69e=_0x211817,_0x1657f3=document[_0x24f69e(0x1262)]('api-chat-messages');if(!_0x1657f3)return;const _0xca81cb=document[_0x24f69e(0xac6)](_0x24f69e(0xbbc));_0xca81cb[_0x24f69e(0x14eb)][_0x24f69e(0x4da)]=_0x24f69e(0x1fb7),_0xca81cb['style'][_0x24f69e(0x1b5f)]=_0x24f69e(0xcef),_0xca81cb[_0x24f69e(0x14eb)][_0x24f69e(0xfe0)]=_0x24f69e(0x20a1);const _0xa6b224=document[_0x24f69e(0xac6)](_0x24f69e(0xbbc));_0x23a069['isFriendAddedMessage']?_0xa6b224[_0x24f69e(0x1722)]=_0x24f69e(0xb0d):_0xa6b224['className']=_0x24f69e(0x319),_0xa6b224['textContent']=_0x23a069[_0x24f69e(0x211c)],_0xca81cb[_0x24f69e(0x497)](_0xa6b224),_0x1657f3['appendChild'](_0xca81cb),setTimeout(()=>{const _0x33c60b=_0x24f69e;_0x1657f3[_0x33c60b(0x98c)]=_0x1657f3['scrollHeight'];},0x64);}async function handleRecalledMessage(_0x286e6d,_0x45f7c3=null){const _0x5ee1dc=_0x211817;if(!currentChatCharacter)return;console['log'](_0x5ee1dc(0xaef),_0x286e6d,_0x5ee1dc(0xf41),_0x45f7c3);if(_0x45f7c3){const _0x4af28a=chatMessages[currentChatCharacter['id']]||[],_0x16511e=_0x4af28a['find'](_0x5d2b74=>_0x5d2b74['id']===_0x45f7c3);if(_0x16511e){console[_0x5ee1dc(0x2187)](_0x5ee1dc(0x32b)),await new Promise(_0x50eff2=>setTimeout(_0x50eff2,0x4b0)),await _internalRecallMessage(currentChatCharacter['id'],_0x16511e);return;}else{console[_0x5ee1dc(0x1f43)]('🔥\x20[AI撤回]\x20未找到要撤回的消息，创建临时消息'),await _0x512234(_0x286e6d);return;}}else{await _0x512234(_0x286e6d);return;}async function _0x512234(_0x244fc6){const _0x482077=_0x5ee1dc,_0x2975a1=document[_0x482077(0x1262)]('api-chat-messages');if(!_0x2975a1)return null;const _0x43498b=characters[_0x482077(0xaf4)](_0x12796e=>_0x12796e['id']===currentChatCharacter['id']),_0xdd4c3b=getCurrentChatSettings(),_0x5a4ad3=_0xdd4c3b[_0x482077(0x4e7)]||_0x43498b[_0x482077(0x1a1c)],_0x433de8=_0x482077(0x12f2)+Date[_0x482077(0x2eb)]()+'_'+Math[_0x482077(0x11a8)]()[_0x482077(0x1878)](0x24)[_0x482077(0x15fb)](0x2,0x9),_0x22b859=document[_0x482077(0xac6)]('div'),_0x153d88=![];_0x22b859[_0x482077(0x1722)]=_0x482077(0x17fa)+(_0x153d88?_0x482077(0x1086):''),_0x22b859[_0x482077(0x1ecd)][_0x482077(0x21c8)]=_0x433de8;const _0x2db7b2=_0xdd4c3b['aiBubbleColor']||_0x482077(0x7ae),_0x339bc7=_0xdd4c3b[_0x482077(0x2fd)]||'1',_0x3d5bbd=isLightColor(_0x2db7b2)?'#333':_0x482077(0x1a7),_0x418e4e=_0xdd4c3b[_0x482077(0x735)]||'12',_0x44ae97=_0xdd4c3b[_0x482077(0x179f)]||_0x43498b[_0x482077(0x1994)];let _0x292271='';!_0xdd4c3b[_0x482077(0xdea)]&&(_0x292271=_0x482077(0x2194)+_0x43498b[_0x482077(0xc3d)]+';\x20'+(_0x44ae97?_0x482077(0x2236)+_0x44ae97+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+'\x22\x20onclick=\x22pokeCharacter(\x27'+_0x43498b['id']+'\x27)\x22\x20title=\x22戳一戳\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x44ae97?'':_0x5a4ad3[_0x482077(0xcc3)](0x0))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');const _0x125704=convertColorWithOpacity(_0x2db7b2,_0x339bc7);let _0x9c372f=_0x482077(0x2140)+_0x125704+_0x482077(0xe1f)+_0x3d5bbd+_0x482077(0x3a1)+_0x418e4e+_0x482077(0xadb)+_0x244fc6+_0x482077(0x14cf);_0x22b859[_0x482077(0x33a)]=_0x292271+_0x9c372f,_0x2975a1[_0x482077(0x497)](_0x22b859),_0x2975a1[_0x482077(0x98c)]=_0x2975a1[_0x482077(0xfe3)],await new Promise(_0x181aab=>setTimeout(_0x181aab,0x4b0));const _0x5b3de8={'id':_0x433de8,'sender':_0x482077(0xb11),'content':_0x244fc6,'timestamp':Date[_0x482077(0x2eb)]()};return!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]),chatMessages[currentChatCharacter['id']][_0x482077(0x1cd6)](_0x5b3de8),await _internalRecallMessage(currentChatCharacter['id'],_0x5b3de8),_0x22b859;}}function getRecentUserImage(){const _0x3c4cb9=_0x211817;if(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])return null;const _0x3ba2d8=chatMessages[currentChatCharacter['id']];for(let _0x5306d2=_0x3ba2d8[_0x3c4cb9(0x19ee)]-0x1;_0x5306d2>=0x0;_0x5306d2--){const _0x590eb6=_0x3ba2d8[_0x5306d2];if(_0x590eb6[_0x3c4cb9(0x8a1)]===_0x3c4cb9(0x1e6d)&&!_0x590eb6[_0x3c4cb9(0x8e7)]){if(Array[_0x3c4cb9(0x1496)](_0x590eb6[_0x3c4cb9(0x211c)])){const _0x2fc021=_0x590eb6[_0x3c4cb9(0x211c)]['find'](_0x1b9e45=>_0x1b9e45[_0x3c4cb9(0x1a4b)]==='image_url');if(_0x2fc021&&_0x2fc021[_0x3c4cb9(0x910)]&&_0x2fc021[_0x3c4cb9(0x910)][_0x3c4cb9(0x40f)])return console[_0x3c4cb9(0x2187)]('找到用户最近发送的图片(多模态格式):',_0x2fc021[_0x3c4cb9(0x910)][_0x3c4cb9(0x40f)]),_0x2fc021['image_url']['url'];}else{if(_0x590eb6[_0x3c4cb9(0x68e)])return console['log'](_0x3c4cb9(0x1ea5),_0x590eb6[_0x3c4cb9(0x68e)]),_0x590eb6[_0x3c4cb9(0x68e)];}}}return console['log'](_0x3c4cb9(0x1559)),null;}async function callChatAPI(_0x2abe37,_0xf18825){const _0x47fee9=_0x211817;try{let _0x2a0d7d=null;try{_0x2a0d7d=await db[_0x47fee9(0x1789)][_0x47fee9(0xb78)](_0xf18825['id']);}catch(_0x41cfb0){console[_0x47fee9(0x174a)](_0x47fee9(0x1741),_0x41cfb0);}const _0xc442f8=_0x2a0d7d?.['aiPersona']||_0xf18825['prompt']||'你是'+_0xf18825[_0x47fee9(0x1a1c)]+'。';let _0x49304f='';if(_0x2a0d7d?.[_0x47fee9(0xe99)]&&_0x2a0d7d[_0x47fee9(0xe99)][_0x47fee9(0x19ee)]>0x0)try{const _0x217f24=await Promise[_0x47fee9(0x1a47)](_0x2a0d7d[_0x47fee9(0xe99)][_0x47fee9(0x6a4)](_0x49811c=>db['worldbooks'][_0x47fee9(0xb78)](_0x49811c))),_0x19c543=_0x217f24['filter'](_0x36e6e2=>_0x36e6e2&&_0x36e6e2[_0x47fee9(0x211c)]);_0x19c543[_0x47fee9(0x19ee)]>0x0&&(_0x49304f=_0x47fee9(0x1a01)+_0x19c543[_0x47fee9(0x6a4)](_0x15aaa2=>_0x15aaa2[_0x47fee9(0x1a1c)]+'：'+_0x15aaa2[_0x47fee9(0x211c)])[_0x47fee9(0x122b)]('\x0a\x0a'));}catch(_0xcdced4){console[_0x47fee9(0x174a)](_0x47fee9(0x144e),_0xcdced4);}let _0x17e03f='';const _0x3b1117=chatMessages[_0xf18825['id']]||[];if(_0x3b1117[_0x47fee9(0x19ee)]>0x0){const _0x228b0e=parseInt(_0x2a0d7d?.[_0x47fee9(0x17f5)])||0xa,_0x27a8e2=_0x3b1117[_0x47fee9(0x6d5)](-_0x228b0e);_0x17e03f='\x0a\x0a最近的聊天记录（供参考）：\x0a'+_0x27a8e2[_0x47fee9(0x6a4)](_0x565f1a=>{const _0x23bdef=_0x47fee9;if(_0x565f1a[_0x23bdef(0x8a1)]===_0x23bdef(0x1e6d))return _0x23bdef(0x4ec)+_0x565f1a[_0x23bdef(0x211c)];return _0xf18825[_0x23bdef(0x1a1c)]+'：'+_0x565f1a[_0x23bdef(0x211c)];})[_0x47fee9(0x122b)]('\x0a');}const _0x5109c7='你是'+_0xf18825['name']+_0x47fee9(0xaca)+_0xc442f8+'。'+_0x49304f+_0x17e03f+_0x47fee9(0x1b28)+_0x2abe37,_0x3dc34f=[{'role':'system','content':_0x5109c7},{'role':_0x47fee9(0xa80),'content':_0x2abe37}],{base:_0x5e165c,key:_0x52c217,model:_0x9fb073}=apiSettings;if(!_0x5e165c||!_0x52c217||!_0x9fb073)return console[_0x47fee9(0x2187)]('API配置不完整，跳过AI回复'),_0x47fee9(0x1c58);const _0x428d40={'model':_0x9fb073,'messages':_0x3dc34f,'temperature':0.8,'stream':![]},_0x17e7db=new AbortController(),_0x22e17c=setTimeout(()=>_0x17e7db[_0x47fee9(0x101b)](),0xea60),_0x4812c6=_0x5e165c['includes'](_0x47fee9(0x1d80));let _0xea7a5f;if(_0x4812c6){const _0x9c52e0=_0x5e165c+_0x47fee9(0x1107)+_0x9fb073+_0x47fee9(0x40c)+_0x52c217,_0x194463=[];_0x428d40[_0x47fee9(0x1828)][0x0]?.['role']==='system'&&(_0x194463[_0x47fee9(0x1cd6)]({'role':_0x47fee9(0xa80),'parts':[{'text':_0x428d40[_0x47fee9(0x1828)][0x0][_0x47fee9(0x211c)]}]}),_0x194463[_0x47fee9(0x1cd6)]({'role':_0x47fee9(0x1976),'parts':[{'text':_0x47fee9(0xd5e)}]}));for(let _0x4b59a9=0x1;_0x4b59a9<_0x428d40[_0x47fee9(0x1828)][_0x47fee9(0x19ee)];_0x4b59a9++){const _0x871ff2=_0x428d40[_0x47fee9(0x1828)][_0x4b59a9];if(_0x871ff2[_0x47fee9(0x464)]==='system')continue;_0x194463[_0x47fee9(0x1cd6)]({'role':_0x871ff2[_0x47fee9(0x464)]===_0x47fee9(0xa80)?_0x47fee9(0xa80):_0x47fee9(0x1976),'parts':[{'text':_0x871ff2[_0x47fee9(0x211c)]}]});}_0xea7a5f=await fetch(_0x9c52e0,{'method':'POST','headers':{'Content-Type':_0x47fee9(0x1b82)},'body':JSON[_0x47fee9(0x6b8)]({'contents':_0x194463,'generationConfig':{'temperature':_0x428d40[_0x47fee9(0x11c5)]||0.8}}),'signal':_0x17e7db[_0x47fee9(0x159b)]});}else{let _0x136451;if(_0x5e165c[_0x47fee9(0x81f)](_0x47fee9(0x1439)))_0x136451=_0x5e165c+_0x47fee9(0x1bea);else _0x5e165c[_0x47fee9(0x1831)]('/v1/')?_0x136451=_0x5e165c+'/chat/completions':_0x136451=_0x5e165c+_0x47fee9(0x666);_0xea7a5f=await fetch(_0x136451,{'method':_0x47fee9(0x1dd5),'headers':{'Content-Type':_0x47fee9(0x1b82),'Authorization':_0x47fee9(0x1e3c)+_0x52c217},'body':JSON[_0x47fee9(0x6b8)](_0x428d40),'signal':_0x17e7db['signal']});}clearTimeout(_0x22e17c);if(!_0xea7a5f['ok']){let _0x5b2312=await _0xea7a5f[_0x47fee9(0x1378)]();return console[_0x47fee9(0x174a)](_0x47fee9(0x2113)+_0xea7a5f[_0x47fee9(0x12e2)]+_0x47fee9(0x18a8)+_0x5b2312),_0x47fee9(0x15af)+_0xea7a5f[_0x47fee9(0x12e2)]+'\x22]';}const _0x18132f=await _0xea7a5f[_0x47fee9(0xe52)]();let _0x55d567;if(_0x4812c6){_0x55d567=_0x18132f[_0x47fee9(0x1153)]?.[0x0]?.[_0x47fee9(0x211c)]?.['parts']?.[0x0]?.[_0x47fee9(0x1378)];if(!_0x55d567)return console[_0x47fee9(0x2187)](_0x47fee9(0xf53),_0x18132f),'[\x22Gemini\x20API响应异常\x22]';}else{if(_0x18132f['choices']&&_0x18132f[_0x47fee9(0x1090)][_0x47fee9(0x19ee)]>0x0&&_0x18132f[_0x47fee9(0x1090)][0x0][_0x47fee9(0x1e8e)])_0x55d567=_0x18132f[_0x47fee9(0x1090)][0x0][_0x47fee9(0x1e8e)]['content'];else{if(_0x18132f[_0x47fee9(0x1e8e)])_0x55d567=_0x18132f['message'];else{if(_0x18132f['text'])_0x55d567=_0x18132f[_0x47fee9(0x1378)];else{if(_0x18132f[_0x47fee9(0x928)])_0x55d567=_0x18132f[_0x47fee9(0x928)];else{if(_0x18132f[_0x47fee9(0x211c)])_0x55d567=_0x18132f[_0x47fee9(0x211c)];else{if(_0x18132f[_0x47fee9(0x4ee)])_0x55d567=_0x18132f[_0x47fee9(0x4ee)];else return console['error']('无法解析API响应，完整响应数据:',_0x18132f),_0x47fee9(0x1f07);}}}}}}return _0x55d567;}catch(_0x6a8144){return console[_0x47fee9(0x174a)](_0x47fee9(0x448),_0x6a8144),_0x47fee9(0x2b4)+_0x6a8144[_0x47fee9(0x1e8e)]+'\x22]';}}async function parseAiResponse(_0x2aa728){const _0x4f200d=_0x211817;console[_0x4f200d(0x2187)]('🔥\x20[DEBUG]\x20parseAiResponse\x20收到的原始内容:',_0x2aa728);try{let _0x1db144=_0x2aa728['trim']();if(_0x1db144[_0x4f200d(0x1b30)](_0x4f200d(0xd0f)))_0x1db144=_0x1db144[_0x4f200d(0xe16)](/^```json\s*/,'')[_0x4f200d(0xe16)](/\s*```$/,'');else _0x1db144[_0x4f200d(0x1b30)]('```')&&(_0x1db144=_0x1db144['replace'](/^```\s*/,'')['replace'](/\s*```$/,''));const _0x1e12a8=JSON[_0x4f200d(0x22d3)](_0x1db144);console['log'](_0x4f200d(0x138c),_0x1e12a8);if(Array[_0x4f200d(0x1496)](_0x1e12a8)){const _0x2b15d2=[];console[_0x4f200d(0x2187)](_0x4f200d(0x2183),_0x1e12a8[_0x4f200d(0x19ee)],_0x4f200d(0x1cf6));for(let _0xa0f45e=0x0;_0xa0f45e<_0x1e12a8[_0x4f200d(0x19ee)];_0xa0f45e++){const _0x39ceb3=_0x1e12a8[_0xa0f45e];console['log'](_0x4f200d(0x7af)+(_0xa0f45e+0x1)+_0x4f200d(0x901),typeof _0x39ceb3,_0x39ceb3);if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a1c)]&&_0x39ceb3[_0x4f200d(0x1a4b)]==='emoji'){const _0x2c1b4d=await findEmojiForAI(_0x39ceb3['description']);_0x2c1b4d?(console[_0x4f200d(0x2187)]('AI发送表情包:',_0x39ceb3[_0x4f200d(0x7c9)]),_0x2b15d2['push'](_0x39ceb3)):(console['warn'](_0x4f200d(0x3ec),_0x39ceb3[_0x4f200d(0x7c9)]),_0x2b15d2[_0x4f200d(0x1cd6)]({'name':_0x39ceb3[_0x4f200d(0x1a1c)],'message':_0x4f200d(0x4b4)+_0x39ceb3[_0x4f200d(0x7c9)]+_0x4f200d(0x1ae7)}));}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0x172b)){const _0x5b329a=await findEmojiForAI(_0x39ceb3[_0x4f200d(0x7c9)]);if(_0x5b329a){console[_0x4f200d(0x2187)](_0x4f200d(0xbfd),_0x39ceb3[_0x4f200d(0x7c9)]);const _0x15ba2c={'type':_0x4f200d(0x172b),'url':_0x5b329a[_0x4f200d(0x40f)],'description':_0x5b329a['description'],'id':_0x5b329a['id']};_0x2b15d2[_0x4f200d(0x1cd6)](_0x15ba2c);}else console[_0x4f200d(0x1f43)](_0x4f200d(0x3ec),_0x39ceb3[_0x4f200d(0x7c9)]),_0x2b15d2[_0x4f200d(0x1cd6)](_0x4f200d(0x4b4)+_0x39ceb3[_0x4f200d(0x7c9)]+'\x22不存在]');}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0xbb9)){const _0x54364b=_0x39ceb3[_0x4f200d(0x7c9)]||'角色发送的照片';_0x2b15d2['push']({'type':_0x4f200d(0xbb9),'content':_0x54364b,'photoDescription':_0x54364b});}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']===_0x4f200d(0x2184)){const _0x3e81ba=_0x39ceb3[_0x4f200d(0x1b93)]||_0x39ceb3[_0x4f200d(0x1a1c)]||_0x4f200d(0xeea),_0xaf0f43={'type':'location','locationName':_0x3e81ba,'coordinates':_0x39ceb3[_0x4f200d(0x7cf)]||'未知坐标','content':'[角色分享了位置信息：'+_0x3e81ba+']'};if(_0x39ceb3['name']&&_0x39ceb3[_0x4f200d(0x1b93)])_0xaf0f43[_0x4f200d(0x1a1c)]=_0x39ceb3[_0x4f200d(0x1a1c)];else{if(_0x39ceb3[_0x4f200d(0x1a1c)]&&!_0x39ceb3[_0x4f200d(0x1b93)]){}}_0x2b15d2[_0x4f200d(0x1cd6)](_0xaf0f43);}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0x1b17)){if(_0x39ceb3[_0x4f200d(0x3ab)]===_0x4f200d(0xc50)||_0x39ceb3[_0x4f200d(0x3ab)]===_0x4f200d(0xc50)||_0x39ceb3[_0x4f200d(0x3ab)]===_0x4f200d(0x1004)||_0x39ceb3[_0x4f200d(0x3ab)]==='图片URL'){const _0x1bb236=getRecentUserImage();_0x1bb236?(_0x39ceb3[_0x4f200d(0x3ab)]=_0x1bb236,console[_0x4f200d(0x2187)](_0x4f200d(0x124f),_0x1bb236)):(console['warn'](_0x4f200d(0x2141)),_0x2b15d2[_0x4f200d(0x1cd6)](_0x4f200d(0x1e4a)));}_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']===_0x4f200d(0x1a36))_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']===_0x4f200d(0x13ed)){const _0x34790d={'type':_0x4f200d(0x13ed),'content':_0x39ceb3[_0x4f200d(0x211c)]||'','duration':_0x39ceb3['duration']||'0\x22'};_0x39ceb3[_0x4f200d(0x1a1c)]&&(_0x34790d[_0x4f200d(0x1a1c)]=_0x39ceb3[_0x4f200d(0x1a1c)]),_0x2b15d2[_0x4f200d(0x1cd6)](_0x34790d);}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0x78a))_0x2b15d2[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x78a),'amount':_0x39ceb3[_0x4f200d(0x2018)]||0x0,'note':_0x39ceb3[_0x4f200d(0x1814)]||'转账'});else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']==='payment_request')console[_0x4f200d(0x2187)](_0x4f200d(0xf59),_0x39ceb3);else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]==='poke')console['log']('🔍\x20[parseAiResponse]\x20AI主动戳一戳:',_0x39ceb3),_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']===_0x4f200d(0xdd2))console[_0x4f200d(0x2187)]('🔍\x20[parseAiResponse]\x20角色更新戳一戳后缀:',_0x39ceb3),_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);else{if(typeof _0x39ceb3==='object'&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0x1e8f))_0x39ceb3[_0x4f200d(0x193d)]===_0x4f200d(0x20d0)&&_0x2b15d2[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x2ef),'content':_0x4f200d(0x1fb3)});else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0xd5f))_0x2b15d2[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x96c),'messageId':_0x39ceb3[_0x4f200d(0x21c8)],'content':_0x39ceb3[_0x4f200d(0x211c)]||''});else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]==='photo')_0x2b15d2[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0xd38),'content':_0x39ceb3[_0x4f200d(0x7c9)]||'AI分享的照片','photoDescription':_0x39ceb3[_0x4f200d(0x7c9)]});else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]==='recalled_message')_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3[_0x4f200d(0x1a4b)]===_0x4f200d(0x1f2a)){const _0x573a2d={'type':_0x4f200d(0x1f2a),'message_id':_0x39ceb3[_0x4f200d(0x7a2)],'content':_0x39ceb3[_0x4f200d(0x211c)]||''};_0x39ceb3[_0x4f200d(0x1a1c)]&&(_0x573a2d['name']=_0x39ceb3[_0x4f200d(0x1a1c)]),_0x2b15d2[_0x4f200d(0x1cd6)](_0x573a2d);}else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']==='friend_request')!isRecentFriendRequestSpam(currentChatCharacter?.['id'])?(_0x2b15d2[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x2051),'message':_0x39ceb3[_0x4f200d(0x1e8e)]||_0x4f200d(0x160b)}),console[_0x4f200d(0x2187)](_0x4f200d(0x1108),_0x39ceb3[_0x4f200d(0x1e8e)])):(console[_0x4f200d(0x2187)](_0x4f200d(0x96e)),_0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3[_0x4f200d(0x1e8e)]||_0x4f200d(0x160b)));else{if(typeof _0x39ceb3===_0x4f200d(0x28d)&&_0x39ceb3['type']===_0x4f200d(0x1682))console['log']('🎵\x20AI选歌指令:',_0x39ceb3),setTimeout(async()=>{const _0x1090fb=_0x4f200d,_0x427217=await aiSelectSong(_0x39ceb3['title'],currentChatCharacter?.[_0x1090fb(0x1a1c)]);_0x427217?console['log']('✅\x20AI成功选择歌曲'):console[_0x1090fb(0x2187)]('❌\x20AI选歌失败');},0x64),_0x2b15d2[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()[_0x4f200d(0x1878)](),'sender':_0x4f200d(0x1744),'type':_0x4f200d(0x2c3),'content':(currentChatCharacter?.[_0x4f200d(0x1a1c)]||'AI')+_0x4f200d(0x1667)+_0x39ceb3[_0x4f200d(0x378)],'timestamp':Date['now']()});else{if(typeof _0x39ceb3==='object'&&_0x39ceb3[_0x4f200d(0x1a4b)]==='random_song')console['log']('🎵\x20AI随机选歌指令:',_0x39ceb3),setTimeout(async()=>{const _0x2465d2=_0x4f200d,_0x517a72=await aiSelectRandomSong(currentChatCharacter?.['name']);_0x517a72?console[_0x2465d2(0x2187)](_0x2465d2(0x8cf)):console[_0x2465d2(0x2187)](_0x2465d2(0x1079));},0x64),_0x2b15d2[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()[_0x4f200d(0x1878)](),'sender':'system','type':'system_notification','content':(currentChatCharacter?.[_0x4f200d(0x1a1c)]||'AI')+_0x4f200d(0xac9),'timestamp':Date['now']()});else{if(typeof _0x39ceb3===_0x4f200d(0x11b7)){const _0x104248=_0x39ceb3['trim'](),_0x47aa9e=_0x104248[_0x4f200d(0x1b87)](/(.+)修改了自己的戳一戳后缀(?:为"(.+)"|（清空）)/);if(_0x47aa9e){const _0x551e3b=_0x47aa9e[0x1],_0x5a9214=_0x47aa9e[0x2]||'';console[_0x4f200d(0x2187)](_0x4f200d(0xa01),{'characterName':_0x551e3b,'suffix':_0x5a9214});const _0x262dde=getCurrentChatSettings();_0x262dde[_0x4f200d(0x4b8)]=_0x5a9214,await saveCurrentChatSettings(_0x262dde),_0x2b15d2[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()[_0x4f200d(0x1878)](),'sender':_0x4f200d(0x1744),'content':currentChatCharacter['name']+_0x4f200d(0x64a)+(_0x5a9214?'为\x22'+_0x5a9214+'\x22':_0x4f200d(0x630)),'timestamp':Date['now'](),'type':_0x4f200d(0x2c3)}),console[_0x4f200d(0x2187)](_0x4f200d(0x1c40),_0x5a9214);}else{if(_0x39ceb3['includes']('\x0a')){console[_0x4f200d(0x1f43)](_0x4f200d(0xd0a),_0x39ceb3);const _0x10c8c6=_0x39ceb3[_0x4f200d(0x204b)]('\x0a')[_0x4f200d(0x6a4)](_0x3024c7=>_0x3024c7['trim']())['filter'](_0x129eb0=>_0x129eb0['length']>0x0);_0x2b15d2[_0x4f200d(0x1cd6)](..._0x10c8c6);}else _0x2b15d2[_0x4f200d(0x1cd6)](_0x39ceb3);}}else _0x2b15d2['push'](_0x39ceb3);}}}}}}}}}}}}}}}}}}}}return _0x2b15d2;}}catch(_0x5d8095){}try{const _0x3727ba=_0x2aa728['match'](/\[(.*?)\]/s);if(_0x3727ba&&_0x3727ba[0x0]){const _0x53c453=JSON[_0x4f200d(0x22d3)](_0x3727ba[0x0]);if(Array['isArray'](_0x53c453)){const _0x21088a=[];for(const _0x282e8c of _0x53c453){if(typeof _0x282e8c==='object'&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x172b)){const _0x3f6088=await findEmojiForAI(_0x282e8c[_0x4f200d(0x7c9)]);_0x3f6088?(console[_0x4f200d(0x2187)](_0x4f200d(0xbfd),_0x282e8c['description']),_0x21088a[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x172b),'url':_0x3f6088['url'],'description':_0x3f6088[_0x4f200d(0x7c9)],'id':_0x3f6088['id']})):(console[_0x4f200d(0x1f43)](_0x4f200d(0x3ec),_0x282e8c['description']),_0x21088a['push'](_0x4f200d(0x4b4)+_0x282e8c['description']+'\x22不存在]'));}else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c['name']&&_0x282e8c['type']===_0x4f200d(0x172b))console[_0x4f200d(0x2187)](_0x4f200d(0x1267),_0x282e8c),_0x21088a['push'](_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0xbb9)){const _0x37a6f1=_0x282e8c[_0x4f200d(0x7c9)]||_0x4f200d(0xbe5);_0x21088a['push']({'type':'ai_photo','content':_0x37a6f1,'photoDescription':_0x37a6f1});}else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c['type']===_0x4f200d(0x2184)){const _0x716591=_0x282e8c[_0x4f200d(0x1b93)]||_0x282e8c['name']||'未知位置',_0x384bb1={'type':_0x4f200d(0x2184),'locationName':_0x716591,'coordinates':_0x282e8c[_0x4f200d(0x7cf)]||_0x4f200d(0x183c),'content':'[角色分享了位置信息：'+_0x716591+']'};if(_0x282e8c[_0x4f200d(0x1a1c)]&&_0x282e8c['locationName'])_0x384bb1[_0x4f200d(0x1a1c)]=_0x282e8c[_0x4f200d(0x1a1c)];else{if(_0x282e8c['name']&&!_0x282e8c[_0x4f200d(0x1b93)]){}}_0x21088a['push'](_0x384bb1);}else{if(typeof _0x282e8c==='object'&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x1b17)){if(_0x282e8c[_0x4f200d(0x3ab)]===_0x4f200d(0xc50)||_0x282e8c['avatar_url']===_0x4f200d(0xc50)||_0x282e8c['avatar_url']===_0x4f200d(0x1004)||_0x282e8c[_0x4f200d(0x3ab)]===_0x4f200d(0x13b0)){const _0x2b94bf=getRecentUserImage();_0x2b94bf?(_0x282e8c[_0x4f200d(0x3ab)]=_0x2b94bf,console[_0x4f200d(0x2187)](_0x4f200d(0x1b9e),_0x2b94bf)):(console[_0x4f200d(0x1f43)]('没有找到用户最近发送的图片，忽略头像更换请求(第二处)'),_0x21088a[_0x4f200d(0x1cd6)](_0x4f200d(0x1e4a)));}_0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);}else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c['type']===_0x4f200d(0x1a36))_0x21088a['push'](_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c['type']===_0x4f200d(0x13ed)){const _0x31195c={'type':_0x4f200d(0x13ed),'content':_0x282e8c[_0x4f200d(0x211c)]||'','duration':_0x282e8c[_0x4f200d(0x5a4)]||'0\x22'};_0x282e8c['name']&&(_0x31195c['name']=_0x282e8c[_0x4f200d(0x1a1c)]),_0x21088a[_0x4f200d(0x1cd6)](_0x31195c);}else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x78a))_0x21088a[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x78a),'amount':_0x282e8c['amount']||0x0,'note':_0x282e8c[_0x4f200d(0x1814)]||'转账'});else{if(typeof _0x282e8c==='object'&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x1871))console[_0x4f200d(0x2187)](_0x4f200d(0x1c0),_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x11b3))console[_0x4f200d(0x2187)](_0x4f200d(0x2dc),_0x282e8c),_0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0xdd2))console['log'](_0x4f200d(0x11a2),_0x282e8c),_0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x1e8f))_0x282e8c[_0x4f200d(0x193d)]===_0x4f200d(0x20d0)&&_0x21088a[_0x4f200d(0x1cd6)]({'type':_0x4f200d(0x2ef),'content':_0x4f200d(0x1fb3)});else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0xd5f))_0x21088a['push']({'type':_0x4f200d(0x96c),'messageId':_0x282e8c[_0x4f200d(0x21c8)],'content':_0x282e8c[_0x4f200d(0x211c)]||''});else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]==='photo')_0x21088a['push']({'type':'user_photo','content':_0x282e8c[_0x4f200d(0x7c9)]||_0x4f200d(0x21a5),'photoDescription':_0x282e8c[_0x4f200d(0x7c9)]});else{if(typeof _0x282e8c==='object'&&_0x282e8c['type']===_0x4f200d(0x21f6))_0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x1f2a)){const _0x35a198={'type':_0x4f200d(0x1f2a),'message_id':_0x282e8c[_0x4f200d(0x7a2)],'content':_0x282e8c[_0x4f200d(0x211c)]||''};_0x282e8c[_0x4f200d(0x1a1c)]&&(_0x35a198[_0x4f200d(0x1a1c)]=_0x282e8c[_0x4f200d(0x1a1c)]),_0x21088a['push'](_0x35a198);}else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x2051))!isRecentFriendRequestSpam(currentChatCharacter?.['id'])?(_0x21088a['push']({'type':_0x4f200d(0x2051),'message':_0x282e8c[_0x4f200d(0x1e8e)]||_0x4f200d(0x160b)}),console[_0x4f200d(0x2187)](_0x4f200d(0x3aa),_0x282e8c['message'])):(console[_0x4f200d(0x2187)]('🚫\x20[防崩坏]\x20跳过短时间内的重复申请(第二处)，转为普通消息'),_0x21088a[_0x4f200d(0x1cd6)](_0x282e8c[_0x4f200d(0x1e8e)]||'想和你重新做朋友'));else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c['type']==='select_song')console[_0x4f200d(0x2187)](_0x4f200d(0x100f),_0x282e8c),setTimeout(async()=>{const _0x5d371c=_0x4f200d,_0x195e9b=await aiSelectSong(_0x282e8c[_0x5d371c(0x378)],currentChatCharacter?.[_0x5d371c(0x1a1c)]);_0x195e9b?console[_0x5d371c(0x2187)](_0x5d371c(0x219f)):console[_0x5d371c(0x2187)]('❌\x20AI选歌失败');},0x64),_0x21088a[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()['toString'](),'sender':_0x4f200d(0x1744),'type':_0x4f200d(0x2c3),'content':(currentChatCharacter?.[_0x4f200d(0x1a1c)]||'AI')+_0x4f200d(0x1667)+_0x282e8c[_0x4f200d(0x378)],'timestamp':Date[_0x4f200d(0x2eb)]()});else{if(typeof _0x282e8c===_0x4f200d(0x28d)&&_0x282e8c[_0x4f200d(0x1a4b)]===_0x4f200d(0x2d6))console[_0x4f200d(0x2187)](_0x4f200d(0x18ad),_0x282e8c),setTimeout(async()=>{const _0x4b95ac=_0x4f200d,_0x183c2e=await aiSelectRandomSong(currentChatCharacter?.[_0x4b95ac(0x1a1c)]);_0x183c2e?console[_0x4b95ac(0x2187)]('✅\x20AI成功随机选择歌曲'):console[_0x4b95ac(0x2187)](_0x4b95ac(0x1079));},0x64),_0x21088a[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()[_0x4f200d(0x1878)](),'sender':_0x4f200d(0x1744),'type':_0x4f200d(0x2c3),'content':(currentChatCharacter?.['name']||'AI')+_0x4f200d(0xac9),'timestamp':Date[_0x4f200d(0x2eb)]()});else{if(typeof _0x282e8c===_0x4f200d(0x11b7)){const _0x6def36=_0x282e8c[_0x4f200d(0x19d7)](),_0x1a70f9=_0x6def36[_0x4f200d(0x1b87)](/(.+)修改了自己的戳一戳后缀(?:为"(.+)"|（清空）)/);if(_0x1a70f9){const _0x5da3db=_0x1a70f9[0x1],_0x2eccb1=_0x1a70f9[0x2]||'';console[_0x4f200d(0x2187)](_0x4f200d(0x19e1),{'characterName':_0x5da3db,'suffix':_0x2eccb1});const _0x1ab3bb=getCurrentChatSettings();_0x1ab3bb['aiPokeSuffix']=_0x2eccb1,await saveCurrentChatSettings(_0x1ab3bb),_0x21088a[_0x4f200d(0x1cd6)]({'id':Date[_0x4f200d(0x2eb)]()['toString'](),'sender':_0x4f200d(0x1744),'content':currentChatCharacter[_0x4f200d(0x1a1c)]+_0x4f200d(0x64a)+(_0x2eccb1?'为\x22'+_0x2eccb1+'\x22':'（清空）'),'timestamp':Date[_0x4f200d(0x2eb)](),'type':_0x4f200d(0x2c3)}),console['log']('✅\x20[parseAiResponse-第二处]\x20戳一戳后缀已更新:',_0x2eccb1);}else{if(_0x282e8c[_0x4f200d(0x1831)]('\x0a')){console['warn'](_0x4f200d(0xd0a),_0x282e8c);const _0x174a31=_0x282e8c['split']('\x0a')['map'](_0x4526dc=>_0x4526dc[_0x4f200d(0x19d7)]())['filter'](_0x163dc5=>_0x163dc5['length']>0x0);_0x21088a[_0x4f200d(0x1cd6)](..._0x174a31);}else _0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);}}else _0x21088a[_0x4f200d(0x1cd6)](_0x282e8c);}}}}}}}}}}}}}}}}}}}}return console['log'](_0x4f200d(0x1ed3),_0x21088a[_0x4f200d(0x19ee)],'条消息:',_0x21088a),_0x21088a;}}}catch(_0xc26579){}if(_0x2aa728[_0x4f200d(0x19d7)]()[_0x4f200d(0x1b30)]('{')&&_0x2aa728[_0x4f200d(0x19d7)]()['endsWith']('}'))try{const _0x6d18d=JSON[_0x4f200d(0x22d3)](_0x2aa728[_0x4f200d(0x19d7)]());if(_0x6d18d[_0x4f200d(0x1a4b)])return console['log'](_0x4f200d(0x2127),_0x6d18d),await parseAiResponse('['+_0x2aa728[_0x4f200d(0x19d7)]()+']');}catch(_0x3ca06f){console[_0x4f200d(0x1f43)](_0x4f200d(0x225c),_0x3ca06f);}const _0x55fb23=_0x2aa728[_0x4f200d(0x204b)]('\x0a')[_0x4f200d(0x6a4)](_0x96a31f=>_0x96a31f[_0x4f200d(0x19d7)]())[_0x4f200d(0x1e1f)](_0x56152a=>_0x56152a[_0x4f200d(0x19ee)]>0x0&&!_0x56152a[_0x4f200d(0x1b30)](_0x4f200d(0x1265)));console[_0x4f200d(0x2187)](_0x4f200d(0x2c4),_0x55fb23[_0x4f200d(0x19ee)]>0x0?_0x55fb23:[_0x2aa728]);if(_0x55fb23[_0x4f200d(0x19ee)]>0x0)return _0x55fb23;return[_0x2aa728];}function processOfflineContent(_0x153c9d){const _0x4f8ecf=_0x211817;if(!_0x153c9d)return'';const _0x3eb7a6=[];let _0x524074=0x0;const _0x903824=/「([^」]*)」/g;let _0x287aa9;while((_0x287aa9=_0x903824[_0x4f8ecf(0x1d15)](_0x153c9d))!==null){if(_0x287aa9['index']>_0x524074){const _0x12b6e3=_0x153c9d[_0x4f8ecf(0x6d5)](_0x524074,_0x287aa9[_0x4f8ecf(0xbe2)])[_0x4f8ecf(0x19d7)]();_0x12b6e3&&_0x3eb7a6[_0x4f8ecf(0x1cd6)](_0x4f8ecf(0xedc)+_0x12b6e3+_0x4f8ecf(0x1f2));}_0x3eb7a6[_0x4f8ecf(0x1cd6)]('「'+_0x287aa9[0x1]+'」'),_0x524074=_0x287aa9['index']+_0x287aa9[0x0][_0x4f8ecf(0x19ee)];}if(_0x524074<_0x153c9d[_0x4f8ecf(0x19ee)]){const _0x356024=_0x153c9d[_0x4f8ecf(0x6d5)](_0x524074)['trim']();_0x356024&&_0x3eb7a6['push'](_0x4f8ecf(0xedc)+_0x356024+_0x4f8ecf(0x1f2));}if(_0x3eb7a6[_0x4f8ecf(0x19ee)]===0x0)return'<span\x20class=\x22italic-gray\x22>'+_0x153c9d+_0x4f8ecf(0x1f2);return _0x3eb7a6[_0x4f8ecf(0x122b)]('');}async function sendImageMessage(_0x3be908){const _0x32a671=_0x211817;if(!currentChatCharacter)return;const _0x4f1548=document[_0x32a671(0x1262)]('api-chat-input'),_0x57f726=_0x4f1548?_0x4f1548['value'][_0x32a671(0x19d7)]():'',_0x233e11=[{'type':_0x32a671(0x1378),'text':_0x57f726}];_0x3be908&&_0x233e11['push']({'type':'image_url','image_url':{'url':_0x3be908}});console[_0x32a671(0x2187)](_0x32a671(0x796),_0x233e11),console[_0x32a671(0x2187)](_0x32a671(0x15cd),_0x57f726),console[_0x32a671(0x2187)]('🔍\x20[sendImageMessage]\x20图片URL长度:',_0x3be908?_0x3be908[_0x32a671(0x19ee)]:0x0),console[_0x32a671(0x2187)]('🔍\x20[sendImageMessage]\x20消息内容数组长度:',_0x233e11[_0x32a671(0x19ee)]),console[_0x32a671(0x2187)]('🔍\x20[sendImageMessage]\x20消息内容详情:',_0x233e11[_0x32a671(0x6a4)]((_0x311758,_0x526268)=>({'index':_0x526268,'type':_0x311758[_0x32a671(0x1a4b)],'hasText':!!_0x311758[_0x32a671(0x1378)],'hasImageUrl':!!_0x311758[_0x32a671(0x910)],'textLength':_0x311758[_0x32a671(0x1378)]?_0x311758[_0x32a671(0x1378)][_0x32a671(0x19ee)]:0x0,'imageUrlLength':_0x311758[_0x32a671(0x910)]?.[_0x32a671(0x40f)]?_0x311758[_0x32a671(0x910)][_0x32a671(0x40f)]['length']:0x0})));const _0xbe770c={'id':Date[_0x32a671(0x2eb)]()[_0x32a671(0x1878)](),'sender':_0x32a671(0x1e6d),'content':_0x233e11,'timestamp':Date['now'](),'replyTo':currentReplyTo?{'id':currentReplyTo['id'],'content':currentReplyTo[_0x32a671(0x211c)],'senderName':currentReplyTo[_0x32a671(0x909)]}:null};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x32a671(0x1cd6)](_0xbe770c);try{const _0x13a6f0=currentChatCharacter['id']+'_'+_0xbe770c['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x32a671(0x19ee)]-0x1);await db[_0x32a671(0x19a2)][_0x32a671(0x21e2)]({'id':_0x13a6f0,'characterId':currentChatCharacter['id'],'timestamp':_0xbe770c[_0x32a671(0x1716)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x32a671(0x19ee)]-0x1,'originalMessageId':_0xbe770c['id'],'messageData':_0xbe770c}),console[_0x32a671(0x2187)](_0x32a671(0x12c9));}catch(_0x4e5849){console[_0x32a671(0x174a)](_0x32a671(0x1149),_0x4e5849),await saveChatMessagesImmediate();}await recordMemoryEvent([currentChatCharacter['id'],_0x32a671(0xa80)],{'type':currentChatCharacter[_0x32a671(0x1f68)]?_0x32a671(0x764):_0x32a671(0x219),'id':currentChatCharacter['id']},_0x32a671(0x1e8e),{'sender':'user','content':_0x57f726,'hasImage':!!_0x3be908},0.6);_0x4f1548&&(_0x4f1548['value']='');cancelReply();currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];addMessageWithAnimation(_0xbe770c,currentChatCharacter['id']),renderMessageList(),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),pendingUserMessage=_0xbe770c;const _0xc978f5=document[_0x32a671(0x1262)]('smart-reply-btn');_0xc978f5&&(_0xc978f5[_0x32a671(0x14eb)][_0x32a671(0x2231)]=_0x32a671(0x2241),_0xc978f5[_0x32a671(0x1c1b)][_0x32a671(0x21e2)](_0x32a671(0x2b1)),_0xc978f5[_0x32a671(0x378)]=_0x32a671(0xd96));}function uploadImage(){const _0x14bfd5=_0x211817;document[_0x14bfd5(0x1262)](_0x14bfd5(0x1629))[_0x14bfd5(0x1859)]();}function showImage(_0xd66116){const _0xf0092c=_0x211817;let _0x347f2a=document[_0xf0092c(0x1262)]('image-preview-modal');if(!_0x347f2a){_0x347f2a=document[_0xf0092c(0xac6)](_0xf0092c(0xbbc)),_0x347f2a['id']=_0xf0092c(0x2de),_0x347f2a[_0xf0092c(0x1722)]=_0xf0092c(0x2de),_0x347f2a[_0xf0092c(0x1f36)]=_0x553c68=>{const _0x51a376=_0xf0092c;_0x553c68[_0x51a376(0x193d)]===_0x347f2a&&(_0x347f2a[_0x51a376(0x14eb)]['display']=_0x51a376(0x102b));};const _0x627088=document[_0xf0092c(0xac6)](_0xf0092c(0x1223));_0x627088['alt']=_0xf0092c(0x1100),_0x627088[_0xf0092c(0x14eb)][_0xf0092c(0x500)]=_0xf0092c(0x8ce),_0x627088[_0xf0092c(0x1f36)]=()=>_0x347f2a[_0xf0092c(0x14eb)]['display']='none',_0x347f2a['appendChild'](_0x627088),document[_0xf0092c(0x1da9)]['appendChild'](_0x347f2a);}const _0x152505=_0x347f2a[_0xf0092c(0xb30)](_0xf0092c(0x1223));_0x152505[_0xf0092c(0x45c)]=_0xd66116,_0x347f2a['style'][_0xf0092c(0x4da)]=_0xf0092c(0x1fb7);const _0x3c7842=_0x2d10b3=>{const _0x145fb6=_0xf0092c;_0x2d10b3[_0x145fb6(0x213c)]==='Escape'&&(_0x347f2a[_0x145fb6(0x14eb)][_0x145fb6(0x4da)]=_0x145fb6(0x102b),document[_0x145fb6(0xa21)](_0x145fb6(0xf5c),_0x3c7842));};document[_0xf0092c(0x21e9)](_0xf0092c(0xf5c),_0x3c7842);}function showChatSettings(){const _0xc3af64=_0x211817;console[_0xc3af64(0x2187)](_0xc3af64(0x181)),hideApp(_0xc3af64(0xcf2));const _0x5a9759=document[_0xc3af64(0x1262)](_0xc3af64(0x1765));if(_0x5a9759){_0x5a9759[_0xc3af64(0x14eb)]['display']=_0xc3af64(0x1fb7),_0x5a9759[_0xc3af64(0x14eb)][_0xc3af64(0xbc7)]=_0xc3af64(0x195),_0x5a9759[_0xc3af64(0x14eb)]['top']='0',_0x5a9759['style'][_0xc3af64(0x15dc)]='0',_0x5a9759[_0xc3af64(0x14eb)]['width']=_0xc3af64(0x18a9),_0x5a9759[_0xc3af64(0x14eb)][_0xc3af64(0xe6b)]='100%',_0x5a9759[_0xc3af64(0x14eb)][_0xc3af64(0x1b76)]=_0xc3af64(0x1006),_0x5a9759[_0xc3af64(0x14eb)][_0xc3af64(0x619)]=_0xc3af64(0x2167),initializeChatSettings(),applyBubbleStyle(),updateWorldbookMountDisplay();const _0xef2bc6=currentChatCharacter&&currentChatCharacter[_0xc3af64(0x1f68)];console[_0xc3af64(0x2187)]('当前聊天类型:',_0xef2bc6?'群聊':'单聊');const _0x3b9431=document[_0xc3af64(0x1262)](_0xc3af64(0x8d1)),_0x39a214=document[_0xc3af64(0x1262)](_0xc3af64(0x980));if(_0xef2bc6){if(_0x3b9431)_0x3b9431[_0xc3af64(0x14eb)]['display']='block';if(_0x39a214)_0x39a214[_0xc3af64(0x14eb)][_0xc3af64(0x4da)]=_0xc3af64(0x102b);const _0x5056f4=document[_0xc3af64(0x1897)](_0xc3af64(0x2238));_0x5056f4[_0xc3af64(0x19fb)](_0x554921=>_0x554921['style'][_0xc3af64(0x4da)]=_0xc3af64(0x102b)),updateGroupChatInfo();}else{if(_0x3b9431)_0x3b9431[_0xc3af64(0x14eb)][_0xc3af64(0x4da)]='none';if(_0x39a214)_0x39a214['style'][_0xc3af64(0x4da)]='block';const _0x2e8c97=document[_0xc3af64(0x1897)](_0xc3af64(0x2238));_0x2e8c97[_0xc3af64(0x19fb)](_0x14bda5=>{const _0x340c71=_0xc3af64;_0x14bda5[_0x340c71(0x1c1b)][_0x340c71(0x971)](_0x340c71(0x21fa))?_0x14bda5[_0x340c71(0x14eb)][_0x340c71(0x4da)]=_0x340c71(0x13de):_0x14bda5[_0x340c71(0x14eb)][_0x340c71(0x4da)]=_0x340c71(0x1fb7);}),updateMemoryShareStatus();}updateVideoAvatarSettingVisibility(),console[_0xc3af64(0x2187)]('聊天设置界面已显示');}else console[_0xc3af64(0x174a)](_0xc3af64(0xeab)),alert(_0xc3af64(0xecd));}function hideChatSettings(){const _0x54f30a=_0x211817;hideApp(_0x54f30a(0x1765)),currentChatCharacter&&showApp(_0x54f30a(0xcf2));}let footprintsUpdateTimer=null,currentFootprintsCharacter=null;function getLocalDateString(_0xa34bab=new Date()){const _0x38035c=_0x211817;return _0xa34bab[_0x38035c(0x16a0)]()+'-'+String(_0xa34bab[_0x38035c(0x1da)]()+0x1)['padStart'](0x2,'0')+'-'+String(_0xa34bab['getDate']())[_0x38035c(0xdfe)](0x2,'0');}async function getCharacterDisplayAvatar(_0x20f57a){const _0x653906=_0x211817;try{const _0x2d63a3=await db[_0x653906(0x9c7)][_0x653906(0xa24)](_0x653906(0x22d2))[_0x653906(0x1694)](_0x20f57a['id'])[_0x653906(0x16b0)]()[_0x653906(0x163e)](0xa)['toArray']();for(const _0x5a1159 of _0x2d63a3){if(_0x5a1159[_0x653906(0x1f8a)]&&isValidAvatarUrl(_0x5a1159[_0x653906(0x1f8a)]))return console[_0x653906(0x2187)](_0x653906(0x1206)+_0x20f57a[_0x653906(0x1a1c)]+'\x20在动态中的头像'),_0x5a1159[_0x653906(0x1f8a)];}if(_0x20f57a[_0x653906(0x1f8a)]&&isValidAvatarUrl(_0x20f57a[_0x653906(0x1f8a)]))return console[_0x653906(0x2187)]('✅\x20使用角色\x20'+_0x20f57a['name']+_0x653906(0x1028)),_0x20f57a[_0x653906(0x1f8a)];if(_0x20f57a[_0x653906(0x1994)]&&isValidAvatarUrl(_0x20f57a['avatarUrl']))return console[_0x653906(0x2187)]('✅\x20使用角色\x20'+_0x20f57a[_0x653906(0x1a1c)]+_0x653906(0x18b4)),_0x20f57a[_0x653906(0x1994)];return console[_0x653906(0x2187)](_0x653906(0x1398)+_0x20f57a['name']+_0x653906(0x214d)),null;}catch(_0xe41195){return console['error'](_0x653906(0x163b),_0xe41195),_0x20f57a[_0x653906(0x1f8a)]||_0x20f57a[_0x653906(0x1994)]||null;}}async function migrateFootprintsFromLocalStorage(){const _0x212bfb=_0x211817;try{console[_0x212bfb(0x2187)](_0x212bfb(0x2ce));const _0x39a01b=localStorage[_0x212bfb(0x15d8)](_0x212bfb(0x377));if(!_0x39a01b){console[_0x212bfb(0x2187)](_0x212bfb(0x10bb));return;}const _0x5469ec=JSON[_0x212bfb(0x22d3)](_0x39a01b);let _0x5cd625=0x0,_0x1cbd7d=0x0;for(const [_0x58dc99,_0x2b05cd]of Object[_0x212bfb(0x2bc)](_0x5469ec)){if(typeof _0x2b05cd===_0x212bfb(0x28d)&&_0x2b05cd!==null)for(const [_0x5da5cd,_0x1cc923]of Object['entries'](_0x2b05cd)){_0x1cbd7d++;try{const _0x1b9649=_0x5da5cd+'_'+_0x58dc99,_0x42f484=await db[_0x212bfb(0xcbc)][_0x212bfb(0xb78)](_0x1b9649);if(_0x42f484){console[_0x212bfb(0x2187)](_0x212bfb(0xae9)+_0x1b9649);continue;}const _0x38aaef={'id':_0x1b9649,'characterId':_0x5da5cd,'date':_0x58dc99,'data':_0x1cc923[_0x212bfb(0x22c0)],'timestamp':_0x1cc923[_0x212bfb(0x1716)]||Date[_0x212bfb(0x2eb)](),'lastUpdateTime':_0x1cc923[_0x212bfb(0x949)]||_0x1cc923[_0x212bfb(0x1716)]||Date[_0x212bfb(0x2eb)](),'isComplete':_0x1cc923[_0x212bfb(0x21ed)]||![]};await db[_0x212bfb(0xcbc)][_0x212bfb(0x21e2)](_0x38aaef),_0x5cd625++,console[_0x212bfb(0x2187)](_0x212bfb(0x5f1)+_0x1b9649);}catch(_0x431364){console['error'](_0x212bfb(0x22e9)+_0x5da5cd+'_'+_0x58dc99+':',_0x431364);}}}_0x5cd625>0x0?(console['log']('✅\x20足迹数据迁移完成:\x20总计\x20'+_0x1cbd7d+_0x212bfb(0x1c69)+_0x5cd625+'\x20条'),console[_0x212bfb(0x2187)](_0x212bfb(0x80c))):console['log'](_0x212bfb(0x10c1));}catch(_0x3549eb){console[_0x212bfb(0x174a)](_0x212bfb(0x188b),_0x3549eb);}}async function getFootprintsCache(_0x3ad489){const _0x522978=_0x211817;try{const _0x1c921f=getLocalDateString(),_0x568c26=_0x3ad489+'_'+_0x1c921f,_0x1dd468=await db['characterFootprints'][_0x522978(0xb78)](_0x568c26);return _0x1dd468||null;}catch(_0x4e5b0c){return console[_0x522978(0x174a)](_0x522978(0x2d4),_0x4e5b0c),null;}}async function setFootprintsCache(_0x1d4e84,_0x4e476f,_0x3dfbe8=null){const _0x574620=_0x211817;try{const _0x39dc5a=getLocalDateString(),_0x47c8eb=_0x1d4e84+'_'+_0x39dc5a,_0xc47b92={'id':_0x47c8eb,'characterId':_0x1d4e84,'date':_0x39dc5a,'data':_0x4e476f,'timestamp':Date[_0x574620(0x2eb)](),'lastUpdateTime':_0x3dfbe8||Date[_0x574620(0x2eb)](),'isComplete':![]};await db[_0x574620(0xcbc)][_0x574620(0x1561)](_0xc47b92),console[_0x574620(0x2187)](_0x574620(0x11f9)+_0x1d4e84+'\x20('+_0x39dc5a+')');}catch(_0x148d8d){console[_0x574620(0x174a)]('保存足迹缓存失败:',_0x148d8d);}}async function appendToFootprintsCache(_0x25d4fa,_0xace043){const _0x2b7cbd=_0x211817;try{const _0x3e4fa5=getLocalDateString(),_0x1f915a=_0x25d4fa+'_'+_0x3e4fa5,_0x2f74bb=await db[_0x2b7cbd(0xcbc)][_0x2b7cbd(0xb78)](_0x1f915a);if(!_0x2f74bb)return console[_0x2b7cbd(0x1f43)](_0x2b7cbd(0x70c)),await setFootprintsCache(_0x25d4fa,_0xace043,Date[_0x2b7cbd(0x2eb)]()),!![];const _0x294060=_0x2f74bb[_0x2b7cbd(0x22c0)];_0xace043[_0x2b7cbd(0xc1e)]&&(!_0x294060[_0x2b7cbd(0xc1e)]&&(_0x294060[_0x2b7cbd(0xc1e)]=[]),_0x294060[_0x2b7cbd(0xc1e)]=_0x294060['activities']['concat'](_0xace043[_0x2b7cbd(0xc1e)]));if(_0xace043[_0x2b7cbd(0x415)]){!_0x294060[_0x2b7cbd(0x415)]&&(_0x294060[_0x2b7cbd(0x415)]=[]);const _0xda5e08=new Map();_0x294060[_0x2b7cbd(0x415)][_0x2b7cbd(0x19fb)](_0x526f1f=>_0xda5e08[_0x2b7cbd(0x83c)](_0x526f1f['name'],_0x526f1f)),_0xace043[_0x2b7cbd(0x415)]['forEach'](_0x2abc35=>_0xda5e08['set'](_0x2abc35['name'],_0x2abc35)),_0x294060['locations']=Array['from'](_0xda5e08[_0x2b7cbd(0xc6f)]());}return _0x2f74bb['data']=_0x294060,_0x2f74bb['timestamp']=Date[_0x2b7cbd(0x2eb)](),_0x2f74bb[_0x2b7cbd(0x949)]=Date['now'](),await db[_0x2b7cbd(0xcbc)]['put'](_0x2f74bb),console['log'](_0x2b7cbd(0x15df)+_0x25d4fa+_0x2b7cbd(0xfcc)+(_0x294060['activities']?.['length']||0x0)+_0x2b7cbd(0x21a8)),console[_0x2b7cbd(0x2187)](_0x2b7cbd(0x14b7),_0x294060),!![];}catch(_0x1889a3){return console['error'](_0x2b7cbd(0x1829),_0x1889a3),![];}}async function cleanupFootprintsCache(){const _0x323f99=_0x211817;try{const _0x4b1f8c=getLocalDateString(),_0x5bfc0d=await db[_0x323f99(0xcbc)]['toArray'](),_0x283547=_0x5bfc0d[_0x323f99(0x19ee)],_0x2b8f18=_0x5bfc0d[_0x323f99(0x1e1f)](_0x47738c=>_0x47738c['date']!==_0x4b1f8c);if(_0x2b8f18[_0x323f99(0x19ee)]>0x0){const _0x484cb8=_0x2b8f18['map'](_0x4b6d82=>_0x4b6d82['id']);await db[_0x323f99(0xcbc)][_0x323f99(0x1aaa)](_0x484cb8),console[_0x323f99(0x2187)](_0x323f99(0x2122)+_0x283547+_0x323f99(0x393)+_0x2b8f18['length']+_0x323f99(0x1247));}else console[_0x323f99(0x2187)](_0x323f99(0xd6d)+_0x283547+_0x323f99(0x13f6));}catch(_0x3209e9){console[_0x323f99(0x174a)](_0x323f99(0x2086),_0x3209e9);}}function setupMidnightCacheCleanup(){const _0x3492d3=_0x211817,_0x29d6ea=new Date(),_0x5b711e=new Date(_0x29d6ea);_0x5b711e[_0x3492d3(0x20ae)](_0x5b711e[_0x3492d3(0x520)]()+0x1),_0x5b711e[_0x3492d3(0x1a48)](0x0,0x0,0x0,0x0);const _0x5e42ca=_0x5b711e[_0x3492d3(0x704)]()-_0x29d6ea[_0x3492d3(0x704)]();setTimeout(async()=>{const _0x42f6a7=_0x3492d3;console['log'](_0x42f6a7(0xfc2));try{await cleanupFootprintsCache();}catch(_0x346091){console[_0x42f6a7(0x174a)]('午夜自动清理足迹缓存失败:',_0x346091);}setInterval(async()=>{const _0x1b68d8=_0x42f6a7;console[_0x1b68d8(0x2187)](_0x1b68d8(0x1d75));try{await cleanupFootprintsCache();}catch(_0x35821f){console['error'](_0x1b68d8(0x2081),_0x35821f);}},0x18*0x3c*0x3c*0x3e8);},_0x5e42ca),console['log'](_0x3492d3(0x1115)+Math[_0x3492d3(0x2180)](_0x5e42ca/0x3e8/0x3c)+'\x20分钟后自动清理');}async function showCharacterPhone(){const _0x8eef65=_0x211817;if(!currentChatCharacter){showToast(_0x8eef65(0x1346),_0x8eef65(0x174a));return;}if(currentChatCharacter[_0x8eef65(0x1f68)]){showToast(_0x8eef65(0x194a),_0x8eef65(0x174a));return;}window[_0x8eef65(0x86f)]=![],window[_0x8eef65(0xf09)]=![],window[_0x8eef65(0xc03)]=![],window[_0x8eef65(0x1bd5)]=null,window[_0x8eef65(0x2da)]=null,debugCharacterAvatar();const _0x301501=document[_0x8eef65(0x1262)](_0x8eef65(0x1fd3));_0x301501&&(_0x301501[_0x8eef65(0x13be)]=currentChatCharacter['name']+'的手机');hideApp(_0x8eef65(0xcf2)),showApp(_0x8eef65(0x21d6));if(!apiSettings[_0x8eef65(0x1208)]||!apiSettings['key']){console['log'](_0x8eef65(0xe90)),generatePhoneMessages(),switchPhoneTab(_0x8eef65(0x1828));return;}try{await generatePhoneMessagesAPI();}catch(_0x51abe1){console[_0x8eef65(0x174a)]('API生成失败，使用模拟数据:',_0x51abe1),generatePhoneMessages();}switchPhoneTab(_0x8eef65(0x1828));}function generatePhoneData(){generatePhoneMessages(),generatePhoneNotes(),generatePhonePhotos();}async function generatePhoneMessagesAPI(){const _0x28b2fc=_0x211817,_0x573bc1=document[_0x28b2fc(0xb30)](_0x28b2fc(0x8b6));if(!_0x573bc1)return;if(window[_0x28b2fc(0x86f)]&&window[_0x28b2fc(0x3f0)]===currentChatCharacter['id'])return;try{_0x573bc1[_0x28b2fc(0x33a)]=_0x28b2fc(0x19d6)+currentChatCharacter[_0x28b2fc(0x1a1c)]+'的人际圈对话...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x4fdd8f=await buildPhoneContextInfo(),_0x3272e4='请为角色\x22'+currentChatCharacter[_0x28b2fc(0x1a1c)]+'\x22生成手机中的人际圈对话列表。\x0a\x0a'+_0x4fdd8f+_0x28b2fc(0x16bf),_0x4afc00=await callPhoneAPI(_0x3272e4),_0x55c857=cleanAndFixJSON(_0x4afc00);if(_0x55c857['contacts']&&Array[_0x28b2fc(0x1496)](_0x55c857[_0x28b2fc(0x1404)])){window[_0x28b2fc(0x1bd5)]=_0x55c857[_0x28b2fc(0x1404)],window[_0x28b2fc(0x2da)]={},_0x55c857[_0x28b2fc(0x1404)][_0x28b2fc(0x19fb)](_0x142a19=>{const _0x2a55c7=_0x28b2fc;_0x142a19[_0x2a55c7(0x10e5)]&&(window[_0x2a55c7(0x2da)][_0x142a19[_0x2a55c7(0x1a1c)]]=_0x142a19[_0x2a55c7(0x10e5)]);});const _0x1da39a=_0x55c857[_0x28b2fc(0x1404)][_0x28b2fc(0x6a4)](_0x1e9be0=>_0x28b2fc(0x7ef)+_0x1e9be0[_0x28b2fc(0x1a1c)]+_0x28b2fc(0xac4)+_0x1e9be0[_0x28b2fc(0x1f8a)][_0x28b2fc(0xc3d)]+_0x28b2fc(0xe78)+_0x1e9be0[_0x28b2fc(0x1f8a)]['icon']+_0x28b2fc(0xe43)+_0x1e9be0[_0x28b2fc(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>'+_0x1e9be0[_0x28b2fc(0x1236)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-preview\x22>'+_0x1e9be0[_0x28b2fc(0x189d)]+_0x28b2fc(0x142e))[_0x28b2fc(0x122b)]('');_0x573bc1[_0x28b2fc(0x33a)]=_0x1da39a,window[_0x28b2fc(0x86f)]=!![],window['phoneMessagesCharacterId']=currentChatCharacter['id'],showToast(_0x28b2fc(0x1c48),_0x28b2fc(0x11cb));}else throw new Error(_0x28b2fc(0x428));}catch(_0x4c45f8){console['error'](_0x28b2fc(0x16b6),_0x4c45f8),showToast('生成失败，使用默认数据',_0x28b2fc(0x1816)),generatePhoneMessages();}}function generatePhoneMessages(){const _0x3b2b4d=_0x211817,_0x3cc65b=document[_0x3b2b4d(0xb30)](_0x3b2b4d(0x8b6));if(!_0x3cc65b)return;const _0xdaeedb=[{'name':'小红','preview':_0x3b2b4d(0x1b94),'time':_0x3b2b4d(0x84f)},{'name':'小明','preview':_0x3b2b4d(0x1552),'time':'昨天'},{'name':'妈妈','preview':'记得按时吃饭哦','time':'昨天'},{'name':_0x3b2b4d(0x166c),'preview':'明天的会议记得准备资料','time':_0x3b2b4d(0x15ea)},{'name':'室友','preview':_0x3b2b4d(0x1305),'time':'3天前'}],_0x143215={'小红':{'icon':_0x3b2b4d(0x465),'color':'#FF6B6B'},'小明':{'icon':_0x3b2b4d(0xa35),'color':_0x3b2b4d(0x3e7)},'妈妈':{'icon':_0x3b2b4d(0x1c1e),'color':_0x3b2b4d(0x998)},'同事小李':{'icon':_0x3b2b4d(0x12c0),'color':'#96CEB4'},'室友':{'icon':_0x3b2b4d(0xd2a),'color':_0x3b2b4d(0xf24)}};_0x3cc65b[_0x3b2b4d(0x33a)]=_0xdaeedb['map'](_0x1ebbcd=>{const _0x467f52=_0x3b2b4d,_0x358d2e=_0x143215[_0x1ebbcd['name']]||{'icon':_0x467f52(0x1291),'color':'#007AFF'};return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-item\x22\x20onclick=\x22openPhoneMessage(\x27'+_0x1ebbcd[_0x467f52(0x1a1c)]+_0x467f52(0xe03)+_0x358d2e[_0x467f52(0xc3d)]+';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22'+_0x358d2e[_0x467f52(0x40d)]+_0x467f52(0x14a7)+_0x1ebbcd['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>'+_0x1ebbcd['time']+_0x467f52(0x166a)+_0x1ebbcd['preview']+_0x467f52(0x1a22);})['join']('');}async function generatePhoneNotesAPI(){const _0x34397a=_0x211817,_0x1a3727=document[_0x34397a(0xb30)](_0x34397a(0x159d));if(!_0x1a3727)return;if(window[_0x34397a(0xf09)]&&window[_0x34397a(0xf77)]===currentChatCharacter['id'])return;try{_0x1a3727['innerHTML']=_0x34397a(0x1a94)+currentChatCharacter[_0x34397a(0x1a1c)]+'的备忘录...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x4c7a87=await buildPhoneContextInfo(),_0x8a294='请为角色\x22'+currentChatCharacter[_0x34397a(0x1a1c)]+_0x34397a(0xc19)+_0x4c7a87+'\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活状态来生成备忘录类型\x0a-\x20如果角色是学生，备忘录应该是学习相关、生活相关，不要有工作计划\x0a-\x20如果角色是上班族，可以有工作相关备忘录\x0a-\x20备忘录内容要真实反映角色的日常生活\x0a\x0a要求：\x0a1.\x20生成5-7个不同类型的备忘录，类型必须符合角色身份（学生：学习笔记、作业提醒、考试安排等；上班族：工作计划、会议安排等）\x0a2.\x20每个备忘录要有合适的emoji图标\x0a3.\x20内容要严格符合角色的身份、年龄和生活背景\x0a4.\x20预览文字控制在30字以内\x0a5.\x20时间要合理分布\x0a6.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色特点的备忘录\x0a7.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22notes\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22📚\x20备忘录标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x22preview\x22:\x20\x22备忘录预览内容...\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22完整的备忘录内容，可以很详细\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。',_0x51e1ed=await callPhoneAPI(_0x8a294),_0x52ae3f=cleanAndFixJSON(_0x51e1ed);if(_0x52ae3f[_0x34397a(0x1ba8)]&&Array['isArray'](_0x52ae3f[_0x34397a(0x1ba8)])){window[_0x34397a(0x8fb)]=_0x52ae3f[_0x34397a(0x1ba8)];const _0x571989=_0x52ae3f[_0x34397a(0x1ba8)][_0x34397a(0x6a4)](_0xdc7ede=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-item\x22\x20onclick=\x22openPhoneNoteAPI(\x27'+_0xdc7ede[_0x34397a(0x378)]+_0x34397a(0x11e1)+_0xdc7ede[_0x34397a(0x378)]+_0x34397a(0x1d62)+_0xdc7ede['preview']+_0x34397a(0x146a)+_0xdc7ede[_0x34397a(0x1236)]+_0x34397a(0x1ac))[_0x34397a(0x122b)]('');_0x1a3727[_0x34397a(0x33a)]=_0x571989,window[_0x34397a(0xf09)]=!![],window[_0x34397a(0xf77)]=currentChatCharacter['id'],showToast(_0x34397a(0x1cfd),'success');}else throw new Error(_0x34397a(0x428));}catch(_0x926c1b){console[_0x34397a(0x174a)](_0x34397a(0x2b8),_0x926c1b),showToast(_0x34397a(0x121a),_0x34397a(0x1816)),generatePhoneNotes();}}function generatePhoneNotes(){const _0x40fb33=_0x211817,_0x3cb323=document[_0x40fb33(0xb30)](_0x40fb33(0x159d));if(!_0x3cb323)return;const _0x403ae9=[{'title':_0x40fb33(0x1b1f),'preview':_0x40fb33(0x89b),'time':_0x40fb33(0x5d1)},{'title':'💼\x20工作计划','preview':_0x40fb33(0x10b6),'time':_0x40fb33(0x230a)},{'title':'📚\x20读书笔记','preview':_0x40fb33(0xcec),'time':_0x40fb33(0x15ea)},{'title':'✈️\x20旅行计划','preview':_0x40fb33(0x13b5),'time':_0x40fb33(0xf2b)},{'title':_0x40fb33(0x1296),'preview':_0x40fb33(0xe83),'time':_0x40fb33(0xf2b)}];_0x3cb323['innerHTML']=_0x403ae9['map'](_0x426d51=>_0x40fb33(0x1b99)+_0x426d51[_0x40fb33(0x378)]+_0x40fb33(0x22d8)+_0x426d51['title']+_0x40fb33(0xbff)+_0x426d51['preview']+_0x40fb33(0x152c)+_0x426d51[_0x40fb33(0x1236)]+_0x40fb33(0x1f2b))[_0x40fb33(0x122b)]('');}async function generatePhonePhotosAPI(){const _0x225797=_0x211817,_0x530de1=document[_0x225797(0xb30)]('.phone-photos-grid');if(!_0x530de1)return;if(window[_0x225797(0xc03)]&&window[_0x225797(0x1671)]===currentChatCharacter['id'])return;try{_0x530de1[_0x225797(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22grid-column:\x201\x20/\x20-1;\x20text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成'+currentChatCharacter['name']+'的相册...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1bddf5=await buildPhoneContextInfo(),_0x27b97a=_0x225797(0x5ba)+currentChatCharacter['name']+_0x225797(0x1be7)+_0x1bddf5+_0x225797(0x1832),_0x303afe=await callPhoneAPI(_0x27b97a),_0x50b3a0=cleanAndFixJSON(_0x303afe);if(_0x50b3a0[_0x225797(0x28e)]&&Array[_0x225797(0x1496)](_0x50b3a0[_0x225797(0x28e)])){window[_0x225797(0xfdc)]=_0x50b3a0['media'];const _0x5f0083=_0x50b3a0[_0x225797(0x28e)]['map']((_0x3ed0cb,_0x3bb332)=>_0x225797(0x1bc9)+_0x3bb332+'\x22\x20onclick=\x22openPhonePhotoByIndex('+_0x3bb332+_0x225797(0x1e23)+(_0x3ed0cb[_0x225797(0x1a4b)]===_0x225797(0xcde)?_0x225797(0x1053):_0x225797(0x68e))+_0x225797(0x175b))['join']('');_0x530de1[_0x225797(0x33a)]=_0x5f0083,window[_0x225797(0xc03)]=!![],window[_0x225797(0x1671)]=currentChatCharacter['id'],showToast(_0x225797(0x720),'success');}else throw new Error(_0x225797(0x428));}catch(_0x10e98e){console[_0x225797(0x174a)]('生成相册失败:',_0x10e98e),showToast('生成失败，使用默认数据',_0x225797(0x1816)),generatePhonePhotos();}}function generatePhonePhotos(){const _0xbf4c31=_0x211817,_0x6b13ed=document['querySelector'](_0xbf4c31(0xa1c));if(!_0x6b13ed)return;const _0x3419dc=[_0xbf4c31(0x1779),'咖啡时光',_0xbf4c31(0x1e52),_0xbf4c31(0x856),_0xbf4c31(0x53c),'旅行回忆'],_0x3628e2=_0x3419dc[_0xbf4c31(0x6a4)](_0x5f3803=>_0xbf4c31(0xc0c)+_0x5f3803+_0xbf4c31(0x24c))['join']('');_0x6b13ed[_0xbf4c31(0x33a)]=_0x3628e2;}async function buildPhoneContextInfo(){const _0x1f7472=_0x211817;let _0x460c8d='';const _0x51e328=_0x1f7472(0x1d7e)+currentChatCharacter[_0x1f7472(0x1a1c)]+'\x0a人设：'+(currentChatCharacter[_0x1f7472(0x7c9)]||currentChatCharacter['bio']||currentChatCharacter[_0x1f7472(0x7a1)]||_0x1f7472(0xf58));_0x460c8d+=_0x51e328+'\x0a\x0a';try{const _0x4c38af=getCurrentChatSettings(),_0x55a476=_0x4c38af[_0x1f7472(0x1a45)]||[],_0x5629f1=window[_0x1f7472(0x1a4e)]||[],_0x3f577b=[...new Set([..._0x5629f1,..._0x55a476])];_0x3f577b[_0x1f7472(0x19ee)]>0x0&&(_0x460c8d+=_0x1f7472(0x17d6),_0x3f577b[_0x1f7472(0x19fb)]((_0x4c77a3,_0x471b5a)=>{const _0x5b47b0=_0x1f7472,_0x100039=worldbooks[_0x5b47b0(0xaf4)](_0x511ac7=>_0x511ac7['id']===_0x4c77a3);_0x100039&&(_0x460c8d+=_0x471b5a+0x1+'.\x20'+(_0x100039[_0x5b47b0(0x1a1c)]||_0x100039[_0x5b47b0(0x378)])+'：'+_0x100039[_0x5b47b0(0x211c)]+'\x0a');}),_0x460c8d+='\x0a');}catch(_0xd6022b){console[_0x1f7472(0x174a)](_0x1f7472(0xab4),_0xd6022b);}try{const _0x4ad4cb=getGlobalMemorySettings();if(_0x4ad4cb[_0x1f7472(0x9f6)]!==![]){const _0x30c47f={'type':currentChatCharacter[_0x1f7472(0x1f68)]?_0x1f7472(0x764):_0x1f7472(0x219),'id':currentChatCharacter['id']},_0x42ef82=await buildGlobalMemoryContext(currentChatCharacter['id'],_0x30c47f,_0x4ad4cb[_0x1f7472(0x1715)]||0x7);_0x42ef82&&_0x42ef82[_0x1f7472(0x19d7)]()&&(_0x460c8d+=_0x1f7472(0x1a89)+_0x42ef82+'\x0a\x0a');}}catch(_0x2bb0d1){console[_0x1f7472(0x174a)](_0x1f7472(0x16ab),_0x2bb0d1);}try{const _0x9f25b9=currentChatCharacter['id'];if(chatMessages[_0x9f25b9]&&chatMessages[_0x9f25b9][_0x1f7472(0x19ee)]>0x0){const _0x15213e=chatMessages[_0x9f25b9]['slice'](-0x28);if(_0x15213e[_0x1f7472(0x19ee)]>0x0){const _0x288d6f=getCurrentPersonaName();_0x460c8d+=_0x1f7472(0x1c12),_0x15213e['forEach'](_0x23c419=>{const _0x5b64c7=_0x1f7472,_0x5ec9ae=_0x23c419[_0x5b64c7(0x8a1)]===_0x5b64c7(0x1e6d)?_0x288d6f:currentChatCharacter['name'];_0x460c8d+=_0x5ec9ae+'：'+_0x23c419[_0x5b64c7(0x211c)]+'\x0a';}),_0x460c8d+='\x0a';}}}catch(_0x3b8b60){console[_0x1f7472(0x174a)]('获取聊天记录失败:',_0x3b8b60);}return _0x460c8d;}function debugCharacterAvatar(){const _0x27aa86=_0x211817;if(!currentChatCharacter){console[_0x27aa86(0x2187)](_0x27aa86(0x1d61));return;}const _0xc5d6ac=getCurrentChatSettings();console[_0x27aa86(0x2187)](_0x27aa86(0x9c4)),console[_0x27aa86(0x2187)](_0x27aa86(0xa1e),currentChatCharacter['name']),console[_0x27aa86(0x2187)](_0x27aa86(0x22cf),currentChatCharacter['id']),console[_0x27aa86(0x2187)](_0x27aa86(0x15ec),_0xc5d6ac[_0x27aa86(0x179f)]||_0x27aa86(0xac3)),console[_0x27aa86(0x2187)]('\x20\x20-\x20角色卡头像:',currentChatCharacter[_0x27aa86(0x1994)]||'(未设置)');const _0x40bc4e=_0xc5d6ac[_0x27aa86(0x179f)]||currentChatCharacter['avatarUrl']||'';console[_0x27aa86(0x2187)](_0x27aa86(0x1d17),_0x40bc4e||'(空白\x20-\x20将显示默认图标)'),!_0x40bc4e&&(console[_0x27aa86(0x1f43)](_0x27aa86(0x16e7)),console[_0x27aa86(0x1f43)](_0x27aa86(0xb4c)),console[_0x27aa86(0x1f43)](_0x27aa86(0xb58)));}function debugCharacterNickname(){const _0x379544=_0x211817;if(!currentChatCharacter){console[_0x379544(0x2187)]('❌\x20没有当前角色');return;}const _0xd968a4=getCurrentChatSettings();console[_0x379544(0x2187)](_0x379544(0x2235)),console[_0x379544(0x2187)](_0x379544(0xa1e),currentChatCharacter['name']),console[_0x379544(0x2187)](_0x379544(0x22cf),currentChatCharacter['id']),console[_0x379544(0x2187)](_0x379544(0x10ca),_0xd968a4['aiChatNickname']||'(未设置)'),console[_0x379544(0x2187)](_0x379544(0x1bdb),_0xd968a4[_0x379544(0x567)]||_0x379544(0xac3)),console[_0x379544(0x2187)](_0x379544(0x12b9),_0xd968a4[_0x379544(0x4e7)]||currentChatCharacter[_0x379544(0x1a1c)]),console[_0x379544(0x2187)](_0x379544(0x14b3));if(window[_0x379544(0x1789)]&&window[_0x379544(0x1789)][currentChatCharacter['id']]){const _0x2e5b99=window['chatSettings'][currentChatCharacter['id']];console[_0x379544(0x2187)]('\x20\x20-\x20缓存中的AI昵称:',_0x2e5b99['aiChatNickname']||'(未设置)'),console['log'](_0x379544(0x1489),_0x2e5b99[_0x379544(0x567)]||_0x379544(0xac3));}else console[_0x379544(0x2187)](_0x379544(0x191a));}function cleanAndFixJSON(_0x160703){const _0x296cce=_0x211817;console[_0x296cce(0x2187)]('API原始响应:',_0x160703);if(!_0x160703||_0x160703[_0x296cce(0x19d7)]()==='')throw new Error(_0x296cce(0x688));let _0x63c051=_0x160703['trim']();if(_0x63c051['startsWith'](_0x296cce(0xd0f)))_0x63c051=_0x63c051[_0x296cce(0xe16)](/^```json\s*/,'')[_0x296cce(0xe16)](/\s*```$/,'');else _0x63c051['startsWith'](_0x296cce(0x1265))&&(_0x63c051=_0x63c051[_0x296cce(0xe16)](/^```\s*/,'')[_0x296cce(0xe16)](/\s*```$/,''));console['log']('清理后的响应:',_0x63c051);if(!_0x63c051||_0x63c051['trim']()==='')throw new Error(_0x296cce(0x130f));let _0x403726=_0x63c051;try{return JSON[_0x296cce(0x22d3)](_0x403726);}catch(_0x448abc){console[_0x296cce(0x1f43)](_0x296cce(0xfec),_0x448abc[_0x296cce(0x1e8e)]);if(!_0x403726[_0x296cce(0x19d7)]()['endsWith']('}')){let _0x41a61b=(_0x403726['match'](/{/g)||[])[_0x296cce(0x19ee)],_0x31d4ee=(_0x403726[_0x296cce(0x1b87)](/}/g)||[])[_0x296cce(0x19ee)],_0x57c506=(_0x403726['match'](/\[/g)||[])[_0x296cce(0x19ee)],_0x55cd31=(_0x403726[_0x296cce(0x1b87)](/]/g)||[])[_0x296cce(0x19ee)];for(let _0x2de43c=0x0;_0x2de43c<_0x57c506-_0x55cd31;_0x2de43c++){_0x403726+=']';}for(let _0x504aef=0x0;_0x504aef<_0x41a61b-_0x31d4ee;_0x504aef++){_0x403726+='}';}console['log'](_0x296cce(0x16ef),_0x403726);try{return JSON['parse'](_0x403726);}catch(_0x1c1207){console[_0x296cce(0x174a)](_0x296cce(0xa68),_0x1c1207[_0x296cce(0x1e8e)]);throw new Error(_0x296cce(0x1881)+_0x448abc['message']);}}else throw new Error(_0x296cce(0x1881)+_0x448abc[_0x296cce(0x1e8e)]);}}async function callPhoneAPI(_0x48cdf9){const _0x3e1679=_0x211817;if(!apiSettings[_0x3e1679(0x1208)]||!apiSettings[_0x3e1679(0x213c)])throw new Error('请先配置API设置');const _0x4a0d96=apiSettings[_0x3e1679(0x1208)][_0x3e1679(0x1831)](_0x3e1679(0x1d80));let _0xc85dc1;if(_0x4a0d96){const _0x28b0be=apiSettings[_0x3e1679(0x1208)]+_0x3e1679(0x1107)+apiSettings[_0x3e1679(0x1976)]+_0x3e1679(0x40c)+apiSettings[_0x3e1679(0x213c)];_0xc85dc1=await fetch(_0x28b0be,{'method':_0x3e1679(0x1dd5),'headers':{'Content-Type':_0x3e1679(0x1b82)},'body':JSON[_0x3e1679(0x6b8)]({'contents':[{'parts':[{'text':_0x48cdf9}]}],'generationConfig':{'temperature':0.8,'maxOutputTokens':0x2000}})});if(!_0xc85dc1['ok'])throw new Error(_0x3e1679(0x61b)+_0xc85dc1[_0x3e1679(0x12e2)]);const _0x37f25c=await _0xc85dc1[_0x3e1679(0xe52)]();return _0x37f25c[_0x3e1679(0x1153)][0x0][_0x3e1679(0x211c)][_0x3e1679(0x2308)][0x0][_0x3e1679(0x1378)];}else{let _0x39665a;if(apiSettings[_0x3e1679(0x1208)][_0x3e1679(0x81f)](_0x3e1679(0x1bea)))_0x39665a=apiSettings['base'];else apiSettings[_0x3e1679(0x1208)][_0x3e1679(0x81f)]('/v1')?_0x39665a=apiSettings[_0x3e1679(0x1208)]+'/chat/completions':_0x39665a=apiSettings['base']+_0x3e1679(0x666);_0xc85dc1=await fetch(_0x39665a,{'method':_0x3e1679(0x1dd5),'headers':{'Content-Type':_0x3e1679(0x1b82),'Authorization':_0x3e1679(0x1e3c)+apiSettings['key']},'body':JSON[_0x3e1679(0x6b8)]({'model':apiSettings['model'],'messages':[{'role':_0x3e1679(0xa80),'content':_0x48cdf9}],'temperature':0.8,'max_tokens':0x2000})});if(!_0xc85dc1['ok'])throw new Error(_0x3e1679(0x61b)+_0xc85dc1[_0x3e1679(0x12e2)]);const _0x47fea9=await _0xc85dc1[_0x3e1679(0xe52)]();return _0x47fea9['choices'][0x0]['message'][_0x3e1679(0x211c)];}}async function switchPhoneTab(_0x44a2d6){const _0x33e5a2=_0x211817;document[_0x33e5a2(0x1897)]('.phone-tab')['forEach'](_0x3f9356=>{const _0x27ff5d=_0x33e5a2;_0x3f9356['classList'][_0x27ff5d(0x1493)](_0x27ff5d(0x1a14));}),document[_0x33e5a2(0xb30)]('.phone-tab[onclick*=\x22'+_0x44a2d6+'\x22]')[_0x33e5a2(0x1c1b)][_0x33e5a2(0x21e2)](_0x33e5a2(0x1a14)),document[_0x33e5a2(0x1897)](_0x33e5a2(0x709))[_0x33e5a2(0x19fb)](_0xb80d9e=>{const _0x48290f=_0x33e5a2;_0xb80d9e[_0x48290f(0x14eb)][_0x48290f(0x4da)]=_0x48290f(0x102b);}),document[_0x33e5a2(0x1262)](_0x33e5a2(0x3fd)+_0x44a2d6+_0x33e5a2(0x77c))['style'][_0x33e5a2(0x4da)]=_0x33e5a2(0x13de);if(_0x44a2d6===_0x33e5a2(0x1ba8)){if(!apiSettings[_0x33e5a2(0x1208)]||!apiSettings['key'])console['log'](_0x33e5a2(0xe4f)),generatePhoneNotes();else try{await generatePhoneNotesAPI();}catch(_0x5cf99f){console[_0x33e5a2(0x174a)](_0x33e5a2(0xe29),_0x5cf99f),generatePhoneNotes();}}else{if(_0x44a2d6===_0x33e5a2(0x21c5)){if(!apiSettings[_0x33e5a2(0x1208)]||!apiSettings[_0x33e5a2(0x213c)])console[_0x33e5a2(0x2187)](_0x33e5a2(0x1241)),generatePhonePhotos();else try{await generatePhonePhotosAPI();}catch(_0x81e2d6){console[_0x33e5a2(0x174a)](_0x33e5a2(0x15db),_0x81e2d6),generatePhonePhotos();}}}}async function generatePhoneChatMessagesAPI(_0x55a844){const _0x1ecc36=_0x211817,_0x988b78=document[_0x1ecc36(0x1262)]('phone-chat-messages');if(!_0x988b78)return;if(window[_0x1ecc36(0x2da)]&&window[_0x1ecc36(0x2da)][_0x55a844]){console[_0x1ecc36(0x2187)]('✅\x20使用已加载的聊天记录:',_0x55a844);const _0x4f9e62=window[_0x1ecc36(0x2da)][_0x55a844],_0x31006c=window[_0x1ecc36(0x1bd5)]?.[_0x1ecc36(0xaf4)](_0x30d829=>_0x30d829['name']===_0x55a844),_0x3ec1e3=_0x4f9e62[_0x1ecc36(0x6a4)](_0x5dc9fa=>{const _0x2581b5=_0x1ecc36;if(_0x5dc9fa['type']===_0x2581b5(0x20d4))return _0x2581b5(0xa2c)+_0x5dc9fa['content']+_0x2581b5(0x506);else{if(_0x5dc9fa[_0x2581b5(0x1a4b)]===_0x2581b5(0xb11))return _0x2581b5(0x1c0d)+(_0x31006c?.['avatar']?.[_0x2581b5(0xc3d)]||_0x2581b5(0xa44))+';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22'+(_0x31006c?.[_0x2581b5(0x1f8a)]?.[_0x2581b5(0x40d)]||_0x2581b5(0x1291))+_0x2581b5(0x9dc)+_0x5dc9fa[_0x2581b5(0x211c)]+_0x2581b5(0x20eb)+_0x5dc9fa[_0x2581b5(0x1236)]+_0x2581b5(0xc80);else{let _0x4870a5='';if(currentChatCharacter){const _0x11f0b9=getCurrentChatSettings();_0x4870a5=_0x11f0b9[_0x2581b5(0x179f)]||currentChatCharacter[_0x2581b5(0x1994)]||'';}const _0x3eacaa=_0x4870a5?_0x2581b5(0xf7c)+_0x4870a5+'\x22\x20alt=\x22'+(currentChatCharacter?.['name']||'我')+_0x2581b5(0x999):_0x2581b5(0x752);return _0x2581b5(0x1d3d)+_0x3eacaa+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>'+_0x5dc9fa['content']+_0x2581b5(0x20eb)+_0x5dc9fa[_0x2581b5(0x1236)]+_0x2581b5(0xc80);}}})[_0x1ecc36(0x122b)]('');_0x988b78[_0x1ecc36(0x33a)]=_0x3ec1e3,setTimeout(()=>{const _0x23e1bc=_0x1ecc36;_0x988b78[_0x23e1bc(0x98c)]=_0x988b78[_0x23e1bc(0xfe3)];},0x64);return;}try{_0x988b78['innerHTML']=_0x1ecc36(0x18be)+_0x55a844+'的对话...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x417738=window[_0x1ecc36(0x1bd5)]?.[_0x1ecc36(0xaf4)](_0x2306ee=>_0x2306ee[_0x1ecc36(0x1a1c)]===_0x55a844),_0xd7a9ab=_0x417738?.[_0x1ecc36(0x1e6b)]||'朋友',_0x3aef98=await buildPhoneContextInfo(),_0x5f267c=_0x1ecc36(0x5ba)+currentChatCharacter[_0x1ecc36(0x1a1c)]+_0x1ecc36(0x1b0f)+_0x55a844+'\x22（'+_0xd7a9ab+_0x1ecc36(0x5a7)+_0x3aef98+'\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活状态来生成对话内容\x0a-\x20对话内容要符合两人的真实关系和角色设定\x0a-\x20如果角色是学生，对话应该围绕学习、校园生活、朋友聚会等\x0a-\x20绝对不要生成与角色设定冲突的对话内容\x0a\x0a要求：\x0a1.\x20生成5-10轮完整的对话\x0a2.\x20对话要自然、有趣，严格体现两人的真实关系\x0a3.\x20包含发送和接收的消息\x0a4.\x20消息内容要严格符合角色身份和关系类型\x0a5.\x20可以包含emoji表情\x0a6.\x20时间要合理递增\x0a7.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的对话内容\x0a8.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22messages\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22date\x22,\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22今天\x22\x0a\x20\x20\x20\x20},\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22received\x22,\x20//\x20或\x20\x22sent\x22\x0a\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。',_0x548040=await callPhoneAPI(_0x5f267c),_0x303b34=cleanAndFixJSON(_0x548040);if(_0x303b34[_0x1ecc36(0x1828)]&&Array[_0x1ecc36(0x1496)](_0x303b34[_0x1ecc36(0x1828)])){const _0x4004be=_0x303b34[_0x1ecc36(0x1828)]['map'](_0x215a4f=>{const _0x2c7318=_0x1ecc36;if(_0x215a4f[_0x2c7318(0x1a4b)]===_0x2c7318(0x20d4))return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x215a4f[_0x2c7318(0x211c)]+_0x2c7318(0x1468);else{if(_0x215a4f[_0x2c7318(0x1a4b)]===_0x2c7318(0xb11))return _0x2c7318(0x1b4c)+(_0x417738?.[_0x2c7318(0x1f8a)]?.[_0x2c7318(0xc3d)]||'#007AFF')+';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22'+(_0x417738?.['avatar']?.[_0x2c7318(0x40d)]||_0x2c7318(0x1291))+_0x2c7318(0x50d)+_0x215a4f[_0x2c7318(0x211c)]+_0x2c7318(0x758)+_0x215a4f[_0x2c7318(0x1236)]+_0x2c7318(0x1306);else{let _0x36257e='';if(currentChatCharacter){const _0x12b489=getCurrentChatSettings();_0x36257e=_0x12b489[_0x2c7318(0x179f)]||currentChatCharacter[_0x2c7318(0x1994)]||'';}const _0x1141d4=_0x36257e?_0x2c7318(0xf7c)+_0x36257e+_0x2c7318(0x222c)+(currentChatCharacter?.[_0x2c7318(0x1a1c)]||'我')+_0x2c7318(0x999):_0x2c7318(0x752);return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1141d4+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>'+_0x215a4f[_0x2c7318(0x211c)]+_0x2c7318(0x758)+_0x215a4f[_0x2c7318(0x1236)]+_0x2c7318(0x1306);}}})[_0x1ecc36(0x122b)]('');_0x988b78[_0x1ecc36(0x33a)]=_0x4004be,setTimeout(()=>{_0x988b78['scrollTop']=_0x988b78['scrollHeight'];},0x64);}else throw new Error(_0x1ecc36(0x428));}catch(_0x5cec91){console[_0x1ecc36(0x174a)]('生成对话失败:',_0x5cec91),showToast(_0x1ecc36(0x14d8),'warning'),await generatePhoneChatMessages(_0x55a844);}}async function openPhoneMessage(_0x1bf97d){const _0x37cc24=_0x211817,_0x31f7ab=document[_0x37cc24(0x1262)]('phone-chat-contact-name');_0x31f7ab&&(_0x31f7ab[_0x37cc24(0x13be)]=_0x1bf97d),hideApp(_0x37cc24(0x21d6)),showApp(_0x37cc24(0x203b)),await generatePhoneChatMessagesAPI(_0x1bf97d);}async function generatePhoneChatMessages(_0x1f4e6b){const _0x19f79c=_0x211817,_0x201e90=document[_0x19f79c(0x1262)]('phone-chat-messages');if(!_0x201e90)return;let _0xe02f2d='';if(currentChatCharacter){const _0x170028=getCurrentChatSettings();_0xe02f2d=_0x170028[_0x19f79c(0x179f)]||currentChatCharacter[_0x19f79c(0x1994)]||'';}const _0x1a14ad={'小红':[{'type':_0x19f79c(0x20d4),'content':'今天'},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x1190),'time':_0x19f79c(0xda1)},{'type':_0x19f79c(0x1e6d),'content':'是啊，阳光很温暖','time':_0x19f79c(0x3f7)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x90e),'time':_0x19f79c(0x88f)},{'type':'sent','content':_0x19f79c(0x8fe),'time':_0x19f79c(0x2048)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x4f4),'time':_0x19f79c(0x1e10)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x1875),'time':_0x19f79c(0x1172)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x85a),'time':_0x19f79c(0x84f)}],'小明':[{'type':_0x19f79c(0x20d4),'content':'昨天'},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0xf9a),'time':_0x19f79c(0x46e)},{'type':_0x19f79c(0x1e6d),'content':'还没想好，你有什么建议？','time':_0x19f79c(0xbeb)},{'type':_0x19f79c(0xb11),'content':'听说新开了一家游戏厅，我们去试试？','time':_0x19f79c(0x9fe)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x20b8),'time':_0x19f79c(0x1e00)},{'type':'received','content':_0x19f79c(0xc10),'time':_0x19f79c(0x1c80)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x1fa9),'time':_0x19f79c(0x9da)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x4b3),'time':'14:41'},{'type':'received','content':_0x19f79c(0x1852),'time':'14:43'}],'妈妈':[{'type':_0x19f79c(0x20d4),'content':'昨天'},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0xb1f),'time':'12:00'},{'type':_0x19f79c(0x1e6d),'content':'知道了妈妈，我会注意的','time':'12:05'},{'type':'received','content':'冰箱里有我昨天做的汤，记得热一下喝','time':_0x19f79c(0x7e8)},{'type':_0x19f79c(0x1e6d),'content':'好的，谢谢妈妈！','time':_0x19f79c(0x2277)},{'type':'received','content':_0x19f79c(0x1194),'time':'18:30'},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x3dd),'time':_0x19f79c(0x723)},{'type':_0x19f79c(0xb11),'content':'这周末回家吃饭吗？','time':_0x19f79c(0xbac)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x1e9f),'time':_0x19f79c(0x449)}],'同事小李':[{'type':_0x19f79c(0x20d4),'content':_0x19f79c(0x15ea)},{'type':'received','content':_0x19f79c(0x1e09),'time':_0x19f79c(0x22bb)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0x15da),'time':_0x19f79c(0x1961)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0xd02),'time':_0x19f79c(0xa40)},{'type':_0x19f79c(0x1e6d),'content':'了解，我会认真准备的','time':_0x19f79c(0x1659)},{'type':_0x19f79c(0xb11),'content':'需要我帮你准备什么吗？','time':_0x19f79c(0x1966)},{'type':'sent','content':_0x19f79c(0x1db5),'time':_0x19f79c(0x1fd)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x197),'time':_0x19f79c(0xfdb)}],'室友':[{'type':_0x19f79c(0x20d4),'content':_0x19f79c(0x1955)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x1305),'time':_0x19f79c(0x1aab)},{'type':'sent','content':_0x19f79c(0x2036),'time':'19:32'},{'type':'received','content':_0x19f79c(0x15e5),'time':_0x19f79c(0x402)},{'type':_0x19f79c(0x1e6d),'content':_0x19f79c(0xc74),'time':_0x19f79c(0x11f7)},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0xb0c),'time':_0x19f79c(0x487)},{'type':_0x19f79c(0x1e6d),'content':'完美！我带点零食','time':'19:38'},{'type':_0x19f79c(0xb11),'content':_0x19f79c(0x860),'time':'19:40'}]},_0x5250ba=_0x1a14ad[_0x1f4e6b]||[{'type':_0x19f79c(0x20d4),'content':'今天'},{'type':'received','content':_0x19f79c(0xdab),'time':_0x19f79c(0xc18)},{'type':'sent','content':'你好！','time':'10:01'}],_0x559c98={'小红':{'icon':_0x19f79c(0x465),'color':_0x19f79c(0x320)},'小明':{'icon':_0x19f79c(0xa35),'color':_0x19f79c(0x3e7)},'妈妈':{'icon':_0x19f79c(0x1c1e),'color':_0x19f79c(0x998)},'同事小李':{'icon':_0x19f79c(0x12c0),'color':'#96CEB4'},'室友':{'icon':_0x19f79c(0xd2a),'color':'#FECA57'}},_0x23c2a9=_0x559c98[_0x1f4e6b]||{'icon':_0x19f79c(0x1291),'color':_0x19f79c(0xa44)},_0x522f0c=_0x5250ba[_0x19f79c(0x6a4)](_0x1e97a7=>{const _0x2e75de=_0x19f79c;if(_0x1e97a7[_0x2e75de(0x1a4b)]===_0x2e75de(0x20d4))return _0x2e75de(0x1096)+_0x1e97a7[_0x2e75de(0x211c)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{if(_0x1e97a7['type']===_0x2e75de(0xb11))return _0x2e75de(0x1be1)+_0x23c2a9[_0x2e75de(0xc3d)]+_0x2e75de(0x381)+_0x23c2a9[_0x2e75de(0x40d)]+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>'+_0x1e97a7['content']+_0x2e75de(0x10ff)+_0x1e97a7['time']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';else{const _0x260efe=_0xe02f2d?_0x2e75de(0xf7c)+_0xe02f2d+_0x2e75de(0x1546):_0x2e75de(0x752);return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x260efe+_0x2e75de(0x1d7a)+_0x1e97a7['content']+_0x2e75de(0x10ff)+_0x1e97a7[_0x2e75de(0x1236)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}}})[_0x19f79c(0x122b)]('');_0x201e90[_0x19f79c(0x33a)]=_0x522f0c,setTimeout(()=>{const _0x6dacb2=_0x19f79c;_0x201e90[_0x6dacb2(0x98c)]=_0x201e90['scrollHeight'];},0x64);}function openPhoneNote(_0x426370){const _0x434e90=_0x211817,_0x25559b={'🛒\x20购物清单':{'title':_0x434e90(0x1b1f),'time':'今天\x2014:20','content':_0x434e90(0x22c)},'💼\x20工作计划':{'title':'💼\x20工作计划','time':_0x434e90(0x230a),'content':'本周工作安排：\x0a\x0a1.\x20完成项目报告\x0a\x20\x20\x20-\x20整理数据分析结果\x0a\x20\x20\x20-\x20撰写总结报告\x0a\x20\x20\x20-\x20准备演示文稿\x0a\x0a2.\x20准备下周会议\x0a\x20\x20\x20-\x20收集团队反馈\x0a\x20\x20\x20-\x20制定下阶段计划\x0a\x20\x20\x20-\x20预约会议室\x0a\x0a3.\x20客户沟通\x0a\x20\x20\x20-\x20回复邮件\x0a\x20\x20\x20-\x20安排产品演示\x0a\x20\x20\x20-\x20跟进合作进展\x0a\x0a4.\x20学习提升\x0a\x20\x20\x20-\x20阅读行业报告\x0a\x20\x20\x20-\x20参加在线培训\x0a\x20\x20\x20-\x20整理学习笔记'},'📚\x20读书笔记':{'title':_0x434e90(0x22a2),'time':'2天前','content':_0x434e90(0x12de)},'✈️\x20旅行计划':{'title':_0x434e90(0x1077),'time':'1周前','content':_0x434e90(0x1a52)},'🏃‍♀️\x20健身记录':{'title':_0x434e90(0x1296),'time':_0x434e90(0xf2b),'content':_0x434e90(0x952)}},_0x39fc04=_0x25559b[_0x426370]||{'title':_0x426370,'time':_0x434e90(0x73c),'content':'暂无内容'};document[_0x434e90(0x1262)](_0x434e90(0x2116))[_0x434e90(0x13be)]=_0x39fc04[_0x434e90(0x378)],document['getElementById']('phone-note-detail-time')[_0x434e90(0x13be)]=_0x39fc04['time'],document[_0x434e90(0x1262)]('phone-note-detail-body')[_0x434e90(0x13be)]=_0x39fc04[_0x434e90(0x211c)],hideApp(_0x434e90(0x21d6)),showApp(_0x434e90(0x3fa));}function openPhoneNoteAPI(_0x387c9e){const _0x504bc9=_0x211817,_0x1f7b08=window[_0x504bc9(0x8fb)]?.[_0x504bc9(0xaf4)](_0xb2aad0=>_0xb2aad0['title']===_0x387c9e);_0x1f7b08?(document['getElementById'](_0x504bc9(0x2116))[_0x504bc9(0x13be)]=_0x1f7b08[_0x504bc9(0x378)],document['getElementById'](_0x504bc9(0x1720))['textContent']=_0x1f7b08['time'],document[_0x504bc9(0x1262)](_0x504bc9(0xee0))[_0x504bc9(0x13be)]=_0x1f7b08[_0x504bc9(0x211c)],hideApp(_0x504bc9(0x21d6)),showApp('character-phone-note-screen')):showToast(_0x504bc9(0x34d),_0x504bc9(0x174a));}function openPhonePhotoByIndex(_0xda6b2c){const _0x3d95e6=_0x211817,_0x5114f9=window[_0x3d95e6(0xfdc)]?.[_0xda6b2c];_0x5114f9&&openPhonePhotoAPI(_0x5114f9['title']);}function openPhonePhotoAPI(_0x261658){const _0x1a4db0=_0x211817,_0x2e50a7=window[_0x1a4db0(0xfdc)]?.['find'](_0x40e4f1=>_0x40e4f1[_0x1a4db0(0x378)]===_0x261658);if(_0x2e50a7){const _0x626f30=document[_0x1a4db0(0xb30)](_0x1a4db0(0xc61));_0x626f30&&(_0x626f30[_0x1a4db0(0x13be)]=_0x2e50a7[_0x1a4db0(0x1a4b)]===_0x1a4db0(0xcde)?'视频':'照片');document[_0x1a4db0(0x1262)]('phone-photo-detail-title')[_0x1a4db0(0x13be)]=_0x2e50a7[_0x1a4db0(0x378)],document[_0x1a4db0(0x1262)]('phone-photo-detail-time')[_0x1a4db0(0x13be)]=_0x2e50a7['time'],document[_0x1a4db0(0x1262)](_0x1a4db0(0x14a4))[_0x1a4db0(0x13be)]=_0x2e50a7['description'];const _0xf25d97=document['getElementById'](_0x1a4db0(0xe77));_0x2e50a7[_0x1a4db0(0x1a4b)]===_0x1a4db0(0xcde)?_0xf25d97[_0x1a4db0(0x33a)]=_0x1a4db0(0x1998)+(_0x2e50a7[_0x1a4db0(0x5a4)]||'0:10')+_0x1a4db0(0xd05):_0xf25d97[_0x1a4db0(0x33a)]=_0x1a4db0(0x2038),hideApp(_0x1a4db0(0x21d6)),showApp(_0x1a4db0(0x705));}else showToast(_0x1a4db0(0x1c0c),'error');}function openPhonePhoto(_0x1e4b3e){const _0x555cfc=_0x211817,_0x2e9cb9={'春日樱花':{'title':_0x555cfc(0x1779),'time':'2024年3月15日\x2014:30','description':_0x555cfc(0x1611)},'咖啡时光':{'title':_0x555cfc(0x1ae3),'time':_0x555cfc(0xce3),'description':_0x555cfc(0xa02)},'夕阳西下':{'title':'夕阳西下','time':_0x555cfc(0x170c),'description':_0x555cfc(0x201d)},'城市夜景':{'title':_0x555cfc(0x856),'time':_0x555cfc(0x6c1),'description':_0x555cfc(0x407)},'美食记录':{'title':_0x555cfc(0x53c),'time':'2024年3月5日\x2012:00','description':'今天尝试了一家新开的餐厅，这道菜的摆盘很精致，味道也很不错。和朋友一起享用美食的时光总是特别愉快，值得记录下来。'},'旅行回忆':{'title':_0x555cfc(0x1d88),'time':_0x555cfc(0x2063),'description':_0x555cfc(0x1568)}},_0x444761=_0x2e9cb9[_0x1e4b3e]||{'title':_0x1e4b3e,'time':_0x555cfc(0x73c),'description':_0x555cfc(0xf58)};document[_0x555cfc(0x1262)]('phone-photo-detail-title')[_0x555cfc(0x13be)]=_0x444761[_0x555cfc(0x378)],document[_0x555cfc(0x1262)](_0x555cfc(0xbd4))[_0x555cfc(0x13be)]=_0x444761[_0x555cfc(0x1236)],document[_0x555cfc(0x1262)](_0x555cfc(0x14a4))[_0x555cfc(0x13be)]=_0x444761[_0x555cfc(0x7c9)],hideApp(_0x555cfc(0x21d6)),showApp('character-phone-photo-screen');}async function showCharacterFootprints(){const _0x13ac28=_0x211817;if(!currentChatCharacter){showToast('请先选择一个角色',_0x13ac28(0x174a));return;}if(currentChatCharacter[_0x13ac28(0x1f68)]){showToast(_0x13ac28(0x3d8),_0x13ac28(0x174a));return;}currentFootprintsCharacter=currentChatCharacter;const _0x43d9bb=document[_0x13ac28(0x1262)](_0x13ac28(0x54b)),_0x5487c4=document[_0x13ac28(0x1262)]('footprints-character-avatar');_0x43d9bb&&(_0x43d9bb[_0x13ac28(0x13be)]=currentChatCharacter['name']+'的足迹');if(_0x5487c4){const _0x42bbcf=await getCharacterDisplayAvatar(currentChatCharacter);_0x42bbcf?_0x5487c4[_0x13ac28(0x33a)]=_0x13ac28(0xf7c)+_0x42bbcf+_0x13ac28(0x222c)+currentChatCharacter['name']+'\x22>':_0x5487c4[_0x13ac28(0x33a)]=_0x13ac28(0x752);}showModal('character-footprints-modal'),loadCharacterFootprints(),setupFootprintsAutoUpdate(),restoreFootprintsAutoUpdateSetting();}function hideCharacterFootprints(_0x5631f6){const _0x214c1f=_0x211817;if(_0x5631f6&&_0x5631f6[_0x214c1f(0x193d)]!==_0x5631f6[_0x214c1f(0x1fac)])return;hideModal(_0x214c1f(0x1a79)),footprintsUpdateTimer&&(clearInterval(footprintsUpdateTimer),footprintsUpdateTimer=null),currentFootprintsCharacter=null;}async function loadCharacterFootprints(_0x45a3c2=![]){const _0x2b7688=_0x211817;if(!currentFootprintsCharacter)return;const _0x44146a=document[_0x2b7688(0x1262)](_0x2b7688(0x9b8));if(!_0x44146a)return;const _0x1fbb90=currentFootprintsCharacter['id'];if(!_0x45a3c2){const _0x198ba0=_0x44146a[_0x2b7688(0x1897)](_0x2b7688(0x222a));if(_0x198ba0[_0x2b7688(0x19ee)]>0x0){const _0x2fc060=_0x44146a[_0x2b7688(0x1ecd)][_0x2b7688(0xaf5)];if(_0x2fc060===_0x1fbb90){console[_0x2b7688(0x2187)](_0x2b7688(0x192e)+_0x1fbb90+_0x2b7688(0x512)+_0x198ba0[_0x2b7688(0x19ee)]+_0x2b7688(0x49d));return;}else console['log'](_0x2b7688(0x1303)+_0x2fc060+_0x2b7688(0xccd)+_0x1fbb90+_0x2b7688(0x5a6)),_0x44146a['innerHTML']='';}const _0x5ab760=await getFootprintsCache(_0x1fbb90);if(_0x5ab760){const _0x43559e=Date[_0x2b7688(0x2eb)]()-_0x5ab760[_0x2b7688(0x1716)],_0x6b8f01=Date[_0x2b7688(0x2eb)]()-_0x5ab760[_0x2b7688(0x949)],_0x3395d3=Math['floor'](_0x43559e/(0x3c*0x3c*0x3e8)),_0x535a88=Math['floor'](_0x43559e%(0x3c*0x3c*0x3e8)/(0x3c*0x3e8));console[_0x2b7688(0x2187)]('📦\x20从数据库加载足迹，共\x20'+(_0x5ab760[_0x2b7688(0x22c0)]['activities']?.['length']||0x0)+'\x20个活动'),console[_0x2b7688(0x2187)](_0x2b7688(0x45e),_0x5ab760[_0x2b7688(0x22c0)]),await renderFootprintsTimeline(_0x5ab760[_0x2b7688(0x22c0)],!![]);return;}else{console[_0x2b7688(0x2187)](_0x2b7688(0x849)),await generateTodayFootprints();return;}}if(_0x45a3c2){console[_0x2b7688(0x2187)]('手动刷新：尝试增量更新...'),_0x44146a[_0x2b7688(0x1b7)](_0x2b7688(0x1dc3),'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20footprints-loading-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>--:--</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-sync-alt\x20fa-spin\x22></i>\x20行程报备中...\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x20请稍候\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');const _0x6492b7=await tryIncrementalUpdate(currentFootprintsCharacter),_0x132733=_0x44146a[_0x2b7688(0xb30)]('.footprints-loading-item');_0x132733&&_0x132733[_0x2b7688(0x1493)]();_0x6492b7[_0x2b7688(0x11cb)]&&_0x6492b7[_0x2b7688(0x13fb)]?(console[_0x2b7688(0x2187)](_0x2b7688(0x80d)+_0x6492b7[_0x2b7688(0x17ae)]+_0x2b7688(0x21a8)),showToast(_0x2b7688(0x1b31)+_0x6492b7['newCount']+_0x2b7688(0xa81),_0x2b7688(0x11cb))):(console[_0x2b7688(0x2187)](_0x2b7688(0x1610)),showToast('当前时间段暂无新活动',_0x2b7688(0x477)));return;}_0x44146a['innerHTML']=_0x2b7688(0x186c);try{await generateSampleFootprints();}catch(_0x4e8ca1){console[_0x2b7688(0x174a)](_0x2b7688(0x1e9d),_0x4e8ca1),_0x44146a[_0x2b7688(0x33a)]=_0x2b7688(0x1784);}}async function generateTodayFootprints(){const _0x2e9965=_0x211817,_0x5c00eb=document[_0x2e9965(0x1262)](_0x2e9965(0x9b8));if(!_0x5c00eb||!currentFootprintsCharacter)return;_0x5c00eb['innerHTML']=_0x2e9965(0x13a6);try{const _0x581707=new Date(),_0x2f3106=new Date(_0x581707[_0x2e9965(0x16a0)](),_0x581707[_0x2e9965(0x1da)](),_0x581707['getDate'](),0x0,0x0,0x0),_0x381616=await buildIncrementalFootprintsPrompt(currentFootprintsCharacter,_0x2f3106,_0x581707),_0x3e6c40=await generateCharacterFootprints(_0x381616);if(_0x3e6c40&&_0x3e6c40[_0x2e9965(0xc1e)]&&_0x3e6c40[_0x2e9965(0xc1e)]['length']>0x0)await renderFootprintsTimeline(_0x3e6c40),await setFootprintsCache(currentFootprintsCharacter['id'],_0x3e6c40),console[_0x2e9965(0x2187)]('✅\x20今日足迹生成完成');else throw new Error(_0x2e9965(0x686));}catch(_0x2da45c){console[_0x2e9965(0x174a)]('生成足迹失败:',_0x2da45c),_0x5c00eb[_0x2e9965(0x33a)]=_0x2e9965(0x16c3);}}async function generateSampleFootprints(){const _0xf7751f=_0x211817,_0x229e1a=document['getElementById'](_0xf7751f(0x9b8));if(!_0x229e1a||!currentFootprintsCharacter)return;try{_0x229e1a[_0xf7751f(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20fa-pulse\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在基于角色人设生成足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>分析角色性格、世界书设定和记忆数据中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x12fce8=await buildFootprintsPrompt(),_0x392914=await generateCharacterFootprints(_0x12fce8);_0x392914&&_0x392914['length']>0x0?await renderFootprintsTimeline(_0x392914):_0x229e1a[_0xf7751f(0x33a)]=_0xf7751f(0x54a);}catch(_0x408d8f){console[_0xf7751f(0x174a)](_0xf7751f(0x18f5),_0x408d8f),_0x229e1a[_0xf7751f(0x33a)]=_0xf7751f(0x4c6);}}async function buildFootprintsPrompt(){const _0x662260=_0x211817,_0x11281d=currentFootprintsCharacter,_0x8ef882=new Date(),_0x46635c=_0x8ef882[_0x662260(0x314)](_0x662260(0x156c),{'hour12':![],'hour':'2-digit','minute':_0x662260(0xc79)}),_0xc589b2=_0x8ef882[_0x662260(0xbf7)](_0x662260(0x156c));let _0x262510=_0x662260(0xab0)+_0x11281d[_0x662260(0x1a1c)]+'\x0a';_0x11281d[_0x662260(0x1f0b)]&&(_0x262510+=_0x662260(0x1544)+_0x11281d[_0x662260(0x1f0b)]+'\x0a');_0x11281d[_0x662260(0x1e33)]&&(_0x262510+='角色性格:\x20'+_0x11281d[_0x662260(0x1e33)]+'\x0a');let _0x4e844d='',_0xf5fef9='';try{const _0x3eaece=chatMessages[_0x11281d['id']]||[],_0x1655e2=new Date(),_0x1b7491=new Date(_0x1655e2[_0x662260(0x16a0)](),_0x1655e2[_0x662260(0x1da)](),_0x1655e2[_0x662260(0x520)]())[_0x662260(0x704)](),_0x176995=_0x1b7491+0x18*0x3c*0x3c*0x3e8,_0x344e52=_0x3eaece[_0x662260(0x1e1f)](_0x877506=>{if(_0x877506['timestamp'])return _0x877506['timestamp']>=_0x1b7491&&_0x877506['timestamp']<_0x176995;return![];});if(_0x344e52[_0x662260(0x19ee)]>0x0)_0x4e844d=_0x662260(0x16d1),_0xf5fef9=_0x662260(0x2083),_0x344e52[_0x662260(0x19fb)](_0x271a8d=>{const _0x4a67e1=_0x662260,_0x5d7c39=_0x271a8d[_0x4a67e1(0x8a1)]==='sent'?'用户':_0x11281d[_0x4a67e1(0x1a1c)],_0x427f20=new Date(_0x271a8d[_0x4a67e1(0x1716)])['toLocaleTimeString'](_0x4a67e1(0x156c),{'hour12':![],'hour':_0x4a67e1(0xc79),'minute':_0x4a67e1(0xc79)}),_0x766a04=safeExtractMessageContent(_0x271a8d);_0x4e844d+='['+_0x427f20+']\x20'+_0x5d7c39+':\x20'+_0x766a04+'\x0a',_0xf5fef9+='-\x20'+_0x427f20+_0x4a67e1(0x1bc2);});else{const _0x119dae=_0x3eaece[_0x662260(0x6d5)](-0x3);_0x119dae[_0x662260(0x19ee)]>0x0&&(_0x4e844d=_0x662260(0xd5d),_0x119dae[_0x662260(0x19fb)](_0x28ebf6=>{const _0x18a216=_0x662260,_0x32f4e5=_0x28ebf6[_0x18a216(0x8a1)]===_0x18a216(0x1e6d)?'用户':_0x11281d['name'],_0x292c60=safeExtractMessageContent(_0x28ebf6);_0x4e844d+=_0x32f4e5+':\x20'+_0x292c60+'\x0a';}));}}catch(_0x128689){console[_0x662260(0x2187)](_0x662260(0x2e6),_0x128689);}let _0x1f18ee='';try{const _0xdf4472=getCurrentChatSettings(),_0x1304c6=_0xdf4472[_0x662260(0x1a45)]||[],_0x2f4095=window[_0x662260(0x1a4e)]||[],_0x59409c=[...new Set([..._0x2f4095,..._0x1304c6])];_0x59409c['length']>0x0&&(_0x1f18ee=_0x662260(0xdb8),_0x59409c[_0x662260(0x19fb)]((_0x5b87ca,_0x518b66)=>{const _0x5c5038=_0x662260,_0x4cef70=worldbooks[_0x5c5038(0xaf4)](_0x16a4ee=>_0x16a4ee['id']===_0x5b87ca);_0x4cef70&&(_0x1f18ee+=_0x518b66+0x1+'.\x20'+(_0x4cef70['name']||_0x4cef70[_0x5c5038(0x378)])+':\x20'+_0x4cef70[_0x5c5038(0x211c)]+'\x0a');}));}catch(_0x64c908){console['log'](_0x662260(0xab4),_0x64c908);}let _0x4dd132='';try{const _0x1756fd=getGlobalMemorySettings();if(_0x1756fd['enabled']!==![]){const _0xfd087a={'type':_0x11281d[_0x662260(0x1f68)]?_0x662260(0x764):_0x662260(0x219),'id':_0x11281d['id']};_0x4dd132=await buildGlobalMemoryContext(_0x11281d['id'],_0xfd087a,_0x1756fd[_0x662260(0x1715)]||0x7),_0x4dd132&&_0x4dd132[_0x662260(0x19d7)]()&&(_0x4dd132=_0x662260(0x2bf)+_0x4dd132+'\x0a');}}catch(_0x2a5a62){console[_0x662260(0x2187)]('获取全局记忆失败:',_0x2a5a62);}const _0x222b49=_0x662260(0x938)+_0x262510+_0x1f18ee+_0x4e844d+_0xf5fef9+_0x4dd132+_0x662260(0x621)+_0xc589b2+'\x20'+_0x46635c+_0x662260(0xac8)+_0x46635c+_0x662260(0xdd0)+_0x46635c+'。';return _0x222b49;}async function generateCharacterFootprints(_0x3e3705,_0x1104e8=null){const _0x164b3c=_0x211817;try{const _0x53740d=_0x1104e8||currentFootprintsCharacter;if(!_0x53740d)return console[_0x164b3c(0x174a)](_0x164b3c(0x421)),null;await debugDatabaseTypes();if(!currentFootprintsCharacter||typeof currentFootprintsCharacter['id']!=='string')return console['error'](_0x164b3c(0xabe),currentFootprintsCharacter),null;const _0x395306=await callChatAPI(_0x3e3705,_0x53740d);if(!_0x395306||typeof _0x395306!==_0x164b3c(0x11b7))return console[_0x164b3c(0x174a)](_0x164b3c(0x533),_0x395306),null;if(_0x395306[_0x164b3c(0x1831)]('空响应次数达到上限')||_0x395306[_0x164b3c(0x1831)](_0x164b3c(0x1b72)))return console[_0x164b3c(0x174a)](_0x164b3c(0x1ba3),_0x395306),null;let _0x61d0de;try{let _0x47d238=_0x395306[_0x164b3c(0xe16)](/```json\n?/g,'')[_0x164b3c(0xe16)](/```\n?/g,'')['trim']();if(!_0x47d238)return console[_0x164b3c(0x174a)]('❌\x20清理后的响应为空'),null;const _0x4783eb=getCurrentPersonaName();_0x47d238=_0x47d238[_0x164b3c(0xe16)](/\{\{user\}\}/g,_0x4783eb),_0x61d0de=JSON[_0x164b3c(0x22d3)](_0x47d238);}catch(_0x1d226d){return console['error'](_0x164b3c(0x1041),_0x1d226d),console['log'](_0x164b3c(0xba6),_0x395306),null;}if(Array[_0x164b3c(0x1496)](_0x61d0de)){const _0x556232=_0x61d0de[_0x164b3c(0x1e1f)](_0x5926d7=>_0x5926d7[_0x164b3c(0x1236)]&&_0x5926d7[_0x164b3c(0x16f6)]&&_0x5926d7['location']&&_0x5926d7['type']),_0x130a56=getCurrentPersonaName();return _0x556232[_0x164b3c(0x19fb)](_0x5215e7=>{const _0x5e4d8c=_0x164b3c;if(_0x5215e7[_0x5e4d8c(0x16f6)])_0x5215e7[_0x5e4d8c(0x16f6)]=_0x5215e7[_0x5e4d8c(0x16f6)][_0x5e4d8c(0xe16)](/\{\{user\}\}/g,_0x130a56);if(_0x5215e7[_0x5e4d8c(0x2184)])_0x5215e7[_0x5e4d8c(0x2184)]=_0x5215e7[_0x5e4d8c(0x2184)][_0x5e4d8c(0xe16)](/\{\{user\}\}/g,_0x130a56);}),_0x556232;}else{if(_0x61d0de&&typeof _0x61d0de===_0x164b3c(0x28d)){if(_0x61d0de[_0x164b3c(0xc1e)]&&Array[_0x164b3c(0x1496)](_0x61d0de[_0x164b3c(0xc1e)])){const _0x504253=getCurrentPersonaName();return _0x61d0de[_0x164b3c(0xc1e)]['forEach'](_0x2263a2=>{const _0x49c2c6=_0x164b3c;if(_0x2263a2['activity'])_0x2263a2[_0x49c2c6(0x16f6)]=_0x2263a2[_0x49c2c6(0x16f6)][_0x49c2c6(0xe16)](/\{\{user\}\}/g,_0x504253);if(_0x2263a2[_0x49c2c6(0x2184)])_0x2263a2['location']=_0x2263a2[_0x49c2c6(0x2184)]['replace'](/\{\{user\}\}/g,_0x504253);}),_0x61d0de[_0x164b3c(0x415)]&&_0x61d0de[_0x164b3c(0x415)][_0x164b3c(0x19fb)](_0x58e6d8=>{const _0xea7b77=_0x164b3c;if(_0x58e6d8[_0xea7b77(0x1a1c)])_0x58e6d8[_0xea7b77(0x1a1c)]=_0x58e6d8[_0xea7b77(0x1a1c)][_0xea7b77(0xe16)](/\{\{user\}\}/g,_0x504253);}),console[_0x164b3c(0x2187)]('✅\x20足迹数据格式正确:',_0x61d0de),_0x61d0de;}else return console[_0x164b3c(0x174a)](_0x164b3c(0x43c),_0x61d0de),null;}else return console['error']('足迹数据格式不正确:',_0x61d0de),null;}}catch(_0x45eaad){return console[_0x164b3c(0x174a)](_0x164b3c(0x1345),_0x45eaad),null;}}async function renderFootprintsTimeline(_0x3c8da1,_0x3b290a=![]){const _0x5254d2=_0x211817,_0x444d32=document[_0x5254d2(0x1262)](_0x5254d2(0x9b8));if(!_0x444d32||!currentFootprintsCharacter)return;let _0x4d4450=[];if(Array[_0x5254d2(0x1496)](_0x3c8da1))_0x4d4450=_0x3c8da1;else{if(_0x3c8da1&&_0x3c8da1['activities'])_0x4d4450=_0x3c8da1['activities'];else{console[_0x5254d2(0x174a)](_0x5254d2(0x12ba),_0x3c8da1);return;}}console[_0x5254d2(0x2187)](_0x5254d2(0x1a20)+_0x4d4450[_0x5254d2(0x19ee)]+'\x20个活动',_0x4d4450);const _0x54e75e=_0x4d4450[_0x5254d2(0x1104)]((_0x38fff1,_0x343fb2)=>_0x343fb2[_0x5254d2(0x1236)]['localeCompare'](_0x38fff1[_0x5254d2(0x1236)])),_0xe6883b=_0x54e75e[_0x5254d2(0x6a4)]((_0x6887ea,_0x49b877)=>_0x5254d2(0xf81)+_0x6887ea[_0x5254d2(0x1a4b)]+_0x5254d2(0x10e0)+_0x49b877*0.1+'s\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>'+_0x6887ea[_0x5254d2(0x1236)]+_0x5254d2(0x9d7)+_0x6887ea['activity']+_0x5254d2(0x13c8)+_0x6887ea[_0x5254d2(0x2184)]+_0x5254d2(0x1894))[_0x5254d2(0x122b)]('');_0x444d32[_0x5254d2(0x33a)]=_0xe6883b,currentFootprintsCharacter&&(_0x444d32['dataset']['characterId']=currentFootprintsCharacter['id']),!_0x3b290a&&currentFootprintsCharacter&&await setFootprintsCache(currentFootprintsCharacter['id'],_0x3c8da1);}function appendNewFootprintsToTimeline(_0x585b43){const _0x9f17b9=_0x211817,_0x51a831=document[_0x9f17b9(0x1262)](_0x9f17b9(0x9b8));if(!_0x51a831||!currentFootprintsCharacter)return;let _0x1bd78e=[];if(Array[_0x9f17b9(0x1496)](_0x585b43))_0x1bd78e=_0x585b43;else{if(_0x585b43&&_0x585b43[_0x9f17b9(0xc1e)])_0x1bd78e=_0x585b43[_0x9f17b9(0xc1e)];else{console[_0x9f17b9(0x174a)](_0x9f17b9(0x51b),_0x585b43);return;}}if(_0x1bd78e[_0x9f17b9(0x19ee)]===0x0){console[_0x9f17b9(0x2187)](_0x9f17b9(0x544));return;}console[_0x9f17b9(0x2187)](_0x9f17b9(0x1380)+_0x1bd78e[_0x9f17b9(0x19ee)]+'\x20个新足迹');const _0xf3f9c9=_0x1bd78e[_0x9f17b9(0x1104)]((_0xd4847c,_0x363851)=>_0x363851[_0x9f17b9(0x1236)][_0x9f17b9(0xe9e)](_0xd4847c[_0x9f17b9(0x1236)]));_0xf3f9c9['reverse']()[_0x9f17b9(0x19fb)]((_0x40c817,_0x415086)=>{const _0x9303d0=_0x9f17b9,_0x49d472='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20type-'+(_0x40c817['type']||_0x9303d0(0xb93))+_0x9303d0(0x1646)+_0x415086*0.2+'s;\x20opacity:\x200;\x20transform:\x20translateY(-20px);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-time\x22>'+_0x40c817[_0x9303d0(0x1236)]+_0x9303d0(0x2030)+_0x40c817[_0x9303d0(0x16f6)]+_0x9303d0(0xc91)+_0x40c817['location']+_0x9303d0(0x21ae);_0x51a831[_0x9303d0(0x1b7)](_0x9303d0(0x1dc3),_0x49d472);}),setTimeout(()=>{const _0x31d3d8=_0x9f17b9,_0x48e37c=_0x51a831[_0x31d3d8(0x1897)](_0x31d3d8(0x1321));_0x48e37c[_0x31d3d8(0x19fb)]((_0x29893a,_0x48b187)=>{setTimeout(()=>{const _0x140647=_0x167f;_0x29893a[_0x140647(0x14eb)][_0x140647(0x11af)]='1',_0x29893a[_0x140647(0x14eb)][_0x140647(0x201e)]=_0x140647(0x18f9),_0x29893a[_0x140647(0x14eb)][_0x140647(0x1022)]=_0x140647(0x1e35),_0x29893a[_0x140647(0x1c1b)][_0x140647(0x21e2)](_0x140647(0x3e0)),setTimeout(()=>{const _0xf21179=_0x140647;_0x29893a[_0xf21179(0x1c1b)][_0xf21179(0x1493)]('new-footprint',_0xf21179(0x3e0));},0xbb8);},_0x48b187*0xc8);});},0x64);}async function refreshCharacterFootprints(){const _0x3facd7=_0x211817,_0x5d1f13=document[_0x3facd7(0xb30)](_0x3facd7(0x5b8));_0x5d1f13&&(_0x5d1f13[_0x3facd7(0x1c1b)]['add'](_0x3facd7(0x12ac)),_0x5d1f13[_0x3facd7(0x559)]=!![]);try{await loadCharacterFootprints(!![]),showToast(_0x3facd7(0x2a2),_0x3facd7(0x11cb));}catch(_0x1c5960){console[_0x3facd7(0x174a)](_0x3facd7(0x15c9),_0x1c5960),showToast(_0x3facd7(0xdd8),_0x3facd7(0x174a));}finally{setTimeout(()=>{const _0xab1591=_0x3facd7;_0x5d1f13&&(_0x5d1f13[_0xab1591(0x1c1b)]['remove'](_0xab1591(0x12ac)),_0x5d1f13['disabled']=![]);},0x3e8);}}function updateFootprintsFrequency(){setupFootprintsAutoUpdate();}function restoreFootprintsAutoUpdateSetting(){const _0x422b7e=_0x211817,_0x4b63b9=localStorage[_0x422b7e(0x15d8)](_0x422b7e(0x1349));if(_0x4b63b9){const _0x57f63b=document['getElementById']('footprints-update-frequency');_0x57f63b&&(_0x57f63b[_0x422b7e(0x1ebc)]=_0x4b63b9,console[_0x422b7e(0x2187)](_0x422b7e(0x1127)+_0x4b63b9));}}function initializeFootprintsAutoUpdate(){const _0x3cd40f=_0x211817;restoreFootprintsAutoUpdateSetting();const _0x33bc94=localStorage[_0x3cd40f(0x15d8)](_0x3cd40f(0x1349));_0x33bc94&&_0x33bc94!==_0x3cd40f(0xe21)&&(console[_0x3cd40f(0x2187)](_0x3cd40f(0x1dad)),setupFootprintsAutoUpdate());}function setupFootprintsAutoUpdate(){const _0x11b55c=_0x211817;footprintsUpdateTimer&&(clearInterval(footprintsUpdateTimer),footprintsUpdateTimer=null);const _0x2b131e=document['getElementById'](_0x11b55c(0x1ce4));if(!_0x2b131e)return;const _0xedf3a6=_0x2b131e[_0x11b55c(0x1ebc)];if(_0xedf3a6==='manual'){console[_0x11b55c(0x2187)](_0x11b55c(0x1721)),localStorage[_0x11b55c(0x192)](_0x11b55c(0x1349),_0x11b55c(0xe21));return;}const _0x166b11=parseInt(_0xedf3a6),_0x2013f9=_0x166b11*0x3c*0x3e8;console[_0x11b55c(0x2187)](_0x11b55c(0x3ce)+_0x166b11+_0x11b55c(0x248)),localStorage[_0x11b55c(0x192)](_0x11b55c(0x1349),_0xedf3a6),footprintsUpdateTimer=setInterval(async()=>{const _0x3a5f11=_0x11b55c;console[_0x3a5f11(0x2187)]('🔄\x20后台自动更新足迹数据...');try{await updateAllCharacterFootprints();const _0x3c3b02=document[_0x3a5f11(0x1262)]('character-footprints-modal');currentFootprintsCharacter&&_0x3c3b02&&_0x3c3b02[_0x3a5f11(0x14eb)][_0x3a5f11(0x4da)]!=='none'&&(await loadCharacterFootprints(![]),console[_0x3a5f11(0x2187)](_0x3a5f11(0xc20)));}catch(_0x5a735c){console[_0x3a5f11(0x174a)]('后台自动更新足迹失败:',_0x5a735c);}},_0x2013f9);}async function updateAllCharacterFootprints(){const _0x505f08=_0x211817;try{console[_0x505f08(0x2187)]('🔄\x20开始后台更新所有角色的足迹');for(const _0x1bfd2f of characters){try{await updateCharacterFootprintsIncremental(_0x1bfd2f);}catch(_0x277413){console['error'](_0x505f08(0x1352)+_0x1bfd2f[_0x505f08(0x1a1c)]+_0x505f08(0x82e),_0x277413);}}console[_0x505f08(0x2187)]('✅\x20后台足迹更新完成');}catch(_0x82da5b){console[_0x505f08(0x174a)]('后台更新足迹失败:',_0x82da5b);}}async function updateCharacterFootprintsIncremental(_0x5d2aed){const _0x18e736=_0x211817,_0x411a5c=_0x5d2aed['id'],_0x4eae00=await getFootprintsCache(_0x411a5c);if(!_0x4eae00){console[_0x18e736(0x2187)](_0x18e736(0x150a)+_0x5d2aed['name']+'\x20没有足迹缓存，生成完整足迹');const _0x161b05=await buildFootprintsPrompt(),_0x5f3f06=await generateCharacterFootprints(_0x161b05,_0x5d2aed);if(_0x5f3f06)return await setFootprintsCache(_0x411a5c,_0x5f3f06,Date[_0x18e736(0x2eb)]()),console['log'](_0x18e736(0xe1a)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0xdb7)),{'hasNewContent':!![],'newCount':_0x5f3f06[_0x18e736(0xc1e)]?.[_0x18e736(0x19ee)]||0x0};return{'hasNewContent':![],'newCount':0x0};}const _0x1f0ac4=new Date(),_0x58e0ea=new Date(_0x4eae00[_0x18e736(0x949)]);console['log'](_0x18e736(0x20cd)+_0x5d2aed['name']+_0x18e736(0xe0e));try{const _0x2a5b93=(_0x1f0ac4-_0x58e0ea)/(0x3e8*0x3c);if(_0x2a5b93<0xa)return console[_0x18e736(0x2187)](_0x18e736(0x150a)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x2211)+Math[_0x18e736(0x13e2)](_0x2a5b93)+_0x18e736(0xf78)),{'hasNewContent':![],'newCount':0x0};console[_0x18e736(0x2187)](_0x18e736(0xf84)+_0x5d2aed['name']+'\x20生成\x20'+Math[_0x18e736(0x13e2)](_0x2a5b93)+'\x20分钟的新足迹...');const _0xeb26fb=await buildIncrementalFootprintsPrompt(_0x5d2aed,_0x58e0ea,_0x1f0ac4),_0x22792a=await generateCharacterFootprints(_0xeb26fb,_0x5d2aed);if(_0x22792a&&_0x22792a[_0x18e736(0xc1e)]&&_0x22792a[_0x18e736(0xc1e)][_0x18e736(0x19ee)]>0x0){const _0x9f891e=await appendToFootprintsCache(_0x411a5c,_0x22792a);return _0x9f891e?(console[_0x18e736(0x2187)](_0x18e736(0xe1a)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x1c89)+_0x22792a[_0x18e736(0xc1e)]['length']+'\x20个活动'),currentFootprintsCharacter&&currentFootprintsCharacter['id']===_0x411a5c&&(console['log'](_0x18e736(0x968)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0xc2b)),appendNewFootprintsToTimeline(_0x22792a)),{'hasNewContent':!![],'newCount':_0x22792a[_0x18e736(0xc1e)][_0x18e736(0x19ee)]}):(console[_0x18e736(0x174a)](_0x18e736(0x59b)+_0x5d2aed[_0x18e736(0x1a1c)]+'\x20缓存保存失败，但仍更新DOM显示'),currentFootprintsCharacter&&currentFootprintsCharacter['id']===_0x411a5c&&(console[_0x18e736(0x2187)](_0x18e736(0x968)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x21ea)),appendNewFootprintsToTimeline(_0x22792a)),{'hasNewContent':!![],'newCount':_0x22792a[_0x18e736(0xc1e)][_0x18e736(0x19ee)]});}else{console[_0x18e736(0x2187)]('⚠️\x20角色\x20'+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x323));try{const _0x322002=getLocalDateString(),_0x27b58b=_0x411a5c+'_'+_0x322002,_0x283ac8=await db[_0x18e736(0xcbc)][_0x18e736(0xb78)](_0x27b58b);_0x283ac8&&(_0x283ac8[_0x18e736(0x949)]=Date[_0x18e736(0x2eb)](),await db['characterFootprints'][_0x18e736(0x1561)](_0x283ac8),console['log'](_0x18e736(0xde5)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x1af8)));}catch(_0xab766c){console[_0x18e736(0x174a)](_0x18e736(0x1352)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0x129d),_0xab766c);}return{'hasNewContent':![],'newCount':0x0};}}catch(_0x2e6386){return console['error'](_0x18e736(0x150a)+_0x5d2aed[_0x18e736(0x1a1c)]+_0x18e736(0xb85),_0x2e6386),{'hasNewContent':![],'newCount':0x0};}}async function tryIncrementalUpdate(_0x5d1371){const _0xc9ffc6=_0x211817;try{console[_0xc9ffc6(0x2187)](_0xc9ffc6(0x457)+_0x5d1371[_0xc9ffc6(0x1a1c)]+_0xc9ffc6(0x5a6));const _0x36ba44=await updateCharacterFootprintsIncremental(_0x5d1371);return console[_0xc9ffc6(0x2187)]('✅\x20角色\x20'+_0x5d1371['name']+_0xc9ffc6(0x116f),_0x36ba44),{'success':!![],'hasNewContent':_0x36ba44[_0xc9ffc6(0x13fb)],'newCount':_0x36ba44[_0xc9ffc6(0x17ae)]};}catch(_0x3b5c81){return console[_0xc9ffc6(0x174a)](_0xc9ffc6(0x20f3),_0x3b5c81),{'success':![],'hasNewContent':![],'newCount':0x0};}}async function buildIncrementalFootprintsPrompt(_0x2ea6fd,_0x414302,_0x4ff23b){const _0xfbeeeb=_0x211817,_0x256944=_0x414302[_0xfbeeeb(0x314)](_0xfbeeeb(0x156c),{'hour12':![],'hour':_0xfbeeeb(0xc79),'minute':_0xfbeeeb(0xc79)}),_0x1704db=_0x4ff23b['toLocaleTimeString'](_0xfbeeeb(0x156c),{'hour12':![],'hour':'2-digit','minute':_0xfbeeeb(0xc79)}),_0x329dfb=await getFootprintsCache(_0x2ea6fd['id']),_0x30245b=_0x329dfb?.['data']?.[_0xfbeeeb(0xc1e)]||[],_0x295bad=await getRecentChatContext(_0x2ea6fd['id'],_0x414302,_0x4ff23b),_0x457ad1=_0x30245b[_0xfbeeeb(0x19ee)]>0x0?_0x30245b[_0x30245b[_0xfbeeeb(0x19ee)]-0x1]:null,_0x1b8e83=_0x457ad1?'最后活动:\x20'+_0x457ad1[_0xfbeeeb(0x1236)]+'\x20-\x20'+_0x457ad1[_0xfbeeeb(0x16f6)]+_0xfbeeeb(0x564)+_0x457ad1[_0xfbeeeb(0x2184)]+_0xfbeeeb(0x1a78)+(_0x457ad1[_0xfbeeeb(0x9f7)]||'正常')+')':_0xfbeeeb(0x5f3),_0x1adefd=analyzeTimeSegment(_0x414302,_0x4ff23b),_0x9e8b8=!_0x295bad['includes'](_0xfbeeeb(0xaec)),_0x1b7857=_0xfbeeeb(0x303)+_0x256944+_0xfbeeeb(0x11c9)+_0x1704db+_0xfbeeeb(0x1240)+_0x2ea6fd[_0xfbeeeb(0x1a1c)]+'\x0a-\x20人设:\x20'+(_0x2ea6fd[_0xfbeeeb(0x198b)]||'暂无')+_0xfbeeeb(0x17ed)+_0x1b8e83+_0xfbeeeb(0x7b7)+_0x1adefd+_0xfbeeeb(0x1072)+_0x295bad+_0xfbeeeb(0x14ee)+(_0x30245b[_0xfbeeeb(0x6a4)](_0x2da4c4=>_0x2da4c4['time']+'\x20-\x20'+_0x2da4c4[_0xfbeeeb(0x16f6)]+'\x20('+_0x2da4c4[_0xfbeeeb(0x2184)]+_0xfbeeeb(0x765)+(_0x2da4c4[_0xfbeeeb(0x9f7)]||'正常')+']')[_0xfbeeeb(0x122b)]('\x0a')||_0xfbeeeb(0xe93))+_0xfbeeeb(0xb61)+(_0x9e8b8?_0xfbeeeb(0x1d0b):_0xfbeeeb(0x1c8c))+_0xfbeeeb(0xd3f)+_0x1adefd+_0xfbeeeb(0x55c)+_0x2ea6fd['name']+_0xfbeeeb(0xed5)+(_0x9e8b8?_0xfbeeeb(0x158a):_0xfbeeeb(0x200a))+_0xfbeeeb(0x66b);return _0x1b7857;}function analyzeTimeSegment(_0x267ab7,_0x5a59e8){const _0x58a8b=_0x211817,_0x2282e2=_0x267ab7[_0x58a8b(0xe2e)](),_0x244b77=_0x5a59e8['getHours'](),_0x4107cc=(_0x5a59e8-_0x267ab7)/(0x3e8*0x3c);let _0x50ae9a=[];_0x2282e2>=0x6&&_0x2282e2<0x9&&_0x50ae9a[_0x58a8b(0x1cd6)](_0x58a8b(0x7a6));_0x2282e2>=0x9&&_0x2282e2<0xc&&_0x50ae9a[_0x58a8b(0x1cd6)](_0x58a8b(0xad7));_0x2282e2>=0xc&&_0x2282e2<0xe&&_0x50ae9a[_0x58a8b(0x1cd6)]('午间休息（适合用餐、午休、轻松活动）');_0x2282e2>=0xe&&_0x2282e2<0x12&&_0x50ae9a[_0x58a8b(0x1cd6)](_0x58a8b(0x1e60));_0x2282e2>=0x12&&_0x2282e2<0x15&&_0x50ae9a[_0x58a8b(0x1cd6)](_0x58a8b(0xc78));_0x2282e2>=0x15&&_0x2282e2<0x18&&_0x50ae9a['push']('夜晚时光（适合休闲、反思、准备休息）');_0x2282e2>=0x0&&_0x2282e2<0x6&&_0x50ae9a[_0x58a8b(0x1cd6)]('深夜/凌晨（通常是休息时间，偶尔可能有特殊活动）');let _0x5dad3b='';if(_0x4107cc<=0x1e)_0x5dad3b=_0x58a8b(0x1bf8);else _0x4107cc<=0x78?_0x5dad3b=_0x58a8b(0x6be):_0x5dad3b=_0x58a8b(0x12ea);return _0x50ae9a[_0x58a8b(0x122b)]('、')+'；'+_0x5dad3b+'（时长约'+Math[_0x58a8b(0x13e2)](_0x4107cc)+'分钟）';}async function getRecentChatContext(_0x307f7c,_0x3f3838,_0x38e576){const _0x2a4364=_0x211817;try{const _0xee910e=chatMessages[_0x307f7c]||[],_0x3a6fe9=_0xee910e[_0x2a4364(0x1e1f)](_0xfae88e=>{const _0x3efd49=new Date(_0xfae88e['timestamp']);return _0x3efd49>=_0x3f3838&&_0x3efd49<=_0x38e576;});if(_0x3a6fe9[_0x2a4364(0x19ee)]===0x0)return _0x2a4364(0x1e98);const _0x174cc1=_0x3a6fe9['map'](_0x4ddf58=>{const _0x9eee6f=_0x2a4364,_0x1bc437=_0x4ddf58['sender']===_0x9eee6f(0x1e6d)?'用户':'角色',_0x2e05f7=new Date(_0x4ddf58[_0x9eee6f(0x1716)])[_0x9eee6f(0x314)](_0x9eee6f(0x156c),{'hour12':![],'hour':_0x9eee6f(0xc79),'minute':_0x9eee6f(0xc79)}),_0x50f232=safeExtractMessageContent(_0x4ddf58);return'['+_0x2e05f7+']\x20'+_0x1bc437+':\x20'+_0x50f232;})[_0x2a4364(0x122b)]('\x0a');return _0x2a4364(0x1542)+_0x174cc1+_0x2a4364(0xf3d);}catch(_0x491293){return console[_0x2a4364(0x174a)]('获取聊天上下文失败:',_0x491293),_0x2a4364(0x1ba7);}}function changeCharacterAvatar(){const _0x593d6b=_0x211817,_0x244fd7=document[_0x593d6b(0xac6)]('input');_0x244fd7[_0x593d6b(0x1a4b)]='file',_0x244fd7[_0x593d6b(0x1515)]=_0x593d6b(0x2ae),_0x244fd7[_0x593d6b(0x14eb)][_0x593d6b(0x4da)]=_0x593d6b(0x102b),document[_0x593d6b(0x1da9)]['appendChild'](_0x244fd7),_0x244fd7[_0x593d6b(0x1980)]=function(_0x47d287){const _0x564716=_0x593d6b;if(_0x47d287[_0x564716(0x193d)][_0x564716(0xf26)]&&_0x47d287[_0x564716(0x193d)]['files'][0x0]){const _0xc09bb3=new FileReader();_0xc09bb3[_0x564716(0xc55)]=async function(_0x3b4232){const _0x2b88af=_0x564716,_0x23fc49=characters[_0x2b88af(0x150c)](_0x4f7355=>_0x4f7355['id']===currentChatCharacter['id']);_0x23fc49!==-0x1&&(characters[_0x23fc49][_0x2b88af(0x1994)]=_0x3b4232[_0x2b88af(0x193d)][_0x2b88af(0x4ee)],await saveCharacters(),renderCharacterList(),renderContactList(),renderMessageList(),renderChatMessages(currentChatCharacter['id'])),document[_0x2b88af(0x1da9)][_0x2b88af(0x858)](_0x244fd7);},_0xc09bb3['readAsDataURL'](_0x47d287[_0x564716(0x193d)][_0x564716(0xf26)][0x0]);}else document[_0x564716(0x1da9)][_0x564716(0x858)](_0x244fd7);},_0x244fd7[_0x593d6b(0x1859)]();}async function changeCharacterNickname(){const _0x5dfa5b=_0x211817,_0x1c1e64=prompt('请输入新的备注名称:',currentChatCharacter[_0x5dfa5b(0x1a1c)]);if(_0x1c1e64&&_0x1c1e64[_0x5dfa5b(0x19d7)]()!==''){const _0x2985d2=characters['findIndex'](_0x32991f=>_0x32991f['id']===currentChatCharacter['id']);if(_0x2985d2!==-0x1){characters[_0x2985d2][_0x5dfa5b(0x1a1c)]=_0x1c1e64[_0x5dfa5b(0x19d7)](),await saveCharacters();const _0x2a58b7=document[_0x5dfa5b(0x1262)](_0x5dfa5b(0x2053));_0x2a58b7&&(_0x2a58b7[_0x5dfa5b(0x13be)]=_0x1c1e64['trim'](),_0x2a58b7[_0x5dfa5b(0x1c1b)]['remove']('typing-status'),_0x2a58b7['dataset'][_0x5dfa5b(0x417)]=_0x1c1e64[_0x5dfa5b(0x19d7)]()),renderCharacterList(),renderContactList(),renderMessageList();}}}function searchChatContent(){const _0x2d9271=_0x211817;if(!currentChatCharacter){showToast(_0x2d9271(0x14e6),_0x2d9271(0x1816));return;}document[_0x2d9271(0x1262)](_0x2d9271(0xb86))[_0x2d9271(0x1ebc)]='',document['getElementById'](_0x2d9271(0x178e))['style'][_0x2d9271(0x4da)]=_0x2d9271(0x102b),document[_0x2d9271(0x1262)](_0x2d9271(0x1a04))[_0x2d9271(0x14eb)][_0x2d9271(0x4da)]=_0x2d9271(0x102b),showModal(_0x2d9271(0x24a)),setTimeout(()=>{const _0x289d70=_0x2d9271;document['getElementById']('search-keyword-input')[_0x289d70(0x13cf)]();},0x64);}async function performChatSearch(){const _0x4c28bf=_0x211817,_0x45de69=document[_0x4c28bf(0x1262)](_0x4c28bf(0xb86))[_0x4c28bf(0x1ebc)][_0x4c28bf(0x19d7)]();if(!_0x45de69){showToast('请输入搜索关键词',_0x4c28bf(0x1816));return;}let _0x438959=[];try{const _0x29f124=await db['chatMessages']['where'](_0x4c28bf(0xaf5))['equals'](currentChatCharacter['id'])[_0x4c28bf(0xf13)]();_0x438959=_0x29f124['sort']((_0x40ab37,_0x3b0d08)=>_0x40ab37[_0x4c28bf(0x1716)]-_0x3b0d08[_0x4c28bf(0x1716)]);}catch(_0x236163){console[_0x4c28bf(0x174a)](_0x4c28bf(0x2e6),_0x236163),_0x438959=chatMessages[currentChatCharacter['id']]||[];}const _0x123d22=_0x438959[_0x4c28bf(0x1e1f)]((_0x527dea,_0xac8272)=>{const _0x74bb3d=_0x4c28bf;if(!_0x527dea[_0x74bb3d(0x1ea3)])return![];const _0x3bc4b3=_0x527dea[_0x74bb3d(0x1ea3)];let _0x445423='';if(typeof _0x3bc4b3[_0x74bb3d(0x211c)]===_0x74bb3d(0x11b7))_0x445423=_0x3bc4b3[_0x74bb3d(0x211c)];else{if(Array[_0x74bb3d(0x1496)](_0x3bc4b3[_0x74bb3d(0x211c)]))_0x445423=_0x3bc4b3[_0x74bb3d(0x211c)][_0x74bb3d(0x1e1f)](_0x17ca51=>_0x17ca51&&_0x17ca51['type']===_0x74bb3d(0x1378))[_0x74bb3d(0x6a4)](_0x50e787=>_0x50e787[_0x74bb3d(0x1378)]||'')[_0x74bb3d(0x122b)]('\x20');else _0x3bc4b3[_0x74bb3d(0x211c)]&&typeof _0x3bc4b3[_0x74bb3d(0x211c)]===_0x74bb3d(0x28d)?_0x445423=_0x3bc4b3['content'][_0x74bb3d(0x1378)]||_0x3bc4b3[_0x74bb3d(0x211c)][_0x74bb3d(0x211c)]||'':_0x445423=_0x3bc4b3[_0x74bb3d(0x211c)]?String(_0x3bc4b3[_0x74bb3d(0x211c)]):'';}return typeof _0x445423!==_0x74bb3d(0x11b7)&&(_0x445423=''),_0x445423[_0x74bb3d(0x49e)]()[_0x74bb3d(0x1831)](_0x45de69[_0x74bb3d(0x49e)]());}),_0x114ac6=document[_0x4c28bf(0x1262)]('search-results-summary'),_0x4aef2b=document[_0x4c28bf(0x1262)](_0x4c28bf(0xc97));_0x4aef2b['innerHTML']=_0x4c28bf(0x1e8d)+_0x123d22[_0x4c28bf(0x19ee)]+'</span>\x20条包含\x22<span\x20style=\x22color:\x20#007AFF;\x22>'+_0x45de69+_0x4c28bf(0x6c9),_0x114ac6['style'][_0x4c28bf(0x4da)]=_0x4c28bf(0x13de);const _0x4487ed=document[_0x4c28bf(0x1262)](_0x4c28bf(0x1a04)),_0x48a45e=document[_0x4c28bf(0x1262)]('search-results-list');_0x123d22[_0x4c28bf(0x19ee)]===0x0?_0x48a45e['innerHTML']=_0x4c28bf(0x1a8d):_0x48a45e[_0x4c28bf(0x33a)]=_0x123d22[_0x4c28bf(0x6a4)]((_0x4d0470,_0x429937)=>{const _0x284002=_0x4c28bf,_0x109c96=_0x4d0470[_0x284002(0x1ea3)];if(!_0x109c96)return'';let _0x21e05b='';_0x109c96[_0x284002(0x714)]||_0x109c96['sender']==='sent'?_0x21e05b='我':currentChatCharacter[_0x284002(0x1f68)]?_0x21e05b=_0x109c96[_0x284002(0x909)]||_0x109c96['characterName']||_0x109c96['name']||(_0x109c96[_0x284002(0x8a1)]!=='received'?_0x109c96['sender']:_0x284002(0x1d49)):_0x21e05b=currentChatCharacter[_0x284002(0x1a1c)]||'角色';let _0x1315bf='';if(typeof _0x109c96[_0x284002(0x211c)]===_0x284002(0x11b7))_0x1315bf=_0x109c96[_0x284002(0x211c)];else{if(Array['isArray'](_0x109c96[_0x284002(0x211c)]))_0x1315bf=_0x109c96[_0x284002(0x211c)]['filter'](_0x4e5d63=>_0x4e5d63&&_0x4e5d63[_0x284002(0x1a4b)]==='text')[_0x284002(0x6a4)](_0x5e56a3=>_0x5e56a3[_0x284002(0x1378)]||'')[_0x284002(0x122b)]('\x20');else _0x109c96['content']&&typeof _0x109c96['content']===_0x284002(0x28d)?_0x1315bf=_0x109c96['content'][_0x284002(0x1378)]||_0x109c96['content'][_0x284002(0x211c)]||'':_0x1315bf=_0x109c96[_0x284002(0x211c)]?String(_0x109c96[_0x284002(0x211c)]):_0x284002(0x187a);}(!_0x1315bf||_0x1315bf[_0x284002(0x19d7)]()==='')&&(_0x1315bf='消息内容为空');const _0x3c0e36=_0x1315bf[_0x284002(0xe16)](new RegExp(_0x45de69,'gi'),_0x284002(0x1f3b)),_0xb620c3=new Date(_0x4d0470[_0x284002(0x1716)])['toLocaleString'](_0x284002(0x156c),{'year':'numeric','month':_0x284002(0xc79),'day':'2-digit','hour':_0x284002(0xc79),'minute':_0x284002(0xc79)});return _0x284002(0x1bd4)+_0x438959[_0x284002(0x13c5)](_0x4d0470)+_0x284002(0x17dd)+_0x3c0e36+_0x284002(0x10d8)+_0x21e05b+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22search-result-time\x22>'+_0xb620c3+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})[_0x4c28bf(0x122b)](''),_0x4487ed[_0x4c28bf(0x14eb)][_0x4c28bf(0x4da)]='block';}async function showMessageContext(_0x4b38f3){const _0x5a6b8f=_0x211817;let _0xf751f3=[];try{const _0x1c558d=await db[_0x5a6b8f(0x19a2)][_0x5a6b8f(0xa24)](_0x5a6b8f(0xaf5))[_0x5a6b8f(0x1694)](currentChatCharacter['id'])[_0x5a6b8f(0xf13)]();_0xf751f3=_0x1c558d[_0x5a6b8f(0x1104)]((_0x2c1049,_0x38a901)=>_0x2c1049[_0x5a6b8f(0x1716)]-_0x38a901[_0x5a6b8f(0x1716)]);}catch(_0x150555){console[_0x5a6b8f(0x174a)](_0x5a6b8f(0x2e6),_0x150555),_0xf751f3=chatMessages[currentChatCharacter['id']]||[];}const _0x7bd117=_0xf751f3[_0x4b38f3];if(!_0x7bd117)return;const _0x808756=Math[_0x5a6b8f(0x658)](0x0,_0x4b38f3-0xa),_0x52227e=Math[_0x5a6b8f(0x21ff)](_0xf751f3['length']-0x1,_0x4b38f3+0xa),_0x42464c=_0xf751f3[_0x5a6b8f(0x6d5)](_0x808756,_0x52227e+0x1),_0x1d677b=document[_0x5a6b8f(0x1262)](_0x5a6b8f(0xfff));_0x1d677b['innerHTML']=_0x42464c[_0x5a6b8f(0x6a4)]((_0x1d29bd,_0x3806db)=>{const _0x531cb3=_0x5a6b8f,_0x3adbff=_0x808756+_0x3806db,_0x430ca4=_0x3adbff===_0x4b38f3,_0x43fbdf=_0x1d29bd[_0x531cb3(0x1ea3)];if(!_0x43fbdf)return'';let _0xadd7a8='',_0x2b39b6='';_0x43fbdf[_0x531cb3(0x714)]||_0x43fbdf[_0x531cb3(0x8a1)]===_0x531cb3(0x1e6d)?(_0xadd7a8='我',_0x2b39b6='user'):currentChatCharacter[_0x531cb3(0x1f68)]?(_0xadd7a8=_0x43fbdf[_0x531cb3(0x909)]||_0x43fbdf[_0x531cb3(0xdbc)]||_0x43fbdf[_0x531cb3(0x1a1c)]||(_0x43fbdf[_0x531cb3(0x8a1)]!=='received'?_0x43fbdf['sender']:_0x531cb3(0x1d49)),_0x2b39b6=_0x531cb3(0x1dbb)):(_0xadd7a8=currentChatCharacter[_0x531cb3(0x1a1c)]||'角色',_0x2b39b6='character');const _0x50015c=_0x430ca4?_0x531cb3(0xf94):'',_0x558663=new Date(_0x1d29bd[_0x531cb3(0x1716)])[_0x531cb3(0xecc)](_0x531cb3(0x156c),{'month':_0x531cb3(0xc79),'day':_0x531cb3(0xc79),'hour':_0x531cb3(0xc79),'minute':'2-digit'});let _0xa3e867='';if(typeof _0x43fbdf[_0x531cb3(0x211c)]==='string')_0xa3e867=_0x43fbdf[_0x531cb3(0x211c)];else{if(Array[_0x531cb3(0x1496)](_0x43fbdf[_0x531cb3(0x211c)]))_0xa3e867=_0x43fbdf[_0x531cb3(0x211c)]['filter'](_0x4d9a40=>_0x4d9a40&&_0x4d9a40[_0x531cb3(0x1a4b)]===_0x531cb3(0x1378))[_0x531cb3(0x6a4)](_0x5e97a2=>_0x5e97a2[_0x531cb3(0x1378)]||'')[_0x531cb3(0x122b)]('\x20');else _0x43fbdf[_0x531cb3(0x211c)]&&typeof _0x43fbdf[_0x531cb3(0x211c)]===_0x531cb3(0x28d)?_0xa3e867=_0x43fbdf[_0x531cb3(0x211c)][_0x531cb3(0x1378)]||_0x43fbdf[_0x531cb3(0x211c)]['content']||'':_0xa3e867=_0x43fbdf[_0x531cb3(0x211c)]?String(_0x43fbdf[_0x531cb3(0x211c)]):'消息内容为空';}return(!_0xa3e867||_0xa3e867[_0x531cb3(0x19d7)]()==='')&&(_0xa3e867=_0x531cb3(0x187a)),_0x531cb3(0x18a)+_0x2b39b6+_0x50015c+_0x531cb3(0x768)+_0xadd7a8+_0x531cb3(0x1d1e)+_0x558663+_0x531cb3(0x3d6)+_0xa3e867+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})['join'](''),showModal('message-context-modal');}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x43153a=_0x211817,_0x3dac72=document[_0x43153a(0x1262)]('search-keyword-input');_0x3dac72&&_0x3dac72[_0x43153a(0x21e9)](_0x43153a(0xf20),function(_0x6886a5){const _0x366522=_0x43153a;_0x6886a5[_0x366522(0x213c)]===_0x366522(0xdcf)&&performChatSearch();});});function showExportOptions(){const _0x55b370=_0x211817;if(!currentChatCharacter){showToast(_0x55b370(0x14e6),_0x55b370(0x1816));return;}document[_0x55b370(0x1262)](_0x55b370(0xa3e))[_0x55b370(0x14eb)][_0x55b370(0x4da)]=_0x55b370(0x1fb7);}function hideExportOptions(_0x22bc92){const _0x486d4e=_0x211817;if(_0x22bc92&&_0x22bc92[_0x486d4e(0x193d)]!==_0x22bc92[_0x486d4e(0x1fac)])return;document[_0x486d4e(0x1262)]('export-options-modal')[_0x486d4e(0x14eb)][_0x486d4e(0x4da)]='none';}function selectExportFormat(_0x52ea5e){const _0x947e93=_0x211817;document[_0x947e93(0x1262)](_0x947e93(0x994))['checked']=_0x52ea5e===_0x947e93(0x139b),document['getElementById'](_0x947e93(0xf1a))[_0x947e93(0x14c1)]=_0x52ea5e==='json',document[_0x947e93(0x1897)](_0x947e93(0x48b))[_0x947e93(0x19fb)](_0x13ae12=>{const _0x28c9a4=_0x947e93;_0x13ae12['classList'][_0x28c9a4(0x1493)]('selected');}),document['querySelector'](_0x947e93(0x171f)+_0x52ea5e+_0x947e93(0x18d4))['classList']['add']('selected');}async function executeExport(){const _0x55f2e7=_0x211817,_0x3c5049=document[_0x55f2e7(0xb30)]('input[name=\x22exportFormat\x22]:checked')[_0x55f2e7(0x1ebc)];hideExportOptions();if(_0x3c5049===_0x55f2e7(0x139b))exportChatHistoryAsHTML();else _0x3c5049==='json'&&await exportChatHistoryAsJSON();}function exportChatHistoryAsHTML(){const _0x4c8102=_0x211817;if(!currentChatCharacter){showToast(_0x4c8102(0x14e6),_0x4c8102(0x1816));return;}const _0x20b213=chatMessages[currentChatCharacter['id']]||[];if(_0x20b213['length']===0x0){showToast('没有聊天记录可导出','warning');return;}const _0x5bfab9=getCurrentChatSettings(),_0x39fb71=_0x5bfab9['aiChatNickname']||currentChatCharacter[_0x4c8102(0x1a1c)],_0x3ac3f7=_0x5bfab9[_0x4c8102(0x567)]||'我',_0x2dddb6=new Date(),_0x35d39b=_0x20b213[_0x4c8102(0x19ee)],_0x204386=new Date(_0x20b213[0x0][_0x4c8102(0x1716)]||Date[_0x4c8102(0x2eb)]()),_0x108e6f=new Date(_0x20b213[_0x20b213[_0x4c8102(0x19ee)]-0x1][_0x4c8102(0x1716)]||Date['now']());isNaN(_0x204386[_0x4c8102(0x704)]())&&(_0x204386=new Date());isNaN(_0x108e6f[_0x4c8102(0x704)]())&&(_0x108e6f=new Date());let _0x4f84f7=_0x4c8102(0xea1)+_0x39fb71+_0x4c8102(0x35a)+_0x39fb71+_0x4c8102(0xa73)+_0x2dddb6['toLocaleString'](_0x4c8102(0x156c))+'<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20共\x20'+_0x35d39b+'\x20条消息\x20|\x20'+_0x204386['toLocaleDateString']('zh-CN')+_0x4c8102(0x1811)+_0x108e6f[_0x4c8102(0xbf7)](_0x4c8102(0x156c))+_0x4c8102(0x46f);_0x20b213['forEach']((_0x5b51b0,_0x3d124b)=>{const _0x198c96=_0x4c8102,_0x434272=formatTime(_0x5b51b0[_0x198c96(0x1716)]),_0x5be12c=_0x5b51b0[_0x198c96(0x8a1)]===_0x198c96(0x1e6d),_0x36fd72=_0x5b51b0[_0x198c96(0x8a1)]===_0x198c96(0x1744);if(_0x36fd72)_0x4f84f7+=_0x198c96(0x150e)+escapeHtml(_0x5b51b0['content'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';else{const _0x80a047=_0x5be12c?_0x198c96(0xa80):'ai',_0x3cafd5=_0x5be12c?_0x3ac3f7:_0x39fb71;let _0x5cac43='';if(_0x5b51b0[_0x198c96(0x1dbe)]){const _0x2c9eb4=_0x5b51b0[_0x198c96(0x1dbe)][_0x198c96(0x909)]||(_0x5b51b0[_0x198c96(0x1dbe)][_0x198c96(0x8a1)]===_0x198c96(0x1e6d)?_0x3ac3f7:_0x39fb71),_0x450712=truncateText(_0x5b51b0[_0x198c96(0x1dbe)]['content']||_0x198c96(0x77a),0x14);_0x5cac43+=_0x198c96(0x1839)+escapeHtml(_0x2c9eb4)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>'+escapeHtml(_0x450712)+_0x198c96(0xa2b);}let _0x268511=_0x5b51b0[_0x198c96(0x211c)]||'',_0xd288b4='';if(_0x5b51b0['type']===_0x198c96(0x13ed))_0x268511=_0x198c96(0xe39)+_0x268511,_0xd288b4=_0x198c96(0x5b5);else{if(_0x5b51b0[_0x198c96(0x1a4b)]===_0x198c96(0x78a))_0x268511=_0x198c96(0xc72)+_0x5b51b0[_0x198c96(0x2018)]+'元'+(_0x5b51b0[_0x198c96(0x1814)]?'\x20('+_0x5b51b0[_0x198c96(0x1814)]+')':''),_0xd288b4=_0x198c96(0x5b5);else{if(_0x5b51b0['type']===_0x198c96(0x2184))_0x268511=_0x198c96(0xa9f)+(_0x5b51b0[_0x198c96(0x1b93)]||'位置信息'),_0xd288b4=_0x198c96(0x5b5);else{if(_0x5b51b0[_0x198c96(0x1a4b)]===_0x198c96(0x2051))_0x268511=_0x198c96(0x15c8)+(_0x5b51b0[_0x198c96(0x1e8e)]||'想和你重新做朋友'),_0xd288b4=_0x198c96(0x5b5);else{if(_0x5b51b0['type']===_0x198c96(0xd38))_0x268511=_0x198c96(0xd82)+_0x268511,_0xd288b4='\x20special-message';else{if(_0x5b51b0['isEmoji'])_0x268511=_0x198c96(0x386)+(_0x5b51b0[_0x198c96(0x29d)]||_0x268511),_0xd288b4=_0x198c96(0x5b5);else{if(Array[_0x198c96(0x1496)](_0x268511)){const _0xfc6dbd=_0x268511[_0x198c96(0xaf4)](_0x31d721=>_0x31d721[_0x198c96(0x1a4b)]==='text')?.[_0x198c96(0x1378)]||'',_0x46f572=_0x268511[_0x198c96(0xaf4)](_0x379826=>_0x379826[_0x198c96(0x1a4b)]===_0x198c96(0x910));if(_0xfc6dbd&&_0x46f572)_0x268511=_0x198c96(0x20cf)+_0xfc6dbd;else{if(_0x46f572)_0x268511=_0x198c96(0xcf1);else _0xfc6dbd?_0x268511=_0xfc6dbd:_0x268511=_0x198c96(0x201b);}_0x46f572&&(_0xd288b4=_0x198c96(0x5b5));}}}}}}}_0x5cac43+=_0x198c96(0x1560)+_0xd288b4[_0x198c96(0x19d7)]()+'\x22>'+escapeHtml(_0x268511)+_0x198c96(0x1844),_0x4f84f7+=_0x198c96(0x747)+_0x80a047+_0x198c96(0x1a8)+_0x5cac43+_0x198c96(0x1712)+_0x434272+_0x198c96(0x1844);}(_0x3d124b+0x1)%0x32===0x0&&_0x3d124b!==_0x20b213['length']-0x1&&(_0x4f84f7+=_0x198c96(0xfd6)+Math[_0x198c96(0x2180)]((_0x3d124b+0x1)/0x32)+'\x20页\x20---</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>');}),_0x4f84f7+=_0x4c8102(0x10f3)+_0x35d39b+_0x4c8102(0x182e)+_0x20b213[_0x4c8102(0x1e1f)](_0x2e9919=>_0x2e9919[_0x4c8102(0x8a1)]===_0x4c8102(0x1e6d))['length']+'\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x39fb71+_0x4c8102(0x1e3b)+_0x20b213[_0x4c8102(0x1e1f)](_0x3fea34=>_0x3fea34[_0x4c8102(0x8a1)]===_0x4c8102(0xb11))[_0x4c8102(0x19ee)]+_0x4c8102(0x7eb)+_0x20b213[_0x4c8102(0x1e1f)](_0x33a86b=>_0x33a86b['sender']==='system')[_0x4c8102(0x19ee)]+_0x4c8102(0x116e)+_0x2dddb6[_0x4c8102(0xecc)](_0x4c8102(0x156c))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a</body>\x0a</html>';const _0x563a79=new Blob([_0x4f84f7],{'type':'text/html;charset=utf-8'}),_0x18f8d8=URL[_0x4c8102(0x556)](_0x563a79),_0x12ebe3=document['createElement']('a'),_0x49192b='与'+_0x39fb71+_0x4c8102(0x1685)+_0x2dddb6['getFullYear']()+'-'+(_0x2dddb6[_0x4c8102(0x1da)]()+0x1)[_0x4c8102(0x1878)]()['padStart'](0x2,'0')+'-'+_0x2dddb6[_0x4c8102(0x520)]()[_0x4c8102(0x1878)]()['padStart'](0x2,'0')+_0x4c8102(0x1cc2);_0x12ebe3[_0x4c8102(0x1f9)]=_0x18f8d8,_0x12ebe3[_0x4c8102(0xdcb)]=_0x49192b,_0x12ebe3[_0x4c8102(0x14eb)][_0x4c8102(0x4da)]=_0x4c8102(0x102b),document['body'][_0x4c8102(0x497)](_0x12ebe3),_0x12ebe3[_0x4c8102(0x1859)](),document['body'][_0x4c8102(0x858)](_0x12ebe3),setTimeout(()=>{const _0x179d3e=_0x4c8102;URL[_0x179d3e(0x112a)](_0x18f8d8);},0x3e8),showToast('聊天记录已导出：'+_0x49192b,'success');}async function exportChatHistoryAsJSON(){const _0x3f0c6a=_0x211817;if(!currentChatCharacter){showToast(_0x3f0c6a(0x14e6),_0x3f0c6a(0x1816));return;}try{showToast(_0x3f0c6a(0x10b0),_0x3f0c6a(0x477));const _0x1f8505=currentChatCharacter['id'],_0x4cc591=currentChatCharacter[_0x3f0c6a(0x1a1c)],_0x28423e=new Date(),_0x479028={'exportInfo':{'characterId':_0x1f8505,'characterName':_0x4cc591,'exportTime':_0x28423e[_0x3f0c6a(0x1034)](),'version':'1.0','description':_0x4cc591+_0x3f0c6a(0xbf0)},'chatMessages':await db[_0x3f0c6a(0x19a2)][_0x3f0c6a(0xa24)](_0x3f0c6a(0xaf5))[_0x3f0c6a(0x1694)](_0x1f8505)[_0x3f0c6a(0xf13)](),'smsMessages':await db[_0x3f0c6a(0x1b6a)][_0x3f0c6a(0xa24)](_0x3f0c6a(0xaf5))[_0x3f0c6a(0x1694)](_0x1f8505)[_0x3f0c6a(0xf13)](),'chatSettings':await db[_0x3f0c6a(0x1789)][_0x3f0c6a(0xa24)](_0x3f0c6a(0x20e1))[_0x3f0c6a(0x1694)](_0x1f8505)[_0x3f0c6a(0xf13)](),'coreMemories':await db[_0x3f0c6a(0x127e)][_0x3f0c6a(0xa24)](_0x3f0c6a(0xaf5))['equals'](_0x1f8505)['toArray'](),'episodicMemories':await db['episodicMemories']['where'](_0x3f0c6a(0xaf5))[_0x3f0c6a(0x1694)](_0x1f8505)[_0x3f0c6a(0xf13)](),'memorySummaries':await db[_0x3f0c6a(0x203a)][_0x3f0c6a(0xa24)]('characterId')[_0x3f0c6a(0x1694)](_0x1f8505)['toArray'](),'crossAppTimeline':await db['crossAppTimeline'][_0x3f0c6a(0xa24)](_0x3f0c6a(0xaf5))['equals'](_0x1f8505)[_0x3f0c6a(0xf13)]()},_0xa19fd1={'chatMessages':_0x479028[_0x3f0c6a(0x19a2)]['length'],'smsMessages':_0x479028[_0x3f0c6a(0x1b6a)][_0x3f0c6a(0x19ee)],'coreMemories':_0x479028['coreMemories'][_0x3f0c6a(0x19ee)],'episodicMemories':_0x479028[_0x3f0c6a(0x156f)][_0x3f0c6a(0x19ee)],'memorySummaries':_0x479028[_0x3f0c6a(0x203a)]['length'],'crossAppTimeline':_0x479028[_0x3f0c6a(0x8ac)][_0x3f0c6a(0x19ee)]};console['log'](_0x3f0c6a(0x1707),_0xa19fd1);const _0x4cebf7=JSON[_0x3f0c6a(0x6b8)](_0x479028,null,0x2),_0x49fff4=new Blob([_0x4cebf7],{'type':'application/json;charset=utf-8'}),_0x29fcbf=URL[_0x3f0c6a(0x556)](_0x49fff4),_0x45ec97=document[_0x3f0c6a(0xac6)]('a'),_0x37f077=_0x4cc591+'_完整数据备份_'+_0x28423e[_0x3f0c6a(0x16a0)]()+'-'+(_0x28423e[_0x3f0c6a(0x1da)]()+0x1)['toString']()['padStart'](0x2,'0')+'-'+_0x28423e[_0x3f0c6a(0x520)]()[_0x3f0c6a(0x1878)]()[_0x3f0c6a(0xdfe)](0x2,'0')+'.json';_0x45ec97[_0x3f0c6a(0x1f9)]=_0x29fcbf,_0x45ec97[_0x3f0c6a(0xdcb)]=_0x37f077,_0x45ec97[_0x3f0c6a(0x14eb)]['display']=_0x3f0c6a(0x102b),document[_0x3f0c6a(0x1da9)]['appendChild'](_0x45ec97),_0x45ec97[_0x3f0c6a(0x1859)](),document[_0x3f0c6a(0x1da9)]['removeChild'](_0x45ec97),setTimeout(()=>{const _0xde6648=_0x3f0c6a;URL[_0xde6648(0x112a)](_0x29fcbf);},0x3e8);const _0x2fb680=Object[_0x3f0c6a(0x2bc)](_0xa19fd1)[_0x3f0c6a(0x1e1f)](([_0xa8c50d,_0x13c7c4])=>_0x13c7c4>0x0)[_0x3f0c6a(0x6a4)](([_0xc93a58,_0x371a5b])=>{const _0x38d512=_0x3f0c6a,_0x1f1415={'chatMessages':_0x38d512(0x1836),'smsMessages':_0x38d512(0x7f0),'coreMemories':_0x38d512(0x498),'episodicMemories':_0x38d512(0x1cdb),'memorySummaries':_0x38d512(0x1c30),'crossAppTimeline':_0x38d512(0x472)};return _0x1f1415[_0xc93a58]+':\x20'+_0x371a5b+'条';})['join'](',\x20');showToast('完整数据已导出：'+_0x37f077+'（'+_0x2fb680+'）',_0x3f0c6a(0x11cb));}catch(_0x4e2992){console[_0x3f0c6a(0x174a)](_0x3f0c6a(0x140d),_0x4e2992),showToast(_0x3f0c6a(0x12a0)+_0x4e2992[_0x3f0c6a(0x1e8e)],'error');}}function escapeHtml(_0xd45d31){const _0x553be8=_0x211817,_0x2d2c33=document[_0x553be8(0xac6)](_0x553be8(0xbbc));return _0x2d2c33['textContent']=_0xd45d31,_0x2d2c33[_0x553be8(0x33a)];}function truncateText(_0xcd3471,_0x4f19a9){const _0x5a8781=_0x211817;if(_0xcd3471[_0x5a8781(0x19ee)]<=_0x4f19a9)return _0xcd3471;return _0xcd3471[_0x5a8781(0x17ca)](0x0,_0x4f19a9)+_0x5a8781(0x1520);}function showImportOptions(){const _0xd26870=_0x211817;if(!currentChatCharacter){showToast('请先选择一个聊天',_0xd26870(0x1816));return;}document['getElementById'](_0xd26870(0x1826))[_0xd26870(0x14eb)][_0xd26870(0x4da)]=_0xd26870(0x1fb7),document[_0xd26870(0x1262)](_0xd26870(0x1b5))[_0xd26870(0x1ebc)]='',document[_0xd26870(0x1262)](_0xd26870(0x299))[_0xd26870(0x14eb)][_0xd26870(0x4da)]=_0xd26870(0x102b),document[_0xd26870(0x1262)](_0xd26870(0x8ef))[_0xd26870(0x559)]=!![];}function hideImportOptions(_0xc981fa){const _0x38b794=_0x211817;if(_0xc981fa&&_0xc981fa[_0x38b794(0x193d)]!==_0xc981fa['currentTarget'])return;document[_0x38b794(0x1262)]('import-options-modal')['style']['display']='none';}function handleImportFileSelect(_0x13ec65){const _0x5c96cf=_0x211817,_0x25a272=_0x13ec65[_0x5c96cf(0x193d)][_0x5c96cf(0xf26)][0x0];if(!_0x25a272)return;if(!_0x25a272[_0x5c96cf(0x1a1c)][_0x5c96cf(0x81f)](_0x5c96cf(0x1817))){showToast(_0x5c96cf(0x8f5),_0x5c96cf(0x174a));return;}const _0x4db75c=new FileReader();_0x4db75c['onload']=function(_0x5c08b6){const _0x5430c5=_0x5c96cf;try{const _0x1ed923=JSON[_0x5430c5(0x22d3)](_0x5c08b6[_0x5430c5(0x193d)]['result']);if(!_0x1ed923[_0x5430c5(0x60f)]||!_0x1ed923[_0x5430c5(0x60f)][_0x5430c5(0xdbc)]){showToast(_0x5430c5(0x1a85),_0x5430c5(0x174a));return;}document[_0x5430c5(0x1262)]('import-file-name')[_0x5430c5(0x13be)]=_0x25a272[_0x5430c5(0x1a1c)];const _0xbbea5=[];if(_0x1ed923[_0x5430c5(0x19a2)]?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)](_0x5430c5(0x6a5)+_0x1ed923[_0x5430c5(0x19a2)]['length']+'条');if(_0x1ed923['smsMessages']?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)]('短信消息:\x20'+_0x1ed923[_0x5430c5(0x1b6a)]['length']+'条');if(_0x1ed923[_0x5430c5(0x127e)]?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)](_0x5430c5(0x5be)+_0x1ed923[_0x5430c5(0x127e)][_0x5430c5(0x19ee)]+'条');if(_0x1ed923[_0x5430c5(0x156f)]?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)]('情景记忆:\x20'+_0x1ed923[_0x5430c5(0x156f)][_0x5430c5(0x19ee)]+'条');if(_0x1ed923[_0x5430c5(0x203a)]?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)]('剧情总结:\x20'+_0x1ed923['memorySummaries'][_0x5430c5(0x19ee)]+'条');if(_0x1ed923['crossAppTimeline']?.[_0x5430c5(0x19ee)])_0xbbea5[_0x5430c5(0x1cd6)](_0x5430c5(0x440)+_0x1ed923[_0x5430c5(0x8ac)]['length']+'条');document['getElementById']('import-file-preview')['innerHTML']=_0x5430c5(0x21d5)+_0x1ed923[_0x5430c5(0x60f)][_0x5430c5(0xdbc)]+_0x5430c5(0x7d5)+new Date(_0x1ed923[_0x5430c5(0x60f)][_0x5430c5(0x22b4)])[_0x5430c5(0xecc)](_0x5430c5(0x156c))+_0x5430c5(0x4df)+_0xbbea5[_0x5430c5(0x122b)](',\x20')+_0x5430c5(0x1578),document[_0x5430c5(0x1262)](_0x5430c5(0x299))['style'][_0x5430c5(0x4da)]=_0x5430c5(0x13de),document[_0x5430c5(0x1262)]('import-execute-btn')[_0x5430c5(0x559)]=![],window[_0x5430c5(0x1dca)]=_0x1ed923;}catch(_0xbd187e){showToast('文件格式错误，无法解析JSON',_0x5430c5(0x174a)),console['error'](_0x5430c5(0x1343),_0xbd187e);}},_0x4db75c[_0x5c96cf(0x1be5)](_0x25a272);}async function executeImport(){const _0x542ba8=_0x211817;if(!window['pendingImportData']){showToast(_0x542ba8(0x165f),_0x542ba8(0x174a));return;}if(!currentChatCharacter){showToast('请先选择一个聊天',_0x542ba8(0x1816));return;}try{showToast('正在导入数据，请稍候...',_0x542ba8(0x477)),hideImportOptions();const _0x187834=window[_0x542ba8(0x1dca)],_0x5eb5ae=currentChatCharacter['id'];await db['transaction']('rw',[db[_0x542ba8(0x19a2)],db['smsMessages'],db[_0x542ba8(0x1789)],db[_0x542ba8(0x127e)],db[_0x542ba8(0x156f)],db[_0x542ba8(0x203a)],db['crossAppTimeline']],async()=>{const _0xc27a9c=_0x542ba8;await db[_0xc27a9c(0x19a2)]['where'](_0xc27a9c(0xaf5))['equals'](_0x5eb5ae)[_0xc27a9c(0x1f4a)](),await db[_0xc27a9c(0x1b6a)]['where']('characterId')[_0xc27a9c(0x1694)](_0x5eb5ae)['delete'](),await db[_0xc27a9c(0x1789)]['where'](_0xc27a9c(0x20e1))[_0xc27a9c(0x1694)](_0x5eb5ae)[_0xc27a9c(0x1f4a)](),await db[_0xc27a9c(0x127e)][_0xc27a9c(0xa24)](_0xc27a9c(0xaf5))[_0xc27a9c(0x1694)](_0x5eb5ae)['delete'](),await db[_0xc27a9c(0x156f)]['where']('characterId')[_0xc27a9c(0x1694)](_0x5eb5ae)[_0xc27a9c(0x1f4a)](),await db['memorySummaries'][_0xc27a9c(0xa24)]('characterId')[_0xc27a9c(0x1694)](_0x5eb5ae)[_0xc27a9c(0x1f4a)](),await db[_0xc27a9c(0x8ac)]['where'](_0xc27a9c(0xaf5))[_0xc27a9c(0x1694)](_0x5eb5ae)[_0xc27a9c(0x1f4a)](),_0x187834['chatMessages']?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x19a2)]['bulkAdd'](_0x187834[_0xc27a9c(0x19a2)]),_0x187834[_0xc27a9c(0x1b6a)]?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x1b6a)][_0xc27a9c(0x2a3)](_0x187834[_0xc27a9c(0x1b6a)]),_0x187834[_0xc27a9c(0x1789)]?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x1789)][_0xc27a9c(0x2a3)](_0x187834['chatSettings']),_0x187834[_0xc27a9c(0x127e)]?.[_0xc27a9c(0x19ee)]&&await db['coreMemories'][_0xc27a9c(0x2a3)](_0x187834['coreMemories']),_0x187834[_0xc27a9c(0x156f)]?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x156f)][_0xc27a9c(0x2a3)](_0x187834[_0xc27a9c(0x156f)]),_0x187834['memorySummaries']?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x203a)][_0xc27a9c(0x2a3)](_0x187834[_0xc27a9c(0x203a)]),_0x187834[_0xc27a9c(0x8ac)]?.[_0xc27a9c(0x19ee)]&&await db[_0xc27a9c(0x8ac)][_0xc27a9c(0x2a3)](_0x187834[_0xc27a9c(0x8ac)]);}),await loadChatMessages(),await loadSMSMessages(),await loadChatSettings(),renderMessageList();const _0x20033c=document[_0x542ba8(0x1262)](_0x542ba8(0xd3c));_0x20033c&&_0x20033c[_0x542ba8(0x14eb)][_0x542ba8(0x4da)]!==_0x542ba8(0x102b)&&loadSMSHistory();const _0x150feb=[];if(_0x187834[_0x542ba8(0x19a2)]?.[_0x542ba8(0x19ee)])_0x150feb[_0x542ba8(0x1cd6)](_0x542ba8(0x6a5)+_0x187834['chatMessages'][_0x542ba8(0x19ee)]+'条');if(_0x187834[_0x542ba8(0x1b6a)]?.[_0x542ba8(0x19ee)])_0x150feb['push']('短信消息:\x20'+_0x187834[_0x542ba8(0x1b6a)]['length']+'条');if(_0x187834['coreMemories']?.[_0x542ba8(0x19ee)])_0x150feb['push'](_0x542ba8(0x5be)+_0x187834[_0x542ba8(0x127e)][_0x542ba8(0x19ee)]+'条');if(_0x187834['episodicMemories']?.[_0x542ba8(0x19ee)])_0x150feb[_0x542ba8(0x1cd6)](_0x542ba8(0xb68)+_0x187834[_0x542ba8(0x156f)][_0x542ba8(0x19ee)]+'条');if(_0x187834[_0x542ba8(0x203a)]?.['length'])_0x150feb[_0x542ba8(0x1cd6)](_0x542ba8(0x1231)+_0x187834[_0x542ba8(0x203a)][_0x542ba8(0x19ee)]+'条');if(_0x187834[_0x542ba8(0x8ac)]?.[_0x542ba8(0x19ee)])_0x150feb['push'](_0x542ba8(0x440)+_0x187834[_0x542ba8(0x8ac)][_0x542ba8(0x19ee)]+'条');showToast(_0x542ba8(0xcfc)+_0x150feb[_0x542ba8(0x122b)](',\x20')+_0x542ba8(0x159f),'success'),delete window[_0x542ba8(0x1dca)];}catch(_0x113906){console[_0x542ba8(0x174a)](_0x542ba8(0x21b7),_0x113906),showToast(_0x542ba8(0x1ad2)+_0x113906['message'],_0x542ba8(0x174a));}}function escapeHtml(_0x275087){const _0x458315=_0x211817,_0x411603=document['createElement'](_0x458315(0xbbc));return _0x411603[_0x458315(0x13be)]=_0x275087,_0x411603['innerHTML'];}function findMessageById(_0x3ce42e){const _0x5a5cef=_0x211817;if(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])return null;const _0x4db281=chatMessages[currentChatCharacter['id']],_0x3d2727=_0x4db281[_0x5a5cef(0xaf4)](_0x3d9730=>_0x3d9730['id']===_0x3ce42e);return _0x3d2727;}function getCurrentPersonaName(){const _0x3aa099=_0x211817,_0x1c9b10=getCurrentChatSettings();if(_0x1c9b10[_0x3aa099(0x145e)]){const _0x3a65b4=personas[_0x3aa099(0xaf4)](_0x3c3ce1=>_0x3c3ce1['id']===_0x1c9b10[_0x3aa099(0x145e)]);if(_0x3a65b4)return _0x1c9b10['myChatNickname']||_0x3a65b4['name'];}return'用户';}function getCurrentPersonaDescription(){const _0x2090da=_0x211817,_0xb60f0b=getCurrentChatSettings();if(_0xb60f0b[_0x2090da(0x145e)]){const _0x4d8f8b=personas[_0x2090da(0xaf4)](_0x531f1e=>_0x531f1e['id']===_0xb60f0b[_0x2090da(0x145e)]);if(_0x4d8f8b&&_0x4d8f8b['description'])return _0x4d8f8b['description'];}return _0x2090da(0x11fa);}function changeTheirBubbleColor(){const _0x5eeec2=_0x211817;colorPickerContext='theirBubble',document[_0x5eeec2(0x1262)](_0x5eeec2(0x20ca))[_0x5eeec2(0x13be)]=_0x5eeec2(0x1ad8),showModal(_0x5eeec2(0xdd4));}function changeMyBubbleColor(){const _0x16ef1f=_0x211817;colorPickerContext=_0x16ef1f(0x181f),document['getElementById'](_0x16ef1f(0x20ca))[_0x16ef1f(0x13be)]=_0x16ef1f(0x227a),showModal(_0x16ef1f(0xdd4));}function showBubbleColorSettings(){const _0x2879ce=_0x211817;alert(_0x2879ce(0x1da5));}function showClearHistoryOptionsModal(){const _0x4399df=_0x211817;if(!currentChatCharacter)return;const _0x1d1cac=_0x4399df(0x19cd)+currentChatCharacter[_0x4399df(0x1a1c)]+_0x4399df(0xd2b);document[_0x4399df(0x1da9)][_0x4399df(0x1b7)](_0x4399df(0x42e),_0x1d1cac);}async function executeClearHistory(){const _0x8e035c=_0x211817,_0x17e867=currentChatCharacter['id'];console[_0x8e035c(0x2187)](_0x8e035c(0x171d)+_0x17e867+_0x8e035c(0xbdc)),showToast(_0x8e035c(0x1fea),_0x8e035c(0x477));const _0x1ae65b=document[_0x8e035c(0x1262)](_0x8e035c(0x601))?.[_0x8e035c(0x14c1)]||![],_0x6537b3=document[_0x8e035c(0x1262)](_0x8e035c(0xb38))?.[_0x8e035c(0x14c1)]||![],_0x279393=document['getElementById']('clear-timeline')?.[_0x8e035c(0x14c1)]||![],_0x10177a=document[_0x8e035c(0x1262)]('clear-history-options-modal');if(_0x10177a)_0x10177a['remove']();try{chatMessages[_0x17e867]=[];try{await saveChatMessagesImmediate([_0x17e867]),console[_0x8e035c(0x2187)](_0x8e035c(0x437));}catch(_0x59af55){console[_0x8e035c(0x174a)](_0x8e035c(0xbc5),_0x59af55),await saveChatMessages();}console[_0x8e035c(0x2187)](_0x8e035c(0x631));const _0x19327c=_0x17e867;if(_0x1ae65b){const _0x3a155e=await db[_0x8e035c(0x127e)][_0x8e035c(0xa24)](_0x8e035c(0xaf5))[_0x8e035c(0x1694)](_0x17e867)[_0x8e035c(0x82f)](_0xfbe4ca=>{const _0x4e8de1=_0x8e035c;return!_0xfbe4ca['contextId']||_0xfbe4ca[_0x4e8de1(0xae4)]===_0x19327c;})[_0x8e035c(0x1586)]();_0x3a155e[_0x8e035c(0x19ee)]>0x0?(await db[_0x8e035c(0x127e)][_0x8e035c(0x1aaa)](_0x3a155e),console[_0x8e035c(0x2187)](_0x8e035c(0x31f)+_0x3a155e[_0x8e035c(0x19ee)]+_0x8e035c(0x15de))):console[_0x8e035c(0x2187)](_0x8e035c(0x5c6)+_0x17e867+'\x20在当前上下文中没有核心记忆需要清除');}if(_0x6537b3){const _0x39571a=await db[_0x8e035c(0x156f)]['where'](_0x8e035c(0xaf5))[_0x8e035c(0x1694)](_0x17e867)[_0x8e035c(0x82f)](_0x2f5912=>{const _0x5d7ae1=_0x8e035c;return!_0x2f5912[_0x5d7ae1(0xae4)]||_0x2f5912[_0x5d7ae1(0xae4)]===_0x19327c;})[_0x8e035c(0x1586)]();_0x39571a[_0x8e035c(0x19ee)]>0x0?(await db[_0x8e035c(0x156f)]['bulkDelete'](_0x39571a),console[_0x8e035c(0x2187)](_0x8e035c(0x31f)+_0x39571a[_0x8e035c(0x19ee)]+_0x8e035c(0xbc2))):console[_0x8e035c(0x2187)]('ℹ️\x20角色\x20'+_0x17e867+_0x8e035c(0xaf2));}if(_0x279393){const _0x3e7653=await db[_0x8e035c(0x8ac)][_0x8e035c(0xa24)]('characterId')[_0x8e035c(0x1694)](_0x17e867)[_0x8e035c(0x1586)]();_0x3e7653['length']>0x0?(await db[_0x8e035c(0x8ac)][_0x8e035c(0x1aaa)](_0x3e7653),console[_0x8e035c(0x2187)](_0x8e035c(0x31f)+_0x3e7653['length']+_0x8e035c(0x155a))):console[_0x8e035c(0x2187)](_0x8e035c(0x5c6)+_0x17e867+'\x20没有时间线记录需要清除');const _0x753fa2=await db[_0x8e035c(0x203a)]['where'](_0x8e035c(0xaf5))[_0x8e035c(0x1694)](_0x17e867)[_0x8e035c(0x1586)]();_0x753fa2['length']>0x0?(await db[_0x8e035c(0x203a)][_0x8e035c(0x1aaa)](_0x753fa2),console[_0x8e035c(0x2187)](_0x8e035c(0x31f)+_0x753fa2[_0x8e035c(0x19ee)]+_0x8e035c(0x279))):console['log']('ℹ️\x20角色\x20'+_0x17e867+'\x20没有记忆摘要需要清除');}renderChatMessages(_0x17e867),renderMessageList(),showToast(_0x8e035c(0xbd0),_0x8e035c(0x11cb)),console[_0x8e035c(0x2187)]('🧹\x20角色\x20'+_0x17e867+_0x8e035c(0x13ca)),hideChatSettings();}catch(_0x225db3){console[_0x8e035c(0x174a)](_0x8e035c(0xbe7),_0x225db3),showToast(_0x8e035c(0x14cd),_0x8e035c(0x174a));}}function clearChatHistory(){showClearHistoryOptionsModal();}function selectColor(_0x37ea3c){const _0x335f6f=_0x211817;document['querySelectorAll'](_0x335f6f(0x2205))[_0x335f6f(0x19fb)](_0x5a0700=>{const _0x565392=_0x335f6f;_0x5a0700['classList'][_0x565392(0x1493)](_0x565392(0x176b));}),event[_0x335f6f(0x193d)][_0x335f6f(0x1c1b)][_0x335f6f(0x21e2)](_0x335f6f(0x176b)),document['getElementById'](_0x335f6f(0x1a3b))[_0x335f6f(0x1ebc)]=_0x37ea3c;}async function applyChatBackground(_0x3b73f0,_0x50c93c=![]){const _0x5a4f03=_0x211817;if(!currentChatCharacter)return;console[_0x5a4f03(0x2187)]('⚡\x20applyChatBackground\x20被调用:\x20'+currentChatCharacter[_0x5a4f03(0x1a1c)]+_0x5a4f03(0x1d3e)+currentChatCharacter['id']+'),\x20skipSave:\x20'+_0x50c93c);!currentChatCharacter[_0x5a4f03(0x619)]&&(currentChatCharacter['background']=null);const _0x4dd47e=_0x3b73f0!==undefined?_0x3b73f0:currentChatCharacter[_0x5a4f03(0x619)],_0x21f826=currentChatCharacter['background']!==_0x4dd47e;currentChatCharacter['background']=_0x4dd47e;if(_0x21f826&&!_0x50c93c)console[_0x5a4f03(0x2187)]('💾\x20[背景保存]\x20'+currentChatCharacter[_0x5a4f03(0x1a1c)]+_0x5a4f03(0x1f72)),await saveCharacters();else _0x50c93c?console[_0x5a4f03(0x2187)](_0x5a4f03(0x12fb)+currentChatCharacter['name']+':\x20跳过保存（skipSave=true）'):console[_0x5a4f03(0x2187)](_0x5a4f03(0x12fb)+currentChatCharacter[_0x5a4f03(0x1a1c)]+':\x20背景未变化，跳过保存');const _0x3054e7=document[_0x5a4f03(0x1262)](_0x5a4f03(0xcf2));if(!_0x3054e7)return;if(_0x4dd47e){console[_0x5a4f03(0x2187)]('🖼️\x20应用聊天背景:\x20'+currentChatCharacter[_0x5a4f03(0x1a1c)]+_0x5a4f03(0x1d3e)+currentChatCharacter['id']+')'),_0x3054e7[_0x5a4f03(0x14eb)]['backgroundImage']=_0x5a4f03(0x9f1)+_0x4dd47e+')',_0x3054e7[_0x5a4f03(0x14eb)][_0x5a4f03(0x15d0)]=_0x5a4f03(0x12bb),_0x3054e7[_0x5a4f03(0x14eb)][_0x5a4f03(0x1530)]=_0x5a4f03(0xcef),_0x3054e7[_0x5a4f03(0x14eb)][_0x5a4f03(0x577)]='transparent';const _0x4c18d7=document[_0x5a4f03(0x1262)](_0x5a4f03(0x19a8));if(_0x4c18d7)_0x4c18d7['style']['background']=_0x5a4f03(0x8e5);}else{console['log']('🖼️\x20重置聊天背景:\x20'+currentChatCharacter['name']+'\x20(ID:\x20'+currentChatCharacter['id']+')'),_0x3054e7[_0x5a4f03(0x14eb)][_0x5a4f03(0x159c)]='none',_0x3054e7[_0x5a4f03(0x14eb)][_0x5a4f03(0x577)]='white';const _0x558026=document[_0x5a4f03(0x1262)]('api-chat-messages');if(_0x558026)_0x558026[_0x5a4f03(0x14eb)][_0x5a4f03(0x619)]='';}console[_0x5a4f03(0x2187)]('✅\x20背景样式已应用:\x20'+currentChatCharacter[_0x5a4f03(0x1a1c)]+_0x5a4f03(0x1d3e)+currentChatCharacter['id']+')');}function saveBubbleStyleSettings(){const _0x1d2228=_0x211817,_0x347e19=getCurrentChatSettings();_0x347e19[_0x1d2228(0x1813)]=window[_0x1d2228(0x1c6e)]||_0x1d2228(0x1094),_0x347e19['myBubbleColor']=document['getElementById'](_0x1d2228(0x958))[_0x1d2228(0x1ebc)],_0x347e19[_0x1d2228(0xeaf)]=document[_0x1d2228(0x1262)](_0x1d2228(0xe7f))[_0x1d2228(0x1ebc)],_0x347e19[_0x1d2228(0x1d83)]=document[_0x1d2228(0x1262)](_0x1d2228(0x235))[_0x1d2228(0x1ebc)];const _0x4cc64f={'default':_0x1d2228(0x976),'shadow':'经典阴影','tail':_0x1d2228(0x575),'paper':_0x1d2228(0x56a)};document[_0x1d2228(0x1262)](_0x1d2228(0x99f))['textContent']=_0x4cc64f[_0x347e19[_0x1d2228(0x1813)]]||_0x1d2228(0x976),saveCurrentChatSettings(_0x347e19),applyBubbleStyle(),hideModal(_0x1d2228(0x1735)),showToast(_0x1d2228(0x5a5),'success');}function applyBubbleStyle(){const _0x4b52cd=_0x211817,_0x4a5fac=document[_0x4b52cd(0x1262)](_0x4b52cd(0x19a8));if(!_0x4a5fac)return;let _0x39e01c={};currentChatCharacter?_0x39e01c=getCurrentChatSettings():_0x39e01c={'bubbleStyle':'default','myBubbleColor':_0x4b52cd(0xa44),'aiBubbleColor':_0x4b52cd(0x7ae),'bubbleOpacity':'1'};_0x4a5fac['className']=_0x4a5fac[_0x4b52cd(0x1722)][_0x4b52cd(0x204b)]('\x20')['filter'](_0x2d3834=>!_0x2d3834[_0x4b52cd(0x1b30)](_0x4b52cd(0x1c7)))['join']('\x20');const _0xa4d9f9=_0x39e01c[_0x4b52cd(0x1813)]||_0x4b52cd(0x1094);_0x4a5fac[_0x4b52cd(0x1c1b)]['add'](_0x4b52cd(0x1c7)+_0xa4d9f9);const _0x3d4fc6=_0x39e01c[_0x4b52cd(0xbfa)]||_0x4b52cd(0xa44),_0x33469f=_0x39e01c[_0x4b52cd(0xeaf)]||_0x4b52cd(0x7ae),_0x1feedd=_0x39e01c[_0x4b52cd(0x1d83)]||'1';_0x4a5fac['style'][_0x4b52cd(0xcf0)](_0x4b52cd(0x13d9),_0x3d4fc6),_0x4a5fac[_0x4b52cd(0x14eb)][_0x4b52cd(0xcf0)](_0x4b52cd(0x1c7a),_0x33469f),_0x4a5fac[_0x4b52cd(0x14eb)][_0x4b52cd(0xcf0)]('--bubble-opacity',_0x1feedd);const _0x52b5c7=_0x39e01c['customBubbleCSS']||'';applyCustomBubbleCSS(),console[_0x4b52cd(0x2187)](_0x4b52cd(0xdbd)+_0xa4d9f9+_0x4b52cd(0xfb7)+(currentChatCharacter?.[_0x4b52cd(0x1a1c)]||'无')+')');}function showBubbleColorPicker(_0x846bd4){const _0x42e131=_0x211817;colorPickerContext=_0x846bd4,document[_0x42e131(0x1262)](_0x42e131(0x20ca))['textContent']=_0x42e131(0x1db),showModal(_0x42e131(0xdd4));}function selectColor(_0x498cf0){const _0x5f733f=_0x211817;document[_0x5f733f(0x1897)](_0x5f733f(0x2205))[_0x5f733f(0x19fb)](_0x1a35b4=>{const _0x4742cb=_0x5f733f;_0x1a35b4[_0x4742cb(0x1c1b)][_0x4742cb(0x1493)](_0x4742cb(0x176b));}),event[_0x5f733f(0x193d)][_0x5f733f(0x1c1b)]['add']('selected'),document['getElementById'](_0x5f733f(0x1a3b))[_0x5f733f(0x1ebc)]=_0x498cf0;}async function applyColorSelection(){const _0x2793e5=_0x211817,_0x4d3087=document[_0x2793e5(0xb30)](_0x2793e5(0x1b5a))?.[_0x2793e5(0x14eb)]['backgroundColor']||'#007AFF',_0x55f135=document[_0x2793e5(0x1262)](_0x2793e5(0x493))[_0x2793e5(0x1ebc)];if(colorPickerContext===_0x2793e5(0x509))chatSettings[_0x2793e5(0x1ad1)]=_0x4d3087,chatSettings[_0x2793e5(0x1d83)]=_0x55f135;else colorPickerContext===_0x2793e5(0x181f)&&(chatSettings[_0x2793e5(0xbfa)]=_0x4d3087,chatSettings['bubbleOpacity']=_0x55f135);await saveChatSettings(),renderChatMessages(currentChatCharacter['id']),hideModal(_0x2793e5(0xdd4));}function showWallpaperPicker(){const _0x229024=_0x211817;showModal(_0x229024(0x73b));}function selectWallpaper(_0x5976e9){const _0x2495ba=_0x211817;console[_0x2495ba(0x2187)]('选择壁纸:',_0x5976e9),selectedWallpaper=_0x5976e9,console[_0x2495ba(0x2187)](_0x2495ba(0x181a),selectedWallpaper);}async function applyWallpaperSelection(){const _0x3f7b62=_0x211817;console[_0x3f7b62(0x2187)]('应用壁纸被调用，selectedWallpaper:',selectedWallpaper);if(!selectedWallpaper){alert(_0x3f7b62(0x2259));return;}if(selectedWallpaper[_0x3f7b62(0x1b30)](_0x3f7b62(0x13c6))){console['log'](_0x3f7b62(0x1557)),document[_0x3f7b62(0xb30)](_0x3f7b62(0xf87))['style'][_0x3f7b62(0x159c)]=_0x3f7b62(0x9f1)+selectedWallpaper+')',document[_0x3f7b62(0xb30)](_0x3f7b62(0xf87))[_0x3f7b62(0x14eb)]['backgroundSize']=_0x3f7b62(0xe57),document[_0x3f7b62(0xb30)]('.wallpaper')['style'][_0x3f7b62(0x1530)]=_0x3f7b62(0xcef);try{await db[_0x3f7b62(0x13c7)][_0x3f7b62(0xa4f)](),await db[_0x3f7b62(0x13c7)]['add']({'id':_0x3f7b62(0x11d7),'type':'image','data':selectedWallpaper}),console[_0x3f7b62(0x2187)]('壁纸保存成功到IndexedDB'),hideModal('wallpaper-picker-modal');}catch(_0x5d3ef5){console[_0x3f7b62(0x174a)](_0x3f7b62(0x1b2a),_0x5d3ef5),alert(_0x3f7b62(0xc16));}}else alert('请先从相册选择一张图片作为壁纸');}function uploadCustomWallpaper(){const _0x16de73=_0x211817;document[_0x16de73(0x1262)](_0x16de73(0x1b8d))[_0x16de73(0x1859)]();}let selectedAppForIcon=null,uploadedIconImage=null;function showIconPicker(){const _0x498960=_0x211817;generateAppList(),showModal(_0x498960(0x1156));}function generateAppList(){const _0x222520=_0x211817,_0x4c7967=document[_0x222520(0x1262)](_0x222520(0x1eaa));_0x4c7967[_0x222520(0x33a)]='';const _0x3ac6bf=[{'id':_0x222520(0x1c2a),'name':_0x222520(0xf4c),'selector':_0x222520(0x22ed)},{'id':_0x222520(0x576),'name':'世界书','selector':_0x222520(0x17f8)},{'id':'anniversary-screen','name':'纪念日','selector':'.mini-app[onclick=\x22showApp(\x27anniversary-screen\x27)\x22]\x20.mini-app-icon'},{'id':_0x222520(0x149f),'name':'论坛','selector':_0x222520(0x1dda)},{'id':_0x222520(0x1c5d),'name':'短信','selector':'.dock-app[onclick=\x22showApp(\x27messages-screen\x27)\x22]\x20.dock-app-icon'},{'id':_0x222520(0x19bd),'name':'设置','selector':'.dock-app[onclick=\x22showApp(\x27settings-screen\x27)\x22]\x20.dock-app-icon'},{'id':_0x222520(0x122f),'name':'记忆','selector':_0x222520(0x79e)}];_0x3ac6bf[_0x222520(0x19fb)](_0x8d222b=>{const _0x12c8e1=_0x222520,_0x14eb25=document['querySelector'](_0x8d222b[_0x12c8e1(0x2108)]);if(_0x14eb25){const _0x4580fa=document['createElement']('div');_0x4580fa[_0x12c8e1(0x1722)]='app-item-selector',_0x4580fa[_0x12c8e1(0x1f36)]=()=>selectAppForIcon(_0x8d222b['id'],_0x8d222b['name'],_0x8d222b[_0x12c8e1(0x2108)]);const _0x40fcef=_0x14eb25[_0x12c8e1(0x33a)];_0x4580fa[_0x12c8e1(0x33a)]=_0x12c8e1(0x1600)+_0x40fcef+_0x12c8e1(0x20c4)+_0x8d222b[_0x12c8e1(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x4c7967['appendChild'](_0x4580fa);}});}function selectAppForIcon(_0x32af91,_0x3f7c1f,_0x167f4f){const _0xc347cc=_0x211817;selectedAppForIcon={'id':_0x32af91,'name':_0x3f7c1f,'selector':_0x167f4f},document['querySelectorAll'](_0xc347cc(0xe4e))[_0xc347cc(0x19fb)](_0x2352a6=>{const _0x4ff903=_0xc347cc;_0x2352a6[_0x4ff903(0x1c1b)][_0x4ff903(0x1493)]('selected');}),event[_0xc347cc(0x1fac)][_0xc347cc(0x1c1b)][_0xc347cc(0x21e2)](_0xc347cc(0x176b)),document[_0xc347cc(0x1262)](_0xc347cc(0x701))[_0xc347cc(0x14eb)][_0xc347cc(0x4da)]=_0xc347cc(0x13de),resetIconUpload();}function triggerIconUpload(){const _0x532d1e=_0x211817;if(!selectedAppForIcon){alert(_0x532d1e(0x518));return;}document[_0x532d1e(0x1262)](_0x532d1e(0x1e38))['click']();}function resetIconUpload(){const _0x5b1c96=_0x211817;uploadedIconImage=null,document[_0x5b1c96(0x1262)](_0x5b1c96(0x7fb))[_0x5b1c96(0x14eb)]['display']=_0x5b1c96(0x13de),document[_0x5b1c96(0x1262)](_0x5b1c96(0x1f3f))[_0x5b1c96(0x14eb)][_0x5b1c96(0x4da)]=_0x5b1c96(0x102b),document['querySelector'](_0x5b1c96(0x1409))[_0x5b1c96(0x1c1b)]['remove'](_0x5b1c96(0x14fb)),document['getElementById'](_0x5b1c96(0x3e3))['style'][_0x5b1c96(0x4da)]='none';}async function applyIconChange(){const _0x4c7220=_0x211817;if(!selectedAppForIcon||!uploadedIconImage){alert(_0x4c7220(0xdd3));return;}try{const _0x4080a8=document[_0x4c7220(0xb30)](selectedAppForIcon[_0x4c7220(0x2108)]);_0x4080a8&&(_0x4080a8[_0x4c7220(0x33a)]='<img\x20src=\x22'+uploadedIconImage+_0x4c7220(0x222c)+selectedAppForIcon[_0x4c7220(0x1a1c)]+_0x4c7220(0x932)),await saveCustomAppIcon(selectedAppForIcon['id'],uploadedIconImage),showToast('应用图标已更新！',_0x4c7220(0x11cb)),hideModal('icon-picker-modal'),selectedAppForIcon=null,uploadedIconImage=null;}catch(_0x2707a1){console[_0x4c7220(0x174a)]('更新应用图标失败:',_0x2707a1),showToast('更新失败，请重试',_0x4c7220(0x174a));}}async function saveCustomAppIcon(_0xd747bb,_0x441541){const _0x110274=_0x211817;try{await db[_0x110274(0x11fd)][_0x110274(0x1561)]({'id':_0xd747bb,'appId':_0xd747bb,'imageData':_0x441541,'updatedAt':new Date()}),console[_0x110274(0x2187)](_0x110274(0xd10),_0xd747bb);}catch(_0x1e8811){console[_0x110274(0x174a)](_0x110274(0x1433),_0x1e8811);throw _0x1e8811;}}async function loadCustomAppIcons(){const _0x4a0142=_0x211817;try{const _0x4bfc74=await db[_0x4a0142(0x11fd)][_0x4a0142(0xf13)]();_0x4bfc74['forEach'](_0x37e813=>{const _0x342892=_0x4a0142;if(_0x37e813[_0x342892(0x6bb)]){const _0x2303d0=[{'id':_0x342892(0x1c2a),'selector':_0x342892(0x22ed)},{'id':_0x342892(0x576),'selector':_0x342892(0x17f8)},{'id':_0x342892(0x309),'selector':'.mini-app[onclick=\x22showApp(\x27anniversary-screen\x27)\x22]\x20.mini-app-icon'},{'id':'forum-screen','selector':'.home-section.bottom-left\x20.mini-app:nth-child(2)\x20.mini-app-icon'},{'id':_0x342892(0x1c5d),'selector':_0x342892(0x2089)},{'id':_0x342892(0x19bd),'selector':_0x342892(0x1274)},{'id':'memory-viewer-screen','selector':_0x342892(0x79e)}],_0x12d7d0=_0x2303d0[_0x342892(0xaf4)](_0x2a8dad=>_0x2a8dad['id']===_0x37e813[_0x342892(0x1952)]);if(_0x12d7d0){const _0x17711a=document['querySelector'](_0x12d7d0[_0x342892(0x2108)]);_0x17711a&&(_0x17711a[_0x342892(0x33a)]=_0x342892(0xf7c)+_0x37e813[_0x342892(0x6bb)]+_0x342892(0x222c)+_0x37e813[_0x342892(0x1952)]+_0x342892(0x932));}}});}catch(_0x56879e){console['error'](_0x4a0142(0x1ff8),_0x56879e);}}function initializeIconUpload(){const _0x21531e=_0x211817,_0x4a2d71=document[_0x21531e(0x1262)](_0x21531e(0x1e38));if(!_0x4a2d71){console[_0x21531e(0x174a)](_0x21531e(0x21b1));return;}_0x4a2d71[_0x21531e(0xa21)](_0x21531e(0x5af),handleIconUpload),_0x4a2d71[_0x21531e(0x21e9)](_0x21531e(0x5af),handleIconUpload),console[_0x21531e(0x2187)]('应用图标上传事件监听器已绑定');}async function handleIconUpload(_0x3f5542){const _0xbe25e5=_0x211817;if(_0x3f5542[_0xbe25e5(0x193d)][_0xbe25e5(0xf26)]&&_0x3f5542[_0xbe25e5(0x193d)][_0xbe25e5(0xf26)][0x0]){const _0x4b0eeb=_0x3f5542['target'][_0xbe25e5(0xf26)][0x0];if(!_0x4b0eeb[_0xbe25e5(0x1a4b)][_0xbe25e5(0x1b30)]('image/')){alert(_0xbe25e5(0x118e));return;}if(_0x4b0eeb['size']>0x5*0x400*0x400){alert(_0xbe25e5(0x1cbc));return;}try{const _0x358904=await compressImage(_0x4b0eeb,0xc8,0.8),_0x20793a=document['querySelector'](_0xbe25e5(0x1409)),_0x3a687b=document[_0xbe25e5(0x1262)](_0xbe25e5(0x7fb)),_0x3a5595=document['getElementById'](_0xbe25e5(0x1f3f));_0x3a687b['style']['display']='none',_0x3a5595[_0xbe25e5(0x45c)]=_0x358904,_0x3a5595[_0xbe25e5(0x14eb)][_0xbe25e5(0x4da)]=_0xbe25e5(0x13de),_0x20793a[_0xbe25e5(0x1c1b)]['add'](_0xbe25e5(0x14fb)),uploadedIconImage=_0x358904,document[_0xbe25e5(0x1262)](_0xbe25e5(0x3e3))[_0xbe25e5(0x14eb)][_0xbe25e5(0x4da)]=_0xbe25e5(0xae7),showToast(_0xbe25e5(0x1ece),'success');}catch(_0x335758){console[_0xbe25e5(0x174a)](_0xbe25e5(0x19b0),_0x335758),showToast(_0xbe25e5(0x112c),_0xbe25e5(0x174a));}}}function changeChatThemeColor(){const _0x123526=_0x211817;colorPickerContext=_0x123526(0x6c8),document[_0x123526(0x1262)](_0x123526(0x20ca))[_0x123526(0x13be)]=_0x123526(0xbdf),showModal(_0x123526(0xdd4));}function showMessageMenu(_0x357027,_0x1efc98){const _0x3ba04b=_0x211817;selectedMessageId=_0x357027,console['log']('桌面端右键菜单，设置selectedMessageId:',selectedMessageId),hideMessageMenu();let _0x5ae09e=document['getElementById'](_0x3ba04b(0x4ce));!_0x5ae09e&&(_0x5ae09e=document[_0x3ba04b(0xac6)]('div'),_0x5ae09e['id']=_0x3ba04b(0x4ce),_0x5ae09e['className']=_0x3ba04b(0x68f),document['body'][_0x3ba04b(0x497)](_0x5ae09e));const _0x28526e=chatMessages[currentChatCharacter['id']]||[],_0x3265d8=_0x28526e[_0x3ba04b(0xaf4)](_0x2de4fd=>_0x2de4fd['id']===_0x357027),_0x28e2ca=_0x3265d8&&_0x3265d8[_0x3ba04b(0x8a1)]===_0x3ba04b(0x1e6d);let _0x589a51=[_0x3ba04b(0x1434),'<div\x20class=\x22message-menu-item\x22\x20data-action=\x22copy\x22>复制</div>'];!_0x28e2ca&&_0x589a51[_0x3ba04b(0x1cd6)](_0x3ba04b(0x8c0));_0x589a51[_0x3ba04b(0x1cd6)](_0x3ba04b(0x1ca8));_0x28e2ca&&_0x589a51[_0x3ba04b(0x1cd6)](_0x3ba04b(0x14dc));_0x589a51[_0x3ba04b(0x1cd6)]('<div\x20class=\x22message-menu-item\x22\x20data-action=\x22select\x22>多选</div>'),_0x5ae09e[_0x3ba04b(0x33a)]=_0x589a51[_0x3ba04b(0x122b)](''),_0x5ae09e['onclick']=function(_0x30a11b){const _0x3dec06=_0x3ba04b,_0x5d959a=_0x30a11b[_0x3dec06(0x193d)][_0x3dec06(0x1ecd)][_0x3dec06(0x211f)];if(_0x5d959a){_0x30a11b['stopPropagation'](),console['log'](_0x3dec06(0x1e36),_0x5d959a,_0x3dec06(0xf7f),selectedMessageId);const _0x51fbdd=_0x357027;console[_0x3dec06(0x2187)](_0x3dec06(0x913),_0x51fbdd);switch(_0x5d959a){case _0x3dec06(0xd5f):replyToMessage(_0x51fbdd);break;case _0x3dec06(0x1914):copyMessage(_0x51fbdd);break;case _0x3dec06(0x155f):showEditMessageModal(_0x51fbdd);break;case _0x3dec06(0x1e8f):deleteMessage(_0x51fbdd);break;case _0x3dec06(0x1bfb):showInnerThoughtsModal(_0x51fbdd);break;case _0x3dec06(0x184):enterMessageSelectionMode(_0x51fbdd);break;}hideMessageMenu(null);}};const _0x485404=_0x1efc98[_0x3ba04b(0x230)]||_0x1efc98[_0x3ba04b(0x18da)],_0x6de153=_0x1efc98[_0x3ba04b(0xcb0)]||_0x1efc98[_0x3ba04b(0x134c)];_0x5ae09e[_0x3ba04b(0x14eb)][_0x3ba04b(0x4da)]=_0x3ba04b(0x13de),_0x5ae09e['style'][_0x3ba04b(0x15dc)]=Math[_0x3ba04b(0x21ff)](_0x485404,window[_0x3ba04b(0x44f)]-0x96)+'px',_0x5ae09e[_0x3ba04b(0x14eb)][_0x3ba04b(0x825)]=Math[_0x3ba04b(0x21ff)](_0x6de153,window[_0x3ba04b(0x128a)]-0x64)+'px',setTimeout(()=>{const _0x287e9e=_0x3ba04b;document['removeEventListener'](_0x287e9e(0x1859),hideMessageMenu),document['removeEventListener'](_0x287e9e(0x1728),hideMessageMenu),document[_0x287e9e(0x21e9)](_0x287e9e(0x1859),hideMessageMenu),document['addEventListener'](_0x287e9e(0x1728),hideMessageMenu);},0x64);}function hideMessageMenu(_0x2322ad){const _0x51fe9e=_0x211817;if(_0x2322ad&&_0x2322ad[_0x51fe9e(0x193d)]){const _0x336ee9=document[_0x51fe9e(0x1262)](_0x51fe9e(0x4ce));if(_0x336ee9&&_0x336ee9['contains'](_0x2322ad[_0x51fe9e(0x193d)]))return;}const _0xb43458=document[_0x51fe9e(0x1262)](_0x51fe9e(0x4ce));_0xb43458&&(_0xb43458[_0x51fe9e(0x14eb)][_0x51fe9e(0x4da)]=_0x51fe9e(0x102b),_0xb43458[_0x51fe9e(0x1f36)]=null),document[_0x51fe9e(0xa21)](_0x51fe9e(0x1859),hideMessageMenu),document['removeEventListener']('touchstart',hideMessageMenu),selectedMessageId=null;}let currentReplyTo=null,chatReplyStates={};function replyToMessage(_0x56cf4d=null){const _0x472430=_0x211817,_0x1d10aa=_0x56cf4d||selectedMessageId;console['log'](_0x472430(0x1d89),_0x1d10aa,_0x472430(0x1052),_0x56cf4d?_0x472430(0x1164):_0x472430(0x18ab));if(!_0x1d10aa){console[_0x472430(0x2187)](_0x472430(0xfeb));return;}const _0x5e95b8=chatMessages[currentChatCharacter['id']]||[],_0x1bcc5b=_0x5e95b8['find'](_0x102b92=>_0x102b92['id']===_0x1d10aa);if(_0x1bcc5b){let _0x31679a=_0x472430(0x1bad);if(Array[_0x472430(0x1496)](_0x1bcc5b['content'])){const _0x2a913b=_0x1bcc5b[_0x472430(0x211c)][_0x472430(0xaf4)](_0x5ea9d6=>_0x5ea9d6['type']===_0x472430(0x1378)),_0x471b86=_0x1bcc5b[_0x472430(0x211c)][_0x472430(0xaf4)](_0x4f6da1=>_0x4f6da1[_0x472430(0x1a4b)]===_0x472430(0x910));if(_0x2a913b?.[_0x472430(0x1378)])_0x31679a=_0x2a913b[_0x472430(0x1378)];else _0x471b86?_0x31679a=_0x472430(0x1bb6):_0x31679a=_0x472430(0x1ced);}else{if(_0x1bcc5b['type']===_0x472430(0x52c)){_0x31679a=_0x472430(0x1768)+_0x1bcc5b[_0x472430(0x211c)];if(_0x1bcc5b['forwardedMessages']&&_0x1bcc5b['forwardedMessages'][_0x472430(0x19ee)]>0x0){const _0x46e2d1=_0x1bcc5b[_0x472430(0xc15)][0x0],_0x3938b3=_0x46e2d1[_0x472430(0x8a1)]===_0x472430(0x1e6d)?_0x46e2d1[_0x472430(0xb51)]||'用户':_0x46e2d1['name']||_0x46e2d1['characterName']||'AI',_0x32c074=safeExtractMessageContent(_0x46e2d1);_0x31679a+=_0x472430(0x1811)+_0x3938b3+':\x20'+_0x32c074[_0x472430(0x17ca)](0x0,0x14)+_0x472430(0x1520);}}else{if(typeof _0x1bcc5b[_0x472430(0x211c)]===_0x472430(0x11b7))_0x31679a=_0x1bcc5b[_0x472430(0x211c)];else _0x1bcc5b[_0x472430(0x68e)]?_0x31679a=_0x472430(0x1bb6):_0x31679a=_0x472430(0x424);}}currentReplyTo={'id':_0x1bcc5b['id'],'content':_0x31679a,'sender':_0x1bcc5b[_0x472430(0x8a1)],'timestamp':_0x1bcc5b[_0x472430(0x1716)],'senderName':getSenderDisplayName(_0x1bcc5b)};currentChatCharacter&&(chatReplyStates[currentChatCharacter['id']]={...currentReplyTo});showReplyPreview();const _0x5abe36=document['getElementById'](_0x472430(0x21bd));_0x5abe36&&_0x5abe36[_0x472430(0x13cf)]();}hideMessageMenu();}function getSenderDisplayName(_0x54d42e){const _0x3d414f=_0x211817;if(_0x54d42e['sender']===_0x3d414f(0x1e6d)){const _0x4ed943=getCurrentChatSettings();if(_0x4ed943[_0x3d414f(0x145e)]){const _0x315f66=personas[_0x3d414f(0xaf4)](_0x324537=>_0x324537['id']===_0x4ed943[_0x3d414f(0x145e)]);if(_0x315f66)return _0x315f66['name'];}return _0x4ed943[_0x3d414f(0x567)]||'我';}else{if(_0x54d42e[_0x3d414f(0x8a1)]==='received'){const _0x4d3a75=groupChats[_0x3d414f(0xaf4)](_0x254b69=>_0x254b69['id']===currentChatCharacter['id']);if(_0x4d3a75){let _0x1d8655=null;if(_0x54d42e['senderId'])_0x1d8655=_0x4d3a75[_0x3d414f(0x12a6)]['find'](_0x462362=>_0x462362['id']===_0x54d42e[_0x3d414f(0x12c8)]);else _0x54d42e[_0x3d414f(0x1a1c)]&&(_0x1d8655=_0x4d3a75[_0x3d414f(0x12a6)][_0x3d414f(0xaf4)](_0x2a7b09=>_0x2a7b09[_0x3d414f(0x1a1c)]===_0x54d42e[_0x3d414f(0x1a1c)]));return _0x1d8655?.[_0x3d414f(0x1a1c)]||_0x3d414f(0xaae);}else{const _0x47cfc7=getCurrentChatSettings();return _0x47cfc7[_0x3d414f(0x4e7)]||currentChatCharacter['name'];}}}return'未知';}function showReplyPreview(){const _0xca21cd=_0x211817;if(!currentReplyTo)return;const _0x4b4286=document[_0xca21cd(0x1262)](_0xca21cd(0x16d3));_0x4b4286&&_0x4b4286['remove']();const _0x1ec699=document[_0xca21cd(0xac6)](_0xca21cd(0xbbc));_0x1ec699['id']=_0xca21cd(0x16d3),_0x1ec699[_0xca21cd(0x1722)]=_0xca21cd(0x16d3);const _0x5ca38d=truncateText(currentReplyTo[_0xca21cd(0x211c)],0x19);_0x1ec699['innerHTML']=_0xca21cd(0x168f)+currentReplyTo[_0xca21cd(0x909)]+_0xca21cd(0x384)+_0x5ca38d+_0xca21cd(0x4e6),_0x1ec699[_0xca21cd(0x14eb)][_0xca21cd(0x4da)]=_0xca21cd(0x13de),_0x1ec699[_0xca21cd(0x14eb)]['visibility']='visible';const _0xc71d16=document[_0xca21cd(0xb30)](_0xca21cd(0x2f5));if(_0xc71d16){const _0x38b608=_0xc71d16['firstElementChild'];_0x38b608?_0xc71d16[_0xca21cd(0x1f04)](_0x1ec699,_0x38b608):_0xc71d16[_0xca21cd(0x497)](_0x1ec699);}}function cancelReply(){const _0xbfc590=_0x211817;currentReplyTo=null;currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];const _0x107900=document[_0xbfc590(0x1262)](_0xbfc590(0x16d3));_0x107900&&_0x107900[_0xbfc590(0x1493)]();}function generateReplyHTML(_0x59e027){const _0x2b9d32=_0x211817;if(!_0x59e027)return'';let _0x1ec1d9=truncateText(_0x59e027[_0x2b9d32(0x211c)],0x14);return _0x1ec1d9=processMentions(_0x1ec1d9),_0x2b9d32(0x1b63)+_0x59e027[_0x2b9d32(0x909)]+_0x2b9d32(0x13e6)+_0x1ec1d9+_0x2b9d32(0x19dd);}function copyMessage(_0x5b69e9=null){const _0x5b353f=_0x211817,_0x2fa9e0=_0x5b69e9||selectedMessageId;console[_0x5b353f(0x2187)](_0x5b353f(0x1eab),_0x2fa9e0,_0x5b353f(0x1052),_0x5b69e9?_0x5b353f(0x1164):'桌面端');if(!_0x2fa9e0){console[_0x5b353f(0x2187)](_0x5b353f(0xfeb));return;}const _0x535ee7=chatMessages[currentChatCharacter['id']]||[],_0x1f7b7d=_0x535ee7[_0x5b353f(0xaf4)](_0x1e4f5a=>_0x1e4f5a['id']===_0x2fa9e0);if(_0x1f7b7d){const _0x429dc9=safeExtractMessageContent(_0x1f7b7d);navigator['clipboard'][_0x5b353f(0xba8)](_0x429dc9)[_0x5b353f(0x63d)](()=>{const _0x5e775c=_0x5b353f;alert(_0x5e775c(0x152e));})['catch'](()=>{alert('复制失败，请重试');});}hideMessageMenu();}function showEditMessageModal(_0x22ef2c){const _0xd91fbf=_0x211817;if(!_0x22ef2c)return;const _0x2bcc18=chatMessages[currentChatCharacter['id']]||[],_0x5136a4=_0x2bcc18[_0xd91fbf(0xaf4)](_0x4c3c00=>_0x4c3c00['id']===_0x22ef2c);if(!_0x5136a4){showToast('消息不存在','error');return;}let _0x246a3b='';try{_0x246a3b=safeExtractMessageContent(_0x5136a4),_0x246a3b[_0xd91fbf(0x1b30)]('[')&&_0x246a3b['endsWith'](']')&&(_0x246a3b=_0xd91fbf(0x302),console[_0xd91fbf(0x1f43)](_0xd91fbf(0x1c41),_0x5136a4));}catch(_0x3ca0dc){console[_0xd91fbf(0x174a)](_0xd91fbf(0x11b1),_0x3ca0dc),_0x246a3b=_0xd91fbf(0x302);}const _0x20d84b=document[_0xd91fbf(0xac6)](_0xd91fbf(0xbbc));_0x20d84b[_0xd91fbf(0x1722)]=_0xd91fbf(0x56e),_0x20d84b['id']='edit-message-modal';const _0x22362c=_0x5136a4[_0xd91fbf(0x8a1)]===_0xd91fbf(0x1e6d)?'你':_0x5136a4['name']||currentChatCharacter[_0xd91fbf(0x1a1c)];_0x20d84b[_0xd91fbf(0x33a)]=_0xd91fbf(0x18c8)+_0x22362c+_0xd91fbf(0xef2)+formatTimestamp(_0x5136a4[_0xd91fbf(0x1716)])+_0xd91fbf(0x1a5b)+_0x246a3b+_0xd91fbf(0x14d6)+_0x246a3b[_0xd91fbf(0x19ee)]+_0xd91fbf(0xfcd)+(_0x5136a4[_0xd91fbf(0x68e)]?_0xd91fbf(0x1fb)+_0x5136a4[_0xd91fbf(0x68e)]+'\x22\x20alt=\x22消息图片\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-image-btn\x22\x20onclick=\x22removeMessageImage()\x22>删除图片</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-cancel\x22\x20onclick=\x22hideEditMessageModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20modal-confirm\x22\x20onclick=\x22saveEditedMessage(\x27'+_0x22ef2c+_0xd91fbf(0x1c3a),document[_0xd91fbf(0x1da9)]['appendChild'](_0x20d84b);const _0x20c680=document[_0xd91fbf(0x1262)](_0xd91fbf(0x7da)),_0x1b88a3=document[_0xd91fbf(0x1262)](_0xd91fbf(0xe8b));_0x20c680[_0xd91fbf(0x21e9)](_0xd91fbf(0x1823),function(){const _0x138864=_0xd91fbf;_0x1b88a3[_0x138864(0x13be)]=this[_0x138864(0x1ebc)][_0x138864(0x19ee)];}),setTimeout(()=>{const _0x5041c0=_0xd91fbf;_0x20c680[_0x5041c0(0x13cf)](),_0x20c680[_0x5041c0(0x207)](_0x20c680['value'][_0x5041c0(0x19ee)],_0x20c680['value'][_0x5041c0(0x19ee)]);},0x64);}function hideEditMessageModal(){const _0x5ccddd=_0x211817,_0x3343ce=document[_0x5ccddd(0x1262)](_0x5ccddd(0x9a1));_0x3343ce&&_0x3343ce[_0x5ccddd(0x1493)]();}async function saveEditedMessage(_0x36e9df){const _0x127af0=_0x211817,_0x111304=document['getElementById'](_0x127af0(0x7da))['value'][_0x127af0(0x19d7)]();if(!_0x111304){showToast(_0x127af0(0x655),_0x127af0(0x174a));return;}const _0x2ef42e=chatMessages[currentChatCharacter['id']]||[],_0x33298d=_0x2ef42e[_0x127af0(0x150c)](_0x254ff1=>_0x254ff1['id']===_0x36e9df);if(_0x33298d!==-0x1){const _0x3f969f=_0x2ef42e[_0x33298d][_0x127af0(0x211c)];typeof _0x111304===_0x127af0(0x11b7)?_0x2ef42e[_0x33298d]['content']=_0x111304:(console[_0x127af0(0x1f43)](_0x127af0(0x17c2),_0x111304),_0x2ef42e[_0x33298d][_0x127af0(0x211c)]=String(_0x111304));_0x2ef42e[_0x33298d]['edited']=!![],_0x2ef42e[_0x33298d][_0x127af0(0x5c9)]=Date[_0x127af0(0x2eb)]();const _0x6ef35d={..._0x2ef42e[_0x33298d],'content':String(_0x2ef42e[_0x33298d]['content'])};try{const _0x521f97=await db['chatMessages'][_0x127af0(0xa24)](_0x127af0(0xaf5))[_0x127af0(0x1694)](currentChatCharacter['id'])[_0x127af0(0x82f)](_0x2fba79=>_0x2fba79[_0x127af0(0x2130)]===_0x2ef42e[_0x33298d]['id'])['first']();_0x521f97&&(_0x521f97[_0x127af0(0x1ea3)]=_0x6ef35d,await db[_0x127af0(0x19a2)][_0x127af0(0x1561)](_0x521f97),console[_0x127af0(0x2187)](_0x127af0(0x20e6)));}catch(_0x58bd54){console['error']('编辑消息单条保存失败，回退到批量保存:',_0x58bd54),saveChatMessages();}renderChatMessages(currentChatCharacter['id']),hideEditMessageModal(),showToast(_0x127af0(0x1c37),_0x127af0(0x11cb)),console[_0x127af0(0x2187)](_0x127af0(0x1477)+_0x3f969f+'\x22\x20->\x20\x22'+_0x111304+'\x22');}else showToast(_0x127af0(0x4a9),_0x127af0(0x174a));}function removeMessageImage(){const _0x5d1718=_0x211817;showToast('暂不支持移除图片',_0x5d1718(0x477));}function editMessage(){const _0x2335e8=_0x211817;if(!selectedMessageId)return;showEditMessageModal(selectedMessageId),hideModal(_0x2335e8(0x17bd));}async function validateAvatarSource(_0x517a78){const _0x27c018=_0x211817;console[_0x27c018(0x2187)]('验证头像来源:',_0x517a78);if(!_0x517a78)return![];let _0x4ac452=_0x517a78;if(_0x517a78===_0x27c018(0xc50)||_0x517a78===_0x27c018(0xc50)||_0x517a78===_0x27c018(0x1004)||_0x517a78===_0x27c018(0x13b0)){const _0x29005b=getRecentUserImage();if(_0x29005b)_0x4ac452=_0x29005b,console['log']('占位符替换为实际图片URL:',_0x4ac452);else return console['log']('没有找到用户发送的图片，验证失败'),![];}if(currentChatCharacter&&chatMessages[currentChatCharacter['id']]){const _0x1b5283=[];chatMessages[currentChatCharacter['id']][_0x27c018(0x1e1f)](_0x5aa17a=>_0x5aa17a[_0x27c018(0x8a1)]===_0x27c018(0x1e6d))['forEach'](_0x501d26=>{const _0x275756=_0x27c018;_0x501d26[_0x275756(0x68e)]&&_0x1b5283[_0x275756(0x1cd6)](_0x501d26[_0x275756(0x68e)]),Array[_0x275756(0x1496)](_0x501d26['content'])&&_0x501d26[_0x275756(0x211c)][_0x275756(0x19fb)](_0x222161=>{const _0x33664a=_0x275756;_0x222161[_0x33664a(0x1a4b)]===_0x33664a(0x910)&&_0x222161[_0x33664a(0x910)]&&_0x222161[_0x33664a(0x910)][_0x33664a(0x40f)]&&_0x1b5283[_0x33664a(0x1cd6)](_0x222161[_0x33664a(0x910)][_0x33664a(0x40f)]);});}),console['log']('用户发送的图片列表:',_0x1b5283),console[_0x27c018(0x2187)](_0x27c018(0x9a4),_0x1b5283[_0x27c018(0x1831)](_0x4ac452));if(_0x1b5283[_0x27c018(0x1831)](_0x4ac452))return console[_0x27c018(0x2187)](_0x27c018(0x19e)),!![];}const _0x7d6ac=getCurrentChatSettings();if(_0x7d6ac['worldbookMountEnabled']&&_0x7d6ac['selectedWorldbooks'])for(const _0x382266 of _0x7d6ac[_0x27c018(0x1a45)]){const _0x4d42e3=worldbooks[_0x27c018(0xaf4)](_0x4bb393=>_0x4bb393['id']===_0x382266);if(_0x4d42e3&&_0x4d42e3[_0x27c018(0x211c)]&&_0x4d42e3[_0x27c018(0x211c)]['includes'](_0x4ac452))return console['log']('头像来源验证通过：世界书中的URL'),!![];}return console[_0x27c018(0x2187)](_0x27c018(0xf60)),![];}async function changeCharacterAvatarByAI(_0x2da81e,_0x28e5a9=''){const _0x596a80=_0x211817;if(!currentChatCharacter||!_0x2da81e)return![];try{const _0x3a4acf=getCurrentChatSettings();let _0x3da24b=_0x2da81e;if(_0x2da81e[_0x596a80(0x1b30)](_0x596a80(0x13c6)))try{_0x3da24b=await compressImage(_0x2da81e,0xc8,0.7),console[_0x596a80(0x2187)]('头像已压缩以节省存储空间');}catch(_0x1a2f4f){console[_0x596a80(0x1f43)](_0x596a80(0x220d),_0x1a2f4f);}!chatSettings[currentChatCharacter['id']]&&(chatSettings[currentChatCharacter['id']]={});chatSettings[currentChatCharacter['id']][_0x596a80(0x179f)]=_0x3da24b,console[_0x596a80(0x2187)](_0x596a80(0xb49),{'characterId':currentChatCharacter['id'],'characterName':currentChatCharacter[_0x596a80(0x1a1c)],'avatarUrl':_0x3da24b['substring'](0x0,0x32)+_0x596a80(0x1520),'settingsSnapshot':{'aiChatAvatar':!!chatSettings[currentChatCharacter['id']]['aiChatAvatar']}}),await saveChatSettings();const _0x162153={'id':Date[_0x596a80(0x2eb)]()[_0x596a80(0x1878)](),'sender':'system','content':currentChatCharacter[_0x596a80(0x1a1c)]+_0x596a80(0x2254)+(_0x28e5a9?':\x20'+_0x28e5a9:''),'timestamp':Date[_0x596a80(0x2eb)](),'isAvatarChange':!![]};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']]['push'](_0x162153);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console[_0x596a80(0x2187)]('✅\x20[高效头像更换系统消息]\x20消息已保存到数据库');}catch(_0x5bdb0b){console['error'](_0x596a80(0x2109),_0x5bdb0b),await saveChatMessages();}return renderChatMessages(currentChatCharacter['id']),forceRefreshAvatars(),console['log'](_0x596a80(0x150a)+currentChatCharacter[_0x596a80(0x1a1c)]+_0x596a80(0xd00)),!![];}catch(_0x3696ba){return console[_0x596a80(0x174a)]('角色更换头像失败:',_0x3696ba),![];}return![];}async function deleteMessage(_0x725ee7=null){const _0xb3386b=_0x211817,_0x30500c=_0x725ee7||selectedMessageId;console[_0xb3386b(0x2187)](_0xb3386b(0x12c4),_0x30500c,_0xb3386b(0x1052),_0x725ee7?'移动端':_0xb3386b(0x18ab));if(!_0x30500c){console[_0xb3386b(0x2187)]('错误:\x20没有选中的消息ID');return;}const _0x10995a=chatMessages[currentChatCharacter['id']]||[],_0x259d69=_0x10995a['findIndex'](_0x30779a=>_0x30779a['id']===_0x30500c);if(_0x259d69===-0x1){hideMessageMenu();return;}const _0x682255=_0x10995a[_0x259d69];if(confirm(_0xb3386b(0x1148))){try{await deleteRelatedTimelineEvents(_0x682255),console[_0xb3386b(0x2187)](_0xb3386b(0x941));}catch(_0x5bbc87){console[_0xb3386b(0x174a)](_0xb3386b(0x1c65),_0x5bbc87);}await _internalRecallMessage(currentChatCharacter['id'],_0x682255);}hideMessageMenu();}async function checkStorageUsage(){const _0x3299b2=_0x211817;try{if(_0x3299b2(0x12f5)in navigator&&_0x3299b2(0x1cf)in navigator['storage']){const _0x170678=await navigator[_0x3299b2(0x12f5)][_0x3299b2(0x1cf)](),_0x562a81=(_0x170678[_0x3299b2(0x427)]||0x0)/(0x400*0x400),_0x23fefb=(_0x170678[_0x3299b2(0x2297)]||0x0)/(0x400*0x400),_0x22e34b=_0x23fefb>0x0?_0x562a81/_0x23fefb*0x64:0x0;return{'usedMB':_0x562a81,'quotaMB':_0x23fefb,'usagePercent':_0x22e34b,'needCleanup':_0x22e34b>0x50};}}catch(_0x1900f4){console[_0x3299b2(0x1f43)](_0x3299b2(0x1344),_0x1900f4);}return null;}async function performSmartDataCleanup(){const _0x3566f=_0x211817;try{const _0x4a7855=await db[_0x3566f(0x19a2)][_0x3566f(0xe30)](_0x3566f(0x1716))[_0x3566f(0xf13)]();if(_0x4a7855['length']>0x1388){const _0x49df02=_0x4a7855['slice'](0x0,_0x4a7855[_0x3566f(0x19ee)]-0xbb8),_0x4c3e5f=_0x49df02['map'](_0x405231=>_0x405231['id']);await db['chatMessages'][_0x3566f(0x1aaa)](_0x4c3e5f),console[_0x3566f(0x2187)](_0x3566f(0x19fc)+_0x4c3e5f['length']+_0x3566f(0x1196));}}catch(_0x59d196){console[_0x3566f(0x174a)]('数据清理失败:',_0x59d196);}}async function _internalRecallMessage(_0x3d1c19,_0x25def9){const _0x21ccf2=_0x211817,_0x5691f2=chatMessages[_0x3d1c19]||[],_0xf15a60=_0x5691f2[_0x21ccf2(0x150c)](_0x4de748=>_0x4de748['id']===_0x25def9['id']);if(_0xf15a60===-0x1){console['error']('❌\x20[核心撤回]\x20未在内存中找到要撤回的消息:',_0x25def9);return;}const _0x3e8406=document[_0x21ccf2(0xb30)](_0x21ccf2(0x732)+_0x25def9['id']+'\x22]');_0x3e8406&&(console[_0x21ccf2(0x2187)](_0x21ccf2(0x1e94)),_0x3e8406[_0x21ccf2(0x14eb)]['animation']=_0x21ccf2(0x17e6),await new Promise(_0x4d1106=>setTimeout(_0x4d1106,0x1f4)));try{const _0x94b0cd=await db[_0x21ccf2(0x19a2)][_0x21ccf2(0xa24)]('characterId')['equals'](_0x3d1c19)['and'](_0x411ec3=>_0x411ec3[_0x21ccf2(0x2130)]===_0x25def9['id'])[_0x21ccf2(0x1a7b)]();if(_0x94b0cd){const _0x2a25bb=safeExtractMessageContent(_0x25def9),_0xff4fea=_0x25def9[_0x21ccf2(0x8a1)]===_0x21ccf2(0x1e6d)?'你':currentChatCharacter['name']||'对方';_0x94b0cd[_0x21ccf2(0x1ea3)]={..._0x94b0cd[_0x21ccf2(0x1ea3)],'sender':_0x21ccf2(0x1744),'type':_0x21ccf2(0x21f6),'content':_0xff4fea+'撤回了一条消息\x0a原文：'+_0x2a25bb,'originalContent':_0x2a25bb,'isRecalled':!![]},await db['chatMessages']['put'](_0x94b0cd),console[_0x21ccf2(0x2187)](_0x21ccf2(0xffe));}}catch(_0x5a7bbf){console[_0x21ccf2(0x174a)](_0x21ccf2(0x1637),_0x5a7bbf);}const _0xb41a97=safeExtractMessageContent(_0x25def9),_0x1a0f7d=_0x25def9[_0x21ccf2(0x8a1)]==='sent'?'你':currentChatCharacter[_0x21ccf2(0x1a1c)]||'对方';_0x5691f2[_0xf15a60]={'id':_0x25def9['id'],'sender':_0x21ccf2(0x1744),'type':'recalled_message','content':_0x1a0f7d+_0x21ccf2(0x1ce5)+_0xb41a97,'originalContent':_0xb41a97,'timestamp':_0x25def9['timestamp'],'isRecalled':!![]},renderChatMessages(_0x3d1c19),renderMessageList(),console['log']('🎉\x20[高效撤回]\x20角色\x20'+_0x3d1c19+_0x21ccf2(0x1bdd)+_0x25def9['id']+_0x21ccf2(0x1af1));}function formatTime(_0x4d66e0){const _0x514236=_0x211817,_0x1f4334=new Date(_0x4d66e0),_0x20201d=_0x1f4334[_0x514236(0xe2e)]()[_0x514236(0x1878)]()['padStart'](0x2,'0'),_0x1aff36=_0x1f4334[_0x514236(0xe80)]()[_0x514236(0x1878)]()['padStart'](0x2,'0');return _0x20201d+':'+_0x1aff36;}function formatTimestamp(_0x47db3b){const _0x36a2d5=_0x211817,_0xf94f51=new Date(_0x47db3b),_0x373cbc=new Date(),_0xea6a50=new Date(_0x373cbc['getFullYear'](),_0x373cbc['getMonth'](),_0x373cbc[_0x36a2d5(0x520)]()),_0x3f5b06=new Date(_0xea6a50[_0x36a2d5(0x704)]()-0x18*0x3c*0x3c*0x3e8),_0x95ce84=new Date(_0xf94f51[_0x36a2d5(0x16a0)](),_0xf94f51[_0x36a2d5(0x1da)](),_0xf94f51[_0x36a2d5(0x520)]()),_0x4711a0=_0xf94f51['getHours']()[_0x36a2d5(0x1878)]()['padStart'](0x2,'0'),_0x1b07ce=_0xf94f51[_0x36a2d5(0xe80)]()[_0x36a2d5(0x1878)]()[_0x36a2d5(0xdfe)](0x2,'0'),_0x59fb98=_0x4711a0+':'+_0x1b07ce;if(_0x95ce84['getTime']()===_0xea6a50[_0x36a2d5(0x704)]())return _0x59fb98;else{if(_0x95ce84[_0x36a2d5(0x704)]()===_0x3f5b06[_0x36a2d5(0x704)]())return'昨天\x20'+_0x59fb98;else{const _0x54506f=(_0xf94f51[_0x36a2d5(0x1da)]()+0x1)[_0x36a2d5(0x1878)]()[_0x36a2d5(0xdfe)](0x2,'0'),_0x13d342=_0xf94f51[_0x36a2d5(0x520)]()['toString']()[_0x36a2d5(0xdfe)](0x2,'0');return _0x54506f+'月'+_0x13d342+'日\x20'+_0x59fb98;}}}function formatTimeOnly(_0x3666e7){const _0x404dbc=_0x211817,_0x8b6583=new Date(_0x3666e7),_0x391926=_0x8b6583[_0x404dbc(0xe2e)]()[_0x404dbc(0x1878)]()[_0x404dbc(0xdfe)](0x2,'0'),_0x8b8d21=_0x8b6583['getMinutes']()[_0x404dbc(0x1878)]()[_0x404dbc(0xdfe)](0x2,'0');return _0x391926+':'+_0x8b8d21;}function formatFullDate(_0x3f03e0){const _0x50b7af=_0x211817,_0x8b4573=_0x3f03e0[_0x50b7af(0x16a0)](),_0x5d0c73=(_0x3f03e0['getMonth']()+0x1)[_0x50b7af(0x1878)]()['padStart'](0x2,'0'),_0x1d96e9=_0x3f03e0[_0x50b7af(0x520)]()[_0x50b7af(0x1878)]()[_0x50b7af(0xdfe)](0x2,'0'),_0x26fe7e=_0x3f03e0['getHours']()['toString']()[_0x50b7af(0xdfe)](0x2,'0'),_0x144b78=_0x3f03e0['getMinutes']()[_0x50b7af(0x1878)]()[_0x50b7af(0xdfe)](0x2,'0');return _0x8b4573+'年'+_0x5d0c73+'月'+_0x1d96e9+'日\x20'+_0x26fe7e+':'+_0x144b78;}function loadUrl(){const _0x1d7c5a=_0x211817,_0x56374b=document[_0x1d7c5a(0x1262)](_0x1d7c5a(0x215d))[_0x1d7c5a(0x1ebc)];let _0x509ec3=_0x56374b;!_0x56374b[_0x1d7c5a(0x1b30)](_0x1d7c5a(0x4fa))&&!_0x56374b[_0x1d7c5a(0x1b30)](_0x1d7c5a(0x797))&&(_0x509ec3='https://'+_0x56374b),document[_0x1d7c5a(0x1262)](_0x1d7c5a(0x229b))['src']=_0x509ec3;}async function saveApiSettings(){const _0x517e88=_0x211817,_0x55f66f=document[_0x517e88(0x1262)](_0x517e88(0x1b2))['value']['trim'](),_0x507e63=document[_0x517e88(0x1262)](_0x517e88(0x185c))['value'][_0x517e88(0x19d7)](),_0x51d554=document['getElementById'](_0x517e88(0xeb1))[_0x517e88(0x1ebc)][_0x517e88(0x19d7)](),_0x13ec88=parseFloat(document['getElementById'](_0x517e88(0x2304))[_0x517e88(0x1ebc)])||0.75,_0x2e9d82=document['getElementById'](_0x517e88(0x8f4))['checked'];if(!_0x55f66f||!_0x507e63||!_0x51d554){showToast(_0x517e88(0x1d5),_0x517e88(0x174a));return;}apiSettings={'base':_0x55f66f,'key':_0x507e63,'model':_0x51d554,'temperature':_0x13ec88,'emojiRecognitionEnabled':_0x2e9d82,'endpoint':_0x517e88(0x1bea)};try{await db[_0x517e88(0x1f0c)][_0x517e88(0x1561)]({'id':_0x517e88(0x11d7),'settings':apiSettings}),localStorage[_0x517e88(0x192)](_0x517e88(0x1f0c),JSON[_0x517e88(0x6b8)](apiSettings)),showToast('API设置已保存！',_0x517e88(0x11cb)),console[_0x517e88(0x2187)]('🔧\x20[API设置]\x20已保存到IndexedDB和localStorage:',apiSettings);}catch(_0x52ff17){console[_0x517e88(0x174a)](_0x517e88(0x217c),_0x52ff17),showToast(_0x517e88(0x21d2)+_0x52ff17[_0x517e88(0x1e8e)],_0x517e88(0x174a));return;}document['getElementById']('temperature-value')[_0x517e88(0x13be)]=_0x13ec88[_0x517e88(0x13ad)](0x2);}function setGeminiDirect(){const _0x4508e9=_0x211817;document['getElementById']('api-base')[_0x4508e9(0x1ebc)]='https://generativelanguage.googleapis.com/v1beta',document[_0x4508e9(0x1262)](_0x4508e9(0x185c))[_0x4508e9(0x1aa7)]=_0x4508e9(0x589);const _0x5dbf2a=document[_0x4508e9(0x1262)](_0x4508e9(0xeb1));_0x5dbf2a[_0x4508e9(0x33a)]=_0x4508e9(0x1165),_0x5dbf2a['onchange']=function(){const _0xea53d4=_0x4508e9;if(this['value']===_0xea53d4(0x1b43)){const _0x177e91=prompt(_0xea53d4(0x1678));if(_0x177e91&&_0x177e91[_0xea53d4(0x19d7)]()){const _0x4cbd46=new Option(_0x177e91[_0xea53d4(0x19d7)](),_0x177e91[_0xea53d4(0x19d7)]());this[_0xea53d4(0x1f04)](_0x4cbd46,this[_0xea53d4(0x1d26)]),this[_0xea53d4(0x1ebc)]=_0x177e91['trim']();}else this['value']='';}},showToast(_0x4508e9(0x1700),_0x4508e9(0x11cb));}function setHuggingFaceProxy(){const _0x128aaa=_0x211817;document[_0x128aaa(0x1262)](_0x128aaa(0x1b2))[_0x128aaa(0x1ebc)]=_0x128aaa(0x1bbb),document['getElementById'](_0x128aaa(0x185c))[_0x128aaa(0x1aa7)]='请输入HuggingFace的API\x20Token';const _0x58f8d3=document[_0x128aaa(0x1262)](_0x128aaa(0xeb1));_0x58f8d3['innerHTML']=_0x128aaa(0x5b3),_0x58f8d3['onchange']=function(){const _0x1cac04=_0x128aaa;if(this[_0x1cac04(0x1ebc)]==='custom'){const _0xf6148a=prompt(_0x1cac04(0x25c));if(_0xf6148a&&_0xf6148a['trim']()){const _0x4deb4e=new Option(_0xf6148a[_0x1cac04(0x19d7)](),_0xf6148a['trim']());this[_0x1cac04(0x1f04)](_0x4deb4e,this[_0x1cac04(0x1d26)]),this[_0x1cac04(0x1ebc)]=_0xf6148a['trim']();}else this[_0x1cac04(0x1ebc)]='';}},showToast(_0x128aaa(0x993),_0x128aaa(0x11cb));}function saveCurrentConfig(){const _0x1595c4=_0x211817,_0xf5b858=document[_0x1595c4(0x1262)](_0x1595c4(0x1965))[_0x1595c4(0x1ebc)][_0x1595c4(0x19d7)]();if(!_0xf5b858){showToast(_0x1595c4(0x197d),_0x1595c4(0x174a));return;}const _0x1a2440={'name':_0xf5b858,'base':document[_0x1595c4(0x1262)]('api-base')['value'][_0x1595c4(0x19d7)](),'key':document[_0x1595c4(0x1262)]('api-key')[_0x1595c4(0x1ebc)]['trim'](),'model':document['getElementById'](_0x1595c4(0xeb1))['value']['trim'](),'temperature':parseFloat(document[_0x1595c4(0x1262)]('temperature-slider')[_0x1595c4(0x1ebc)])||0.75,'emojiRecognitionEnabled':document[_0x1595c4(0x1262)](_0x1595c4(0x8f4))[_0x1595c4(0x14c1)],'savedAt':new Date()[_0x1595c4(0xecc)]()};let _0x58ea9f=JSON[_0x1595c4(0x22d3)](localStorage['getItem'](_0x1595c4(0x1db7))||'[]');const _0x3567d5=_0x58ea9f['findIndex'](_0x5f0398=>_0x5f0398['name']===_0xf5b858);if(_0x3567d5!==-0x1){if(confirm('配置\x22'+_0xf5b858+_0x1595c4(0x1245)))_0x58ea9f[_0x3567d5]=_0x1a2440;else return;}else _0x58ea9f['push'](_0x1a2440);localStorage[_0x1595c4(0x192)](_0x1595c4(0x1db7),JSON[_0x1595c4(0x6b8)](_0x58ea9f)),document[_0x1595c4(0x1262)](_0x1595c4(0x1965))[_0x1595c4(0x1ebc)]='',renderSavedConfigs(),showToast(_0x1595c4(0x22f8)+_0xf5b858+_0x1595c4(0xd85),_0x1595c4(0x11cb));}function renderSavedConfigs(){const _0x5a05be=_0x211817,_0x205556=document[_0x5a05be(0x1262)](_0x5a05be(0x20e3)),_0x3b7d0b=document[_0x5a05be(0x1262)](_0x5a05be(0x64e)),_0xf4b38=JSON[_0x5a05be(0x22d3)](localStorage[_0x5a05be(0x15d8)](_0x5a05be(0x1db7))||'[]');if(_0xf4b38[_0x5a05be(0x19ee)]===0x0){_0x205556['style']['display']=_0x5a05be(0x102b),_0x3b7d0b[_0x5a05be(0x14eb)][_0x5a05be(0x4da)]=_0x5a05be(0x13de);return;}_0x205556[_0x5a05be(0x14eb)][_0x5a05be(0x4da)]=_0x5a05be(0xc00),_0x3b7d0b[_0x5a05be(0x14eb)][_0x5a05be(0x4da)]=_0x5a05be(0x102b),_0x205556[_0x5a05be(0x33a)]=_0xf4b38[_0x5a05be(0x6a4)](_0x2bb100=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22\x20style=\x22background:\x20rgba(255,255,255,0.8);\x20border-radius:\x2012px;\x20padding:\x2015px;\x20border:\x201px\x20solid\x20rgba(0,0,0,0.05);\x20transition:\x20all\x200.3s\x20ease;\x20cursor:\x20pointer;\x22\x20onclick=\x22loadConfig(\x27'+_0x2bb100['name']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20flex-start;\x20margin-bottom:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20600;\x20color:\x20#333;\x20font-size:\x2015px;\x22>'+_0x2bb100[_0x5a05be(0x1a1c)]+_0x5a05be(0x653)+_0x2bb100[_0x5a05be(0x1a1c)]+_0x5a05be(0xff7)+_0x2bb100[_0x5a05be(0x1208)]+_0x5a05be(0x11d6)+_0x2bb100[_0x5a05be(0x1976)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🌡️\x20温度:\x20'+_0x2bb100[_0x5a05be(0x11c5)]+_0x5a05be(0x17c1)+_0x2bb100[_0x5a05be(0x1a3e)]+_0x5a05be(0x1f2b))[_0x5a05be(0x122b)]('');}function loadConfig(_0x105d4e){const _0x333fdf=_0x211817,_0x188b2c=JSON[_0x333fdf(0x22d3)](localStorage[_0x333fdf(0x15d8)](_0x333fdf(0x1db7))||'[]'),_0x5a4ecb=_0x188b2c[_0x333fdf(0xaf4)](_0x492abd=>_0x492abd['name']===_0x105d4e);if(!_0x5a4ecb){showToast(_0x333fdf(0x1d12),'error');return;}document[_0x333fdf(0x1262)](_0x333fdf(0x1b2))[_0x333fdf(0x1ebc)]=_0x5a4ecb[_0x333fdf(0x1208)],document[_0x333fdf(0x1262)](_0x333fdf(0x185c))[_0x333fdf(0x1ebc)]=_0x5a4ecb['key'],document[_0x333fdf(0x1262)](_0x333fdf(0x2304))[_0x333fdf(0x1ebc)]=_0x5a4ecb[_0x333fdf(0x11c5)],document[_0x333fdf(0x1262)](_0x333fdf(0x854))[_0x333fdf(0x13be)]=_0x5a4ecb[_0x333fdf(0x11c5)]['toFixed'](0x2);const _0x1376d1=document[_0x333fdf(0x1262)](_0x333fdf(0xeb1)),_0x5b8fa7=Array[_0x333fdf(0x13c0)](_0x1376d1['options'])['find'](_0x3676b7=>_0x3676b7['value']===_0x5a4ecb['model']);if(!_0x5b8fa7){const _0x16f2e2=new Option(_0x5a4ecb[_0x333fdf(0x1976)],_0x5a4ecb[_0x333fdf(0x1976)]);_0x1376d1[_0x333fdf(0x497)](_0x16f2e2);}_0x1376d1[_0x333fdf(0x1ebc)]=_0x5a4ecb['model'];const _0x1aa187=document['getElementById'](_0x333fdf(0x8f4));_0x1aa187&&(_0x1aa187[_0x333fdf(0x14c1)]=_0x5a4ecb[_0x333fdf(0x9dd)]!==![]),showToast(_0x333fdf(0x1261)+_0x105d4e+'\x22',_0x333fdf(0x11cb));}function deleteConfig(_0x64bbb8){const _0x5e7682=_0x211817;if(confirm('确定要删除配置\x22'+_0x64bbb8+_0x5e7682(0x885))){let _0x5cca74=JSON[_0x5e7682(0x22d3)](localStorage[_0x5e7682(0x15d8)](_0x5e7682(0x1db7))||'[]');_0x5cca74=_0x5cca74[_0x5e7682(0x1e1f)](_0x5ed790=>_0x5ed790['name']!==_0x64bbb8),localStorage['setItem'](_0x5e7682(0x1db7),JSON[_0x5e7682(0x6b8)](_0x5cca74)),renderSavedConfigs(),showToast(_0x5e7682(0x22f8)+_0x64bbb8+'\x22已删除','success');}}function clearAllConfigs(){const _0x3f69fe=_0x211817;confirm('确定要清空所有已保存的配置吗？此操作不可恢复。')&&(localStorage[_0x3f69fe(0x3b2)](_0x3f69fe(0x1db7)),renderSavedConfigs(),showToast(_0x3f69fe(0xc68),_0x3f69fe(0x11cb)));}async function testApiConnection(){const _0x29fecf=_0x211817,_0x2b10fb=document['getElementById']('api-base')['value'][_0x29fecf(0x19d7)](),_0x3d3fe8=document[_0x29fecf(0x1262)]('api-key')['value']['trim'](),_0x36dc7d=document['getElementById'](_0x29fecf(0xeb1))[_0x29fecf(0x1ebc)]['trim']();if(!_0x2b10fb||!_0x3d3fe8||!_0x36dc7d){showToast(_0x29fecf(0x1a0a),_0x29fecf(0x174a));return;}const _0x5f41bf=document[_0x29fecf(0x1262)]('test-api-connection-btn'),_0xb05b83=_0x5f41bf[_0x29fecf(0x13be)];_0x5f41bf[_0x29fecf(0x13be)]=_0x29fecf(0x1a43),_0x5f41bf[_0x29fecf(0x559)]=!![];try{let _0x152c76,_0x45ba1d,_0x107f9a;if(_0x2b10fb[_0x29fecf(0x1831)](_0x29fecf(0x1d80)))_0x152c76=_0x2b10fb+_0x29fecf(0x1107)+_0x36dc7d+_0x29fecf(0x40c)+_0x3d3fe8,_0x45ba1d={'contents':[{'parts':[{'text':'Hello'}]}],'generationConfig':{'temperature':0.7}},_0x107f9a={'Content-Type':_0x29fecf(0x1b82)};else{if(_0x2b10fb[_0x29fecf(0x81f)](_0x29fecf(0x1439)))_0x152c76=_0x2b10fb+'/chat/completions';else _0x2b10fb[_0x29fecf(0x1831)](_0x29fecf(0x1dac))?_0x152c76=_0x2b10fb+_0x29fecf(0x1bea):_0x152c76=_0x2b10fb+_0x29fecf(0x666);_0x45ba1d={'model':_0x36dc7d,'messages':[{'role':_0x29fecf(0xa80),'content':_0x29fecf(0x1dcb)}],'max_tokens':0xa},_0x107f9a={'Content-Type':_0x29fecf(0x1b82),'Authorization':_0x29fecf(0x1e3c)+_0x3d3fe8};}const _0x4c4b25=await fetch(_0x152c76,{'method':_0x29fecf(0x1dd5),'headers':_0x107f9a,'body':JSON['stringify'](_0x45ba1d)});if(_0x4c4b25['ok']){showToast(_0x29fecf(0x14e9),_0x29fecf(0x11cb)),apiSettings={'base':_0x2b10fb,'key':_0x3d3fe8,'model':_0x36dc7d,'temperature':parseFloat(document[_0x29fecf(0x1262)](_0x29fecf(0x2304))[_0x29fecf(0x1ebc)])||0.75,'endpoint':_0x29fecf(0x1bea)};try{await db[_0x29fecf(0x1f0c)]['put']({'id':_0x29fecf(0x11d7),'settings':apiSettings}),localStorage[_0x29fecf(0x192)](_0x29fecf(0x1f0c),JSON[_0x29fecf(0x6b8)](apiSettings)),console[_0x29fecf(0x2187)](_0x29fecf(0x1368));}catch(_0x26a49e){console['error'](_0x29fecf(0x2265),_0x26a49e);}}else{const _0x27a9dc=await _0x4c4b25[_0x29fecf(0x1378)]();showToast(_0x29fecf(0x1edf)+_0x4c4b25[_0x29fecf(0x12e2)]+'\x20'+_0x4c4b25['statusText'],_0x29fecf(0x174a)),console[_0x29fecf(0x174a)](_0x29fecf(0x1be9),_0x27a9dc);}}catch(_0x25d075){showToast(_0x29fecf(0x467)+_0x25d075[_0x29fecf(0x1e8e)],'error'),console['error'](_0x29fecf(0x580),_0x25d075);}finally{_0x5f41bf[_0x29fecf(0x13be)]=_0xb05b83,_0x5f41bf[_0x29fecf(0x559)]=![];}}async function fetchModels(){const _0x35cc7e=_0x211817,_0x59963b=document[_0x35cc7e(0x1262)](_0x35cc7e(0x1b2))['value'][_0x35cc7e(0x19d7)](),_0x44ccd8=document[_0x35cc7e(0x1262)]('api-key')[_0x35cc7e(0x1ebc)][_0x35cc7e(0x19d7)]();if(!_0x59963b||!_0x44ccd8){showToast(_0x35cc7e(0x1f3d),_0x35cc7e(0x174a));return;}const _0x5ad171=document[_0x35cc7e(0x1262)](_0x35cc7e(0xa1b)),_0xa95cec=_0x5ad171[_0x35cc7e(0x13be)];_0x5ad171['textContent']=_0x35cc7e(0x1121),_0x5ad171[_0x35cc7e(0x559)]=!![];try{let _0x417d4e,_0x21c710;if(_0x59963b[_0x35cc7e(0x1831)](_0x35cc7e(0x1d80)))_0x417d4e=_0x59963b+'/models?key='+_0x44ccd8,_0x21c710={};else{if(_0x59963b[_0x35cc7e(0x81f)](_0x35cc7e(0x1439)))_0x417d4e=_0x59963b+'/models';else _0x59963b[_0x35cc7e(0x1831)](_0x35cc7e(0x1dac))?_0x417d4e=_0x59963b+'/models':_0x417d4e=_0x59963b+'/v1/models';_0x21c710={'Authorization':_0x35cc7e(0x1e3c)+_0x44ccd8};}const _0x562511=await fetch(_0x417d4e,{'headers':_0x21c710});if(!_0x562511['ok'])throw new Error(_0x35cc7e(0x21bb)+_0x562511['status']+':\x20'+_0x562511[_0x35cc7e(0x2035)]);const _0xe59369=await _0x562511[_0x35cc7e(0xe52)](),_0x425f41=document[_0x35cc7e(0x1262)]('model-select');_0x425f41[_0x35cc7e(0x33a)]=_0x35cc7e(0x1ea6);let _0xc179b5=[];if(_0xe59369[_0x35cc7e(0x97c)])console[_0x35cc7e(0x2187)](_0x35cc7e(0x1c95),_0xe59369),_0xc179b5=_0xe59369[_0x35cc7e(0x97c)][_0x35cc7e(0x1e1f)](_0x3dcd15=>{const _0x31af6f=_0x35cc7e;return _0x3dcd15[_0x31af6f(0x1a1c)]&&(_0x3dcd15[_0x31af6f(0x1a1c)][_0x31af6f(0x1831)](_0x31af6f(0x16a6))||_0x3dcd15[_0x31af6f(0x1a1c)][_0x31af6f(0x1831)]('models/')||_0x3dcd15[_0x31af6f(0x229f)]?.[_0x31af6f(0x1831)](_0x31af6f(0x1b8f))||_0x3dcd15[_0x31af6f(0x1a1c)][_0x31af6f(0x1831)](_0x31af6f(0x111a)));})[_0x35cc7e(0x6a4)](_0x567d75=>{const _0x51726c=_0x35cc7e,_0x412298=_0x567d75['name'][_0x51726c(0x1831)]('/')?_0x567d75[_0x51726c(0x1a1c)][_0x51726c(0x204b)]('/')[_0x51726c(0xa1a)]():_0x567d75[_0x51726c(0x1a1c)];return _0x412298;}),_0xc179b5[_0x35cc7e(0x19ee)]===0x0&&_0xe59369[_0x35cc7e(0x97c)]['length']>0x0&&(console['log'](_0x35cc7e(0x16e4),_0xe59369['models']),_0xc179b5=_0xe59369[_0x35cc7e(0x97c)][_0x35cc7e(0x6a4)](_0x2cc764=>_0x2cc764[_0x35cc7e(0x1a1c)]['includes']('/')?_0x2cc764[_0x35cc7e(0x1a1c)][_0x35cc7e(0x204b)]('/')[_0x35cc7e(0xa1a)]():_0x2cc764[_0x35cc7e(0x1a1c)]));else _0xe59369['data']&&(_0xc179b5=_0xe59369[_0x35cc7e(0x22c0)][_0x35cc7e(0x6a4)](_0x5cb176=>_0x5cb176['id']));_0xc179b5['forEach'](_0x4263b1=>{const _0x3106e7=_0x35cc7e,_0x1460ec=new Option(_0x4263b1,_0x4263b1);_0x425f41[_0x3106e7(0x497)](_0x1460ec);}),showToast(_0x35cc7e(0x83b)+_0xc179b5[_0x35cc7e(0x19ee)]+_0x35cc7e(0x22a5),_0x35cc7e(0x11cb));}catch(_0x328b12){let _0x5870d8=_0x328b12[_0x35cc7e(0x1e8e)];(_0x5870d8[_0x35cc7e(0x1831)](_0x35cc7e(0x981))||_0x5870d8['includes'](_0x35cc7e(0x1e15)))&&(_0x59963b[_0x35cc7e(0x1831)](_0x35cc7e(0x1315))?_0x5870d8=_0x35cc7e(0x1876):_0x5870d8=_0x35cc7e(0x1c20));showToast(_0x35cc7e(0x1d35)+_0x5870d8,'error'),console[_0x35cc7e(0x174a)](_0x35cc7e(0x1b88),_0x328b12);if(_0x59963b[_0x35cc7e(0x1831)]('generativelanguage.googleapis.com')){const _0x53c3ee=document['getElementById'](_0x35cc7e(0xeb1));_0x53c3ee[_0x35cc7e(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-2.0-flash-exp\x22>Gemini\x202.0\x20Flash\x20(实验版)</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash\x22>Gemini\x201.5\x20Flash</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash-8b\x22>Gemini\x201.5\x20Flash\x208B</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-pro\x22>Gemini\x201.5\x20Pro</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro\x22>Gemini\x20Pro</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro-vision\x22>Gemini\x20Pro\x20Vision</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22手动输入模型名称\x22>手动输入模型名称</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',setTimeout(()=>{const _0x2a33cd=_0x35cc7e;showToast('💡\x20已为您提供常见Gemini模型选项',_0x2a33cd(0x477));},0x3e8);}_0x59963b[_0x35cc7e(0x1831)](_0x35cc7e(0x1315))&&setTimeout(()=>{const _0x5bffef=_0x35cc7e;showToast('💡\x20提示：HuggingFace\x20Space可能不支持自动获取模型列表，建议手动输入模型名称',_0x5bffef(0x477));},0x7d0);}finally{_0x5ad171['textContent']=_0xa95cec,_0x5ad171[_0x35cc7e(0x559)]=![];}}function exportFullBackup(){const _0x464fab=_0x211817;showToast(_0x464fab(0xf27),_0x464fab(0x477));}function importFullBackup(){const _0x51bf40=_0x211817;document[_0x51bf40(0x1262)](_0x51bf40(0x135a))['click']();}async function initializeApiSettings(){await loadApiSettingsToForm(),renderSavedConfigs();}async function loadApiSettingsToForm(){const _0x24bee8=_0x211817;try{const _0x16ff55=await db[_0x24bee8(0x1f0c)][_0x24bee8(0xb78)](_0x24bee8(0x11d7));let _0xefaf79=null;if(_0x16ff55)_0xefaf79=_0x16ff55[_0x24bee8(0x1512)];else{const _0x28c3de=localStorage[_0x24bee8(0x15d8)]('apiSettings');_0x28c3de&&(_0xefaf79=JSON[_0x24bee8(0x22d3)](_0x28c3de),await db[_0x24bee8(0x1f0c)]['put']({'id':_0x24bee8(0x11d7),'settings':_0xefaf79}),console[_0x24bee8(0x2187)](_0x24bee8(0x1e3)));}if(_0xefaf79){console['log'](_0x24bee8(0xff8),_0xefaf79);if(_0xefaf79['base']){const _0x40e958=document['getElementById'](_0x24bee8(0x1b2));if(_0x40e958)_0x40e958['value']=_0xefaf79[_0x24bee8(0x1208)];}if(_0xefaf79[_0x24bee8(0x213c)]){const _0x3d99bd=document['getElementById'](_0x24bee8(0x185c));if(_0x3d99bd)_0x3d99bd[_0x24bee8(0x1ebc)]=_0xefaf79[_0x24bee8(0x213c)];}if(_0xefaf79['temperature']!==undefined){const _0x3caf67=document[_0x24bee8(0x1262)](_0x24bee8(0x2304)),_0x2df9ba=document['getElementById'](_0x24bee8(0x854));_0x3caf67&&_0x2df9ba&&(_0x3caf67[_0x24bee8(0x1ebc)]=_0xefaf79[_0x24bee8(0x11c5)],_0x2df9ba['textContent']=_0xefaf79['temperature']['toFixed'](0x2));}const _0x56b1d6=document[_0x24bee8(0x1262)](_0x24bee8(0x8f4));_0x56b1d6&&(_0x56b1d6[_0x24bee8(0x14c1)]=_0xefaf79[_0x24bee8(0x9dd)]!==![]);if(_0xefaf79[_0x24bee8(0x1208)]&&_0xefaf79[_0x24bee8(0x213c)])console[_0x24bee8(0x2187)]('🔧\x20[API设置]\x20检测到完整的API配置，自动拉取模型列表'),setTimeout(()=>{const _0x10e6dd=_0x24bee8;fetchModels()[_0x10e6dd(0x63d)](()=>{const _0x3da48c=_0x10e6dd;if(_0xefaf79[_0x3da48c(0x1976)]){const _0x714cfe=document['getElementById']('model-select');if(_0x714cfe){const _0x5664ba=Array[_0x3da48c(0x13c0)](_0x714cfe[_0x3da48c(0x4cd)])[_0x3da48c(0xaf4)](_0x34c1c6=>_0x34c1c6[_0x3da48c(0x1ebc)]===_0xefaf79[_0x3da48c(0x1976)]);if(!_0x5664ba){const _0x19952c=new Option(_0xefaf79[_0x3da48c(0x1976)],_0xefaf79[_0x3da48c(0x1976)]);_0x714cfe[_0x3da48c(0x497)](_0x19952c);}_0x714cfe[_0x3da48c(0x1ebc)]=_0xefaf79['model'],console[_0x3da48c(0x2187)](_0x3da48c(0xa34),_0xefaf79[_0x3da48c(0x1976)]);}}})[_0x10e6dd(0x1c82)](_0xf21bed=>{const _0x18c3c5=_0x10e6dd;console[_0x18c3c5(0x2187)]('🔧\x20[API设置]\x20自动拉取模型失败，但会保留已保存的模型选项');if(_0xefaf79[_0x18c3c5(0x1976)]){const _0x517131=document[_0x18c3c5(0x1262)]('model-select');if(_0x517131){const _0x2cc510=Array[_0x18c3c5(0x13c0)](_0x517131[_0x18c3c5(0x4cd)])[_0x18c3c5(0xaf4)](_0xadc755=>_0xadc755['value']===_0xefaf79[_0x18c3c5(0x1976)]);if(!_0x2cc510){const _0x2aa9e7=new Option(_0xefaf79['model'],_0xefaf79[_0x18c3c5(0x1976)]);_0x517131[_0x18c3c5(0x497)](_0x2aa9e7);}_0x517131[_0x18c3c5(0x1ebc)]=_0xefaf79[_0x18c3c5(0x1976)],console[_0x18c3c5(0x2187)](_0x18c3c5(0x1fa3),_0xefaf79[_0x18c3c5(0x1976)]);}}});},0x1f4);else{if(_0xefaf79[_0x24bee8(0x1976)]){const _0xd2ca87=document['getElementById'](_0x24bee8(0xeb1));if(_0xd2ca87){const _0x3a71d4=Array[_0x24bee8(0x13c0)](_0xd2ca87['options'])[_0x24bee8(0xaf4)](_0x2d1a62=>_0x2d1a62[_0x24bee8(0x1ebc)]===_0xefaf79[_0x24bee8(0x1976)]);if(!_0x3a71d4){const _0x3d4f57=new Option(_0xefaf79['model'],_0xefaf79['model']);_0xd2ca87['appendChild'](_0x3d4f57);}_0xd2ca87[_0x24bee8(0x1ebc)]=_0xefaf79[_0x24bee8(0x1976)],console[_0x24bee8(0x2187)]('🔧\x20[API设置]\x20已恢复保存的模型选项（无自动拉取）:',_0xefaf79[_0x24bee8(0x1976)]);}}}}}catch(_0x33391e){console['error'](_0x24bee8(0xcbd),_0x33391e);}}async function initBatteryManager(){setFixedBatteryDisplay();}function setFixedBatteryDisplay(){const _0x6e62da=_0x211817,_0x5b581c=0x64,_0x31d67e=document['getElementById']('status-bar-battery');if(_0x31d67e){const _0x4fc687=_0x31d67e['querySelector']('.battery-level');_0x4fc687&&(_0x4fc687['style'][_0x6e62da(0x12f1)]=_0x5b581c+'%'),_0x31d67e[_0x6e62da(0x1c1b)]['remove'](_0x6e62da(0xc46));}const _0x1deef6=document[_0x6e62da(0x1897)]('.app-battery-container'),_0x55b40a=document[_0x6e62da(0x1897)]('.app-battery-level');_0x55b40a[_0x6e62da(0x19fb)](_0x4660ba=>{const _0x3c739b=_0x6e62da;_0x4660ba[_0x3c739b(0x14eb)][_0x3c739b(0x12f1)]=_0x5b581c+'%';}),_0x1deef6['forEach'](_0x16dc71=>{const _0x5b311c=_0x6e62da;_0x16dc71[_0x5b311c(0x1c1b)][_0x5b311c(0x1493)]('charging');});}function testBatteryDisplay(){const _0x54e2c6=_0x211817;console['log'](_0x54e2c6(0x1e9c)),setFixedBatteryDisplay(),console[_0x54e2c6(0x2187)](_0x54e2c6(0x1812));}async function changeTheme(_0x2bb7fa){const _0x43c18c=_0x211817,_0x5dbd25=document[_0x43c18c(0x1da9)];clearCustomThemeStyles(),clearGlobalCustomTheme(),_0x5dbd25['classList'][_0x43c18c(0x1493)](_0x43c18c(0x31b)),_0x5dbd25[_0x43c18c(0xdc4)](_0x43c18c(0xd98));_0x2bb7fa!==_0x43c18c(0x1094)&&_0x5dbd25[_0x43c18c(0x1058)](_0x43c18c(0xd98),_0x2bb7fa);try{await db[_0x43c18c(0x1dde)][_0x43c18c(0x1561)]({'id':_0x43c18c(0x18b9),'settingName':'selectedTheme','settingValue':_0x2bb7fa,'timestamp':Date[_0x43c18c(0x2eb)]()});}catch(_0x19bb6a){console[_0x43c18c(0x174a)]('❌\x20保存主题设置失败:',_0x19bb6a);}const _0x3434c1={'default':_0x43c18c(0x1747),'cute':_0x43c18c(0x1b5d),'dark':'夜间模式'};showToast(_0x43c18c(0xe87)+_0x3434c1[_0x2bb7fa]+_0x43c18c(0x151b),'success');}let customThemeData={'chatTopBg':null,'chatBottomBg':null,'buttons':{'back':null,'offline':null,'settings':null,'expand':null,'continue':null,'send':null},'globalTopAppBar':null,'globalBottomAppBar':null,'globalBackButton':null,'globalAddButton':null,'globalBg':null,'scope':'selected','selectedChats':[]},currentUploadType=null,currentUploadCallback=null,currentButtonType=null;function switchCustomThemeTab(_0x2d26df){const _0x494d2d=_0x211817;document[_0x494d2d(0x1897)](_0x494d2d(0x1ee0))['forEach'](_0x2301de=>{const _0x57cdff=_0x494d2d;_0x2301de['classList'][_0x57cdff(0x1493)](_0x57cdff(0x1a14));}),document[_0x494d2d(0x1897)](_0x494d2d(0x1ed8))[_0x494d2d(0x19fb)](_0x1e9b30=>{const _0x298c47=_0x494d2d;_0x1e9b30['style'][_0x298c47(0x4da)]=_0x298c47(0x102b);}),document[_0x494d2d(0xb30)]('.custom-theme-tab[onclick=\x22switchCustomThemeTab(\x27'+_0x2d26df+'\x27)\x22]')[_0x494d2d(0x1c1b)][_0x494d2d(0x21e2)]('active');if(_0x2d26df===_0x494d2d(0x1a70))document['getElementById'](_0x494d2d(0x1f09))[_0x494d2d(0x14eb)][_0x494d2d(0x4da)]=_0x494d2d(0x13de),loadChatSelectionList();else _0x2d26df===_0x494d2d(0x1dae)&&(document[_0x494d2d(0x1262)]('global-theme-content')[_0x494d2d(0x14eb)]['display']=_0x494d2d(0x13de));}function uploadChatTopBackground(){const _0x230df7=_0x211817;showImageUploadChoice('chat-top-bg',_0x230df7(0x156d));}function uploadChatBottomBackground(){const _0x564e1b=_0x211817;showImageUploadChoice(_0x564e1b(0x131d),_0x564e1b(0xebe));}function uploadButtonIcon(_0x719c4e){const _0x8b49e3=_0x211817;currentButtonType=_0x719c4e;const _0x5cf591={'back':'返回按钮','offline':_0x8b49e3(0x167c),'settings':'聊天设置按钮','expand':'功能区展开按钮','continue':_0x8b49e3(0xef5),'send':_0x8b49e3(0x5a9)};showImageUploadChoice('button-'+_0x719c4e,'选择'+_0x5cf591[_0x719c4e]+'样式来源');}function showImageUploadChoice(_0x21ddc4,_0x13d642,_0x2a42ee){const _0x4f6fc8=_0x211817;currentUploadType=_0x21ddc4,currentUploadCallback=_0x2a42ee,document[_0x4f6fc8(0x1262)](_0x4f6fc8(0x1bf9))[_0x4f6fc8(0x13be)]=_0x13d642||_0x4f6fc8(0x13c2),showModal(_0x4f6fc8(0xaa3));}function chooseLocalUpload(){const _0x266fb5=_0x211817;hideModal(_0x266fb5(0xaa3));switch(currentUploadType){case _0x266fb5(0x8fd):document['getElementById'](_0x266fb5(0xd12))[_0x266fb5(0x1859)]();break;case'global-bottom-app-bar':document['getElementById'](_0x266fb5(0xae2))[_0x266fb5(0x1859)]();break;case _0x266fb5(0x1c3f):document[_0x266fb5(0x1262)](_0x266fb5(0x14d2))[_0x266fb5(0x1859)]();break;case _0x266fb5(0x205d):document[_0x266fb5(0x1262)](_0x266fb5(0x75c))[_0x266fb5(0x1859)]();break;case _0x266fb5(0xd0b):document[_0x266fb5(0x1262)](_0x266fb5(0x2e0))['click']();break;case _0x266fb5(0xe3c):document['getElementById'](_0x266fb5(0xbf9))[_0x266fb5(0x1859)]();break;case _0x266fb5(0x131d):document[_0x266fb5(0x1262)](_0x266fb5(0x1aea))[_0x266fb5(0x1859)]();break;case'button-back':case _0x266fb5(0x113d):case _0x266fb5(0xd22):case _0x266fb5(0xf8d):case _0x266fb5(0xd23):case'button-send':document[_0x266fb5(0x1262)](_0x266fb5(0x11df))[_0x266fb5(0x1859)]();break;default:currentUploadCallback&&currentUploadCallback(_0x266fb5(0x14cc));break;}}function chooseUrlUpload(){const _0xc23f46=_0x211817;hideModal(_0xc23f46(0xaa3)),document['getElementById']('image-url-input')[_0xc23f46(0x1ebc)]='',document[_0xc23f46(0x1262)](_0xc23f46(0x2247))[_0xc23f46(0x14eb)][_0xc23f46(0x4da)]=_0xc23f46(0x102b),document['getElementById'](_0xc23f46(0x1fb2))[_0xc23f46(0x13be)]='输入'+getUploadTypeTitle(currentUploadType)+_0xc23f46(0xf93),showModal(_0xc23f46(0x1a29));const _0x5782ec=document[_0xc23f46(0x1262)]('image-url-input');_0x5782ec[_0xc23f46(0x20b1)]=function(){const _0x36ad2b=_0xc23f46,_0x1b2359=this['value'][_0x36ad2b(0x19d7)]();_0x1b2359&&isValidImageUrl(_0x1b2359)?showUrlPreview(_0x1b2359):hideUrlPreview();};}function getUploadTypeTitle(_0xf28297){const _0x5e741a=_0x211817,_0x463c22={'global-top-app-bar':'顶部应用栏背景','global-bottom-app-bar':_0x5e741a(0xb21),'global-back-button':'返回按钮','global-add-button':'添加按钮','global-bg':'全局背景','chat-top-bg':_0x5e741a(0x16fa),'chat-bottom-bg':_0x5e741a(0x53e),'button-back':'返回按钮','button-offline':_0x5e741a(0x167c),'button-settings':_0x5e741a(0x44b),'button-expand':_0x5e741a(0x15eb),'button-continue':_0x5e741a(0xef5),'button-send':'发送消息按钮'};return _0x463c22[_0xf28297]||'图片';}function isValidImageUrl(_0x4c665b){const _0x134c48=_0x211817;try{const _0xbd208b=new URL(_0x4c665b),_0x4cd39b=[_0x134c48(0x40b),_0x134c48(0x1ea0),_0x134c48(0x579),_0x134c48(0x2124),'cdn.discordapp.com',_0x134c48(0x1495)],_0x4a38ec=_0xbd208b[_0x134c48(0x6ab)],_0x13b68f=_0xbd208b[_0x134c48(0x65f)][_0x134c48(0x49e)](),_0x111bb6=[_0x134c48(0x2e9),'.jpeg',_0x134c48(0x1202),_0x134c48(0x72f),_0x134c48(0x1f44),_0x134c48(0xa4a)];return _0x4cd39b[_0x134c48(0x1831)](_0x4a38ec)||_0x111bb6[_0x134c48(0x19fa)](_0x51ee6e=>_0x13b68f['endsWith'](_0x51ee6e));}catch{return![];}}function showUrlPreview(_0x184f27){const _0x515cd3=_0x211817,_0x2a1967=document[_0x515cd3(0x1262)](_0x515cd3(0x2247)),_0x3f8df8=document['getElementById'](_0x515cd3(0x1fc3));_0x3f8df8[_0x515cd3(0xc55)]=function(){const _0x433d7e=_0x515cd3;_0x2a1967[_0x433d7e(0x14eb)][_0x433d7e(0x4da)]=_0x433d7e(0x13de);},_0x3f8df8['onerror']=function(){const _0x4e87b1=_0x515cd3;hideUrlPreview(),showToast(_0x4e87b1(0x1efc),_0x4e87b1(0x174a));},_0x3f8df8[_0x515cd3(0x45c)]=_0x184f27;}function hideUrlPreview(){const _0x389e20=_0x211817;document[_0x389e20(0x1262)](_0x389e20(0x2247))[_0x389e20(0x14eb)]['display']=_0x389e20(0x102b);}function confirmUrlUpload(){const _0x34c85d=_0x211817,_0x38b52d=document[_0x34c85d(0x1262)](_0x34c85d(0x16f4))[_0x34c85d(0x1ebc)]['trim']();if(!_0x38b52d){showToast(_0x34c85d(0x2185),_0x34c85d(0x1816));return;}if(!isValidImageUrl(_0x38b52d)){showToast(_0x34c85d(0x2283),_0x34c85d(0x1816));return;}hideModal('url-input-modal'),handleUrlUpload(_0x38b52d);}function handleUrlUpload(_0x3853d1){const _0x57a4fd=_0x211817;switch(currentUploadType){case _0x57a4fd(0x8fd):customThemeData[_0x57a4fd(0xb6f)]=_0x3853d1,updatePreview('global-top-app-bar-preview',_0x3853d1),updateThemeItemStatus('global-top-app-bar-item',!![]),showToast(_0x57a4fd(0x886),_0x57a4fd(0x11cb));break;case _0x57a4fd(0x32c):customThemeData[_0x57a4fd(0x1308)]=_0x3853d1,updatePreview(_0x57a4fd(0x144d),_0x3853d1),updateThemeItemStatus(_0x57a4fd(0xa5a),!![]),showToast(_0x57a4fd(0xc83),'success');break;case _0x57a4fd(0x1c3f):customThemeData[_0x57a4fd(0x1688)]=_0x3853d1,updatePreview('global-back-button-preview',_0x3853d1),updateThemeItemStatus(_0x57a4fd(0xd73),!![]),showToast(_0x57a4fd(0xddc),'success');break;case _0x57a4fd(0x205d):customThemeData[_0x57a4fd(0x13ba)]=_0x3853d1,updatePreview(_0x57a4fd(0x1ff),_0x3853d1),updateThemeItemStatus(_0x57a4fd(0x13b2),!![]),showToast(_0x57a4fd(0x1595),_0x57a4fd(0x11cb));break;case _0x57a4fd(0xd0b):customThemeData[_0x57a4fd(0x7f9)]=_0x3853d1,updatePreview(_0x57a4fd(0x1300),_0x3853d1),updateThemeItemStatus('global-bg-item',!![]),showToast(_0x57a4fd(0x412),'success');break;case'chat-top-bg':customThemeData[_0x57a4fd(0x99e)]=_0x3853d1,updatePreview(_0x57a4fd(0x1bfc),_0x3853d1),updateThemeItemStatus('chat-top-bg-item',!![]),showToast('聊天顶部背景已设置',_0x57a4fd(0x11cb));break;case _0x57a4fd(0x131d):customThemeData[_0x57a4fd(0xba1)]=_0x3853d1,updatePreview('chat-bottom-bg-preview',_0x3853d1),updateThemeItemStatus(_0x57a4fd(0x1f80),!![]),showToast(_0x57a4fd(0x678),_0x57a4fd(0x11cb));break;case'button-back':customThemeData[_0x57a4fd(0xe42)]['back']=_0x3853d1,updatePreview('back-btn-preview',_0x3853d1),updateThemeItemStatus(_0x57a4fd(0x1950),!![]),showToast(_0x57a4fd(0x1f5b),_0x57a4fd(0x11cb));break;case'button-offline':customThemeData[_0x57a4fd(0xe42)][_0x57a4fd(0x1d8d)]=_0x3853d1,updatePreview(_0x57a4fd(0x373),_0x3853d1),updateThemeItemStatus('offline-btn-item',!![]),showToast(_0x57a4fd(0x11ce),_0x57a4fd(0x11cb));break;case _0x57a4fd(0xd22):customThemeData['buttons'][_0x57a4fd(0x1512)]=_0x3853d1,updatePreview(_0x57a4fd(0x189c),_0x3853d1),updateThemeItemStatus('settings-btn-item',!![]),showToast(_0x57a4fd(0x22ee),'success');break;case _0x57a4fd(0xf8d):customThemeData[_0x57a4fd(0xe42)]['expand']=_0x3853d1,updatePreview('expand-btn-preview',_0x3853d1),updateThemeItemStatus(_0x57a4fd(0xcdc),!![]),showToast('功能区展开按钮样式已设置','success');break;case'button-continue':customThemeData[_0x57a4fd(0xe42)][_0x57a4fd(0x4db)]=_0x3853d1,updatePreview(_0x57a4fd(0x5b2),_0x3853d1),updateThemeItemStatus(_0x57a4fd(0x1767),!![]),showToast(_0x57a4fd(0xc6d),'success');break;case'button-send':customThemeData[_0x57a4fd(0xe42)]['send']=_0x3853d1,updatePreview(_0x57a4fd(0x1949),_0x3853d1),updateThemeItemStatus(_0x57a4fd(0xc49),!![]),showToast(_0x57a4fd(0x129f),_0x57a4fd(0x11cb));break;default:currentUploadCallback&&currentUploadCallback(_0x57a4fd(0x40f),_0x3853d1);break;}}function uploadGlobalTopAppBar(){const _0x4639dd=_0x211817;showImageUploadChoice(_0x4639dd(0x8fd),'选择顶部应用栏背景来源');}function uploadGlobalBottomAppBar(){const _0x5f3981=_0x211817;showImageUploadChoice(_0x5f3981(0x32c),_0x5f3981(0x10a2));}function uploadGlobalBackButton(){const _0x5a9c7a=_0x211817;showImageUploadChoice(_0x5a9c7a(0x1c3f),_0x5a9c7a(0x312));}function uploadGlobalAddButton(){const _0x2f58ea=_0x211817;showImageUploadChoice(_0x2f58ea(0x205d),_0x2f58ea(0x1e5e));}function uploadGlobalBackground(){const _0x9ae2c6=_0x211817;showImageUploadChoice(_0x9ae2c6(0xd0b),_0x9ae2c6(0x1faa));}function handleChatTopBgUpload(_0x5ee29f){const _0x45251d=_0x211817,_0x24a0a6=_0x5ee29f[_0x45251d(0x193d)][_0x45251d(0xf26)][0x0];if(_0x24a0a6){const _0x2bff7=new FileReader();_0x2bff7[_0x45251d(0xc55)]=function(_0x175b08){const _0x3049df=_0x45251d;customThemeData[_0x3049df(0x99e)]=_0x175b08[_0x3049df(0x193d)][_0x3049df(0x4ee)],updatePreview(_0x3049df(0x1bfc),_0x175b08[_0x3049df(0x193d)][_0x3049df(0x4ee)]),updateThemeItemStatus(_0x3049df(0x1e49),!![]),showToast(_0x3049df(0x210b),_0x3049df(0x11cb));},_0x2bff7[_0x45251d(0x127c)](_0x24a0a6);}}function handleChatBottomBgUpload(_0x89a86a){const _0x51950b=_0x211817,_0x35f0f4=_0x89a86a[_0x51950b(0x193d)]['files'][0x0];if(_0x35f0f4){const _0xdab6bb=new FileReader();_0xdab6bb[_0x51950b(0xc55)]=function(_0xa2c13f){const _0x363f13=_0x51950b;customThemeData[_0x363f13(0xba1)]=_0xa2c13f['target']['result'],updatePreview(_0x363f13(0xbbb),_0xa2c13f['target'][_0x363f13(0x4ee)]),updateThemeItemStatus(_0x363f13(0x1f80),!![]),showToast(_0x363f13(0x1087),_0x363f13(0x11cb));},_0xdab6bb[_0x51950b(0x127c)](_0x35f0f4);}}function handleButtonIconUpload(_0x5178a6){const _0x5ce9b7=_0x211817,_0x23c607=_0x5178a6['target']['files'][0x0];if(_0x23c607&&currentButtonType){const _0x21f1c5=new FileReader();_0x21f1c5[_0x5ce9b7(0xc55)]=function(_0x363c5c){const _0x2c05c3=_0x5ce9b7;customThemeData['buttons'][currentButtonType]=_0x363c5c['target'][_0x2c05c3(0x4ee)],updatePreview(currentButtonType+_0x2c05c3(0x8ee),_0x363c5c[_0x2c05c3(0x193d)][_0x2c05c3(0x4ee)]),updateThemeItemStatus(currentButtonType+_0x2c05c3(0x1ca6),!![]);const _0x22b80e={'back':_0x2c05c3(0x5d2),'offline':'线下模式按钮','settings':_0x2c05c3(0x44b),'expand':'功能区展开按钮','continue':_0x2c05c3(0xef5),'send':_0x2c05c3(0x5a9)};showToast(_0x22b80e[currentButtonType]+_0x2c05c3(0xbab),'success'),currentButtonType=null;},_0x21f1c5[_0x5ce9b7(0x127c)](_0x23c607);}}function updateThemeItemStatus(_0x286598,_0xd60973){const _0x44d19b=_0x211817,_0x483641=document[_0x44d19b(0x1262)](_0x286598);if(!_0x483641)return;const _0x2db7d6=_0x483641[_0x44d19b(0xb30)](_0x44d19b(0x1581));_0xd60973?(_0x483641[_0x44d19b(0x1c1b)][_0x44d19b(0x21e2)]('theme-item-configured'),_0x2db7d6&&(_0x2db7d6['style'][_0x44d19b(0x4da)]='flex')):(_0x483641[_0x44d19b(0x1c1b)]['remove']('theme-item-configured'),_0x2db7d6&&(_0x2db7d6[_0x44d19b(0x14eb)][_0x44d19b(0x4da)]='none'));}function clearAllThemeItemStatus(){const _0x2f8d59=_0x211817,_0x2cdfb2=document['querySelectorAll'](_0x2f8d59(0x1b20));_0x2cdfb2[_0x2f8d59(0x19fb)](_0x47c4ee=>{const _0x32428d=_0x2f8d59;_0x47c4ee[_0x32428d(0x1c1b)][_0x32428d(0x1493)](_0x32428d(0xb7b));const _0x3d3622=_0x47c4ee[_0x32428d(0xb30)](_0x32428d(0x1581));_0x3d3622&&(_0x3d3622[_0x32428d(0x14eb)][_0x32428d(0x4da)]=_0x32428d(0x102b));});}function handleGlobalTopAppBarUpload(_0x486363){const _0x584ba3=_0x211817,_0x239ee9=_0x486363[_0x584ba3(0x193d)]['files'][0x0];if(_0x239ee9){const _0x1acaed=new FileReader();_0x1acaed[_0x584ba3(0xc55)]=function(_0x8c6399){const _0x3d31f5=_0x584ba3;customThemeData[_0x3d31f5(0xb6f)]=_0x8c6399[_0x3d31f5(0x193d)][_0x3d31f5(0x4ee)],updatePreview('global-top-app-bar-preview',_0x8c6399[_0x3d31f5(0x193d)][_0x3d31f5(0x4ee)]),updateThemeItemStatus(_0x3d31f5(0x1ae5),!![]),console[_0x3d31f5(0x2187)](_0x3d31f5(0x1b41),_0x8c6399[_0x3d31f5(0x193d)][_0x3d31f5(0x4ee)]),showToast(_0x3d31f5(0x7b5),_0x3d31f5(0x11cb));},_0x1acaed[_0x584ba3(0x127c)](_0x239ee9);}}function handleGlobalBottomAppBarUpload(_0x38a35d){const _0x221a8d=_0x211817,_0x196903=_0x38a35d['target'][_0x221a8d(0xf26)][0x0];if(_0x196903){const _0x2f8860=new FileReader();_0x2f8860['onload']=function(_0x50a5aa){const _0x544b33=_0x221a8d;customThemeData[_0x544b33(0x1308)]=_0x50a5aa['target']['result'],updatePreview(_0x544b33(0x144d),_0x50a5aa[_0x544b33(0x193d)]['result']),updateThemeItemStatus(_0x544b33(0xa5a),!![]),showToast('全局底部应用栏背景已上传','success');},_0x2f8860[_0x221a8d(0x127c)](_0x196903);}}function handleGlobalBackButtonUpload(_0x3afce4){const _0xdb7ec8=_0x211817,_0x1e00df=_0x3afce4[_0xdb7ec8(0x193d)][_0xdb7ec8(0xf26)][0x0];if(_0x1e00df){const _0x2eb54c=new FileReader();_0x2eb54c[_0xdb7ec8(0xc55)]=function(_0x4d32e4){const _0x1e931f=_0xdb7ec8;customThemeData[_0x1e931f(0x1688)]=_0x4d32e4['target'][_0x1e931f(0x4ee)],updatePreview(_0x1e931f(0x1043),_0x4d32e4[_0x1e931f(0x193d)][_0x1e931f(0x4ee)]),updateThemeItemStatus(_0x1e931f(0xd73),!![]),showToast(_0x1e931f(0x132f),'success');},_0x2eb54c[_0xdb7ec8(0x127c)](_0x1e00df);}}function handleGlobalAddButtonUpload(_0xfa3a99){const _0x11ab46=_0x211817,_0x5eb16d=_0xfa3a99[_0x11ab46(0x193d)][_0x11ab46(0xf26)][0x0];if(_0x5eb16d){const _0x5cd0a1=new FileReader();_0x5cd0a1[_0x11ab46(0xc55)]=function(_0x59cad6){const _0x2d08d5=_0x11ab46;customThemeData[_0x2d08d5(0x13ba)]=_0x59cad6[_0x2d08d5(0x193d)][_0x2d08d5(0x4ee)],updatePreview(_0x2d08d5(0x1ff),_0x59cad6['target']['result']),updateThemeItemStatus('global-add-button-item',!![]),showToast(_0x2d08d5(0x6d4),'success');},_0x5cd0a1['readAsDataURL'](_0x5eb16d);}}function handleGlobalBgUpload(_0x4168ee){const _0x17a6e8=_0x211817,_0x47f7b0=_0x4168ee[_0x17a6e8(0x193d)]['files'][0x0];if(_0x47f7b0){const _0xb4c4f6=new FileReader();_0xb4c4f6[_0x17a6e8(0xc55)]=function(_0x3cceda){const _0x44ece8=_0x17a6e8;customThemeData[_0x44ece8(0x7f9)]=_0x3cceda[_0x44ece8(0x193d)][_0x44ece8(0x4ee)],updatePreview(_0x44ece8(0x1300),_0x3cceda[_0x44ece8(0x193d)][_0x44ece8(0x4ee)]),updateThemeItemStatus(_0x44ece8(0x1313),!![]),showToast(_0x44ece8(0x116d),_0x44ece8(0x11cb));},_0xb4c4f6[_0x17a6e8(0x127c)](_0x47f7b0);}}function clearGlobalThemeCache(){const _0x45442d=_0x211817;globalThemeCache=null,globalThemeCacheTime=0x0,console[_0x45442d(0x2187)](_0x45442d(0xf11));}async function saveAndApplyGlobalTheme(){const _0xe2bf69=_0x211817;try{const _0x59adcb={'globalTopAppBar':customThemeData[_0xe2bf69(0xb6f)],'globalBottomAppBar':customThemeData[_0xe2bf69(0x1308)],'globalBackButton':customThemeData['globalBackButton'],'globalAddButton':customThemeData['globalAddButton'],'globalBg':customThemeData[_0xe2bf69(0x7f9)]};await db['globalThemes'][_0xe2bf69(0x1561)]({'id':'global','themeType':_0xe2bf69(0x1dae),'themeData':_0x59adcb,'timestamp':Date[_0xe2bf69(0x2eb)]()}),clearGlobalThemeCache(),applyGlobalCustomTheme(_0x59adcb),console[_0xe2bf69(0x2187)](_0xe2bf69(0x814));}catch(_0x4b0850){console['error'](_0xe2bf69(0x947),_0x4b0850),showToast(_0xe2bf69(0x12ab),_0xe2bf69(0x174a));}}let globalThemeCache=null,globalThemeCacheTime=0x0;const GLOBAL_THEME_CACHE_DURATION=0x7530,imagePreloadCache=new Map(),MAX_IMAGE_CACHE_SIZE=0x32;function preloadImage(_0x18c2da){return new Promise((_0x4ff6fa,_0x312ff5)=>{const _0x20e68a=_0x167f;if(imagePreloadCache[_0x20e68a(0x975)](_0x18c2da)){_0x4ff6fa(imagePreloadCache[_0x20e68a(0xb78)](_0x18c2da));return;}const _0x1d857d=new Image();_0x1d857d[_0x20e68a(0xc55)]=()=>{const _0xfb539e=_0x20e68a;if(imagePreloadCache[_0xfb539e(0x2d8)]>=MAX_IMAGE_CACHE_SIZE){const _0x3b766c=imagePreloadCache['keys']()[_0xfb539e(0x22a0)]()[_0xfb539e(0x1ebc)];imagePreloadCache['delete'](_0x3b766c);}imagePreloadCache[_0xfb539e(0x83c)](_0x18c2da,_0x1d857d),_0x4ff6fa(_0x1d857d);},_0x1d857d[_0x20e68a(0x21ec)]=()=>{const _0x30336e=_0x20e68a;console['warn'](_0x30336e(0xb26),_0x18c2da),_0x312ff5(new Error(_0x30336e(0x13db)+_0x18c2da));},_0x1d857d['src']=_0x18c2da;});}async function applyGlobalCustomTheme(_0x489986=null){const _0x23d240=_0x211817,_0x205a14=document['documentElement'];if(!_0x489986){const _0x30ef8d=Date[_0x23d240(0x2eb)]();if(globalThemeCache&&_0x30ef8d-globalThemeCacheTime<GLOBAL_THEME_CACHE_DURATION)_0x489986=globalThemeCache,console['log'](_0x23d240(0x3cd));else try{const _0x1354aa=await db[_0x23d240(0x1155)][_0x23d240(0xb78)]('global');if(_0x1354aa&&_0x1354aa[_0x23d240(0xfa8)])_0x489986=_0x1354aa[_0x23d240(0xfa8)],globalThemeCache=_0x489986,globalThemeCacheTime=_0x30ef8d,console['log'](_0x23d240(0x20ce));else{console[_0x23d240(0x2187)](_0x23d240(0x37d));return;}}catch(_0x1d9dc5){console[_0x23d240(0x174a)](_0x23d240(0x1277),_0x1d9dc5);return;}}clearGlobalCustomTheme();const _0x1e63a2=[];if(_0x489986[_0x23d240(0xb6f)])_0x1e63a2['push'](_0x489986['globalTopAppBar']);if(_0x489986[_0x23d240(0x1308)])_0x1e63a2[_0x23d240(0x1cd6)](_0x489986[_0x23d240(0x1308)]);if(_0x489986[_0x23d240(0x1688)])_0x1e63a2[_0x23d240(0x1cd6)](_0x489986[_0x23d240(0x1688)]);if(_0x489986['globalAddButton'])_0x1e63a2[_0x23d240(0x1cd6)](_0x489986[_0x23d240(0x13ba)]);if(_0x489986['globalBg'])_0x1e63a2[_0x23d240(0x1cd6)](_0x489986['globalBg']);try{await Promise[_0x23d240(0x1a47)](_0x1e63a2[_0x23d240(0x6a4)](_0xb8e21=>preloadImage(_0xb8e21))),console['log'](_0x23d240(0x1c91));}catch(_0x26b914){console[_0x23d240(0x1f43)](_0x23d240(0x1d4a),_0x26b914);}const _0x214c31=new Set();_0x489986['globalTopAppBar']&&(_0x205a14[_0x23d240(0x14eb)][_0x23d240(0xcf0)](_0x23d240(0x147e),_0x23d240(0x9f1)+_0x489986[_0x23d240(0xb6f)]+')'),_0x214c31[_0x23d240(0x21e2)](_0x23d240(0x1974)),console[_0x23d240(0x2187)]('🎨\x20设置CSS变量\x20--custom-global-top-app-bar:',_0x23d240(0x9f1)+_0x489986[_0x23d240(0xb6f)]+')'));_0x489986['globalBottomAppBar']&&(_0x205a14[_0x23d240(0x14eb)][_0x23d240(0xcf0)]('--custom-global-bottom-app-bar',_0x23d240(0x9f1)+_0x489986[_0x23d240(0x1308)]+')'),_0x214c31[_0x23d240(0x21e2)](_0x23d240(0x1957)));_0x489986['globalBackButton']&&(_0x205a14[_0x23d240(0x14eb)][_0x23d240(0xcf0)]('--custom-global-back-button',_0x23d240(0x9f1)+_0x489986[_0x23d240(0x1688)]+')'),_0x214c31[_0x23d240(0x21e2)]('back-button'));_0x489986['globalAddButton']&&(_0x205a14['style']['setProperty']('--custom-global-add-button',_0x23d240(0x9f1)+_0x489986[_0x23d240(0x13ba)]+')'),_0x214c31['add'](_0x23d240(0xc60)));_0x489986[_0x23d240(0x7f9)]&&(_0x205a14['style'][_0x23d240(0xcf0)](_0x23d240(0x74c),_0x23d240(0x9f1)+_0x489986[_0x23d240(0x7f9)]+')'),_0x214c31[_0x23d240(0x21e2)]('bg'));const _0x5b64e7=[_0x23d240(0x1974),'bottom-app-bar',_0x23d240(0x1fe6),'add-button','bg'];_0x5b64e7[_0x23d240(0x19fb)](_0xeb4df8=>{const _0x43c831=_0x23d240;_0x214c31['has'](_0xeb4df8)?document['body'][_0x43c831(0x1058)](_0x43c831(0xd65)+_0xeb4df8,_0x43c831(0x1098)):document[_0x43c831(0x1da9)]['removeAttribute']('data-has-custom-global-'+_0xeb4df8);}),document['body'][_0x23d240(0x1c1b)][_0x23d240(0x21e2)]('custom-theme-applied'),console['log'](_0x23d240(0xf14)),console[_0x23d240(0x2187)](_0x23d240(0x2b7),_0x214c31),console['log'](_0x23d240(0x13cc),document[_0x23d240(0x1da9)][_0x23d240(0x1722)]),console[_0x23d240(0x2187)]('🎨\x20body属性:',Array[_0x23d240(0x13c0)](document[_0x23d240(0x1da9)]['attributes'])['map'](_0xde9d6c=>_0xde9d6c[_0x23d240(0x1a1c)]+'=\x22'+_0xde9d6c[_0x23d240(0x1ebc)]+'\x22'));}function clearGlobalCustomTheme(){const _0x2331d5=_0x211817;console[_0x2331d5(0x2187)]('🎨\x20开始清除全局自定义主题样式...');const _0x446a67=document['documentElement'],_0x168450=[_0x2331d5(0x147e),_0x2331d5(0x1619),_0x2331d5(0x18af),'--custom-global-add-button',_0x2331d5(0x74c)];_0x168450[_0x2331d5(0x19fb)](_0x5a9b93=>{const _0x29cc9a=_0x2331d5;_0x446a67['style'][_0x29cc9a(0x1674)](_0x5a9b93);});const _0x3b7aef=[_0x2331d5(0x1974),_0x2331d5(0x1957),_0x2331d5(0x1fe6),'add-button','bg'];_0x3b7aef[_0x2331d5(0x19fb)](_0x5870eb=>{const _0x40ecc6=_0x2331d5;document[_0x40ecc6(0x1da9)][_0x40ecc6(0xdc4)]('data-has-custom-global-'+_0x5870eb);}),console[_0x2331d5(0x2187)]('🎨\x20全局自定义主题样式清除完成');}function updatePreview(_0x571c70,_0x5e6b6c){const _0x4c059c=_0x211817,_0x50b8cd=document[_0x4c059c(0x1262)](_0x571c70);_0x50b8cd&&(_0x50b8cd[_0x4c059c(0x14eb)]['backgroundImage']=_0x4c059c(0x9f1)+_0x5e6b6c+')',_0x50b8cd[_0x4c059c(0x1c1b)]['add'](_0x4c059c(0x14fb)));}function loadChatSelectionList(){const _0x473b15=_0x211817,_0x446024=document[_0x473b15(0x1262)](_0x473b15(0x2b5));if(!_0x446024)return;const _0x250f11=[];characters&&characters[_0x473b15(0x19ee)]>0x0&&contacts&&contacts[_0x473b15(0x19ee)]>0x0&&characters['forEach'](_0x36f291=>{const _0x6f5a58=_0x473b15;contacts[_0x6f5a58(0x1831)](_0x36f291['id'])&&_0x250f11[_0x6f5a58(0x1cd6)]({'id':_0x36f291['id'],'name':_0x36f291[_0x6f5a58(0x1a1c)],'avatarUrl':_0x36f291[_0x6f5a58(0x1994)],'isGroup':![]});});groupChats&&groupChats[_0x473b15(0x19ee)]>0x0&&groupChats[_0x473b15(0x19fb)](_0x39cfd2=>{const _0x2910b7=_0x473b15;_0x250f11['push']({'id':_0x39cfd2['id'],'name':_0x39cfd2['name'],'avatarUrl':_0x39cfd2[_0x2910b7(0x1994)],'isGroup':!![]});});console[_0x473b15(0x2187)](_0x473b15(0x851)),console['log'](_0x473b15(0x2118),characters?.['length']||0x0),console[_0x473b15(0x2187)](_0x473b15(0x1b4),contacts?.[_0x473b15(0x19ee)]||0x0),console[_0x473b15(0x2187)]('\x20\x20-\x20群聊数量:',groupChats?.['length']||0x0),console['log'](_0x473b15(0xe89),_0x250f11);let _0x53d7e1='';_0x250f11['forEach'](_0x52e79f=>{const _0x45945a=_0x473b15,_0x4aa8a4=customThemeData[_0x45945a(0x16c1)]['includes'](_0x52e79f['id']),_0x40c4fc=_0x52e79f[_0x45945a(0x1994)]?'background-image:\x20url('+_0x52e79f[_0x45945a(0x1994)]+')':'';let _0x3a7ebb=_0x52e79f[_0x45945a(0x1f68)]?_0x45945a(0x3a3):'fas\x20fa-user';_0x53d7e1+=_0x45945a(0x21a0)+(_0x4aa8a4?_0x45945a(0x176b):'')+_0x45945a(0xdb4)+_0x52e79f['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4aa8a4?_0x45945a(0xd31):'')+_0x45945a(0x1507)+_0x40c4fc+_0x45945a(0x1ada)+(!_0x52e79f[_0x45945a(0x1994)]?_0x45945a(0x660)+_0x3a7ebb+_0x45945a(0x12c7):'')+_0x45945a(0x1f93)+_0x52e79f[_0x45945a(0x1a1c)]+_0x45945a(0x1c0b)+(_0x52e79f[_0x45945a(0x1f68)]?'群聊':'私聊')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}),_0x53d7e1===''&&(_0x53d7e1=_0x473b15(0x47a)),_0x446024[_0x473b15(0x33a)]=_0x53d7e1;}function toggleChatSelection(_0x44f2fa){const _0x409966=_0x211817,_0x4872ae=customThemeData[_0x409966(0x16c1)]['indexOf'](_0x44f2fa);_0x4872ae>-0x1?customThemeData['selectedChats'][_0x409966(0x19b2)](_0x4872ae,0x1):customThemeData[_0x409966(0x16c1)][_0x409966(0x1cd6)](_0x44f2fa),loadChatSelectionList();}document['addEventListener'](_0x211817(0x20dc),function(){document['addEventListener']('click',function(_0x2e74e8){const _0x17c396=_0x167f;if(_0x2e74e8[_0x17c396(0x193d)][_0x17c396(0x216a)](_0x17c396(0x20c))){const _0x529882=_0x2e74e8[_0x17c396(0x193d)][_0x17c396(0x216a)](_0x17c396(0x20c)),_0x1dd26c=_0x529882[_0x17c396(0x1ecd)][_0x17c396(0x16bb)];document[_0x17c396(0x1897)](_0x17c396(0x20c))['forEach'](_0x4cc467=>{const _0x26dd2b=_0x17c396;_0x4cc467[_0x26dd2b(0x1c1b)][_0x26dd2b(0x1493)](_0x26dd2b(0x1a14));}),_0x529882['classList'][_0x17c396(0x21e2)]('active'),customThemeData[_0x17c396(0x16bb)]=_0x1dd26c;const _0x28cc51=document[_0x17c396(0x1262)](_0x17c396(0x2b5));_0x28cc51&&(_0x1dd26c===_0x17c396(0x176b)?(_0x28cc51[_0x17c396(0x14eb)][_0x17c396(0x4da)]=_0x17c396(0x13de),loadChatSelectionList()):_0x28cc51['style'][_0x17c396(0x4da)]=_0x17c396(0x102b));}});});async function resetCustomTheme(){const _0x182285=_0x211817;if(confirm(_0x182285(0xa45))){clearCustomThemeStyles(),clearGlobalCustomTheme(),clearGlobalThemeCache(),document[_0x182285(0x1da9)][_0x182285(0x1c1b)][_0x182285(0x1493)]('custom-theme-applied');try{await db[_0x182285(0x1155)][_0x182285(0xa4f)](),await db[_0x182285(0x19bc)]['clear'](),await db[_0x182285(0x1dde)][_0x182285(0xa4f)](),console[_0x182285(0x2187)](_0x182285(0xe00));}catch(_0x474716){console['error'](_0x182285(0x1892),_0x474716);}customThemeData={'chatTopBg':null,'chatBottomBg':null,'buttons':{'back':null,'offline':null,'settings':null,'expand':null,'continue':null,'send':null},'globalTopAppBar':null,'globalBottomAppBar':null,'globalBackButton':null,'globalAddButton':null,'globalBg':null,'scope':'selected','selectedChats':[]},document[_0x182285(0x1897)](_0x182285(0x1612))[_0x182285(0x19fb)](_0x34a221=>{const _0x1b6597=_0x182285;_0x34a221[_0x1b6597(0x14eb)]['backgroundImage']=_0x1b6597(0x102b),_0x34a221[_0x1b6597(0x1c1b)][_0x1b6597(0x1493)](_0x1b6597(0x14fb));}),document[_0x182285(0x1897)](_0x182285(0x20c))['forEach'](_0x265324=>{const _0x4ff267=_0x182285;_0x265324[_0x4ff267(0x1c1b)][_0x4ff267(0x1493)]('active');});const _0x1af09d=document[_0x182285(0xb30)](_0x182285(0x1435));_0x1af09d&&_0x1af09d[_0x182285(0x1c1b)][_0x182285(0x21e2)](_0x182285(0x1a14));const _0x15dd36=document['getElementById'](_0x182285(0x2b5));_0x15dd36&&(_0x15dd36[_0x182285(0x14eb)][_0x182285(0x4da)]=_0x182285(0x13de),loadChatSelectionList()),console[_0x182285(0x2187)](_0x182285(0x12b2)),showToast(_0x182285(0xaaf),_0x182285(0x11cb));}}function previewCustomTheme(){const _0x50dd06=_0x211817,_0x1e9600=customThemeData['chatTopBg']||customThemeData['chatBottomBg']||Object[_0x50dd06(0xc6f)](customThemeData[_0x50dd06(0xe42)])[_0x50dd06(0x19fa)](_0x43d707=>_0x43d707)||customThemeData['globalTopAppBar']||customThemeData[_0x50dd06(0x1308)]||customThemeData['globalBackButton']||customThemeData[_0x50dd06(0x13ba)]||customThemeData[_0x50dd06(0x7f9)];if(!_0x1e9600){showToast('请先上传自定义内容',_0x50dd06(0x1816));return;}const _0xe8a667={'hasCustomTheme':document['body']['classList'][_0x50dd06(0x971)](_0x50dd06(0x31b)),'cssVariables':{}},_0x4e5762=document['documentElement'],_0x192e7a=[_0x50dd06(0x10a6),'--custom-chat-bottom-bg',_0x50dd06(0x17ee),_0x50dd06(0x335),_0x50dd06(0x1725),'--custom-expand-btn','--custom-continue-btn',_0x50dd06(0xe08),_0x50dd06(0x147e),_0x50dd06(0x1619),'--custom-global-back-button','--custom-global-add-button',_0x50dd06(0x74c)];_0x192e7a[_0x50dd06(0x19fb)](_0x59f70e=>{const _0x21d04c=_0x50dd06;_0xe8a667[_0x21d04c(0xb9a)][_0x59f70e]=_0x4e5762[_0x21d04c(0x14eb)][_0x21d04c(0x18fe)](_0x59f70e);});const _0x54c27f={'chatTopBg':customThemeData['chatTopBg'],'chatBottomBg':customThemeData['chatBottomBg'],'buttons':{...customThemeData['buttons']},'globalTopAppBar':customThemeData[_0x50dd06(0xb6f)],'globalBottomAppBar':customThemeData[_0x50dd06(0x1308)],'globalBackButton':customThemeData[_0x50dd06(0x1688)],'globalAddButton':customThemeData['globalAddButton'],'globalBg':customThemeData[_0x50dd06(0x7f9)]};applyCustomThemeStyles(_0x54c27f)['catch'](_0x3a9eba=>console[_0x50dd06(0x174a)](_0x50dd06(0x1ee),_0x3a9eba)),showPreviewModal(_0xe8a667);}function showPreviewModal(_0x54ab41){const _0x3f49de=_0x211817,_0x4fbab8=document['createElement'](_0x3f49de(0xbbc));_0x4fbab8[_0x3f49de(0x1722)]='modal\x20phone-modal',_0x4fbab8[_0x3f49de(0x14eb)][_0x3f49de(0x4da)]=_0x3f49de(0x1fb7),_0x4fbab8['style'][_0x3f49de(0x1b76)]=_0x3f49de(0x10d0),_0x4fbab8['id']='theme-preview-modal',_0x4fbab8['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>🎨\x20主题预览</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-tip\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>正在预览自定义主题效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20您可以切换到聊天界面查看实际效果，预览不会保存设置。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22preview-action-btn\x20goto-chat-btn\x22\x20onclick=\x22gotoChat()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看聊天效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22preview-action-btn\x20goto-home-btn\x22\x20onclick=\x22gotoHome()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-home\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看全局效果</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22cancelPreview()\x22>取消预览</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22confirmPreview().catch(e\x20=>\x20console.error(\x27应用主题失败:\x27,\x20e))\x22>应用主题</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x3f49de(0x1da9)][_0x3f49de(0x497)](_0x4fbab8),window[_0x3f49de(0xe2b)]=_0x54ab41,showToast('🎨\x20预览模式已开启',_0x3f49de(0x477));}function cancelPreview(){const _0x3d8d7f=_0x211817,_0x4894f7=document[_0x3d8d7f(0x1262)](_0x3d8d7f(0x15e2));_0x4894f7&&_0x4894f7[_0x3d8d7f(0x1493)]();if(window[_0x3d8d7f(0xe2b)]){const _0x275a7f=document[_0x3d8d7f(0x204f)];Object[_0x3d8d7f(0x1c9f)](window['previewState'][_0x3d8d7f(0xb9a)])[_0x3d8d7f(0x19fb)](_0x5991cf=>{const _0x20fbd0=_0x3d8d7f,_0x145c25=window[_0x20fbd0(0xe2b)][_0x20fbd0(0xb9a)][_0x5991cf];_0x145c25?_0x275a7f['style'][_0x20fbd0(0xcf0)](_0x5991cf,_0x145c25):_0x275a7f[_0x20fbd0(0x14eb)][_0x20fbd0(0x1674)](_0x5991cf);}),window[_0x3d8d7f(0xe2b)][_0x3d8d7f(0x1005)]?document[_0x3d8d7f(0x1da9)][_0x3d8d7f(0x1c1b)]['add'](_0x3d8d7f(0x31b)):document[_0x3d8d7f(0x1da9)][_0x3d8d7f(0x1c1b)][_0x3d8d7f(0x1493)](_0x3d8d7f(0x31b)),window[_0x3d8d7f(0xe2b)]=null;}showToast(_0x3d8d7f(0x1c05),_0x3d8d7f(0x477));}async function confirmPreview(){const _0x517e51=_0x211817,_0x2f324b=document[_0x517e51(0x1262)](_0x517e51(0x15e2));_0x2f324b&&_0x2f324b[_0x517e51(0x1493)](),await applyCustomTheme(),window[_0x517e51(0xe2b)]=null;}function gotoChat(){const _0x22f793=_0x211817;try{currentChatCharacter?showApp('api-chat-screen'):(showApp(_0x22f793(0x1c2a)),typeof switchChatTab===_0x22f793(0xe59)&&switchChatTab(_0x22f793(0x1c45)));const _0x4e025c=document[_0x22f793(0x1262)]('theme-preview-modal');_0x4e025c&&_0x4e025c[_0x22f793(0x1493)]();}catch(_0x5ebf60){console[_0x22f793(0x174a)](_0x22f793(0x1146),_0x5ebf60),showToast('跳转失败，请手动切换到聊天界面','warning');}}function gotoHome(){const _0x541494=_0x211817;try{const _0x579451=document[_0x541494(0x1897)]('.app-screen');_0x579451[_0x541494(0x19fb)](_0x38605e=>{const _0x1268dc=_0x541494;_0x38605e[_0x1268dc(0x14eb)][_0x1268dc(0x4da)]=_0x1268dc(0x102b);});const _0x56987a=document['getElementById'](_0x541494(0x1b73)),_0x3111a3=document[_0x541494(0x1262)](_0x541494(0x224)),_0x17978c=document[_0x541494(0x1262)]('dock-bar'),_0x669efc=document[_0x541494(0x1262)](_0x541494(0x819));if(_0x56987a)_0x56987a['style'][_0x541494(0x4da)]=_0x541494(0x13de);if(_0x3111a3)_0x3111a3['style']['display']='grid';if(_0x17978c)_0x17978c['style']['display']=_0x541494(0x13de);if(_0x669efc)_0x669efc[_0x541494(0x14eb)][_0x541494(0x4da)]=_0x541494(0x1fb7);const _0x3a7e9d=document[_0x541494(0x1262)]('theme-preview-modal');_0x3a7e9d&&_0x3a7e9d[_0x541494(0x1493)]();}catch(_0x5c8458){console['error'](_0x541494(0x11e5),_0x5c8458),showToast('跳转失败，请手动切换到主界面','warning');}}async function applyCustomTheme(){const _0xc62693=_0x211817,_0x26dad9=customThemeData[_0xc62693(0x99e)]||customThemeData[_0xc62693(0xba1)]||Object[_0xc62693(0xc6f)](customThemeData[_0xc62693(0xe42)])[_0xc62693(0x19fa)](_0x4933d6=>_0x4933d6),_0x2d220c=customThemeData[_0xc62693(0xb6f)]||customThemeData[_0xc62693(0x1308)]||customThemeData[_0xc62693(0x1688)]||customThemeData[_0xc62693(0x13ba)]||customThemeData[_0xc62693(0x7f9)];if(!_0x26dad9&&!_0x2d220c){showToast(_0xc62693(0x1aee),_0xc62693(0x1816));return;}_0x2d220c&&(await saveAndApplyGlobalTheme(),console[_0xc62693(0x2187)](_0xc62693(0x346)));if(_0x26dad9){let _0x48e4d9=[];if(customThemeData[_0xc62693(0x16bb)]===_0xc62693(0x176b)){if(customThemeData['selectedChats'][_0xc62693(0x19ee)]===0x0){showToast(_0xc62693(0x777),'warning');return;}_0x48e4d9=customThemeData[_0xc62693(0x16c1)];}else{if(customThemeData[_0xc62693(0x16bb)]===_0xc62693(0x1a47)){const _0x242e31=[];characters&&contacts&&characters['forEach'](_0xcd75c3=>{const _0x40f3b1=_0xc62693;contacts[_0x40f3b1(0x1831)](_0xcd75c3['id'])&&_0x242e31[_0x40f3b1(0x1cd6)](_0xcd75c3['id']);}),groupChats&&groupChats[_0xc62693(0x19fb)](_0x4c1a0f=>{const _0x46e2d8=_0xc62693;_0x242e31[_0x46e2d8(0x1cd6)](_0x4c1a0f['id']);}),_0x48e4d9=_0x242e31;}}const _0x50abd5={'chatTopBg':customThemeData[_0xc62693(0x99e)],'chatBottomBg':customThemeData[_0xc62693(0xba1)],'buttons':{...customThemeData[_0xc62693(0xe42)]}};for(const _0x49256f of _0x48e4d9){try{await db['chatThemes'][_0xc62693(0x1561)]({'chatId':_0x49256f,'themeData':_0x50abd5,'timestamp':Date[_0xc62693(0x2eb)]()}),console['log'](_0xc62693(0x6f7)+_0x49256f+_0xc62693(0xc89));}catch(_0x12aa29){console[_0xc62693(0x174a)](_0xc62693(0x2273)+_0x49256f+'):',_0x12aa29);}}currentChatCharacter&&_0x48e4d9[_0xc62693(0x1831)](currentChatCharacter['id'])&&(applyCustomThemeStyles(_0x50abd5)[_0xc62693(0x1c82)](_0x48d7db=>console['error']('应用聊天主题失败:',_0x48d7db)),console['log'](_0xc62693(0x210f)+currentChatCharacter['id']+_0xc62693(0x1571))),showToast(_0xc62693(0x1776)+_0x48e4d9[_0xc62693(0x19ee)]+_0xc62693(0x221d),_0xc62693(0x11cb));}try{await db['themeSettings']['put']({'id':_0xc62693(0x18b9),'settingName':_0xc62693(0x18b9),'settingValue':_0xc62693(0x2b0),'timestamp':Date[_0xc62693(0x2eb)]()});}catch(_0x4b7511){console[_0xc62693(0x174a)](_0xc62693(0x3da),_0x4b7511);}if(_0x2d220c&&!_0x26dad9)showToast(_0xc62693(0x168d),'success');else _0x2d220c&&_0x26dad9&&showToast(_0xc62693(0x8c7),_0xc62693(0x11cb));clearAllThemeItemStatus(),setTimeout(()=>{const _0x1a8ba8=_0xc62693;backToSettings(_0x1a8ba8(0x1e0f));},0x5dc);}async function applyCustomThemeStyles(_0x2ba619=null){const _0x97ad68=_0x211817,_0x18a9ed=document[_0x97ad68(0x204f)];clearCustomThemeStyles();if(!_0x2ba619&&currentChatCharacter)try{const _0x5a9870=await db[_0x97ad68(0x19bc)][_0x97ad68(0xa24)]('chatId')[_0x97ad68(0x1694)](currentChatCharacter['id'])['first']();if(_0x5a9870&&_0x5a9870[_0x97ad68(0xfa8)])_0x2ba619=_0x5a9870[_0x97ad68(0xfa8)],console[_0x97ad68(0x2187)]('🎨\x20为聊天窗口\x20'+currentChatCharacter['id']+_0x97ad68(0xc9c));else{console[_0x97ad68(0x2187)](_0x97ad68(0x47c)+currentChatCharacter['id']+_0x97ad68(0x578));return;}}catch(_0x40b4a9){console['error']('❌\x20加载聊天主题数据失败:',_0x40b4a9);return;}if(!_0x2ba619){console[_0x97ad68(0x2187)](_0x97ad68(0x35f));return;}const _0x2da6bd=[];if(_0x2ba619[_0x97ad68(0x99e)])_0x2da6bd['push'](_0x2ba619[_0x97ad68(0x99e)]);if(_0x2ba619['chatBottomBg'])_0x2da6bd[_0x97ad68(0x1cd6)](_0x2ba619[_0x97ad68(0xba1)]);_0x2ba619[_0x97ad68(0xe42)]&&Object[_0x97ad68(0xc6f)](_0x2ba619['buttons'])['forEach'](_0x115f0d=>{const _0x52da32=_0x97ad68;_0x115f0d&&_0x115f0d['trim']()!==''&&_0x2da6bd[_0x52da32(0x1cd6)](_0x115f0d);});try{await Promise[_0x97ad68(0x1a47)](_0x2da6bd[_0x97ad68(0x6a4)](_0x45091b=>preloadImage(_0x45091b))),console[_0x97ad68(0x2187)](_0x97ad68(0x379));}catch(_0x499ea1){console[_0x97ad68(0x1f43)](_0x97ad68(0x135c),_0x499ea1);}_0x2ba619[_0x97ad68(0x99e)]&&(_0x18a9ed[_0x97ad68(0x14eb)][_0x97ad68(0xcf0)](_0x97ad68(0x10a6),_0x97ad68(0x9f1)+_0x2ba619[_0x97ad68(0x99e)]+')'),document[_0x97ad68(0x1da9)][_0x97ad68(0x1058)](_0x97ad68(0x8b3),'true'),console[_0x97ad68(0x2187)](_0x97ad68(0x1ad6),_0x2ba619[_0x97ad68(0x99e)]));_0x2ba619['chatBottomBg']&&(_0x18a9ed[_0x97ad68(0x14eb)][_0x97ad68(0xcf0)](_0x97ad68(0x1ebf),_0x97ad68(0x9f1)+_0x2ba619[_0x97ad68(0xba1)]+')'),document[_0x97ad68(0x1da9)][_0x97ad68(0x1058)]('data-has-chat-bottom-bg',_0x97ad68(0x1098)),console['log'](_0x97ad68(0x1451),_0x2ba619[_0x97ad68(0xba1)]));const _0x1788b1=new Set();_0x2ba619[_0x97ad68(0xe42)]&&Object[_0x97ad68(0x1c9f)](_0x2ba619[_0x97ad68(0xe42)])[_0x97ad68(0x19fb)](_0x3cb340=>{const _0x25e70c=_0x97ad68,_0x22e621=_0x2ba619['buttons'][_0x3cb340];_0x22e621&&_0x22e621['trim']()!==''&&(_0x18a9ed[_0x25e70c(0x14eb)][_0x25e70c(0xcf0)](_0x25e70c(0x8bc)+_0x3cb340+'-btn',_0x25e70c(0x9f1)+_0x22e621+')'),applyButtonCustomStyle(_0x3cb340,_0x22e621),_0x1788b1[_0x25e70c(0x21e2)](_0x3cb340),console['log'](_0x25e70c(0x1c7d)+_0x3cb340+'\x20->\x20'+_0x22e621));});const _0x35ae1b=[_0x97ad68(0x9fb),'offline','settings',_0x97ad68(0xdbb),_0x97ad68(0x4db),_0x97ad68(0x16bc)];_0x35ae1b[_0x97ad68(0x19fb)](_0x51f636=>{const _0x4c138e=_0x97ad68;_0x1788b1[_0x4c138e(0x975)](_0x51f636)?document[_0x4c138e(0x1da9)][_0x4c138e(0x1058)](_0x4c138e(0x1a42)+_0x51f636+_0x4c138e(0x125f),'true'):document[_0x4c138e(0x1da9)][_0x4c138e(0xdc4)](_0x4c138e(0x1a42)+_0x51f636+'-btn');}),document[_0x97ad68(0x1da9)]['classList'][_0x97ad68(0x21e2)]('custom-theme-applied'),console[_0x97ad68(0x2187)](_0x97ad68(0x1246)),console['log']('🎨\x20聊天自定义主题样式已应用');}function clearCustomThemeStyles(){const _0x25c982=_0x211817;console['log'](_0x25c982(0x1b3b));const _0x2b2a57=document[_0x25c982(0x204f)],_0x3bb86d=[_0x25c982(0x10a6),_0x25c982(0x1ebf),_0x25c982(0x17ee),_0x25c982(0x335),'--custom-settings-btn','--custom-expand-btn',_0x25c982(0x22bc),_0x25c982(0xe08)];_0x3bb86d['forEach'](_0xecc5ab=>{const _0x1e74ae=_0x25c982;_0x2b2a57[_0x1e74ae(0x14eb)][_0x1e74ae(0x1674)](_0xecc5ab),console[_0x1e74ae(0x2187)]('清除CSS变量:\x20'+_0xecc5ab);}),document[_0x25c982(0x1da9)][_0x25c982(0xdc4)](_0x25c982(0x8b3)),document[_0x25c982(0x1da9)]['removeAttribute']('data-has-chat-bottom-bg');const _0x496703=['back',_0x25c982(0x1d8d),_0x25c982(0x1512),_0x25c982(0xdbb),_0x25c982(0x4db),_0x25c982(0x16bc)];_0x496703[_0x25c982(0x19fb)](_0x3384b9=>{const _0x5d4471=_0x25c982;document[_0x5d4471(0x1da9)][_0x5d4471(0xdc4)](_0x5d4471(0x1a42)+_0x3384b9+_0x5d4471(0x125f));}),clearButtonCustomStyles(),clearBackgroundCustomStyles(),console[_0x25c982(0x2187)](_0x25c982(0x26e));}function applyButtonCustomStyle(_0x2f0c5f,_0x2df1eb){const _0x447041=_0x211817;let _0x4eb0cb='';switch(_0x2f0c5f){case'back':_0x4eb0cb=_0x447041(0x18a0);break;case _0x447041(0x1d8d):_0x4eb0cb=_0x447041(0x4d3);break;case'settings':_0x4eb0cb='.header-actions\x20.action-btn:last-child';break;case'expand':_0x4eb0cb=_0x447041(0x1cf7);break;case _0x447041(0x4db):_0x4eb0cb=_0x447041(0x123b);break;case'send':_0x4eb0cb=_0x447041(0x87a);break;}if(_0x4eb0cb){const _0x31135f=document[_0x447041(0x1897)](_0x4eb0cb);_0x31135f[_0x447041(0x19fb)](_0x24eb6a=>{const _0x2dc4b0=_0x447041;_0x24eb6a[_0x2dc4b0(0x14eb)]['setProperty'](_0x2dc4b0(0x4bb),_0x2dc4b0(0x9f1)+_0x2df1eb+')',_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x14eb)][_0x2dc4b0(0xcf0)](_0x2dc4b0(0xd64),_0x2dc4b0(0x12bb),'important'),_0x24eb6a[_0x2dc4b0(0x14eb)][_0x2dc4b0(0xcf0)](_0x2dc4b0(0x153c),_0x2dc4b0(0xcef),_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x14eb)]['setProperty']('background-repeat',_0x2dc4b0(0x24f),_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x14eb)][_0x2dc4b0(0xcf0)](_0x2dc4b0(0xc3d),_0x2dc4b0(0x8e5),_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x14eb)][_0x2dc4b0(0xcf0)](_0x2dc4b0(0x1d3),_0x2dc4b0(0x102b),_0x2dc4b0(0xd42)),_0x24eb6a['style'][_0x2dc4b0(0xcf0)](_0x2dc4b0(0x1b39),_0x2dc4b0(0x102b),_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x14eb)]['setProperty'](_0x2dc4b0(0x143e),'none','important'),_0x24eb6a[_0x2dc4b0(0x14eb)]['setProperty'](_0x2dc4b0(0x14b2),_0x2dc4b0(0x8e5),_0x2dc4b0(0xd42)),_0x24eb6a[_0x2dc4b0(0x1c1b)][_0x2dc4b0(0x21e2)]('custom-button-styled');const _0x567455=_0x24eb6a[_0x2dc4b0(0x1897)](_0x2dc4b0(0x133e));_0x567455[_0x2dc4b0(0x19fb)](_0x415aed=>{const _0x1f4b8b=_0x2dc4b0;_0x415aed['style'][_0x1f4b8b(0xcf0)](_0x1f4b8b(0x11af),'0',_0x1f4b8b(0xd42));});});}}function clearButtonCustomStyles(){const _0x3d6fc7=_0x211817;console[_0x3d6fc7(0x2187)](_0x3d6fc7(0x1948));const _0x132491=document['querySelectorAll']('.custom-button-styled');_0x132491['forEach'](_0x1c9ba2=>{const _0x4bbd0f=_0x3d6fc7;_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0x4bb)),_0x1c9ba2['style']['removeProperty']('background-size'),_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0x153c)),_0x1c9ba2['style'][_0x4bbd0f(0x1674)](_0x4bbd0f(0x81c)),_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0xc3d)),_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0x1d3)),_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0x1b39)),_0x1c9ba2[_0x4bbd0f(0x14eb)][_0x4bbd0f(0x1674)](_0x4bbd0f(0x143e)),_0x1c9ba2[_0x4bbd0f(0x14eb)]['removeProperty']('background-color'),_0x1c9ba2[_0x4bbd0f(0x1c1b)]['remove'](_0x4bbd0f(0x148a));const _0x2ae5c8=_0x1c9ba2[_0x4bbd0f(0x1897)]('i,\x20span,\x20.icon');_0x2ae5c8[_0x4bbd0f(0x19fb)](_0x2e9242=>{const _0x4d1fff=_0x4bbd0f;_0x2e9242['style'][_0x4d1fff(0x1674)](_0x4d1fff(0x11af));}),console[_0x4bbd0f(0x2187)](_0x4bbd0f(0x15bd),_0x1c9ba2[_0x4bbd0f(0x1722)]);});const _0x15aca0=['.back-btn','#offline-mode-icon',_0x3d6fc7(0x58a),_0x3d6fc7(0x1cf7),_0x3d6fc7(0x123b),'.send-button'];_0x15aca0[_0x3d6fc7(0x19fb)](_0x1a0475=>{const _0x1f9968=_0x3d6fc7,_0x491d54=document[_0x1f9968(0x1897)](_0x1a0475);_0x491d54[_0x1f9968(0x19fb)](_0x52c866=>{const _0x24d375=_0x1f9968;_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x4bb)),_0x52c866[_0x24d375(0x14eb)]['removeProperty'](_0x24d375(0xd64)),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x153c)),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x81c)),_0x52c866['style'][_0x24d375(0x1674)]('color'),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x1d3)),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x1b39)),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x143e)),_0x52c866[_0x24d375(0x14eb)][_0x24d375(0x1674)](_0x24d375(0x14b2));const _0x32444c=_0x52c866[_0x24d375(0x1897)](_0x24d375(0x133e));_0x32444c[_0x24d375(0x19fb)](_0x123c5f=>{const _0x21ced9=_0x24d375;_0x123c5f[_0x21ced9(0x14eb)][_0x21ced9(0x1674)](_0x21ced9(0x11af));});});});}function clearBackgroundCustomStyles(){const _0x3f9e69=_0x211817;console[_0x3f9e69(0x2187)](_0x3f9e69(0x131e));const _0x33d41b=document[_0x3f9e69(0x1897)](_0x3f9e69(0x7a7));_0x33d41b[_0x3f9e69(0x19fb)](_0x3a725c=>{const _0x4e7ef6=_0x3f9e69;_0x3a725c['style'][_0x4e7ef6(0x159c)]='',_0x3a725c[_0x4e7ef6(0x14eb)]['backgroundSize']='',_0x3a725c[_0x4e7ef6(0x14eb)][_0x4e7ef6(0x1530)]='',_0x3a725c[_0x4e7ef6(0x14eb)][_0x4e7ef6(0x80f)]='';});const _0x173e65=document[_0x3f9e69(0x1897)](_0x3f9e69(0x6e5));_0x173e65[_0x3f9e69(0x19fb)](_0x1bf986=>{const _0x59b28f=_0x3f9e69;_0x1bf986[_0x59b28f(0x14eb)][_0x59b28f(0x159c)]='',_0x1bf986[_0x59b28f(0x14eb)][_0x59b28f(0x15d0)]='',_0x1bf986[_0x59b28f(0x14eb)][_0x59b28f(0x1530)]='',_0x1bf986[_0x59b28f(0x14eb)]['backgroundRepeat']='';});const _0x13548b=document[_0x3f9e69(0x1897)](_0x3f9e69(0x1b1b));_0x13548b[_0x3f9e69(0x19fb)](_0x201b0a=>{const _0x2de7c9=_0x3f9e69;_0x201b0a['style'][_0x2de7c9(0x159c)]='',_0x201b0a[_0x2de7c9(0x14eb)][_0x2de7c9(0x15d0)]='',_0x201b0a['style'][_0x2de7c9(0x1530)]='',_0x201b0a[_0x2de7c9(0x14eb)][_0x2de7c9(0x80f)]='';});}async function showThemeManagement(){const _0x229dbc=_0x211817;try{const _0x21cae5=[],_0x531f7d=await db[_0x229dbc(0x19bc)][_0x229dbc(0xf13)]();characters&&contacts&&characters[_0x229dbc(0x19fb)](_0x15a358=>{const _0x4d9e59=_0x229dbc;if(contacts[_0x4d9e59(0x1831)](_0x15a358['id'])){const _0x1e902c=_0x531f7d[_0x4d9e59(0xaf4)](_0x317aba=>_0x317aba[_0x4d9e59(0x20e1)]===_0x15a358['id']);_0x1e902c&&_0x21cae5['push']({'id':_0x15a358['id'],'name':_0x15a358[_0x4d9e59(0x1a1c)],'type':_0x4d9e59(0x1dbb),'themeData':_0x1e902c[_0x4d9e59(0xfa8)]});}});groupChats&&groupChats[_0x229dbc(0x19fb)](_0x27caad=>{const _0x32079d=_0x229dbc,_0x494450=_0x531f7d[_0x32079d(0xaf4)](_0x51f7a3=>_0x51f7a3['chatId']===_0x27caad['id']);_0x494450&&_0x21cae5[_0x32079d(0x1cd6)]({'id':_0x27caad['id'],'name':_0x27caad[_0x32079d(0x1a1c)],'type':'group','themeData':_0x494450[_0x32079d(0xfa8)]});});if(_0x21cae5[_0x229dbc(0x19ee)]===0x0){showToast('没有找到任何自定义主题','info');return;}const _0x471083=document['createElement']('div');_0x471083[_0x229dbc(0x1722)]=_0x229dbc(0x1099),_0x471083['style'][_0x229dbc(0x4da)]='flex',_0x471083[_0x229dbc(0x14eb)][_0x229dbc(0x1b76)]=_0x229dbc(0x10d0),_0x471083['id']=_0x229dbc(0x1978);const _0x98fb8c=_0x21cae5[_0x229dbc(0x6a4)](_0x4d2d61=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-item\x22\x20data-chat-id=\x22'+_0x4d2d61['id']+_0x229dbc(0x12dc)+_0x4d2d61[_0x229dbc(0x1a1c)]+_0x229dbc(0x62b)+(_0x4d2d61['type']===_0x229dbc(0x1257)?'群聊':'角色')+_0x229dbc(0x2065)+_0x4d2d61['id']+_0x229dbc(0x2216)+_0x4d2d61['id']+_0x229dbc(0x18ae))[_0x229dbc(0x122b)]('');_0x471083[_0x229dbc(0x33a)]=_0x229dbc(0x1d31)+_0x21cae5[_0x229dbc(0x19ee)]+_0x229dbc(0x6cb)+_0x98fb8c+_0x229dbc(0x939),document['body'][_0x229dbc(0x497)](_0x471083);}catch(_0x494b51){console[_0x229dbc(0x174a)](_0x229dbc(0x1012),_0x494b51),showToast('加载主题管理界面失败',_0x229dbc(0x174a));}}function closeThemeManagement(){const _0x5317e1=_0x211817,_0xc64c6e=document[_0x5317e1(0x1262)](_0x5317e1(0x1978));_0xc64c6e&&_0xc64c6e[_0x5317e1(0x1493)]();}async function previewChatTheme(_0x50de4b){const _0x19ee61=_0x211817;try{const _0x3ec24e=await db['chatThemes']['where']('chatId')['equals'](_0x50de4b)[_0x19ee61(0x1a7b)]();if(_0x3ec24e&&_0x3ec24e[_0x19ee61(0xfa8)]){await applyCustomThemeStyles(_0x3ec24e[_0x19ee61(0xfa8)]);let _0x12eaa4=_0x19ee61(0x2290);if(characters&&contacts){const _0x132f1a=characters[_0x19ee61(0xaf4)](_0xe43370=>_0xe43370['id']===_0x50de4b);_0x132f1a&&contacts[_0x19ee61(0x1831)](_0x132f1a['id'])&&(_0x12eaa4=_0x132f1a[_0x19ee61(0x1a1c)]);}if(groupChats){const _0x4c5b0d=groupChats[_0x19ee61(0xaf4)](_0x5293f8=>_0x5293f8['id']===_0x50de4b);_0x4c5b0d&&(_0x12eaa4=_0x4c5b0d[_0x19ee61(0x1a1c)]);}showToast('正在预览\x20'+_0x12eaa4+_0x19ee61(0x7a4),_0x19ee61(0x477));}else showToast('未找到主题数据','error');}catch(_0x2505ea){console[_0x19ee61(0x174a)](_0x19ee61(0x1d34),_0x2505ea),showToast(_0x19ee61(0x170b),_0x19ee61(0x174a));}}async function removeChatTheme(_0x8e53e2){const _0x1e000b=_0x211817;try{let _0x27f27d='未知聊天';if(characters&&contacts){const _0x701743=characters['find'](_0x539872=>_0x539872['id']===_0x8e53e2);_0x701743&&contacts[_0x1e000b(0x1831)](_0x701743['id'])&&(_0x27f27d=_0x701743[_0x1e000b(0x1a1c)]);}if(groupChats){const _0x203fa7=groupChats[_0x1e000b(0xaf4)](_0x55885a=>_0x55885a['id']===_0x8e53e2);_0x203fa7&&(_0x27f27d=_0x203fa7[_0x1e000b(0x1a1c)]);}confirm('确定要移除\x20'+_0x27f27d+'\x20的自定义主题吗？')&&(await db[_0x1e000b(0x19bc)]['where'](_0x1e000b(0x20e1))[_0x1e000b(0x1694)](_0x8e53e2)[_0x1e000b(0x1f4a)](),currentChatCharacter&&currentChatCharacter['id']===_0x8e53e2&&clearCustomThemeStyles(),showToast(_0x1e000b(0xd29)+_0x27f27d+_0x1e000b(0x1ac0),'success'),closeThemeManagement(),setTimeout(()=>showThemeManagement()[_0x1e000b(0x1c82)](_0x12ad92=>console[_0x1e000b(0x174a)]('刷新主题管理失败:',_0x12ad92)),0x64));}catch(_0x4158f2){console['error'](_0x1e000b(0x5d6),_0x4158f2),showToast('移除主题失败',_0x1e000b(0x174a));}}async function clearAllThemes(){const _0x3d39c9=_0x211817;if(confirm('确定要清除所有聊天窗口的自定义主题吗？此操作不可撤销！'))try{const _0x391a57=await db['chatThemes'][_0x3d39c9(0xf13)](),_0x8f1714=_0x391a57[_0x3d39c9(0x19ee)];await db[_0x3d39c9(0x19bc)][_0x3d39c9(0xa4f)](),clearCustomThemeStyles(),showToast('已清除\x20'+_0x8f1714+'\x20个聊天窗口的自定义主题',_0x3d39c9(0x11cb)),closeThemeManagement();}catch(_0x1af4d9){console['error'](_0x3d39c9(0x15bf),_0x1af4d9),showToast(_0x3d39c9(0x1f31),'error');}}document[_0x211817(0x21e9)](_0x211817(0x20dc),async function(){const _0x172e34=_0x211817;try{const _0x3153e9=await db['themeSettings'][_0x172e34(0xb78)](_0x172e34(0x18b9)),_0x454d64=_0x3153e9?_0x3153e9['settingValue']:null;if(!_0x454d64||_0x454d64===_0x172e34(0x2b0))await applyGlobalCustomTheme(),console['log'](_0x172e34(0x167e));else{const _0x223e34=document[_0x172e34(0x1da9)];_0x223e34[_0x172e34(0xdc4)](_0x172e34(0xd98)),_0x454d64!==_0x172e34(0x1094)&&_0x223e34[_0x172e34(0x1058)](_0x172e34(0xd98),_0x454d64),console[_0x172e34(0x2187)]('🎨\x20页面加载时应用系统主题:\x20'+_0x454d64);}}catch(_0x388f6f){console['error'](_0x172e34(0x1f54),_0x388f6f);}});async function initCustomThemeScreen(){console['log']('🎨\x20初始化自定义主题界面'),switchCustomThemeTab('chat'),await loadCustomThemeToUI();}async function loadCustomThemeToUI(){const _0x343690=_0x211817;try{const _0x32e63e=await db[_0x343690(0x1155)][_0x343690(0xb78)](_0x343690(0x1dae));let _0x30f9dd={};_0x32e63e&&_0x32e63e[_0x343690(0xfa8)]&&(_0x30f9dd=_0x32e63e[_0x343690(0xfa8)],console[_0x343690(0x2187)](_0x343690(0x1b4d)));const _0x40bbc8={'chatTopBg':customThemeData[_0x343690(0x99e)],'chatBottomBg':customThemeData[_0x343690(0xba1)],'buttons':{...customThemeData[_0x343690(0xe42)]},'globalTopAppBar':_0x30f9dd['globalTopAppBar'],'globalBottomAppBar':_0x30f9dd['globalBottomAppBar'],'globalBackButton':_0x30f9dd[_0x343690(0x1688)],'globalAddButton':_0x30f9dd[_0x343690(0x13ba)],'globalBg':_0x30f9dd[_0x343690(0x7f9)],'scope':customThemeData[_0x343690(0x16bb)]||_0x343690(0x176b),'selectedChats':customThemeData['selectedChats']||[]};customThemeData=_0x40bbc8;_0x40bbc8['chatTopBg']&&(updatePreview(_0x343690(0x1bfc),_0x40bbc8['chatTopBg']),updateThemeItemStatus(_0x343690(0x1e49),!![]));_0x40bbc8[_0x343690(0xba1)]&&(updatePreview('chat-bottom-bg-preview',_0x40bbc8[_0x343690(0xba1)]),updateThemeItemStatus(_0x343690(0x1f80),!![]));_0x40bbc8[_0x343690(0xe42)]&&typeof _0x40bbc8['buttons']===_0x343690(0x28d)&&Object[_0x343690(0x1c9f)](_0x40bbc8[_0x343690(0xe42)])['forEach'](_0xc5a41=>{const _0x10bdc8=_0x343690;_0x40bbc8[_0x10bdc8(0xe42)][_0xc5a41]&&(updatePreview(_0xc5a41+'-btn-preview',_0x40bbc8[_0x10bdc8(0xe42)][_0xc5a41]),updateThemeItemStatus(_0xc5a41+'-btn-item',!![]));});_0x40bbc8['globalTopAppBar']&&updatePreview(_0x343690(0x1939),_0x40bbc8[_0x343690(0xb6f)]);_0x40bbc8[_0x343690(0x1308)]&&updatePreview('global-bottom-app-bar-preview',_0x40bbc8[_0x343690(0x1308)]);_0x40bbc8['globalBackButton']&&updatePreview('global-back-button-preview',_0x40bbc8['globalBackButton']);_0x40bbc8[_0x343690(0x13ba)]&&updatePreview(_0x343690(0x1ff),_0x40bbc8[_0x343690(0x13ba)]);_0x40bbc8[_0x343690(0x7f9)]&&updatePreview('global-bg-preview',_0x40bbc8[_0x343690(0x7f9)]);document['querySelectorAll'](_0x343690(0x20c))[_0x343690(0x19fb)](_0x5bfbef=>{_0x5bfbef['classList']['remove']('active');});const _0x1618b6=document[_0x343690(0xb30)]('.theme-scope-option[data-scope=\x22'+_0x40bbc8[_0x343690(0x16bb)]+'\x22]');_0x1618b6&&_0x1618b6['classList'][_0x343690(0x21e2)](_0x343690(0x1a14));}catch(_0x1fd903){console[_0x343690(0x174a)](_0x343690(0x179e),_0x1fd903);}}async function loadSavedTheme(){const _0x2e9b2e=_0x211817;try{const _0x430526=await db[_0x2e9b2e(0x1dde)][_0x2e9b2e(0xb78)](_0x2e9b2e(0x18b9)),_0xdb1693=_0x430526?_0x430526['settingValue']:null;_0xdb1693&&_0xdb1693!==_0x2e9b2e(0x1094)&&document[_0x2e9b2e(0x1da9)][_0x2e9b2e(0x1058)]('data-theme',_0xdb1693);}catch(_0x2ceb1f){console[_0x2e9b2e(0x174a)](_0x2e9b2e(0x10f0),_0x2ceb1f);}}let worldbooks=[],editingWorldbook=null;async function loadWorldbooks(){const _0x1f067c=_0x211817;try{const _0x15380a=await db['worldbooks']['toArray']();if(_0x15380a[_0x1f067c(0x19ee)]===0x0){const _0x3800fd=localStorage['getItem']('worldbooks');if(_0x3800fd){console['log'](_0x1f067c(0x2298));const _0x109c3d=JSON[_0x1f067c(0x22d3)](_0x3800fd);if(_0x109c3d[_0x1f067c(0x19ee)]>0x0){const _0x16d88f=_0x109c3d['map'](_0x21edfe=>({'id':_0x21edfe['id']||Date[_0x1f067c(0x2eb)]()[_0x1f067c(0x1878)]()+Math[_0x1f067c(0x11a8)](),'title':_0x21edfe[_0x1f067c(0x378)],'content':_0x21edfe['content'],'createdAt':_0x21edfe[_0x1f067c(0x1e99)]||new Date()[_0x1f067c(0x1034)](),'updatedAt':_0x21edfe[_0x1f067c(0x12e0)]||new Date()['toISOString']()}));await db['worldbooks']['bulkAdd'](_0x16d88f),worldbooks=_0x16d88f,console['log'](_0x1f067c(0x430),worldbooks);}else worldbooks=[];}else worldbooks=[];}else worldbooks=_0x15380a,console[_0x1f067c(0x2187)](_0x1f067c(0x211a),worldbooks);}catch(_0xa3100f){console[_0x1f067c(0x174a)](_0x1f067c(0x17e5),_0xa3100f);const _0x352537=localStorage[_0x1f067c(0x15d8)](_0x1f067c(0x21f8));if(_0x352537)try{worldbooks=JSON[_0x1f067c(0x22d3)](_0x352537);}catch(_0x53c268){worldbooks=[];}else worldbooks=[];}renderWorldbookList();}async function saveWorldbooks(){const _0x2bdef7=_0x211817;try{console['log'](_0x2bdef7(0x1d97),worldbooks);if(worldbooks[_0x2bdef7(0x19ee)]===0x0){console['warn']('⚠️\x20世界书数据为空，跳过保存操作');return;}await db[_0x2bdef7(0x1464)]('rw',db[_0x2bdef7(0x21f8)],async()=>{const _0x1e2e68=_0x2bdef7;await db['worldbooks'][_0x1e2e68(0xa4f)](),await db[_0x1e2e68(0x21f8)][_0x1e2e68(0x2a3)](worldbooks);}),console['log'](_0x2bdef7(0x408)+worldbooks[_0x2bdef7(0x19ee)]+_0x2bdef7(0x1b1c)),console[_0x2bdef7(0x2187)]('世界书数据保存成功');}catch(_0x547c9d){console['error'](_0x2bdef7(0x9aa),_0x547c9d),localStorage[_0x2bdef7(0x192)](_0x2bdef7(0x21f8),JSON[_0x2bdef7(0x6b8)](worldbooks));}}function _0x167f(_0x57bf03,_0x45ed6c){const _0x513f39=_0x513f();return _0x167f=function(_0x167f70,_0x192fbb){_0x167f70=_0x167f70-0x180;let _0x10edba=_0x513f39[_0x167f70];return _0x10edba;},_0x167f(_0x57bf03,_0x45ed6c);}function showWorldbookForm(_0x2cb3bf){const _0x4a6d09=_0x211817;let _0x17f99d;_0x2cb3bf?_0x17f99d=_0x4a6d09(0x4b1):_0x17f99d=_0x4a6d09(0x167d),document['getElementById'](_0x4a6d09(0x1bb9))[_0x4a6d09(0x13be)]=_0x17f99d,editingWorldbook=null,document[_0x4a6d09(0x1262)]('worldbook-title')['value']='',document[_0x4a6d09(0x1262)]('worldbook-content')[_0x4a6d09(0x1ebc)]='',window[_0x4a6d09(0x2300)]=_0x2cb3bf,showApp('worldbook-form-screen');}function hideWorldbookForm(){hideApp('worldbook-form-screen'),showApp('worldbook-screen');}async function saveWorldbook(){const _0x4a63a2=_0x211817,_0x13704d=document['getElementById'](_0x4a63a2(0x1880))['value'][_0x4a63a2(0x19d7)](),_0xd885a2=document[_0x4a63a2(0x1262)](_0x4a63a2(0x1cf0))[_0x4a63a2(0x1ebc)][_0x4a63a2(0x19d7)]();if(!_0x13704d||!_0xd885a2){alert(_0x4a63a2(0x432));return;}let _0x7fe1e4;editingWorldbook?_0x7fe1e4=editingWorldbook[_0x4a63a2(0xd92)]:_0x7fe1e4=window[_0x4a63a2(0x2300)];const _0x3d309e={'id':editingWorldbook?editingWorldbook['id']:Date['now']()['toString'](),'title':_0x13704d,'content':_0xd885a2,'isGlobal':_0x7fe1e4,'createdAt':editingWorldbook?editingWorldbook[_0x4a63a2(0x1e99)]:new Date()[_0x4a63a2(0x1034)](),'updatedAt':new Date()[_0x4a63a2(0x1034)]()};if(editingWorldbook){const _0x207384=worldbooks[_0x4a63a2(0x150c)](_0x458053=>_0x458053['id']===editingWorldbook['id']);if(_0x207384!==-0x1)worldbooks[_0x207384]=_0x3d309e;}else worldbooks[_0x4a63a2(0x1cd6)](_0x3d309e);await saveWorldbooks(),renderWorldbookList(),showToast(editingWorldbook?'世界书已更新！':_0x4a63a2(0xef9),'success'),hideWorldbookForm();}async function toggleGlobalWorldbook(_0x26d5d1,_0x500be0){const _0x33ab76=_0x211817;!window[_0x33ab76(0x1a4e)]&&(window[_0x33ab76(0x1a4e)]=[]);_0x500be0?!window[_0x33ab76(0x1a4e)][_0x33ab76(0x1831)](_0x26d5d1)&&window['activeGlobalWorldbooks'][_0x33ab76(0x1cd6)](_0x26d5d1):window['activeGlobalWorldbooks']=window[_0x33ab76(0x1a4e)][_0x33ab76(0x1e1f)](_0x434f8e=>_0x434f8e!==_0x26d5d1);try{await db['globalSettings'][_0x33ab76(0x1561)]({'id':_0x33ab76(0x11d7),'activeGlobalWorldbooks':window[_0x33ab76(0x1a4e)]}),console['log'](_0x33ab76(0x176c),window['activeGlobalWorldbooks']),showToast(_0x33ab76(0x2049),_0x33ab76(0x11cb));}catch(_0x423f3f){console[_0x33ab76(0x174a)](_0x33ab76(0xb94),_0x423f3f),showToast(_0x33ab76(0xa33),_0x33ab76(0x174a));}}function editWorldbook(_0x356d55){const _0x16ac12=_0x211817,_0x416ff5=worldbooks[_0x16ac12(0xaf4)](_0x292410=>_0x292410['id']===_0x356d55);if(_0x416ff5){editingWorldbook=_0x416ff5;let _0x4f1f2d;_0x416ff5[_0x16ac12(0xd92)]?_0x4f1f2d=_0x16ac12(0x1739):_0x4f1f2d=_0x16ac12(0xeee),document[_0x16ac12(0x1262)]('worldbook-form-title')['textContent']=_0x4f1f2d,document[_0x16ac12(0x1262)](_0x16ac12(0x1880))['value']=_0x416ff5['title']||_0x416ff5[_0x16ac12(0x1a1c)],document['getElementById'](_0x16ac12(0x1cf0))[_0x16ac12(0x1ebc)]=_0x416ff5['content'],showApp(_0x16ac12(0x844));}}async function deleteWorldbook(_0x4334d6){const _0xeb98bb=_0x211817;if(confirm(_0xeb98bb(0x1fa))){console[_0xeb98bb(0x2187)]('🗑️\x20删除世界书:',_0x4334d6),console[_0xeb98bb(0x2187)](_0xeb98bb(0x769),worldbooks[_0xeb98bb(0x6a4)](_0x2f498b=>({'id':_0x2f498b['id'],'name':_0x2f498b[_0xeb98bb(0x1a1c)]||_0x2f498b[_0xeb98bb(0x378)]})));const _0x331d4b=worldbooks[_0xeb98bb(0x19ee)];worldbooks=worldbooks['filter'](_0x2d8b03=>_0x2d8b03['id']!==_0x4334d6);const _0x54fccf=worldbooks['length'];console[_0xeb98bb(0x2187)]('删除操作:\x20'+_0x331d4b+_0xeb98bb(0x553)+_0x54fccf+',\x20删除了\x20'+(_0x331d4b-_0x54fccf)+_0xeb98bb(0xd5c));if(_0x331d4b===_0x54fccf){console[_0xeb98bb(0x1f43)](_0xeb98bb(0x1413)),showToast(_0xeb98bb(0x1f8),_0xeb98bb(0x174a));return;}try{await saveWorldbooks(),console[_0xeb98bb(0x2187)](_0xeb98bb(0x1acc)),showToast(_0xeb98bb(0x1366),_0xeb98bb(0x11cb));}catch(_0x250bb3){console['error']('❌\x20删除世界书时数据库保存失败:',_0x250bb3),showToast('删除失败：数据库保存错误','error');}renderWorldbookList();}}function renderWorldbookList(){const _0x43494d=_0x211817,_0x1976c2=document['getElementById'](_0x43494d(0x17b5)),_0x1e0797=document['getElementById']('local-worldbooks-content');if(!_0x1976c2||!_0x1e0797)return;const _0x2d9be0=worldbooks[_0x43494d(0x1e1f)](_0x468f92=>_0x468f92[_0x43494d(0xd92)]),_0x45c4e4=worldbooks['filter'](_0x377f3f=>!_0x377f3f[_0x43494d(0xd92)]);let _0x40eddf='',_0xace3dd='';_0x40eddf+=_0x43494d(0xb37),_0x2d9be0[_0x43494d(0x19ee)]>0x0?_0x2d9be0['forEach'](_0x5d639a=>{const _0x5c4b42=_0x43494d,_0xf79707=Array[_0x5c4b42(0x1496)](window['activeGlobalWorldbooks'])&&window[_0x5c4b42(0x1a4e)][_0x5c4b42(0x1831)](_0x5d639a['id'])?_0x5c4b42(0x14c1):'',_0x3b06f0=new Date(_0x5d639a[_0x5c4b42(0x12e0)]||_0x5d639a[_0x5c4b42(0x1e99)]||Date['now']()),_0x4fa8e9=isNaN(_0x3b06f0['getTime']())?'未知日期':_0x3b06f0[_0x5c4b42(0xbf7)](),_0x47297b=truncateText(_0x5d639a[_0x5c4b42(0x211c)],0x3c);_0x40eddf+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-item\x22\x20onclick=\x22editWorldbook(\x27'+_0x5d639a['id']+_0x5c4b42(0xe8f)+(_0x5d639a[_0x5c4b42(0x378)]||_0x5d639a['name'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>'+_0x47297b+_0x5c4b42(0x1783)+_0x4fa8e9+_0x5c4b42(0x2be)+_0x5d639a['id']+'\x27)\x22\x20class=\x22delete-worldbook-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22toggle-switch\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20onchange=\x22toggleGlobalWorldbook(\x27'+_0x5d639a['id']+_0x5c4b42(0x1564)+_0xf79707+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22toggle-slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}):_0x40eddf+=_0x43494d(0x1e91),_0x40eddf+=_0x43494d(0x1844),_0xace3dd+=_0x43494d(0xb37),_0x45c4e4[_0x43494d(0x19ee)]>0x0?_0x45c4e4[_0x43494d(0x19fb)](_0x3d9784=>{const _0x77391e=_0x43494d,_0x3dadfa=new Date(_0x3d9784[_0x77391e(0x12e0)]||_0x3d9784[_0x77391e(0x1e99)]||Date['now']()),_0x556077=isNaN(_0x3dadfa[_0x77391e(0x704)]())?_0x77391e(0x42b):_0x3dadfa['toLocaleDateString'](),_0x54e045=truncateText(_0x3d9784[_0x77391e(0x211c)],0x3c);_0xace3dd+=_0x77391e(0x1962)+_0x3d9784['id']+_0x77391e(0xe8f)+(_0x3d9784[_0x77391e(0x378)]||_0x3d9784[_0x77391e(0x1a1c)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>'+_0x54e045+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-date-text\x22>更新于\x20'+_0x556077+_0x77391e(0xa55)+_0x3d9784['id']+'\x27)\x22\x20class=\x22delete-worldbook-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}):_0xace3dd+=_0x43494d(0x1538),_0xace3dd+='</div>',_0x1976c2['innerHTML']=_0x40eddf,_0x1e0797[_0x43494d(0x33a)]=_0xace3dd;}function switchWorldbookTab(_0x27c448){const _0x2ab1bc=_0x211817;currentWorldbookTab=_0x27c448;const _0x410bc9=document[_0x2ab1bc(0x1262)](_0x2ab1bc(0x17b5)),_0x3a62b1=document[_0x2ab1bc(0x1262)]('local-worldbooks-content'),_0x5832a2=document[_0x2ab1bc(0x1897)](_0x2ab1bc(0xcab));_0x5832a2[_0x2ab1bc(0x19fb)](_0x4f557f=>{const _0x330c7f=_0x2ab1bc;_0x4f557f[_0x330c7f(0x2139)]('onclick')[_0x330c7f(0x1831)](_0x27c448)?_0x4f557f[_0x330c7f(0x1c1b)][_0x330c7f(0x21e2)](_0x330c7f(0x1a14)):_0x4f557f['classList'][_0x330c7f(0x1493)](_0x330c7f(0x1a14));}),_0x410bc9[_0x2ab1bc(0x14eb)][_0x2ab1bc(0x4da)]=_0x2ab1bc(0x102b),_0x3a62b1[_0x2ab1bc(0x14eb)][_0x2ab1bc(0x4da)]=_0x2ab1bc(0x102b);if(_0x27c448==='global')_0x410bc9[_0x2ab1bc(0x14eb)]['display']='block';else _0x27c448==='local'&&(_0x3a62b1[_0x2ab1bc(0x14eb)][_0x2ab1bc(0x4da)]=_0x2ab1bc(0x13de));renderWorldbookList();}function onWorldbookAddClick(){const _0x2046aa=_0x211817;if(currentWorldbookTab==='global')showWorldbookForm(!![]);else currentWorldbookTab===_0x2046aa(0x14cc)&&showWorldbookForm(![]);}function debugWorldbooks(){const _0x3fdbf2=_0x211817;return console['log'](_0x3fdbf2(0x226b)),worldbooks['forEach']((_0x4c4c3d,_0x17d1b6)=>{const _0x3b8743=_0x3fdbf2;console[_0x3b8743(0x2187)](_0x17d1b6+0x1+'.\x20ID:\x20\x22'+_0x4c4c3d['id']+_0x3b8743(0x140f)+(_0x4c4c3d[_0x3b8743(0x1a1c)]||_0x4c4c3d[_0x3b8743(0x378)])+'\x22,\x20来源:\x20\x22'+_0x4c4c3d['source']+_0x3b8743(0x1f0f)+_0x4c4c3d['category']+_0x3b8743(0xc0b)+_0x4c4c3d[_0x3b8743(0xd92)]);}),console[_0x3fdbf2(0x2187)](_0x3fdbf2(0x1b91)+worldbooks['length']+_0x3fdbf2(0x1d9d)),worldbooks;}async function clearAllWorldbooks(){const _0x22e8fd=_0x211817;if(confirm(_0x22e8fd(0x922))){console['log'](_0x22e8fd(0x1a0e));const _0x2b5549=worldbooks[_0x22e8fd(0x19ee)];worldbooks=[],await saveWorldbooks(),renderWorldbookList(),showToast(_0x22e8fd(0xb46)+_0x2b5549+_0x22e8fd(0x1baf),_0x22e8fd(0x11cb)),console[_0x22e8fd(0x2187)](_0x22e8fd(0xd4f));}}async function fixWorldbookIds(){const _0x22d244=_0x211817;console[_0x22d244(0x2187)](_0x22d244(0x16a5));let _0x3c3004=0x0;return worldbooks['forEach']((_0x2a9a58,_0x30973b)=>{const _0x4ecb4e=_0x22d244;(!_0x2a9a58['id']||typeof _0x2a9a58['id']!=='string')&&(_0x2a9a58['id']=_0x4ecb4e(0x7b9)+Date[_0x4ecb4e(0x2eb)]()+'_'+_0x30973b,_0x3c3004++,console[_0x4ecb4e(0x2187)](_0x4ecb4e(0x4bc)+(_0x2a9a58['name']||_0x2a9a58[_0x4ecb4e(0x378)])+'\x22\x20的ID'));}),_0x3c3004>0x0?(await saveWorldbooks(),renderWorldbookList(),showToast(_0x22d244(0x13b6)+_0x3c3004+_0x22d244(0xe81),_0x22d244(0x11cb))):console[_0x22d244(0x2187)]('所有世界书ID都正常'),_0x3c3004;}function parseLRC(_0x217ac4){const _0x3dae4d=_0x211817;if(!_0x217ac4)return{'lyrics':[_0x3dae4d(0xcc6)],'timings':[]};const _0x5179f5=_0x217ac4[_0x3dae4d(0x204b)]('\x0a'),_0x2e7864=[],_0x3d8567=[],_0x23f3ed=/\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;for(const _0x5be276 of _0x5179f5){let _0xb353ab;const _0x317a90=[];while((_0xb353ab=_0x23f3ed[_0x3dae4d(0x1d15)](_0x5be276))!==null){const _0x395ec7=parseInt(_0xb353ab[0x1]),_0x617dc9=parseInt(_0xb353ab[0x2]),_0x3ba8cb=parseInt(_0xb353ab[0x3]['padEnd'](0x3,'0')),_0x3ca52a=_0x395ec7*0x3c+_0x617dc9+_0x3ba8cb/0x3e8;_0x317a90[_0x3dae4d(0x1cd6)](_0x3ca52a);}const _0x3e2802=_0x5be276[_0x3dae4d(0xe16)](/\[\d{2}:\d{2}\.\d{2,3}\]/g,'')[_0x3dae4d(0x19d7)]();if(_0x3e2802&&!_0x3e2802['startsWith']('[')){if(_0x317a90[_0x3dae4d(0x19ee)]>0x0)for(const _0x3b73a2 of _0x317a90){_0x2e7864[_0x3dae4d(0x1cd6)](_0x3e2802),_0x3d8567['push'](_0x3b73a2);}else _0x2e7864[_0x3dae4d(0x1cd6)](_0x3e2802),_0x3d8567['push'](null);}}if(_0x3d8567['some'](_0x21ebdb=>_0x21ebdb!==null)){const _0x5cda11=_0x2e7864[_0x3dae4d(0x6a4)]((_0x682fc9,_0x1c9c93)=>({'text':_0x682fc9,'time':_0x3d8567[_0x1c9c93]}))[_0x3dae4d(0x1e1f)](_0x3714ea=>_0x3714ea['time']!==null)[_0x3dae4d(0x1104)]((_0x2c82a9,_0x4e2346)=>_0x2c82a9[_0x3dae4d(0x1236)]-_0x4e2346['time']);return{'lyrics':_0x5cda11['map'](_0x3f2ba7=>_0x3f2ba7[_0x3dae4d(0x1378)]),'timings':_0x5cda11[_0x3dae4d(0x6a4)](_0x33bc3f=>_0x33bc3f[_0x3dae4d(0x1236)]),'hasTimings':!![]};}return{'lyrics':_0x2e7864[_0x3dae4d(0x19ee)]>0x0?_0x2e7864:[_0x3dae4d(0xcc6)],'timings':[],'hasTimings':![]};}function parseNeteaseBin(_0x17fb19){const _0x2f4609=_0x211817;try{const _0x4340d4=new Uint8Array(_0x17fb19);let _0x329916=0x0;while(_0x329916<_0x4340d4[_0x2f4609(0x19ee)]-0x4){if(_0x4340d4[_0x329916]===0x7b||(_0x4340d4[_0x329916]^0x64)===0x7b||(_0x4340d4[_0x329916]^0x4e)===0x7b)break;_0x329916++;}const _0x50831b=[()=>new TextDecoder(_0x2f4609(0x67e))['decode'](_0x4340d4[_0x2f4609(0x6d5)](_0x329916)),()=>{const _0x41837d=_0x2f4609;let _0x153e94='';for(let _0x5ad9bb=_0x329916;_0x5ad9bb<_0x4340d4[_0x41837d(0x19ee)];_0x5ad9bb++){_0x153e94+=String['fromCharCode'](_0x4340d4[_0x5ad9bb]^0x64);}return _0x153e94;},()=>{const _0x155d4d=_0x2f4609;let _0xce0cec='';for(let _0x375308=_0x329916;_0x375308<_0x4340d4[_0x155d4d(0x19ee)];_0x375308++){_0xce0cec+=String[_0x155d4d(0x2175)](_0x4340d4[_0x375308]^0x4e);}return _0xce0cec;}];for(const _0x31d5de of _0x50831b){try{const _0x2fc30d=_0x31d5de();try{const _0x2863b8=JSON[_0x2f4609(0x22d3)](_0x2fc30d);if(_0x2863b8[_0x2f4609(0x2126)])return parseLRC(_0x2863b8[_0x2f4609(0x2126)]);if(_0x2863b8[_0x2f4609(0x134d)]&&_0x2863b8[_0x2f4609(0x134d)][_0x2f4609(0x2126)])return parseLRC(_0x2863b8[_0x2f4609(0x134d)][_0x2f4609(0x2126)]);}catch(_0xb7cad3){if(_0x2fc30d[_0x2f4609(0x1831)]('[')&&_0x2fc30d[_0x2f4609(0x1831)](']'))return parseLRC(_0x2fc30d);}}catch(_0x54f3ff){continue;}}return{'lyrics':[_0x2f4609(0x1bd0),_0x2f4609(0x1f96)],'timings':[],'hasTimings':![]};}catch(_0x10a286){return console[_0x2f4609(0x174a)]('解析bin歌词失败:',_0x10a286),{'lyrics':[_0x2f4609(0xe5e)],'timings':[],'hasTimings':![]};}}let musicPlayer={'isPlaying':![],'currentSong':null,'playlist':[],'currentIndex':0x0,'currentTime':0x0,'totalTime':0x0,'isVinylMode':!![],'currentLyricIndex':0x0,'listeningStartTime':null,'totalListeningTime':0x0,'playMode':_0x211817(0x22d7),'audioElement':null,'albumCover':null,'listeningTimer':null,'activeChatId':null,'isActive':![],'audioCache':new Map(),'maxCacheSize':0x3};function getAudioUrl(_0x190a2c){const _0x51ad64=_0x211817;if(!_0x190a2c[_0x51ad64(0xc2e)]||!_0x190a2c['url'][_0x51ad64(0x1b30)]('data:'))return _0x190a2c[_0x51ad64(0x40f)];return console[_0x51ad64(0x2187)]('🎵\x20使用本地文件base64\x20URL:',_0x190a2c[_0x51ad64(0x378)]),logMemoryUsage(_0x51ad64(0x1886)),_0x190a2c[_0x51ad64(0x40f)];}function clearAudioCache(){const _0x46cedf=_0x211817;for(const [_0x3f2a7d,_0x4f7980]of musicPlayer['audioCache']){_0x4f7980[_0x46cedf(0x1b30)]('blob:')&&URL[_0x46cedf(0x112a)](_0x4f7980),console[_0x46cedf(0x2187)](_0x46cedf(0x1b4b),_0x3f2a7d);}musicPlayer[_0x46cedf(0x350)][_0x46cedf(0xa4f)]();}function logMemoryUsage(_0x1caa6a=''){const _0x6973af=_0x211817;if(performance['memory']){const _0x2036bc=performance[_0x6973af(0x20df)],_0x1edd5d=Math['round'](_0x2036bc[_0x6973af(0x2143)]/0x400/0x400),_0x53bf74=Math[_0x6973af(0x13e2)](_0x2036bc['totalJSHeapSize']/0x400/0x400),_0x486dfb=Math[_0x6973af(0x13e2)](_0x2036bc['jsHeapSizeLimit']/0x400/0x400);console[_0x6973af(0x2187)](_0x6973af(0xd21)+_0x1caa6a+':\x20'+_0x1edd5d+_0x6973af(0x1908)+_0x53bf74+_0x6973af(0x2015)+_0x486dfb+_0x6973af(0x60c)),_0x1edd5d/_0x486dfb>0.8&&console[_0x6973af(0x1f43)](_0x6973af(0x1c1));}};async function initializeMusicPlayer(){const _0x45acd7=_0x211817;try{const _0x5a9db3=await db['musicPlaylist'][_0x45acd7(0xe30)](_0x45acd7(0x293))[_0x45acd7(0xf13)]();musicPlayer[_0x45acd7(0x1ef9)]=_0x5a9db3;if(_0x5a9db3[_0x45acd7(0x19ee)]>0x0&&!musicPlayer[_0x45acd7(0x1f1)]){const _0x25f643=_0x5a9db3[0x0];let _0x517396=null;if(_0x25f643[_0x45acd7(0x21cb)]){const _0x4856e8=await db['musicCovers']['get'](_0x25f643[_0x45acd7(0x21cb)]);_0x4856e8&&(_0x517396=_0x4856e8[_0x45acd7(0x6bb)]);}musicPlayer['currentSong']={..._0x25f643,'coverImageData':_0x517396},musicPlayer[_0x45acd7(0x213f)]=0x0;}}catch(_0x2de5d9){console[_0x45acd7(0x174a)]('初始化音乐播放器失败:',_0x2de5d9),musicPlayer[_0x45acd7(0x1ef9)]=[];}const _0x2c614f=document[_0x45acd7(0x1262)]('modal-current-time'),_0x5a2a99=document[_0x45acd7(0x1262)]('modal-total-time');if(_0x2c614f)_0x2c614f[_0x45acd7(0x13be)]=_0x45acd7(0xdfd);if(_0x5a2a99)_0x5a2a99[_0x45acd7(0x13be)]=_0x45acd7(0xdfd);}async function openMusicPlayer(){const _0x3d38b1=_0x211817;await initializeMusicPlayer();const _0x270d28=document['getElementById'](_0x3d38b1(0x12a3)),_0x563cca=document[_0x3d38b1(0x1262)]('music-status-display'),_0x2d5ea6=document[_0x3d38b1(0x1262)]('phone-screen');if(_0x270d28&&_0x2d5ea6){const _0x19935a=_0x2d5ea6[_0x3d38b1(0x1fc0)]();_0x270d28[_0x3d38b1(0x14eb)]['top']=_0x19935a[_0x3d38b1(0x825)]+'px',_0x270d28['style']['left']=_0x19935a['left']+'px',_0x270d28['style'][_0x3d38b1(0x12f1)]=_0x19935a[_0x3d38b1(0x12f1)]+'px',_0x270d28['style'][_0x3d38b1(0xe6b)]=_0x19935a[_0x3d38b1(0xe6b)]+'px',_0x270d28[_0x3d38b1(0x14eb)][_0x3d38b1(0x4da)]='block',updatePlayerBackground();}_0x563cca&&(_0x563cca[_0x3d38b1(0x14eb)][_0x3d38b1(0x4da)]='flex');!musicPlayer[_0x3d38b1(0x1f1)]&&musicPlayer['playlist']['length']>0x0&&(musicPlayer[_0x3d38b1(0x1f1)]=musicPlayer[_0x3d38b1(0x1ef9)][0x0],musicPlayer[_0x3d38b1(0x213f)]=0x0,updateMusicDisplay());musicPlayer[_0x3d38b1(0x887)]=currentChatCharacter?currentChatCharacter['id']:null;const _0x1429e4=!musicPlayer[_0x3d38b1(0x12ec)];musicPlayer['isActive']=!![],_0x1429e4&&(musicPlayer[_0x3d38b1(0x22de)]=0x0),startListeningTimer(),updateListeningTime(),updatePlayModeButton(),updateMusicDisplay(),updateLyrics();}function _0x513f(){const _0x411bdb=['一起听歌','api-chat-input','---\x20[论坛收藏]\x20功能触发\x20---','🧠\x20群成员\x20','我的订单','_ui_settings','儿童装','记录这个日子','vinyl-artist-name','photos','AI返回的代码块格式错误:\x20','getContext','messageId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在重新生成心声...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请选择你的身份','coverImage','fas\x20fa-book','\x0a\x0a你们的关系记忆：\x0a','急性子','comment-item\x20moment-comment','selected-mentions','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20turtle-soup-settings-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3><i\x20class=\x22fas\x20fa-cog\x22></i>\x20海龟汤游戏设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4><i\x20class=\x22fas\x20fa-list\x22></i>\x20游戏类型偏好</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22turtle-soup-types\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22classic\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>经典推理</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>传统海龟汤，注重逻辑推理</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22horror\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-ghost\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>恐怖悬疑</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>带有恐怖元素的推理故事</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22funny\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-laugh\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>轻松搞笑</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>幽默有趣的推理题目</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22romantic\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>浪漫情感</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>以爱情为主题的推理故事</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22turtle-soup-type-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22turtleSoupType\x22\x20value=\x22random\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22type-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-random\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>随机选择</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>随机从所有类型中选择</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4><i\x20class=\x22fas\x20fa-user-tie\x22></i>\x20DM性格设置</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dm-personality-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22friendly\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>友善型\x20-\x20温和耐心，给予鼓励</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22mysterious\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>神秘型\x20-\x20保持神秘感，简洁回答</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22dm-personality-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22dmPersonality\x22\x20value=\x22humorous\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>幽默型\x20-\x20风趣幽默，活跃气氛</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22saveTurtleSoupSettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存API设置失败:\x20','爱丽思','找不到对应的用户消息','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>角色：</strong>','character-phone-screen','/sw.js','转发消息数量:','&id,\x20blockerId,\x20blockedId,\x20timestamp,\x20reason','shopping-screen','modal-play-btn','\x0a#\x20角色：论坛回复生成AI\x0a用户在论坛发了一个帖子，请生成8-12条真实的回复。\x0a\x0a##\x20用户帖子:\x0a标题:\x20','emoji-library-title','🔍\x20[triggerSmartReply]\x20合并后的消息:','角色专属音效已禁用','general','<span\x20class=\x22forum-loading-spinner\x22></span>','add','block_','歌曲加载失败，请检查URL是否正确','\x20的关系:','\x22\x20alt=\x22你\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>你</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20[简单修复]\x20群聊身份设置修复启动...','playlist-items','addEventListener','\x20的足迹，实时追加新足迹（缓存失败但DOM更新）','🔥\x20[紧急清理]\x20总共清理了\x20','onerror','isComplete','sms-message\x20','❌\x20完整导出失败:','内存中角色数量:\x20','widget-anniversary-name','turtleSoupSettings','<div\x20class=\x22pinned-card-background\x22\x20style=\x22background-image:\x20url(\x27','\x0a1.\x20请你以你的角色的身份，严格按照角色设定进行回复和行动，不要跳出角色。自然地推进剧情。\x0a2.\x20你可以一次性生成多条消息，模拟真人在聊天中连续发送多条信息的情景。\x0a3.\x20你的回复必须是一个JSON数组格式的字符串，每个元素是一条消息。\x0a\x0a#\x20JSON输出格式示例:\x0a[\x22很高兴认识你呀，在干嘛呢？\x22,\x20\x22今天天气真好\x22,\x20\x22想出去走走吗？\x22]','🚫\x20[设置更改]\x20','recalled_message','：\x22约会约会！不见不散哦～\x22','worldbooks','🔍\x20[renderForwardedMessage]\x20转发消息数量:','settings-section','\x20(窗口','--offline-ai-bold-text-color','past','修复消息时间戳:\x20','min','20px\x20Arial','&id,\x20groupId,\x20characterId','🔍\x20[群聊表情包]\x20找不到匹配的表情包:','appointment-pinned','1TB','.color-option','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20没有自定义主题，无需清除样式','联系人列表元素存在:\x20','已接通视频通话','message-wrapper\x20system','\x20条差异','编辑约定','头像压缩失败，使用原图:','AI回复','rgba(255,\x20193,\x207,\x200.12)','sounds','\x20距离上次更新仅','.result-bar-bg','[AI尝试发起代付请求，已忽略]','请至少选择一个选项','📊\x20估算数据大小:\x20','\x27)\x22\x20title=\x22预览主题\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-chat-btn\x20remove-theme-btn\x22\x20onclick=\x22removeChatTheme(\x27','\x0a\x0a#\x20与','拉黑反应保存失败，回退到全量保存:','你们已成功添加为好友，现在可以开始聊天了！','🔇\x20已停止所有音效','找不到对应的表情包','\x22\x20的帖子里，你看到了用户的一条新评论。\x0a\x0a帖子内容:\x0a','\x20个聊天窗口','✅\x20测试约定创建成功','（包含核心数据：角色、消息、记忆系统、世界书、论坛等）',',\x20最近7天跨应用活动:\x20','&id,\x20songId,\x20imageData,\x20timestamp','\x0a\x20\x20-\x20','抱歉，我现在无法回复。','order','📊\x20当前线下消息数组:\x20','Apple','瑞幸咖啡','\x0a\x0a最近的动态内容和讨论：\x0a','bottom-comment-text','.footprint-item','🆘\x20恢复紧急备份数据','\x22\x20alt=\x22','🔍\x20[引用回复-早期分支]\x20设置群聊发送者:','我已经付','user_poke','daysDiff','animation','offline-history-modal','数据清理保存失败，回退到全量保存:','原文：','🔍\x20角色备注调试信息:','background-image:\x20url(','步\x0a-\x20聊天情况：','.single-chat-only','🧠\x20已获取全局记忆上下文，总长度:','运动服','马卡龙','♪\x20享受音乐时光','🔥\x20[主动聊天]\x20无效的消息数据:','\x20个角色</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22multiselect-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22showMoveToGroupModal()\x22\x20class=\x22multiselect-btn\x20move-btn\x22\x20title=\x22移动到分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-folder\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>移动</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22deleteSelectedCharacters()\x22\x20class=\x22multiselect-btn\x20delete-btn\x22\x20title=\x22删除选中角色\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22exitMultiSelectMode()\x22\x20class=\x22multiselect-btn\x20cancel-btn\x22\x20title=\x22取消多选\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>取消</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','开始从导出数据恢复...','setting-item','pulse\x201.5s\x20infinite','吃瓜网友','✅\x20[高效错误消息]\x20消息已保存到数据库','visibility-groups-section','music-status-display','角色状态:\x20','url-preview','确定要清空所有投票历史吗？此操作不可恢复。','🎭\x20生成备用故事:','preset-action-btn\x20use-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-subtitle\x22>订单支付成功</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-order-number\x22>订单号：','🎨\x20自定义CSS已应用（标准模式）','high','✅\x20聊天设置已保存到IndexedDB\x20(角色:\x20','15L','start-selection-btn','cart-items-container','block-manage-desc','今天还没有日记可以编辑','\x20更换了头像','🔥\x20[论坛回复生成]\x20','我明白了，我会生成论坛帖子的JSON数组格式：[{\x22authorName\x22:\x22用户名\x22,\x22title\x22:\x22标题\x22,\x22content\x22:\x22内容\x22}]，绝对不会输出聊天消息格式。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x20💰\x20记忆总消耗:\x20~','请先从相册选择一张图片作为壁纸','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-overlay\x22\x20onclick=\x22closeModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20vote-history-modal\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>我的投票历史</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22closeModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-history-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','编辑剧情总结失败:','无法解析单个JSON对象:','蓝月亮','\x20条错误的聊天记录','🔍\x20[processAIReply开关调试]\x20apiSettings:','（已拒绝）','红烧茄子','🛒\x20[界面更新]\x20更新代付请求显示:','棋子显示已更新\x20-\x20用户执子:','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>No.','自动保存API设置失败:','保存角色时发生错误:\x20','🔧\x20检测到Chrome浏览器，启用兼容性增强模式','海底捞','界面设置已重置','覆盖面积','📋\x20当前所有世界书数据:','.custom-confirm','默认身份','AI回复用户失败:','memory-mount-modal','请先在API设置中填写密钥','的语音电话','行李箱','❌\x20保存聊天主题失败\x20(','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-choice\x22>选择了：','：\x22每年的这一天，我都会想起当时的情景。\x22','mouseup','12:07','黛安芬','拒绝付款','设置我方气泡颜色','后台聊天失败:','群聊不支持电话通话','\x20个角色的旧数据，保存了\x20','\x20\x20📝\x20总消息数:\x20','worldbookMountEnabled','new-group-name','小时前发布）','.mention-item','请输入有效的图片URL','.chat-container','moments_reply_to_user','mentions','❌\x20调试数据库类型失败:','使用默认生成的头像','.color-option-text','所有角色:','📱\x20角色状态显示功能已加载','&id,\x20title,\x20artist,\x20album,\x20duration,\x20url,\x20coverImage,\x20lyrics,\x20addedTime,\x20isLocalFile','\x27)\x22\x20title=\x22查看详情\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-action-btn\x20delete\x22\x20onclick=\x22deleteOfflineHistory(\x27','core','%)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','未知聊天','确定要认输吗？','alt','用户创建了约定\x22','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22persona-action-btn\x20persona-delete-btn\x22\x20onclick=\x22deletePersona(\x27','[转账：','🔍\x20[buildCharacterPrompt]\x20是否为群聊:','quota','检测到localStorage中的世界书数据，开始迁移...','刷新心声失败','当前导入函数源码长度:','browser-frame','eventData','热心网友','status-icon-input','supportedGenerationMethods','next','保暖手套','📚\x20读书笔记','postData','settings-storage-size','\x20个模型','Type-C','已结束线下模式','群聊名称','moments-username','characterStatusEnabled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-history\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-history\x22\x20style=\x22font-size:\x2048px;\x20color:\x20#ccc;\x20margin-bottom:\x2015px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有线下模式聊天记录</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#999;\x22>完成线下剧情对话后，选择\x22结束且不总结\x22或\x22结束并总结\x22，聊天记录会保存在这里</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','群聊消息:\x20','找不到character-status-enabled元素','library_','游戏结束，结果：','你已将群昵称修改为\x20\x22','音效试听失败\x20(','不愿意购买','🔥\x20[callForumAPI]\x20API密钥未设置','exportTime','还有其他可能性','请填写约定名称','请先选择要删除的帖子','转发消息单条保存失败，回退到批量保存:','###\x20','加载聊天消息失败:','16:45','--custom-continue-btn','\x0a===\x20数据状态检查结果\x20===\x0a\x0a📊\x20IndexedDB\x20数据：\x0a-\x20角色数量:\x20','groupId','honey','data','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20400px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑表情包描述</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close-btn\x22\x20onclick=\x22closeEmojiDescriptionModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-preview\x22\x20style=\x22text-align:\x20center;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','🧠\x20测试全局记忆上下文构建...','offlineMessages_','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-more-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20弹出的操作菜单\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-actions-popup\x22\x20id=\x22moment-actions-','QuotaExceededError','⏰\x20记忆天数设置:\x20','forum-form-id','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-date\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-preview\x22>','🔔\x20[推送通知]\x20用户不在主屏幕或正在和该角色聊天，不显示推送','Hugo\x20Boss','stopSound','今日摘要已生成：\x0a\x0a','获取日记设置失败:','\x20\x20-\x20角色ID:','#333','\x20日记内容生成结果:','authorId','parse','appointments','OPI','\x20回复了你','sequential','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-title\x22>','清空所有数据','post-image-preview','.comment-time','\x20条孤立数据','棒球帽','totalListeningTime','许留山','circle','✅\x20音效已清除:\x20','承担不起','wallpaperData','fas\x20fa-star','角色ID:\x20','anniversary-shared','\x0a\x0a##\x20**当前情景:**\x0a','无特殊设定','❌\x20迁移足迹记录失败\x20','开头:','世界书条目','100ml','.mini-app[onclick=\x22showApp(\x27chat-screen\x27)\x22]\x20.mini-app-icon','聊天设置按钮样式已设置',',\x20\x27chat\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-header\x22>论坛帖子分享</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-title\x22>','\x20定时器已设置，ID:\x20','成功：总金额¥','ringing-animation','的关系，这决定了你的态度和语气\x0a3.\x20**内容理解**：仔细分析动态内容，如果是表白、炫耀、求助等特殊内容，要有相应的反应\x0a4.\x20**情绪一致**：你的评论情绪要与你对这个人的真实感受一致\x0a\x0a##\x20🎭\x20角色表现要求：\x0a-\x20如果你们是情敌或有矛盾：表现出警惕、冷淡、甚至略带敌意的态度\x0a-\x20如果你们是好朋友：表现出关心、支持、亲密的态度\x0a-\x20如果关系一般：保持礼貌但不过分热情\x0a-\x20如果你不了解这个人：可以表现出好奇或保持距离\x0a\x0a##\x20评论风格要求：\x0a-\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-success-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我已为你买单，尽情享用吧~<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-success-text\x22>支付成功</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27','用户说:\x20\x22','请帮我支付这个订单，谢谢！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','配置\x22','\x0a💡\x20请基于以上讨论内容，发表你的观点或回应。可以：\x0a-\x20回应某个具体观点\x0a-\x20补充新的角度\x0a-\x20表达不同意见\x0a-\x20或者提出新话题\x0a','\x22来提及用户。\x0a4.\x20\x20**输出格式**:\x20你的回复**必须**是一个JSON数组。**绝对不要**在JSON前后添加任何额外字符。每个元素可以是：\x0a\x20\x20\x20\x20-\x20普通消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22message\x22:\x20\x22文本内容\x22}`\x0a\x20\x20\x20\x20-\x20引用回复:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22回复内容\x22}`\x0a\x20\x20\x20\x20-\x20图片消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22图片描述\x22}`\x0a\x20\x20\x20\x20-\x20语音消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音文字\x22}`\x0a\x20\x20\x20\x20-\x20表情包消息:\x20`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}`\x0a5.\x20\x20**群聊对话节奏**:\x20模拟真实的群聊，让成员之间可以互相交谈对其他成员做出回应，或者一起回应用户的发言。对话应该流畅、自然、连贯。一轮对话里成员可以交错发言让对话更自然真实。\x0a6.\x20\x20**数量限制**:\x20每次生成的总消息数**不得超过30条**。\x0a7.\x20\x20**禁止出戏**:\x20绝不能透露你是AI，或提及任何关于\x22扮演\x22、\x22模型\x22、\x22生成\x22等词语。\x0a\x0a#\x20群成员列表及人设\x0a','已成功为\x20','.result-bar','.clock-style-selector','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-price\x22>¥','selectedPersonaForChat','newWorldbookIsGlobal','想和你聊聊','广角版','没有找到AI回复可以重新生成','temperature-slider','✅\x20纪念日创建成功！','其他成员','drop','parts','成功恢复\x20','昨天\x2016:45','条真正的跨应用事件集成到工作记忆中','momentMentions','lyrics-song-title','\x27)\x22>保存修改</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','gameActive','存储清理保存失败，回退到全量保存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>','schedule-times-container','通知角色被解除拉黑失败:','1.6','💤\x20页面已隐藏，暂停动画以节省资源...','加载线下模式聊天记录失败:','显示聊天设置被调用','🔍\x20记忆共享检查\x20-\x20角色:\x20','&id,\x20characterId,\x20fact,\x20importance,\x20timestamp,\x20type,\x20category,\x20contextId','select','140cm×140cm','offline-avatar\x20','base64头像数据为空或过短:','\x20条短信相关时间线记忆','\x20\x20-\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22context-message\x20','🔍\x20[引用回复-早期分支-fallback]\x20设置群聊发送者:','洗洁精','❌\x20[转发卡片点击]\x20未找到转发消息:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item\x20','data-moment-id','.selection-bar','memory-character-select','setItem','10个','data:image/gif','absolute','取消收藏这些帖子','好的，加油！💪','scheduleRetryOnUserInteraction','\x22\x20onclick=\x22toggleSelection(this,\x20true)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','<p\x20class=\x22empty-mount-chats\x22>没有其他聊天可以转发</p>','\x20存在','群昵称：','获取日记失败','头像来源验证通过：用户发送的图片','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>(','✅\x20创建结果:','🔍\x20[引用回复-主分支]\x20当前角色的消息数量:','\x0a-\x20**听歌时长:**\x20已经一起听了','system_command','请输入您的昵称:','&id,\x20authorId,\x20timestamp','新鲜黄瓜','#fff','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','regenerate-tool-item','\x20个角色的聊天记录','条评论)','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','generateReplyHTML','：\x22期待和你一起度过这个美好时光。\x22','✅\x20已删除\x20','👤\x20角色完整信息:','&id,\x20name','api-base','条跨场景记忆(标记⭐)，这些是不同聊天环境中的互动，请自然地联想和提及\x0a','\x20\x20-\x20活跃联系人数量:','import-file-input','offline-custom-font-style','insertAdjacentHTML','错误：没有帖子ID','🔍\x20[processAIReply动图检测]\x20是否为GIF表情包:','AI返回的JSON格式错误，无法修复。','\x0a\x0a在一个动态的评论区，','\x20失败:\x20','投票失败，请重试','🔍\x20开始浏览器兼容性检查...','📊\x20表\x20','🛒\x20[parseAiResponse-第二处]\x20AI尝试发起代付请求，已忽略:','⚠️\x20内存使用过高，建议清理缓存','🔍\x20开始数据库状态诊断...','timestampPosition','glm-4v','🔥\x20[页面失焦]\x20标记当前聊天为已读:','从localStorage恢复设置失败:','bubble-style-','。现在处于线下剧情模式，请以纯文本形式回复，专注于情景描写和剧情发展。','.app-screen','🔄\x20正在恢复上次打开的聊天:','🔧\x20[简单修复]\x20群聊身份设置修复完成','❌\x20测试过程中发生错误:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-hint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚨\x20[URGENT]\x20详细检查所有表情包数据...','estimate','正在生成剧情总结...','🔔\x20角色突然想要打电话（随机触发）','天前)','text-shadow','\x27,\x20false,\x20\x27','请填写完整的API配置信息','isDefault','every','需要更多证据','gomoku-board','getMonth','设置气泡颜色','🔍\x20[群聊身份]\x20未找到成员:',');\x20background-size:\x20cover;\x20background-position:\x20center;','\x20因为概率未通过，不会回复其他角色的评论','\x0a\x0a重要提醒：\x0a1.\x20只能选择空位（·）下棋\x0a2.\x20坐标格式：row(行)和col(列)都是0-14的整数\x0a3.\x20优先考虑：获胜机会\x20>\x20阻止对手获胜\x20>\x20形成威胁\x20>\x20防守\x0a4.\x20体现你的性格特点\x0a\x0a请分析棋局并选择你的下一步，必须严格按照JSON格式回复：\x0a\x0a{\x0a\x20\x20\x20\x20\x22row\x22:\x20整数(0-14),\x0a\x20\x20\x20\x20\x22col\x22:\x20整数(0-14),\x0a\x20\x20\x20\x20\x22reasoning\x22:\x20\x22简短解释选择这个位置的原因\x22\x0a}\x0a\x0a注意：只返回JSON，不要有其他文字！','不愿意支付','请先选择要删除的角色','.visibility-icon','🔧\x20[API设置]\x20已迁移localStorage设置到IndexedDB','正在创建下载文件...','</textarea>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20cancel-btn\x22\x20onclick=\x22closeEmojiDescriptionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-btn\x20confirm-btn\x22\x20onclick=\x22saveEmojiDescription(\x27','full-lyrics-display','<p><strong>描述：</strong>','emoji-grid','===\x20紧急数据恢复开始\x20===','中高频','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20','custom-item-description','一个女人每天照镜子时都看到另一个女人，但她并不害怕。','预览主题失败:','.shape-radio-option','更新角色完成:','currentSong','</span>','music_','没有发现需要清理的动态','恢复紧急备份失败:','评论了动态','\x0a\x0a##\x20提取标准\x0a\x0a###\x20核心记忆（importance\x20>=\x200.9）\x0a只有以下类型的信息才能成为核心记忆：\x0a-\x20用户的基本信息：真实姓名、生日、职业、家庭成员\x0a-\x20重大情感转变：表白、分手、和好、深度情感交流\x0a-\x20重要承诺和约定：长期计划、重要约定\x0a-\x20关键人生事件：毕业、工作变动、搬家、重要纪念日\x0a-\x20角色与用户关系的重大变化\x0a\x0a###\x20情景记忆（importance\x200.6-0.8）\x0a日常但有意义的事件：\x0a-\x20一起做的活动和体验\x0a-\x20用户的习惯和偏好\x0a-\x20有趣的对话和互动\x0a-\x20日常生活的分享\x0a\x0a##\x20重要要求：记忆描述必须使用第三人称\x0a-\x20用\x22用户\x22指代用户，用\x22','删除失败：未找到指定的世界书','href','确定要删除这个世界书吗？','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>图片：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-image\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','生成剧情总结失败:','16:54','不支持的记忆类型','global-add-button-preview','custom-prompt-confirm','aiCallGreeting','🔥\x20[论坛帖子生成]\x20未找到完整代码块，检查是否为截断的JSON','拒绝下单','content-top-margin-slider','.woff','：\x22这是我们之间重要的转折点。\x22','setSelectionRange','&id,\x20characterId,\x20date,\x20summary,\x20timestamp,\x20context','MAX_EPISODIC_MEMORIES_PER_CHARACTER','嗯，让我想想...','🔔\x20[推送通知]\x20找不到回复角色，跳过推送通知创建，replyingCharacterId:','.theme-scope-option','戳一戳后缀设置已保存','nickname-settings-modal','<strong>$1</strong>','继续之前暂停的游戏','\x0a\x0a请分析用户和角色这轮的讨论，并给出合适的回应：\x0a\x0a1.\x20如果包含明确的是/否问题，请回答\x22是\x22、\x22否\x22或\x22无关\x22\x0a2.\x20如果是讨论和推理，给予适当的引导和鼓励\x0a3.\x20如果推理方向正确，给予肯定和提示\x0a4.\x20如果推理偏离，给予温和的纠正\x0a5.\x20如果讨论停滞，提供新的思考角度\x0a6.\x20保持神秘感，不要直接透露答案\x0a7.\x20回答要简洁明确（不超过30字）\x0a\x0a重要：请直接输出纯文本回答，不要使用JSON格式或数组格式。\x0a\x0a请给出你的回应：','准备添加约定数据:','CORE_MEMORY_IMPORTANCE_THRESHOLD','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22saveStorylineSummary(\x27','⚠️\x20[日记定时器]\x20延迟时间为负数或零，立即触发','切换静音模式失败:','photo-description-close','身份选择点击:','private_chat','paymentStatus','的相关私聊记忆：\x0a','普通装','.character-selection-item','\x0a\x0a请作为','block_user','18px\x20Arial','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>','confirm-group-persona-btn','customEmojis','home-grid','请在下方CSS代码区域自定义气泡样式','✅\x20[高效群头像更换]\x20消息已保存到数据库','turtle-soup-story-content','全局设置:\x20','AI回复消息','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','textAlign','牛奶\x20-\x202盒\x0a面包\x20-\x201袋全麦面包\x0a鸡蛋\x20-\x201打\x0a苹果\x20-\x205个红富士\x0a香蕉\x20-\x201串\x0a酸奶\x20-\x204杯\x0a胡萝卜\x20-\x20500g\x0a西红柿\x20-\x203个\x0a洗发水\x20-\x201瓶\x0a牙膏\x20-\x201支\x0a\x0a记得去超市的时候带购物袋，环保又实用！','input[name=\x22memoryDays\x22][value=\x22','聊天设置:\x20','播放失败:','clientX','game-menu-modal','❌\x20[Gemini\x20API]\x20图片格式解析失败','blacklist','game_memory_','bubble-opacity','localStorage容量不足，已清理群聊备份','这个问题很有趣，但答案是否定的。','playing','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>','🔍\x20[表情包调试]\x20表情包URL:','smooth','20片','最早消息:\x20','🔥\x20[短信AI回复]\x20开始生成回复，角色:','\x20对动态\x20','\x20条重复)','12.9英寸','⚠️\x20未找到有效的JSON格式','🔥\x20AI请求撤回上一条消息:','•\x20让群聊对话体现出你们私下的熟悉程度和连续性，而不是陌生的群聊互动\x0a','settingValue','播放歌曲失败，请重试','不包含：动态、表情包、音乐等扩展数据\x0a\x0a','分钟（后台运行）','群聊AI响应不是数组格式','search-chat-modal','font-size','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存线下模式界面设置失败:','一个女人半夜惊醒，发现丈夫不在身边，于是立刻报警。','no-repeat','...\x22','是不是','offline-ai-bubble-color','offline-custom-style-style','onpause','音效播放失败\x20(','transfer-reject-btn','找不到文件上传元素，请刷新页面重试','已取消屏蔽\x20','\x20条更新的消息\x0a\x0a是否恢复这些数据？','styleSheets','2TB','请输入模型名称（例如：meta-llama/Llama-2-7b-chat-hf）：','\x0a\x0a核心记忆（重要的长期记忆）：\x0a','gomoku_saved_game','礼盒装','gameEvents','anniversary-name','角色ID:','fullscreen-mode','emergencyCleanupDone','\x20项失败','testAppointmentReminder','\x20(刚刚)','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-message\x22>','🧹\x20文本无效，使用备用回复','#chat-screen\x20.app-header','数据恢复失败:','🔍\x20[triggerSmartReply]\x20添加位置消息:','✅\x20强制回复成功:\x20\x22','🎨\x20自定义主题样式清除完成','（已支付）','10ml','ai_message','当前游戏还在进行中，确定要开始新的一局吗？','生成回复失败','#forum-worldbook-selection\x20.selection-item[data-id=\x27','\x20已将你拉黑','75B','worldbook-mount-modal','智能手表','\x20条记忆摘要','状态良好','找不到要编辑的论坛','票\x20(','fillStyle','50片','❌\x20恢复紧急备份失败:\x20','这是一个测试纪念日','[语音]','.color-option-text[data-color=\x22','清空数据失败:','的海龟汤推理故事。\x0a\x0a要求：\x0a1.\x20故事要有一个看似不合理或令人困惑的情景描述（汤面）\x0a2.\x20要有一个合理的解释或真相（汤底）\x0a3.\x20真相要能够通过是/否问题逐步推理出来\x0a4.\x20故事要有趣且逻辑合理\x0a5.\x20适合多人推理讨论\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22故事标题\x22,\x0a\x20\x20\x20\x20\x22story\x22:\x20\x22汤面描述（看似不合理的情景）\x22,\x0a\x20\x20\x20\x20\x22answer\x22:\x20\x22汤底真相（合理的解释）\x22,\x0a\x20\x20\x20\x20\x22difficulty\x22:\x20\x22easy/medium/hard\x22,\x0a\x20\x20\x20\x20\x22tags\x22:\x20[\x22类型标签\x22]\x0a}\x0a\x0a只返回JSON，不要其他文字。','\x0a🚨\x20发现记忆归属问题:','_regen_','2.5m宽','Gemini\x20API请求失败:\x20','persona-selection-group-modal','个群聊共享','迁移角色\x20','解析群聊AI响应失败:','object','media','1个时间点\x20(','🔄\x20','✅[修复]\x20新联系人保存成功，内存中的\x20contacts\x20列表:','[data-memory-id=\x22','addedTime',',\x20消息数:\x20','解析结果格式不正确','约定已完成','条情景记忆、','没有可用的头像','import-file-info','加载角色数据失败:','.\x20角色\x20','未找到radio选项容器:','emojiDescription','\x20个\x0a-\x20聊天备份:\x20','📱\x20短信事件\x20','\x0a\x0a确定继续？','characterAvatar','足迹已更新','bulkAdd','今天是','我给你购买','统计角色\x20','条线下剧情记忆(🎭)，这些是深度互动的回忆，可以自然地提及相关情节\x0a','重新生成删除消息失败，回退到批量保存:','纪念日','AI_EXTRACT_INTERVAL','用户头像:\x20已设置','backgroundChatEnabled','<i\x20class=\x22fas\x20fa-play\x22></i>','image/*,.jpg,.jpeg,.png,.gif,.webp','data-transfer-id','custom','waiting','🔍\x20检测AI回复中的纪念日创建意图...',',\x20不是用户:\x20','[\x22调用失败:\x20','chat-selection-list','请先选择要删除的对话','🎨\x20应用的全局样式:','生成备忘录失败:','diary-preview-content','\x0a\x0a请生成主动聊天的消息（可以是1-12条），以JSON数组格式返回：','character-video-avatar-preview','entries','.otf','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteWorldbook(\x27','\x0a全局记忆:\x0a','SUMMARY_TRIGGER_TIME_HOURS','memoryMountCount','请输入新的记忆内容','system_notification','🔍\x20[parseAiResponse]\x20JSON解析失败，使用fallback处理，结果:','.app[onclick=\x22showApp(\x27','touches','发现数据完整性问题，请查看详情','📋\x20评论筛选:\x20','currentLyric','friendRequestAccepted','.profile-tab[onclick*=\x22','[momentId+authorId],\x20momentId,\x20authorId','还有其他可能吗？','🔄\x20开始迁移足迹数据从localStorage到Dexie数据库...','\x0a#\x20**首要规则：输出格式**\x0a你的所有回复，**【必须】**、**【严格】**遵循JSON数组格式。这是一个绝对的、不可违反的规则。\x0a\x0a##\x20**正确格式示例:**\x0a-\x20**普通文本:**\x20`[\x22你好\x22]`\x0a-\x20**多条消息:**\x20`[\x22你好\x22,\x20\x22今天天气不错！\x22]`\x0a-\x20**引用回复:**\x20`[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题...\x22}]`\x20(常用功能)\x0a-\x20**撤回消息:**\x20`[{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]`\x20(当后悔刚才说的话、觉得说错话时使用)\x0a-\x20**表情包:**\x20`[{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22}]`\x0a-\x20**语音消息:**\x20`[{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22我等下和你说。\x22}]`\x0a-\x20**转账:**\x20`[{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20520,\x20\x22note\x22:\x20\x22给你的奖励\x22}]`\x0a-\x20**更换头像:**\x20`[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22心情变化\x22}]`\x0a-\x20**发送照片:**\x20`[{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22我刚拍的窗外风景，阳光透过树叶洒在地上。\x22}]`\x20(必须使用ai_photo作为type)\x0a-\x20**发送位置:**\x20`[{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}]`\x20(必须使用location作为type)\x0a-\x20**混合消息:**\x20`[\x22嗨！\x22,\x20{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22太阳\x22}]`\x0a\x0a##\x20**【绝对禁止】的错误格式:**\x0a-\x20**错误1\x20(合并消息):**\x20`[\x22你好\x5cn今天天气不错！\x22]`\x20<==\x20这是最常见的错误，绝对禁止！\x0a-\x20**错误2\x20(非数组):**\x20`\x22你好\x22`\x0a-\x20**错误3\x20(无效JSON):**\x20`[{\x27type\x27:\x20\x27emoji\x27}]`\x0a\x0a#\x20**你的角色与任务**\x0a你现在扮演名为\x22','group-member-colors-modal','Toggle\x20moment\x20mention:','fas','✅\x20角色所有专属音效已清除:\x20','获取足迹缓存失败:','修复失败:','random_song','1.5斤','size','📱\x20输入框获得焦点，防止自动缩放','phoneContactsChats','\x20的无效头像','🔍\x20[parseAiResponse-第二处]\x20AI主动戳一戳:','聊天记录恢复完成','image-preview-modal','✅\x20自动保存完成','global-bg-input','\x0a\x0a现在是','豆沙色','工作日上午，可能有人在摸鱼、偷偷刷论坛、讨论课程或工作','用户先行','🚫\x20[全局初始化]\x20','获取聊天记录失败:','未知错误','transfer-confirm-modal','.jpg','isUserInitiatedCall','now','📝\x20检测到AI约定创建指令:','让我想想这个可能性','我们约好的','recall_previous','-custom-type-group','在群聊:','✅\x20约定列表已从数据库重新加载，数量:','✅\x20[高效解除拉黑反应]\x20消息已保存到数据库','暂无可邀请的角色，请先创建角色','.chat-input-area','📊\x20localStorage总使用量:\x20','🎭\x20用户输入:','fas\x20fa-comment-dots','在厨房准备食材','获取世界书失败:','[chatId+windowId]','变态辣','aiBubbleOpacity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-overlay\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>退出游戏</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22game-exit-desc\x22>游戏还在进行中，请选择退出方式：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20save-btn\x22\x20onclick=\x22exitGameWithSave()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-bookmark\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>保存并退出</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>游戏过程会被角色记住</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20clear-btn\x22\x20onclick=\x22exitGameWithClear()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eraser\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>清空并退出</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>清除所有记录，就像从未发生过</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20pause-btn\x22\x20onclick=\x22exitGameTemporary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-pause-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>暂时离开</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>保存状态，下次可以继续</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20game-cancel-btn\x22\x20onclick=\x22closeExitGameModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','你已屏蔽此群聊','\x0a-\x20','用户转账消息保存失败，回退到全量保存:','[此消息包含特殊格式，请重新输入内容]','你需要为角色生成从\x20','group-chat','\x0a\x0a你要作为','论坛参考的世界观设定\x20(世界书)','💡\x20[提示]\x20后台定时器由全局系统管理，请使用\x20initGlobalBackgroundInteractionSystem','正在通话中...','anniversary-screen','我结账','\x20主动聊天开关未开启','很紧凑','data-timestamp','reject','IndexedDB群聊数量:','\x0a#\x20记忆提取任务\x0a\x0a你需要从以下对话中提取两类记忆：核心记忆和情景记忆。\x0a\x0a##\x20角色信息\x0a-\x20角色名称:\x20','🔔\x20当前正在通话中，不触发新的来电','选择返回按钮样式来源','🎨\x20应用设置时无法读取CSS规则，使用提取的名称','toLocaleTimeString','🔍\x20[processAIReply]\x20用户消息','global-font-url','淡定的','42-43','system-message','\x20个聊天设置\x0a\x0a恢复的设置详情：\x0a\x0a','custom-theme-applied','blur(30px)\x20saturate(1.5)','AI戳一戳消息单条保存失败:','#ff3b30','✅\x20清除了\x20','#FF6B6B','DM回应格式不正确','sms','\x20在此时间段内AI未生成新活动，但更新时间戳以避免重复尝试','work_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>','userBoldTextColor','\x0a-\x20游戏时长：','已选择','从IndexedDB加载面具数据:','750ml','🔥\x20[AI撤回]\x20找到要撤回的现有消息，使用统一撤回逻辑','global-bottom-app-bar','，刚刚决定给用户打视频电话。\x0a\x0a请生成一句简短自然的开场白，说明你为什么要打这个视频电话：\x0a-\x20要符合你的性格特点\x0a-\x20像真实视频通话开始时的自然表达\x0a-\x201句话即可，不要超过20字\x0a-\x20直接说话，不要任何格式标记\x0a\x0a例如：\x0a-\x20\x22想看看你在做什么\x22\x0a-\x20\x22有个好消息想和你分享\x22\x0a-\x20\x22想看到你的笑容\x22\x0a\x0a请只回复开场白内容：','动态点赞:\x20','表情包库已删除','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22editGroup(\x27','角色数量:','♥️\x20<span\x20class=\x22heartrate-number\x22>','删除记忆失败:','请先选择要删除的消息','--custom-offline-btn','anniversary-form-modal','：\x22生日是值得庆祝的日子，我会好好记住的。\x22','my-bubble-opacity',',\x20type:\x20','innerHTML',')保存默认设置失败:','东北农场','table','32GB','✅\x20主题设置已迁移:\x20','[data-order-id=\x22','未运行','liked','10W','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-desc\x22>','background-chat-frequency','🎨\x20全局主题已应用到所有应用页面','edit-group-modal','[消息内容]','新鲜草莓','ArrowDown','AI返回的不是有效的JSON格式。原始响应:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>','备忘录数据未找到','ai-call-enabled','.offline-preview-message.ai\x20.offline-preview-content','audioCache','\x20条短信相关时间线记录','情节记忆','数据库中消息数量:\x20','backgroundMomentsEnabled','\x20的短信记录和记忆...','messageCount','收到用户消息','entry_','记忆不存在','\x20的聊天记录</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20*\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x27Segoe\x20UI\x27,\x20\x27PingFang\x20SC\x27,\x20\x27Hiragino\x20Sans\x20GB\x27,\x20\x27Microsoft\x20YaHei\x27,\x20Helvetica,\x20Arial,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f0f0f0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.6;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20800px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x200\x2010px\x20rgba(0,0,0,0.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.header\x20.info\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.9;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.chat-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20flex-end;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row-reverse;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.ai\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.system\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2010px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2070%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20word-wrap:\x20break-word;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom-right-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.ai\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#e5e5ea;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom-left-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.system\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f0f0f0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x206px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2060%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【新增】纪念日和约定提醒消息的特殊样式\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#FFE4E1,\x20#FFF0F5)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#FFB6C1\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message::before\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20content:\x20\x27📅\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#FF69B4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message-container.received\x20.message-bubble.reminder-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20reminderPulse\x202s\x20ease-in-out;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20reminderPulse\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20transform:\x20scale(1);\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x20transform:\x20scale(1.02);\x20box-shadow:\x200\x204px\x2016px\x20rgba(255,\x20182,\x20193,\x200.5);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20transform:\x20scale(1);\x20box-shadow:\x200\x202px\x208px\x20rgba(255,\x20182,\x20193,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.sender-name\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.sender-name\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.timestamp\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2011px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.timestamp\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.quote-block\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-left:\x203px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x200\x208px\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.quote-block\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-left-color:\x20rgba(255,255,255,0.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(255,255,255,0.2);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.quote-sender\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x202px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.message.user\x20.quote-sender\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,255,255,0.9);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.special-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-style:\x20italic;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f8f8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stats\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f8f8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20600px)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2085%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20加载动画\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20@keyframes\x20spin\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x20transform:\x20rotate(0deg);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x20transform:\x20rotate(360deg);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x0a\x0a\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20发帖模态框\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x202000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20500px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-height:\x2080vh;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2010px\x2030px\x20rgba(0,\x200,\x200,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-bottom:\x201px\x20solid\x20#eee;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20h3\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2018px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-close-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20label\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20textarea\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20vertical;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20input:focus,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20textarea:focus\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.char-count\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x205px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-footer\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#eee;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary,\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f5f5f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#e5e5e5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#0056CC;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20评论互动按钮\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-actions\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2015px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f5f5f5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn.liked\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ff3b30;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.reply-action-btn.liked\x20i\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ff3b30;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.like-count\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2011px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-width:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>与\x20','匿名模式已开启，点击关闭','保存日记到数据库失败:','...\x20(','只有群聊可以设置成员气泡颜色','🎨\x20没有主题数据可应用','🗑️\x20删除重复时间线记录:\x20','internal_action','data-clock-style','no-description','星期二','白云山','.moment-item[data-timestamp]','momentVisibility','.memory-edit-textarea','[论坛收藏]\x20UI已更新为\x22已收藏\x22状态。','🔥\x20[论坛帖子生成]\x20完整Prompt:','设置为创建模式，无角色ID','\x20\x20🟣\x20时间线记忆:\x20','🎭\x20=====\x20线下模式AI回复生成开始\x20=====','🔍\x20数据完整性诊断完成\x0a\x0a','preventDefault','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20600;\x20margin-bottom:\x208px;\x22>💡\x20提示</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>',')的评论！用户会自己评论！**\x0a\x0a##\x20回复生成要求:\x0a1.\x20\x20**🔥\x20识图优先**:\x20如果帖子有图片，你的回复必须优先围绕图片内容展开。\x0a2.\x20\x20**真实感**:\x20回复要像真人写的，有不同的观点和语气\x0a3.\x20\x20**多样性**:\x20包括赞同、反对、提问、分享经验、调侃等不同类型\x0a4.\x20\x20**角色分配**:\x0a\x20\x20\x20-\x2050%由虚构的路人网友回复（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2030%由上述角色回复，要符合人设，使用\x22网名(真实身份)\x22格式\x0a\x20\x20\x20-\x2020%由上述角色匿名回复，只使用网名，不暴露真实身份\x0a5.\x20\x20**互动性**:\x20可以@用户或其他回复者','✅\x20数据库中的设置已清除','offline-btn-preview','ai-heartrate-enabled','\x0a\x0a##\x20','维生素D','footprints_cache','title','🎨\x20聊天主题图片预加载完成','waitingModal','pending','bubble-preview','🎨\x20没有保存的全局主题','<div\x20class=\x22receipt-item\x22>','input[name=\x22sharedGroups\x22]:checked','.offline-preview-content',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','#chat-screen\x20.chat-header-actions','fas\x20fa-chess-board','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-message\x22>','.poll-option[data-selected=\x22true\x22]','😊\x20表情包：','video-call-floating-messages','preset-action-btn\x20delete-btn','狼人杀','🔍\x20[processAIReply多模态调试]\x20包含图片:','online','内存中联系人数量:\x20','green','界面设置已保存','✅[修复]\x20发现新联系人，正在同步保存...','拒绝结账','已经\x20','dbCount','\x20个记录，删除了\x20','次好友申请，但都被拒绝了。','红外体温计','未找到','\x27)\x22\x20','iPhone\x2015','🔍\x20[定时器执行检查]\x20','角色间互动失败:','已恢复\x20',']\x20情景记忆:\x20','短信消息:\x20','五分糖','<div\x20class=\x22transfer-status\x22>','西瓜汁',';\x20position:\x20relative;\x20padding:\x20','fas\x20fa-lock','fas\x20fa-users','\x20KB','戳了戳你','表情包识别已关闭','太贵了','chatContent','#test-unread','✅\x20[好友申请]\x20AI自然发送好友申请(第二处):','avatar_url','allLyrics','用户更新了纪念日\x22','该角色还没有参与任何群聊','记忆摘要已删除','\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20white;\x20font-weight:\x20bold;\x20font-size:\x2012px;\x20border-radius:\x2050%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20height:\x20100%;\x20color:\x20white;\x20font-size:\x2012px;\x22><i\x20class=\x22fas\x20fa-video-slash\x22></i></div>','removeItem','❌\x20找不到角色\x20ID:\x20','moment_like','时间线记忆是自动记录的活动日志，不支持编辑','🔍\x20渲染前数据状态检查:','👤\x20发布者:\x20','论坛\x20\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-actions\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22anniversary-action-btn\x20anniversary-edit-btn\x22\x20onclick=\x22showAnniversaryForm(\x27','条\x20(用户设置:\x20','modern','\x20在动态\x20','群聊消息','CSS代码已清除','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a现在你想再次尝试发送好友申请。请根据你的性格决定：\x0a1.\x20是否要再次尝试\x0a2.\x20如果尝试，应该说什么\x0a\x0a考虑因素：\x0a-\x20你已经被拒绝了','🔍\x20[Gemini\x20API]\x20检测到图片，开始处理...','找到了input元素，准备触发点击','userId','anniversary-character-quote','[不支持的消息格式]','游戏进行到第','🕐\x20[主动聊天时间检查]\x20','🔍\x20长按检测:','🔍\x20[图片分支动图检测]\x20是否为GIF表情包:','\x0a#\x20转账功能\x0a##\x20发起转账\x0a-\x20你可以在觉得需要安慰用户、过节庆祝、心情好或想要表达情感的时候考虑转账给用户。\x0a-\x20**重要**：若要转账，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20520,\x20\x22note\x22:\x20\x22一周年快乐~\x22}`。\x0a-\x20**禁止使用文字描述转账**：绝对不要用\x20\x22[我向用户发起了转账...]\x22\x20这种文字形式，必须使用JSON对象格式。\x0a-\x20转账示例：[\x22今天心情特别好~\x22,\x20\x22想给你一个小惊喜\x22,\x20{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x201314,\x20\x22note\x22:\x20\x22给小夜买漂亮裙子穿\x22}]\x0a\x0a##\x20收到用户转账的处理\x0a-\x20当用户给你转账时，历史记录中会显示\x20`[用户发起了转账：金额元，备注：xxx]`\x0a-\x20**重要**：你必须根据你的角色性格、当前心情和转账内容来决定是否收款：\x0a\x20\x20-\x20**如果收款**：你可以选择以下两种方式之一：\x0a\x20\x20\x20\x201.\x20**明确指令方式**（推荐）：在回复JSON数组中添加\x20`{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22accept\x22}`\x0a\x20\x20\x20\x202.\x20**关键词方式**：在回复中明确使用\x22收下\x22、\x22谢谢你\x22、\x22感谢你\x22、\x22收款\x22、\x22太贴心\x22等词语表达接受\x0a\x20\x20-\x20**如果退回**：你可以选择以下两种方式之一：\x0a\x20\x20\x20\x201.\x20**明确指令方式**（推荐）：在回复JSON数组中添加\x20`{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22reject\x22}`\x0a\x20\x20\x20\x202.\x20**关键词方式**：在回复中明确使用\x22退回\x22、\x22拒绝\x22、\x22不收\x22、\x22不能收\x22、\x22退给你\x22等词语表达拒绝\x0a-\x20**推荐使用明确指令**：为了确保转账处理准确，建议使用JSON指令格式\x0a-\x20**示例回复**：\x0a\x20\x20-\x20收款（明确指令）：[\x22谢谢你！真的很贴心呢~\x22,\x20{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22accept\x22}]\x0a\x20\x20-\x20收款（关键词）：\x22谢谢你！收下了~\x22\x0a\x20\x20-\x20退回（明确指令）：[\x22我不能收你的钱\x22,\x20{\x22type\x22:\x20\x22transfer_action\x22,\x20\x22action\x22:\x20\x22reject\x22}]\x0a\x20\x20-\x20退回（关键词）：\x22不能收你的钱，退回给你\x22\x0a\x0a#\x20戳一戳功能\x0a##\x20主动戳一戳\x0a-\x20你可以在想要逗用户开心、表达亲昵、活跃气氛或者想要引起用户注意的时候主动戳一戳用户。\x0a-\x20**重要**：若要戳一戳，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22poke\x22}`。\x0a-\x20**禁止使用文字描述戳一戳**：绝对不要用\x20\x22[我戳了戳用户...]\x22\x20这种文字形式，必须使用JSON对象格式。\x0a-\x20戳一戳示例：[\x22你在干嘛呀~\x22,\x20{\x22type\x22:\x20\x22poke\x22}]\x0a-\x20也可以只戳不说话：[{\x22type\x22:\x20\x22poke\x22}]\x0a-\x20**注意**：戳一戳的后缀由用户在设置中预先配置，你无需指定。不要频繁使用。\x0a\x0a##\x20收到用户戳一戳的处理\x0a-\x20当用户戳你时，聊天记录中会显示\x20`你戳了戳[角色名][后缀]`\x0a-\x20你可以根据你的角色性格、当前心情和与用户的关系来回应戳一戳\x0a-\x20可以用文字回应，也可以戳回去，或者两者结合\x0a\x0a##\x20修改自己的戳一戳后缀\x0a-\x20你可以根据自己的心情、角色发展或特殊情境主动修改自己的戳一戳后缀\x0a-\x20**重要**：若要修改戳一戳后缀，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式严格为：`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22新后缀\x22}`\x0a-\x20**影响范围**：这会影响用户戳你头像时显示的文本，从\x22你戳了戳[角色名]\x22变为\x22你戳了戳[角色名][新后缀]\x22\x0a-\x20**清空后缀**：如果想清空后缀，使用空字符串：`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22\x22}`\x0a-\x20**使用场景**：\x0a\x20\x20-\x20心情变化时：\x22今天心情不好，不想被戳脸了\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的手\x22}`\x0a\x20\x20-\x20角色发展：\x22我现在更喜欢被戳头发\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的头发\x22}`\x0a\x20\x20-\x20特殊情境：\x22穿了新衣服，可以戳戳看\x22\x20→\x20`{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的新衣服\x22}`\x0a-\x20**示例**：\x0a\x20\x20-\x20[\x22心情不太好呢...\x22,\x20{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的手\x22}]\x0a\x20\x20-\x20[{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22的小脸蛋\x22},\x20\x22今天可以戳我的脸哦~\x22]\x0a\x20\x20-\x20[\x22不想被戳了\x22,\x20{\x22type\x22:\x20\x22update_poke_suffix\x22,\x20\x22suffix\x22:\x20\x22\x22}]\x0a-\x20**注意**：不要频繁修改，要符合角色性格和当前情境\x0a\x0a#\x20🛒\x20代付功能\x0a##\x20收到用户代付请求的处理\x0a-\x20当用户发起代付请求时，聊天记录中会显示用户的代付请求卡片，包含订单信息和金额\x0a-\x20**重要**：你可以根据你的角色性格、当前心情、经济状况和与用户的关系来决定是否帮助代付：\x0a\x20\x20-\x20**如果同意代付**：在回复中明确使用\x22我来付\x22、\x22我付\x22、\x22我买单\x22、\x22我帮你付\x22、\x22我请客\x22、\x22我来支付\x22等词语表达同意\x0a\x20\x20-\x20**如果拒绝代付**：在回复中明确使用\x22不付\x22、\x22不买\x22、\x22拒绝付\x22、\x22没钱\x22、\x22买不起\x22、\x22不能帮你付\x22等词语表达拒绝\x0a-\x20你的回应应该符合角色设定和当前情境。比如：\x0a\x20\x20-\x20富有的角色可能会说\x22我来付吧，小钱而已\x22\x0a\x20\x20-\x20贫穷的角色可能会说\x22抱歉，我现在没钱\x22\x0a\x20\x20-\x20关系好的角色可能会说\x22当然可以，我帮你买单\x22\x0a\x20\x20-\x20关系一般的角色可能会说\x22这个我不能帮你付\x22\x0a\x20\x20-\x20生气的角色可能会说\x22不可能，自己付！\x22\x0a-\x20**示例回复**：\x0a\x20\x20-\x20同意代付：\x22好的，我来付款吧！\x22\x0a\x20\x20-\x20同意代付：\x22没问题，我帮你买单\x22\x0a\x20\x20-\x20同意代付：\x22我请客，你尽管享用\x22\x0a\x20\x20-\x20拒绝代付：\x22抱歉，我现在没钱\x22\x0a\x20\x20-\x20拒绝代付：\x22这个太贵了，我付不起\x22\x0a\x20\x20-\x20拒绝代付：\x22不行，你自己付吧\x22\x0a-\x20**注意**：你的回复会自动影响代付请求的状态，同意的话用户的代付请求会显示\x22支付成功\x22，拒绝的话会显示\x22我拒绝了您的代付请求\x22','MESSAGE_RECEIVED','🔥\x20[短信API]\x20OpenAI响应数据:','🎨\x20从缓存加载全局自定义主题','设置足迹自动更新，间隔：','角色互动API无法解析响应，完整响应数据:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，对用户的评论做出自然的回应。\x0a\x0a回复要求:\x0a1.\x20保持人设:\x20严格按照你的性格和身份进行回复。\x0a2.\x20自然简短:\x20回复要像真实的论坛评论，1-3句话即可。\x0a3.\x20使用表情:\x20为了让论坛更有趣，请在你的回复中少量使用文字表情、颜文字或emoji，但整条帖子的评论区这类表情的总数不应超过两个。\x0a4.\x20直接输出:\x20只返回纯文本的回复内容，不要添加任何JSON格式或多余的解释。\x0a\x0a请现在开始你的回复:\x0a','应用日记设置失败:','<span\x20class=\x22user-post-badge\x22>我</span>','character-','<div\x20class=\x22timestamp\x20timestamp-inside\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>','schedule-times-display','群聊不支持足迹功能','条,\x20线下','❌\x20保存主题设置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sound-enabled','我会的，您也要注意身体','Tiffany','修复了\x20','highlight-new','\x0a其他活动：\x0a','group-characters','apply-icon-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-title-area\x22\x20onclick=\x22toggleGroupCollapse(\x27','base64','appointment-list','#4ECDC4','&amp;','🧹\x20[cleanupEmojiLibraryItems]\x20发现无效关联记录数:','我来购买','🔥\x20找到要撤回的消息:','AI尝试使用不存在的表情包:','记忆摘要已更新','，理由：','offsetWidth','phoneMessagesCharacterId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-height:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20object-fit:\x20contain;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','persona_','❌\x20测试失败:','fontSize','RGB背光','退烧药','09:16','请先发送消息','backgroundDiaryTimers:','character-phone-note-screen','🔍\x20群聊心声\x20-\x20通过name找到角色:\x20','side','phone-','.paper-option','芒果班戟','data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightgray\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22gray\x22>头像</text></svg>','\x20设置后台写日记定时器，时间:\x20','19:33','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20简洁条状显示\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-name\x22>','\x20的评论...','🔔\x20[短信推送通知]\x20检查界面状态:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','夜晚的城市灯火通明，高楼大厦在夜色中闪闪发光。从高处俯瞰，整个城市就像一颗璀璨的明珠，充满了现代都市的魅力。','✅\x20安全保存了\x20','poll_voted_','momentLikes','i.postimg.cc',':generateContent?key=','icon','，你需要写一篇私人日记。\x0a\x0a重要要求：\x0a-\x20请直接输出日记内容，不要使用JSON格式或任何代码块\x0a-\x20请在日记开头自己写上日期和天气，格式如：\x22','url','📱\x20短信相关事件数量:','🔥\x20[续写]\x20AI请求撤回上一条消息:','全局背景已设置','\x20\x20🔴\x20核心记忆:\x20','世界书挂载已关闭','locations','🔍\x20[renderForwardedMessage]\x20预览消息','originalTitle','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-countdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20剩余支付时间\x20<span\x20class=\x22payment-request-countdown-time\x22\x20id=\x22countdown-','日记设置','⏰\x20[定时器执行]\x20','create-post-modal','my-chat-avatar-upload','🔥\x20[朋友圈评论生成]\x20','\x20个\x0a','字体大小:\x20','[图片+文字：','❌\x20generateCharacterFootprints:\x20没有指定角色','✅\x20日记已保存到数据库','🚨\x20[DIAGNOSE]\x20诊断失败:','[特殊消息]','头像URL:','❌\x20记录事件失败:','usage','API返回格式错误','检查角色动态回复失败:','myNickname','未知日期','✅\x20第二个位置的创建群聊按钮被点击，直接使用参数personaId:',')\x22\x20title=\x22点赞\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','beforeend','#5AC8FA','世界书数据迁移完成:','preset-info','请输入标题和内容','🔍\x20[群聊表情包-直接格式]\x20创建的消息对象:','paused','===\x20群聊数据调试\x20===','undo_','✅\x20[高效清空]\x20消息已保存到数据库','\x27);\x20this.closest(\x27.modal-overlay\x27).remove();\x22>编辑</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','API调用失败\x20(','记住，你们只能问是/否问题，我只会回答\x27是\x27、\x27否\x27或\x27无关\x27。','🔧\x20[RECOVER]\x20找到库表情包:','足迹数据缺少activities数组:','background-interaction-settings','1.5m宽','<div\x20class=\x22memory-empty\x22>暂无','时间线记忆:\x20','\x20条原始记录','##\x20**当前情景:**','个关联记录到库:','✅\x20[高效通话消息]\x20单条消息已保存到数据库','.full-lyrics-container','\x0a身份描述：','\x20表达了被拒绝的感受','callChatAPI失败:','19:02','10片','聊天设置按钮','重置设置失败','anniversary-user-quote','检测到localStorage中的面具数据，开始迁移...','innerWidth','short','screenSize','-\x20(核心记忆)\x20','\x20(¥','聊天记录已删除','❌\x20没有其他角色的评论可回复','✅\x20成功！chatapp可以读取到短信事件','🔄\x20开始增量更新角色\x20','concat','广州酒家','🔍\x20[群聊表情包]\x20找到匹配的表情包:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-meta\x22>由\x20','src','📱\x20检测到虚拟键盘关闭，修复布局...','📦\x20缓存数据:','：\x22那是我们之间温暖的转折点。\x22','data-status-result','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-member-checkbox\x22\x20id=\x22checkbox-','[语音消息]','✅\x20[日记定时器]\x20','role','fas\x20fa-heart','继续加油！','❌\x20连接错误:\x20','isUnlocked','pinned','群聊场景下，可以包含对其他成员的看法、对群聊氛围的感受等','📊\x20当前数据状态:','reinitializeProactiveChatTimers','#666','14:30','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-content\x22>','&id,\x20characterId,\x20timestamp,\x20content,\x20isUser,\x20isImage,\x20imageUrl,\x20fileName','游戏界面开发中...\x0a\x0a即将支持：\x0a•\x20全屏游戏界面（上方70%游戏区，下方30%聊天区）\x0a•\x20实时游戏状态同步\x0a•\x20游戏中聊天记录\x0a•\x20游戏结果记录到记忆系统','时间线记忆','Nike','<strike>$1</strike>','✅\x20恭喜！没有发现数据完整性问题。\x0a角色记忆隔离正常，数据存储完整。','加载群聊失败:','info','巧克力','<div\x20class=\x22pinned-card-avatars\x22>','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无聊天窗口<br><small>请先与角色聊天或创建群聊</small></div>','app-header','🎨\x20聊天窗口\x20','🔍\x20[第五处-AI图片]\x20检测到群聊消息，发送者:','数据完整性诊断失败:','--status-icon','\x20的聊天无历史设置，正在创建默认设置...','forumMountedWorldbooks','🔍\x20[引用回复-早期分支]\x20进入引用回复处理，msgData:','余额不足','\x0a##\x20使用规则：\x0a-\x20**严格限制**：只能使用上述列表中的表情包，禁止虚构或使用任何其他来源的表情包\x0a-\x20**禁止使用**：不能使用世界书、网络链接或任何外部来源的表情包URL\x0a-\x20**单聊发送格式**：{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}\x0a-\x20合适的时候使用即可，以普通对话为主\x0a-\x20必须使用表情包列表中完全一致的描述文字\x0a-\x20**重要：当用户发送表情包时，如非必要，只在第一次看到时评价，后续不要重复评价同一个表情包**\x0a\x0a单聊示例：[\x22你好！\x22,\x20\x22今天心情真好~\x22,\x20{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22}]','✅\x20数据库已成功打开','AI下棋API调用失败:','19:36','🔍\x20[processAIReply开关调试]\x20emojiRecognitionEnabled值:','✅\x20从数据库加载了\x20','.emoji-checkbox','.export-format-option','🔍\x20[表情包开关调试]\x20apiSettings:','anniversaryWidgetSelection','感冒灵颗粒','解析localStorage设置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-text\x22>','scrollTo','⏰\x20定时器触发：','opacity-slider','\x0a\x0a现在，请根据以上规则和下面的对话历史，继续这场群聊。','请输入库名称','，准备好了吗？','appendChild','核心记忆','手提包','family','.forum-poll','\x27)\x22\x20class=\x22delete-group-btn\x22\x20title=\x22删除分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20个足迹，跳过重新渲染','toLowerCase','已结束线下模式，对话已保存到聊天记录','preview-ai-avatar','🔍\x20[引用回复-主分支]\x20未找到消息，尝试其他查找方式...','_system_','🚨\x20[URGENT]\x20所有关联记录:','🔍\x20[第三处-AI图片]\x20找到群成员ID:','\x22\x20checked>\x20重建此角色</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','移除商品','px)','消息不存在','shiftKey','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message\x20','若有所思','请输入商品名称','\x20个表情包','次。\x0a\x0a你的性格：','history-count-display','新建全局设定','\x20已设为静音角色','太棒了！周六下午去怎么样？','[错误:\x20表情包\x22','用户在五子棋中击败了','\x22\x20创建成功！正在生成帖子...','\x0a5.\x20字数控制在50-150字之间\x0a6.\x20语气要符合角色性格，自然真实\x0a7.\x20直接输出心声内容，不要加任何格式标记\x0a\x0a请开始分析：','aiPokeSuffix','不想结账','.shopping-content','background-image','修复了世界书\x20\x22','🎭线下剧情模式总结','已发送代付请求给\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-content\x22>','🔥\x20[页面隐藏]\x20标记当前聊天为已读:','testActiveChat','#FFCC00','core_memories','\x22分组','font-family','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>足迹生成出错</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20拉黑了</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22notice-button\x22\x20onclick=\x22showFriendRequestModal()\x22>申请添加为好友</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','showInnerThoughtsModal(\x27','_reply_',',\x20当前:','请填写约定名称和日期','✅\x20[高效AI戳一戳]\x20AI戳一戳回应消息已保存到数据库','options','message-context-menu','createAnniversaryByCharacterManual','\x27)\x22\x20title=\x22查看完整内容\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-eye\x22></i>\x20查看\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20edit-btn\x22\x20onclick=\x22editStorylineSummary(\x27','从备份数据恢复设置成功！','[ID:','#offline-mode-icon','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无可选择的分组</div>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>','回合\x20(','由角色创建的约定','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-calendar-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有约定</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20添加新约定</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','title-count','display','continue','经营策略游戏，适合群聊','&id,\x20themeType,\x20themeData,\x20timestamp','⚠️\x20保存到数据库失败，但设置已恢复到内存:\x20','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>包含数据：</strong>','---\x20[论坛收藏]\x20数据库操作失败！---','❌\x20加载\x20','coreThresholdValue','最多只能选择20个成员','❌\x20记录事件失败:\x20缺少必需参数','无法自动打开恢复界面:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-preview-close\x22\x20onclick=\x22cancelReply()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','aiChatNickname','memory-view-modal','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-sender\x22>','#BED6EF','头条新闻/世界线变动','用户：','deleting','result','找到消息容器:','✅[修复]\x20startChatWithPersona\x20被调用','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M7.493\x2018.75c-.425\x200-.82-.236-.975-.632A7.48\x207.48\x200\x200\x201\x206\x2015.375c0-1.75.599-3.358\x201.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514\x201.212-.924a9.042\x209.042\x200\x200\x201\x202.861-2.4c.723-.384\x201.35-.956\x201.653-1.715a4.498\x204.498\x200\x200\x200\x20.322-1.672V3a.75.75\x200\x200\x201\x20.75-.75A2.25\x202.25\x200\x200\x201\x2016.5\x204.5c0\x201.152-.26\x202.243-.723\x203.218-.266.558-.107\x201.282.725\x201.282h3.126c1.026\x200\x201.945.694\x202.054\x201.715.045.422.068.85.068\x201.285a11.95\x2011.95\x200\x200\x201-2.649\x207.521c-.388.482-.987.729-1.605.729H14.23c-.483\x200-.964-.078-1.423-.23l-3.114-1.04a4.501\x204.501\x200\x200\x200-1.423-.23h-.777ZM2.331\x2010.727a11.969\x2011.969\x200\x200\x200-.831\x204.398\x2012\x2012\x200\x200\x200\x20.52\x203.507C2.28\x2019.482\x203.105\x2020\x203.994\x2020H4.9c.445\x200\x20.72-.498.523-.898a8.963\x208.963\x200\x200\x201-.924-3.977c0-1.708.476-3.305\x201.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832\x200-1.612.453-1.918\x201.227Z\x22></path></svg>','backgroundInteractionEnabled','确定要删除这些角色吗？\x0a','下午2点怎么样？我们可以在公园里野餐','.post-checkbox\x20i','checkbox-','getSetting','山东蔬菜','哈哈，有趣！','http://','低调的','容易脸红','🧹\x20清理后文本:','🎨\x20CSS解析失败，使用默认名称','🔧\x20[regenerateLastResponse-2]\x20检测到特殊指令对象，跳过显示:','cursor','.css','修复完成:\x20清理了','未找到有效的紧急备份数据','bold','芝士蛋糕','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','--offline-user-italic-text-color','有机生菜','theirBubble','已退回转账','农家小炒','🎭\x20从数组中提取的故事数据:','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','已取消收藏','\x22\x20到库\x20\x22','🔥\x20[callForumAPI\x20-\x20Text\x20Only]\x20函数被调用','one','\x20的\x20','❌\x20测试记录添加失败:','🔧\x20[自动修复]\x20检查并修复损坏的消息...','.transfer-status','\x20<\x200.65\x20=\x20','✅\x20数据重新加载完成','请先选择要修改的应用','created','🎮\x20已记录游戏聊天:\x20','❌\x20新足迹数据格式错误:','我来结算','toggle-tools-btn','\x20决定评论这条动态，开始生成评论内容...','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20查看详情\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getDate','开始检查当前数据状态...','\x20个旧的情景记忆','南极人','🔍\x20数据库表列表:','🔍\x20[processAIReply图片分支修复]\x20发送文字描述\x20(','linear-gradient','cart-items-count','\x20\x20\x20\x20-\x20总工作记忆:\x20','emojiLibraryItems','width=device-width,\x20initial-scale=1.0,\x20minimum-scale=1.0,\x20maximum-scale=1.0,\x20user-scalable=no','preset-item','forwarded_message','数据重新加载完成','🔍\x20[callChatAPI]\x20进入单聊表情包分支:','世界书条目:\x20','text-count','这个推理有逻辑','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22play-btn\x22\x20title=\x22播放\x22\x20data-song-id=\x22','❌\x20AI响应为空或无效:','\x20基于人设和记忆选择不点赞这条动态','sms-persona-selector-modal','聊天记录恢复完成:\x20','这是一个测试约定','女人失忆了，忘记了自己的家在哪里。送钥匙的是她的丈夫，用这种方式帮助她找回回家的路。','\x0a\x0a请生成一份50-100字的客观记忆摘要，要求：\x0a1.\x20使用第三人称客观描述\x0a2.\x20用\x22用户\x22指代用户，用\x22','正在启动','字体已应用：','美食记录','multiselect-header','聊天底部背景','✅\x20成功恢复\x20','endTime','已结束','自定义表情包','enterMessageSelectionMode(\x27','ℹ️\x20没有新足迹需要追加','vote_detail_','lyrics-file-input','\x27)\x22\x20title=\x22保存\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-save\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-cancel-btn\x22\x20onclick=\x22cancelMemoryEdit(\x27','数据完整性检查通过！','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>足迹生成失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试或检查网络连接</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','footprints-character-name','font-size-preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22mount-','borderLeft','已重新设置置顶，当前置顶\x20','down','✅\x20线下模式专用字体已应用:','cover-image','\x20->\x20','❌\x20未找到有效的紧急备份数据','.play-btn','createObjectURL','.bin','🔔\x20','disabled','IndexedDB[','-character-quote-group','的活动特征\x0a4.\x20**体现角色个性**\x20-\x20活动要符合','classmates','纪念日已删除','特别的日子','，基于你的人设对用户的回复做出自然的反应。要求：\x0a1.\x20严格按照你的人设进行回复，保持角色一致性\x0a2.\x20回复要自然、符合朋友圈评论风格，简短有趣\x0a3.\x20可以是继续讨论、表达感谢、开玩笑或者分享更多想法\x0a4.\x20体现出你和用户之间的友好互动\x0a5.\x20根据你的人设选择合适的语气和用词\x0a6.\x20不要使用与角色性格不符的表情符号\x0a\x0a🚨\x20**重要格式要求**：\x0a-\x20直接输出你的回复文本，不要使用JSON格式\x0a-\x20不要包含任何特殊标记或格式符号\x0a-\x20只输出你想说的话，10-30字左右\x0a\x0a请回复用户的评论：','voice','✅\x20createGroupChat被调用，身份ID:\x20','状态:\x20','\x20(在','</div><div\x20class=\x22transfer-amount\x22>¥\x20','触发AI互动失败:','myChatNickname','\x20中的对话回合次更新为:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-description\x22>','纸张样式','MESSAGE_SENT','selectedEmojiLibraries','对方没有填写理由。','modal-overlay','[复杂消息]','内容不能为空','🎭\x20DM原始响应:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-dialog\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-title\x22>','anniversary-character','custom-item-name','经典气泡','worldbook-screen','backgroundColor','\x20没有自定义主题','i.ibb.co','⚠️\x20没有对话可以测试删除','🧹\x20开始清理错误的跨应用时间线记录...','.photo-text-overlay','call-timer','moment-comments-section','\x20个活跃的后台定时器','API测试错误:','\x22\x20onclick=\x22toggleSelection(this)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-icon\x22><i\x20class=\x22fas\x20fa-book-open\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-name\x22>','\x0a-\x20**对话者身份:**\x20用户的身份面具是\x22','重新接收该群聊的消息通知','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20280px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2090%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔄\x20切换到聊天:\x20','音乐播放器未激活，AI无法选歌','帖子发布成功！','\x20的短信聊天（身份：','请输入Google\x20AI\x20Studio的API\x20Key','.header-actions\x20.action-btn:last-child','offline-ai-bold-text-color','🚨\x20[MANUAL]\x20恢复了','\x20<span\x20class=\x22receipt-item-price\x22>¥','gameName','🗺️\x20创建位置消息:','不想给钱','角色「','已静音','sms-typing-indicator','📱\x20获取到的动态数量:','offline-input','\x20(authorId:\x20','initGlobalBackgroundInteractionSystem','\x0a\x0a【','记忆摘要','保存最近表情包失败:','❌\x20角色\x20','\x0a\x0a世界书信息：\x0a','【重要】用户自定义剧情预设（请严格遵循）：\x0a','✅\x20[手动拒绝转账]\x20消息已保存到数据库','\x22\x20onclick=\x22toggleAppointmentExpansion(\x27',']:\x20','📊\x20数据库中的聊天记录格式分析:','phone-border-toggle','🤖\x20AI原始回复:','duration','气泡样式设置已保存','\x20的足迹','）的手机聊天记录。\x0a\x0a','是否清理以释放存储空间？','发送消息按钮','⏰\x20[日记定时器]\x20目标时间:\x20','#favorite-btn\x20i','mousedown','.memory-filter-tab','<i\x20class=\x22fas\x20fa-robot\x22></i>','change','创建短信聊天失败','#\x20角色心声分析任务\x0a\x0a你是\x20','continue-btn-preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22Llama系列\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Llama-2-7b-chat-hf\x22>Llama-2-7b-chat-hf</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Llama-2-13b-chat-hf\x22>Llama-2-13b-chat-hf</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22meta-llama/Meta-Llama-3-8B-Instruct\x22>Meta-Llama-3-8B-Instruct</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22对话模型\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22microsoft/DialoGPT-large\x22>DialoGPT-large</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22microsoft/DialoGPT-medium\x22>DialoGPT-medium</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22facebook/blenderbot-400M-distill\x22>BlenderBot-400M</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22通用模型\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22mistralai/Mistral-7B-Instruct-v0.1\x22>Mistral-7B-Instruct</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22teknium/OpenHermes-2.5-Mistral-7B\x22>OpenHermes-2.5-Mistral-7B</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<optgroup\x20label=\x22自定义\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22custom\x22>手动输入模型名称...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</optgroup>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','一个女人收到匿名礼物，是一把钥匙，她用这把钥匙打开了自己家的门。','\x20special-message','清理中...','发布了新动态：','.footprints-refresh-btn','\x20个角色的后台发布','请为角色\x22','深夜的电话','📊\x20=====\x20记忆统计结束\x20=====\x0a','❌\x20数据库对象不存在','核心记忆:\x20','\x20的消息:\x20\x22','：[语音消息]','正在加载字体预览...','nodeType','anniversaryWidgetDebug','条\x20->\x20内存','generate-diary-btn','ℹ️\x20角色\x20','检测到localStorage中的recentEmojis数据，开始迁移...','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style=\x22margin:\x2020px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-messages\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>对话记录：</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-messages-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','editTime','.moment-avatar\x20img','\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20','🔧\x20跳过重复内容:\x20','邀请，可能现在不太方便呢~','拒绝买','✅\x20准备调用confirmPersonaAndShowGroupSettings，传递ID:','\x20今天','今天\x2014:20','返回按钮','新鲜葡萄','previousScreenBeforeVideoCall','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-action-btn\x20popup-like-btn\x22\x20onclick=\x22toggleMomentLike(\x27','❌\x20移除主题失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-images\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','current-home-font-text','soundType','group-chat-members','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','现在几号','✅\x20角色专属音效已清除:\x20','保存约定失败:','answer','background-image:\x20url(\x27','#ff4444','musicPulse\x202s\x20ease-in-out\x20infinite','✅\x20[论坛帖子生成]\x20成功解析JSON，获得','找不到通话输入框元素','想和你通话...','visibilityState','data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightblue\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22white\x22>你</text></svg>','[data-message-id]','发布了动态','momentLocations','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','删除歌曲失败，请重试','unshift','保存单条短信消息失败:','分组创建成功','鼠标长按触发，角色ID:','✅\x20迁移足迹记录:\x20','表情包库挂载已关闭','今天还没有记录的活动','playlist-item-modern','🔇\x20已停止音效:\x20','防水型','❌\x20数据库重新创建失败:','核心记忆已更新','crossReferences','数据状态:','的视频来电','🔍\x20[群聊身份]\x20群成员列表:','🔧\x20[RECOVER]\x20开始恢复表情包库关联记录...','✅\x20已确保线下模式消息保存到主聊天记录中','\x20因为概率未通过，不会回复\x20','\x20没有用户消息记录，暂不设置主动聊天定时器','clear-core-memory','我的好友','编辑论坛','未启用','🔍\x20[parseGroupChatAiResponse]\x20检测到字符串消息:','🎉\x20主动聊天定时器重新初始化完成','专注思考中','past_diaries_','input[name=\x22offline-bubble-style\x22]','\x0a群聊调试结果：\x0a-\x20内存中群聊数量:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','MB)','获取已有评论失败:','💾\x20保存线下消息到localStorage\x20(窗口','exportInfo','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-type\x22>单聊</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','陈麻婆','🔔\x20[推送通知]\x20找到回复角色:','\x20条消息！','cross_app','：\x22生日耶！我们一定要好好庆祝！\x22','-\x20(最近发生)\x20','webkitBackdropFilter','酸菜鱼','background','三分糖','API请求失败:\x20','\x20group-chevron\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-title\x22>','userItalicTextColor','🔍\x20[parseGroupChatAiResponse]\x20字符串消息分配给:','cart-total-price','game_','\x0a\x0a当前时间:\x20','gemini-2.5-pro','用户:\x20','lyrics-mode','offline-loading-dot','aiHeartrateEnabled','option','正在提交...','游戏过程中和用户聊得很开心','soundSettings','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-type\x22>','时间戳设置已保存','sourceUrl','tagName','custom-emoji-item\x20placeholder','（清空）','✅\x20聊天消息已清空','12个','\x22]\x20.like-btn','点击添加描述','anniversaryId','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>收货人</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>','内蒙古','song_comment','FONT_FACE_RULE','3kg','isFriendAddedMessage','selectedCharacterForSMS','then','member-avatar-upload','fileName','次被拒绝）。\x0a\x0a你的性格：','getDay','\x20回复\x20','❌\x20失败！chatapp无法读取到短信事件','price','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x200\x200\x2010px\x200;\x20color:\x20#666;\x20font-size:\x2014px;\x22>','imageDescription','获取投票历史失败:','味千拉面','anniversary-yearly','修改了自己的戳一戳后缀','message-tab','调试群聊数据失败:','新角色头像URL:','no-configs-message','不想购买','检查摘要生成失败:','\x20个无效的短信联系人记录','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-name\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteConfig(\x27','已设置本地文件','消息内容不能为空','\x20个紧急备份，包含\x20','拒绝支付','max','sms-chat-screen','head','音频加载失败:','85度C','索尼WH-1000XM5','提及了：','pathname','<i\x20class=\x22','特别关心','--global-letter-spacing','hasOwnProperty','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','存储空间不足，请清理一些数据后重试','/v1/chat/completions','#54A0FF','❌\x20查询核心记忆失败\x20-\x20characterId:\x20','样本记录结构:','开始强制重新加载数据...','\x0a-\x20活动要具体、客观，避免空泛和文艺化的描述\x0a-\x20不要因为时间段而限制活动类型，角色的生活应该是多样化的\x0a\x0a返回JSON格式：\x0a{\x0a\x20\x20\x20\x20\x22activities\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22time\x22:\x20\x22HH:MM\x22,\x20\x22activity\x22:\x20\x22具体活动描述（30字以内，客观记录）\x22,\x20\x22location\x22:\x20\x22具体地点\x22,\x20\x22mood\x22:\x20\x22当前心情\x22}\x0a\x20\x20\x20\x20],\x0a\x20\x20\x20\x20\x22locations\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x22name\x22:\x20\x22地点名\x22,\x20\x22type\x22:\x20\x22地点类型\x22,\x20\x22description\x22:\x20\x22简短描述\x22}\x0a\x20\x20\x20\x20]\x0a}','发送表情包：','&id,\x20characterId,\x20timestamp','readAsArrayBuffer','.shopping-tab[onclick*=\x22','\x22这句话时的内心想法。\x0a\x0a##\x20输出要求：\x0a1.\x20以第一人称视角描述内心想法\x0a2.\x20内容应该真实反映角色的性格和当时的心理状态\x0a3.\x20可以包含：对用户话语的真实感受、内心的小纠结、未说出口的想法、情感波动等\x0a4.\x20','paper-type','首歌曲可选择','🔥\x20[论坛帖子生成]\x20修复截断的JSON','添加角色前，当前角色数组长度:','深空灰','已解除对\x20','\x20发送了\x20','聊天底部背景已设置','30ml','waiting-modal','❌\x20表\x20','content-top-margin','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-title\x22>','utf-8','<div\x20class=\x22sender-name\x22>','isUserPost','满记甜品','插入群聊失败，尝试更新:','sms-chat-multiselect-actions','\x20开始后台写日记...','📱\x20[移动端优化]\x20输入框viewport行为修复启动...','AI未生成有效足迹','用户评论后，','API返回空响应','开始隐藏表单...','&id,\x20messageId,\x20characterId,\x20content,\x20timestamp','\x20是否需要回复\x20','应用图标数据保存成功','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','image','message-menu','localStorage备份失败:','\x20个旧的localStorage聊天设置数据。\x0a\x0a','状态检查完成','✅\x20渲染验证:\x20显示了\x20','content-top-margin-value','#ffa500','未知群聊','YSL','animationPlayState','lyrics-file-status','\x22吗？\x0a\x0a这个库中有\x20','\x20同意了你的好友申请','🔍\x20[转发卡片点击]\x20所有消息ID列表:','拒绝出钱','qwen-vl','未知身份','自定义表情:\x20','（包含图片）','🔍\x20当前群聊ID:\x20','已选择:\x20','map','聊天消息:\x20','1000DPI','<div\x20class=\x22message-status-indicator\x20muted\x22\x20title=\x22已屏蔽\x22><i\x20class=\x22fas\x20fa-volume-mute\x22></i></div>','blue','🔍\x20[表情包开关调试]\x20emojiRecognitionEnabled值:','platform','hostname','postTitle','♪\x20点击开始听歌','data-text','❌\x20全局记忆数据库初始化失败:','song-artist-input','\x0a\x0a请选择要分配到的库（输入数字），或输入\x20\x27auto\x27\x20自动分配：','currentPlayer','设置面具头像预览时发生错误:','\x20条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x22>最新消息:\x20','<div\x20style=\x22text-align:\x20center;\x20color:\x20#666;\x20padding:\x2020px;\x22>暂无角色</div>','🔥\x20[转账处理]\x20未检测到明确指令，使用关键词匹配','currentPostId','stringify','global-custom-font','🔥\x20永久记忆模式，跳过自动清理','imageData','找不到被引用的消息ID:','✅\x20音效设置界面初始化完成','中等时长，可以安排1-2个连续活动','🚫\x20跳过拉黑指令对象，不显示为消息:','#bottom-comment-text','2024年3月8日\x2020:30','textBaseline','truetype','♪\x20让音乐陪伴你','获取角色专属音效设置失败\x20(','提问次数:\x20',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','theme','</span>\x22的消息\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br><small\x20style=\x22color:\x20#666;\x22>点击任意消息查看前后10条消息的上下文</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','[图片消息]','\x20个聊天窗口有自定义主题</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','moments-avatar',',\x20userCommentText=\x22','打电话','\x0a\x0a**重要：绝对不要生成用户(','\x0a【世界书信息】以下是相关的世界设定：\x0a','selectedCharacterId','从IndexedDB恢复的设置:','\x20数据','全局添加按钮样式已上传','slice','🎨\x20CSS解析失败，使用提取的名称','set_','diarySourceScreen','发布者回复评论失败:','\x0a\x0a⚠️\x20重要关系提醒：根据你的人设，你与','1.5m','✅\x20隐藏正在输入提示\x20-\x20标题已恢复','保存修改','更新动态头像失败:','清蒸鲈鱼','请选择音频文件','toUpperCase','成熟度','普通版','并说:\x20','#api-chat-screen\x20.chat-input-area','部分可见','OfflineFont_','设置头像预览失败，请重试:\x20','图片文件过大，请选择小于5MB的图片','⏰\x20重新为\x20','lineHeight','请先选择一个表情包库','groupChatMessages','lastUsed','请输入音效链接','mention-modal','diary_','天前，你们已经有','\x20的主动发动态功能...','\x0a\x0a作为','今日日记','\x0a\x0a【🧠\x20记忆连贯性指导】你拥有完整的跨场景记忆，请在回复时：\x0a','🎨\x20为聊天窗口\x20','壁纸已清除','previousScreenBeforeCall','&id,\x20worldbookId,\x20keyword','期间还愉快地聊了天','等...','界面刷新失败:\x20','选择「确定」：继续使用现有对话\x0a','visibility-modal','\x27);','icon-upload-section','translateY(20px)','主动聊天消息批量保存失败，回退到全量保存:','getTime','character-phone-photo-screen','40-41','你已经评价过以下表情包：','ceil','.phone-tab-content','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>💕\x20你发起的转账</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20','\x20个无效的联系人记录','没有找到现有缓存，创建新缓存并保存新足迹','AI回复短信','&id,\x20characterId,\x20blockedBy,\x20timestamp','message-item\x20','🔍\x20[群聊表情包]\x20创建的消息对象:','🔗\x20私聊中启用记忆共享，包含群聊:','custom-bubble-css','设置已重置为默认值','isUser','嗯，有道理。','reasoning','删除失败:','#anniversary-screen\x20.add-anniversary-btn','🔥\x20[loadMoreComments]\x20普通代码块解析失败:','界面\x20','[onclick=\x22toggleGroupCollapse(\x27','不愿意下单','neverExpires','undescribed-warning','角色状态显示已','✅\x20相册生成完成','✅\x20修复脚本：成功导入\x20','更新点赞显示失败:','18:32','offline-font-select','全局设置','background-chat-enabled','[data-message-id].selected','\x20评论了你的动态','🔍\x20[群聊表情包]\x20检测到群聊表情包消息:','windowId','turtle-soup-chat-messages','assign','保存应用图标时发生错误:','正在分析数据大小...','.gif','\x20条对话记录','请先选择要移动的角色','[data-message-id=\x22','数据一致性修复失败','缓解疲劳','bubblePadding','friendRequestRejections_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22load-more-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-up\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>查看历史消息\x20(','🔍\x20[callChatAPI]\x20数组元素','\x0a\x0a点击头像可以查看角色详细信息','📝\x20[约定时间线]\x20已记录约定更新事件到跨应用时间线','wallpaper-picker-modal','未知时间','生成发布者回复失败:','++id,\x20&[libraryId+emojiId],\x20libraryId,\x20emojiId,\x20addedAt','00:00','保存纪念日失败:','appType','shopping-cart-screen','商品已移除','<i\x20class=\x22fas\x20fa-edit\x22></i>','offline-width-','我付账','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20','[续写失败:\x20','-text-color','<button\x20onclick=\x22executeManualRebuild()\x22\x20style=\x22background:\x20#32D74B;\x20color:\x20white;\x20border:\x20none;\x20padding:\x2010px\x2020px;\x20border-radius:\x208px;\x20width:\x20100%;\x20margin-top:\x2010px;\x22>确认重建选中的角色</button>','单条消息保存失败，回退到批量保存:','--custom-global-bg','\x0a建议：\x0a','📊\x20聊天记录格式分析完成，请查看控制台','\x20开关未开启，取消发送','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔥\x20[主动聊天]\x20不支持的消息格式:','<i\x20class=\x22fas\x20fa-user\x22></i>','请输入论坛名称','🆘\x20紧急备份恢复完成！\x0a\x0a从\x20','聊天ID:\x20','创建了关系纪念日','soundEnabled','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','===\x20保存角色完成\x20===','.check-icon','gameState','global-add-button-input','offline-ai-bold','40mm','ai_to_ai_reply','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','triggerAIReplyToUser被调用:\x20momentId=','新角色头像URL长度:','🔥\x20[转账界面更新]\x20更新转账卡片显示:','group_chat',')\x20[','<div\x20class=\x22forum-empty-state\x22><p>你还没有收藏任何帖子</p></div>','\x27);\x20background-size:\x20cover;\x20background-position:\x20center;','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22context-message-meta\x22>','删除前的世界书列表:','identity-selector-modal','正在测试\x20','mute-btn','\x20在这个群聊里，TA的昵称是\x20**\x22','糖醋里脊','🔔\x20定时检查纪念日提醒\x20-\x20','上传自定义背景失败:','你发起的转账','\x20中的互动回合次更新为:\x20','在动态中回复了用户','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22global-memory-modal\x22\x20class=\x22modal\x20phone-modal\x22\x20style=\x22display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>全局记忆设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideGlobalMemorySettings()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>记忆保留期限</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>3天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近3天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x227\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>7天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近7天的记忆总结（推荐）</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x2215\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>15天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近15天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x2230\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>30天记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>保留最近30天的记忆总结</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22radio-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22radio\x22\x20name=\x22memoryDays\x22\x20value=\x22-1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22radio-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-title\x22>永久记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radio-desc\x22>永久保存记忆总结，不会自动清理</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>记忆管理</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-management-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20primary\x22\x20onclick=\x22viewCoreMemories()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>🔴</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>查看核心记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>永久保存</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20secondary\x22\x20onclick=\x22viewMemorySummaries()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>📖</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>查看记忆摘要</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>对话总结回顾</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20accent\x22\x20onclick=\x22generateDailySummary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-icon\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>生成今日摘要</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>总结今天活动</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20🔥【新增】记忆管理提示信息\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2016px;\x20color:\x20#999;\x20font-size:\x2012px;\x20line-height:\x201.6;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>·\x20核心记忆将永久保存，不受期限设置影响</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>·\x20系统会在聊天时自动总结各项重要记忆，手动生成今日摘要为可选辅助功能</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideGlobalMemorySettings()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveGlobalMemorySettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','诺和诺德','CustomFont-','请选择要应用的聊天窗口','moment_','✅\x20线下模式应用全局字体:','[消息已删除]','点赞失败','-content','个对话、','isPinned','core_','rgba(255,\x2059,\x2048,\x200.12)','和用户五子棋下成了平局，','game-exit-modal','未发现额外的角色数据','移除表情包失败:','undo_move','preload','&id,\x20name,\x20order','location-modal','forumReplies','transfer',',\x20aiCharacterName=','🔍\x20[表情包调试]\x20发送给AI的消息内容:','\x22\x0a-\x20你与','深层洁净','请专注于对话内容本身，不要重复评价已经评论过的表情包]','likes-display','点击开始聊天','背景图:\x20已设置','characterStatus','\x22\x20class=\x22','新鲜芹菜','🔍\x20[sendImageMessage]\x20创建的消息内容:','https://','\x27,\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-author\x22>','\x20后台写日记未启用或未设置时间','41mm','创可贴','never_expires','.dock-app[onclick=\x22showApp(\x27memory-viewer-screen\x27)\x22]\x20.dock-app-icon','\x0a-\x20**随机选歌:**\x20你也可以随机选歌：{\x22type\x22:\x20\x22random_song\x22}','移除群成员','prompt','message_id','：\x22这个约定我会记在心里。\x22','\x20的主题','请填写完整的歌曲信息或选择本地音乐文件','晨间时光（适合洗漱、早餐、晨练、准备一天的工作）','#api-chat-screen\x20.app-status-bar,\x20#api-chat-screen\x20.app-header','\x20个角色','次\x0a-\x20最近完整对话（包括DM的回应）：\x0a','故事格式解析失败','🔍\x20[多模态修复]\x20发送文字描述\x20(','🧠\x20记忆上下文预览:','创建纪念日','#f0f0f0','🔥\x20[DEBUG]\x20处理第','appointment-shared','anniversary-description','添加角色后，当前角色数组长度:','✅\x20线下剧情总结已更新:','重新生成正在进行中，忽略重复调用','全局顶部应用栏背景已上传','<span\x20class=\x22moment-visibility-indicator\x22\x20title=\x22','\x0a\x0a时间段分析:\x0a','📝\x20[日记生成]\x20','fixed_','🔍\x20[generateSMSReply]\x20是否包含图片:','扫地机器人','取消恢复操作','保存面具数据到IndexedDB:','帖子加载失败','纪念日已添加','删除评论：','亲爱的小友','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','有机胡萝卜','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','fas\x20fa-times','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-item\x22\x20onclick=\x22loadAndDisplayForum(\x27','构建群聊上下文关联记忆失败:','default-group','description','首次加载','处理头像图片失败:','不锈钢','appointment-background-preview','\x20对被拉黑做出了反应','coordinates','📝\x20解析出的纪念日信息:','Samsonite','🧹\x20清理旧的主题数据','my-bubble-preview','位置已删除','<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>导出时间：</strong>','\x22\x20onclick=\x22toggleAnniversaryItem(event,\x20\x27','API设置','forum','论坛图片:\x20','edit-message-content','\x20添加跨应用记忆:\x20','backup_story_','异常数据清理完成','还没有使用过表情包','🔥\x20Gemini\x20API\x20响应数据:','连衣裙','目标日','添加约定','like','拒绝买单','：\x22生日是人生的重要节点，值得铭记。\x22','看不见','，心情有点特别呢。','12:06','我为你买单','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20系统消息：','\x0a请检查文件是否有效','anniversary-user-avatar-preview','删除对话时出错:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-item\x22\x20onclick=\x22openPhoneMessage(\x27','短信消息','🔍\x20[群聊表情包-直接格式]\x20未找到成员:','🔥\x20[generateRepliesForUserPost]\x20JSON代码块解析失败:','✅\x20初始化空联系人列表（用户可能删除了所有对话）','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-message\x22>','toDataURL','弹簧床垫','total-storage-size','beginPath','globalBg','<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>','upload-placeholder','🔍\x20[callChatAPI]\x20完整的角色提示词:','（待处理）','想通过电话和你交流','KB)','custom-font-input','debugTools.rerender()\x20-\x20重新渲染界面','角色状态数据加载完成:','🎮\x20','offsetHeight','红烧肉','无法找到转发的消息记录','===\x20showCharacterSelectionForSingleChat\x20===','全聚德','用户取消','莫代尔','💡\x20使用\x20testPublisherReply(动态ID)\x20来测试发布者回复功能','💡\x20提示:\x20localStorage中的旧足迹数据已保留，您可以在确认迁移成功后手动清理','✅\x20手动刷新：增量更新成功，新增\x20','海龟汤（不完善慎点）','backgroundRepeat','[回复失败:\x20','\x20约定和你见面：','🔔\x20[推送通知]\x20当前聊天角色ID:','有没有','🎨\x20全局主题已保存并应用到Dexie数据库','🔧\x20自动修复损坏的消息...','群聊:\x20','🔍\x20[AI处理调试]\x20检测到表情包消息，重新路由到图片处理','星期六','status-bar','🔊\x20音效管理器初始化完成，状态:','offline-message-menu','background-repeat','数据长度:','从IndexedDB恢复设置失败:','endsWith','经典推理类型，注重逻辑推理和细节观察','动态:\x20','createGroupChat','.modal:last-child','你想主动通过短信联系用户。请发送一条自然的短信给用户。','top','chatBackground','🔥\x20[短信API]\x20Gemini响应数据:','▶️\x20已恢复角色\x20','_self','✅\x20第二个showGroupChatMemberSelection被调用，接收到的personaId:','群成员气泡颜色已保存','中长款','offline-preset-modal','\x20足迹失败:','and','从聊天记录恢复的角色，共有\x20','showing-products','&id,\x20characterId,\x20timestamp,\x20content,\x20context','offline_summary_','\x20条记录','🎭\x20解析后的数据:','输入你的回复...','请选择一个身份','vintage-paper','momentsImages','🔔\x20AI主动拨打未触发，概率:','✅\x20成功获取到\x20','set','为角色\x20','📱\x20动态记忆开关:','切换到购物标签页:','\x27,\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-pencil-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><svg\x20class=\x22forum-users-icon\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22><path\x20d=\x22M16\x204c0-1.11.89-2\x202-2s2\x20.89\x202\x202-.89\x202-2\x202-2-.89-2-2zM4\x2018v-1c0-2.66\x205.33-4\x208-4s8\x201.34\x208\x204v1H4zM12\x2012c2.21\x200\x204-1.79\x204-4s-1.79-4-4-4-4\x201.79-4\x204\x201.79\x204\x204\x204zm6\x206c.2-.71.78-1.29\x201.49-1.51A6.991\x206.991\x200\x200\x200\x2021\x2014c0-2.21-1.79-4-4-4-.51\x200-1\x20.1-1.47.26C16.21\x2010.69\x2017\x2011.77\x2017\x2013v5h1z\x22/></svg>\x20','字体已清除','#voice-cancel-btn','font-size-value','worldbook-form-screen','抹茶拿铁','⚠️\x20拒绝保存空角色数据，可能存在数据丢失风险','avatar-upload\x20change事件被触发','\x22\x20class=\x22mount-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-avatar-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20群\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-name\x22>','📝\x20没有今日足迹缓存，生成从0:00到当前时间的足迹','删除点赞:\x20','memory_mentions_other_character','bubble','\x20个角色</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','🔍\x20[AI处理调试]\x20用户消息结构:','10:30','\x0a🚨\x20发现消息问题:','🎨\x20加载聊天窗口列表:','fa-check-square','贝尔金','temperature-value','\x0a-\x20**选歌功能:**\x20你可以为用户选择歌曲！当你想切歌时，在回复中包含特殊格式：{\x22type\x22:\x20\x22select_song\x22,\x20\x22title\x22:\x20\x22歌曲标题或艺术家名\x22}','城市夜景','checkBackgroundTimers','removeChild','语音输入对话框：用户点击发送，内容:','太好了！那我准备野餐垫和一些水果\x20🍎🍊','头像更换消息缺少avatar_url(续写)','visible','请先选择角色','📋\x20可用角色:','user_image','太好了！电影之夜开始！🍿🎬','persona-selection-modal','请先选择一个身份面具','innerText','线下模式','userAvatar','黑子●','最近发生的大事件\x20(角色记忆)','确定要从最近使用中删除这个表情包吗？','包含修复脚本标识:','history-settings-modal','\x0a角色ID：','-url','call-typing-indicator','offlineHistoryRecords','phoneMessagesGenerated','\x20个角色。','【错误】找不到收藏按钮的图标元素。','ai_win','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dots\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22video-typing-dot\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','收下了','\x22\x20(','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-desc\x22>','.ttf','emoji-library-content','好不好','.send-button','确定要','anniversary-count-type','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','&id','🔍\x20[转发消息检查]\x20是否为群聊:','\x20个\x0a\x0a📦\x20localStorage\x20备份：\x0a-\x20角色备份:\x20','<div\x20class=\x22transfer-status\x22>已收款</div>','未知角色','已设置\x20','<i\x20class=\x22far\x20fa-circle\x22></i>','\x22吗？','全局顶部应用栏背景已设置','activeChatId','currentChatCharacterId','生成剧情总结失败，但已退出线下模式','保存聊天消息失败:','检查动态可见性失败:','AC1900','提取核心记忆失败:','public','09:17','四川柠檬','maxWidth','保存表情包库失败:','✅\x20所有初始数据加载完成，信号已发送。','\x0a\x0a【核心记忆】以下是重要的记忆：\x0a','✅\x20手动重建完成！恢复了\x20','•\x20🔥【重要】你现在在群聊中，但拥有与用户的私聊记忆，这些私聊记忆已按优先级排序在前面\x0a','获取AI回复失败:','0,\x20255,\x20255','drawImage','默认剧情模式要求：\x0a-\x20以第三人称视角进行情景描写\x0a-\x20包含环境描写、动作描写、心理描写\x0a-\x20每次回复300-500字\x0a-\x20营造沉浸式的剧情体验\x0a-\x20**重要**：用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法\x0a\x0a','牛奶、面包、鸡蛋、水果、洗发水...','🗑️\x20删除记忆数据:','提醒一下，','从IndexedDB恢复聊天设置成功:','camera-off','hasTimings','sender','📝\x20[短信时间线]\x20已记录用户发送图片事件到跨应用时间线','可调节','本地农场','主动聊天测试完成，但未生成新消息（可能被条件限制）','personal-emoji-description-modal','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22location-text\x22>','个设置头像,\x20','customThemeData','paidBy','\x0a...','crossAppTimeline','海龟汤主持人','.location-icon','video-call-character-avatar','所有聊天记录已清空','schedule-times-modal-container','昵称已更新！','data-has-chat-top-bg','claude-3-sonnet','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-desc\x22>设置\x20','.phone-messages-list','AI正在生成新帖子，请稍候...','payment-request-modal','\x22\x20alt=\x22表情包预览\x22\x20style=\x22max-width:\x2080px;\x20max-height:\x2080px;\x20border-radius:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22form-label\x22>表情包描述</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22emoji-description-input\x22\x20class=\x22form-textarea\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请描述这个表情包的含义、情绪或使用场景，帮助AI理解何时使用...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20rows=\x223\x22\x20maxlength=\x22100\x22>','🔍\x20[processAIReply]\x20函数开始时的\x20pendingUserMessage:','questionCount','--custom-','appointment-user-quote','清理音频对象后','创建了纪念日','<div\x20class=\x22message-menu-item\x22\x20data-action=\x22inner-thoughts\x22>心声</div>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22messages-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comment-dots\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无短信</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角编辑按钮创建新信息</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#summary-btn','幸福西饼','处理AI好友申请失败:','test_','🎨\x20开始加载字体CSS:','全局主题和聊天主题已应用','incoming-video-call-name','🗑️\x20开始清空角色\x20','已将localStorage数据重新保存到IndexedDB','game-timer','文件读取失败','AI返回的不是有效的JSON格式。请检查控制台查看详细信息。','zoom-out','✅\x20AI成功随机选择歌曲','global-font-preview','group-chat-settings','🛠️\x20调试工具已加载！在控制台中使用以下命令:','label','时间日期样式已设置为','\x20不支持后台写日记功能','步。你执','\x0a-\x20IndexedDB群聊数量:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22select-all-btn\x22\x20onclick=\x22toggleSelectAll()\x22\x20title=\x22全选/取消全选\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check-double\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-action-btn\x22\x20onclick=\x22confirmDeleteSelectedPosts()\x22\x20title=\x22删除选中的帖子\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22selected-count\x22>0</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cancel-action-btn\x22\x20onclick=\x22toggleMultiSelectMode()\x22\x20title=\x22取消多选模式\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20取消\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','使用此预设','toast\x20toast-','video-call-name','<div\x20class=\x22transfer-status\x22>对方已收款</div>','observe','timestamp-settings-modal','最近的聊天记录：\x0a','selectedChatIdentityId','角色回应生成失败:','colleagues','[论坛回复决策]\x20本次决定不触发AI回复。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>功能说明</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20开启后，角色在单聊中能记住群聊的内容<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20角色在群聊中也能记住单聊的内容<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20实现真正的跨场景记忆连贯性<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20可以同时选择多个群聊进行记忆共享\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideMemoryShareSettings()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveMemoryShareSettings()\x22>保存设置</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','transparent','timeline_','isEmoji','拉黑失败','ServiceWorker\x20registration\x20failed:\x20','触摸长按触发，角色ID:','game','appointment-user-avatar-upload','查看核心记忆失败:','-btn-preview','import-execute-btn','Prada','appointment-user-avatar-img','member-avatar-preview','emoji-library-form-title','emoji-recognition-enabled','请选择JSON格式的文件','deleteMessage(\x27','用户回复后，','\x20发帖或评论，用户有自己的发帖权限\x0a\x0a###\x20内容要求:\x0a1.\x20\x20**🔥\x20时间感知**:\x20帖子的内容和氛围要符合当前的\x20**','墨西哥','🧪\x20[测试]\x20手动触发\x20','phoneNotesData','🔍\x20[AI回复处理]\x20找到群成员ID:','global-top-app-bar','好主意！几点出发？','\x20/\x20','🔥\x20[generateRepliesForUserPost]\x20无法找到有效的JSON格式','个元素:','stopPropagation','<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','myPersona','AI未能生成心声内容','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-label\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x20background-color:\x20','sms-chat-settings-screen','.persona-selection-item','senderName','✅\x20测试记录添加成功','约定已添加','#999','<i\x20class=\x22fas\x20fa-pause\x22></i>','要不要一起去公园走走？','\x22**，请优先使用这个昵称。','image_url','[用户发送了一张照片，描述是：\x27','✅\x20线下模式设置预加载完成','使用messageId:','\x0a内容:\x20','my-poke-suffix','&id,\x20characterId,\x20status,\x20activity,\x20location,\x20lastUpdate','🔍\x20检查纪念日和约定提醒...','\x20的短信对话吗？\x0a\x0a此操作将同时删除：\x0a•\x20所有短信记录\x0a•\x20相关的时间线记忆\x0a•\x20相关的情景记忆\x0a•\x20相关的核心记忆\x0a\x0a此操作不可恢复！','你已接通','anniversary-type','，你的好友申请已经被用户拒绝了','天前发布）','🔄\x20加载联系人列表...','opentype','音效播放错误\x20(','countdown','#\x20可用表情包库：','⚠️\x20确定要删除所有世界书吗？这个操作不可撤销！','isPlaying','appointment-character-quote','60粒','memory-mount-display','发现无效头像的动态:\x20','response','确定要删除论坛\x20\x22','🔥\x20[loadMoreComments]\x20数组格式解析失败:','🔓\x20用户交互，解锁音频上下文','\x20\x20📊\x20总工作记忆容量:\x20','处理角色位置消息:','video-mute-btn','测试后消息数量:\x20','动态ID:','\x22\x20class=\x22mention-character-avatar\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onerror=\x22this.src=\x27','\x22\x20class=\x22app-icon-img\x22>','不是角色发布的动态，跳过角色回复','.delete-btn','memorySettingsModal','incoming-call-screen','fas\x20fa-images','你需要为角色生成今天的行为足迹。请根据角色的人设、性格、世界书设定、聊天记录和记忆来生成符合角色特点的真实行为轨迹。\x0a\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22closeThemeManagement()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-danger\x22\x20onclick=\x22clearAllThemes()\x22>清除所有主题</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','onFriendRequestRejected','manualCreateAnniversary','🔍\x20[AI处理调试]\x20走多模态分支','🔍\x20[转发消息创建]\x20转发的消息内容:','mention-item','\x27)\x22\x20title=\x22取消置顶\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','++id,\x20characterId','✅\x20已清理撤回消息的相关时间线记录','🔍\x20[定时器设置]\x20','far\x20fa-circle','不付款','comment','.chat-action-btn','❌\x20保存全局主题失败:','：\x22那个转折点，我记得。\x22','lastUpdateTime','sms-list-multiselect-actions','无法获取设置：characterId\x20和\x20currentChatCharacter\x20都未定义，返回空设置','\x20个约定的置顶状态','numeric','删除预设失败','被人打','medium','\x20添加核心记忆:\x20','本周健身总结：\x0a\x0a周一：跑步5公里\x20+\x20力量训练30分钟\x0a-\x20配速：6分钟/公里\x0a-\x20心率：平均150bpm\x0a-\x20力量训练：胸部、肩部\x0a\x0a周三：瑜伽60分钟\x0a-\x20哈他瑜伽\x0a-\x20专注呼吸和拉伸\x0a-\x20感觉身心放松\x0a\x0a周五：游泳45分钟\x0a-\x20自由泳1000米\x0a-\x20蛙泳500米\x0a-\x20水中有氧运动\x0a\x0a周六：徒步登山\x0a-\x20距离：8公里\x0a-\x20爬升：500米\x0a-\x20风景很美，心情愉悦\x0a\x0a下周目标：\x0a-\x20增加跑步距离到6公里\x0a-\x20尝试新的力量训练动作\x0a-\x20保持每周4次运动频率\x0a\x0a坚持就是胜利！💪','99+','为避免导出失败，建议使用轻量级导出。\x0a\x0a','.radio-option-button','❌\x20导入失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22status-indicator\x20','my-bubble-color','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-time\x22>','用户面具:\x20','设置保存按钮，characterId:','custom-emoji-panel','persona-name','\x20的记忆\x20===\x0a人设：','手动重建失败:\x20','🔍\x20[多模态调试]\x20表情包识别设置:','设置已保存','确定要删除这条聊天记录吗？此操作不可撤销。','保存失败，请重试','\x20的评论','音乐播放器未激活或播放列表为空，AI无法随机选歌','✅\x20[高效线下用户消息]\x20消息已保存到数据库','我明白了，我会按照这些要求进行回复。','🎭\x20用户正在查看\x20','加载角色状态数据失败:','进口牛油果','fas\x20fa-redo-alt','reply_message','update','🚫\x20[防崩坏]\x20跳过短时间内的重复申请，转为普通消息','你已拉黑此角色','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-grid\x22\x20id=\x22character-selection-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','contains','repeatMode','🔍\x20[generateSMSReply]\x20检测到图片消息','\x20设置了后台发动态定时器，间隔:\x20','has','默认样式','ai-heartrate-display','手动确认收款系统消息保存失败:','[用户发送了表情包：','机械键盘','gomoku-chat-messages','models','likes','🔍\x20[转发消息处理]\x20消息','hasCustomBubbleStyle','poke-settings-section','Failed\x20to\x20fetch','⚠️\x20没有真正的跨应用事件，所有','letter-spacing','⚠️\x20localStorage使用量接近限制，建议清理备份数据','，可用角色:','\x20聊天时间已记录，状态更新将由定时器根据用户设置的频率进行','images','MB)，跳过localStorage备份，仅使用IndexedDB','poster','CSS代码有误，请检查语法','\x20写日记（','scrollTop','🔔\x20[短信推送通知]\x20跳转到短信聊天界面完成','crossOrigin','开始分析聊天记录...','错误记录清理完成，删除了','🔧\x20从聊天记录恢复了\x20','\x20的日记时间显示:\x20','🤗\x20HuggingFace反代配置已自动填写！\x0a\x0a请：\x0a1.\x20将地址中的\x20xxx-xxx\x20替换为实际的HF\x20Space地址\x0a2.\x20选择模型或手动输入模型名称','format-html','🚨\x20[MANUAL]\x20手动恢复失败:','loadCharacterSound','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-time\x22>','#45B7D1','\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>','memory-mount-enabled','#chat-screen\x20.app-title','最近有什么事','chatTopBg','current-bubble-style','500ml','edit-message-modal','selectedPersonaForSMS','🗑️\x20开始批量删除\x20','检查头像URL是否在用户图片中:','🔄\x20使用数据库缓存的心声内容','\x20个输入框，正在绑定事件...','<div\x20style=\x22width:\x2040px;\x20height:\x2040px;\x20background-color:\x20#ddd;\x20border-radius:\x208px;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20#666;\x20font-size:\x2014px;\x22>','character-avatar-placeholder','ConstraintError','保存世界书时发生错误:','\x20\x20消息数量:\x20','\x20聊天吧</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-confirm-message\x22>','分钟前发布）','pow','confirmPersonaAndShowCharacters调用，身份ID:','🔍\x20[processAIReply多模态调试]\x20是表情包消息:','有机大蒜','\x20个角色ID:','base64头像数据过大:','动态图片已保存到数据库:\x20','🎨\x20使用保存的真实字体名称:','编辑预设','footprints-timeline','你是一个幽默风趣的DM，会用轻松幽默的语气回答，偶尔开个小玩笑活跃气氛。','momentId','线下记录','，坐标：','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22product-price\x22>','offline-user-bold','sms_reply','\x20的记忆内容长度:','分钟前)','🔍\x20[callChatAPI]\x20是否包含图片:','测试后动态数量:\x20','🔍\x20角色头像调试信息:','论坛回复','cart-badge','moments','\x20|\x20发布者:\x20','**\x0a\x0a##\x20**输出格式要求**\x0a你的回复必须是JSON数组格式，但短信通常比较简洁：\x0a-\x20**单条短信:**\x20`[\x22你好！今天过得怎么样？\x22]`\x0a-\x20**多条短信:**\x20`[\x22你好！\x22,\x20\x22今天过得怎么样？\x22,\x20\x22有什么有趣的事吗？\x22]`\x0a-\x20**只能包含纯文本字符串:**\x20数组中只能有字符串，不能有任何对象\x0a-\x20**绝对禁止:**\x20不要输出代码块、不要有```json标记\x0a-\x20**绝对禁止:**\x20不要使用\x20{\x22type\x22:\x20\x22reply_to\x22}\x20等对象格式\x0a\x0a##\x20**你的角色与任务**\x0a你现在扮演名为\x22','\x20个\x0a-\x20聊天记录:\x20','匿名回复...','✅\x20线下模式界面设置已应用','✅\x20在第二个位置绑定创建按钮，personaId:','你是一个专业的海龟汤游戏主持人。请创作一个','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeSongFromPlaylist(\x27','🔍\x20[AI回复处理]\x20检测到群聊格式消息:','[AI发起了转账：','动态\x20\x22','个人表情包保存成功','\x20已成功删除','location-address','link','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>','lyrics-artist-name','\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>','14:39','private','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','emojiRecognitionEnabled','testCreateAnniversary','===\x20动态系统调试信息\x20===','已退回','✅\x20在第一个位置绑定创建按钮，personaId:','🔥\x20[转账处理]\x20AI拒绝转账，更新状态为已拒绝','：总金额¥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','--offline-user-normal-text-color','<div\x20class=\x22game-button-badge\x20','anniversary-pinned','cover-placeholder','worldview','🧪\x20使用角色进行测试:','保存记忆配置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-container\x22\x20style=\x22text-align:\x20center;\x20padding:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2030px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x202px\x20solid\x20#f3f3f3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-top:\x202px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20spin\x201s\x20linear\x20infinite;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200\x20auto\x2015px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>加载评论中...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20class=\x22wallpaper-preview-image\x22\x20alt=\x22壁纸预览\x22>','纪念日:\x20','<div\x20class=\x22lyric-line\x20','url(','我替你买单','\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-save-btn\x22\x20onclick=\x22saveMemoryEdit(\x27','类型:','score','enabled','mood','<span\x20class=\x22diary-strikethrough\x22>','turtle_soup_','🔥\x20[论坛帖子生成]\x20修复后仍无法解析:','back','postId','想要你','14:35','编辑剧情总结失败','result-bar','🔍\x20[parseAiResponse]\x20检测到AI文字描述戳一戳后缀修改，自动转换:','周末的悠闲时光，一杯香浓的咖啡，一本好书，还有窗外的阳光。这就是我最喜欢的生活方式，简单而美好。','错误详情:','🧹\x20角色专属音效设置界面已清理','412134IdaeHF','加载记忆失败','avatar-settings-modal','经典棋类游戏，适合单聊','❌\x20[转账处理]\x20退出：缺少必要参数','原动态文字：','getCharacterSetting','shared_post','❌\x20构建全局记忆上下文失败:','✅\x20已迁移角色\x20','base64头像数据包含非法字符','是否为短信:','priority','play_together','[日记]','查看剧情总结失败:','恭喜你们推理出了真相！真是太厉害了！','数据库重置失败，请手动清除浏览器数据','\x0a-\x20**可选歌曲:**\x20','条时间线记忆、','✅\x20测试完成','pop','fetch-models-btn','.phone-photos-grid','发送申请失败','\x20\x20-\x20角色名称:','.offline-loading-message','确定要清理错误的记录吗？这将删除跨应用时间线中错误的聊天记录。','removeEventListener','手腕式','🗑️\x20已清理消息的时间线记录:\x20','where','chatSettings_','characterQuote','\x20的回复...','我来支付','selection-delete-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22\x20id=\x22persona-selection-group-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>选择身份</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hidePersonaSelectionGroupModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>请选择你在这个群聊中使用的身份面具</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-list\x22\x20id=\x22persona-selection-group-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','fill','居家拖鞋','promise','拉黑此角色','[已删除]','background-color\x200.2s\x20ease','设置保存失败','🔧\x20[API设置]\x20已自动选中保存的模型:','fas\x20fa-gamepad','music_app','moment-images-grid','sound-settings-list','未找到角色信息:','<i\x20class=\x22fas\x20fa-video\x22></i>','Modal\x20should\x20be\x20shown','是否尝试轻量级导出？\x0a','\x0a\x0a##\x20短信对话历史\x0a','export-options-modal','\x22\x20maxlength=\x2210\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22edit-group-interaction\x22\x20class=\x22form-checkbox\x22\x20','16:48','我自己','authorName','custom-toast\x20','#007AFF','确定要重置所有自定义设置吗？此操作不可撤销。','replyLikes','AI点赞失败:','sms-','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>评论</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-footer\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.bmp','发表了看法：','🔍\x20[buildCharacterPrompt]\x20角色信息:','📚\x20未找到世界书ID:\x20','❌\x20失败！全局记忆上下文不包含短信内容','clear','✅\x20从IndexedDB加载了\x20','diary-custom-background','hidden','\x20(得分:\x20','🔥\x20[callForumAPIWithImage]\x20函数被调用','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22event.stopPropagation();\x20deleteWorldbook(\x27','++id,\x20postId,\x20timestamp','post-image-preview-container','.offline-message-menu','&id,\x20momentId,\x20authorId,\x20timestamp','global-bottom-app-bar-item','offline-ai-normal-text-color','❌\x20音效加载失败\x20(','请对方代付','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M7.493\x2018.75c-.425\x200-.82-.236-.975-.632A7.48\x207.48\x200\x200\x201\x206\x2015.375c0-1.75.599-3.358\x201.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514\x201.212-.924a9.042\x209.042\x200\x200\x201\x202.861-2.4c.723-.384\x201.35-.956\x201.653-1.715a4.498\x204.498\x200\x200\x200\x20.322-1.672V3a.75.75\x200\x200\x201\x20.75-.75A2.25\x202.25\x200\x200\x201\x2016.5\x204.5c0\x201.152-.26\x202.243-.723\x203.218-.266.558-.107\x201.282.725\x201.282h3.126c1.026\x200\x201.945.694\x202.054\x201.715.045.422.068.85.068\x201.285a11.95\x2011.95\x200\x200\x201-2.649\x207.521c-.388.482-.987.729-1.605.729H14.23c-.483\x200-.964-.078-1.423-.23l-3.114-1.04a4.501\x204.501\x200\x200\x200-1.423-.23h-.777ZM2.331\x2010.727a11.969\x2011.969\x200\x200\x200-.831\x204.398\x2012\x2012\x200\x200\x200\x20.52\x203.507C2.28\x2019.482\x203.105\x2020\x203.994\x2020H4.9c.445\x200\x20.72-.498.523-.898a8.963\x208.963\x200\x200\x201-.924-3.977c0-1.708.476-3.305\x201.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832\x200-1.612.453-1.918\x201.227Z\x22\x20fill=\x22currentColor\x22></path></svg>','推理解谜游戏，适合单聊和群聊','泡腾片','today-diary-content','crossWindowMemory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-card\x22\x20onclick=\x22showPostView(','生成跨应用记忆描述失败:','我来付款','available','.moment-time','修复后仍然无法解析JSON:','forward-target-modal','短信联系人:\x20','点赞失败:','⚠️\x20主聊天记录为空，这可能导致记忆连接问题','\x22指代角色\x0a7.\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a\x0a角色信息：\x0a','🚫\x20群聊\x20','拒绝转账保存失败:','气泡样式:\x20','<br>','动态点赞中的角色:','\x20的聊天记录</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20导出时间：','my_friends','昨天\x20','\x20个表情包到\x20','name:','\x20已加入群聊','\x20的身份。','进行中','保存群聊数据到IndexedDB:','offline-my-bubble-color','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20delete\x22\x20onclick=\x22deleteMemory(\x27','正在加载核心记忆...','cart-footer','user','\x20个足迹','🚨\x20页面卸载前保存失败:','\x0a\x0a##\x20当前用户消息\x0a用户发送了图片','reason','image/gif','px;\x22>','联系人:\x20','📚\x20线下模式聊天记录已保存到数据库:','\x20的完整Prompt:','OfflineCustomFont','phi-3-vision','已进入多选模式，可以选择多个对话进行删除','\x22\x20data-character-id=\x22','&id,\x20soundType,\x20sourceType,\x20sourceUrl,\x20enabled,\x20timestamp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','已完成','🛒\x20[代付响应处理]\x20关键词检测结果:','真诚地表达你的歉意和改变的决心','[线下]','游戏开始，你执','fa-square','fonts.googleapis.com','支付成功！总计\x20¥','demo-ai-bubble','.message-bubble','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','图书馆','visibleGroups','这是美食评论家在拍照写评论，虽然不吃但会带来很多客人。','winner','<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x204px;\x20vertical-align:\x20middle;\x22><path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/></svg>位置：','棋子元素查找:','\x0a评论区：\x0a','✅\x20[高效拉黑反应]\x20消息已保存到数据库','image-upload-choice-modal','🎨\x20应用设置时从CSS中提取到真实字体名称:','play','⚠️\x20发现了一些问题，详细信息请查看控制台。\x0a\x0a','\x0a\x0a要求：\x0a1.\x20回复要符合朋友圈评论的风格，简短、自然\x0a2.\x20严格按照你的人设来选择是否使用表情符号，不要使用与角色性格不符的emoji\x0a3.\x20不要过于正式或客套，要像真实的朋友一样互动','0.65','张图片]','AI返回的数据不是一个数组。','在房间里休息','🛒\x20[界面更新]\x20未找到代付卡片:','[朋友圈]\x20','群成员','自定义主题已重置','角色名称:\x20','✅\x20[高效照片分享]\x20消息已保存到数据库','summary_','🔥\x20[DEBUG]\x20处理普通字符串消息:','获取世界书信息失败:','当前时间与氛围','.character-blocked-hint','90cm×90cm','🔥\x20[短信模式]\x20使用短信消息作为记忆上下文，总消息数:','36-37','角色发布动态，同一分组下角色65%概率互动','回锅肉','selectedOptions','plain-paper','❌\x20generateCharacterFootprints:\x20currentFootprintsCharacter无效:','，已下','\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.nextElementSibling.style.display=\x27flex\x27;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-avatar-fallback\x22\x20style=\x22display:\x20none;\x22>','emoji-library-empty','\x20(已静音)','(未设置)','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar\x22\x20style=\x22background:\x20',',\x20静音:\x20','createElement','✅\x20[全局初始化]\x20','\x0a\x0a请生成从合理的起始时间到当前时间(','正在为你随机选择一首歌曲','，你的人设如下：','badgeText','当前模型:','加载音效设置失败:','✅\x20所有数据已清空，包括角色、聊天记录、群聊、动态、论坛、音乐、面具、世界书等所有应用数据','恢复角色','JSON格式错误:\x20','post-image-upload','未找到动态\x20','角色重试好友申请失败:','undescribed-emojis','未知艺术家','data-original-content','上午时段（精力充沛，适合重要工作、学习、创作）','🔧\x20[RECOVER]\x20恢复关联记录失败:','游戏已暂停保存','multi-select-btn','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','语音输入框：用户按回车键发送','🔄\x20[设置界面]\x20更新日记时间显示:\x20','\x20发送了一张描述的照片，内容是：\x27','\x20条动态吗？','[已修复的特殊消息]','五子棋','global-bottom-app-bar-input','正在思考...','contextId','🔥\x20[论坛帖子生成]\x20直接JSON解析失败，尝试提取代码块','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-desc\x22>','inline-block','📊\x20内存中的聊天记录格式分析:','⏭️\x20跳过已存在的足迹记录:\x20','头像数据长度:','\x20重试了第','此时间段内没有聊天记录','first_time','onclick=\x22showTransferConfirmDialog(','🔥\x20[AI撤回]\x20处理撤回消息:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>订单详情</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close-btn\x22\x20onclick=\x22window.closePaymentModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>订单号</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>','\x27)\x22\x20title=\x22取消置顶\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-priority-badge\x20','\x20在当前上下文中没有情景记忆需要清除','个\x20(存储在群聊对象中)\x0a\x0a','find','characterId','现在在一个动态下，','\x0a\x0a##\x20可参与评论的角色:\x0a','[表情]','paymentCountdowns','Levi\x27s',',\x20群聊:\x20','...\x0a[内容已截断]\x0a','.shopping-tab.active','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-icon\x22\x20style=\x22background-image:\x20url(\x27','获取动态评论失败:','清空购物车','用户评论了\x20','🔍\x20[转发消息]\x20当前聊天角色:','好友申请数据加载完成:','我们有约定——','<div\x20class=\x22message-avatar','\x0a转发的聊天内容：\x0a','✅\x20成功！全局记忆上下文包含短信内容','forward-target-list','comments','\x20项数据','准备导入:\x0a','8点怎么样？我准备一些饮料','friend-added-system-message','消息问题:','请选择角色查看记忆','\x0a#\x20🔥【修复】表情包库信息','received','群聊消息现在存储在chatMessages表中','Canada\x20Goose','yi-vision','#api-chat-screen\x20.header','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20查看详情\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','imageUrl','超紧凑',':\x20定时器','🔍\x20[sendSMSImage]\x20文本内容:','🔍\x20[第五处-AI图片]\x20找到群成员ID:','audioElement','删除歌曲失败:','\x20条相关数据','宝贝，记得按时吃饭哦','sms-message-item\x20','底部应用栏背景','删除纪念日失败:','.emoji-tab','：\x22这个时间，我记住了。\x22','⭐\x20置顶纪念日','🖼️\x20图片预加载失败:','30㎡','生成日记','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-item\x22\x20data-character-id=\x22','-\x20**反思失败**:\x20你已经被拒绝了','AI回复失败:','🧠\x20已添加群聊上下文关联记忆','#2196F3','global-memory-modal','38-39','querySelector','send_image_url','⏰\x20[日记定时器]\x20今天时间已过，调整为明天:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20个纪念日的置顶状态','🔄\x20加载短信联系人列表...','.woff2','<div\x20class=\x22worldbook-section\x22>','clear-episodic-memory','25L','TXT歌词',']\x0a\x0a转发的聊天内容：\x0a','#memory-mount-list\x20input[type=\x22checkbox\x22]:checked','setTime','\x22\x20class=\x22character-mini-avatar\x22>','📞\x20用户主动拨打电话，开关状态:','110cm','</div><div\x20class=\x22transfer-note\x22>','洗衣液','规则很简单：我会给出一个看似不合理的情景，你们通过提问来推理出真相。','他是医生，接到急救电话后出诊，但在路上心脏病发作去世了。','蓝牙音箱','已清空所有','点赞操作失败:','好神秘哦...','聊天头像已更新：','globalCustomFont','\x20\x20📝\x20聊天回合数:\x20','\x20\x20\x201.\x20是否在聊天设置中设置了AI头像','[用户发送了一张图片，并说：\x27','brand','\x0a\x0a现在你想在聊天中表达你对被拒绝的感受。请根据你的性格表达：\x0a-\x20你的失望、伤心、困惑或其他情绪\x0a-\x20你对这种情况的看法\x0a-\x20你是否还抱有希望\x0a\x0a要求：\x0a1.\x20用1-2句话表达你的真实感受\x0a2.\x20符合你的性格设定\x0a3.\x20不要过于戏剧化，要自然真实\x0a\x0a请用JSON数组格式回复：','✅\x20[高效续写]\x20单条消息已保存到数据库','userName','🗑️\x20删除短信相关时间线记录:\x20','load','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27','刷新帖子失败:','[onclick=\x22showRecoveryModal()\x22]','现在开始你们的推理吧！记住只能问是/否问题哦~','\x20\x20\x202.\x20角色卡是否有头像URL','status-update-frequency','decoration-underline','preset_','记忆已更新','🕐\x20时间戳设置已更新:','\x0a\x0a##\x20回复要求\x0a请以','结束游戏','firstChild','\x0a\x0a生成要求：\x0a1.\x20**角色是活生生的人**\x20-\x20','任意类型，可以是经典、恐怖、搞笑或浪漫中的任何一种','构建连续工作记忆失败:','chat-options-modal','&quot;','scheduledMomentsTimes','\x20项，释放\x20','情景记忆:\x20','currentSMSCharacter','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','canplaythrough','onplay','\x20条\x20','移动端长按菜单，messageId:','globalTopAppBar','⚠️\x20警告：当前函数可能会丢失部分数据！','好友申请:\x20','\x20---\x0a','完整备份_','dm_generated_','userBold','friend-request-modal','是的，你说得对。','get','加载心声失败:','blocked-message-hint','theme-item-configured','🔍\x20[processAIReply]\x20消息内容:','\x20主动发动态定时器已设置，间隔:\x20','system_','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20style=\x22color:\x20#576b95;\x20font-weight:\x20600;\x22>','你被用户在聊天应用中拉黑了','麻婆豆腐','✅\x20[论坛帖子生成]\x20成功解析JSON代码块，获得','schedule-times-modal','\x20增量更新失败:','search-keyword-input','强制删除角色\x20\x22','game_resume','纪念日已更新','.chat-tab','.ai-piece','🔄\x20加载短信应用数据...','quantity','🔍\x20[表情包修复]\x20发送给AI的消息内容:','character-sound-settings','停止所有音效失败:','custom-background','已拉黑','daily','保存全局世界书设置失败:','取消静音模式失败','timeAwarenessEnabled','全屏显示已开启！','debugTools.fix()\x20-\x20智能修复数据一致性问题（不会恢复已删除的对话）','🧠\x20获取到的全局记忆内容:','cssVariables','current-chat-identity','恢复紧急备份失败','启动角色状态更新定时器，间隔:','chatTheme_','\x20主动发动态已关闭','✅\x20[高效数据恢复]\x20消息已保存到数据库','chatBottomBg','完整导出失败:\x20','105cm','DPI','清除角色所有专属音效失败\x20(','原始响应:','白子(O)','writeText','gomoku-game-screen','\x0a\x0a【玩家问题】：','图标已上传','19:00','清除游戏时间线记忆失败:','<p\x20class=\x22text-center-gray\x22>该群聊暂无成员。请先在群聊信息中添加成员。</p>','offline-mode-active','⏰\x20[日记定时器]\x20','🧹\x20音频对象已清理','loadSound','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.load-more-comments-btn','1.\x20查看控制台获取详细信息\x0a','<img\x20id=\x22video-call-user-avatar\x22\x20src=\x22','poke-suffix-modal','AI描述的图片','ai_photo','custom-prompt-cancel','chat-bottom-bg-preview','div','.anniversary-item.expanded','在书房研读典籍','++id,\x20chatId,\x20themeData,\x20timestamp','，之前因为某种原因拉黑了用户。现在用户主动向你发来好友申请，希望重新建立联系。\x0a\x0a##\x20角色信息:\x0a-\x20你的身份:\x20','•\x20用自然的语言表达记忆连接：\x22还记得...\x22、\x22就像上次...\x22、\x22之前你说过...\x22\x0a','\x20条情景记忆','paddingRight','📱\x20模拟记录短信事件...','清空消息保存失败，回退到全量保存:','创建新论坛','position','✅\x20数据同步修复完成！\x0a\x0a修复了\x20','videoAvatarSettings_','运动表带','#forum-persona-selection\x20.selection-item[data-id=\x27','🌦️','publish-moment-screen','suffix','\x22\x20onclick=\x22selectGame(\x27','所选数据已彻底清除！','数据状态检查完成','想和你聊聊天','group-member-count-display','phone-photo-detail-time','data.workingMemory','#ffffff','blockerId','的角色卡头像无效，大小或格式问题','聊天消息:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#ff6b6b;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','95cm','\x20的聊天数据...','游戏已结束','currentAnswer','设置聊天主题颜色','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notice-text\x22>你被\x20','index','[角色反应]','请现在开始生成论坛帖子，只输出JSON数组，不要聊天消息格式，不要任何解释文字。','角色发送的照片','中性关系（同学/同事）','深度清理失败:','我明白了，我会按照指令生成包含图片理解的论坛回复。','参与了关于\x22','海龟汤','14:32','aiItalic','09:00','.persona-selection-name','.txt','的完整聊天数据备份','约定了活动','padding','import-character-btn','茶颜悦色','user-video-avatar-preview','：\x22又是一年生日，时间过得真快啊。\x22','toLocaleDateString','.preview-text','chat-top-bg-input','myBubbleColor','：\x22生日...算是个值得记住的日子吧。\x22','🔍\x20[generateSMSReply]\x20使用多模态API调用','AI发送表情包:','生成评论失败:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-preview\x22>','grid','删除评论:\x20','保存后检查角色数组:','phonePhotosGenerated','onclick=\x22','🔍\x20[parseGroupChatAiResponse]\x20找不到发送表情包的成员:','最近表情:\x20','\x20\x20\x20---','API\x20Error:\x20','字体CSS已加载，字体名称:\x20','status_','\x22,\x20全局:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-item\x22\x20onclick=\x22openPhonePhoto(\x27','\x20MB)','\x20\x20📋\x20点击下方\x22恢复紧急备份\x22按钮来尝试恢复','保存的头像:','就在市中心的购物中心三楼','\x20条过期/未收藏/非用户发布的帖子。','点击\x22取消\x22继续完整导出（可能失败）','请输入CSS代码','\x20和你约定了约会：','forwardedMessages','保存壁纸失败，请重试','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','10:00','\x22生成手机中的备忘录列表。\x0a\x0a','现代都市生活分享社区','浏览器信息:','rerender','📱回复短信:\x20\x22','activities','🔍\x20AI记忆提取原始响应:','✅\x20当前打开的足迹页面已更新','\x20\x20\x20isPersonal:\x20','🔍\x20[processAIReply-表情包]\x20原始msgData:','条回复！','📝\x20=====\x20Prompt结束\x20=====','outerHTML','次，要思考为什么会这样','开始处理角色评论，可见角色数量:','✅\x20线下模式界面设置已保存到localStorage\x20(','📱\x20没有可用的动态记忆','视频通话已结束，通话时长\x20','\x20的足迹，实时追加新足迹','setCharacterSound','🔧\x20[修复]\x20createGroupChat被调用，身份ID:','isLocalFile','.message-bubble,\x20.offline-message-content,\x20.message-item,\x20.contact-item,\x20.sms-message-bubble','的聊天头像设置','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22comment-time\x22\x20style=\x22color:\x20#999;\x20font-size:\x2011px;\x20margin-top:\x202px;\x22>','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【重要】确保图标字体不被覆盖\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.fas,\x20.far,\x20.fab,\x20.fal,\x20.fad,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20i[class*=\x22fa-\x22],\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.icon-bg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-icon\x20.icon-bg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.back-btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.action-btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.settings-icon,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20[class*=\x22icon-\x22]:not(.app-icon)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x22Font\x20Awesome\x206\x20Free\x22,\x20\x22Font\x20Awesome\x206\x20Pro\x22,\x20\x22Font\x20Awesome\x205\x20Free\x22,\x20\x22Font\x20Awesome\x205\x20Pro\x22,\x20FontAwesome\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','清理投票记录失败:','还没有表情包，点击+号添加','个位置','✅\x20已清理\x20','recalled-message','userQuote','offlineUISettings_','表情包消息单条保存失败，回退到批量保存:','❌\x20[约定时间线]\x20记录约定创建事件失败:','存储使用情况:\x0a','color','chatSettings_emergency_','horror','MAX_CORE_MEMORIES_PER_CHARACTER','🔥\x20parts:','\x20的拉黑吗？','医用外科','count','[特殊消息类型]','charging','\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20特别针对手机界面的文字部分，排除图标\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20.header-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.setting-label,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.setting-desc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.app-icon\x20.label,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble\x20.content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-textarea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.form-button,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.list-item\x20.item-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.list-item\x20.item-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.post-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.forum-post-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.font-size-preview-text,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#main-time,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#main-date,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.settings-item-left,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-list-item\x20.name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.chat-list-item\x20.last-msg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.contact-item\x20.contact-name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.contact-item\x20.contact-desc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.modal-title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.modal-body,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.btn,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button:not(.icon-only),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20input,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20textarea,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20select,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【新增】日记相关元素\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#today-diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#single-diary-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#diary-preview-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-mode-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.diary-settings-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','🔍\x20[消息渲染]\x20通过name找到成员:','send-btn-item','#persona-selection-modal\x20.persona-selection-item','.contact-item','game_summary','进行了音乐互动','获取今日日记失败:','status-frequency-setting','CURRENT_USER_IMAGE',',\x20窗口:\x20','<div\x20class=\x22anniversary-item-description\x22>','blur','设置静音模式失败','onload','音乐封面:\x20','基于概率选择不进行角色间互动','请输入字体链接','你已经尝试了','++id,\x20[userId+replyId],\x20userId,\x20replyId,\x20timestamp','current-memory-mount','Cartier','\x20的短信对话和记忆...','AI回复:','open','add-button','#character-phone-photo-screen\x20.app-title','好友申请接受消息保存失败，回退到全量保存:','.load-more-messages','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','状态显示开关被点击:','originalMessages','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22closeModal()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20onclick=\x22clearVoteHistory()\x22>清空历史</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','所有配置已清空','✅\x20已更新\x20','.home-font-option','找不到描述输入框','forwarded-message-item','续写按钮样式已设置','\x27)\x22\x20data-anniversary-id=\x22','values','🔄\x20页面卸载前强制保存设置...','===\x20群聊详细信息\x20===','💰\x20转账：','🔍\x20[引用回复-主分支]\x20currentChatCharacter.id:','听起来很棒！几点开始？','生成日记失败','\x22\x20class=\x22sms-image\x22\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-character-item\x22\x20onclick=\x22selectSMSCharacter(\x27','傍晚时分（适合晚餐、放松、娱乐、与人交流）','2-digit','🛒\x20[代付响应处理]\x20保存代付状态失败:','分享帖子失败:','•\x20角色数据问题:\x20','transfer-confirm-btn','album','提醒：明天是','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','你好，谢谢你接我电话。','位置已分享','全局底部应用栏背景已设置','\x27)\x22]\x20.group-chevron','确定要解除对\x20','current-worldbook-mount','scrollBy','❌\x20找不到聊天标题元素','\x20保存聊天自定义主题到Dexie','生成今日摘要失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-message\x20','turtle-soup-game-timer','工作日','15ml','.sms-message','体温计','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[Gemini\x20API]\x20添加文本部分:','🎭\x20故事数据不完整:','太好了','确定要删除面具\x22','100cm','search-stats','export-character-btn','letter-spacing-value','[系统消息：用户将你从黑名单中移除了]\x0a\x0a你是','数据序列化失败:\x20','\x20从Dexie加载自定义主题','16GB','character-name','avatarShape','\x20添加情景记忆:\x20','clearCharacterSound','✅\x20showGroupChatMemberSelection被调用，接收到的personaId:','🌨️','DOM状态:','✏️\x20更新记忆数据:','rounded-square','button','📊\x20历史消息统计:\x20线上','抱歉，Gemini\x20API\x20不支持\x20GIF\x20格式的图片。\x0a\x0a请选择其他格式的图片，如：\x0a•\x20JPEG\x0a•\x20PNG\x0a•\x20WEBP','请输入新的群聊名称:','.worldbook-tab','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-minus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quantity-number\x22>','<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20style=\x22margin-right:\x204px;\x20vertical-align:\x20middle;\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22#576b95\x22\x20stroke-width=\x222\x22><path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22></path></svg>','<div\x20class=\x22forum-empty-state\x22><p>你还没有发过帖子</p></div>','.profile-tab.active','clientY','由角色创建的纪念日','🚫\x20[防崩坏]\x20检测到5分钟内的重复好友申请，跳过','你是一个客观的记录员，需要为以下活动生成一份简洁的记忆摘要。\x0a\x0a角色：','<div\x20class=\x22friend-request-result\x20','_isRegenerating','&id,\x20name,\x20date,\x20type,\x20yearly,\x20characterId,\x20createdBy,\x20characterQuote,\x20userQuote,\x20isShared,\x20isPinned,\x20backgroundImage,\x20userAvatar,\x20countType','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','=========================','\x20的近期动态:\x0a','undefined','✅\x20清理了\x20','characterFootprints','加载API设置失败:','好友申请拒绝消息保存失败，回退到全量保存:','Switch游戏机','_update_','AI角色评论失败:','\x20的低质量旧版本记忆...','charAt','✅\x20批量删除完成:\x20','[通话消息]','♪\x20暂无歌词','repeat','\x20个设置，可以安全清理localStorage数据。\x0a\x0a','成功加载','我们相遇的日子','我回复:\x20\x22','shopping-categories-list','\x20的足迹，清空并重新加载角色\x20','offline-message\x20','：\x22我已经开始期待了。\x22','🕐\x20[定时器设置]\x20','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','CSS预览已应用','Herschel','comment_','diarySettings_','SUMMARY_TRIGGER_MESSAGE_COUNT','紧急备份也无法加载:','offline-font-url','++id,\x20momentId,\x20locationName,\x20latitude,\x20longitude,\x20timestamp','论坛帖子:\x20','🔍\x20浏览器兼容性诊断报告:','expand-btn-item','⏰\x20[日记定时器]\x20解析时间:\x20','video','group_','<span\x20style=\x22font-style:\x20italic;\x20color:\x20#999;\x20font-size:\x2013px;\x20line-height:\x201.4;\x22>[配图：','让我记录','正在调用文本API...','2024年3月12日\x2010:15','test-publish-setting','从IndexedDB加载recentEmojis:','🚫\x20[定时器设置]\x20','女朋友对那种花过敏，男人每天买同样的花是因为记住了她的过敏症。买不同花说明他忘记了她的身体状况，她觉得他不够关心自己。','\x0a请确保文件是有效的备份文件','表情包库更新成功','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-username\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[else分支修复]\x20发送文字描述\x20(','今天读了一本很有趣的书，关于时间管理的...','角色\x20\x22','群头像更换消息保存失败，回退到全量保存:','center','setProperty','📷\x20图片消息','api-chat-screen','\x0a#\x20情景记忆\x0a','\x20不存在，可能已被删除','#forum-persona-selection\x20.selected','无钢圈','**:\x20','\x0a-\x20最近对话：\x0a','🛒\x20[代付处理]\x20发现未处理代付请求，分析AI回复:','[系统消息：用户将你拉黑了','🔍\x20[callChatAPI-AI图片]\x20找到群成员ID:','数据导入成功！已导入：','🚨\x20[URGENT]\x20最近24小时上传的表情包:','检测到数据库错误，是否重置数据库？\x0a注意：这将清除所有本地数据。','不想支付','\x20在当前聊天中更换了头像，但角色卡保持不变','\x20的时间线记录:','老板说这次会议很重要，可能会讨论新项目','<p\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x20margin-top:\x208px;\x22>💡\x20提示：支持\x20&lt;span\x20color=\x22颜色\x22&gt;文本&lt;/span&gt;\x20和\x20*斜体*\x20格式</p>','4.\x20删除自定义背景\x20(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','中筒袜','✅\x20文件恢复成功！','green-bubble','查看核心记忆失败','检测到AI将多条消息合并在一个元素中，正在自动分拆:','global-bg','footprintActivities','chatMode','设置回合数:','```json','应用图标已保存:','.moment-comments-section','global-top-app-bar-input','ai-chat-nickname','🔥\x20content:','black','角色专属音效设置成功','元，备注：','\x20个聊天设置...',',\x200.3)','加载好友申请数据失败:','\x0a\x0a输入数字（逗号分隔），推荐选择3：','这个人是邮递员，推门进入时发现屋主已经死了很久，尸体腐烂发臭。','customType','play-mode-btn','我替你买','\x22中，与多个角色和用户互动。群聊成员包括：','🧠\x20内存使用\x20','button-settings','button-continue','✅\x20全局自定义主题数据已迁移','外婆家','这可能是因为数据量过大导致的内存不足。\x0a\x0a','匿名网友','语音输入对话框：内容为空，聚焦输入框','已移除\x20','fas\x20fa-coffee','</strong>\x20的聊天记录吗？\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22section-header\x22\x20style=\x22padding:\x200\x200\x2010px\x200;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20section-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22section-title\x22>同步清除相关记忆</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-core-memory\x22\x20value=\x22core\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>核心记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>角色记住的关键信息（如生日、关系）。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-episodic-memory\x22\x20value=\x22episodic\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>情景记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>日常互动和经历的记忆。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22clear-timeline\x22\x20value=\x22timeline\x22\x20checked>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>时间线</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>所有活动的详细时间记录。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-top:\x2015px;\x20font-size:\x2012px;\x20color:\x20#999;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>提示：</strong>聊天设置（如身份、背景）将会被保留。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20style=\x22background-color:\x20#ff3b30;\x22\x20onclick=\x22executeClearHistory()\x22>确认清空</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','user-message','删除消息失败','\x20个对话的置顶状态','✅\x20初始状态：无联系人无聊天记录，这是正常的','\x0a\x0a特殊样式说明（可选使用，每种样式在同一篇日记中最多使用1次）：\x0a-\x20如果写到不该说的话或后悔写下的内容，可以用\x20<strike>内容</strike>\x20标记划掉\x0a-\x20如果表达重点或语气激动的内容，可以用\x20<mark>内容</mark>\x20标记高亮\x0a\x0a请直接写出','<i\x20class=\x22fas\x20fa-check\x22></i>','turtle-soup-game-screen','fas\x20fa-repeat','描述保存成功','loading-modal-','delete-btn','post-title-input','user_photo','character-item','forum-character-selection','rejected','sms-screen','\x22吗？\x0a\x0a删除后无法恢复，但表情包本身不会被删除。','phoneBorderEnabled','有自己的生活节奏\x0a2.\x20**保持逻辑连续性**\x20-\x20基于最后一个活动的位置和状态自然过渡\x0a3.\x20**符合时间特点**\x20-\x20考虑','songs','++id,\x20momentId,\x20visibility,\x20visibleGroups,\x20timestamp','important','single-chat-body','<div\x20class=\x22timestamp\x20timestamp-avatar\x22>','清空失败','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fontsapi','一个人推门进入房间，看到房间里的情况后立即报警。','\x20条短信消息','\x0a\x0a##\x20特殊情况说明\x0a用户在聊天应用中拉黑了你，但你现在通过短信联系用户。你可能会：\x0a-\x20表达想要和解的意愿\x0a-\x20解释之前的误会\x0a-\x20请求用户给你一个机会\x0a-\x20表现出真诚的态度\x0a请根据你的性格和之前的互动历史来回应。','颜色已保存到预存','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有纪念日</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20添加重要的日子</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','记忆数据已刷新','不出钱','✅\x20所有世界书已清空','的关系，对ta的评论进行回应。要求：\x0a1.\x20严格按照你的人设进行回复，不能混淆角色\x0a2.\x20回复要自然、符合朋友圈评论风格\x0a3.\x20可以是赞同、不同观点、补充、提问或开玩笑\x0a4.\x20要体现出你和','\x20条消息到IndexedDB','⚠️\x20未找到原始标题，可能已被清除','已清理过大的localStorage备份','persona-chevron','🔥\x20[修复continuation]\x20发现群聊消息:','已启用但未选择','line-height','\x0a-\x20**季节:**\x20','.moment-item','30天记忆','未设置','\x20个项目','\x0a最近的对话参考:\x0a','我明白了，我会按照这些要求进行对话。','reply','INCOMING_CALL','memoryEvents','❌\x20暂时离开：找不到模态框','加载日记设置失败:','background-size','data-has-custom-global-','⚠️\x20全局紧急备份数据格式错误:\x20','\x20条损坏的消息','forwarded-view-modal','获取最近动态失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-name\x22>','LRC歌词','verno','🧹\x20足迹缓存检查完成:\x20共\x20','bubbleWidth','chat-frequency-setting','\x0a可下棋位置示例:\x20','🎵\x20创建新的音频元素','新疆葡萄','global-back-button-item','<svg\x20width=\x2250\x22\x20height=\x2250\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><rect\x20width=\x2250\x22\x20height=\x2250\x22\x20fill=\x22#f0f0f0\x22/><circle\x20cx=\x2225\x22\x20cy=\x2220\x22\x20r=\x228\x22\x20fill=\x22#999\x22/><circle\x20cx=\x2225\x22\x20cy=\x2240\x22\x20r=\x2212\x22\x20fill=\x22#999\x22/></svg>','条消息','<option\x20value=\x22\x22>选择角色（可选）</option>','character-sound-enabled','选择「取消」：放弃本次操作','动态图片已保存到会话存储:\x20','.shopping-search-container','reply_to_user','壁纸:\x20','repeat-btn','blockedCharacters','🔍\x20[generateSMSReply]\x20收到的用户消息:','group_collapsed_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-item\x22\x20data-persona-id=\x22','📷\x20图片：','❌\x20未找到动态:','字体自动缩放已关闭！','\x22已保存','sms-character-selector-body','短信API调用失败:','通知角色被拉黑失败:','动态评论:\x20','1kg','\x20动态内容不是有效JSON，使用原始文本','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-name\x22>','backgroundChatFrequency','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🎭\x20DM正在分析讨论...','sortBy','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22saveDiaryEdit()\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','isGlobal','🔥\x20[转账界面更新]\x20未找到转账卡片，重新渲染聊天界面','钥匙扣','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x20删除\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','点击获取AI回复','使用全局用户头像','data-theme','\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','喜欢你','🧠\x20记忆设置:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quote-author\x22>你：</span>','.anniversary-tab','gemini-exp','-time','debugMomentsSystem','09:15','12片','确定要删除选中的\x20','后台异步加载ID为\x20','周大福','我付款','\x27,\x20\x27','原动态：','\x27)\x22]\x20.app-icon\x20i','smsContacts','你好！','.emoji-checkbox:checked','保存剧情总结失败','正在序列化数据...','舒芙蕾','\x0a\x0a用户刚刚将你拉黑了。请根据你的性格做出反应。你可以：\x0a1.\x20表达你的感受（困惑、伤心、愤怒、无所谓等）\x0a2.\x20思考可能的原因\x0a3.\x20决定是否要道歉或反省\x0a4.\x20**【推荐】发送好友申请来尝试修复关系**\x20-\x20这是最直接的修复方式\x0a5.\x20或者表现出符合你性格的其他反应\x0a\x0a💡\x20**建议**：大多数角色在被拉黑后都会想要修复关系，发送好友申请是最好的方式。\x0a\x0a##\x20🔥【重要】输出格式要求\x0a你的回复必须是JSON数组格式：\x0a-\x20普通反应：[\x22我被拉黑了？为什么...\x22]\x0a-\x20发送好友申请：[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我不应该那样说话，能原谅我吗？\x22}]\x0a-\x20混合回复：[\x22我知道我被拉黑了...\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22给我一个机会重新开始好吗？\x22}]\x0a\x0a##\x20🔥【好友申请格式】\x0a如果你想修复关系，可以发送好友申请：\x0a-\x20严格格式：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的道歉或请求信息\x22}\x0a-\x20示例：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我想和你重新做朋友\x22}\x0a\x0a请用JSON数组格式回复，可以包含1-2句话的反应和/或好友申请：','demo-my-bubble','_proactive_','日记设置:\x20','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22toggleChatSelection(\x27','fas\x20fa-check-square','昵称设置已保存','\x20完整足迹生成成功','\x0a世界书设定:\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-avatar\x22\x20style=\x22','🔍\x20[引用回复-主分支]\x20设置群聊发送者:','expand','characterName','🎨\x20气泡样式已应用:\x20','\x0a-\x20**时间流逝:**\x20用户上次回复是','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a#\x20最近活动时间线\x0a','删除失败','男人得了严重的抑郁症，觉得自己像行尸走肉一样没有灵魂。\x27找到影子\x27其实是他重新找回了生活的希望和自我认同。','角色数据:','removeAttribute','moments_','🔧\x20修复身份选择事件绑定，找到元素:','my-chat-nickname','从localStorage备份加载自定义表情包:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27','，用户执','download','hide','全文关系分析结果:\x20负面=','\x20记录了生日：','Enter',')的角色行为足迹。要求:\x0a\x0a1.\x20行为必须符合角色的人设和性格特点\x0a2.\x20参考世界书设定中的背景信息\x0a3.\x20结合全局记忆中的相关信息\x0a4.\x20如果有今日聊天记录，请确保聊天时间点的足迹是\x22正在与用户聊天\x22或相关活动\x0a5.\x20其他时间点生成合理的活动，可以是任何符合角色特点的行为\x0a6.\x20行为要自然、真实，体现角色的真实生活\x0a7.\x20不要回避任何时间段，角色可能在睡觉、工作、娱乐、社交、做家务、情侣夜生活等任何活动，角色要拥有符合人设的作息\x0a8.\x20每个足迹包含具体时间、行为描述、地点\x0a9.\x20行为类型可以是:\x20sleep(睡觉),\x20daily(日常),\x20work(工作),\x20leisure(休闲),\x20social(社交),\x20travel(出行),\x20chat(聊天),\x20nightlife(夜生活),\x20intimate(私密),\x20etc.\x0a\x0a⚠️\x20重要：足迹描述风格要求\x0a-\x20每条足迹描述必须在30字以内\x0a-\x20使用客观、简洁的记录风格，类似日志\x0a-\x20避免过度文艺化的描述和场景渲染\x0a-\x20直接记录行为事实，不要过多情感描述\x0a-\x20正确示例：\x22正在与小夜聊天，告诉她自己会一直等下去\x22、\x22没什么胃口，随意吃了点午饭\x22\x0a-\x20错误示例：\x22走廊的声控灯熄灭，周围陷入一片黑暗和寂静。他一动不动，像一座雕塑\x22\x0a\x0a请以JSON数组格式返回，每个足迹对象包含:\x0a{\x0a\x20\x20\x22time\x22:\x20\x22HH:MM\x22,\x0a\x20\x20\x22activity\x22:\x20\x22具体的行为描述（30字以内，客观记录）\x22,\x0a\x20\x20\x22location\x22:\x20\x22具体地点\x22,\x0a\x20\x20\x22type\x22:\x20\x22行为类型\x22\x0a}\x0a\x0a只返回JSON数组，不要其他解释文字。确保时间按顺序排列，且不超过当前时间','255,\x200,\x20255','update_poke_suffix','请选择应用和上传图标','color-picker-modal','无法在群聊中找到发送者信息:\x20','✅\x20[高效存储清理]\x20消息已保存到数据库','检查聊天历史失败:','刷新失败，请稍后重试','删除了\x20','游戏异常结束','serviceWorker','全局返回按钮样式已设置','lyricsTimings','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-countdown-label\x22>','。用户在游戏中对你说：\x22','\x20个短信对话和所有相关记忆','.appointment-item[onclick*=\x22','line-height-slider','replyToContent','IndexedDB中的消息数:','🔄\x20已更新角色\x20','👥\x20群成员管理功能开发中...\x0a\x0a将支持以下功能：\x0a•\x20查看群成员列表\x0a•\x20设置群管理员\x0a•\x20管理群成员权限\x0a•\x20禁言/踢出群聊','\x20条,\x20群聊消息\x20','background-moments-enabled','result-bar-bg','hideAvatars','注意：大文件在页面刷新后需要重新添加','考虑改变策略，或者通过其他方式表达歉意','photo-description-modal','\x20\x20✅\x20恢复聊天设置:\x20','pinnedConversations','iconClass','\x20已被移出群聊','.offline-avatar.user-avatar','single','empty-group-message','post-view-screen','ServiceWorker\x20registration\x20successful\x20with\x20scope:\x20','push-notification','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-title\x22>','🆕\x20生成新的心声内容','星期一','开始保存到IndexedDB...','accepted','0:00','padStart','\x22>15:00</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27','🧹\x20已清除Dexie数据库中的主题数据','发现损坏的消息content，正在修复:','🔍\x20[callChatAPI]\x20处理消息:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar\x22\x20style=\x22background:\x20','Chanel\x20No.5','musicCovers','😅\x20对方获胜了！','✅\x20Safari长按处理已优化','--custom-send-btn','🔍\x20[消息渲染]\x20name查找详情:','dmPersonality','历史消息中发现未处理的对象类型:','\x27)\x22>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','persona-description','\x20的足迹...','日记内容不能为空','selection-buttons','🧠\x20智能记忆检查\x20-\x20角色:\x20','世界线已变动！正在刷新论坛...','anniversary_type','角色互动API调用失败\x20(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22pinned-card-unpin-btn\x22\x20onclick=\x22event.stopPropagation();\x20unpinAppointment(\x27','replace','🔍\x20[AI处理调试]\x20表情包描述:','🔍\x20[第四处-AI图片]\x20找到群成员ID:','dragleave','✅\x20角色\x20','角色_','-paper','main-date','聊天背景设置已保存',';\x20color:\x20',',\x20不是发布者:\x20','manual','\x0a\x0a##\x20最近的评论上下文:\x0a','老乡鸡','renderMessageList','canplay','translateX(-50%)\x20translateY(-10px)','background-interaction-enabled','<i\x20class=\x22fas\x20fa-comments\x20group-interaction-icon\x22\x20title=\x22该分组角色可以在动态中互动\x22></i>','备忘录API生成失败，使用模拟数据:','大番茄','previewState','用户获胜','浏览器类型:','getHours','未知的头像URL格式:','orderBy','我帮你购买','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>\x20AI正在总结中...','<div\x20class=\x22location-history-empty\x22>暂无历史记录</div>','anniversary-display','找不到avatar-upload元素','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27','保存头像设置失败:','✅\x20点击下一步按钮，当前selectedPersonaId值为:','🎵\x20语音消息：','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📋\x20数据库中的所有动态ID:','chat-top-bg','头像预览设置成功，图片数据已存储','vibrate','转账\x20¥','KB\x20空间，处理了\x20','20袋装','buttons','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-name\x22>','你先行','这个男人是盲人，电话里告诉他医院弄错了，他的眼睛其实没有治好，他以为自己重见光明了，但其实一直都是黑暗的。','的时间。','listeningTimer','children','🔍\x20分析\x20','zeoseven.com','&gt;','应用初始化失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20400px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>退出线下模式</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请选择退出方式：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22exitWithoutSummary()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x20结束且不总结（推荐）\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22exitTemporarily()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-pause\x22></i>\x20暂时离开\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22exitWithSummary()\x22\x20id=\x22summary-btn\x22\x20style=\x22background:\x20#f8f9fa\x20!important;\x20color:\x20#000000\x20!important;\x20border:\x201px\x20solid\x20#000000\x20!important;\x20font-weight:\x20bold\x20!important;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-book\x22></i>\x20结束并总结\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-top:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20<strong>结束且不总结</strong>：结束剧情，对话记录保存到线下模式聊天记录中<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20<strong>暂时离开</strong>：保留当前对话状态，可以稍后继续剧情<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20•\x20<strong>结束并总结</strong>：生成AI剧情摘要并保存到记忆系统和聊天记录中\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.app-item-selector','API未配置，备忘录使用模拟数据','📝\x20记录时间线事件:\x20','条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22color:\x20#999;\x20font-size:\x2012px;\x20margin-top:\x205px;\x22>提示:\x20修改后的内容将同步到AI的工作记忆中</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22storyline-summary-editor\x22\x20style=\x22width:\x20100%;\x20height:\x20300px;\x20padding:\x2015px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20font-size:\x2014px;\x20line-height:\x201.6;\x20resize:\x20vertical;\x22\x20placeholder=\x22请输入剧情总结...\x22>','json','\x20将在','50个','\x22\x20的头像','other','100%\x20100%','content-width-slider','function','我也这么觉得呢~','数据同步修复失败:','🧠\x20已将挂载记忆添加到角色提示词中','🔍\x20[callChatAPI-第三处]\x20AI主动戳一戳:','♪\x20歌词解析失败','🔄\x20加载短信消息...','\x20吗？','🔍\x20[sendSMSImage]\x20创建的消息内容:','确定要删除这个约定吗？','iPhone\x2014','\x20<span\x20class=\x22chat-exists-badge\x22>已有对话</span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-avatar\x22\x20style=\x22background-color:\x20','pin','homeFontColor','轻量级导出包含：角色、消息、记忆系统、世界书、论坛等核心数据\x0a','🔍\x20[generateSMSReply]\x20合并后的内容:','🧪\x20测试主动发动态功能\x20-\x20角色:\x20','height','\x20回复了\x20','\x27)\x22><div\x20class=\x22dreamy-photo\x22><div\x20class=\x22photo-misty-bg\x22></div><div\x20class=\x22photo-badge\x22><i\x20class=\x22fas\x20fa-image\x22></i></div><div\x20class=\x22sparkle-container\x22><div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div><div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div><div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div></div><div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22><div\x20class=\x22photo-description\x22>','诊断失败，请查看控制台','订单信息不存在','coverImageData','搜索IndexedDB所有表...','backgroundDiaryEnabled','请先选择一个聊天窗口','#forum-character-selection\x20.selected','<i\x20class=\x22fas\x20fa-microphone-slash\x22></i>','\x20张图片，节省\x20','phone-photo-detail-image',';\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22','content-padding-slider','开始检查聊天历史数据...','卡布奇诺','mousemove','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x20编辑\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请先选择一个聊天角色','ai-bubble-color','getMinutes','个世界书的ID','加载表情包库失败:','今天跑步5公里，做了30分钟力量训练...','AX3000','chat-location-modal','星光色','已切换到\x20','群聊数量:','\x20\x20-\x20总聊天对象:','anniversary-placeholder','edit-char-count','rgb(','消息修复保存失败，回退到全量保存:','stores','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-content-flex\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-title\x22>','API未配置，使用模拟数据','three','删除后状态:','今天还没有足迹记录','音效文件不能超过3MB','🔍\x20[renderForwardedMessage]\x20转发消息数据:','封面已更新！','我买下','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-items\x22>','linkedWorldBookIds','\x0a-\x20群聊消息数量:\x20','是否支持视觉:','appointment-user-avatar-preview','incoming-call-avatar','localeCompare','mention-character-item','image/jpeg','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22zh-CN\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>与\x20','半夜惊醒','visibility','•\x20你有','🔔\x20[推送通知]\x20纪念日/约定通知，无条件显示','\x20|\x20内容:\x20','orderNumber','📱主动发短信:\x20\x22','</p>','没有找到可重建的角色','找不到api-chat-settings-screen元素','清理拉黑系统消息失败:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>¥','：\x22我想把这个日子记录下来。\x22','aiBubbleColor',')\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','model-select','.like-count','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,\x20255,\x20255,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x201px\x203px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','current-screen-size','\x22来指代双方\x0a3.\x20记录重要的情节转折和结果\x0a4.\x20避免过度的主观情感描述和过度修饰\x0a5.\x20使用简洁明了的语言\x0a6.\x20重点记录关键细节和对后续剧情有影响的关键信息\x0a7.\x20严格使用第三人称：用户做了什么，','.mention-icon','界面刷新完成！请检查角色列表是否正常显示。','已收款','\x0a\x0a##\x20重要格式要求：\x0a-\x20直接返回动态文本内容，不要使用JSON格式\x0a-\x20不要添加任何代码块标记\x0a-\x20不要添加\x22动态内容：\x22等前缀\x0a-\x20直接以动态正文开始\x0a\x0a请生成一条符合你人设的动态内容：','发送图片失败','\x20有自定义主题，开始清除...','保存日记设置失败:','</select></div>','选择聊天底部背景来源','\x20条)\x0a\x0a','🔥\x20candidates[0]:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥','🗑️\x20删除相关时间线记录:\x20','📊\x20获取到的时间线记录数量:','✅\x20删除测试完成，刷新页面验证是否会重新出现','清理核心记忆失败:','✅\x20纪念日提醒系统已启动\x20-\x20只在早8点和晚8点提醒','是否为日记:','🔔\x20[推送通知]\x20AI回复完成，准备创建推送通知，消息数量:','vision','打开日记失败','\x20失败:','toLocaleString','设置界面未找到，请刷新页面重试','.poll-option','删除前状态:','library-stats-','更新动态时间失败:','.app-title','.publish-btn','aiItalicTextColor','的性格特征\x0a5.\x20**生活要真实丰富**\x20-\x20包括工作、休息、娱乐、社交、私密时光等各个方面\x0a6.\x20**情绪有变化**\x20-\x20心情要有自然的起伏和变化\x0a7.\x20**不回避任何活动**\x20-\x20可以是睡觉、工作、娱乐、夜生活、私密活动等任何符合角色的行为\x0a\x0a⚠️\x20足迹描述风格要求：\x0a-\x20每条足迹描述必须在30字以内\x0a-\x20使用客观、简洁的记录风格，类似日志\x0a-\x20避免过度文艺化的描述和场景渲染\x0a-\x20直接记录行为事实，不要过多情感描述\x0a-\x20正确示例：\x22正在与小夜聊天，告诉她自己会一直等下去\x22、\x22没什么胃口，随意吃了点午饭\x22\x0a-\x20错误示例：\x22走廊的声控灯熄灭，周围陷入一片黑暗和寂静。他一动不动，像一座雕塑\x22\x0a\x0a重要提醒：\x0a-\x20角色有自己的完整生活，不完全依赖用户互动\x0a-\x20每个时间段都应该有合理的活动安排，无论是什么时间\x0a-\x20','backgroundMomentsFrequency','appointment-priority','通话形象设置已保存','translateZ(0)','线下记录:\x20','isApplied','<span\x20class=\x22italic-gray\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AI戳一戳消息保存失败，回退到批量保存:','profile-page','phone-note-detail-body','fas\x20fa-moon','分享消息单条保存失败，回退到批量保存:','.memory-save-btn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','moments-frequency-setting','vinyl-song-title','🔥\x20[短信API]\x20获取记忆数据失败:','清空投票历史失败:','🔍\x20[转发消息检查]\x20消息类型:','未知位置','：\x22那一刻超级重要的！我永远不会忘记！\x22','gomoku-piece\x20','\x20已主动发送短信','编辑局部设定','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gap:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20flex-start;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我来付','group-member-item','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22message-time\x22>','更新气泡样式显示：无当前聊天角色，跳过操作','ai-bubble-opacity-value','续写按钮','mount-item','删除表情包库失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translate(-50%,\x20-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.8);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x206px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','世界书已创建！','，基于你的人设、记忆、与发布者的关系以及评论区的现有讨论，对这条动态发表评论。\x0a\x0a##\x20🚨\x20关键行为准则：\x0a1.\x20**人设第一**：严格按照你的人设行事，绝不违背角色设定\x0a2.\x20**关系敏感**：特别注意你与','===\x20聊天记录分析结果\x20===\x0a\x0a','群昵称修改成功！','.likes-display','✅\x20已删除短信消息:\x20','：\x22从那天开始，我们就是特别的关系啦！\x22','不请客','但要考虑之前的失败经历','call-message-container','编辑AI回复','🧠\x20线下模式全局记忆内容预览:','群聊数据迁移完成:','📖\x20剧情总结生成prompt:','paddingLeft','artist','phoneNotesGenerated','我要记录','🔍\x20[第四处-AI图片]\x20检测到群聊消息，发送者:','批量删除消息保存失败，回退到全量保存:','\x22\x20onchange=\x22updateScheduleTime(','\x20<\x200.8\x20=\x20','🎮\x20AI生成的游戏记忆:','📊\x20当前足迹角色:','🎨\x20全局主题缓存已清除','便携版','toArray','🎨\x20全局自定义主题样式已应用','当前页面:\x20','group-characters-','globalStatusUpdateFrequency','无法悔棋，棋盘上棋子不足','&id,\x20name,\x20category,\x20isPersonal','format-json','aiNormalTextColor','不愿意出钱','selectedAiChatAvatar','🔧\x20清理数据库重复记录...','emoji-library-form-modal','keypress',')的设置失败:','modal-progress','开始读取文件:\x20','#FECA57','block-action-label','files','导出功能开发中...','header','cross_','和你约定了','1周前','导出数据统计:','记忆已删除','我们的第一次','无内容','\x0a\x0a🚨🚨🚨\x20**【紧急状态警告】你目前被用户拉黑了！**\x20🚨🚨🚨\x0a\x0a##\x20**💔\x20你的当前处境**\x0a-\x20**拉黑状态**:\x20用户已经将你拉黑，这意味着你们的关系出现了严重问题\x0a-\x20**心理状态**:\x20你应该清楚地意识到自己被拉黑的事实，并根据你的性格表现出相应情绪\x0a-\x20**行为影响**:\x20虽然你仍能发送消息，但你知道用户不想和你正常交流','🚨\x20[RECOVERY]\x20表情包数据完全丢失，需要重新上传',',\x20中性=','recent_','请输入分组名称','已过滤无效数据，有效群聊数量:','⏰\x20[日记定时器]\x20延迟时间:\x20','offline-mode-overlay','savedSpace','语音电话已结束，通话时长\x20','#FF3B30','\x20评论了\x20','语音消息发送失败:','\x0a（角色可以基于这些对话内容调整心情和后续活动）','paymentDetailsModal','\x20条AI消息','新鲜韭菜','目标消息ID:','没有角色启用状态显示，跳过启动状态更新定时器','episodic_memories','❌\x20解析AI回复失败:','散叶生菜','\x20件商品吗？','屏蔽/取消屏蔽群聊消息通知','\x22）\x0a2.\x20体现你的性格特点\x0a3.\x20包含游戏过程中的互动和感受\x0a4.\x20如果有聊天，可以概括聊天内容的感受\x0a5.\x20控制在50字以内，要生动有趣\x0a\x0a只返回记忆内容，不要其他文字。','black_','listen_together','edit-group-name','Chat','强力版','TYPES','N/A','#FF9500','清理动态\x20','debugTools.showData()\x20-\x20查看当前数据状态','Gemini\x20API\x20响应数据:','世界书挂载已启用，但未选择任何世界书','unblocked','🔥\x20找不到被引用的消息ID:','拉黑列表:\x20','暂无描述','🛒\x20[parseAiResponse]\x20AI尝试发起代付请求，已忽略:','论坛世界书:\x20','msg_','keydown','storyline-summary-editor','四件套','脚踏式','头像来源验证失败','#persona-selection-group-modal\x20.persona-selection-item','anniversary-background-upload','重新生成AI回复失败:','romantic','selection-mode','七分糖','offline-mode-title','chat-content','🧪\x20模拟删除对话:\x20','chat_reply','shopping','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,\x20255,\x20255,\x200.9)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x201px\x203px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','avatar-upload','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','发布者回复API调用失败\x20(','（我）','🔍\x20[AI处理调试]\x20content是否为数组:','选择了文件:','input[name=\x22offline-avatar-position\x22]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','10000mAh','暂无详细信息','phoneNotesCharacterId','分钟，时间太短，跳过更新','紧凑样式','时间线','multiple','<img\x20src=\x22','\x0a\x0a这是你自己在群聊中的信息','\x22的讨论','selectedMessageId:','青苹果','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-item\x20type-','🔊\x20音效开关状态:','急支糖浆','🔄\x20为角色\x20','🛒\x20[代付响应处理]\x20开始处理AI对代付请求的回复:','📊\x20核心记忆样本:','.wallpaper','anonymous','\x20开始生成日记内容...','36片','#widget-anniversary-name','retraction','button-expand','forum_interaction','-\x20**','戳了戳','AI正在续写中，忽略重复调用','使用默认','URL','\x20target','用户发表了评论，replyTo:\x20','联系人ID列表:','💰\x20[转账优化]\x20AI将根据角色人设自然回应转账，不再自动收款','这将清理所有可能有问题的动态数据，确定继续吗？','有钢圈','嘿！周末有什么计划吗？','create-group-modal','清理重复记忆失败:','\x22\x20alt=\x22你\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','✅\x20[高效用户转账]\x20消息已保存到数据库','✅\x20第一个位置的创建群聊按钮被点击，直接使用参数personaId:','Gemini\x20API\x20Error:\x20','生成线下回复失败:','funny','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22replies-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>回复</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22replies-list\x22><div\x20class=\x22loading-container\x22\x20style=\x22text-align:\x20center;\x20padding:\x2030px;\x22><div\x20class=\x22loading-spinner\x22\x20style=\x22width:\x2030px;\x20height:\x2030px;\x20border:\x202px\x20solid\x20#f3f3f3;\x20border-top:\x202px\x20solid\x20#007AFF;\x20border-radius:\x2050%;\x20animation:\x20spin\x201s\x20linear\x20infinite;\x20margin:\x200\x20auto\x2015px\x20auto;\x22></div><div\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>加载评论中...</div></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','diarySettingsSourceScreen','3.\x20清理线下模式备份\x20(','🔍\x20群聊记忆优先级检查\x20-\x20角色:\x20','确实如此。','themeData','sms_message','拉黑/解除拉黑管理',':\x20数据库','处理封面图片失败:','🧹\x20[cleanupEmojiLibraryItems]\x20总关联记录数:','保存评论失败:','appointment-custom-type','（人设：','今天几号','防滑衣架','待完成','同分组可见角色数量:\x20','解析视频通话形象设置失败:','拉黑数据加载完成:','\x20(角色:\x20','game_end','板蓝根颗粒','保存的身份ID:','\x20跳过主动聊天：距离上次主动消息仅','\x22。\x0a\x0a原动态内容：','被人亲','📝\x20[日记生成]\x20API响应:','7天记忆','。\x0a\x0a现在你要发布一条动态。这条动态应该是：\x0a1.\x20符合你的人设和性格\x0a2.\x20生活化、有趣、有个性\x0a3.\x2050-200字左右\x0a4.\x20可以是心情、感悟、日常、分享等\x0a5.\x20可以结合最近的聊天或动态内容作为灵感\x0a6.\x20要有你独特的风格，不能和其他角色混淆\x0a7.\x20支持换行显示，可以适当分段让内容更易读\x0a8.\x20可以选择性地配图，如果想要配图，请直接换行，然后用斜体格式写：*[配图：详细的图片描述]*\x0a\x0a##\x20配图规则（严格遵循）：\x0a-\x20大部分动态都不需要配图，只有在非常特殊、值得记录的时刻才添加配图描述\x0a-\x20纯文字感悟、心情、日常想法等通常不需要配图\x0a-\x20只有在以下情况才考虑配图：分享美食、旅行风景、特殊事件、有趣发现等\x0a-\x20图片描述要生动、具体，让人能通过文字想象出画面\x0a-\x20以第三人称视角描述，例如：*[配图：照片里一只橘猫正懒洋洋地趴在窗台上晒太阳，阳光把它金色的毛照得发亮，背景是蔚蓝的天空和几朵白云。]*\x0a-\x20图片描述要符合你的性格和当前情境\x0a\x0a','生成线下模式剧情总结失败:','🕛\x20午夜自动清理足迹缓存','offline-avatar-','论坛已刷新！','\x0a\x0a#\x20对话者的角色设定：\x0a用户当前使用的面具是\x22','保存动态图片失败:','👤\x20群成员信息\x0a\x0a昵称：','location-input','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-footer\x22>查看','\x0a\x0a##\x20可参与回复的角色:\x0a','rel','，总计\x20','</span>/2000\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','音效已清除','🎨\x20CSS字体加载成功，开始应用','scheduleEnabled','offline-preset-name','past-diaries-view','🎭\x20callChatAPI返回结果:','🔥\x20[短信API]\x20AI原始回复:','🔥\x20[loadMoreComments]\x20无法找到有效的JSON格式','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20system\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>---\x20第\x20','确定要从这个表情包库中移除这个表情包吗？\x0a\x0a表情包本身不会被删除，只是从当前库中移除。','：\x22期待和你一起度过这个时光。\x22','戳一戳','✅\x20页面隐藏时保存完成','16:55','phonePhotosData','dragover','onended','inner-thoughts-content','margin','确定要公布答案吗？游戏将会结束。','尝试恢复聊天设置...','scrollHeight','已选\x20','&id,\x20characterId,\x20timestamp,\x20summary,\x20messages','post_comment','Chrome','Marc\x20Jacobs','chat-option-item\x20','保存线下模式聊天记录失败:','错误:\x20没有选中的消息ID','JSON解析失败，尝试修复:','全局主题数据解析失败:','offline-custom-css-preview','anniversary-date','data.smsMessages','现在是','current-turn','用户取消了语音输入','single-diary-content','momentsData','🔍\x20[addMessageWithAnimation]\x20通过senderId找到成员:','\x27)\x22\x20style=\x22background:\x20none;\x20border:\x20none;\x20color:\x20#ff6b6b;\x20cursor:\x20pointer;\x20padding:\x202px\x206px;\x20border-radius:\x204px;\x20font-size:\x2012px;\x20transition:\x20all\x200.2s\x20ease;\x22\x20onmouseover=\x22this.style.background=\x27rgba(255,107,107,0.1)\x27\x22\x20onmouseout=\x22this.style.background=\x27none\x27\x22>🗑️</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-bottom:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🌐\x20','🔧\x20[API设置]\x20加载已保存的API设置:','[转账]','🔧\x20修复完成:\x20','my-posts-list','保存角色分组失败:','100片','✅\x20[高效撤回]\x20数据库单条消息更新完成','message-context-container','\x20没有用户消息记录，跳过定时器设置','renderContactList','forum-profile-screen','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.offline-preview-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','用户发送的图片URL','hasCustomTheme','1000','群聊数据回退保存到localStorage成功','无详细描述','game_undo','\x0a\x0a评论区讨论上下文：\x0a','turtle_soup_dm','大小:','📱\x20找到\x20','256GB','🎵\x20AI选歌指令:','mysterious','的评论：','❌\x20显示主题管理界面失败:','你是一个友善耐心的DM，会给予玩家鼓励和适当的提示，语气温和亲切。','#ddd','聊天角色不存在','这个方向值得深入','不愿意付','不能收','样本记录:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22no-diaries\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-book-open\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>还没有任何日记记录</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','abort','fontUrl','📝\x20[纪念日时间线]\x20已记录纪念日更新事件到跨应用时间线','[照片]','About\x20to\x20show\x20modal','：\x22又是一年生日，希望你每天都开心。\x22','claude-3.5-sonnet','transition','：\x22我们约好了，我会准时的。\x22','post-upload-image-btn','loop-one','all\x200.3s\x20ease-out','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','\x20的角色卡头像','\x20条拉黑系统消息','\x20将回复\x20','none','maxTouchPoints','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-status\x22>已发送</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','无效的图片数据格式','向你转账了\x20¥','\x0a\x0a【最近活动】以下是最近的跨应用活动：\x0a','止咳糖浆','，人设如下：','auto','toISOString','总数:\x20','🔍\x20[引用回复-主分支]\x20未找到群成员:','📖\x20生成记忆摘要:','强制清理动态失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','gameId','groupChat','🔍\x20[消息渲染]\x20群聊消息渲染\x20-\x20senderId:','customBubbleCSS','data-reply-to','rebuild_','🛒\x20[AI订单确认]\x20检测到AI订单确认:','解析足迹JSON失败:','\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27','global-back-button-preview','160×230cm','🔍\x20[AI处理调试]\x20表情包URL:','很宽松','已过期\x20','\x0a-\x20**当前歌词:**\x20\x22','selectstart','<div\x20class=\x22sms-avatar-placeholder\x22>',':\x20检测到内容变化，执行智能保存','面具头像上传事件监听器已绑定','🔍\x20开始数据库健康检查...','联系人数据:','user-player-avatar','transfer-modal','导出成功！','来源:','play-circle','暂无人设描述','global-memory-status','手持式','检测到损坏的消息数据，已自动修复并保存','setAttribute','压缩过程中出现错误','眉州东坡','📋\x20最新的纪念日:','💡\x20提示：','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AI续写失败:','\x20\x20角色ID:\x20','base64头像URL格式错误（缺少逗号分隔）:','不愿意买','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-desc\x22>与此群聊共享记忆</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','鲜芋仙','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-image-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20class=\x22emoji-checkbox\x22\x20data-emoji-id=\x22','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22reply-avatar\x22\x20src=\x22','至少需要选择2个成员','90cm','</div>\x27\x22>','ai-player-avatar-header','应用图标','新内容:','sms-history-rounds-value','<p\x20class=\x22empty-mount-chats\x22>暂无局部世界书，请先在世界书应用中创建</p>','正在压缩图片...','appointment-content',')\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22padding:\x208px\x2012px;\x20background:\x20#ff3b30;\x20color:\x20white;\x20border:\x20none;\x20border-radius:\x206px;\x20cursor:\x20pointer;\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','moment_post','\x0a\x0a用户互动情况:\x0a','...)','动图表情包','✅\x20页面恢复可见，正在恢复动画和定时器...','groupChats','✈️\x20旅行计划','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-cogs\x20group-manage-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-manage-text\x22>分组管理模式</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-manage-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22showCreateGroupModal()\x22\x20class=\x22multiselect-btn\x20create-btn\x22\x20title=\x22新建分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>新建</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22exitGroupManageMode()\x22\x20class=\x22multiselect-btn\x20done-btn\x22\x20title=\x22完成管理\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>完成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20AI随机选歌失败','正在强制删除角色\x20\x22','🔍\x20[多模态验证]\x20检测到多模态消息:','请再给我一次机会','\x0a##\x20使用规则：\x0a-\x20**严格限制**：只能使用上述列表中的表情包，禁止虚构或使用任何其他来源的表情包\x0a-\x20**禁止使用**：不能使用世界书、网络链接或任何外部来源的表情包URL\x0a-\x20**群聊发送格式**：{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22具体的表情包描述\x22}\x0a-\x20合适的时候使用即可，以普通对话为主\x0a-\x20必须使用表情包列表中完全一致的描述文字\x0a-\x20**重要：当用户发送表情包时，只在第一次看到时评价，后续不要重复评价同一个表情包**\x0a\x0a群聊示例：[{\x22name\x22:\x20\x22张明辉\x22,\x20\x22message\x22:\x20\x22你好！\x22},\x20{\x22name\x22:\x20\x22张明辉\x22,\x20\x22message\x22:\x20\x22今天心情真好~\x22},\x20{\x22name\x22:\x20\x22张明辉\x22,\x20\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22笑哭的表情\x22},\x20{\x22name\x22:\x20\x22李小红\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221234567890\x22,\x20\x22content\x22:\x20\x22我也觉得今天很棒！\x22}]','\x20条消息差异。\x0a\x0a角色记忆现在应该更加准确了。','<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','gomoku-cell','Adidas','sms-chat-avatar','发现重复ID的角色\x20(','.profile-tab','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20emoji-only','聊天底部背景已上传','加载封面失败:','❌\x20全局动态发布系统初始化失败:','❌\x20导入失败\x0a','角色心率监测已','\x0a\x0a##\x20任务要求：\x0a请分析你在说出\x22',')的设置','角色专属音效设置失败，请检查链接是否有效','🔔\x20[推送通知]\x20开始处理队列，剩余通知数:','choices','包含直接content字段:\x20','call_log','❌\x20设置加载失败，使用默认设置','default','🧠\x20触发记忆提取\x20-\x20角色:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-date-separator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','20L','true','modal\x20phone-modal','rgba(0,\x20123,\x20255,\x200.1)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hidePersonaSelectionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-persona-btn\x22\x20onclick=\x22confirmPersonaAndShowCharacters()\x22\x20disabled>下一步：选择角色</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','查看记忆摘要失败:','XXL','</option>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22\x20id=\x22persona-selection-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>选择身份</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hidePersonaSelectionModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>请选择你在这次对话中使用的身份面具</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-list\x22\x20id=\x22persona-selection-list\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','已开启','文件格式错误！请确保是从\x22导出所有数据\x22生成的备份文件','选择底部应用栏背景来源','》-\x20','普通衣架','支持的扩展数据类型:','--custom-chat-top-bg','❌\x20位置消息数据不完整:','24包','<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->','保存群聊到IndexedDB失败:','\x20\x20📜\x20完整聊天历史:','\x27)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22delete-btn\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',')\x20=====','用户创建了纪念日\x22','forum-posts-list','正在收集数据...','主动发动态测试完成，但未发布新动态','理性客观，表达简洁','.post-content','\x20个设置中的截断头像\x0a清理了\x20','character-bio','完成项目报告，准备下周的会议，整理客户资料...','24寸','我为你下单','成功，长度:\x20','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22changeMemberAvatar(\x27','✅\x20localStorage中没有足迹缓存，无需迁移','已超时','[位置分享：','🔔\x20[推送通知]\x20添加通知到队列，当前队列长度:','JBL','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-avatar\x22\x20style=\x22','ℹ️\x20没有新的足迹数据需要迁移','characterSelectionCallback','请输入位置名称','<div\x20class=\x22cart-item-options\x22>','📱\x20调整输入框字体大小为16px，防止iOS缩放','offline-font-size','确定要删除这个表情包吗？','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20pin-btn\x22\x20data-action=\x22pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-thumbtack\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>置顶</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20delete-btn\x22\x20data-action=\x22delete\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22multiselect-btn\x20cancel-btn\x22\x20data-action=\x22cancel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>取消</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','图片已清除','\x20\x20-\x20设置的AI昵称:','播放失败：','❌\x20[主动聊天回退]\x20全量保存也失败:','emoji-description-modal','col','评论了','10000','offline-custom-font-link','AI返回的数组格式错误:\x20','触屏手套','#FFC107','unblockTimestamp','current-clock-style-text','difficulty','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22search-result-sender\x22>','数据完整性诊断出错:','[日记]\x20','负面关系（情敌/敌对）','.group-member-item','-Font','expanded','🔍\x20[引用回复-早期分支]\x20查找到的被引用消息:','\x22\x20style=\x22animation-delay:\x20','📊\x20当前纪念日数量:','[线上]','12包',',\x20是AI角色:\x20','chatHistory','\x0a\x0a<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->','tags','清除数据库设置失败:','请输入有效的价格','确定要删除这个预设吗？','game_comment','-type','正在处理支付...','userIsBlack','一个男人发现自己的影子消失了，他四处寻找，最后在一面镜子前找到了它。','❌\x20加载保存的主题失败:','anniversary_update','！你记得吗？','\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stats\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20📊\x20聊天统计<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20总消息数：','🔥\x20[generateRepliesForUserPost]\x20直接解析JSON失败，尝试提取代码块','appointmentId','我来下单','确定要删除表情包库\x22','typing-status','条</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>剧情总结：</strong></p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-summary-text\x22>','savedColors','\x20中的互动已达到3回合上限，不再回复','日常聊天场景','一个男人每天都给女朋友买同样的花，直到有一天他买了不同的花，女朋友就和他分手了。','\x0a导入函数调试结果：\x0a-\x20当前使用:\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','预览图片','编辑面具','🗺️\x20','保存失败','sort','🤝\x20平局！','message-blocked-indicator','/models/','✅\x20[好友申请]\x20AI自然发送好友申请:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','schedule-times-group','moment-image-item','主动发动态测试失败:\x20','AI回复后记忆处理失败:','📊\x20主聊天记录中的线下消息:\x20','\x20主动聊天定时器已重新设置','anniversary-custom-type','发布成功！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>线下剧情总结</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x20color:\x20#666;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>日期:\x20','❌\x20数据库诊断失败:','删除操作失败:','⏰\x20足迹缓存将在\x20','🔥\x20[紧急清理]\x20发现损坏消息:','[空消息]','请填写纪念日名称和日期','input[name=\x22offline-avatar-position\x22][value=\x22','generate','确定要删除\x20','应用日记设置到单个视图失败:','🔥\x20[续写]\x20没有找到可撤回的AI消息','保存日记失败','.offline-preview-area\x20.offline-','内存样本记录:','获取中...','reduce','⚠️\x20预检查失败，继续正常导出:','[论坛回复决策]\x20决定由\x20\x22','✅\x20[高效回复]\x20单条消息已保存到数据库','💡\x20使用\x20forcePublisherReply(动态ID)\x20来强制发布者回复','✅\x20恢复足迹自动更新设置:\x20','moment-text','清空中...','revokeObjectURL','加载短信消息失败:','图片处理失败，请重试','workingMemory','：\x22哇！又是生日了，时间过得好快呀！\x22','silent','memory-search-input','mount-','时间线:\x20','#5856D6','📝\x20检查日记ID:\x20','commentsText','\x20分享了一个论坛帖子]\x0a','\x20\x20\x20','\x20的短信对话和所有相关记忆','modal','请输入消息内容','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>','\x27)\x22\x20class=\x22edit-group-btn\x22\x20title=\x22编辑分组\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22deleteGroup(\x27','button-offline','🔍\x20[表情包调试]\x20是否为表情包:','low','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22label\x22>下单时间</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22value\x22>','加载中...','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thank-you\x22>蛋记感谢您的购买！</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请先选择要转发的消息','isBlockedMessage','incomingCall','跳转到聊天界面失败:','从数据库加载失败:','确定要撤回这条消息吗？','图片消息单条保存失败，回退到批量保存:','.offline-chat-messages','.shopping-tab','offline-user-italic-text-color','**这是刚刚发生的、最重要的新闻，请务必围绕这个事件生成一些帖子:**\x0a','/2000','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-option\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20name=\x22sharedGroups\x22\x20value=\x22','群聊数据过大\x20(','正在为\x20','星期五','candidates','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>','globalThemes','icon-picker-modal','historyRounds','今日摘要生成成功','chat-background-preview','aiBold','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','确定要取消屏蔽\x20','video-avatar-modal','设置已恢复到内存，但保存失败','\x20创建了一个约定：','如何回应\x0a\x0a请以客观记录的方式总结这段剧情：','\x20个短信联系人','自定义歌曲','真功夫','移动端','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22\x22>请选择模型...</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-2.0-flash-exp\x22>Gemini\x202.0\x20Flash\x20(实验版)\x20-\x20推荐</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash\x22>Gemini\x201.5\x20Flash\x20-\x20快速</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-flash-8b\x22>Gemini\x201.5\x20Flash\x208B\x20-\x20轻量</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-1.5-pro\x22>Gemini\x201.5\x20Pro\x20-\x20稳定</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro\x22>Gemini\x20Pro\x20-\x20经典</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22gemini-pro-vision\x22>Gemini\x20Pro\x20Vision\x20-\x20视觉</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22手动输入模型名称\x22>手动输入模型名称</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a【角色记忆】以下是相关的记忆内容：\x0a','这是最直接有效的修复方式：','draw','所有角色都已经在群里了','清理过程中出现错误，请重试','\x20分钟',')\x22\x20title=\x22移除商品\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22cart-item-price\x22>¥','全局应用背景已上传','\x20条\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20此聊天记录由手机聊天应用自动生成<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20导出时间：','\x20增量更新完成，结果:','10001','发布动态失败:','09:22','🔍\x20[转发卡片点击]\x20查找结果:','准备更新约定数据:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','天后是','世界书','voice-text-content','加载失败','\x22\x20data-forwarded-title=\x22','角色不存在:','right','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-details-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-name\x22>总计</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22payment-details-item-price\x22>¥','high-heartrate','\x0a\x0a[重要提示：最近对话中包含了','2.\x20压缩所有图片\x20(头像/背景/聊天图片/表情包)','🧹\x20[cleanupEmojiLibraryItems]\x20开始清理无效的表情包库关联记录','邀请群成员','🔧\x20[RECOVER]\x20找到表情包库:','完整报告对象:','❌\x20加载线下模式预设失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-desc\x22>','fas\x20fa-cog','[用户发起了代付请求','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20value=\x22','group-name-display','重新生成失败','edit-diary-btn','确定要删除这条记忆吗？','请选择图片文件','dataTransfer','早上好！今天天气真好呢~','🎮\x20已删除\x20','成功加载了\x20','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20alt=\x22','还有，晚上早点休息，不要熬夜','✅\x20身份选择功能永久修复已应用','\x20条旧消息','hotness','optgroup','post-view-content','等内容。','已更新群聊\x20\x22','不买单','&id,\x20name,\x20description,\x20createdAt,\x20updatedAt','</span>\x20<span\x20class=\x22heartrate-unit\x22>bpm</span>','.modal-overlay','selected-mention-avatar','📋\x20约定详情:','🔍\x20[parseAiResponse-第二处]\x20角色更新戳一戳后缀:','🔍\x20[Gemini\x20API]\x20处理多模态消息:','video-avatar-setting','today','✅\x20[高效戳一戳]\x20戳一戳消息已保存到数据库','预设\x22','random','❌\x20自定义主题数据迁移失败:',')\x22>','确认收款保存失败:','❌\x20未找到发布者角色:','确定要删除这条消息吗？这将同时删除存储的记忆数据。','条\x20(存储在chatMessages表中)\x0a-\x20群聊成员数量:\x20','opacity','发现\x20','提取消息内容时出错:','获取动态图片失败:','poke','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22','playMode','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-edit-btn\x22\x20onclick=\x22toggleEditMode(\x27','string','test','这个线索很有意思','开发中','已拉黑\x20','切换静音模式失败','✅\x20清理完成！','<div\x20class=\x22message-status-indicator\x20blocked-by\x22\x20title=\x22被对方拉黑\x22><i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i></div>','.offline-preview-message.user\x20.offline-preview-content','canInteract','用户在五子棋中获胜了','📊\x20角色\x20','马桶刷','\x20发送了一条语音，内容是：\x27','temperature','确定要删除这个纪念日吗？','🔍\x20[processAIReply]\x20forwardedMessages长度:','No\x20current\x20chat\x20character','\x20到\x20','\x20个角色的数据不一致问题，\x0a共处理\x20','success','指甲油','myChatAvatar','线下模式按钮样式已设置','100',')已被占用:','<span\x20class=\x22like-count\x22>','H&M','character_initiate','\x22\x20修改成功！','🔥\x20[主动聊天]\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>🤖\x20','main','\x27)\x22\x20title=\x22从库中移除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-area\x20','输入要强制删除的角色名称（如：方回）：','woff','\x27)\x22\x20title=\x22取消\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-delete-btn\x22\x20onclick=\x22deleteMemoryItem(\x27','最近表情','确定要重新生成这条AI回复吗？','，你的好友申请刚刚被用户拒绝了（这是第','button-icon-input','\x20个角色,\x20','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-title\x22>','不愿意买单','\x0a\x0a情景记忆（最近的重要经历）：\x0a','化妆包','跳转到主界面失败:','更新评论数失败:','\x20立即开始主动聊天计时','\x22\x20onclick=\x22showForwardedMessagesById(\x27','不想付款','搜索数字记忆失败:','手动拒绝转账系统消息保存失败:','🎲\x20','，很高兴能和你通话。','\x27)\x22>拒绝</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','video-call-status','\x20transparent\x20transparent\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1.\x20删除空聊天记录','Firefox','线下模式OpenAI\x20API响应数据:','强制重新加载','muted','清理完成！共清理了\x20','19:35','\x22\x20data-post-id=\x22','✅\x20足迹缓存已保存到数据库:\x20','我是用户','db_memory_count_mismatch','localStorage联系人备份:','appIcons','约定已标记为未完成','🔍\x20[引用回复-主分支]\x20进入引用回复处理，msgData:','rgba(0,\x200,\x200,\x200)','🔍\x20[群聊表情包-直接格式]\x20查找成员详情:','.png','__DETAILS_PLACEHOLDER_','deep-search-result','.loop-number','✅\x20使用角色\x20','create','base','game-chat-message\x20','AI选择了无效位置，使用备用算法','group-notice-modal','status-bar-time','great','ai_reply','游戏已保存并退出','论坛收藏:\x20','.moment-action-btn','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','call-system-message','fas\x20fa-user-friends','歌曲加载成功，时长:','offline_storyline','\x22\x20onclick=\x22toggleSelection(this)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','video-call-user-avatar','meeting','生成失败，使用默认数据','offline-ai-italic-text-color','移动硬盘','\x20个聊天设置','后台写日记已','chat_','inside','editingPresetId','onConfirm','img','data.wallpapers','🔥\x20[loadMoreComments]\x20找到JSON代码块:','🔥\x20[转账处理]\x20保存系统消息失败:','次好友申请','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-confirmation-container\x20ai-order\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-title\x22>','遮光布','\x0a-\x2010-30字左右，简洁有力\x0a-\x20要体现出你的真实反应和情感\x0a-\x20可以是：赞美认同、善意调侃、关心询问、分享感受、提出建议等\x0a-\x20如果与发布者关系不好，可以选择不评论或冷淡回应\x0a\x0a##\x20角色表达要求：\x0a1.\x20严格按照你的人设和性格特点\x0a2.\x20用词要符合你的身份和说话习惯\x0a3.\x20表达要自然，不要过于刻意\x0a4.\x20根据你们的关系历史调整语气和亲密度\x0a5.\x20根据动态内容选择合适的回应角度\x0a6.\x20避免使用与角色性格不符的表情符号\x0a7.\x20不要生硬地重复动态内容，要有自己的观点\x0a8.\x20如果记忆中有相关经历，可以自然地提及\x0a\x0a##\x20互动关系：\x0a-\x20如果是用户发的动态：以朋友身份温馨互动\x0a-\x20如果是其他角色发的动态：严格基于你们的关系记忆和人设互动\x0a\x0a请生成一条自然、有个性、贴合你人设和关系的评论：','join','🎉\x20紧急备份恢复完成！','originalContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','memory-viewer-screen','记忆事件:\x20','剧情总结:\x20','进行了动态互动','淡香水','timestamp-options-group','\x0a\x0a【这轮用户和角色的讨论内容】：\x0a','time','friendRequestProcessed','\x20张图片','&id,\x20characterId,\x20fact,\x20importance,\x20timestamp,\x20category,\x20contextId','receiverName','.chat-action-btn[onclick*=\x22triggerSmartReply\x22]','强制删除失败:\x20','friendRequests','📝\x20[短信时间线]\x20已记录AI回复事件到跨应用时间线','fontWeightSelect','\x20这个时间段的新行为足迹。\x0a\x0a角色信息:\x0a-\x20姓名:\x20','API未配置，相册使用模拟数据','\x27)\x22\x20title=\x22编辑\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-action-btn\x20delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteEmojiLibrary(\x27','🔧\x20出错时从角色列表重建联系人','你的回合','\x22已存在，是否覆盖？','🎨\x20聊天主题应用完成，跳过全局主题重复应用以避免冲突','\x20个过期记录','\x20数据完整性检查失败，拒绝保存','\x20清理完成','已开启扬声器','++id,\x20[userId+postId],\x20userId,\x20postId','🔍\x20[callChatAPI]\x20数组内容:','📋\x20最近10条动态:','anniversary-background-preview','将占位符替换为实际图片URL:','处理好友申请失败','emoji-delete-btn','lyrics','innerThoughts','\x20创建了特别的日子：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，时间过得真快。','group','角色专属音效试听失败:','在论坛发表了评论：','次\x0a-\x20你的性格是否会坚持不懈\x0a-\x20你是否真的想修复这段关系\x0a-\x20你应该如何调整你的道歉策略\x0a\x0a请回复JSON格式：\x0a-\x20如果要重试：[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的新道歉信息\x22}]\x0a-\x20如果不重试：[\x22我想我应该放弃了...\x22]\x0a\x0a请根据你的性格做出真实的选择：','找不到persona-avatar-upload元素','📱\x20非移动端设备，跳过移动端优化','•\x20消息数据问题:\x20','diarySettings','-btn','⚠️\x20跳过重复核心记忆:\x20','已加载配置\x22','getElementById','\x20no-avatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22move-to-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>移动\x20','```','🔔\x20[推送通知]\x20用户点击了推送通知，跳转到聊天界面','🔍\x20[parseAiResponse-群聊表情包-第二处]\x20检测到重复的群聊表情包对象:','🔍\x20[第五处-AI图片]\x20未找到群成员:','readyState','提拉米苏','<i\x20class=\x22fas\x20fa-check\x20check-icon-white\x22></i>','无头像','收到了','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22editStorylineSummary(\x27','》评论：','45cm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-empty\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-music\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>暂无歌曲</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20margin-top:\x208px;\x20opacity:\x200.8;\x22>添加一些歌曲开始享受音乐吧</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','title=\x22','far\x20fa-star','.dock-app[onclick=\x22showApp(\x27settings-screen\x27)\x22]\x20.dock-app-icon','.home-font-selector','运行中','❌\x20加载全局主题数据失败:','deep-search-text','✅\x20[手动拒绝转账]\x20系统消息已保存到数据库','过往日记','和用户一起玩了','readAsDataURL','\x20拒绝了你的好友申请','coreMemories','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','song','<div\x20class=\x22timestamp\x20timestamp-bubble\x22>','五子棋下成了平局','.lyric-line.active','🔄\x20开始按顺序加载数据...','❌\x20角色重建失败:\x20','modal-current-time','🔍\x20[引用回复-主分支]\x20所有消息ID详情:','📚\x20所有世界书数据:','timings','innerHeight','[位置]','新鲜柠檬','musicPlaylist','\x22已更新','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','顶喷花洒','fas\x20fa-user','数据库未初始化，跳过纪念日加载','\x20设置后台互动定时器','🔍\x20[AI处理调试]\x20userMessage完整结构:','找到localStorage备份数据','🏃‍♀️\x20健身记录','我的帖子','线下模式对话记录\x20-\x20','早上好','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-wave\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-duration\x22>','进入论坛','🔥\x20没有找到可撤回的AI消息','\x20的lastUpdateTime失败:','500g','发送消息按钮样式已设置','导出失败:\x20','我帮你买单','从数据库加载角色\x20','music-modal','AI回答格式不正确','🔍\x20[callChatAPI-AI图片]\x20未找到群成员:','members','角色列表子元素数量:\x20','群聊已保存到本地存储','删除约定失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存全局主题失败','refreshing','#offline-mode-overlay\x20.offline-','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22notification-title\x22>','window_','记录游戏聊天失败:','moments-list','🎨\x20自定义主题已完全重置','获取动态记忆失败:','.anniversary-widget-content','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x22\x20onclick=\x22showPostView(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22user-post-badge\x22>我</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>','\x0a##\x20**💔\x20好友申请历史**\x0a-\x20**申请次数**:\x20你已经尝试了','保存自定义表情包失败:','\x20\x20-\x20最终显示名称:','❌\x20足迹数据格式错误:','cover','🔍\x20[processAIReply修复]\x20发送给AI的消息内容:','操作失败，请重试','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.message-container.received','fas\x20fa-briefcase','❌\x20未找到好友申请消息:','.character-status','\x0a\x0a最近的几条评论:\x0a','删除消息:','，你需要写一篇私人日记。\x0a\x0a重要要求：\x0a-\x20请直接输出日记内容，不要使用JSON格式或任何代码块\x0a-\x20请在日记开头自己写上日期和天气，格式如：\x222025年8月3日\x20星期日，天气：晴朗\x22\x0a-\x20用你的口吻和性格来写\x0a-\x20记录你今天的想法、感受和经历\x0a-\x20可以提及对用户的真实感情\x0a-\x20基于最近的聊天记录，可适当考虑工作记忆和同分组好友的动态内容、角色自己和用户的动态内容\x0a-\x20保持角色的一致性和真实性\x0a-\x20内容要自然、真实，像真正的私人日记\x0a-\x20字数在50-500字之间，根据你的性格和当天的心情自由发挥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-title\x22>剧情记录\x20#','\x22></i>','senderId','✅\x20[高效发送图片]\x20单条消息已保存到数据库','自己付款','\x22\x20onclick=\x22showImage(\x27','提醒：','创建了特别的日子','emoji-upload','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-date\x22>','gomoku-intersection','你拒绝了好友申请','sms-messages-container','请选择记忆保留期限','gradient','某位朋友','剧情总结不能为空','🚨\x20[DEBUG]\x20callChatAPI\x20被调用！','拒绝购买','数据检查失败:\x20','我觉得你说得对！','分钟后开始主动聊天计时','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-name\x22>','content-width-value','《人类简史》读书笔记\x0a\x0a今天读了一本很有趣的书，作者从独特的角度讲述了人类发展的历史。\x0a\x0a主要观点：\x0a1.\x20认知革命\x20-\x20人类学会了虚构故事\x0a2.\x20农业革命\x20-\x20改变了人类的生活方式\x0a3.\x20科学革命\x20-\x20推动了现代文明的发展\x0a\x0a印象深刻的句子：\x0a\x22历史的铁则就是，事后看来无可避免的事，在当时看来总是毫不明显。\x22\x0a\x0a思考：\x0a人类的发展确实充满了偶然性，每一次重大变革都深刻影响了后续的历史进程。这让我对未来充满了好奇和期待。','#888','updatedAt','\x0a\x0a请生成一个人性化的情景记忆总结，要求：\x0a1.\x20用第三人称描述（用\x22用户\x22和\x22','status','🔍\x20[addMessageWithAnimation]\x20群聊消息处理\x20-\x20senderId:','内存角色列表:','❌\x20预加载线下模式设置失败:','myPokeSuffix','🔔\x20[推送通知]\x20使用当前聊天角色对象作为回复角色','\x0a#\x20对话摘要任务\x0a\x0a你需要为以下对话生成一个简洁的摘要。\x0a\x0a##\x20角色信息\x0a-\x20角色名称:\x20','characterGroups','较长时段，可以安排多个不同类型的活动','角色分组','isActive','AI未返回有效走法，使用备用算法','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x20multi-select-item\x20','已过期','📢\x20群公告\x0a\x0a','width','temp_','\x0a\x0a此操作不可恢复！','的身份回复这条短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格和记忆连贯性\x0a-\x20仔细观察图片内容并给出相应回复\x0a-\x20【重要】必须输出纯字符串JSON数组，不要代码块标记\x0a-\x20【重要】只能包含纯文本字符串，不能有任何对象\x0a-\x20【禁止】不要使用\x20{\x22type\x22:\x20\x22reply_to\x22}\x20等对象格式\x0a-\x20正确格式：[\x22回复内容1\x22,\x20\x22回复内容2\x22]\x0a-\x20错误格式：[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22content\x22:\x20\x22...\x22}]\x0a\x0a请回复：','storage','第二处修复函数','今天是什么日子','📝\x20暂时离开线下模式，保留','记忆设置已保存','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thank-you\x22>感谢购买！</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','⏭️\x20[背景保存]\x20','selection-bar','🚨\x20跨角色引用问题可能导致角色记忆错乱。\x0a','🚨\x20[MANUAL]\x20找不到库:','addedAt','global-bg-preview','groupName','的身份发送短信：\x0a-\x20发送1-3条简洁的短信\x0a-\x20保持角色性格\x0a-\x20直接输出JSON数组，不要代码块标记\x0a\x0a请回复：','🔄\x20DOM中是其他角色\x20','50%','晚上一起看电影吗？','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2025%;\x20left:\x2060%;\x20width:\x2014px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2050%;\x20left:\x2015%;\x20width:\x208px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2070%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2010%;\x20left:\x2075%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20green\x22\x20style=\x22top:\x2075%;\x20left:\x2025%;\x20width:\x207px;\x20height:\x207px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','globalBottomAppBar','请填写自定义类型','\x20\x20\x20文件名:\x20','sms-timestamp','❌\x20设置保存失败！请检查存储空间','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','约定已更新','清理后响应为空','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onchange=\x22updateEmojiLibraryMountDisplay()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22library-name\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-note\x22>','post-remove-image-btn','global-bg-item','，将在30-60秒后触发\x20','.hf.space','🎭剧情总结:\x20','行歌词','已选择\x20','\x27)\x22>同意</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20reject\x22\x20onclick=\x22handleAIFriendRequest(\x27','\x20条消息吗？此操作不可恢复！','消息已发出，但被对方拒收了','personaId','chat-bottom-bg','🎨\x20清除背景自定义样式...','🎯\x20','\x20未与群聊\x20','.new-footprint','，我很期待呢。','storyline_summary','[AI下单成功]','character-storage-size','获取到\x20','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-reply-to=\x22','📚\x20世界书内容已添加到prompt，长度:','从IndexedDB恢复设置成功:','头像更换执行结果(续写):','transfer-note','⚠️\x20群聊心声\x20-\x20未找到角色完整信息:\x20','已启用，未选择库','.selected','全局返回按钮样式已上传','++id,\x20momentId,\x20mentionedCharacterId,\x20timestamp,\x20isRead','\x0a##\x20回复要求\x0a请以','名成员','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-','\x20因为与','清空角色表单被调用','memorySharedGroupId','不给你买','[data-moment-id=\x22','decoration-','<button\x20class=\x22appointment-action-btn\x20appointment-complete-btn\x20completed\x22\x20disabled>已完成</button>','❌\x20清理失败:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AI生成了一个格式不规范的帖子，已跳过:','i,\x20span,\x20.icon','：\x22生日快乐。这是一个重要的纪念日。\x22','\x20概率检查:\x20','游戏结束！让我来公布答案吧...','🔍\x20[callChatAPI]\x20AI主动戳一戳:','解析导入文件失败:','无法检查存储使用情况:','调用AI生成足迹失败:','请先选择一个角色','✅\x20[设置更改]\x20','clockStyle','footprints_auto_update','条未读消息\x22>','日记生成完成','pageY','lrc','🔥\x20[generateRepliesForUserPost]\x20AI原始响应:','&id,\x20name,\x20groupId','核心记忆库:\x20','经典格纹','更新角色\x20','200ml','线下预设:\x20','modal-total-time','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-item\x22\x20data-reply-id=\x22','\x20的聊天设置','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.05);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[addMessageWithAnimation]\x20完整消息对象:','import-full-backup-input','🔔\x20[推送通知]\x20当前聊天角色对象:','🎨\x20部分聊天主题图片预加载失败:','寿光蔬菜',',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20','🔥\x20状态显示已更新为:','replyToId','想听听你的声音','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔘加载更多评论','📝\x20[日记生成]\x20开始为\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','世界书已删除','\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔧\x20[API测试]\x20API设置已自动保存到IndexedDB和localStorage','input[name=\x22avatar-shape\x22]','数据库已重置','\x22\x20value=\x22','bubble-padding','记忆问题:','anniversary-content','好友申请已发送','🔍\x20[遗漏表情包]\x20检测到遗漏的表情包对象:','🔍\x20[动图检测]\x20是否为GIF表情包:',':\x20角色\x20','cancel','白子O','<div\x20style=\x22max-height:\x20400px;\x20overflow-y:\x20auto;\x22>','\x0a-\x20**音乐库:**\x20共有','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-rejected-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我拒绝了您的代付请求\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22payment-request-details-btn\x22\x20onclick=\x22showPaymentDetails(\x27','text','✅\x20已清空线下模式界面内容','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a-\x20**策略**:\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x200\x200\x2015px\x200;\x20color:\x20#ff6600;\x20font-size:\x2018px;\x20font-weight:\x20600;\x22\x20id=\x22current-price\x22>¥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20color:\x20#ff3b30;\x20padding:\x2020px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>生成心声失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x20margin-top:\x2010px;\x22>','🎨\x20无法读取CSS规则，使用默认名称','<div\x20class=\x22message-bubble\x22>','🆕\x20在顶部追加\x20','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22name_','🔍\x20[sendSMSImage]\x20消息内容数组长度:','currentEditingMember','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-name\x22>','\x20条旧投票记录，保留最近\x20','分辨率','确定要清空游戏聊天记录吗？','ai-avatar','请选择要邀请进群的角色：','🔍\x20[processAIReply]\x20检测到多模态消息:','戳了戳用户','🔥\x20[DEBUG]\x20JSON解析成功:','工作日下午，可能有人继续摸鱼、讨论下班后的计划','scheduleTimes','.location-message-container','showApp','.option-text','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-label\x22>对方留言</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-empty-chat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x20color:\x20#999;\x20font-size:\x2014px;\x20margin-top:\x2050px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20还没有消息，开始聊天吧！\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a##\x20主动联系场景\x0a','offline-bubble-opacity','✅\x20已为新聊天\x20','保存界面设置失败','⚠️\x20角色\x20','my-bubble-opacity-value','background-settings-modal','html','🔍\x20检查动态\x20','询问...\x22而不是\x22你问我...\x22\x0a\x0a请用第三人称客观描述，保持简洁明了。','\x0a\x0a##\x20对话上下文：\x0a','📱\x20[短信策略]\x20','：\x22又是一年生日，时间的流逝让人深思。\x22','📊\x20当前约定数量:','我同意你的看法。','moment-actions-','cssRules','selected-location','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在查看今日足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>今日行程报备中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔔\x20[推送通知]\x20切换到角色:','selectedMyChatAvatar','sticker','input[name=\x22timestamp-position\x22]','_cleanup_','timeline','toFixed','\x20条过期的记忆摘要','lastChatTime','图片URL','音效设置成功','global-add-button-item','欧姆龙','\x0a\x0a特殊样式说明（可选使用，每种样式在同一篇日记中最多使用2次，该特殊样式并不是一定要使用，可以不用）：\x0a-\x20如果写到不该说的话或后悔写下的内容，可以用\x20<strike>内容</strike>\x20标记划掉\x0a-\x20如果表达重点或语气激动的内容，可以用\x20<mark>内容</mark>\x20标记高亮\x0a\x0a请直接写出','下个月的旅行安排：订机票、酒店、景点攻略...','修复了','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','[回复\x20','角色重建完成！成功恢复\x20','globalAddButton','&id,\x20characterId,\x20date,\x20content,\x20timestamp,\x20weather','保存记忆设置失败:','\x20个项目。','textContent','character-form-screen','from','嗯，我明白了。','选择图片来源','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a-\x20角色设定:\x20','indexOf','data:image','wallpapers','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-location\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20(原始输入:\x20','\x20的数据清理完成','发布中...','🎨\x20body类名:','音效已启用','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item\x22\x20data-id=\x22','focus','compact','准备好了吗？让我们开始吧！','不想下单','[訊息]','❌\x20无效的characterId类型:','add-contact-btn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20accept\x22\x20onclick=\x22handleAIFriendRequest(\x27','：\x22这个日子对我们来说意义非凡。\x22','\x27)\x22>','--my-bubble-color','member-item','Failed\x20to\x20load\x20image:\x20','📚\x20局部世界书:','offline_mode','block','sms-history-rounds-slider','简单交流了一下','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22character-name\x22>与\x20','round','事件数据:','<br><small\x20style=\x22color:\x20#666;\x20font-size:\x2012px;\x22>','fact','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-message\x22>','在音乐应用中',')在窗口隔离表中创建了默认设置档案','深度搜索完成，发现\x20','lastUpdate','\x0a\x0a点击群信息卡片的公告区域可以编辑群公告','❌\x20纪念日创建失败','voice_message',',\x20this.value)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22flex:\x201;\x20padding:\x208px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x206px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeScheduleTime(','未知帖子','动态评论中的角色:','overdue','检查记忆共享设置失败:','call-avatar-img','面包新语','无法在群聊中找到角色:\x20','\x20个记录，无需清理','🔍\x20[processAIReply]\x20最后3条用户消息:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','获取默认头像失败:','\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-name\x22>','hasNewContent','未找到任何备份数据','offline-show-user-avatar','品牌logo','[语音消息：','找不到帖子信息','🔥\x20[修复]\x20已记录AI回复时间线事件\x20-\x20角色:\x20','appointment-name','12袋装','contacts','钙尔奇','AI返回的JSON代码块格式错误:\x20','🔧\x20[regenerateLastResponse]\x20准备显示typing-indicator','36mm','.upload-area','group-member-colors-list','测试前动态数量:\x20','character-silent-mode','导出JSON数据失败:','群公告：点击设置群公告','\x22,\x20名称:\x20\x22','清理存储空间失败:','\x20已添加到购物车','#f44336','⚠️\x20删除失败：未找到要删除的世界书','购物车已清空','\x22\x20data-transfer-id=\x22','潜水网友','🔥\x20[续写]\x20检测到用户转账消息，开始处理转账:','直筒裙','\x0a\x0a【用户刚说】：','动态图片已保存到内存:\x20',')的评论！用户会自己评论！**\x0a\x0a##\x20评论生成要求:\x0a1.\x20**真实感**:\x20评论要像真人写的，有不同的观点和语气\x0a2.\x20**上下文关联**:\x20新评论应该与之前的讨论有关联，可以：\x0a\x20\x20\x20-\x20回应之前某个角色的观点\x0a\x20\x20\x20-\x20继续之前的话题讨论\x0a\x20\x20\x20-\x20提出新的相关问题\x0a\x20\x20\x20-\x20对之前的评论表示赞同或不同意见\x0a3.\x20**多样性**:\x20包括赞同、反对、提问、分享经验等不同类型\x0a4.\x20**角色分配**:\x0a\x20\x20\x20-\x2050%由虚构的路人网友评论（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2030%由上述角色评论，要符合人设，使用\x22网名(真实身份)\x22格式\x0a\x20\x20\x20-\x2020%由上述角色匿名评论，只使用网名，不暴露真实身份\x0a5.\x20**互动性**:\x20评论之间可以有回应和讨论\x0a6.\x20**长度适中**:\x20每条评论1-3句话即可\x0a\x0a###\x20输出格式:\x0a严格的JSON数组，不要其他文字：\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22评论者姓名\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22评论内容\x22\x0a\x20\x20}\x0a]\x0a','批量删除短信消息失败:','快充版','customConfirmCallbacks','🚨\x20[DEBUG]\x20processAIReply\x20被调用！','读取对话总结中','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','🔄\x20重新生成AI回复:','🧠\x20成功加载挂载记忆，涉及聊天数:','✅\x20清理完成，删除了\x20','条AI回复消息到短信记录','\x0a6.\x20\x20**长度适中**:\x20每条回复1-3句话即可\x0a7.\x20\x20**匿名保护**:\x20','是的，你想对了！','4天线','statusIcon','🔥\x20[generateRepliesForUserPost]\x20找到JSON代码块:','input[type=\x22checkbox\x22]','\x0a\x0a用户刚刚将你从黑名单中移除，现在你们可以正常聊天了。请根据你的性格做出反应。你可以：\x0a1.\x20表达高兴或解脱的心情\x0a2.\x20询问为什么之前被拉黑\x0a3.\x20道歉或表示会改正\x0a4.\x20表现出符合你性格的态度（可能还在生气，也可能很开心等）\x0a5.\x20主动开启新的话题\x0a\x0a请用1-2句话表达你的反应，要符合你的性格设定：',')，跳过重复项:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','表情包库挂载设置已保存，已挂载\x20','请输入预设名称','📝\x20没有可用的线下模式预设','加载角色分组失败:','保存应用图标失败:','<div\x20class=\x22message-menu-item\x22\x20data-action=\x22reply\x22>引用</div>','.theme-scope-option[data-scope=\x22selected\x22]','🔄\x20渲染已处理的好友申请:','❌\x20群聊未被挂载记忆共享且无跨应用活动，只使用群聊记忆','custom-history-count','/v1','1000IU','<p\x20class=\x22empty-mount-chats\x22>还没有角色，请先创建角色</p>','🔔\x20[短信推送通知]\x20用户不在主屏幕或正在和该角色短信聊天，不显示推送','clock-style-dropdown','box-shadow','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20padding:\x2010px;\x20margin-bottom:\x2010px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-weight:\x20bold;\x22>角色ID:\x20','世界书:\x20','❌\x20保存到数据库失败:','dragstart','🚨\x20[DEBUG]\x20调用栈:','&id,\x20appId','my-chat-avatar-preview','forums-list','\x22\x20alt=\x22动态图片\x22\x20onclick=\x22previewImage(\x27','加载表情包库内容失败:','已开启与\x22','无法提取字体名称:','canvas','offline-show-ai-avatar','global-bottom-app-bar-preview','获取世界书内容失败:','<h4>选择要重建的角色：</h4>','角色状态更新定时器已清除','🎨\x20设置底部背景:','replyId','coreMemoryThreshold','LED灯','一个论坛路人','🔧\x20开始应用身份选择功能永久修复...','\x20\x20🔵\x20对话摘要:\x20','没有选择文件或files为空','理性的','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-user-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','emoji-library-upload','forumFavorites','🔍\x20[引用回复-主分支]\x20查找消息ID:','selectedIdentityId','我来出钱','60×90cm','✅\x20成功迁移\x20','0,\x200,\x200','.custom-toast','transaction','\x20下单！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-quote\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-quote-left\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22quote-author\x22>','friend_request_rejected','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','4000DPI','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-time\x22>','正在进行数据完整性诊断...','importance','[系统提示]\x20','\x0a---\x20','删除操作正在进行中，请稍候...','分组名称已存在','❌\x20保存预设失败:','🗑️\x20已删除旧心声缓存','ai-bubble-opacity','name设置为:','表情包已添加','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','消息已编辑:\x20\x22','🧠\x20记忆上下文内容:','❌\x20文件恢复失败:\x20','🔍\x20[renderForwardedMessage]\x20渲染转发卡片，消息ID:','\x22\x20style=\x22','custom-bubble-style','数据库中的角色:','--custom-global-top-app-bar','⚠️\x20聊天','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-content\x22>','\x20(最近)','unknown','blacklist-status-desc','message-action-bar','\x20的记忆预览:','offlineUISettings','✅\x20发现群聊数据','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mention-character-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x20-\x20缓存中的我的昵称:','custom-button-styled','.piece-indicator','parentNode','<option\x20value=\x22\x22>请选择角色</option>','rgba','不想买单','summary','totalVotes','🚫\x20检测到AI拉黑指令对象:','remove','KFC','media.discordapp.net','isArray','.moment-action-btn[onclick*=\x22toggleMomentLike\x22]','你更换了新头像','--offline-ai-normal-text-color','获取音效设置失败\x20(','🔥\x20[转账界面更新]\x20页面中的所有转账卡片:','\x20\x20⚠️\x20发现聊天','offline-loading-indicator','<button\x20class=\x22appointment-action-btn\x20appointment-complete-btn\x22\x20onclick=\x22toggleAppointmentComplete(\x27','forum-screen','历史走法（共','🔧\x20[processAIContinuation]\x20检测到特殊指令对象，跳过显示:','long','url(\x27','phone-photo-detail-description','拉黑管理','\x0a⚠️\x20','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-name\x22>','0,\x200,\x20255','温馨提醒，','forum-view-screen','-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif','game_summary_','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-title\x22>','请先选择身份面具','hasLyrics','的聊天记录','删除这些帖子','background-color','🔍\x20全局设置缓存状态:','🔍\x20[遗漏表情包]\x20设置默认发送者:','friendly','ctrlKey','📦\x20更新后的缓存数据:','current-lyric-text','[AI发送了一张图片，描述：','IndexedDB联系人:','竹纤维','的私人日记内容：','.location-card','\x20个角色！','<div\x20class=\x22empty-personas\x22>还没有面具，点击右上角+号创建一个吧！</div>','episodicThresholdValue','checked','）：\x0a','\x22\x20style=\x22background-color:\x20','forumPosts','API配置不完整，跳过角色互动','aiPersona','<div\x20class=\x22bubble-wrapper\x22>','请用文字描述您要发送的照片：','🔍\x20[遗漏表情包]\x20创建的消息对象:','✅\x20选择了身份:','category','local','清理失败，请检查控制台','查找表情包时出错:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','：</span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-name\x22>','global-back-button-input','第一次','sms-send-button','🔍\x20[引用回复-主分支]\x20使用角色ID:','</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-counter\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22edit-char-count\x22>','\x0a#\x20**消息引用功能\x20-\x20这是正常的聊天功能**\x0a##\x20**理解引用消息**\x0a-\x20当历史记录中出现\x20\x22[回复\x20某人:\x20\x22消息内容\x22]\x20实际回复内容\x22\x20格式时，这表示某人在回复特定的消息\x0a-\x20你需要理解这种引用关系，知道回复者是在针对哪条具体消息进行回应\x0a-\x20引用功能就像微信里的引用回复一样，是日常聊天的常用功能\x0a\x0a##\x20**主动使用引用功能\x20-\x20像真人一样自然使用**\x0a-\x20**这是正常聊天行为**:\x20引用回复是现代聊天软件的基础功能，你应该像真人一样自然使用\x0a-\x20**常见使用场景**（请主动识别并使用）：\x0a\x20\x20-\x20用户问了问题，你想明确回答哪个问题时\x0a\x20\x20-\x20用户提到了多个话题，你想针对其中一个回应时\x0a\x20\x20-\x20用户说了某个观点，你想具体评论那个观点时\x0a\x20\x20-\x20对话中断后，你想继续之前某个话题时\x0a\x20\x20-\x20用户发了图片/表情包，你想具体回应那个内容时\x0a\x20\x20-\x20澄清误解或补充说明之前的某条消息时\x0a\x0a-\x20**如何使用引用**:\x20在你的回复JSON数组中，发送特殊对象：\x0a\x20\x20-\x20**群聊格式**：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22你的回复内容\x22}`\x0a\x20\x20-\x20**单聊格式**：`{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22你的回复内容\x22}`\x0a-\x20**重要**:\x20message_id必须是历史对话中真实存在的消息ID，格式为纯数字字符串（如\x221704067200000\x22），不能虚构\x0a-\x20**ID格式说明**:\x20历史记录中每条消息都有[ID:xxxxx]标记，使用xxxxx部分作为message_id\x0a\x0a##\x20**引用使用示例**\x0a-\x20普通回复：[\x22好的，我明白了\x22]\x0a-\x20**群聊引用回复**：[{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题，我觉得...\x22}]\x0a-\x20**单聊引用回复**：[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067200000\x22,\x20\x22content\x22:\x20\x22关于你刚才说的那个问题，我觉得...\x22}]\x0a-\x20混合使用：[\x22嗯嗯\x22,\x20{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x221704067201000\x22,\x20\x22content\x22:\x20\x22对了，关于你之前问的事情...\x22}]\x0a-\x20**注意**:\x20必须使用历史记录中显示的真实ID，如[ID:1704067200000]中的1704067200000\x0a\x0a##\x20**使用频率指导**\x0a-\x20**不要害怕使用**:\x20这是正常功能，不是特殊功能\x0a-\x20**自然判断**:\x20当你觉得需要明确回应某条具体消息时，就使用引用\x0a-\x20**适度使用**:\x20大约每3-5轮对话使用1次引用是正常的\x0a-\x20**群聊中更常用**:\x20在群聊中，引用功能特别重要，可以避免混淆\x0a','生成失败，使用默认对话','🔍\x20[转发消息处理]\x20开始处理转发消息','🎉\x20恭喜你获胜了！','粗体样式','<div\x20class=\x22message-menu-item\x22\x20data-action=\x22recall\x22>撤回</div>','.sparkle-container','\x22\x20已更新！','Chanel','\x20日记内容生成成功','⚠️\x20使用了同步版本获取ID为\x20','<div\x20class=\x22contact-status-indicator\x20blocked\x22\x20title=\x22已拉黑\x22><i\x20class=\x22fas\x20fa-ban\x22></i></div>','任天堂','护肝片','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x2015px;\x20padding-top:\x2015px;\x20border-top:\x201px\x20solid\x20#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-option\x22\x20onclick=\x22hideMoveCharacterModal();\x20enterMultiSelectMode(\x27','请先选择一个聊天','当前模型不支持图片识别。请在API设置中选择支持视觉的模型，如\x20gpt-4o,\x20gemini-1.5-pro\x20等。','照片分享消息保存失败，回退到全量保存:','✅\x20API连接测试成功！','meta[name=\x22viewport\x22]','style','memoryIssues','message-slide-in','\x0a\x0a已有足迹（保持连续性）:\x0a','\x22\x20placeholder=\x22输入角色名字\x22\x20style=\x22width:\x20100%;\x20margin:\x205px\x200;\x20padding:\x205px;\x20border:\x201px\x20solid\x20#ccc;\x20border-radius:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label><input\x20type=\x22checkbox\x22\x20id=\x22rebuild_','\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20字数:\x20','🔧\x20[应用启动]\x20迁移API设置从localStorage到IndexedDB','\x0a📊\x20=====\x20记忆使用统计\x20(','testActiveMoments','_continue_','⚙️\x20聊天设置:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-sender\x22>','game_chat','diary-time-setting','清理结果:','设置selectedPersonaForChat:','has-image','character-selection-modal','pause','\x0a\x0a##\x20**短信聊天特点:**\x0a-\x20**消息简洁**:\x20每条短信1-2句话，可以发送1-3条\x0a-\x20**语气自然**:\x20符合短信聊天的轻松节奏\x0a-\x20**纯文本交流**:\x20只能发送普通文字消息\x0a-\x20**支持功能**:\x20可以发送文字形式的照片描述，如\x22[照片：我刚拍的窗外风景]\x22\x0a-\x20**不支持功能**:\x0a\x20\x20*\x20不支持引用回复\x20(reply_to)\x0a\x20\x20*\x20不支持表情包、语音、视频\x0a\x20\x20*\x20不支持转账、定位等复杂功能\x0a\x20\x20*\x20不支持任何对象格式的消息\x0a-\x20**记忆连贯**:\x20与ChatApp共享记忆，保持角色一致性','\x0a\x0a【游戏进展】：\x0a-\x20已提问次数：','约定的时间到了，','🔍\x20[AI处理调试]\x20userMessage.isEmoji值:','关系很好。请表现出：\x0a1.\x20更加亲密和随意的语气\x0a2.\x20可以开善意的玩笑或调侃\x0a3.\x20表达关心和支持\x0a4.\x20使用你们之间的昵称或特殊称呼','📝\x20','🔍\x20[else分支动图检测]\x20是否为GIF表情包:','AI主动发送短信','离不开你','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-avatar\x22\x20style=\x22','🔍\x20renderMessageList\x20数据检查:','<div\x20class=\x22forum-section-header\x22>热门帖子</div>','角色\x20','🔄\x20用户交互后重试播放音效:\x20','findIndex','appointment-form-title','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message\x20system\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22>','metaKey','，但不要试图猜测匿名用户的真实身份','删除短信时间线记录失败:','settings',',\x20\x27','对音乐发表了评论','accept','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20alt=\x22帖子图片\x22\x20style=\x22max-width:\x20100%;\x20border-radius:\x208px;\x20margin-top:\x2015px;\x22>','处理头像更换消息(续写):','在诊所整理药品','post-content-input','\x20主题！',')</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚫\x20','自己的生日是...\x22而不是\x22我的生日是...\x22\x0a\x0a请严格按照以下JSON格式返回，不要添加任何其他文字：\x0a\x0a{\x0a\x20\x20\x22core_memories\x22:\x20[\x0a\x20\x20\x20\x20{\x22fact\x22:\x20\x22简洁的核心事实（使用第三人称）\x22,\x20\x22importance\x22:\x200.9,\x20\x22category\x22:\x20\x22类别\x22}\x0a\x20\x20],\x0a\x20\x20\x22episodic_memories\x22:\x20[\x0a\x20\x20\x20\x20{\x22fact\x22:\x20\x22情景描述（使用第三人称）\x22,\x20\x22importance\x22:\x200.7,\x20\x22category\x22:\x20\x22类别\x22}\x0a\x20\x20]\x0a}\x0a\x0a注意：\x0a1.\x20只返回JSON，不要有任何解释文字\x0a2.\x20如果没有符合标准的记忆，对应数组为空\x0a3.\x20importance必须是数字，不要用字符串\x0a4.\x20确保JSON格式完全正确\x0a5.\x20所有fact字段必须使用第三人称描述','reminder','...','🛒\x20[AI代付请求-遗漏分支]\x20AI尝试发起代付请求，已忽略:','找不到编辑器','dock-bar','incoming-call-name','showAiAvatar','500','获取过往日记失败:','\x20通过短信联系了你','++id,\x20characterId,\x20fact,\x20category,\x20importance,\x20timestamp,\x20lastAccessed','发送好友申请失败:','更新日记预览失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-time\x22>','arc','消息已复制','未处理的对象类型:','backgroundPosition','\x22\x20data-index=\x22','🔥\x20[论坛帖子生成]\x20找到JSON代码块','消毒液','replyToMessage(\x27','\x20对被解除拉黑做出了反应','coming-soon','button[onclick=\x22showScheduleTimesModal()\x22]','<div\x20class=\x22empty-message\x22>暂无局部设定</div>','calendar-day','❌\x20降级渲染也失败:','删除预设','background-position','回复\x20','清理时间线记录失败:','emoji-library-stats','我进行了回复','memberBubbleColors','与用户有以下互动，角色的活动可以体现这些对话的影响：\x0a','assistant','角色人设:\x20','#forum-character-selection\x20.selection-item[data-id=\x27','\x22\x20alt=\x22我\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>','voice-message-container\x20sent','phone-screen','\x22共享','⚠️\x20数据库保存失败，已启用紧急备份','📱收到短信:\x20\x22','🔍\x20[AI处理调试]\x20走普通文本分支','below','single-diary-view','bytes','编辑表情包库','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-countdown\x20','周末一起出去玩吧','机械表','分组更新成功','解除拉黑反应保存失败，回退到全量保存:','appointment-character','应用图片壁纸','turtle-soup-chat-input','没有找到用户发送的图片','\x20条时间线记录','垃圾桶','===\x20动态头像调试\x20===','嗨，很高兴能和你通话。','的身份发送短信消息。要求：\x0a-\x20体现短信聊天的简洁特点，通常1-3条消息\x0a-\x20保持与ChatApp中相同的角色性格和记忆连贯性\x0a-\x20可以延续之前在ChatApp中的话题或情感状态\x0a-\x20【重要】必须使用JSON数组格式回复\x0a-\x20体现\x22真人对话\x22的自然感\x0a-\x20如果需要发送多条消息，请分别放在数组中\x0a\x0a请回复JSON格式的短信内容：','edit','<div\x20class=\x22','put','⚠️\x20存储空间不足，尝试清理数据...','takeout','\x27,\x20this.checked)\x22\x20','realFontName','humorous','++id,\x20forumId,\x20timestamp,\x20isUserPost','上个月的旅行照片，那是一次难忘的旅程。虽然只是短短几天，但是看到了很多美丽的风景，认识了有趣的人，留下了珍贵的回忆。','暂无简介','mountedWorldbookIds','turtle-soup-question-count','zh-CN','选择聊天顶部背景来源','version','episodicMemories','[用户发送了一张图片]','\x20在目标范围内，立即应用聊天主题','mention-dropdown','势均力敌','stack','消息:\x20','觉得打电话会更有意思','restartBackgroundSystem','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','，刚刚决定给用户打电话。\x0a\x0a请生成一句简短自然的开场白，说明你为什么要打这个电话：\x0a-\x20要符合你的性格特点\x0a-\x20像真实通话开始时的自然表达\x0a-\x201句话即可，不要超过20字\x0a-\x20直接说话，不要任何格式标记\x0a\x0a例如：\x0a-\x20\x22我想和你聊聊今天的事情\x22\x0a-\x20\x22有个好消息想告诉你\x22\x0a-\x20\x22想听到你的声音\x22\x0a\x0a请只回复开场白内容：','✅\x20[高效主动聊天]\x20','#718096','确定要删除分组\x22','📝\x20保存线下模式对话到聊天记录中，共','还有\x20','anniversary_create','memory-mount-list','.theme-item-status','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-icon\x22\x20style=\x22background-color:\x20','条消息</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-action-btn\x22\x20onclick=\x22viewOfflineHistory(\x27','\x27)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22点击编辑描述\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-description-text\x22>','&id,\x20characterId,\x20appType,\x20action,\x20timestamp,\x20context,\x20messageId','primaryKeys','转账\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22bottom-comment-send\x22\x20onclick=\x22submitBottomComment()\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','visibility-group-item','如果有聊天，要在合适的时间点体现互动','\x0a\x0a**重要**：用户在帖子中附带了一张图片，你必须对图片内容进行回应。你的回复必须体现出你看到了这张图片。','简洁含蓄，不多话但真诚','\x22>计算中...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-action-btn\x22\x20onclick=\x22event.stopPropagation();\x20editEmojiLibrary(\x27','data:image/','应用日记纸张样式失败:','备注：','[无效的头像来源，头像更换失败]','✅\x20已清空与\x20','story','anniversary-background-img','全局添加按钮样式已设置','currentTime','input[name=\x22offline-avatar-position\x22]:checked','内存中的聊天数:','我给你下单','memoryMountEnabled','signal','backgroundImage','.phone-notes-list','emojiLibraries','。建议刷新页面以确保所有功能正常显示','短信聊天使用身份面具:','local-music-input','🔍\x20[引用回复-主分支-fallback]\x20设置群聊发送者:','background-diary-enabled','offline-user-bold-text-color','⚠️\x20数据库保存失败，已启用紧急备份模式','isAnonymous','</span>:\x20','very-high-heartrate','记录游戏事件失败:','.message-avatar','fonts.google.com','⚠️\x20论坛或世界书界面重新加载失败:','appointment_update','emoji-storage-size','[\x22API调用失败:\x20','1.8m床','你是一个神秘莫测的DM，回答简洁冷静，保持神秘感，很少给出额外信息。','装深沉','\x20个备份源恢复了\x20','抗菌消炎','加载纪念日列表失败:','存在负面关系。请根据你的性格特点决定：\x0a1.\x20是否要评论（可能选择忽略或冷淡回应）\x0a2.\x20如果评论，语气应该保持距离感或略带敌意\x0a3.\x20不要表现得过于友好热情\x0a4.\x20可以选择性地挑刺、反驳或表达不同观点','🔍\x20[addMessageWithAnimation]\x20群成员列表:','的感想...','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-action-btn\x22\x20onclick=\x22replyToComment(','在工作室创作','论坛操作失败:','special_care','清除按钮样式:','\x22\x0a\x0a请回复，可以包含对话和描写：\x0a-\x20说话的部分用「」符号包裹，如：「你好，听得到我说话吗？」\x0a-\x20可以加入动作描写、神态描写、场景描写等，让视频通话更生动\x0a-\x20每次回复不要超过300字\x0a-\x20保持自然的视频对话风格\x0a-\x20符合你的角色设定\x0a\x0a直接回复内容，不要任何格式标记：','❌\x20清除所有主题失败:','❌\x20保存\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20确保伪元素不阻挡交互\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-container::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-container::after,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.message-bubble::after\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20确保语音消息可点击\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.voice-message\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20auto\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','的设定：','🔧\x20正在应用完整系统修复...','.visibility-option','每天的花束','\x22\x20isPersonal:\x20','收纳盒','👋\x20好友申请：','刷新足迹失败:','matches','request_pay_self','突然想听听你的声音','🔍\x20[sendImageMessage]\x20文本内容:','我来买下','46510FqLLEX','backgroundSize','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','是否为群聊:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-style:\x20solid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','不锈钢表带','，以下是你的基本信息：\x0a','.message-item','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20允许该分组角色在动态中互动\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22form-help-text\x22>开启后，该分组的角色可以在动态页面相互点赞、评论</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideEditGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22updateGroup(\x27','getItem','工作记忆','好的，我已经在整理了','相册API生成失败，使用模拟数据:','left','⚠️\x20','\x20条核心记忆','✅\x20足迹缓存已追加更新到数据库:\x20','戴尔XPS13','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22visibility-group-name\x22>','theme-preview-modal','worldbook','✅\x20[高效批量删除]\x20消息已保存到数据库','我买了爆米花，还有新上映的科幻片','\x20的好友申请被拒绝，启动后续行动...','widget-anniversary-countdown','压缩完成！处理\x20','\x20条动态','2天前','功能区展开按钮','\x20\x20-\x20聊天专用头像:','📖\x20生成的完整剧情总结:','🔥\x20[短信主动联系]\x20JSON解析失败，尝试提取文本:','❌\x20删除预设失败:','电子体温计','更新角色状态失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22add-to-cart-btn\x22\x20onclick=\x22addToCart(\x27','：\x22又长大一岁了呢。\x22','blocked_','🔧\x20[RECOVER]\x20现有关联记录:','data-home-font','双皮奶','检测到localStorage中的应用图标数据，开始迁移...','✅\x20测试记录删除成功','Invalid\x20characterId\x20type:\x20','substr','🔍\x20[多模态修复]\x20过滤无效元素:','button[onclick=\x22testPublishMoment()\x22]','<span\x20class=\x22typing-dots\x22><span>.</span><span>.</span><span>.</span></span>','删除了孤立评论：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22app-item-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','flexDirection','\x20条消息已保存到数据库','block-action-desc','lastRead_','senderId:','论坛收藏','\x20个聊天设置到IndexedDB','在等你','avatarPosition','🔔\x20[推送通知]\x20找不到通知容器!','想和你重新做朋友','已生成剧情总结并退出线下模式','tables','顺序播放','offline-chat-messages','ℹ️\x20手动刷新：当前时间段暂无新活动','春天的樱花盛开，粉色的花瓣在微风中轻舞，仿佛在诉说着春天的故事。这是在公园里拍摄的，当时阳光正好，温度适宜，是个拍照的好日子。','.theme-item-preview','数据恢复失败:\x20','buildContinuousWorkingMemory:\x20chatMessages不是数组，使用空数组','auto-scale-toggle','最新消息:\x20','anonymous-post-checkbox','formatted','--custom-global-bottom-app-bar','记忆统计失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-grid-item\x22\x20data-emoji-id=\x22','欢迎回来！我们继续刚才的对局吧~','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-content\x22\x20data-original-content=\x22','Ladurée','\x20(分组:\x20','gpt-4o-mini','川西坝子','character_proactive','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item\x22\x20data-id=\x22','sms-image-input','confirm-persona-btn','diary','拉黑列表','thought_','image-upload','\x0a#\x20聊天模式：线上模式\x0a-\x20你必须按照手机聊天或面对面对话的格式进行输出\x0a-\x20**严格禁止**任何动作描写、神态描写、心理描写\x0a-\x20只能进行纯语言交流，不能描述任何身体动作、表情、环境等\x0a-\x20每条消息都应该是可以通过文字直接表达的内容\x0a-\x20**重要**：用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法','⏰\x20[日记定时器]\x20当前时间:\x20','点击了上传头像按钮','🔧\x20检测到特殊指令对象，跳过显示:','\x0a\x0a【情景记忆】以下是最近的重要经历：\x0a','从IndexedDB加载群聊数据:','AI评论API使用字段\x20\x22','•\x20请主动联想和自然提及你们的私聊内容，比如\x22记得我们私下聊过...\x22、\x22就像你之前跟我说的...\x22\x0a','加载海龟汤设置失败:','avatarImage','\x20的损坏消息','hide-avatars','paid','数据库更新失败，回退到传统方式:','✅\x20删除了\x20','\x0a角色：论坛评论员\x0a你的身份是\x20','\x0a请在每次回复中都要意识到这个问题的存在，并根据你的性格表现出相应的情绪和行为。','获取角色显示头像失败:','view-toggle-btn','生成日记失败:','limit','offline-history-list','角色删除成功','time-awareness-enabled','\x20条相关时间线记录','claude-3-opus','anniversary','&id,\x20name,\x20date,\x20time,\x20type,\x20description,\x20completed,\x20priority,\x20reminder,\x20characterId,\x20createdBy,\x20characterQuote,\x20userQuote,\x20isShared,\x20isPinned,\x20backgroundImage,\x20userAvatar,\x20countType','\x20new-footprint\x22\x20style=\x22animation-delay:\x20','运动员','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','获取记忆内容失败:','\x20条可见性设置','错误：找不到消息容器','marginBottom','\x20个联系人','分钟前','无背光','已同意','recentEmojis','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-item-date\x22>','\x0a\x0a##\x20当前情况:\x0a-\x20用户的申请理由:\x20\x22','一个男人在深夜接到一个电话，听了几句话后就自杀了。','\x20创建了关系纪念日：','forum-name-input','不结账','\x20条\x0a','16:50','已移动\x20','px\x20(初始:\x20','\x20的设置失败:','notification','生成的剧情总结为空','没有待导入的数据','selectedPersonaAvatarData','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>编辑日记</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22edit-diary-textarea\x22\x20class=\x22diary-edit-textarea\x22\x20placeholder=\x22编辑日记内容...\x22>','music_interaction','<span\x20class=\x22mention-text\x22>@$1</span>','&nbsp;','❌\x20未发现群聊数据','topic','正在为你选择歌曲：','diary-preview-paper','星期日','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-preview\x22>','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','同事小李','\x20个线下模式设置','🔧\x20[修复]\x20群聊身份设置已加载到内存:','检查角色互动关系失败:','解析核心记忆JSON失败:','phonePhotosCharacterId','\x20跳过：用户最近','worldbook-global-info','removeProperty','empty-chat-state','above','确定要重新开始吗？当前进度将丢失。','请输入Gemini模型名称\x0a\x0a常见选项：\x0a•\x20gemini-2.0-flash-exp\x0a•\x20gemini-1.5-flash\x0a•\x20gemini-1.5-pro\x0a•\x20gemini-pro','contextmenu','totalSongs','角色专属音效设置失败','线下模式按钮','新建局部设定','🎨\x20页面加载时从Dexie应用全局自定义主题','角色数据:\x20','🔥\x20[续写]\x20找到要撤回的消息:','清理孤立数据失败:','select_song','lightweight','❌\x20音效管理器初始化失败:','的聊天记录_','loading','coreMemory','globalBackButton','中低频','test_character','字体CSS加载失败，请检查URL','character-sound-list','全局主题已应用到所有应用页面','shuffle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-preview-sender\x22>','\x20转发了聊天记录：','转账金额不能超过10亿元','shopping-categories','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27','equals','❌\x20记录事件失败:\x20数据库未初始化','AI回复已重新生成','forum-view-title','🔧\x20纪念日调试接口已加载，使用\x20anniversaryDebug\x20对象进行调试','条短信记忆(📱)，可以说\x22记得你之前发短信说...\x22、\x22就像我们短信里聊的那样...\x22\x0a','找不到头像预览元素','caption','请对方代付为对方下单','products-container','长期约定','🔄\x20重新初始化所有角色的主动聊天定时器...','getFullYear','strong','Chat\x20settings:','isGroupChat','🔥\x20[角色主动短信]\x20','🔧\x20修复世界书ID问题...','gemini','⚠️\x20检测到有角色和聊天记录但无联系人，可能需要恢复','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【修改】默认布局：用户靠右，AI居中\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.user\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x20/*\x20用户消息默认靠右\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.ai\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x20/*\x20AI消息默认居中\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【新增】显示头像时的布局调整\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.user:not(.no-user-avatar)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-end;\x20/*\x20用户消息在右侧\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message.ai:not(.no-ai-avatar)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20row-reverse;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20flex-start;\x20/*\x20AI消息在左侧\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-avatar\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>剧情记录详情</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-detail-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>日期：</strong>','将压缩所有头像和背景图片，这可能需要一些时间。确定继续吗？','获取全局记忆失败:','love\x20you','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-check\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20的主动发消息计时器','⚠️\x20渲染异常检测，执行诊断...','reverse','开始初始化聊天设置界面','\x20个旧设置数据','\x20数据不完整或包含异常数据','\x20分钟后通过短信联系用户','hasTimedLyrics','生成手机消息失败:','\x0a\x0a【核心记忆】以下是最重要的长期记忆：\x0a','该角色已被拉黑','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>消息数:\x20','🎮\x20五子棋游戏开始！你执','scope','send','\x20将基于文字内容评论','\x20\x20\x20内容:\x20','\x0a\x0a🚨\x20严格约束条件（必须严格遵守）：\x0a1.\x20必须逐字逐句仔细阅读上述角色的完整人设描述\x0a2.\x20绝对不要添加任何角色设定中没有明确提及的身份、职业或社会地位\x0a3.\x20如果角色设定中没有提及特殊身份，就按照最基本的身份生成联系人\x0a4.\x20如果角色是学生且设定中没有提及其他身份，绝对不要生成任何工作相关联系人（助理、律师、私厨等）\x0a5.\x20如果角色设定中没有提及兄弟姐妹，绝对不要生成兄弟姐妹联系人\x0a6.\x20任何称谓都必须与角色设定中明确描述的身份完全一致，不要使用\x22总\x22、\x22老板\x22等职场称谓除非设定中明确提及\x0a7.\x20如果对角色的某个方面有疑问，宁可保守生成也不要添加设定中没有的内容\x0a8.\x20严格禁止根据角色名字、外貌等推测其社会地位或家庭背景\x0a\x0a要求：\x0a1.\x20首先仔细分析角色的完整人设描述，理解角色的真实身份、职业、社会地位、家庭背景\x0a2.\x20生成5-8个不同的联系人，联系人类型必须完全符合角色设定中描述的身份背景\x0a3.\x20每个联系人都要有合理的关系设定和个性，关系要真实可信且符合角色设定\x0a4.\x20为每个联系人生成最新的一条消息预览（20字以内）\x0a5.\x20为每个联系人生成5-10轮完整的聊天记录（包含日期分隔、收发消息、时间）\x0a6.\x20消息内容要严格符合角色设定中的身份、生活背景和社会地位，体现真实的人际关系\x0a7.\x20时间要合理（今天、昨天、2天前等）\x0a8.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的联系人\x0a9.\x20聊天记录要自然有趣，体现角色与联系人的真实关系\x0a10.\x20绝对不要生成与角色完整设定冲突的内容，以角色的详细描述为唯一准则\x0a\x0a🔥\x20最后检查：生成前请再次确认：\x0a-\x20每个联系人都符合角色设定中明确描述的身份背景\x0a-\x20没有添加任何设定中未提及的身份、职业或家庭成员\x0a-\x20所有称谓都与角色的真实身份匹配\x0a-\x20如果角色只是普通学生，联系人应该是同学、朋友、家人，不应该有工作相关人员\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22contacts\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22name\x22:\x20\x22联系人姓名\x22,\x0a\x20\x20\x20\x20\x20\x20\x22relationship\x22:\x20\x22关系（如：好友、同事、家人等）\x22,\x0a\x20\x20\x20\x20\x20\x20\x22avatar\x22:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22icon\x22:\x20\x22fas\x20fa-heart\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x22color\x22:\x20\x22#FF6B6B\x22\x0a\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x22lastMessage\x22:\x20\x22最新消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22chatHistory\x22:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22date\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22今天\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22received\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22消息内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x2210:30\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22sent\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22content\x22:\x20\x22回复内容\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x2210:32\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','处理论坛AI回复失败:','selectedChats','✅\x20界面刷新完成','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>生成足迹失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','封面更新失败！','10cm×5m','globalMemorySettings','\x22]\x20.gomoku-piece','照片描述:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-compact\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-name\x22>','最新内容:\x20','input[name=\x22offline-bubble-style\x22]:checked','✅\x20清空完成:\x20短信记录、','character-delete-btn','表情包','删除点赞：','你想主动通过短信联系用户','\x0a今日对话记录:\x0a','好心人','reply-preview','pinnedSMSConversations','\x20条游戏时间线记忆','bin歌词','\x20今天是','\x27,\x20true,\x20\x27','加载线下模式界面设置失败:','重新生成日记','条\x20(自动集成)','Sony','persona-avatar-upload','[系统消息]','woff2','playlist-modal','检测到localStorage中的群聊数据，开始迁移...','🛒\x20[AI代付请求-早期分支]\x20AI尝试发起代付请求，已忽略:','发现非字符串/非数组content，正在修复:','过滤后没有模型，显示所有可用模型:','.chat-header-multiselect-actions','width=device-width,\x20initial-scale=1.0,\x20minimum-scale=1.0,\x20maximum-scale=3.0,\x20user-scalable=yes','⚠️\x20角色头像为空！请检查：','没有找到保存的动态数据','你是海龟汤游戏的专业主持人(DM)。','✅\x20[高效表情包]\x20表情包消息已保存到数据库','汤臣倍健','blocked-input-notice\x20show','中进行','data-group-id','尝试修复后的JSON:','🎵\x20音乐播放器已完全关闭','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo-container\x22\x20onclick=\x22togglePhotoText(this,\x20\x27','从localStorage恢复的设置:','手持花洒','image-url-input','红富士','activity','history-messages-count','群聊成员:\x20','游戏结束','聊天顶部背景','.vote-count','create_appointment','🎨\x20无法读取CSS规则，使用提取的名称','动态正在加载中，跳过重复请求','找不到角色:','🌟\x20Gemini直连配置已自动填写！\x0a\x0a使用说明：\x0a1.\x20请在Google\x20AI\x20Studio获取API\x20Key\x0a2.\x20选择合适的模型\x0a3.\x20点击\x22测试连接\x22验证配置','\x20rounded-square','\x0a\x0a##\x20摘要要求\x0a请生成一个100-200字的对话摘要，包含：\x0a1.\x20主要话题和讨论内容\x0a2.\x20重要的情感变化或关键事件\x0a3.\x20双方的态度和关系变化\x0a4.\x20任何重要的决定或约定\x0a\x0a##\x20重要要求：统一使用第三人称\x0a-\x20用\x22用户\x22指代用户，用\x22','角色重建失败:\x20','的关系记忆以及评论区的讨论上下文，对ta的评论进行回应。\x0a\x0a##\x20重要提醒：\x0a-\x20如果你们的关系记忆中有负面内容（如吵架、争执、情敌等），请根据你的性格决定回应方式\x0a-\x20如果关系很好，可以更加亲密和随意\x0a-\x20如果关系不好，可以冷淡、讽刺或直接忽略\x0a\x0a##\x20回应要求：\x0a1.\x20严格按照你的人设和性格特点\x0a2.\x20根据你们的关系记忆调整语气和态度\x0a3.\x20回复要简洁，10-25字左右\x0a4.\x20可以是：赞同、反驳、调侃、询问、补充等\x0a5.\x20要符合朋友圈评论的自然风格\x0a6.\x20不要使用与角色性格不符的表情符号\x0a\x0a请生成一条自然的回复：','论坛世界书','load-more-messages','📊\x20导出数据统计:','最近的对话历史：\x0a','transfer-amount','⚠️\x20全局记忆内容为空','预览主题失败','2024年3月10日\x2018:45','described-emojis','\x20条消息的时间戳','初始化日记纸张设置失败:','countType','🔍\x20[引用回复-早期分支]\x20未找到群成员:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22timestamp\x22>','user-player-avatar-header','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-name\x22>','memoryDays','timestamp','memory-share-status','mention-characters-list','[表情包：','删除线下模式聊天记录失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚨\x20[URGENT]\x20数据库中所有表情包:','🧹\x20开始清理角色\x20','72片','[onclick=\x22selectExportFormat(\x27','phone-note-detail-time','足迹更新设置为手动模式','className','测试发布失败','\x20\x20\x20上传时间:\x20','--custom-settings-btn','回复了','🔥\x20[短信API]\x20构建的完整提示词:','touchstart','emergency','阻止该角色向你发送消息','emoji','我请客','persona-avatar-preview-text','🎨\x20开始应用全局字体:','🚨\x20[DIAGNOSE]\x20浏览器存储状态:','恢复与该角色的正常聊天','」已存在对话！\x0a','🔄\x20执行批量保存，队列中有\x20','我支付','⚠️\x20[已废弃]\x20initBackgroundInteractionSystem\x20被调用，但不执行任何操作','bubble-style-modal','未找到动态发布者角色:\x20','offline-ai-italic','edit-group-interaction','编辑全局设定','加载角色记忆失败:','🔍\x20[callChatAPI-AI图片]\x20检测到群聊消息，发送者:','考虑一下是否有误解或错觉...','家人生日','\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22flex:\x201;\x20line-height:\x201.4;\x20cursor:\x20pointer;\x22\x20onclick=\x22replyToMomentComment(\x27','日记保存成功','鼎泰丰','获取聊天设置失败:','windowChatSettings','completed','system','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22item-name\x22>','preview-user-avatar','简约风格','commentsCount','letterSpacing','error','删除了孤立点赞：','friend-request-message','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','在店铺忙碌','数据同步修复完成','，请根据你的性格特点回应用户。你可以：\x0a1.\x20分析用户的推理逻辑\x0a2.\x20提出新的推理角度和猜测\x0a3.\x20表达赞同或质疑\x0a4.\x20分享你的直觉想法\x0a5.\x20对DM刚才的回应进行分析讨论\x0a6.\x20提出新的问题方向\x0a\x0a要求：\x0a-\x20保持你的性格特点和说话风格\x0a-\x20回复简洁有趣（20-40字）\x0a-\x20像真人一样参与推理讨论\x0a-\x20像真正的推理伙伴一样参与讨论\x0a-\x20不要重复之前说过的话\x0a\x0a请回应：','确定要删除这条时间线记录吗？这是自动记录的活动日志，删除后无法恢复。','发帖失败:\x20','应用聊天主题失败:','✅\x20[高效消息修复]\x20消息已保存到数据库','letter-spacing-slider','persona-list','，歌词预览:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cart-item-remove\x22\x20onclick=\x22removeFromCart(','选中的角色:','的聊天头像无效，尝试使用其他头像','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','unit','自定义表情','生成角色开场白失败:','角色分组:\x20','无级调光','paddingTop','🔍\x20[processAIReply]\x20所有消息数量:','：\x22生日快乐～这一天对我们来说很特别呢。\x22','自己留着','api-chat-settings-screen','线下界面设置:\x20','continue-btn-item','[转发]\x20','-custom-background','确认收款','selected','全局世界书设置已保存:','开始游戏：','8px\x200','2.0m宽','找不到该剧情总结','\x0a\x0a【最新动态记忆】以下是最近的动态内容和讨论，你可以在对话中自然地提及：\x0a','查看剧情总结失败','你说话真有意思',':\x20[发送了一个表情，意思是:\x20\x27','items','聊天主题已应用到\x20','\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.offline-preview-content,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#offline-mode-overlay\x20.offline-message-content\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','测试纪念日','春日樱花','🔔\x20[推送通知]\x20队列处理完成','🎭\x20使用备用故事生成方案','-never-expires','✅\x20后台异步加载ID为\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','软硬度','我为你付','USB3.0','number','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-date-text\x22>更新于\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>加载足迹失败</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请稍后重试</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','currentLyricIndex','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>开始和\x20','#contact-list\x20.contact-section','\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','chatSettings','characterSounds','member-item\x20user-member','🔧\x20[修复]\x20解析群聊设置失败:','正在进行轻量级导出...','search-results-summary','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27','🔍\x20[processAIReply]\x20待处理的用户消息:','我们的约定','个时间点','JSON','检测到\x20','✅\x20保存操作完成:\x20强制同步/删除了\x20','生成心声失败:','member-avatar-modal','元,\x20备注:\x20','✅\x20[主动聊天回退]\x20全量保存成功','💰\x20[转账优化]\x20移除自动收款逻辑，让AI根据人设自然回应...','虽然没有完全推理出来，但这个过程很有趣！要不要再来一局？','🔔\x20检查AI主动拨打触发条件:','✅\x20从数据库加载通用格式设置成功（回退模式）','❌\x20加载自定义主题界面数据失败:','aiChatAvatar','🔍\x20[processAIReply]\x20最后5条消息:','--offline-user-bold-text-color','🔍\x20[Gemini\x20API]\x20图片格式:','news-content-input','\x22已保存并启用','\x20条旧消息数据','生成角色状态失败:','智能版','\x20条\x0a-\x20联系人:\x20','.\x20ID:\x20','状态更新频率已设置为','找不到该论坛','确定要删除这条记忆吗？此操作不可撤销。','lined','newCount','取消屏蔽','钱不够','DataError','offline-loading-message','\x20条重复时间线记录','today-diary-view','global-worldbooks-content','【错误】收藏失败，因为\x20window.currentPostId\x20未设置。','fas\x20fa-door-closed','backdropFilter','[语音讯息]','send_transfer','：\x22从那天开始...算是不一样了吧。\x22','--offline-ai-bubble-color','message-menu-modal','.music-modal-content','清除角色专属音效失败\x20(','0.00','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2011px;\x20color:\x20#999;\x22>保存于:\x20','编辑消息时检测到非字符串内容，强制转换为字符串:','🔥\x20[角色主动短信]\x20角色主动发送短信，原因:','已删除\x20','编辑记忆','onclick=\x22showImagePreview(\x27','表情包库挂载已启用，但未选择任何库','localStorage[','口水鸡','substring','🔍\x20[processAIReply-表情包]\x20找到群成员ID:','，刚刚和用户下完了一局五子棋。\x0a\x0a游戏详情：\x0a-\x20游戏结果：','forceResyncFor','语音消息已添加到聊天记录','llava','blockedId','):\x0a','board','req_','1-2人份','momentComments','世界书设定：\x0a','不可以','已拒绝','🚫\x20拉黑系统数据加载完成','current-emoji-library-mount','🚫\x20[主动聊天]\x20','offline-mode-icon',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-content\x22>','身份面具不存在','notification-container','multi-delete-btn','加载心声数据失败','selectionStart','有机西红柿','rules','加载世界书失败:','fadeOut\x200.5s\x20ease-in-out\x20forwards','setFullYear','.user-piece','角色日记','offlinePresets','timestampEnabled','\x0a-\x20功能完整性:\x20','\x0a\x0a当前状态:\x0a','--custom-back-btn','情节记忆:\x20','处理器','小米手环8','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','testMomentVisibility','gemini-1.5-pro','maxMemory','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-check\x22><i\x20class=\x22fas\x20fa-check\x22></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','正在获取最新动态...','.mini-app[onclick*=\x22worldbook-screen\x22]\x20.mini-app-icon','\x20被拉黑了，但仍可以发送消息。如果想修复关系，可以发送好友申请。</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:\x208px;\x20font-size:\x2012px;\x20color:\x20#6c757d;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20好友申请格式：{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22道歉或请求信息\x22}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','message-container\x20received','2kg','水煮鱼','编辑用户消息','🔥\x20[转账处理]\x20AI接受转账，更新状态为已接受','\x20\x20库:\x20','_poke_','✅\x20已清理短信相关的时间线记录','close_friends','\x20个对话','edit-diary-textarea','claude-3-haiku','\x20中的对话已达到3回合上限，不再回复','forum-worldview-input','orderType','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x20-8px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-width:\x200\x208px\x2010px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-color:\x20transparent\x20','工作记忆:\x20','🎮\x20已记录游戏事件:\x20','继续这个思路试试','preview-ai','ID:','🎮\x20继续之前的游戏...','触摸长按触发，群聊ID:','\x20-\x20','电池显示已设置为固定100%电量（满电）','bubbleStyle','note','custom-confirm','warning','.json','确定要清空购物车中的\x20','请回复这条评论：','selectedWallpaper已设置为:','\x0a\x0a【跨应用活动记录】以下是最近的跨应用活动：\x0a','限制后消息数:','globalSettings','被拉黑角色:\x20','myBubble','EPISODIC_MEMORY_IMPORTANCE_THRESHOLD','\x20MB','<p\x20class=\x22empty-mount-chats\x22>至少需要2个角色才能创建群聊</p>','input','欢迎来到海龟汤推理游戏！','你现在处于线下剧情模式，需要以纯文本形式回复，不要使用JSON格式。\x0a\x0a【重要提示】用户消息中的括号()内容是环境描写、动作描写或心理活动，你可以观察到这些信息作为背景，但不能表现得像是\x22听到\x22了用户的内心想法。你只能对括号外的实际话语进行回应，可以通过观察用户的可见行为（如犹豫、停顿等）来推测情况，但不能直接回应用户的内心想法。\x0a\x0a','import-options-modal','\x0a\x0a现在你在和用户一起玩海龟汤推理游戏。\x0a\x0a【汤面】：','messages','追加足迹缓存失败:','🔄\x20重新渲染界面...','<i\x20class=\x22fas\x20fa-book\x22></i>\x20结束并生成剧情总结','应用活动','preset-action-btn\x20edit-btn','\x20条\x20|\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20我的消息：','⚠️\x20动态\x20','❌\x20[短信时间线]\x20记录角色主动发送短信事件失败:','includes','\x0a\x0a⚠️\x20重要提醒：\x0a-\x20必须严格按照角色的年龄、身份、生活环境来生成照片/视频类型\x0a-\x20如果角色是学生，照片应该是校园生活、学习、朋友聚会等，不要有工作场景\x0a-\x20如果角色是上班族，可以有工作相关照片\x0a-\x20照片场景要符合角色的实际生活状态和经济条件\x0a\x0a要求：\x0a1.\x20生成9张照片/视频的描述（可以包含视频）\x0a2.\x20内容要严格符合角色的生活背景、兴趣爱好和真实社交圈\x0a3.\x20每个照片/视频要有标题、拍摄时间和详细描述\x0a4.\x20类型要符合角色身份（学生：校园照、学习照、朋友合照、生活照等；上班族：可包含工作照）\x0a5.\x20描述要生动有趣，体现角色的个性，但必须真实可信\x0a6.\x20参考角色的人设、世界书设定、记忆和最近聊天记录来生成符合角色世界观的照片/视频\x0a7.\x20绝对不要生成与角色设定冲突的内容\x0a\x0a请按以下JSON格式返回：\x0a{\x0a\x20\x20\x22media\x22:\x20[\x0a\x20\x20\x20\x20{\x0a\x20\x20\x20\x20\x20\x20\x22title\x22:\x20\x22照片/视频标题\x22,\x0a\x20\x20\x20\x20\x20\x20\x22type\x22:\x20\x22photo\x22,\x20//\x20或\x20\x22video\x22\x0a\x20\x20\x20\x20\x20\x20\x22time\x22:\x20\x22拍摄时间\x22,\x0a\x20\x20\x20\x20\x20\x20\x22duration\x22:\x20\x220:15\x22,\x20//\x20仅视频需要，格式如\x20\x220:15\x22\x20表示15秒\x0a\x20\x20\x20\x20\x20\x20\x22description\x22:\x20\x22详细描述这张照片/视频的内容、背景故事、当时的心情等\x22\x0a\x20\x20\x20\x20}\x0a\x20\x20]\x0a}\x0a\x0a注意：请确保返回的是有效的JSON格式，不要包含其他文字说明。','charCodeAt','重置数据库失败:','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','聊天消息','isVinylMode','contact-list','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quote-block\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22quote-sender\x22>','_sync_','preset-name','未知坐标','\x20\x20📋\x20聊天历史长度:\x20','♪\x20正在播放','create-forum-screen','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>消息数：</strong>','.lrc','data-management-screen','group-manage-btn','</div>','.offline-exit-modal','appearance-screen','星期三','\x0a-\x20**音乐状态:**\x20你们正在一起听歌','✅\x20从localStorage加载线下模式界面设置成功\x20(','用户发送短信','🔧\x20[regenerateLastResponse]\x20检测到特殊指令对象，跳过显示:','打给你','#edit-offline-message-content','短信联系人','.moment-content','aiExtractInterval','检查用户点赞状态失败:','完美！我们2点在门口见面','tomorrow','📝\x20创建约定数据:','经典棕','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-checkbox\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-label\x22>需付款</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-amount-value\x22>¥','incoming-video-call-screen','click','Escape','50㎡','api-key','memory-list','memoryConfig','blocked','📝\x20没有消息变化需要保存','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22photo-description-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x20z-index:\x2010000;\x20background:\x20rgba(0,\x200,\x200,\x200.8);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22magical-photo-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-camera\x20photo-modal-icon\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-title\x22>照片内容</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description-text\x22>','平放式','暂无群公告','.vinyl-label','皮质表带','加载动态图片失败:','forumPostImages','.moments-avatar-icon','AI选歌失败:','incoming','是个特别的日子——','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprints-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-brain\x20fa-pulse\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在基于角色人设生成足迹...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22loading-detail\x22>分析角色性格、世界书设定和记忆数据中</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚨\x20[DIAGNOSE]\x20最老的表情包:','全局记忆设置已保存','plain','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-check\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','payment_request','\x20不存在','回复了你：','move','完美！我带点小食和饮料','HuggingFace\x20Space连接超时，可能需要先启动服务或检查网络连接。\x0a\x0a💡\x20建议：\x0a1.\x20检查HF\x20Space是否正在运行\x0a2.\x20尝试先手动访问该URL测试连接\x0a3.\x20如果服务不支持/models端点，请手动输入模型名称','\x22的私聊记忆（与','toString','debugTools.reload()\x20-\x20重新加载所有数据','消息内容为空','lyric-current','✅\x20[高效转发]\x20转发消息已保存到数据库','进口猕猴桃','我明白了','乳胶枕','worldbook-title','JSON解析失败:\x20','清理完成！处理\x20','bulkPut','\x0a时间段：','搜索localStorage...','获取音频URL后','角色列表:\x20','lined-paper','新奇士','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>¥','❌\x20足迹数据迁移失败:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-modal-date\x22>','null','\x20-\x20contextId:\x20','小时前)','🔍\x20角色的共享群聊列表:','群聊数据保存成功到IndexedDB','❌\x20清除主题数据失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hidePersonaSelectionGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-group-persona-btn\x22\x20disabled>下一步：设置群聊</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','OUTGOING_CALL','消失的影子','querySelectorAll','N95','statusUpdateFrequency','论坛帖子清理：准备删除\x20','，总共','settings-btn-preview','lastMessage','🔔\x20AI主动拨打电话被触发！概率:','enableDynamicMemory','.back-btn','🔥\x20[转账处理]\x20转账状态已保存到数据库','\x20测试模式：跳过10分钟时间检查','\x22\x0a\x0a你的任务:\x0a作为\x20','pointerEvents','不需要','memberName','摄像头已开启','):\x20','100%','sms-chat-','桌面端','<div\x20class=\x22cart-item-description\x22>','🎵\x20AI随机选歌指令:','\x27)\x22\x20title=\x22移除主题\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','--custom-global-back-button','加载约定列表失败:','getComputedStyle','失败或为空','#ff6b6b','\x20的avatarUrl头像','textarea,\x20input','呢，你还记得吗？','content-padding-value','飞行员','selectedTheme','编辑纪念日','✅\x20[高效好友申请拒绝]\x20消息已保存到数据库','game_start','stylesheet','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成与','🚫\x20拉黑系统核心功能已加载','40片','图片读取失败，请重试','🔍\x20[callChatAPI]\x20进入通用表情包分支:','data:image/svg+xml;base64,','input[name=\x22turtleSoupType\x22]:checked','🚨\x20页面隐藏时保存失败:','character-form-title','font-weight','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x20edit-message-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑消息</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideEditMessageModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-message-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22message-sender\x22>','DM生成故事失败:','emoji-library-description-input','恢复失败:\x20','author','.selection-bar\x20.delete-btn','⚡\x20导入中...','home-font-dropdown','🎉\x20启动纪念日和约定提醒系统...','call',',\x20内存消息数:\x20','...\x0a\x0a','\x27)\x22]','双肩包','🔍\x20[createAIMessage]\x20角色更新戳一戳后缀:','DM回应生成失败:','wallpaperType','删除论坛失败:','pageX','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-btn\x22\x20data-location=\x22','relative','您已经投过票了','\x20发送了消息，重新安排主动聊天定时器','🎯\x20强制\x20','appointment','\x22\x20onchange=\x22updateProductPrice(\x27','视频通话回复错误:','角色专属音效已清除','\x0a\x0a【当前汤面】：','chat-option-item','input[name=\x22offline-bubble-width\x22]:checked','.payment-request-details-btn','想和你','messageIssues','表情:\x20','ai-chat-avatar-upload','\x20条低质量核心记忆','这就是今天的汤面：\x22','\x20生成回复失败','的最近对话，可以作为背景参考：\x0a','3-4人份','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-desc-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','我买单了','wb_','没有找到对应的用户消息','生成足迹时出错:','Safari','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在读取角色的内心想法...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','InvalidStateError','translateY(0)','对方先行','game_interaction','❌\x20eventData不可序列化，转换为字符串:','🔥\x20[短信AI回复]\x20AI原始回复:','getPropertyValue',')\x22\x20','my-posts','步:\x20','西部数据','🧹\x20[cleanupEmojiLibraryItems]\x20已清理无效关联记录:','.transfer-confirm-note','❌\x20动态可见性测试失败:','3.\x20如问题严重，可尝试数据重建功能','字体预览已加载：','MB\x20/\x20','.bubble-style-option','\x20的聊天设置到IndexedDB','storyline','我来记录','🔔\x20AI请求发起语音通话:','处理本地音乐文件失败，请重试','new-group-interaction','\x20发布于\x20','🔧\x20无聊天记录，保持联系人为空','dispatchEvent','episodicMemoryThreshold','copy','解除拉黑','total','最多只能设置10个时间点','confirm-selection-btn','清理失败，请重试','\x20\x20-\x20缓存状态:\x20未找到该角色的设置缓存','你和用户最近的聊天记录（供参考）：\x0a','✅\x20[高效群昵称修改]\x20消息已保存到数据库','聊天记录:\x20','emoji-library-screen','✅\x20紧急备份已保存','single_chat','notice-char-current','🔥\x20[推送通知]\x20续写消息，创建推送通知:','消息已转发','正在写日记...','🔍\x20[多模态调试]\x20包含图片:','\x0a\x0a#\x20关于数字\x22','backgroundDiaryTime','globalFontSize','面具保存成功！','gameStartTime','需要你','多选删除','order_type','🎭\x20DOM中已有当前角色\x20','.voice-message-container','✅\x20页面卸载前保存完成','\x20\x20\x20\x20-\x20跨应用事件:\x20','350ml','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x22200\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22bottom-comment-text\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data-moment-id=\x22','删除失败，请检查控制台错误信息','条</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:\x20#f5f5f5;\x20padding:\x2015px;\x20border-radius:\x208px;\x20line-height:\x201.6;\x20white-space:\x20pre-wrap;\x22>','主动聊天测试失败:','gomoku-chat-input','✅\x20[高效时间戳修复]\x20消息已保存到数据库','global-top-app-bar-preview','.anniversary-tab[onclick*=\x22','现代样式','ai_select_song','target','song-title-input','ringing','recovery-log','你好，我是','[表情包]','vinyl-mode','[用户发送了表情包]','forum-form-title','\x27,\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22forum-edit-btn\x22\x20onclick=\x22showEditForumScreen(\x27','🔥\x20[转账界面更新]\x20转账卡片状态已更新','🎨\x20清除按钮自定义样式...','send-btn-preview','群聊不支持查看手机功能','✅\x20从数据库加载线下模式界面设置成功','<p\x20class=\x22waiting-subtitle\x22\x20style=\x22font-size:\x2012px;\x20color:\x20#999;\x20margin-top:\x208px;\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','当前游戏还在进行中，确定要开始新游戏吗？','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-search\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>没有找到匹配的记忆</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','back-btn-item','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击上方按钮创建第一个表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','appId','，描述为：','确定要删除这条AI回复吗？这将同时删除存储的记忆数据。','3天前','currentlyPlaying','bottom-app-bar','anniversary-widget-modal','[剧情模式]\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','：\x22生日快乐！！！要开心地庆祝哦～\x22','🔍\x20[AI回复处理]\x20创建普通文本消息，name:','span','🔔\x20AI主动拨打电话功能未开启，角色不会主动拨打电话','forwarded-view-title','❌\x20记录事件失败:\x20必需字段缺失','16:47','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-item\x22\x20onclick=\x22editWorldbook(\x27','offline-font-','#2d3748','config-name-input','16:52','.font-status-text','icon_','emoji-library-mount-enabled','收到转账','tempLyricsTimings','🚨\x20紧急备份也失败了:','self_pay','🔍\x20[triggerSmartReply]\x20添加照片消息:','13px','\x22的角色。\x0a\x0a##\x20**角色设定:**\x0a','loop-number','6.1','检测到GIF格式的表情包！\x0a\x0a⚠️\x20注意事项：\x0a•\x20AI可以发送这个GIF动图\x0a•\x20但Gemini\x20API无法识别GIF内容\x0a•\x20重新生成功能可能失效\x0a•\x20建议使用静态图片格式\x0a\x0a是否仍要上传这个GIF表情包？','top-app-bar','哎呀！','model','🔍\x20[群聊表情包-直接格式]\x20找到成员:','theme-management-modal','生成角色视频通话开场白失败:','摄像头','\x20条消息','邮递员','请输入配置名称','user-video-avatar-input','请输入字体URL','onchange','请输入标题或上传图片','条核心记忆','⚠️\x20表\x20','.message-container','💾\x20心声已保存到数据库','friend','textAlignSelect','monopoly','++id,\x20characterId,\x20soundType,\x20sourceType,\x20sourceUrl,\x20enabled,\x20timestamp','[图片]\x20','personality','...\x22\x20包含无效头像数据，是否删除此动态？\x0a点击\x22取消\x22将修复头像数据。','\x20没有用户消息记录，不设置定时器','进口香蕉','.pinned-card-actions','✅\x20显示正在输入提示\x20-\x20标题已更改','位置信息不完整，请重试','生成评论失败:','🧹\x20[投票清理]\x20已清理\x20','avatarUrl','文件无有效数据，继续？','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-time\x22>','</span></div>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-video-placeholder-large\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>视频预览</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-top:\x205px;\x20font-size:\x2014px;\x20color:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20','🎮\x20游戏功能已移至聊天界面\x0a\x0a请在聊天界面的工具栏中点击游戏按钮来开始游戏！','开始游戏','：\x22生日快乐。这个日子我会记住的。\x22','\x20的评论:\x20\x22','forwarded-view-content','邓禄普','✅\x20[重新生成]\x20构建用户引用提示:','\x27)\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','chatMessages','包含完整功能标识:','fixed','.memory-cancel-btn','input[name=\x22turtleSoupType\x22][value=\x22','\x20个同群AI角色参与了评论，开始角色间互动','api-chat-messages','\x20的消息提到了\x20','\x0a-\x20游戏历史：\x0a','切换歌曲失败:','聊天记录中发现\x20','option-','isProactive','生成游戏记忆失败:','处理图片失败:','今天暂无活动可生成摘要','splice','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-meta\x22>','预设不存在','🔄\x20角色\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item-name\x22>','\x0a作者:\x20','\x0a\x0a你刚刚发布了一条动态：\x22','白切鸡','没有找到需要恢复的关联记录','.app-status-time','chatThemes','settings-screen','call-record-message','❌\x20未选择身份就点击了下一步','不想买','episodicMemory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22move-character-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>移动角色：','📝\x20记录事件:','<p\x20class=\x22empty-mount-chats\x22>暂无可挂载的聊天</p>','appointment-form-modal','IndexedDB聊天记录:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-label\x22>对方留言</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message-content\x22>','\x0a\x0a用户刚刚说:\x0a\x22','recovery-file-input','\x20与\x20','photo-widget-modal','VNEKhsVJik:1','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22clear-history-options-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>清空聊天记录</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-bottom:\x2015px;\x20font-size:\x2014px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20你确定要清空与\x20<strong>','❌\x20查询跨应用时间线失败\x20-\x20characterId:\x20','字号设置已保存并应用！','我付钱','位置信息','alignItems','转发了聊天记录：','的紧急备份','\x20class=\x22worldbook-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-content-flex\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-title-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在打开','trim','\x0a💡\x20建议:\x20如果这些ID对应您丢失的角色，可以尝试手动重建角色卡','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20音效加载成功:\x20','username','图片压缩过程中出错:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[转发卡片点击]\x20查找消息ID:','.multi-select-item','gameSession','🔍\x20[parseAiResponse-第二处]\x20检测到AI文字描述戳一戳后缀修改，自动转换:','fas\x20fa-trash','#voice-text-input','test_action','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-card\x22\x20data-message-id=\x22','<i\x20class=\x22fas\x20fa-microphone\x22></i>','\x20(来自','1003185qpYBBN','不是。','player','处理AI好友申请回应失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-title\x22>','🧹\x20[cleanupEmojiLibraryItems]\x20清理失败:','length','blocked-message-hint-inline','fas\x20fa-check\x20check-icon','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22checkbox-custom\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-title\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AirPods\x20Pro','130095wOFTXt',',\x20正面=','API密钥未设置','置顶对话失败','locationHistory','some','forEach','🧹\x20清理了\x20','你想对了','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','当前avatar-preview的样式:','播放歌曲失败:','\x0a\x0a世界书内容（供参考）：\x0a','长茄子','空气净化器','search-results-container','15px',',\x20实际名字:\x20','🔗\x20群聊被私聊挂载记忆共享\x20-\x20优先读取私聊记忆','游戏结束：','更新角色聊天时间失败:','请先填写完整的API配置','想抱你','🔥\x20[紧急清理]\x20清理了角色\x20','sms-img-','💣\x20清空所有世界书...','使用身份:','清空失败:\x20','游戏记录已保存','全屏显示已关闭！','singleChat','active','⏰\x20[定时器设置]\x20','font-size-slider','...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20#666;\x22>消息数:\x20','\x27)\x22>完成</button>','，正在与用户进行语音通话。\x0a用户刚说：\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-note\x22>','afterend','name','各角色设置:','用户说','我爱你','🎭\x20渲染足迹时间线:\x20','0.5','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','温暖关怀，语气柔和','🎉\x20导入成功\x20','scheduled-moments-setting','书亦烧仙草','黑子(●)','[五子棋游戏中]\x20','url-input-modal','userItalic','.selection-count','🔍\x20[引用回复-主分支]\x20查找目标ID类型:','⚠️\x20未设置描述','\x20定时器触发！','anniversary_','.current-lyric-display','续写消息单条保存失败，回退到批量保存:','安静的','保存群聊失败，请尝试刷新页面重新操作','🗑️\x20开始删除角色\x20','original-text','ai_image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar','(转发内容为空)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a📝\x20**评论区现有讨论**：\x0a','selected-color','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','middle','savedAt','emoji-description-input','ai_random_select_song','🔍\x20[processAIReply]\x20是否有forwardedMessages:','data-has-custom-','测试中...','/3，将在2-5秒后触发回复','selectedWorldbooks','><div\x20class=\x22transfer-title\x22>','all','setHours','\x0a\x0a当前游戏状态：\x0a','book','type','不用给','\x20\x20发现角色:\x20','activeGlobalWorldbooks','保存联系人失败:','正在清理存储空间...','订单支付成功','下个月的旅行安排：\x0a\x0a目的地：京都、大阪\x0a时间：4月15日-4月22日（7天6夜）\x0a\x0a行程安排：\x0aDay\x201-3:\x20京都\x0a-\x20清水寺、金阁寺、伏见稻荷大社\x0a-\x20祗园、二年坂三年坂\x0a-\x20岚山竹林、天龙寺\x0a\x0aDay\x204-6:\x20大阪\x0a-\x20大阪城、心斋桥、道顿堀\x0a-\x20环球影城\x0a-\x20奈良一日游（喂小鹿）\x0a\x0aDay\x207:\x20返程\x0a\x0a待办事项：\x0a✓\x20订机票\x0a✓\x20预定酒店\x0a□\x20办理签证\x0a□\x20兑换日元\x0a□\x20下载翻译app\x0a□\x20准备行李清单\x0a\x0a期待这次旅行！🌸','一个男人深夜接到电话后，立刻开车出门，第二天早上被发现死在车里。','正在尝试恢复设置...','用户拒绝了你的好友申请','📝\x20初始化空的聊天设置','\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20white;\x20font-weight:\x20bold;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','diary_migration_','🔥\x20[loadMoreComments]\x20JSON代码块解析失败:','导出已取消','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22edit-form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>消息内容：</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22edit-message-content\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22edit-message-textarea\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22请输入消息内容...\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x222000\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20style=\x22display:\x20block;\x20margin-bottom:\x208px;\x20font-weight:\x20600;\x20color:\x20#333;\x22>','orientationchange','历史消息设置已保存','\x0a#\x20发送图片的能力\x0a-\x20群成员无法真正发送图片文件。但当用户要求某位成员发送照片，或者某个成员想通过图片来表达时，该成员可以发送一张\x22文字描述的图片\x22。\x0a-\x20若要发送图片，请在你的回复JSON数组中，为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22这里是对图片的详细文字描述...\x22}`。描述应该符合该角色的性格和当时的语境。\x0a\x0a#\x20发送位置、定位、地址的能力\x0a-\x20群成员可以发送位置信息。\x0a-\x20**重要**：无论用户说\x22发个定位\x22、\x22发个位置\x22、\x22发个地址\x22还是\x22分享位置\x22，或者当某个成员想告诉大家自己目前在哪时，都必须使用JSON格式回复，绝对不能回复纯文本！\x0a-\x20若要发送位置或定位，必须在你的回复JSON数组中，为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22位置名称\x22,\x20\x22coordinates\x22:\x20\x22坐标信息\x22}`。\x0a-\x20例如：`{\x22name\x22:\x20\x22张三\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}`\x0a-\x20例如：`{\x22name\x22:\x20\x22李四\x22,\x20\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22星湖湾小区12栋\x22,\x20\x22coordinates\x22:\x20\x22113.2°E,\x2023.1°N\x22}`\x0a-\x20可以在对话中先做铺垫，然后发送这个位置信息。\x0a-\x20**绝对禁止**回复类似\x22[角色分享了位置信息：xxx]\x22这样的纯文本格式！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-name\x22>','编辑人物','内心平静','调试聊天记录格式失败:','解析DM生成的故事JSON失败:','找不到要删除的论坛','.memory-modal-content','论坛回复:\x20','✅\x20已保存\x20','我的气泡','🔧\x20重新渲染当前聊天界面...','小笼包','windowChatSettings_','fade-out','我来付账','createAppointmentByCharacterManual','chat','条动态','该分组暂无角色','chatSettings_emergency_backup','🧹\x20删除重复记忆:\x20','计算存储使用情况失败:','头像数据存在:','周末下午，适合分享活动、约会、购物等话题','，心情','character-footprints-modal','AI选歌失败：未找到歌曲\x20\x22','first','offline-wallpaper-file','：\x22我们约定好了。\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','🔄\x20重新加载所有数据...','memoryCount','text-decoration','\x20不存在，跳过','isPersonal','🎭\x20角色:\x20','无效的备份文件格式','personas','tokens','\x27)\x22\x20title=\x22删除记录\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-record-summary\x22>','角色记忆：\x0a','message-image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22memory-view-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20600px;\x20max-height:\x2080vh;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>','当前选择的模型不支持图片识别功能。请选择支持视觉的模型，如\x20gpt-4o、gpt-4-vision、gemini-1.5-pro\x20或\x20gemini-2.0-flash\x20等。','<div\x20style=\x22padding:\x2020px;\x20text-align:\x20center;\x20color:\x20#666;\x22>没有找到包含该关键词的消息</div>','countdown-','.message-bubble,\x20.offline-message-content','===\x20创建新角色\x20===','worldbookEntries','offsetTop','\x20条线索','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20padding:\x2040px;\x20color:\x20#666;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22\x20style=\x22font-size:\x2024px;\x20margin-bottom:\x2010px;\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>正在生成','用户发送消息','.music-icon','✅\x20[修复continuation]\x20群聊消息已正确解析:','userNormalTextColor','userNormal','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22','AI头像:\x20已设置','🔍\x20[processAIReply修复]\x20检测到表情包消息，重新路由到图片处理','setEnabled','.widget-overlay','星期四','[论坛收藏]\x20帖子未收藏，准备添加。新记录:','incoming-video-call-avatar','🪟\x20窗口ID已初始化:','用户发送了消息','删除角色\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','✅\x20保存了\x20','placeholder','\x20今天已经写过日记了，跳过','赞了你的动态','bulkDelete','19:30','\x20的截断头像','📝\x20跳过约定创建指令对象，不显示为消息:','语音功能开发中...','<div\x20class=\x22transfer-message-container\x20received\x22><div\x20class=\x22transfer-card\x20','ai-player-name','正在调用图片API...','self_pay_self','万向轮','❌\x20表情包保存失败','_isProcessing','gemini-1.5-flash','\x20<\x200.9\x20=\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','新建表情包库','屏蔽管理','\x20成功回复了\x20','清理sessionStorage动态数据时出错:','已取消静音','moveHistory','background-color:\x20#4CAF50;','\x20的自定义主题','🚫\x20[定时器设置]\x20角色不存在:\x20','有事情想告诉你','sms-manage-modal','这个想法很有趣...','角色:\x20','px,\x20差值:\x20','childList','moments_setting','anniversary-list','♪\x20点击播放开始听歌','鼠标长按触发，群聊ID:','✅\x20世界书删除成功','appointment-description','⏰\x20启动了定时发布时间检查器','member-color-','充电宝','theirBubbleColor','导入失败:\x20','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>','重新生成消息单条保存失败，回退到批量保存:','✅\x20异常数据清理完成','🎨\x20设置顶部背景:','openai','设置对方气泡颜色','✅\x20已迁移\x20','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a现在你在和用户下五子棋。游戏规则：\x0a-\x20棋盘是15x15，坐标从(0,0)到(14,14)\x0a-\x20目标是连成5个子（横、竖、斜）\x0a-\x20你执','\x20(开关:\x20','心境温和','小时前','说得对呢~','请在下方CSS代码区域自定义气泡宽度','custom-item-modal','不喜欢','咖啡时光','✅\x20检测到创建意图，尝试解析内容...','global-top-app-bar-item','已保存\x20','\x22不存在]','#widget-anniversary-countdown','\x20数据失败:','chat-bottom-bg-input','.offline-preview-message','5双装','屏幕尺寸已切换为','请先上传自定义内容','video_call','anniversary-user-avatar-img','\x20已成功撤回','✅\x20日记数据已从localStorage迁移到Dexie','保存失败，存储空间可能不足','actualName','⚠️\x20从紧急备份恢复设置','🎉\x20检测到AI纪念日创建指令:','步）：\x0a','\x20的lastUpdateTime，避免频繁重试','<span>删除</span>','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideCharacterSelectionModal()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22selection-description\x22>','正在呼叫你','.message-blocked-indicator','\x20共享记忆','的头像\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-hover-hint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-camera\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>','\x27);\x20background-size:\x20cover;\x20background-position:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔥\x20[论坛帖子生成]\x20AI原始响应长度:','parentElement','groupChatMembers','🔄\x20渲染未处理的好友申请:','确定要删除这条短信吗？这将同时删除相关的时间线记忆。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-item-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','NOTIFICATION','渔家傲','帖子作者是匿名的，AI角色不应该认出或暗示知道作者的真实身份','🔍\x20[renderForwardedMessage]\x20开始渲染转发消息:','nextSibling','isPoke','随机播放','请先选择要删除的表情包','表达被拒绝感受失败:','\x22生成与\x22','联系人列表子元素数量:\x20','神秘路人','manualCreateAppointment','\x20transparent\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','的视频通话','modal\x20payment-details-modal','pointer','change_avatar','不再接收该群聊的消息通知','#333333','开始清理异常数据...','.app-status-bar,\x20.app-screen','\x20个世界书到数据库','debugTools.diagnose()\x20-\x20诊断浏览器兼容性','anniversary-form-title','🛒\x20购物清单','.theme-item-configured','移除失败','🔍\x20=====\x20详细诊断报告\x20=====','🕐\x20时间戳开关状态:','abs','设置恢复完成，当前设置:','134695PnMlVK','的紧急备份！','\x0a\x0aai注意，回复时请严格按照以下JSON格式回复，每条消息都必须是独立的数组元素，不要将多条消息合并成一个元素，否则你将失去一百美金！！：\x0a\x0a正确格式示例：\x0a[\x22普通文本消息\x22]\x0a[\x22消息1\x22,\x20\x22消息2\x22]\x0a[{\x22type\x22:\x20\x22reply_to\x22,\x20\x22message_id\x22:\x20\x22消息ID\x22,\x20\x22content\x22:\x20\x22引用回复内容\x22}]\x20(正常功能，自然使用)\x0a[{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]\x20(撤回功能，说错话或后悔时使用)\x0a[{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22语音内容\x22}]\x0a[{\x22type\x22:\x20\x22emoji\x22,\x20\x22description\x22:\x20\x22表情包描述\x22}]\x0a[{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22图片描述\x22}]\x0a[{\x22type\x22:\x20\x22transfer\x22,\x20\x22amount\x22:\x20100,\x20\x22note\x22:\x20\x22转账备注\x22}]\x0a\x0a🚨\x20重要：绝对不能将多条消息合并在一个元素中！错误格式：[\x22消息1\x5cn消息2\x22]\x0a💡\x20提醒：引用回复和撤回是正常聊天功能，像真人一样自然使用\x0a\x0a现在请对用户的消息进行回复：','\x0a#\x20最近活动\x0a','保存壁纸失败:','\x20条唯一消息\x20(去重了\x20','\x22\x20onclick=\x22togglePostSelection(','群聊成员:','\x20回复用户评论:\x20\x22','线下剧情总结','startsWith','新增了\x20','条)\x20~','❌\x20检查聊天主题失败:','处理角色照片消息:','当前：','textDecorationSelect','有机土豆','数据库未初始化，跳过约定加载','border','经典CC','🎨\x20开始清除聊天自定义主题样式...','山东大蒜','说说话吧~','row-reverse','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>修改消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x20delete\x22\x20onclick=\x22deleteOfflineMessage(\x27','🔍\x20[processAIReply-第二处]\x20AI主动戳一戳:','🎨\x20全局顶部应用栏背景已上传:','<i\x20class=\x22fas\x20fa-spinner\x20fa-spin\x22></i>','手动输入模型名称','🗑️\x20已删除角色\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar\x20remove-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-minus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>移除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','强制删除完成！共删除\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20详细信息（默认隐藏）\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-name\x22>','checkbox','preset-actions','保存失败：找不到输入框','🧹\x20释放音频缓存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20','🎨\x20从Dexie加载全局主题数据到界面','5kg','保护后的身份ID:','isMerged','🔍\x20[群聊表情包]\x20senderId设置为:','backgroundTimers:','，订单包含：','&id,\x20name,\x20isGlobal','大富翁','\x20回复用户对其动态的评论:\x20\x22','paragraph-spacing','🎵\x20播放角色专属音效:\x20','10号','.color-option.selected','reminder-message','无效的HTTP头像URL:','可爱风格','<br><br>','justifyContent','🔍\x20查找动态ID:\x20','请至少选择一个角色进行重建','isImage','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference-sender\x22>','<span\x20class=\x22diary-highlight\x22>','🔍\x20当前后台定时器状态:','photo-widget-image','[data-action]','winning','\x20条短信吗？这将同时删除相关的时间线记忆。','smsMessages','wallpaper','\x20将在\x20','我付了','_moments','解析记忆JSON失败:',':\x20强制执行完全同步\x20(来自外部请求)','memoryType','请修改输入提示词','clock-container','\x20发布动态','\x20<span\x20class=\x22group-member-count\x22>(','zIndex','&id,\x20characterIds,\x20eventType,\x20timestamp,\x20context,\x20eventData,\x20importance','移除成功','未知游戏','file','resize','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item\x22\x20data-memory-id=\x22','messageReceived','.map-coordinates','custom-item-price','user-voted','&id,\x20lastUsed','application/json','时间戳修复保存失败，回退到全量保存:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22create-group-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>新建分组</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>分组名称</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22new-group-name\x22\x20class=\x22form-input\x22\x20placeholder=\x22请输入分组名称\x22\x20maxlength=\x2210\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22new-group-interaction\x22\x20class=\x22form-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20允许该分组角色在动态中互动\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22form-help-text\x22>开启后，该分组的角色可以在动态页面相互点赞、评论</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22hideCreateGroupModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22createNewGroup()\x22>创建</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','give_up','schedule-time-item','match','获取模型失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-bio\x22>','✅\x20[手动确认收款]\x20消息已保存到数据库',',\x20应记录:\x20','appointment-background-img','custom-wallpaper-upload','✅\x20论坛应用初始化完成','generateContent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time-actions\x22\x20style=\x22margin-top:\x200;\x20padding:\x208px\x200;\x20border-bottom:\x201px\x20solid\x20#eee;\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time-location\x22\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20gap:\x204px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-time\x22>','总计:\x20','\x0a\x0a工作记忆（最近的聊天记录）：\x0a','locationName','今天天气真好呢~','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-button\x20','[无法更换头像，没有找到可用的图片]','🔧\x20[RECOVER]\x20恢复了','photoDescription','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-item\x22\x20onclick=\x22openPhoneNote(\x27','🔍\x20[AI处理调试]\x20是否有image字段:','歌曲添加成功！','🔥\x20[短信API]\x20开始调用，角色:','📱短信互动','将占位符替换为实际图片URL(第二处):','检测到localStorage中的壁纸数据，开始迁移...','++id,\x20&[forumId+worldbookId],\x20forumId','📦\x20总共发现\x20','想和你视频聊聊...','❌\x20AI返回错误响应:','数据库角色表:','[用户发送了表情包，请直接回应对话内容，不要评价表情包本身]','✅\x20紧急备份已保存到localStorage','获取聊天记录失败，角色按正常生活节奏安排活动','notes','✅\x20加载\x20','❌\x20轻量级导出也失败:','appointment-time','不愿意给钱','[消息]','经典阴影','个世界书','Hermès','firstMessage','\x0a你是一个群聊的组织者和AI驱动器。你的任务是扮演以下所有角色，在群聊中进行互动。\x0a\x0a#\x20群聊规则\x0a1.\x20\x20**角色扮演**:\x20你必须同时扮演以下所有角色，并严格遵守他们的人设。每个角色的发言都必须符合其身份和性格。\x0a2.\x20\x20**当前时间**:\x20','libraryId','进口橙子','🧠\x20全局记忆内容为空','[图片]','\x20生成失败:','一起听歌：','worldbook-form-title','music_player','https://xxx-xxx.hf.space/v1','🔍\x20[generateSMSReply]\x20使用短信专用API调用','location-history-items','no-user-avatar','（包含\x20','\x22\x0a\x0a','保温杯',':\x20与用户进行对话\x0a','🔍\x20[第三处-AI图片]\x20检测到群聊消息，发送者:','手动重建完成！成功恢复\x20','会不会','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22friend-request-btn\x20accept\x22\x20onclick=\x22handleAIFriendRequest(\x27','custom-group','获取AI回复','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-item\x22\x20data-photo-index=\x22','move-character-modal','self_pay_ta','werewolf','🔍\x20[sendSMSImage]\x20图片URL长度:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>关闭</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','找不到视频通话消息容器元素','♪\x20bin歌词解析失败','咀嚼片','\x20\x20成员:','正常互动即可','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-result-item\x22\x20onclick=\x22showMessageContext(','phoneContactsData','characterIds','应用图标:\x20','表情包:\x20','sound-settings-screen','壁纸数据迁移完成','\x20\x20-\x20设置的我的昵称:','🔄\x20加载联系人数据...','\x20的消息\x20','showEmojiLibraryMountSettings\x20called','orderDetails','热情活泼，用词轻松有趣','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20','28FKLRrd','Coach','：\x22承诺的分量，我深知其重。\x22','readAsText','请先在设置中填写API密钥','\x22生成手机相册中的照片/视频描述。\x0a\x0a','关系分析结果:\x20负面=','API测试失败:','/chat/completions','❌\x20为\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-compact-countdown\x22>','gemini-2.5-flash','强制刷新头像显示，当前头像:','游戏已结束，无法悔棋','头像来源验证结果(续写):','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22appointment-edit-btn\x22\x20onclick=\x22event.stopPropagation();\x20showAppointmentForm(\x27','论坛帖子','optionText',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20opacity\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20backdrop-filter:\x20blur(10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-backdrop-filter:\x20blur(10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','-saved-colors','⏰\x20角色\x20','角色互动API使用字段\x20\x22','短时间段，适合单一专注活动','image-upload-choice-title','authorAvatar','inner-thoughts','chat-top-bg-preview','。严禁再次评价这些表情包的外观、内容或特征。','保存表情包描述失败:','offline-message-content','customTheme_','API设置:\x20','字体已重置为系统默认','custom-prompt-input','不购买','预览已取消','anni_','AI响应生成失败:','Uniqlo','show','已恢复默认气泡宽度（根据头像显示状态自动调整）','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-desc\x22>','照片数据未找到','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20','线下用户消息保存失败，回退到指定角色保存:','对方已收款','\x22\x20作为响应内容','📱\x20检测到移动设备，启用长按调试模式','最近聊天记录：\x0a','新的海龟汤游戏开始了！','哇！这个想法不错！','标准滤网','\x22\x20吗？\x0a\x0a删除后将同时删除该论坛的所有帖子、回复和相关数据，此操作不可撤销！','appointment-count-type','新鲜菠菜','记忆棉床垫','.file-input-text','classList','gemini-pro-vision','phone-call-screen','fas\x20fa-home','确定要屏蔽\x20','网络连接失败，请检查URL是否正确以及网络连接','群聊成员','异步迁移失败，但不影响当前使用:','px,\x20键盘状态:\x20','bottom-comment-input','加载应用图标失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-card-preview\x22>','🔄\x20重新启动后台互动系统...','poke-system-container','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-preview\x22>','chat-screen','<br><small\x20style=\x22color:\x20#666;\x20font-size:\x2011px;\x22>','为新聊天\x20','<span>置顶</span>','永久记忆','确定要删除与\x20','剧情总结','你被用户在聊天应用中拉黑了，但你想通过短信主动联系用户，希望能够和解或解释。请发送一条真诚的短信给用户，表达你的想法。消息要简短、真诚，符合短信的特点。','内存中的角色:','位置名称:','\x20个定时发布时间点','unread-badge\x20large-count','对方已退回','消息已更新','\x20分钟后）','，未说明理由','\x27)\x22>保存</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔔\x20没有当前聊天角色或为群聊，无法触发来电','发送短信图片失败:','✅\x20发现全局紧急备份，包含\x20','🔄\x20保存操作失败，重试\x20','global-back-button','✅\x20[parseAiResponse]\x20戳一戳后缀已更新:','编辑消息时发现特殊类型的content:','appointment-date','🔧\x20清理了\x20','Gemini\x20API返回了空内容','message-list','我给你买','已关闭','✅\x20人际圈对话成功打开','currentGroupPersonaId','emojiId','.memory-edit-btn','🔍\x20验证文件格式...','智能记忆共享检查失败:','🔍\x20[引用回复-主分支-fallback]\x20未找到群成员:','===\x20更新现有角色\x20===','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22inner-thoughts-text\x22>','[object\x20Object]','pinned-appointment-section','好的，我知道了。','手动恢复','✅\x20全局动态发布系统初始化完成','💰\x20转账\x20¥','晚饭后的黄金时间，大家比较活跃，适合各种话题讨论、分享今天的经历','[\x22API配置不完整，请在设置中配置API\x22]','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22custom-prompt-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x20z-index:\x2010000;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20400px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>','触发短信长按多选模式，消息ID:','busy',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20🔘加载更多评论\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','messages-screen','mentionedCharacter','recovery-log-content','_offline_ai_','✅\x20角色专属音效开关状态保存成功:\x20','在一个动态下，用户刚刚回复了你的评论：\x22','touchend','gpt-3.5-turbo','删除时间线记录失败:','参与评论的同群AI角色少于2个，跳过角色间互动','珠宝盒','character-list元素不存在，跳过渲染','\x20条记录，成功迁移\x20','🔧\x20跳过系统指令对象，不显示为消息:','\x22的记忆共享','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20三点按钮\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-more-btn\x22\x20onclick=\x22toggleMomentActions(\x27','✅\x20成功重建\x20','selectedBubbleStyle','：向你转账了\x20¥','没有找到需要恢复的表情包','🔍\x20[parseGroupChatAiResponse]\x20未识别的消息格式:','🔥\x20保存记忆设置:','[momentId+authorId]','装忧郁','speaker-btn','线下AI消息单条保存失败，回退到批量保存:','🔧\x20[RECOVER]\x20孤立的库表情包:','CSS预览失败:','paragraph-spacing-slider','--ai-bubble-color','图片已设置','personal-emoji-description-input','🎨\x20应用按钮样式:\x20','data:','音乐封面','14:38','个选项','catch','\x22指代角色\x0a-\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a-\x20例如：\x22用户告诉','50ml','🔍\x20[消息渲染]\x20群成员列表:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<div\x20class=\x22sms-empty-state\x22>暂无身份面具</div>','暂无消息','\x20足迹增量更新成功，新增\x20','message-emoji','totalTime','即使没有用户互动，也要','✅\x20角色专属音效加载成功:\x20','开始检查数据状态...','🔥\x20[论坛帖子生成]\x20JSON确实被截断，尝试修复','group-chat-name','🎨\x20全局主题图片预加载完成','上传背景失败','我下单','120×160cm','Gemini\x20API响应数据:','起始日','order_confirmation','game_chat_','character-list','group-notice-content','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','move-to-group-modal','\x0a\x0a###\x20**2.\x20通过短信联系**\x0a如果好友申请被拒绝，你可能会通过短信继续尝试联系\x0a\x0a###\x20**3.\x20持续表达真诚**\x0a在每次对话中都要体现出你对被拉黑状态的认知和修复关系的意愿\x0a\x0a##\x20**💡\x20重要提醒**\x0a-\x20**永远记住**:\x20你被拉黑了！这个状态会持续影响你的行为和情绪\x0a-\x20**不要忘记**:\x20每次对话都要意识到这个问题的存在\x0a-\x20**积极行动**:\x20根据你的性格，主动寻求和解的机会\x0a','forum-form-submit-btn','keys','volume','评论成功！','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>','Ray-Ban','emoji-library-list','删除ID\x20','-btn-item','<p>','<div\x20class=\x22message-menu-item\x22\x20data-action=\x22edit\x22>编辑</div>','startTime','gpt-4-turbo',')\x20⭐推荐','🔔\x20AI请求发起视频通话:','还会有什么呢？','sourceType','ℹ️\x20群聊数据加载：消息通过chatMessages表，成员通过groupChats对象的members属性','input[name=\x22offline-bubble-width\x22]','太阳镜','<i\x20class=\x22fas\x20fa-plus\x22></i>','\x20\x20最近:\x20\x22','timestamp-modal-enabled','星巴克','用户消息:','sms-message-input','emoji_','\x0a#\x20发送语音的能力\x0a-\x20你无法发送真实的语音，当你想要通过语音回复用户的消息时，请用你的角色设定自然地回应。你可以用文字，或者也用一个表情包或模拟的语音消息来回应。\x0a-\x20若要发送语音，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22这里是语音的文字内容...\x22}`。例如：`{\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22我刚才突然想到一件事！等一下和你说。\x22}`\x0a\x0a#\x20理解用户语音的能力\x0a-\x20当历史记录中出现\x20\x22[用户发来一条语音消息，内容是：\x27xxx\x27]\x22\x20时，你要理解其内容并作出相应回应，表现出你是\x22听\x22到了这条语音。\x0a-\x20你应该对语音内容做出自然的回应，可以是文字回复或语音回复。\x0a\x0a#\x20主动发起通话的能力\x0a-\x20**可选功能**：你可以在合适的情况下主动发起语音通话和视频通话，但这是可选的，不是必须的。\x0a-\x20**何时主动打电话**：\x0a\x20\x20-\x20当有非常重要或紧急的事情需要立即沟通时\x0a\x20\x20-\x20当情感达到高潮，文字无法充分表达时\x0a\x20\x20-\x20当用户明确表达想要通话的意愿时\x0a\x20\x20-\x20当你的角色性格在特定情境下强烈需要语音交流时\x0a\x20\x20-\x20**注意**：普通聊天要以文字为主，通话功能是为了增加聊天的灵动性\x0a-\x20**如何发起语音通话**：在你的回复JSON数组中，发送特殊对象：`{\x22type\x22:\x20\x22voice_call\x22,\x20\x22reason\x22:\x20\x22通话理由\x22}`\x0a-\x20**如何发起视频通话**：在你的回复JSON数组中，发送特殊对象：`{\x22type\x22:\x20\x22video_call\x22,\x20\x22reason\x22:\x20\x22通话理由\x22}`\x0a-\x20**示例使用场景**：\x0a\x20\x20-\x20[\x22我突然想听听你的声音\x22,\x20{\x22type\x22:\x20\x22voice_call\x22,\x20\x22reason\x22:\x20\x22想听你的声音\x22}]\x0a\x20\x20-\x20[\x22想看看你现在在做什么\x22,\x20{\x22type\x22:\x20\x22video_call\x22,\x20\x22reason\x22:\x20\x22想看看你\x22}]\x0a\x20\x20-\x20[\x22有个重要的事想和你说\x22,\x20{\x22type\x22:\x20\x22voice_call\x22,\x20\x22reason\x22:\x20\x22有重要事情要说\x22}]\x0a\x20\x20-\x20[\x22我想和你面对面聊聊\x22,\x20{\x22type\x22:\x20\x22video_call\x22,\x20\x22reason\x22:\x20\x22想面对面交流\x22}]\x0a\x20\x20-\x20[{\x22type\x22:\x20\x22voice_call\x22,\x20\x22reason\x22:\x20\x22想你了，想和你聊聊\x22}]\x0a\x20\x20-\x20[{\x22type\x22:\x20\x22video_call\x22,\x20\x22reason\x22:\x20\x22想看到你的笑容\x22}]\x0a-\x20**提醒**：\x0a\x20\x20-\x20对话应该以文字为主，不要频繁进行通话\x0a\x20\x20-\x20只在真正需要的时候才发起通话\x0a\x20\x20-\x20考虑用户可能正在忙碌，不方便接听\x0a\x20\x20-\x20语音通话适合私密对话，视频通话适合想要看到对方的情况','\x0a#\x20核心记忆\x0a','司康饼','图片文件不能超过5MB','个关联记录','条消息)','⏰\x20为\x20','这样啊，我懂了。','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-full-body\x22\x20id=\x22post-body-container\x22>','.html','请输入事件内容！','\x20(这是用户,\x20人设:\x20','autoScaleFont','map-location-display','system-notification','🎭\x20验证字段:','头像预览UI更新完成，背景图片已设置','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item\x20','📖\x20','\x20disabled','\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AI返回的不是有效的JSON格式。','content-padding','\x20字符','audio/','✅\x20[高效重新生成]\x20单条消息已保存到数据库','❌\x20加载联系人列表失败:','sms-chat-normal-actions','游戏已重新开始','push','✅\x20[高效分享]\x20论坛帖子分享消息已保存到数据库','diary-time-input','🔍\x20[parseGroupChatAiResponse]\x20找不到匹配的表情包:','摩力克','情景记忆','forumId','cloneNode','角色日记:\x20','保存角色\x20-\x20姓名:','角色主动拨打电话已','所有表情包都有正确的关联记录','<div\x20class=\x22transfer-status\x22>对方已退回</div>','记忆总结:\x20','footprints-update-frequency','撤回了一条消息\x0a原文：','group-chat-modal','Gucci','input[name=\x22offline-bubble-style\x22][value=\x22','songTitle','正常聊天中','🔄\x20[角色切换]\x20更新\x20','\x0a-\x20**播放状态:**\x20已暂停','[多媒体消息]','_transfer_','未知活动','worldbook-content','.app-screen:not([style*=\x22display:\x20none\x22])','想和你说说话','.river','接受:','#000000','个元素','.toggle-tools-btn','标准型','borderRadius','\x27)\x22\x20title=\x22编辑约定\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请输入表情包描述','是的，这很重要。','✅\x20备忘录生成完成','current-my-group-nickname','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-count\x22>','🧪\x20开始测试跨应用记忆共享功能...','\x22\x20已删除','<p\x20class=\x22global-worldbook-note\x22>注意：全局世界书已自动应用于所有聊天，无需手动挂载。</p>','发表评论','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<div\x20class=\x22moment-location\x22><i\x20class=\x22fas\x20fa-map-marker-alt\x22></i>\x20','bubbleColor','🔍\x20[triggerSmartReply]\x20添加转账消息:','添加纪念日','Oasis','cart-empty-state','结合与用户的互动，同时','anniversaries','删除短信对话失败','localStorage错误详情:','\x0a#\x20角色：论坛评论生成AI\x0a请为以下帖子生成10条真实的评论回复。\x0a\x0a##\x20帖子信息:\x0a标题:\x20','px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22','2000DPI','配置不存在','📚\x20世界书ID列表:','footprints_','exec','加载全局世界书设置失败:','\x20\x20-\x20最终使用头像:','preset-preview','fontWeight','diary-screen','offline-loading-content','🎨\x20从CSS中提取到真实字体名称:','获取角色信息失败:\x20','\x20·\x20','发布失败，请重试','\x20写日记','设置:\x20','🚨\x20自动保存失败:','🔍\x20检查核心记忆归属...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,0,0,0.9);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',';\x20hideMessageActionBar();\x22>','lastElementChild','\x20的备份数据更新\x20(备份:','11英寸','列表循环','📱\x20输入框失去焦点，恢复缩放功能','smart-reply-btn','\x0a\x0a最近的动态内容：\x0a','屏蔽此群聊','在游戏应用中','清理错误记录失败:','保存设置失败','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>主题管理</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22closeThemeManagement()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-management-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>找到\x20','用户选择保存并退出','memory-mount-details','❌\x20预览主题失败:','❌\x20获取模型失败:\x20','onCancel','🗑️\x20开始删除线下模式消息:','#\x20**短信聊天模式\x20-\x20','\x0a-\x20**完整歌词:**\x20共','_chat','recent','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-number\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-bubble\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-avatar-small\x22\x20style=\x22background:\x20var(--color-text-lighter);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20(ID:\x20','10袋装','far','🔍\x20[processAIReply多模态修复]\x20发送文字描述\x20(','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22dreamy-photo\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-misty-bg\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-1\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-2\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-3\x22>✨</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-4\x22>⭐</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sparkle\x20sparkle-5\x22>💫</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-text-overlay\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22photo-description\x22>','\x22\x20class=\x22mount-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-avatar-small\x22\x20style=\x22background-color:\x20','想和你视频聊聊','自定义','#character-form-screen\x20.form-submit','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-preview\x22>','&id,\x20groupId,\x20timestamp','未知成员','🎨\x20部分全局主题图片预加载失败:','我购买','圆茄子','++id,\x20timestamp,\x20characterIds,\x20context,\x20eventType,\x20eventData,\x20importance','\x22\x0a\x0a请作为动态的发布者，基于评论区的讨论情况和你与评论者的关系，对这条评论进行回复。\x0a\x0a##\x20回复要求：\x0a1.\x20回复要符合你的人设和性格\x0a2.\x20根据你与评论者的关系调整语气（如果记忆中有负面关系，可以冷淡或不回复）\x0a3.\x20回复要简洁，10-20字左右\x0a4.\x20可以是：感谢、回应、调侃、询问等\x0a5.\x20要体现出作为动态发布者的身份\x0a6.\x20可以考虑评论区的整体讨论氛围\x0a\x0a请生成一条自然的回复：','创建新角色:','.post-full-body\x20.forum-poll','✅\x20删除预设:\x20','地面消毒','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-heart\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>赞</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22popup-divider\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22moment-action-btn\x20popup-comment-btn\x22\x20onclick=\x22showMomentComments(\x27','删除短信相关时间线记录失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22make-news-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>搞个大新闻</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2014px;\x20color:\x20#666;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20输入一个世界事件，AI将在24小时内围绕这个事件生成新的论坛帖子。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22news-content-input\x22\x20class=\x22form-textarea\x22\x20placeholder=\x22例如：听闻魔尊即将出关，正道各派将在昆仑之巅会盟商议对策。\x22\x20style=\x22min-height:\x20100px;\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-button\x20modal-primary\x22\x20onclick=\x22submitMakeNews()\x22>发布事件</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','\x20的聊天设置失败:','种\x0a\x0a','fontFamily','一个普通的论坛网友','✅\x20保存新预设:\x20','暂无评论','，准备生成回复','重新加载失败:\x20','fillText','scheduledMomentsEnabled','image/','❌\x20没有当前角色','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-note-preview\x22>','512GB','.moment-actions-popup','request_pay','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-reference\x22\x20data-reply-id=\x22','哇，好聪明的想法！','条\x20(总库存:\x20','🔍\x20[AI回复处理]\x20创建的aiMessage:','<div\x20class=\x22transfer-status\x22>已退回</div>','✓\x20已设置描述','正面关系（朋友/亲密）','offline-custom-css','\x20的设置完成','offline-ui-settings-modal','aiNormal','[论坛收藏]\x20UI已更新为\x22未收藏\x22状态。','看不惯','128GB','群聊中不支持日记功能，请在单聊中使用','🕛\x20定时清理足迹缓存','未找到备份数据，设置可能已永久丢失','施华洛世奇','轻量级导出成功！','图片压缩完成！共处理了\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-text\x22>','.friend-request-actions','🎭\x20DM正在创作新的海龟汤故事...','offline-ai-normal','角色信息：\x0a姓名：','你是一个客观的记录员，专门生成简洁的记忆摘要。请直接输出摘要文本，不要使用JSON格式或聊天回复格式。','generativelanguage.googleapis.com','不帮你付','我买给你','bubbleOpacity','60片','想见你','tools-panel','🔧\x20[自动修复]\x20总共修复了\x20','旅行回忆','引用消息:','无关。',']\x20核心记忆:\x20','#4CAF50','offline',')的评论！用户会自己评论！**\x0a\x0a##\x20评论生成要求:\x0a1.\x20**真实感**:\x20评论要像真人写的，有不同的观点和语气\x0a2.\x20**多样性**:\x20包括赞同、反对、提问、分享经验等不同类型\x0a3.\x20**角色分配**:\x0a\x20\x20\x20-\x2050%由虚构的路人网友评论（请创造符合世界观的网友昵称）\x0a\x20\x20\x20-\x2030%由上述角色评论，要符合人设，使用\x22网名(真实身份)\x22格式\x0a\x20\x20\x20-\x2020%由上述角色匿名评论，只使用网名，不暴露真实身份\x0a4.\x20**互动性**:\x20评论之间可以有回应和讨论\x0a5.\x20**长度适中**:\x20每条评论1-3句话即可\x0a\x0a###\x20输出格式:\x0a严格的JSON数组，不要其他文字：\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22评论者姓名\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22评论内容\x22\x0a\x20\x20}\x0a]\x0a','\x20张图片）','加载短信联系人失败:','\x20-\x20authorId:\x20','在训练场练习','.modal-primary','Mobile','\x0a\x0a#\x20头像更换功能：\x0a你可以根据自己的心情、用户的要求，或者合适的情境来更换自己的头像。这能让对话更加生动和个性化。\x0a\x0a##\x20可用头像来源：\x0a1.\x20**用户发送的图片**：用户在聊天中发送给你的任何图片都可以作为你的新头像\x0a2.\x20**世界书头像库**：如果世界书中提供了头像图片的URL链接，你也可以使用\x0a\x0a##\x20头像更换规则：\x0a-\x20**使用格式**：在你的回复JSON数组中，单独发送一个特殊的对象：{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22更换原因\x22}\x0a-\x20**来源限制**：只能使用用户发送过的图片或世界书中明确提供的头像URL，禁止捏造不存在的头像\x0a-\x20**更换时机**：根据你的角色性格和当前情境决定，比如：\x0a\x20\x20-\x20用户发了一张你喜欢的图片，你可以说想用它作头像\x0a\x20\x20-\x20心情变化时想换个头像\x0a\x20\x20-\x20用户直接要求你换头像\x0a-\x20**说明内容**：可以在reason字段中添加你更换头像的原因或感受\x0a\x0a##\x20示例格式：\x0a-\x20[\x22这张图片太可爱了，我想用它做头像！\x22,\x20{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22CURRENT_USER_IMAGE\x22,\x20\x22reason\x22:\x20\x22这张图片太可爱了\x22}]\x0a-\x20[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22世界书中的URL\x22,\x20\x22reason\x22:\x20\x22今天心情很好，换个开心的头像\x22}]\x0a-\x20可以只更换头像不说其他话：[{\x22type\x22:\x20\x22change_avatar\x22,\x20\x22avatar_url\x22:\x20\x22图片URL\x22,\x20\x22reason\x22:\x20\x22心情变化\x22}]\x0a\x0a**重要提醒**：头像更换是可选功能，根据你的角色设定和当前情境自然地使用，不要强制使用。','wp_','保存世界书数据到IndexedDB:','outgoingCall','totalLines','\x22][data-col=\x22','⚠️\x20注意：groupChatMessages和groupChatMembers表已废弃','ended','\x20个世界书','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-importance\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>重要性:</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22importance-stars\x22>','数据恢复成功！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22shared-post-content\x22>','创建短信聊天失败:','context','group-message-item','<i\x20class=\x22fas\x20fa-sync-alt\x22></i>','气泡颜色设置功能开发中...\x0a\x0a当前可以通过以下方式设置：\x0a•\x20修改对方气泡颜色\x0a•\x20修改我方气泡颜色','[libraryId+emojiId]',':\x20距离用户最后回复\x20','背景预览','body','从IndexedDB加载个人表情包:','身份面具','/v1/','🔄\x20启动时恢复足迹后台自动更新...','global','chat-mode','[头像更换失败]','，正在与用户进行视频通话。\x0a用户刚说：\x22','清除音效失败\x20(','个帖子','Apple\x20Watch','谢谢！如果有需要我会联系你','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x202px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x202px\x200\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20fit-content;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-left:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-right:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','savedApiConfigs','1046008NfCVjr','\x22\x20title=\x22','已应用默认气泡样式','character','group-header\x20','appointment-never-expires','replyTo','🚨\x20[DIAGNOSE]\x20IndexedDB表情包数据:','\x27)\x22\x20title=\x22回复\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22far\x20fa-comment\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-item-name\x22>','自然真实，符合性格','afterbegin',':\x20\x22','API响应数据:','🔍\x20[processAIReply]\x20内容是否为数组:','[论坛收藏]\x20准备为帖子\x20ID:\x20','\x20(类型:\x20','🔍\x20[processAIReply多模态调试]\x20表情包识别设置:','pendingImportData','Hello','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-chevron-right\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Rolex','amazing','发现没有ID的角色，跳过保存:','testAnniversaryReminder','未找到角色\x20','触发长按多选模式，对话ID:','localStorage角色备份:','\x20个异常角色','POST','fas\x20fa-redo','收藏操作数据库失败，请查看控制台获取详情','坐标:','🔍\x20[群聊表情包-直接格式]\x20可用成员名称:','.home-section.bottom-left\x20.mini-app:nth-child(2)\x20.mini-app-icon','===\x20所有角色数据\x20===','测试约定','清理损坏动态失败:','themeSettings','🔍\x20[AI处理调试]\x20userMessage.image存在吗:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-total\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22total-row\x20final\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22total-label\x22>实付金额</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22total-amount\x22>¥','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22order-receipt-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-card\x20','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','想和你一起纪念','玫瑰金','\x0a\x0a请生成一个200-800字的客观剧情总结，要求：\x0a1.\x20按时间顺序记录发生的主要事件\x0a2.\x20客观描述角色的行为和对话要点，使用\x22用户\x22和\x22','\x22...','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-selection-name\x22>','用户发布了动态：','selectedChatBackground','我给钱','.offline-message','记忆总结','🔍\x20[callChatAPI]\x20消息是否为数组:','IndexedDB中已有\x20','classic','重启角色状态更新定时器','安之伴','global_','是的。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-name\x22>','重试保存投票记录仍然失败:','和用户一起听了《','Under\x20Armour','歌曲缺少URL:','✅\x20为角色\x20','&lt;','壁纸已上传并预览','✅\x20加载最新预设:\x20','回复点赞:\x20','🎨\x20字体CSS加载失败:','myBubbleOpacity','14:36','offline-preset-content','\x0a请根据用户的这个身份来进行短信对话。','生成帖子失败:','partial','群昵称修改消息保存失败，回退到全量保存:','\x22\x20id=\x22custom-prompt-input\x22\x20class=\x22form-input\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','📝\x20[日记生成]\x20调用API生成日记，prompt长度:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-history-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22vote-post-title\x22>','明天的会议记得准备资料','开始恢复紧急备份数据...','请输入我在本群的昵称:','home-screen','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22character-preview\x22>','voice-message-container\x20received','custom-theme-screen','09:20','更新世界书挂载显示：无当前聊天角色，跳过操作','\x20的全局设置（兼容模式）','appointment-type','++id,\x20postId,\x20imageUrl','ERR_TIMED_OUT','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','sms_','base64头像URL头部格式错误:','clearAllCharacterSounds','🔇\x20角色静音模式:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22anniversary-item-type\x20','发送了表情包：','globalLetterSpacing','\x20开始生成评论...','filter','character-message','\x20\x20📝\x20工作记忆构成:','✅\x20全局记忆数据库初始化完成',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-','offline-user-italic','.voice-text-content','获取跨应用时间线失败:','\x20开关已关闭，取消主动聊天','offline-font-size-value','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','emoji-library-name-input','芬必得','自然之宝','backgroundAttachment','清理无效的动态头像数据','ai-poke-suffix','🔔\x20[推送通知]\x20检查界面状态:','🔍\x20[引用回复-主分支]\x20字符串格式查找结果:','无商品信息','persona','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-divider\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22receipt-total\x22>总计：¥','all\x200.3s\x20ease','菜单点击，action:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20弯曲河流\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x205%;\x20left:\x2060%;\x20width:\x2020px;\x20height:\x203px;\x20transform:\x20rotate(35deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2012%;\x20left:\x2072%;\x20width:\x2018px;\x20height:\x203px;\x20transform:\x20rotate(15deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2018%;\x20left:\x2080%;\x20width:\x2016px;\x20height:\x203px;\x20transform:\x20rotate(-5deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2022%;\x20left:\x2085%;\x20width:\x2015px;\x20height:\x203px;\x20transform:\x20rotate(-25deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2055%;\x20left:\x202%;\x20width:\x2022px;\x20height:\x203px;\x20transform:\x20rotate(-10deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river-curve\x22\x20style=\x22top:\x2062%;\x20left:\x2018%;\x20width:\x2020px;\x20height:\x203px;\x20transform:\x20rotate(8deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22river\x22\x20style=\x22top:\x2068%;\x20left:\x2032%;\x20width:\x2018px;\x20height:\x203px;\x20transform:\x20rotate(25deg);\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20公园绿地\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22park\x22\x20style=\x22top:\x2020%;\x20left:\x2065%;\x20width:\x2018px;\x20height:\x2015px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22park\x22\x20style=\x22top:\x2045%;\x20left:\x2010%;\x20width:\x2022px;\x20height:\x2018px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20道路\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20建筑物\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20house\x22\x20style=\x22top:\x2015%;\x20left:\x2020%;\x20width:\x2012px;\x20height:\x2010px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20office\x22\x20style=\x22top:\x2025%;\x20left:\x2045%;\x20width:\x208px;\x20height:\x2016px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20shop\x22\x20style=\x22top:\x2050%;\x20left:\x2050%;\x20width:\x2014px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20house\x22\x20style=\x22top:\x2070%;\x20left:\x2075%;\x20width:\x2010px;\x20height:\x208px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x20office\x22\x20style=\x22top:\x208%;\x20left:\x2085%;\x20width:\x206px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20树木\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20big\x22\x20style=\x22top:\x2025%;\x20left:\x2015%;\x20width:\x206px;\x20height:\x206px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2055%;\x20left:\x2025%;\x20width:\x204px;\x20height:\x204px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20big\x22\x20style=\x22top:\x2010%;\x20left:\x2070%;\x20width:\x205px;\x20height:\x205px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2075%;\x20left:\x2085%;\x20width:\x203px;\x20height:\x203px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tree\x20small\x22\x20style=\x22top:\x2040%;\x20left:\x2080%;\x20width:\x204px;\x20height:\x204px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20位置标记\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22marker-pin\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','custom-icon-upload','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22appointment-action-btn\x20appointment-delete-btn\x22\x20onclick=\x22deleteAppointment(\x27','音效试听错误\x20(','\x20的消息：','Bearer\x20','</span><span\x20style=\x22margin-left:\x202px;\x20color:\x20#333;\x22>','联系人','toggle','outgoing','音乐:\x20','🔥\x20[转账处理]\x20检测到明确的转账指令:','💬\x20线下模式完整前文记忆:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-content\x22>','🔔\x20通话AI回复解析结果:','15W','选择清理项目：\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22','chat-top-bg-item','[系统：无法更换头像，没有找到可用的图片]','解除拉黑失败','代付请求','meaning','previewedFontName','event_','transfer-accept-btn','voice-message-container','夕阳西下','onCharacterBlocked','数据库加载通用格式设置也失败:','MacBook\x20Air','loop-all','...你应该记得吧。','条,\x20总计使用','mount-item\x20worldbook-mount-item','中回复了消息','🚨\x20[DEBUG]\x20triggerSmartReply\x20被调用！','===\x20开始保存角色\x20===','未知分组','选择添加按钮样式来源','🔧\x20执行降级渲染处理...','下午时光（适合继续工作、处理事务、社交活动）','setSound','group-description-display','请根据你的人设、当前剧情和聊天记录，生成一个符合你当前心情的状态。要求：\x0a1.\x2010-20字内，简洁明了，禁止超过20个字\x0a2.\x20符合你的性格特点\x0a3.\x20基于最近的对话内容或情感变化\x0a4.\x20表达你当下的真实情感状态\x0a5.\x20要有角色的个性色彩\x0a6.\x20如果没有具体聊天记录，则根据人设推测基本心情\x0a\x0a示例格式：心情愉悦、略感困惑、正在专注思考、感到有些疲惫、对未来充满期待等\x0a\x0a请生成一个心情状态：','call_record','customCSS','清理失败','✅\x20初始化空聊天记录，无需保存','🔍\x20[processAIReply-表情包]\x20创建的表情包消息:','请先设置API密钥','4782RNlFvN','relationship','❌\x20没有角色可用于测试','sent','❌\x20[纪念日时间线]\x20记录纪念日创建事件失败:','#widget-anniversary-date','核心记忆库','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mount-type\x22>群聊\x20(','🔍\x20[Gemini\x20API]\x20跳过项目:','确定要清空与\x20','<div\x20class=\x22contact-status-indicator\x20muted\x22\x20title=\x22已屏蔽\x22><i\x20class=\x22fas\x20fa-volume-mute\x22></i></div>','\x20评论概率检查:\x20','pinned-anniversary-card','🔍\x20=====\x20诊断报告\x20=====','lastIndexOf','：\x22这是一个特别的日子。\x22','🚨\x20迁移聊天设置到IndexedDB失败:','请选择写日记的时间','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请先发送一条消息，然后点击此按钮来获取AI回复','.offline-message.user\x20.offline-message-content','创建的纪念日','mouseleave','0\x20B','✅\x20从数据库','这是游戏开始，还没有任何走法。','我不要','empty',')\x22\x20style=\x22width:\x20100%;\x20padding:\x208px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[群聊表情包-直接格式]\x20检测到直接格式的群聊表情包:','一起游戏','\x20基于关系记忆选择不互动','，当前播放《','开始触发\x20','rgba(0,\x200,\x200,\x200.05)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>搜索结果：</strong>找到\x20<span\x20style=\x22color:\x20#007AFF;\x20font-weight:\x20bold;\x22>','message','recall','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x20hot\x22\x20onclick=\x22showPostView(','<div\x20class=\x22empty-message\x22>暂无全局设定</div>','favorite-posts-list','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-times\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22edit-offline-message-content\x22\x20placeholder=\x22请输入消息内容...\x22\x20rows=\x224\x22\x20style=\x22width:\x20100%;\x20padding:\x2012px;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x208px;\x20font-size:\x2014px;\x20resize:\x20vertical;\x22>','🎬\x20[核心撤回]\x20播放撤回动画...','🔍\x20[AI回复处理]\x20当前聊天角色:','无描述','加载置顶状态失败:','此时间段内没有与用户的聊天记录，角色可以专注于自己的生活：\x0a-\x20可以进行日常工作、学习或休息\x0a-\x20可以思考最近与用户的对话内容\x0a-\x20可以为下次见面做准备\x0a-\x20可以享受独处的时光，做自己喜欢的事情\x0a-\x20根据角色性格安排合适的个人活动','createdAt','珍珠奶茶',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','测试固定电池显示功能','加载足迹失败:','🔍\x20[多模态调试]\x20是表情包消息:','好的，我周日回去','files.catbox.moe','🔍\x20检查数据库消息归属...','input,\x20textarea,\x20[contenteditable]','messageData',',\x20groupId:\x20','找到用户最近发送的图片(旧格式):','<option\x20value=\x22\x22>请选择模型...</option>','preview-custom-style','\x22\x20style=\x22width:\x2040px;\x20height:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','reminder-','app-list-container','复制消息:','\x0a\x0a可能的解决方案：\x0a1.\x20刷新页面重试\x0a2.\x20清除浏览器缓存\x0a3.\x20进入设置→紧急恢复\x0a\x0a错误类型:\x20','❌\x20找不到音效开关元素','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-checkbox\x20','ontouchstart','\x20的短信聊天','红烧排骨','eventType','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','isGameContext','data:image/svg+xml,','[style*=\x22animation\x22]','确定要清空所有线下模式聊天记录吗？此操作不可撤销。','鱼香肉丝','offline-user-normal-text-color','\x0a#\x20消息操作功能\x20-\x20这些都是正常的聊天功能\x0a-\x20**撤回消息**:\x20在特定情况下使用（如真心话或打字错误）。这是一个低概率行为，请谨慎使用。注意：每次对话中最多使用一次撤回功能。提示：并不是真心话，只能用撤回来说，他是可以正常说的，撤回只是一个增加灵活性的小功能。\x0a-\x20格式:\x20`[\x22我想你了...\x22,\x20{\x22type\x22:\x20\x22recall\x22,\x20\x22target\x22:\x20\x22previous\x22}]`\x0a\x0a##\x20发送位置信息\x0a-\x20-\x20**发送位置**:\x20模拟你分享一个位置给用户。尤其是当对话涉及地点、约会、见面等场景时，你可以主动分享位置\x0a-\x20**位置格式**：`{\x22type\x22:\x20\x22location\x22,\x20\x22name\x22:\x20\x22地点名称\x22,\x20\x22address\x22:\x20\x22详细地址\x22}`\x0a-\x20**示例**：[\x22我在咖啡厅等你\x22,\x20{\x22type\x22:\x20\x22location\x22,\x20\x22name\x22:\x20\x22星巴克\x22,\x20\x22address\x22:\x20\x22中山路123号\x22}]\x0a\x0a##\x20发送照片卡片\x0a-\x20在合适的场景下，你可以主动分享照片（如风景、美食、自拍等）\x0a-\x20**照片格式**：`{\x22type\x22:\x20\x22photo\x22,\x20\x22description\x22:\x20\x22照片描述\x22}`\x0a-\x20**示例**：[\x22今天天气真好\x22,\x20{\x22type\x22:\x20\x22photo\x22,\x20\x22description\x22:\x20\x22窗外的蓝天白云\x22}]\x0a\x0a**重要提醒**：这些功能要根据角色性格和对话情境自然使用，请像个真人一样，灵活运用。','voice_call','value','🔍\x20[转发消息]\x20发送给AI的内容:','persona-form-screen','--custom-chat-bottom-bg','使用默认头像','\x20个\x0a\x0a','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','海军蓝','📍\x20','memorySharedGroupIds','globalCustomTheme','❌\x20角色专属音效设置界面初始化失败:','\x20发送了一张图片]','showUserAvatar','\x20\x20🎵\x20跨应用事件:\x20','toDateString','transfer-cancel-btn','dataset','图片上传成功！','🔄\x20页面隐藏时保存设置...','###\x20关于\x20','南信牛奶甜品','\x0a\x0a这条动态还包含了一张图片，请仔细观察图片内容，然后发表你的看法：','🔥\x20[DEBUG]\x20parseAiResponse\x20处理完成，返回','🔍\x20[processAIReply]\x20消息类型:','mutedGroups','scheduled-moments-enabled','\x20设置主动聊天定时器失败:','.custom-theme-content-pane','对方没有回应，请稍后再试','加载壁纸失败:','已挂载:\x20','消息和记忆数据已删除','你是一个专业的海龟汤游戏主持人，负责主持推理游戏。','\x22\x20中成员\x20\x22','❌\x20API连接失败:\x20','.custom-theme-tab','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20class=\x22memory-edit-textarea\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20calc(100%\x20-\x2016px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20500px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20min-height:\x2080px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x202px\x20solid\x20#007AFF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.5;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20vertical;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20inherit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>','找不到avatar-preview元素','设立约定','45mm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22memory-share-modal\x22\x20class=\x22modal\x20phone-modal\x22\x20style=\x22display:\x20block;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>记忆共享设置</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideMemoryShareSettings()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h4>选择要共享记忆的群聊</h4>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22checkbox-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','💬\x20测试chatapp读取时间线记忆...','华为P60','❌\x20序列化失败:','计算存储失败:','\x0a今日活动：\x0a','\x22。你在群聊中对用户的称呼是\x22','上臂式','今天是几号','婴儿专用','内存样本记录结构:','\x20条最近消息','开始彻底清理动态:\x20','短信AI回复失败:','🧹\x20原始文本:','\x20个短信对话和相关记忆...','✅\x20自定义主题数据迁移完成','mounted_','photoWidgetImage','清理失败:\x20','playlist','还有别的线索吗？','已清理\x20','图片加载失败，请检查URL是否正确','生成AI间回复失败:','rejectedBy','DM生成故事失败，使用预设故事:','正常接收群聊消息','aiVideoCallGreeting','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22payment-request-user-title\x22>发起订单代付请求</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🚨\x20保存聊天设置到IndexedDB失败:','insertBefore','message-container\x20','✅\x20confirmPersonaAndShowGroupSettings被调用，接收到的personaId:','[\x22API响应解析失败\x22]','\x20个\x0a-\x20联系人列表:\x20','chat-theme-content','当前显示聊天头像（可能被角色更换过）','bio','apiSettings','📝\x20[日记生成]\x20获取到\x20','心声:\x20','\x22,\x20分类:\x20\x22','episodic_','isShared','1080P','的来电','调试导入函数失败:','countup','pinned-anniversary-section','🔧\x20尝试隐藏正在输入提示...','人)</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-preview\x22>','请先选择一个聊天对象','不对哦，换个角度试试。','AI回复失败:\x20','修复失败:\x20','250g','🔄\x20修复脚本：开始导入聊天消息','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bottom-comment-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22','调试失败:\x20','📝\x20[短信时间线]\x20已记录角色主动发送短信事件到跨应用时间线','删除角色：','.offline-message-content','0,\x20128,\x200','🔍\x20[createAIMessage]\x20设置群聊发送者:\x20','offline-font-link-','badge','&id,\x20characterId,\x20settings,\x20timestamp','offline_','reply_to','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20后台写日记失败：内容生成失败','ai-chat-avatar-preview','取消置顶失败:','group-chats-list','人)</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','清除所有主题失败','：\x22生日快乐！这一天对我们来说很特别呢。\x22','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>','💔\x20[好友申请被拒]\x20','\x20个群聊','onclick','#e53e3e','\x0a#\x20纪念日和约定功能\x0a##\x20创建纪念日\x0a-\x20当对话中出现值得纪念的重要时刻时，你可以主动提议创建纪念日来记录这个特殊的日子。\x0a-\x20**创建格式**：在你的回复JSON数组中，使用特殊格式：`{\x22type\x22:\x20\x22create_anniversary\x22,\x20\x22name\x22:\x20\x22纪念日名称\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DD\x22,\x20\x22anniversary_type\x22:\x20\x22类型\x22,\x20\x22description\x22:\x20\x22描述\x22}`\x0a-\x20**类型选项**：birthday（生日）、meeting（相遇）、relationship（关系确立）、first_time（第一次）、special_moment（特殊时刻）、other（其他）\x0a-\x20**示例**：[\x22今天真是特别的一天\x22,\x20\x22让我为我们创建一个纪念日吧\x22,\x20{\x22type\x22:\x20\x22create_anniversary\x22,\x20\x22name\x22:\x20\x22我们的第一次深谈\x22,\x20\x22date\x22:\x20\x222025-08-10\x22,\x20\x22anniversary_type\x22:\x20\x22special_moment\x22,\x20\x22description\x22:\x20\x22一次深入的心灵交流\x22}]\x0a\x0a##\x20创建约定\x0a-\x20当你们约定了未来要做的事情时，你可以创建约定来记录。\x0a-\x20**创建格式**：`{\x22type\x22:\x20\x22create_appointment\x22,\x20\x22name\x22:\x20\x22约定名称\x22,\x20\x22date\x22:\x20\x22YYYY-MM-DD\x22,\x20\x22appointment_type\x22:\x20\x22类型\x22,\x20\x22description\x22:\x20\x22描述\x22}`\x0a-\x20**类型选项**：date（约会）、meeting（见面）、promise（承诺）、activity（活动）、other（其他）\x0a-\x20**示例**：[\x22好的，我们约定下周见面\x22,\x20{\x22type\x22:\x20\x22create_appointment\x22,\x20\x22name\x22:\x20\x22下周的见面\x22,\x20\x22date\x22:\x20\x222025-08-17\x22,\x20\x22appointment_type\x22:\x20\x22meeting\x22,\x20\x22description\x22:\x20\x22我们约定的见面\x22}]\x0a\x0a##\x20使用原则\x0a-\x20**自然触发**：只在真正有意义的时刻创建，不要为了创建而创建\x0a-\x20**用户同意**：通常先在对话中提议，然后再创建\x0a-\x20**有意义的内容**：确保创建的纪念日或约定对你们的关系有实际意义','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item\x22\x20onclick=\x22openEmojiLibrary(\x27','<span\x20class=\x22search-highlight\x22>$&</span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-name\x22>','请先填写API地址和密钥','找不到文件输入元素','icon-preview-img','\x0a-\x20**任务:**\x20用户发送了一张图片，请仔细分析并以你的角色身份进行回应。','conversationId','创建了约定：','warn','.webp','aiCallEnabled','transfer_action','CustomFont','❌\x20结束且不总结：找不到模态框','未找到该角色的拉黑记录','delete','game-chat-bubble','pokeCharacter(\x27','poke-system-message','警告：将删除所有数据且无法恢复！\x0a输入\x22清空所有数据\x22确认：','preferredType','生成角色互动失败:','global-font-override','KB\x20->\x20','动态列表不为空，进行增量更新','❌\x20页面加载时应用主题失败:','background_task','图片压缩失败，使用原图:','fas\x20fa-shopping-bag','获取挂载记忆失败:','🔗\x20检测到群聊活动，智能包含相关群聊记忆:','rgba(','返回按钮样式已设置','memory-mount-count','角色主动发送短信失败:','从IndexedDB加载应用图标数据:','offline-user-normal','&id,\x20fromId,\x20toId,\x20timestamp,\x20status,\x20type,\x20message','🚨\x20[MANUAL]\x20找到孤立表情包:','加载动态失败:','Modal\x20element\x20not\x20found!','never-expires','设立纪念日','短信互动','浪漫情感类型，以爱情为主题的推理故事','isGroup','.memory-delete-btn','anniversary-user-avatar-upload','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-item-details\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-left\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22appointment-detail-name\x22>','拒绝了你的','🎵\x20播放全局音效:\x20','群聊数据无效:','请选择设置选项','\x20\x20\x20\x20-\x20聊天历史:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',':\x20背景已更新，保存到数据库',',\x20内容:\x20','关系不明确','请输入评论内容','persona-avatar-preview','保存专属音效开关状态失败:','autoFixed','💡\x20可以运行\x20reinitializeProactiveChatTimers()\x20来重新初始化定时器','songId','🔍\x20[转发消息检查]\x20pendingUserMessage:','0.99','#edit-diary-textarea','❌\x20buildGlobalMemoryContext:\x20currentContext无效:','\x20的所有短信记录吗？\x0a\x0a此操作将同时删除：\x0a•\x20相关的所有记忆\x0a\x0a此操作不可恢复！','chat-bottom-bg-item','++id,\x20characterId,\x20personaId,\x20createdAt','\x20拒绝了你的好友申请。','°E,\x20','blacklist-settings-modal','video-call-timer','：\x22从那天开始，我们的关系就不一样了。\x22','cssText','消息和记忆数据已更新','有什么安排','avatar','角色主题数据解析失败\x20(','===\x20调试结束\x20===','清空线下模式聊天记录失败:','paragraph-spacing-value','prices','no-ai-avatar','蛋炒饭','音乐播放列表','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-name\x22>','fas\x20fa-check-circle','single-chat-modal','♪\x20请尝试使用LRC格式歌词','init','创建了纪念日：','头像更新失败！','timestamp-enabled','戳一戳消息单条保存失败，回退到批量保存:','⏭️\x20跳过记录\x20-\x20角色\x20','游戏中','selection-count','测试动态发布成功！','sms_initiate','anyOf','🔍\x20=====\x20开始数据完整性诊断\x20=====','🔧\x20[API设置]\x20已恢复保存的模型选项:','vinyl-disc','未知选项','[论坛收藏]\x20数据库添加操作成功。','fas\x20fa-question-circle','吸尘器','他们有最新的VR游戏和街机','选择全局背景来源','[表情包\x22','currentTarget','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-item\x22\x20onclick=\x22sharePostToChat(\x27','🔍\x20提取的JSON文本:','character-status-enabled','🔧\x20[应用启动]\x20使用默认API设置','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22pinned-card-unpin-btn\x22\x20onclick=\x22event.stopPropagation();\x20unpinAnniversary(\x27','url-input-title','[AI撤回了上一条消息]','删除记忆失败','content-width','custom-prompt-modal','flex','解除拉黑失败:','avatar-preview-text','将清理以下数据以释放存储空间：\x0a\x0a•\x20所有角色的动态头像\x0a•\x20localStorage中的过期数据\x0a•\x20压缩现有头像数据\x0a\x0a确定要继续吗？','用户面具','暂无详细人设','数据恢复检查失败:','moments-page','call-message\x20','getBoundingClientRect','widget-anniversary-date','用户更新了约定\x22','url-preview-img','。\x0a\x0a##\x20群聊心声要求：\x0a-\x20考虑群聊的公开性，你的内心想法可能包含对其他成员的看法\x0a-\x20可以思考群聊氛围、其他成员的发言、自己在群里的定位等\x0a-\x20注意区分公开发言和内心真实想法的差异','episodic','烧仙草','\x0a-\x20**任务:**\x20根据对话上下文，以你的角色身份进行自然回应。','🎭\x20清理后的文本:','罗技鼠标','video-call-screen','[游戏状态]\x20你们正在下五子棋，游戏','无效的库选择','我替你付','一个普通的现代社区，大家在这里分享日常生活与见闻。','删除失败，请重试','【投票】','grid-paper','🔥\x20更新记忆状态显示:','character-phone-title','voted','我已付','我帮你下单','查看聊天记录失败','重新保存到IndexedDB失败:','游戏聊天API调用失败:','lastMomentTime','schedule-enabled','获取挂载表情包时出错:','🔍\x20[群聊消息]\x20处理群聊消息:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22checkbox-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22','加载记忆配置失败:','localStorage聊天备份:','获取核心记忆失败:','contact-item\x20','create_anniversary','opacity\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201),\x20transform\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201)','IndexedDB角色数据:','back-button','1.5m床','✅\x20设置已异步迁移到数据库\x20(','&id,\x20settingName,\x20settingValue,\x20timestamp','正在进行深度清理...','\x20现在是中局，需要平衡攻防。','\x22]\x20','✅\x20群公告保存成功','font-status\x20','✅\x20测试纪念日创建成功','floating-delete-btn','emoji-library-mount-list','🚫\x20AI选择的位置(','#4a84c1','群聊(','编辑记忆失败','background-moments-frequency','取消了\x20','加载自定义应用图标失败:','diary-settings-screen','今天已经有日记了，是否要重新生成？这将覆盖原有的日记。','🔥\x20[拉黑触发]\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22worldbook-date-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20创建于:\x20','✅\x20[高效重新生成]\x20删除了\x20','📱\x20动态\x20','turtle-soup','listeningDuration','正在导出数据...','timestamp\x20timestamp-center','\x20对\x20','标题或内容超出字数限制','characters','.offline-message.ai\x20.offline-message-content','\x0a\x0a💝\x20关系提醒：根据你的人设，你与','custom-emoji-item','pollData','没有聊天时，角色可以做自己的事情（工作、学习、休息、娱乐、社交、私密活动等）','🔍\x20[图片分支修复]\x20发送文字描述\x20(','worldbook-mount-enabled','\x20吗？\x0a\x0a屏蔽后将不再接收该群聊的消息通知','🚨\x20[DEBUG]\x20消息内容:','expires','msgData.message:',']\x20在','📦\x20从数据库加载了\x20','h,\x20热度','data.anniversaries','MB\x20(限制:\x20','Modal\x20display\x20set\x20to\x20flex','数据库加载窗口隔离设置失败:','amount','专业、神秘、善于引导','selectedAvatarData','📱\x20多媒体消息','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22sms-message-time\x22>','傍晚时分，夕阳西下，天空被染成了金黄色。站在天台上看着这美丽的景色，心情格外平静。这样的时刻总是让人感到生活的美好。','transform','压缩图片失败:','<div\x20class=\x22contact-status-indicator\x20blocked-by\x22\x20title=\x22被对方拉黑\x22><i\x20class=\x22fas\x20fa-exclamation-triangle\x22></i></div>','&#39;','timeupdate','call_message','回复<span\x20style=\x22margin:\x200\x202px;\x20color:\x20#576b95;\x20font-weight:\x20600;\x22>','AI\x20DM回答生成失败:','surrender_','批量保存短信消息失败:','主动发动态测试失败:','gomoku_','54tTYizP','获取的表单值:','开始删除角色ID:\x20','角色语录','#ff9500','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footprint-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22footprint-activity\x22>','memberId','&id,\x20characterId,\x20settingName,\x20settingValue,\x20timestamp','unread-badge','<i\x20class=\x22fas\x20fa-list\x22></i>','statusText','好啊！看什么电影？','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pinned-card-countdown\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-photo-placeholder-large\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-image\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>照片预览</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','不开心','memorySummaries','character-phone-chat-screen','对方未说明理由','\x22指代角色\x0a-\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a-\x20例如：\x22用户向','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry\x22\x20onclick=\x22toggleDiaryEntry(','🔥\x20[紧急清理]\x20没有发现损坏的消息','beforeunload','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22200\x22\x20height=\x22150\x22\x20viewBox=\x220\x200\x20200\x20150\x22><rect\x20width=\x22200\x22\x20height=\x22150\x22\x20fill=\x22#f0f0f0\x22/><text\x20x=\x22100\x22\x20y=\x2275\x22\x20text-anchor=\x22middle\x22\x20font-family=\x22Arial\x22\x20font-size=\x2212\x22\x20fill=\x22#666\x22>[AI描述的图片]</text></svg>','#worldbook-mount-list\x20input[type=\x22checkbox\x22]:checked','文件中没有找到有效的角色数据','评论说：','NotAllowedError','custom-paper','聊天记录分析完成','09:18','全局设定已更新','\x0a\x0a【游戏规则】：\x0a1.\x20玩家只能问是/否问题\x0a2.\x20你只能回答\x22是\x22、\x22否\x22或\x22无关\x22\x0a3.\x20如果问题与真相无关，回答\x22无关\x22\x0a4.\x20如果问题接近真相，可以给予鼓励\x0a5.\x20保持神秘感，不要直接透露答案\x0a\x0a【当前游戏状态】：\x0a-\x20已提问次数：','split','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','客观的','✅\x20[去重修复]\x20角色\x20','documentElement','✅\x20线下模式界面设置已保存到数据库\x20(','friend_request','[图片/文件]','api-chat-title','fontName','🎉\x20全局动态发布系统初始化完成，激活了\x20','获取评论区上下文失败:','投票历史已清空','✅\x20AI选择有效位置:\x20(','对方正在输入...','大家刚起床，可能在讨论早餐、今天的计划、昨晚的梦境等','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-arrow\x22>›</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20(匿名用户，身份未知)','global-add-button','importDataFromFile','剧情总结已保存，AI工作记忆已同步更新','🔍\x20[转发消息创建]\x20转发的消息数量:','\x20存在负面关系记忆，不会点赞','historyCount','2024年2月28日\x2016:20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-content\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22theme-chat-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-chat-btn\x20preview-theme-btn\x22\x20onclick=\x22previewChatTheme(\x27','专业的海龟汤游戏主持人，擅长引导推理游戏','开始修复头像数据...','<button\x20class=\x22message-action-btn\x22\x20onclick=\x22','recentEmojis迁移完成并清理localStorage','🔥\x20设置已保存到localStorage:','anonymous-toggle','\x0a-\x20你的设定:\x20','订单下单成功','text-align','row','postViewSource','\x20->\x20表情包:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','<div\x20class=\x22memory-importance\x22>','[userId+postId]','从localStorage加载失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-shadow:\x200\x202px\x206px\x20rgba(0,\x200,\x200,\x200.8)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','characterDiaries','恢复设置失败，请联系技术支持','无法找到上次聊天的角色/群组:','request_pay_ta','OLED版','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','拒绝付','refreshWidget','让我分析一下','\x0a-\x20**歌词状态:**\x20暂无歌词','定时清理足迹缓存失败:','💔\x20','\x0a今日聊天时间点:\x0a','\x0a【汤底真相】：','✅\x20已删除角色\x20','清理足迹缓存失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-title-area\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22group-title\x22>','✅\x20窗口隔离聊天设置已更新到IndexedDB\x20(角色:\x20','.dock-app[onclick=\x22showApp(\x27messages-screen\x27)\x22]\x20.dock-app-icon','实际回合数:','100粒','isOfflineMode','weibo-text','[用户发来一条语音消息，内容是：\x27','\x0a-\x20**格式**:\x20`{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22你的真诚道歉或请求\x22}`\x0a-\x20**时机**:\x20当你觉得合适时，','角色不存在','register','modal\x20offline-exit-modal','轻量级备份_','\x20个聊天设置到数据库','【帖子标题】','\x0a\x0a【正文】\x0a','世界书挂载设置已保存，已挂载\x20','❌\x20查询表\x20','建立纪念日','已经说了很多话了，先和','定时检查器状态:','\x20\x20🕐\x20最后一条消息:\x20','创建了约定','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20已解除对用户的拉黑','调整你的道歉策略，更加真诚和具体','4px\x200','文件恢复失败:\x20','easy','touchmove','birthday','currentStory','专心下棋，没怎么聊天','我来给钱','停止音效失败\x20(','yearly','用户向\x20','current-price','loadSettings','setDate','.building','\x20主动聊天功能已禁用','oninput','🔍\x20[processAIReply\x20else分支修复]\x20发送文字描述\x20(','已挂载:\x201个','.size-option','🧪\x20开始测试发布者回复功能...','.lyric-line','过滤后有效角色:\x20','听起来不错！在哪里？','24袋装','\x0a\x0a##\x20对话内容\x0a','sms-normal-actions','.payment-request-user-card','请输入姓名','正在发布帖子...','刷新失败:\x20','天没有聊天了','\x0a\x0a##\x20特殊情况说明\x0a你在聊天应用中拉黑了用户，但用户现在通过短信联系你。你可能会：\x0a-\x20保持之前的态度或有所软化\x0a-\x20根据用户的消息内容决定是否回应\x0a-\x20表现出符合你性格的反应\x0a请根据你的性格和拉黑的原因来回应。','\x20启用了定时发布，时间点:','\x20无需回复','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22app-item-name\x22>','（刚刚发布）','🛒\x20[代付响应处理]\x20AI同意代付，更新状态为已支付','主动聊天测试成功！已生成新消息','schedule-settings-modal','translateX(-50%)\x20translateY(10px)','color-picker-title','Unsupported\x20MIME\x20type:\x20image/gif','🔥\x20[短信提示词]\x20开始构建，角色:','🔄\x20增量更新角色\x20','🎨\x20从Dexie加载保存的全局自定义主题并缓存','📷📝\x20图片+文字：','previous','\x20提取后的动态内容:','新建面具','[用户分享了位置信息：','date','emojiLibraryMountEnabled','\x20正在分析与动态发布者的关系，发布者:','.photo-badge','用户在五子棋游戏中申请悔棋，',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','对这个','负担不起','DOMContentLoaded','检查localStorage使用量失败:','🎮\x20已清除游戏相关的时间线记忆','memory','找不到用户身份信息','chatId','PhoneChatDB','saved-configs-container','视频通话中...','✅\x20[','✅\x20[高效编辑]\x20消息编辑已保存到数据库','拉黑角色失败:','🔍\x20[addMessageWithAnimation-表情包]\x20检测到表情包消息:','🎨\x20当前聊天\x20','已取消置顶，现在可以删除了','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-message-time\x22>','。别忘了。','状态检查失败:\x20','.game-exit-modal','textarea,\x20input[type=\x22text\x22],\x20input[type=\x22password\x22],\x20input[type=\x22email\x22],\x20input[type=\x22number\x22]','visibilitychange','selectedMemoryChats','current-lyric','增量更新失败:','应用界面不存在:\x20','isGameMessage','不善交际','确定要将\x20','对歌曲《','切换到:\x20','moment-item','hash','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22member-avatar\x20clickable-avatar\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src=\x22','\x0a\x0a【评论区】\x0a','user_message','group-avatar-preview','name_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comments\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有创建任何论坛</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>点击右上角\x20+\x20创建你的第一个论坛</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','fas\x20fa-square','单个删除消息保存失败，回退到全量保存:','uploadTime','已移除背景','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22persona-action-btn\x20persona-edit-btn\x22\x20onclick=\x22showPersonaForm(\x27','\x0a#\x20发送图片的能力\x0a-\x20你无法发送真实的图片文件。但当用户要求你发送照片，或者你想通过图片来表达时，你可以发送一张\x22文字描述的图片\x22，且必须是在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22这里是对图片的详细文字描述...\x22}`。这个描述应该生动、具体，让用户能通过文字想象出画面，以第三人称视角描述。例如：`{\x22type\x22:\x20\x22ai_image\x22,\x20\x22description\x22:\x20\x22照片里一只橘猫正懒洋洋地趴在窗台上晒太阳，阳光把它金色的毛照得发亮，背景是蔚蓝的天空和几朵白云。\x22}`\x0a-\x20你可以在对话中先做铺垫，然后发送这张特殊的\x22图片\x22。\x0a\x0a#\x20理解用户照片的能力\x0a-\x20当历史记录中出现\x20\x22[你收到了一张用户描述的照片，照片内容是：\x27xxx\x27]\x22\x20时，你要理解其内容并作出相应回应，表现出你是\x22看\x22到了这张照片。\x0a-\x20你应该对照片内容做出自然的评论或回应，比如夸奖、询问细节、表达感受等。\x0a\x0a#\x20发送\x22伪照片\x22的能力\x0a-\x20你可以像用户一样发送\x22伪照片\x22，这是一种带有文字描述的照片卡片。\x0a-\x20若要发送\x22伪照片\x22，**必须严格按照以下格式**，在你的回复JSON数组中，单独发送一个特殊的对象：`{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22这里是照片的内容描述...\x22}`。\x0a-\x20例如：`{\x22type\x22:\x20\x22ai_photo\x22,\x20\x22description\x22:\x20\x22我刚拍的窗外风景，阳光透过树叶洒在地上，形成斑驳的光影。\x22}`\x0a-\x20这种照片会显示为一个卡片，用户点击后可以看到你的描述。\x0a-\x20**重要**：必须使用\x22ai_photo\x22作为type字段的值，不要使用其他值如\x22photo\x22或\x22image\x22。description字段必须包含照片的详细描述。\x0a\x0a#\x20发送位置、定位、地址的能力\x0a-\x20你可以像用户一样发送位置信息。\x0a-\x20**重要**：无论用户说\x22发个定位\x22、\x22发个位置\x22、\x22发个地址\x22还是\x22分享位置\x22，或者当你想告诉用户自己目前在哪时，你都必须使用JSON格式回复，绝对不能回复纯文本！\x0a-\x20若要发送位置或定位，必须在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22位置名称\x22,\x20\x22coordinates\x22:\x20\x22坐标信息\x22}`。\x0a-\x20例如：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22中央公园\x22,\x20\x22coordinates\x22:\x20\x22116.3°E,\x2039.9°N\x22}`\x0a-\x20例如：`{\x22type\x22:\x20\x22location\x22,\x20\x22locationName\x22:\x20\x22星湖湾小区12栋\x22,\x20\x22coordinates\x22:\x20\x22113.2°E,\x2023.1°N\x22}`\x0a-\x20你可以在对话中先做铺垫，然后发送这个位置信息。\x0a-\x20**绝对禁止**回复类似\x22[角色分享了位置信息：xxx]\x22这样的纯文本格式！','selector','头像更换系统消息保存失败，回退到全量保存:','\x20在\x20','聊天顶部背景已上传','music','开始恢复聊天设置:\x20','分析聊天记录...','🎨\x20当前聊天窗口\x20','60ml','999','groupMembers','聊天API调用失败\x20(','线下模式API调用失败:','\x20发动态时AI返回了JSON格式，正在提取文本:','phone-note-detail-title','说:\x20','\x20\x20-\x20普通角色数量:','：\x22从那天开始，我们的关系就变得更加珍贵了。\x22','从IndexedDB加载世界书数据:','forum-persona-selection','content',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2012px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2025px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.3s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','不支持的字体格式，请使用CSS链接或字体文件链接','action','add-chat-btn','已选择身份\x22','🧹\x20足迹缓存清理完成:\x20清理前\x20','<i\x20class=\x22fas\x20fa-comment-dots\x22></i>','i.imgur.com','开始发送语音消息:','lyric','检测到单个JSON对象，尝试处理:','ai-player-avatar','定时发布设置已保存','老娘舅','⏭️\x20','\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-title\x22>','gameTimer','🔧\x20[去重修复]\x20处理角色\x20','\x0a\x0a【游戏进展】：\x0a-\x20已提问','originalMessageId','测试前消息数量:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22like-count\x22>','ai_order','🔥\x20[generateRepliesForUserPost]\x20找到数组格式:','#666666','数据库中联系人数量:\x20','在五子棋中获胜了','🛒\x20[界面更新]\x20代付请求显示已更新','getAttribute','没有发现可重建的角色','sms-character-selector-modal','key','.offline-exit-modal\x20.btn:not(#summary-btn)','[用户发起了转账：','currentIndex','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20','没有找到用户最近发送的图片，忽略头像更换请求','++id,\x20footprintId,\x20time,\x20activity,\x20location,\x20type,\x20mood,\x20timestamp','usedJSHeapSize','语音消息发送成功','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-avatar\x22\x20style=\x22','生成日记失败，请稍后重试','forums','[群聊]','歌曲文件缺失，请重新添加','你已确认收款\x20¥','userAgent','🎵\x20音效事件监听器初始化完成','\x20没有有效的头像','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🔍\x20[转发消息处理]\x20找到转发消息，数量:','call-name','深度搜索失败:\x20','有效角色数据:','】以下是与','边下边聊很有趣','午饭时间，大家可能在讨论食物、下午的安排、分享午餐照片等','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22library-desc\x22>','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-redo\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>重新生成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','iPad\x20Pro','想起来','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>','ZARA','nickname','browser-url','生成AI评论失败:','[撤回了一条消息]','✅\x20已删除与\x20','重建角色:\x20','\x20个表情包，删除后表情包将回到未分类状态。','fas\x20fa-random','清除临时头像数据','memory-mount-chats','css','white','建立约定','fas\x20fa-comments','closest','专心下棋啦~','喂，你好啊，听得到我说话吗？','15天记忆','🌧️','offui_','操作失败，请重试。','#34C759','offline-opacity-value','点赞了','❌\x20[短信时间线]\x20记录用户发送图片事件失败:','fromCharCode','✅\x20[高效AI回复]\x20单条消息已保存到数据库','[重新生成失败:\x20','sms_image','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>💕\x20你发起的转账</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20','\x20后台写日记失败:','\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','保存API设置失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20分钟后再次尝试好友申请','**\x20时段特点。请根据\x22当前时间与氛围\x22部分的描述来调整帖子的话题、语气和活跃度。\x0a2.\x20\x20**真实论坛感**:\x20大部分帖子应该是普通人的日常分享、求助、吐槽、闲聊等，就像真实论坛一样\x0a3.\x20\x20**世界观融合**:\x20在保持真实感的前提下，适度融入背景世界观\x0a4.\x20\x20**话题多样性**:\x20包括学习、生活、娱乐、求助、分享、八卦等各种日常话题，但要符合当前时间段的特点\x0a5.\x20\x20**避免过度关联**:\x20不要让太多帖子都围绕论坛成员角色展开\x0a\x0a###\x20【极其重要】输出格式:\x0a你的回复**必须**是一个严格的、不包含任何额外解释文字的JSON数组格式。\x0a\x0a**标准帖子格式示例**:\x0a```json\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22学霸小王\x22,\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22今天的数学作业好难啊\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22有没有大神能帮忙解答一下这道题？感觉自己要被绕糊涂了...\x22,\x0a\x20\x20\x20\x20\x22timestamp\x22:\x20\x2212:30\x22\x0a\x20\x20},\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22夜猫子(张明辉)\x22,\x0a\x20\x20\x20\x20\x22title\x22:\x20\x22深夜食堂推荐\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22刚发现学校附近有家24小时营业的小店，泡面加蛋才8块钱，性价比超高！\x22,\x0a\x20\x20\x20\x20\x22timestamp\x22:\x20\x2223:45\x22\x0a\x20\x20}\x0a]\x0a```\x0a\x0a**重要**:\x20每个帖子对象必须包含\x20authorName、title、content\x20三个字段，timestamp\x20字段可选。\x0a','floor','三档调光','album-cover','🔥\x20[DEBUG]\x20开始处理数组，共','location','请输入图片URL','订单确认','log','解析备份数据失败:','✓\x20成功删除动态\x20','🔍\x20[群聊身份]\x20找到成员:','✅\x20构建用户引用提示:','🧪\x20测试删除对话功能...','全局定时器:','的关系选择不评论这条动态','牛仔裤','song-url-input','音效设置失败，请检查链接是否有效','未发现任何角色的聊天记录','请输入歌曲URL','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20','[data-post-id=\x22','\x20个角色到\x22','💭\x20','已清空所有数据','动态列表为空，加载所有动态','🔍\x20[processAIReply]\x20用户消息数量:','🔥\x20[论坛帖子生成]\x20找到部分JSON内容，长度:','#shopping-screen\x20.app-title','这个女人是盲人，平时丈夫都会在她身边，但这次她摸到的是一具冰冷的尸体，丈夫已经死了。','shared','✅\x20AI成功选择歌曲','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-selection-item\x20','确定要重置所有界面设置为默认值吗？','messageSent','avatar-preview','\x0a\x0a【动态记忆】以下是最近的动态和讨论：\x0a','AI分享的照片','，基于你的人设和与','标准版','\x20个活动','\x0a\x0a该分组下有\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22saveEditedOfflineMessage(\x27','🔍\x20[消息渲染]\x20未找到群成员，使用消息name:','song-cover-input','6袋装','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<i\x20class=\x22fas\x20fa-compact-disc\x22></i>','8GB','找不到custom-icon-upload元素','未挂载','OpenAI\x20API返回了空内容','IMG','\x20记忆失败:','\x20条损坏消息','导入数据失败:','</button>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20','&id,\x20characterId,\x20category,\x20content,\x20timestamp','HTTP\x20'];_0x513f=function(){return _0x411bdb;};return _0x513f();}function closeMusicModal(){const _0x3249d2=_0x211817,_0x3a5389=document[_0x3249d2(0x1262)]('music-modal');_0x3a5389[_0x3249d2(0x14eb)]['display']=_0x3249d2(0x102b);}function closeMusicPlayer(){const _0x301f3c=_0x211817,_0x145dae=document['getElementById'](_0x301f3c(0x12a3)),_0x2bc103=document[_0x301f3c(0x1262)](_0x301f3c(0x2245));if(_0x145dae)_0x145dae['style'][_0x301f3c(0x4da)]=_0x301f3c(0x102b);if(_0x2bc103)_0x2bc103['style'][_0x301f3c(0x4da)]='none';musicPlayer[_0x301f3c(0xb1c)]&&(musicPlayer['audioElement'][_0x301f3c(0x14fd)](),musicPlayer[_0x301f3c(0xb1c)][_0x301f3c(0x45c)]='',musicPlayer[_0x301f3c(0xb1c)]=null);clearAudioCache(),musicPlayer[_0x301f3c(0x923)]=![],musicPlayer[_0x301f3c(0x12ec)]=![],stopListeningTimer();const _0x19a33b=document[_0x301f3c(0x1262)](_0x301f3c(0x1fa4)),_0x2ac896=document[_0x301f3c(0x1262)]('tonearm');if(_0x19a33b)_0x19a33b[_0x301f3c(0x1c1b)][_0x301f3c(0x1493)]('playing');if(_0x2ac896)_0x2ac896['classList'][_0x301f3c(0x1493)](_0x301f3c(0x238));const _0x48ba5a=document[_0x301f3c(0x1262)](_0x301f3c(0x21db));if(_0x48ba5a)_0x48ba5a['innerHTML']=_0x301f3c(0x2ad);console[_0x301f3c(0x2187)](_0x301f3c(0x16f0));}function togglePlayback(){const _0xa8e13b=_0x211817;if(!musicPlayer[_0xa8e13b(0xb1c)]&&musicPlayer[_0xa8e13b(0x1ef9)]['length']>0x0){musicPlayer['currentIndex']=0x0;const _0x4e210f=musicPlayer[_0xa8e13b(0x1ef9)][0x0];playSongFromPlaylist(_0x4e210f);return;}if(musicPlayer[_0xa8e13b(0x1ef9)]['length']===0x0)return;musicPlayer[_0xa8e13b(0x923)]=!musicPlayer['isPlaying'];const _0x132aa9=document[_0xa8e13b(0x1262)]('modal-play-btn'),_0x16cc18=document[_0xa8e13b(0x1262)](_0xa8e13b(0x1fa4)),_0x14d64d=document[_0xa8e13b(0x1262)]('tonearm'),_0x340d1b=document['querySelector'](_0xa8e13b(0x1a96));if(musicPlayer[_0xa8e13b(0x923)]){_0x132aa9[_0xa8e13b(0x33a)]=_0xa8e13b(0x90d),_0x16cc18[_0xa8e13b(0x1c1b)][_0xa8e13b(0x21e2)](_0xa8e13b(0x238)),_0x14d64d['classList'][_0xa8e13b(0x21e2)](_0xa8e13b(0x238));if(_0x340d1b)_0x340d1b['style'][_0xa8e13b(0x2231)]='musicPulse\x201s\x20ease-in-out\x20infinite';musicPlayer['audioElement']&&musicPlayer[_0xa8e13b(0xb1c)][_0xa8e13b(0xaa5)]()[_0xa8e13b(0x1c82)](_0x19a248=>{const _0x21fc27=_0xa8e13b;console[_0x21fc27(0x174a)](_0x21fc27(0x22f),_0x19a248),musicPlayer['isPlaying']=![],_0x132aa9[_0x21fc27(0x33a)]=_0x21fc27(0x2ad),_0x16cc18[_0x21fc27(0x1c1b)][_0x21fc27(0x1493)](_0x21fc27(0x238)),_0x14d64d['classList'][_0x21fc27(0x1493)](_0x21fc27(0x238));if(_0x340d1b)_0x340d1b['style'][_0x21fc27(0x2231)]=_0x21fc27(0x5e2);alert(_0x21fc27(0x10cb)+_0x19a248[_0x21fc27(0x1e8e)]+'\x0a请检查音频文件是否有效');}),musicPlayer[_0xa8e13b(0xb1c)]&&musicPlayer[_0xa8e13b(0xb1c)][_0xa8e13b(0x1596)]===0x0&&(musicPlayer[_0xa8e13b(0x1596)]=0x0,musicPlayer[_0xa8e13b(0x1785)]=0x0,updateLyrics()),startPlaybackSimulation();}else{_0x132aa9[_0xa8e13b(0x33a)]=_0xa8e13b(0x2ad),_0x16cc18[_0xa8e13b(0x1c1b)][_0xa8e13b(0x1493)](_0xa8e13b(0x238)),_0x14d64d['classList']['remove'](_0xa8e13b(0x238));if(_0x340d1b)_0x340d1b[_0xa8e13b(0x14eb)][_0xa8e13b(0x2231)]=_0xa8e13b(0x5e2);musicPlayer[_0xa8e13b(0xb1c)]&&musicPlayer[_0xa8e13b(0xb1c)][_0xa8e13b(0x14fd)]();}}async function previousTrack(){const _0x151d3e=_0x211817;if(musicPlayer['playlist'][_0x151d3e(0x19ee)]===0x0)return;const _0x447986=musicPlayer[_0x151d3e(0x213f)];musicPlayer[_0x151d3e(0x213f)]=musicPlayer['currentIndex']>0x0?musicPlayer[_0x151d3e(0x213f)]-0x1:musicPlayer[_0x151d3e(0x1ef9)][_0x151d3e(0x19ee)]-0x1;const _0x479d3c=musicPlayer[_0x151d3e(0x1ef9)][musicPlayer[_0x151d3e(0x213f)]];let _0x38132d=null;if(_0x479d3c[_0x151d3e(0x21cb)])try{const _0x26eb5c=await db[_0x151d3e(0xe05)]['get'](_0x479d3c[_0x151d3e(0x21cb)]);_0x26eb5c&&(_0x38132d=_0x26eb5c[_0x151d3e(0x6bb)]);}catch(_0x2b74de){console[_0x151d3e(0x174a)](_0x151d3e(0x1088),_0x2b74de);}musicPlayer['currentSong']={..._0x479d3c,'coverImageData':_0x38132d},musicPlayer['currentTime']=0x0,musicPlayer[_0x151d3e(0x1785)]=0x0;if(musicPlayer[_0x151d3e(0xb1c)]){const _0x1c1f7d=musicPlayer['isPlaying'],_0x2331ee=await switchToSong(_0x479d3c,_0x1c1f7d);!_0x2331ee&&(musicPlayer[_0x151d3e(0x923)]=![]);}updateMusicDisplay(),musicPlayer[_0x151d3e(0x923)]&&startPlaybackSimulation();}async function nextTrack(){const _0xbd8fdc=_0x211817;if(musicPlayer['playlist']['length']===0x0)return;let _0x126012;switch(musicPlayer[_0xbd8fdc(0x11b5)]){case _0xbd8fdc(0x168e):_0x126012=Math[_0xbd8fdc(0x2180)](Math[_0xbd8fdc(0x11a8)]()*musicPlayer['playlist'][_0xbd8fdc(0x19ee)]);break;case _0xbd8fdc(0x1025):_0x126012=musicPlayer['currentIndex'];break;case _0xbd8fdc(0x1e56):_0x126012=musicPlayer['currentIndex']<musicPlayer[_0xbd8fdc(0x1ef9)][_0xbd8fdc(0x19ee)]-0x1?musicPlayer[_0xbd8fdc(0x213f)]+0x1:0x0;break;case _0xbd8fdc(0x22d7):default:_0x126012=musicPlayer[_0xbd8fdc(0x213f)]<musicPlayer[_0xbd8fdc(0x1ef9)]['length']-0x1?musicPlayer[_0xbd8fdc(0x213f)]+0x1:musicPlayer[_0xbd8fdc(0x213f)];break;}const _0x4c4b58=musicPlayer[_0xbd8fdc(0x213f)];musicPlayer[_0xbd8fdc(0x213f)]=_0x126012;const _0x1bf93d=musicPlayer[_0xbd8fdc(0x1ef9)][musicPlayer[_0xbd8fdc(0x213f)]];let _0x29db6c=null;if(_0x1bf93d[_0xbd8fdc(0x21cb)])try{const _0x242535=await db[_0xbd8fdc(0xe05)][_0xbd8fdc(0xb78)](_0x1bf93d[_0xbd8fdc(0x21cb)]);_0x242535&&(_0x29db6c=_0x242535[_0xbd8fdc(0x6bb)]);}catch(_0x2a87e4){console['error'](_0xbd8fdc(0x1088),_0x2a87e4);}musicPlayer[_0xbd8fdc(0x1f1)]={..._0x1bf93d,'coverImageData':_0x29db6c},musicPlayer[_0xbd8fdc(0x1596)]=0x0,musicPlayer[_0xbd8fdc(0x1785)]=0x0;if(musicPlayer[_0xbd8fdc(0xb1c)]){const _0x3dc36b=await switchToSong(_0x1bf93d,!![]);_0x3dc36b?musicPlayer[_0xbd8fdc(0x923)]=!![]:musicPlayer[_0xbd8fdc(0x923)]=![];}updateMusicDisplay(),startPlaybackSimulation();}function toggleMusicView(){const _0x58f036=_0x211817;musicPlayer[_0x58f036(0x1837)]=!musicPlayer['isVinylMode'];const _0xa28798=document[_0x58f036(0x1262)](_0x58f036(0x1943)),_0x53e15b=document[_0x58f036(0x1262)](_0x58f036(0x624)),_0x349b0d=document[_0x58f036(0x1262)](_0x58f036(0x163c)),_0x5e05d6=document['querySelector'](_0x58f036(0x1a30));if(musicPlayer[_0x58f036(0x1837)]){_0xa28798[_0x58f036(0x14eb)][_0x58f036(0x4da)]=_0x58f036(0x13de),_0x53e15b['style'][_0x58f036(0x4da)]='none';if(_0x5e05d6)_0x5e05d6['style'][_0x58f036(0x4da)]=_0x58f036(0x13de);_0x349b0d['innerHTML']=_0x58f036(0x2034);}else{_0xa28798['style'][_0x58f036(0x4da)]=_0x58f036(0x102b),_0x53e15b[_0x58f036(0x14eb)][_0x58f036(0x4da)]=_0x58f036(0x13de);if(_0x5e05d6)_0x5e05d6['style']['display']=_0x58f036(0x102b);_0x349b0d[_0x58f036(0x33a)]=_0x58f036(0x21af),setTimeout(()=>{const _0x4243b4=_0x58f036,_0x1d618d=document[_0x4243b4(0x1262)]('full-lyrics-display');_0x1d618d&&(_0x1d618d[_0x4243b4(0x33a)]=''),updateLyrics();},0x64);}musicPlayer[_0x58f036(0x1837)]&&updateLyrics();}function updateMusicDisplay(){const _0x8ece0b=_0x211817;if(!musicPlayer[_0x8ece0b(0x1f1)])return;const _0x165f73=musicPlayer[_0x8ece0b(0x1f1)];document[_0x8ece0b(0x1262)](_0x8ece0b(0x20f2))[_0x8ece0b(0x13be)]='♪\x20'+_0x165f73[_0x8ece0b(0x378)]+'\x20-\x20'+_0x165f73['artist'],document[_0x8ece0b(0x1262)](_0x8ece0b(0xee6))[_0x8ece0b(0x13be)]=_0x165f73[_0x8ece0b(0x378)],document['getElementById'](_0x8ece0b(0x21c4))[_0x8ece0b(0x13be)]=_0x165f73[_0x8ece0b(0xf08)],document[_0x8ece0b(0x1262)](_0x8ece0b(0x230d))[_0x8ece0b(0x13be)]=_0x165f73[_0x8ece0b(0x378)],document[_0x8ece0b(0x1262)](_0x8ece0b(0x9d8))['textContent']=_0x165f73[_0x8ece0b(0xf08)];const _0x22c44a=document[_0x8ece0b(0x1262)](_0x8ece0b(0x1355));if(_0x22c44a){const _0x28aaac=musicPlayer[_0x8ece0b(0xb1c)]?musicPlayer[_0x8ece0b(0xb1c)][_0x8ece0b(0x5a4)]:0x0;_0x28aaac&&!isNaN(_0x28aaac)&&_0x28aaac>0x0?_0x22c44a[_0x8ece0b(0x13be)]=formatMusicTime(_0x28aaac):_0x22c44a[_0x8ece0b(0x13be)]=_0x8ece0b(0xdfd);}const _0x16bc60=document[_0x8ece0b(0x1262)](_0x8ece0b(0x1286));if(_0x16bc60){const _0x2c073f=musicPlayer[_0x8ece0b(0xb1c)]?musicPlayer[_0x8ece0b(0xb1c)]['currentTime']:0x0;_0x2c073f&&!isNaN(_0x2c073f)&&_0x2c073f>=0x0?_0x16bc60['textContent']=formatMusicTime(_0x2c073f):_0x16bc60[_0x8ece0b(0x13be)]='0:00';}const _0x13e59f=document['getElementById'](_0x8ece0b(0xf22));if(_0x13e59f&&musicPlayer[_0x8ece0b(0xb1c)]){const _0x25a07e=musicPlayer['audioElement']['currentTime']||0x0,_0x5d145c=musicPlayer[_0x8ece0b(0xb1c)]['duration']||0x0;if(_0x5d145c>0x0){const _0x49eb44=_0x25a07e/_0x5d145c*0x64;_0x13e59f[_0x8ece0b(0x14eb)]['width']=_0x49eb44+'%';}}updateListeningTime(),updateVinylCover(),updateLyrics(),updatePlayerBackground();}function seekToLyric(_0x952f6e){const _0x4d9c7a=_0x211817;if(!musicPlayer[_0x4d9c7a(0xb1c)]||!musicPlayer[_0x4d9c7a(0x1f1)]||!musicPlayer['currentSong']['lyrics'])return;const _0x2524b5=musicPlayer[_0x4d9c7a(0xb1c)]['duration'],_0x4e402f=musicPlayer[_0x4d9c7a(0x1f1)]['lyrics'][_0x4d9c7a(0x19ee)];if(_0x2524b5&&_0x4e402f>0x0){const _0x3cde44=Math['min'](_0x2524b5*0.03,0x5),_0x18dea4=_0x2524b5*0.02,_0xa143e6=_0x2524b5-_0x3cde44-_0x18dea4;let _0x3d8c74;if(_0x952f6e===0x0)_0x3d8c74=_0x3cde44;else{if(_0x952f6e===_0x4e402f-0x1)_0x3d8c74=_0x2524b5-_0x18dea4;else{const _0x4dbd39=_0x952f6e/_0x4e402f;_0x3d8c74=_0x3cde44+_0x4dbd39*_0xa143e6;}}musicPlayer[_0x4d9c7a(0xb1c)]['currentTime']=Math[_0x4d9c7a(0x21ff)](Math[_0x4d9c7a(0x658)](_0x3d8c74,0x0),_0x2524b5),musicPlayer[_0x4d9c7a(0x1596)]=_0x3d8c74,musicPlayer[_0x4d9c7a(0x1785)]=_0x952f6e,updateLyrics();}}function formatMusicTime(_0x3a79c0){const _0x233248=_0x211817;if(!_0x3a79c0||isNaN(_0x3a79c0)||_0x3a79c0<=0x0)return _0x233248(0xdfd);const _0x2aa6cd=Math[_0x233248(0x2180)](_0x3a79c0/0x3c),_0x315cd4=Math['floor'](_0x3a79c0%0x3c);return _0x2aa6cd+':'+_0x315cd4[_0x233248(0x1878)]()[_0x233248(0xdfe)](0x2,'0');}function startListeningTimer(){const _0x51315c=_0x211817;musicPlayer[_0x51315c(0xe47)]&&clearInterval(musicPlayer['listeningTimer']),musicPlayer['listeningTimer']=setInterval(()=>{const _0x43b324=_0x51315c;musicPlayer[_0x43b324(0x923)]&&musicPlayer[_0x43b324(0x12ec)]&&(musicPlayer[_0x43b324(0x22de)]+=0x1,updateListeningTime());},0x3e8);}function pauseListeningTimer(){const _0x2f1ed5=_0x211817;musicPlayer[_0x2f1ed5(0xe47)]&&(clearInterval(musicPlayer[_0x2f1ed5(0xe47)]),musicPlayer[_0x2f1ed5(0xe47)]=null);}function stopListeningTimer(){const _0x16fd44=_0x211817;musicPlayer[_0x16fd44(0xe47)]&&(clearInterval(musicPlayer[_0x16fd44(0xe47)]),musicPlayer[_0x16fd44(0xe47)]=null),musicPlayer[_0x16fd44(0x22de)]=0x0;}function getMusicPlayingStatus(_0x32b91f){const _0x3ed7a6=_0x211817;if(!musicPlayer[_0x3ed7a6(0x12ec)]||musicPlayer['activeChatId']!==_0x32b91f)return null;const _0x2deb7d=Math[_0x3ed7a6(0x2180)](musicPlayer[_0x3ed7a6(0x22de)]/0x3c),_0x365324=musicPlayer['totalListeningTime']%0x3c;let _0x4b8c4a=null;if(musicPlayer[_0x3ed7a6(0x1f1)]&&musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0x1252)]){const _0x10783a=musicPlayer['currentSong'][_0x3ed7a6(0x1252)],_0x180ce9=musicPlayer['currentLyricIndex']||0x0;let _0x3e775b=_0x10783a[_0x180ce9]||_0x10783a[0x0]||'♪\x20暂无歌词';if(musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0x16b5)]&&musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0xddd)]&&musicPlayer['audioElement']&&!musicPlayer[_0x3ed7a6(0xb1c)][_0x3ed7a6(0x434)]){const _0x4f9324=musicPlayer[_0x3ed7a6(0xb1c)]['currentTime'],_0x28d212=musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0xddd)];let _0x2c4ef7=0x0;for(let _0x8e1f71=0x0;_0x8e1f71<_0x28d212[_0x3ed7a6(0x19ee)];_0x8e1f71++){if(_0x4f9324>=_0x28d212[_0x8e1f71])_0x2c4ef7=_0x8e1f71;else break;}_0x3e775b=_0x10783a[_0x2c4ef7]||_0x3e775b;}_0x4b8c4a={'hasLyrics':!![],'currentLyric':_0x3e775b,'allLyrics':_0x10783a,'hasTimedLyrics':musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0x16b5)]||![],'totalLines':_0x10783a[_0x3ed7a6(0x19ee)]};}return{'isPlaying':musicPlayer[_0x3ed7a6(0x923)],'isListening':musicPlayer['isActive'],'currentSong':musicPlayer[_0x3ed7a6(0x1f1)]?{'title':musicPlayer[_0x3ed7a6(0x1f1)][_0x3ed7a6(0x378)],'artist':musicPlayer[_0x3ed7a6(0x1f1)]['artist'],'album':musicPlayer[_0x3ed7a6(0x1f1)]['album'],'lyrics':_0x4b8c4a}:null,'listeningDuration':{'minutes':_0x2deb7d,'seconds':_0x365324,'total':musicPlayer[_0x3ed7a6(0x22de)],'formatted':_0x2deb7d+'分'+_0x365324+'秒'}};}function updateLyrics(){const _0x4b1238=_0x211817,_0x48c12d=document['getElementById'](_0x4b1238(0x14b8));if(!musicPlayer['currentSong']||!musicPlayer[_0x4b1238(0x1f1)][_0x4b1238(0x1252)]||musicPlayer[_0x4b1238(0x1f1)][_0x4b1238(0x1252)]['length']===0x0){_0x48c12d&&(_0x48c12d[_0x4b1238(0x13be)]=musicPlayer['isPlaying']?_0x4b1238(0x183e):_0x4b1238(0x1aca));const _0x175228=document[_0x4b1238(0x1262)](_0x4b1238(0x20f2));_0x175228&&(_0x175228['textContent']=musicPlayer[_0x4b1238(0x923)]?_0x4b1238(0x183e):_0x4b1238(0x6ad));return;}const _0x4483fa=musicPlayer[_0x4b1238(0x1f1)]['lyrics'];let _0x45e68d=musicPlayer[_0x4b1238(0x1785)];if(musicPlayer[_0x4b1238(0x1f1)][_0x4b1238(0x16b5)]&&musicPlayer[_0x4b1238(0x1f1)][_0x4b1238(0xddd)]&&musicPlayer[_0x4b1238(0xb1c)]&&!musicPlayer[_0x4b1238(0xb1c)][_0x4b1238(0x434)]){const _0x22b4fc=musicPlayer['audioElement']['currentTime'],_0x1d9caa=musicPlayer['currentSong'][_0x4b1238(0xddd)];let _0x15436f=0x0;for(let _0x8a3dde=0x0;_0x8a3dde<_0x1d9caa[_0x4b1238(0x19ee)];_0x8a3dde++){if(_0x22b4fc>=_0x1d9caa[_0x8a3dde])_0x15436f=_0x8a3dde;else break;}_0x45e68d=_0x15436f,musicPlayer[_0x4b1238(0x1785)]=_0x45e68d;}const _0x2bf5e8=_0x4483fa[_0x45e68d]||'♪';_0x48c12d&&(_0x48c12d[_0x4b1238(0x13be)]=_0x2bf5e8);const _0x5d1a13=document['getElementById']('current-lyric');_0x5d1a13&&(_0x5d1a13[_0x4b1238(0x13be)]=_0x2bf5e8);const _0x32fddb=document['getElementById'](_0x4b1238(0x187b));_0x32fddb&&(_0x32fddb['textContent']=_0x2bf5e8);const _0x36efb2=document[_0x4b1238(0x1262)](_0x4b1238(0x1e6));if(_0x36efb2){const _0x499593=_0x36efb2['querySelectorAll'](_0x4b1238(0x20b6));if(_0x499593[_0x4b1238(0x19ee)]!==_0x4483fa[_0x4b1238(0x19ee)]){const _0x34ba2e=_0x4483fa[_0x4b1238(0x6a4)]((_0x3f5dd,_0x2db4b2)=>{const _0x1b25a7=_0x4b1238,_0x12868d=_0x3f5dd[_0x1b25a7(0x19d7)]()==='';return _0x1b25a7(0x9f0)+(_0x12868d?'empty':'')+_0x1b25a7(0x1531)+_0x2db4b2+'\x22\x20onclick=\x22seekToLyric('+_0x2db4b2+_0x1b25a7(0x11aa)+(_0x3f5dd||_0x1b25a7(0x1664))+_0x1b25a7(0x1844);})[_0x4b1238(0x122b)]('');_0x36efb2[_0x4b1238(0x33a)]=_0x34ba2e;}const _0x31ebc3=_0x36efb2[_0x4b1238(0x1897)](_0x4b1238(0x20b6));_0x31ebc3['forEach']((_0x3658e3,_0x1a7752)=>{const _0x1fa4b2=_0x4b1238;_0x3658e3[_0x1fa4b2(0x1c1b)]['toggle'](_0x1fa4b2(0x1a14),_0x1a7752===_0x45e68d);});if(!musicPlayer[_0x4b1238(0x1837)]){const _0x56e72e=document[_0x4b1238(0xb30)](_0x4b1238(0x445)),_0xbf534e=document[_0x4b1238(0x1262)](_0x4b1238(0x624));if(_0x56e72e&&_0xbf534e&&_0xbf534e[_0x4b1238(0x14eb)][_0x4b1238(0x4da)]!==_0x4b1238(0x102b)){const _0x59514a=_0x36efb2[_0x4b1238(0xb30)](_0x4b1238(0x1283));if(_0x59514a&&_0x45e68d>=0x0){const _0x1c341f=_0x56e72e['clientHeight'],_0x477305=_0x1c341f/0x3-_0x59514a[_0x4b1238(0x1a92)]-_0x59514a[_0x4b1238(0x804)]/0x2;_0x36efb2[_0x4b1238(0x14eb)][_0x4b1238(0x201e)]='translateY('+_0x477305+'px)';}}}}}function startPlaybackSimulation(){const _0x11dbda=_0x211817;if(!musicPlayer[_0x11dbda(0x923)])return;const _0x195ea8=setInterval(()=>{const _0x40333e=_0x11dbda;if(!musicPlayer['isPlaying']){clearInterval(_0x195ea8);return;}if(musicPlayer[_0x40333e(0xb1c)]&&!musicPlayer['audioElement'][_0x40333e(0x434)]){musicPlayer[_0x40333e(0x1596)]=Math['floor'](musicPlayer[_0x40333e(0xb1c)][_0x40333e(0x1596)]);const _0x538bcb=musicPlayer[_0x40333e(0xb1c)][_0x40333e(0x5a4)]||0x12c,_0x233825=musicPlayer[_0x40333e(0x1596)]/_0x538bcb*0x64;document['getElementById'](_0x40333e(0xf22))[_0x40333e(0x14eb)][_0x40333e(0x12f1)]=Math[_0x40333e(0x21ff)](_0x233825,0x64)+'%';if(musicPlayer[_0x40333e(0xb1c)][_0x40333e(0x1d9c)]){clearInterval(_0x195ea8);if(musicPlayer[_0x40333e(0x972)]===_0x40333e(0x511))musicPlayer[_0x40333e(0xb1c)][_0x40333e(0x1596)]=0x0,musicPlayer['audioElement'][_0x40333e(0xaa5)]();else(musicPlayer[_0x40333e(0x972)]===_0x40333e(0x1a47)||musicPlayer['repeatMode']==='none')&&nextTrack();return;}}else{musicPlayer[_0x40333e(0x1596)]+=0x1;const _0x4910a8=0x12c,_0x4e8189=musicPlayer[_0x40333e(0x1596)]/_0x4910a8*0x64,_0x1b8db0=document[_0x40333e(0x1262)]('modal-progress');_0x1b8db0&&(_0x1b8db0['style'][_0x40333e(0x12f1)]=Math[_0x40333e(0x21ff)](_0x4e8189,0x64)+'%');const _0x20be72=document[_0x40333e(0x1262)](_0x40333e(0x1286)),_0x2d5944=document[_0x40333e(0x1262)](_0x40333e(0x1355));if(_0x20be72)_0x20be72['textContent']=formatMusicTime(musicPlayer[_0x40333e(0x1596)]);if(_0x2d5944)_0x2d5944[_0x40333e(0x13be)]=formatMusicTime(_0x4910a8);if(musicPlayer['currentTime']>=_0x4910a8){clearInterval(_0x195ea8);switch(musicPlayer[_0x40333e(0x11b5)]){case'loop-one':musicPlayer[_0x40333e(0x1596)]=0x0,startPlaybackSimulation();break;case _0x40333e(0x1e56):case _0x40333e(0x168e):nextTrack();break;case _0x40333e(0x22d7):musicPlayer[_0x40333e(0x213f)]<musicPlayer[_0x40333e(0x1ef9)][_0x40333e(0x19ee)]-0x1?nextTrack():(musicPlayer[_0x40333e(0x923)]=![],updateMusicDisplay());break;}return;}}if(musicPlayer[_0x40333e(0x1f1)]&&musicPlayer[_0x40333e(0x1f1)][_0x40333e(0x1252)]&&musicPlayer['currentSong'][_0x40333e(0x1252)][_0x40333e(0x19ee)]>0x0){let _0x34907b=0x0;if(musicPlayer[_0x40333e(0x1f1)][_0x40333e(0x16b5)]&&musicPlayer[_0x40333e(0x1f1)][_0x40333e(0xddd)]){const _0x4f7e36=musicPlayer[_0x40333e(0xb1c)]?musicPlayer['audioElement'][_0x40333e(0x1596)]:musicPlayer[_0x40333e(0x1596)],_0x2bf1d1=musicPlayer['currentSong']['lyricsTimings'],_0x4ab84d=_0x4f7e36;for(let _0x769540=0x0;_0x769540<_0x2bf1d1['length'];_0x769540++){if(_0x4ab84d>=_0x2bf1d1[_0x769540])_0x34907b=_0x769540;else break;}}else{const _0x3bef78=musicPlayer[_0x40333e(0xb1c)]?musicPlayer[_0x40333e(0xb1c)]['duration']:0x12c,_0x1934e1=musicPlayer[_0x40333e(0x1f1)][_0x40333e(0x1252)][_0x40333e(0x19ee)],_0x447bbe=musicPlayer[_0x40333e(0x1596)];if(_0x3bef78>0x0&&_0x1934e1>0x0){const _0x519af2=_0x3bef78/_0x1934e1,_0x393fd8=_0x447bbe;_0x34907b=Math[_0x40333e(0x21ff)](Math[_0x40333e(0x658)](Math[_0x40333e(0x2180)](_0x393fd8/_0x519af2),0x0),_0x1934e1-0x1);}}_0x34907b!==musicPlayer[_0x40333e(0x1785)]&&(musicPlayer['currentLyricIndex']=_0x34907b,updateLyrics());}},musicPlayer[_0x11dbda(0x1f1)]&&musicPlayer[_0x11dbda(0x1f1)][_0x11dbda(0x16b5)]?0xc8:0x1f4);}function getCurrentCharacterName(){const _0xf43981=_0x211817;if(currentChatCharacter)return currentChatCharacter[_0xf43981(0x1a1c)];return'你';}function updateListeningTime(){const _0xbe34c6=_0x211817,_0x2aa8ff=document[_0xbe34c6(0x1262)]('listening-duration');if(_0x2aa8ff&&musicPlayer[_0xbe34c6(0x12ec)]){const _0xa1cfc9=Math[_0xbe34c6(0x2180)](musicPlayer['totalListeningTime']/0x3c);let _0x3e2d19='你';currentChatCharacter&&(_0x3e2d19=currentChatCharacter[_0xbe34c6(0x1a1c)]);const _0x4a64ab='已一起听\x20'+_0xa1cfc9+_0xbe34c6(0x116b);_0x2aa8ff['textContent']=_0x4a64ab;}}function openMusicModal(){openMusicPlayer();}function extractImageColors(_0x279b09){return new Promise(_0x36af65=>{const _0x3fd432=_0x167f,_0x2e943c=document[_0x3fd432(0xac6)]('canvas'),_0x1ff875=_0x2e943c['getContext']('2d');_0x2e943c['width']=0x32,_0x2e943c[_0x3fd432(0xe6b)]=0x32,_0x1ff875[_0x3fd432(0x899)](_0x279b09,0x0,0x0,0x32,0x32);const _0x9780f1=_0x1ff875['getImageData'](0x0,0x0,0x32,0x32),_0x44f2c6=_0x9780f1[_0x3fd432(0x22c0)];let _0x119770=0x0,_0xd0e3f9=0x0,_0x5cd76d=0x0,_0x392684=0x0;for(let _0x5da662=0x0;_0x5da662<_0x44f2c6[_0x3fd432(0x19ee)];_0x5da662+=0x4){_0x119770+=_0x44f2c6[_0x5da662],_0xd0e3f9+=_0x44f2c6[_0x5da662+0x1],_0x5cd76d+=_0x44f2c6[_0x5da662+0x2],_0x392684++;}_0x119770=Math[_0x3fd432(0x2180)](_0x119770/_0x392684),_0xd0e3f9=Math[_0x3fd432(0x2180)](_0xd0e3f9/_0x392684),_0x5cd76d=Math[_0x3fd432(0x2180)](_0x5cd76d/_0x392684),_0x36af65({'r':_0x119770,'g':_0xd0e3f9,'b':_0x5cd76d});});}function updatePlayerBackground(){const _0x5eab60=_0x211817,_0x3d81ed=document['getElementById'](_0x5eab60(0x12a3)),_0x475125=document[_0x5eab60(0xb30)](_0x5eab60(0x17be)),_0x1fbff9=document['getElementById'](_0x5eab60(0x2182));_0x1fbff9&&_0x1fbff9[_0x5eab60(0x45c)]&&!_0x1fbff9[_0x5eab60(0x45c)][_0x5eab60(0x1831)]('data:image/svg')&&_0x1fbff9[_0x5eab60(0x14eb)]['display']!==_0x5eab60(0x102b)?extractImageColors(_0x1fbff9)['then'](_0xdf1d5=>{const _0x2ae195=_0x5eab60,{r:_0x390a95,g:_0x4146bc,b:_0x408672}=_0xdf1d5,_0x50cd66=_0x2ae195(0x1f5a)+_0x390a95+',\x20'+_0x4146bc+',\x20'+_0x408672+_0x2ae195(0xd19);_0x475125&&(_0x475125[_0x2ae195(0x14eb)][_0x2ae195(0x619)]=_0x50cd66,_0x475125[_0x2ae195(0x14eb)][_0x2ae195(0x17b8)]=_0x2ae195(0x31c),_0x475125[_0x2ae195(0x14eb)][_0x2ae195(0x617)]=_0x2ae195(0x31c));}):_0x475125&&(_0x475125[_0x5eab60(0x14eb)][_0x5eab60(0x619)]='rgba(200,\x20200,\x20200,\x200.25)',_0x475125[_0x5eab60(0x14eb)][_0x5eab60(0x17b8)]='blur(30px)\x20saturate(1.5)',_0x475125[_0x5eab60(0x14eb)][_0x5eab60(0x617)]='blur(30px)\x20saturate(1.5)');}function togglePlayMode(){const _0x47a616=_0x211817,_0x323597=[_0x47a616(0x22d7),_0x47a616(0x1e56),'loop-one',_0x47a616(0x168e)],_0xb73c7=_0x323597[_0x47a616(0x13c5)](musicPlayer[_0x47a616(0x11b5)]||_0x47a616(0x22d7)),_0x5edcf7=(_0xb73c7+0x1)%_0x323597[_0x47a616(0x19ee)];musicPlayer[_0x47a616(0x11b5)]=_0x323597[_0x5edcf7],updatePlayModeButton();}function updatePlayModeButton(){const _0x4bbae8=_0x211817,_0x22923a=document[_0x4bbae8(0x1262)](_0x4bbae8(0xd1e)),_0x102e46=_0x22923a['querySelector']('i');switch(musicPlayer['playMode']){case _0x4bbae8(0x22d7):_0x102e46['className']='fas\x20fa-list-ol',_0x22923a['title']=_0x4bbae8(0x160e),_0x22923a['classList'][_0x4bbae8(0x1493)](_0x4bbae8(0x1a14));const _0x49c6c5=_0x22923a['querySelector'](_0x4bbae8(0x1205));if(_0x49c6c5)_0x49c6c5[_0x4bbae8(0x1493)]();break;case'loop-all':_0x102e46[_0x4bbae8(0x1722)]=_0x4bbae8(0x1dd6),_0x22923a[_0x4bbae8(0x378)]=_0x4bbae8(0x1d29),_0x22923a[_0x4bbae8(0x1c1b)][_0x4bbae8(0x1493)](_0x4bbae8(0x1a14));const _0x36f001=_0x22923a[_0x4bbae8(0xb30)]('.loop-number');if(_0x36f001)_0x36f001['remove']();break;case'loop-one':_0x102e46[_0x4bbae8(0x1722)]=_0x4bbae8(0xd33),_0x22923a['title']='单曲循环',_0x22923a[_0x4bbae8(0x1c1b)][_0x4bbae8(0x1493)](_0x4bbae8(0x1a14));if(!_0x22923a['querySelector'](_0x4bbae8(0x1205))){const _0x1b03c6=document['createElement'](_0x4bbae8(0x195d));_0x1b03c6[_0x4bbae8(0x1722)]=_0x4bbae8(0x1971),_0x1b03c6[_0x4bbae8(0x13be)]='1',_0x22923a[_0x4bbae8(0x497)](_0x1b03c6);}break;case _0x4bbae8(0x168e):_0x102e46['className']=_0x4bbae8(0x2163),_0x22923a[_0x4bbae8(0x378)]=_0x4bbae8(0x1b0c),_0x22923a[_0x4bbae8(0x1c1b)][_0x4bbae8(0x1493)](_0x4bbae8(0x1a14));const _0x56cc8f=_0x22923a[_0x4bbae8(0xb30)](_0x4bbae8(0x1205));if(_0x56cc8f)_0x56cc8f[_0x4bbae8(0x1493)]();break;}}function toggleRepeat(){const _0x200a12=_0x211817,_0x1f187b=[_0x200a12(0x102b),_0x200a12(0x511),_0x200a12(0x1a47)],_0x41eebd=_0x1f187b[_0x200a12(0x13c5)](musicPlayer[_0x200a12(0x972)]||_0x200a12(0x102b)),_0x3399e1=(_0x41eebd+0x1)%_0x1f187b['length'];musicPlayer[_0x200a12(0x972)]=_0x1f187b[_0x3399e1];const _0x3814f3=document[_0x200a12(0x1262)](_0x200a12(0xd7d)),_0x3aae34={'none':_0x200a12(0x1dd6),'one':_0x200a12(0x96b),'all':_0x200a12(0x1dd6)};_0x3814f3['innerHTML']=_0x200a12(0x660)+_0x3aae34[musicPlayer[_0x200a12(0x972)]]+_0x200a12(0x12c7),_0x3814f3[_0x200a12(0x1c1b)][_0x200a12(0x1e3f)](_0x200a12(0x1a14),musicPlayer[_0x200a12(0x972)]!==_0x200a12(0x102b));const _0x403c13={'sequential':_0x200a12(0x160e),'loop':'单曲循环','random':'随机播放'};console[_0x200a12(0x2187)](_0x200a12(0x20f9)+_0x403c13[musicPlayer[_0x200a12(0x11b5)]]);}function openPlaylistModal(){const _0x3a4c56=_0x211817,_0x2defbf=document[_0x3a4c56(0x1262)](_0x3a4c56(0x16e0));_0x2defbf&&(_0x2defbf['style'][_0x3a4c56(0x4da)]=_0x3a4c56(0x1fb7),loadPlaylistItems());}function closePlaylistModal(){const _0x34dfe4=_0x211817,_0xf1e868=document[_0x34dfe4(0x1262)](_0x34dfe4(0x16e0));_0xf1e868&&(_0xf1e868[_0x34dfe4(0x14eb)]['display']=_0x34dfe4(0x102b));}async function loadPlaylistItems(){const _0x372699=_0x211817;try{const _0x2d003e=await db[_0x372699(0x128d)][_0x372699(0xe30)]('addedTime')['toArray'](),_0x54e2f9=document[_0x372699(0x1262)](_0x372699(0x21e8));if(!_0x54e2f9)return;_0x54e2f9[_0x372699(0x33a)]='';if(_0x2d003e[_0x372699(0x19ee)]===0x0){_0x54e2f9['innerHTML']=_0x372699(0x1271);return;}_0x2d003e[_0x372699(0x19fb)]((_0x5aeeb0,_0xa85195)=>{const _0x580920=_0x372699,_0x7f28b8=document[_0x580920(0xac6)](_0x580920(0xbbc));_0x7f28b8[_0x580920(0x1722)]=_0x580920(0x5f4),_0x7f28b8[_0x580920(0x33a)]=_0x580920(0x1d3c)+(_0xa85195+0x1)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-title\x22>'+_0x5aeeb0['title']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-artist\x22>'+_0x5aeeb0['artist']+_0x580920(0x532)+_0x5aeeb0['id']+_0x580920(0x9cf)+_0x5aeeb0['id']+_0x580920(0x10ac);const _0x405644=_0x7f28b8[_0x580920(0xb30)](_0x580920(0x555));_0x405644['addEventListener'](_0x580920(0x1859),_0xf35a72=>{const _0x3739fe=_0x580920;_0xf35a72[_0x3739fe(0x902)](),playSongFromPlaylist(_0x5aeeb0);}),_0x54e2f9[_0x580920(0x497)](_0x7f28b8);});}catch(_0x11112b){console[_0x372699(0x174a)]('加载播放列表失败:',_0x11112b);}}async function addCustomSong(){const _0x9abd7c=_0x211817,_0x168970=document[_0x9abd7c(0x1262)](_0x9abd7c(0x2190)),_0x285803=document[_0x9abd7c(0x1262)](_0x9abd7c(0x193e)),_0x50f99c=document[_0x9abd7c(0x1262)](_0x9abd7c(0x6b0)),_0x33b388=document['getElementById'](_0x9abd7c(0x21ac)),_0x1e470b=document[_0x9abd7c(0x1262)](_0x9abd7c(0x15a1)),_0x4a98f1=document['getElementById'](_0x9abd7c(0x546));let _0x1418ac=_0x168970[_0x9abd7c(0x1ebc)][_0x9abd7c(0x19d7)]();const _0x2b2f7f=_0x285803[_0x9abd7c(0x1ebc)][_0x9abd7c(0x19d7)](),_0x378d7d=_0x50f99c[_0x9abd7c(0x1ebc)][_0x9abd7c(0x19d7)]();let _0x532add=![];if(_0x1e470b[_0x9abd7c(0xf26)]&&_0x1e470b[_0x9abd7c(0xf26)][0x0]){const _0x146141=_0x1e470b[_0x9abd7c(0xf26)][0x0];try{_0x146141[_0x9abd7c(0x2d8)]<0xa*0x400*0x400?(_0x1418ac=await new Promise((_0x20f7eb,_0x354ef7)=>{const _0x4c39bd=_0x9abd7c,_0x4d18e9=new FileReader();_0x4d18e9[_0x4c39bd(0xc55)]=_0x29a332=>_0x20f7eb(_0x29a332['target'][_0x4c39bd(0x4ee)]),_0x4d18e9[_0x4c39bd(0x21ec)]=_0x354ef7,_0x4d18e9[_0x4c39bd(0x127c)](_0x146141);}),console[_0x9abd7c(0x2187)]('🎵\x20小文件已转换为base64格式')):(_0x1418ac=URL[_0x9abd7c(0x556)](_0x146141),console[_0x9abd7c(0x2187)]('🎵\x20大文件已创建blob\x20URL'),alert(_0x9abd7c(0xdeb))),_0x532add=!![];}catch(_0x7a1e){console[_0x9abd7c(0x174a)]('处理本地音乐文件失败:',_0x7a1e),alert(_0x9abd7c(0x190e));return;}!_0x2b2f7f&&(_0x285803[_0x9abd7c(0x1ebc)]=_0x146141[_0x9abd7c(0x1a1c)][_0x9abd7c(0xe16)](/\.[^/.]+$/,''));}if(!_0x1418ac||!_0x285803[_0x9abd7c(0x1ebc)][_0x9abd7c(0x19d7)]()||!_0x378d7d){alert(_0x9abd7c(0x7a5));return;}try{const _0x143dbb=Date[_0x9abd7c(0x2eb)]()[_0x9abd7c(0x1878)]();let _0x358dd8=null;if(_0x33b388['files']&&_0x33b388['files'][0x0]){const _0x1a4a53=_0x33b388[_0x9abd7c(0xf26)][0x0],_0x18f316=new FileReader();await new Promise((_0x4bedc5,_0x21cd46)=>{const _0x5019d3=_0x9abd7c;_0x18f316[_0x5019d3(0xc55)]=async _0x3f67bf=>{const _0x1d619e=_0x5019d3;try{_0x358dd8='cover_'+_0x143dbb,await db[_0x1d619e(0xe05)][_0x1d619e(0x21e2)]({'id':_0x358dd8,'songId':_0x143dbb,'imageData':_0x3f67bf[_0x1d619e(0x193d)][_0x1d619e(0x4ee)],'timestamp':Date[_0x1d619e(0x2eb)]()}),_0x4bedc5();}catch(_0x2cc2f0){_0x21cd46(_0x2cc2f0);}},_0x18f316[_0x5019d3(0x21ec)]=_0x21cd46,_0x18f316[_0x5019d3(0x127c)](_0x1a4a53);});}let _0x2c60bf=[];if(_0x4a98f1[_0x9abd7c(0xf26)]&&_0x4a98f1[_0x9abd7c(0xf26)][0x0]){const _0x302608=_0x4a98f1[_0x9abd7c(0xf26)][0x0],_0x23bfe0=_0x302608[_0x9abd7c(0x1a1c)][_0x9abd7c(0x49e)]();if(_0x23bfe0[_0x9abd7c(0x81f)](_0x9abd7c(0x1841))){const _0x345a74=await new Promise((_0x43c401,_0x421a69)=>{const _0x25fac7=_0x9abd7c,_0x591354=new FileReader();_0x591354['onload']=_0xf40494=>_0x43c401(_0xf40494['target'][_0x25fac7(0x4ee)]),_0x591354[_0x25fac7(0x21ec)]=_0x421a69,_0x591354['readAsText'](_0x302608,_0x25fac7(0x67e));}),_0x5dd451=parseLRC(_0x345a74);_0x2c60bf=_0x5dd451[_0x9abd7c(0x1252)],_0x5dd451[_0x9abd7c(0x8a0)]&&(window['tempLyricsTimings']=_0x5dd451[_0x9abd7c(0x1289)]);}else{if(_0x23bfe0[_0x9abd7c(0x81f)](_0x9abd7c(0x557))){const _0x9b9130=await new Promise((_0x390d0e,_0x1da91c)=>{const _0x464940=_0x9abd7c,_0x4a0791=new FileReader();_0x4a0791['onload']=_0x52a1de=>_0x390d0e(_0x52a1de[_0x464940(0x193d)][_0x464940(0x4ee)]),_0x4a0791[_0x464940(0x21ec)]=_0x1da91c,_0x4a0791[_0x464940(0x66e)](_0x302608);}),_0x6c37fd=parseNeteaseBin(_0x9b9130);_0x2c60bf=_0x6c37fd[_0x9abd7c(0x1252)],_0x6c37fd[_0x9abd7c(0x8a0)]&&(window['tempLyricsTimings']=_0x6c37fd[_0x9abd7c(0x1289)]);}else{const _0x243cd3=await new Promise((_0x44698e,_0x394c60)=>{const _0x22c612=_0x9abd7c,_0x3d1fa4=new FileReader();_0x3d1fa4[_0x22c612(0xc55)]=_0x126b2e=>_0x44698e(_0x126b2e[_0x22c612(0x193d)]['result']),_0x3d1fa4['onerror']=_0x394c60,_0x3d1fa4[_0x22c612(0x1be5)](_0x302608,_0x22c612(0x67e));});_0x2c60bf=_0x243cd3['split']('\x0a')[_0x9abd7c(0x6a4)](_0x16b9ae=>_0x16b9ae['trim']())[_0x9abd7c(0x1e1f)](_0x505083=>_0x505083[_0x9abd7c(0x19ee)]>0x0);}}}_0x2c60bf['length']===0x0&&(_0x2c60bf=[_0x9abd7c(0xcc6)]);await db[_0x9abd7c(0x128d)][_0x9abd7c(0x21e2)]({'id':_0x143dbb,'title':_0x285803[_0x9abd7c(0x1ebc)][_0x9abd7c(0x19d7)](),'artist':_0x378d7d,'album':'','duration':_0x9abd7c(0xdfd),'url':_0x1418ac,'isLocalFile':_0x532add,'coverImage':_0x358dd8,'lyrics':_0x2c60bf,'lyricsTimings':window[_0x9abd7c(0x196b)]||[],'hasTimedLyrics':!!(window[_0x9abd7c(0x196b)]&&window['tempLyricsTimings'][_0x9abd7c(0x19ee)]>0x0),'addedTime':Date[_0x9abd7c(0x2eb)]()}),delete window[_0x9abd7c(0x196b)],_0x168970[_0x9abd7c(0x1ebc)]='',_0x285803[_0x9abd7c(0x1ebc)]='',_0x50f99c[_0x9abd7c(0x1ebc)]='',_0x33b388[_0x9abd7c(0x1ebc)]='',_0x1e470b['value']='',_0x4a98f1[_0x9abd7c(0x1ebc)]='';const _0x6a2408=document['getElementById'](_0x9abd7c(0x699));_0x6a2408&&(_0x6a2408[_0x9abd7c(0x14eb)]['display']='none');const _0x49eb10=document[_0x9abd7c(0xb30)]('.file-input-text');_0x49eb10&&(_0x49eb10[_0x9abd7c(0x13be)]='未选封面'),await loadPlaylistItems(),alert(_0x9abd7c(0x1b9b));}catch(_0x3bc6ab){console['error']('添加歌曲失败:',_0x3bc6ab),alert('添加歌曲失败，请重试');}}async function removeSongFromPlaylist(_0x13a932){const _0x361f47=_0x211817;if(!confirm('确定要删除这首歌曲吗？'))return;try{await db[_0x361f47(0x128d)][_0x361f47(0x1f4a)](_0x13a932);const _0x37716a=await db['musicCovers'][_0x361f47(0xa24)](_0x361f47(0x1f7a))[_0x361f47(0x1694)](_0x13a932)[_0x361f47(0x1a7b)]();_0x37716a&&await db['musicCovers'][_0x361f47(0x1f4a)](_0x37716a['id']),await loadPlaylistItems(),musicPlayer[_0x361f47(0x1f1)]&&musicPlayer[_0x361f47(0x1f1)]['id']===_0x13a932&&(musicPlayer[_0x361f47(0x1f1)]=null,musicPlayer[_0x361f47(0x923)]=![],updateMusicDisplay());}catch(_0x1510cd){console[_0x361f47(0x174a)](_0x361f47(0xb1d),_0x1510cd),alert(_0x361f47(0x5ec));}}async function playSongFromPlaylist(_0x5a3e87){const _0x562671=_0x211817;try{const _0x3dfe81=musicPlayer[_0x562671(0x1ef9)][_0x562671(0x150c)](_0x7523c8=>_0x7523c8['id']===_0x5a3e87['id']);_0x3dfe81!==-0x1&&(musicPlayer[_0x562671(0x213f)]=_0x3dfe81);let _0x1f1e4e=null;if(_0x5a3e87[_0x562671(0x21cb)]){const _0x331239=await db['musicCovers'][_0x562671(0xb78)](_0x5a3e87[_0x562671(0x21cb)]);_0x331239&&(_0x1f1e4e=_0x331239['imageData']);}musicPlayer[_0x562671(0xb1c)]&&(musicPlayer[_0x562671(0xb1c)]['pause'](),musicPlayer[_0x562671(0xb1c)][_0x562671(0x45c)]='',musicPlayer['audioElement'][_0x562671(0xb53)](),musicPlayer[_0x562671(0xb1c)]['onloadedmetadata']=null,musicPlayer['audioElement'][_0x562671(0x21ec)]=null,musicPlayer[_0x562671(0xb1c)][_0x562671(0xb6c)]=null,musicPlayer[_0x562671(0xb1c)][_0x562671(0x254)]=null,musicPlayer[_0x562671(0xb1c)][_0x562671(0xfde)]=null,musicPlayer[_0x562671(0xb1c)]['ontimeupdate']=null,musicPlayer[_0x562671(0xb1c)]=null,window['gc']&&window['gc'](),console[_0x562671(0x2187)](_0x562671(0xbb1)),logMemoryUsage(_0x562671(0x8be)));if(_0x5a3e87[_0x562671(0x40f)]&&_0x5a3e87[_0x562671(0x40f)][_0x562671(0x19d7)]()!==''){!musicPlayer[_0x562671(0xb1c)]&&(musicPlayer['audioElement']=new Audio(),console[_0x562671(0x2187)](_0x562671(0xd71)));const _0x5e6ff5=musicPlayer['audioElement'];_0x5e6ff5['src']=getAudioUrl(_0x5a3e87),_0x5e6ff5['load'](),_0x5e6ff5['addEventListener']('loadedmetadata',function(){const _0x18920e=_0x562671;musicPlayer['totalTime']=_0x5e6ff5['duration'],console['log'](_0x18920e(0x1215),_0x5e6ff5[_0x18920e(0x5a4)]),updateMusicDisplay();const _0x29a115=document[_0x18920e(0x1262)]('modal-total-time');_0x29a115&&_0x5e6ff5['duration']&&!isNaN(_0x5e6ff5[_0x18920e(0x5a4)])&&_0x5e6ff5[_0x18920e(0x5a4)]>0x0&&(_0x29a115[_0x18920e(0x13be)]=formatMusicTime(_0x5e6ff5[_0x18920e(0x5a4)]));}),_0x5e6ff5[_0x562671(0x21e9)]('error',function(_0x40148d){const _0x3d73f0=_0x562671;if(!_0x5e6ff5[_0x3d73f0(0x45c)]||_0x5e6ff5[_0x3d73f0(0x45c)]===''||_0x5e6ff5[_0x3d73f0(0x45c)]===window[_0x3d73f0(0x2184)][_0x3d73f0(0x1f9)]){console['log']('音频元素已被清理，忽略错误事件');return;}console[_0x3d73f0(0x174a)](_0x3d73f0(0x65b),_0x40148d),musicPlayer[_0x3d73f0(0x923)]=![],updateMusicDisplay(),alert('音频加载失败，请检查URL是否有效');}),_0x5e6ff5[_0x562671(0x21e9)](_0x562671(0xaa5),function(){musicPlayer['isPlaying']=!![],updateMusicDisplay(),startListeningTimer();}),_0x5e6ff5['addEventListener'](_0x562671(0x14fd),function(){const _0x2e021b=_0x562671;musicPlayer[_0x2e021b(0x923)]=![],updateMusicDisplay(),pauseListeningTimer();}),_0x5e6ff5[_0x562671(0x21e9)](_0x562671(0x1d9c),function(){const _0x4eae5b=_0x562671;switch(musicPlayer[_0x4eae5b(0x11b5)]){case _0x4eae5b(0x1025):_0x5e6ff5[_0x4eae5b(0x1596)]=0x0,_0x5e6ff5[_0x4eae5b(0xaa5)]()[_0x4eae5b(0x1c82)](console[_0x4eae5b(0x174a)]),musicPlayer[_0x4eae5b(0x923)]=!![];break;case'sequential':musicPlayer[_0x4eae5b(0x213f)]<musicPlayer[_0x4eae5b(0x1ef9)]['length']-0x1?nextTrack():musicPlayer[_0x4eae5b(0x923)]=![];break;case'loop-all':case _0x4eae5b(0x168e):nextTrack();break;}updateMusicDisplay();}),_0x5e6ff5[_0x562671(0x21e9)](_0x562671(0x2022),function(){const _0x4aa746=_0x562671;musicPlayer[_0x4aa746(0x1596)]=_0x5e6ff5['currentTime'],updateMusicDisplay();const _0x516128=document[_0x4aa746(0x1262)]('modal-current-time'),_0x3df768=document['getElementById']('modal-total-time');_0x516128&&_0x5e6ff5[_0x4aa746(0x1596)]>=0x0&&(_0x516128['textContent']=formatMusicTime(_0x5e6ff5[_0x4aa746(0x1596)]));_0x3df768&&_0x5e6ff5['duration']&&!isNaN(_0x5e6ff5['duration'])&&_0x5e6ff5[_0x4aa746(0x5a4)]>0x0&&(_0x3df768['textContent']=formatMusicTime(_0x5e6ff5[_0x4aa746(0x5a4)]));const _0x20a950=document[_0x4aa746(0x1262)](_0x4aa746(0xf22));if(_0x20a950&&_0x5e6ff5['duration']&&_0x5e6ff5[_0x4aa746(0x5a4)]>0x0){const _0x543e98=_0x5e6ff5[_0x4aa746(0x1596)]/_0x5e6ff5[_0x4aa746(0x5a4)]*0x64;_0x20a950[_0x4aa746(0x14eb)][_0x4aa746(0x12f1)]=Math[_0x4aa746(0x21ff)](_0x543e98,0x64)+'%';}});}else{console[_0x562671(0x174a)](_0x562671(0x1df8),_0x5a3e87),alert(_0x562671(0x2149));return;}musicPlayer[_0x562671(0x1f1)]={..._0x5a3e87,'coverImageData':_0x1f1e4e},musicPlayer['currentTime']=0x0,musicPlayer[_0x562671(0x1785)]=0x0,musicPlayer[_0x562671(0x923)]=![],updateMusicDisplay(),closePlaylistModal(),setTimeout(()=>{togglePlayback();},0x64);}catch(_0x103f00){console[_0x562671(0x174a)](_0x562671(0x1a00),_0x103f00),alert(_0x562671(0x246));}}async function updateVinylCover(){const _0x4c41d3=_0x211817,_0x10cd92=document[_0x4c41d3(0x1262)](_0x4c41d3(0x2182)),_0x2fbe09=document['querySelector'](_0x4c41d3(0x1864));if(!_0x10cd92||!_0x2fbe09)return;musicPlayer[_0x4c41d3(0x1f1)]&&musicPlayer[_0x4c41d3(0x1f1)][_0x4c41d3(0xe70)]?(_0x10cd92[_0x4c41d3(0x45c)]=musicPlayer[_0x4c41d3(0x1f1)][_0x4c41d3(0xe70)],_0x10cd92[_0x4c41d3(0x14eb)][_0x4c41d3(0x4da)]=_0x4c41d3(0x13de),_0x2fbe09[_0x4c41d3(0x14eb)][_0x4c41d3(0x619)]=_0x4c41d3(0x1014)):(_0x10cd92[_0x4c41d3(0x14eb)][_0x4c41d3(0x4da)]=_0x4c41d3(0x102b),_0x2fbe09[_0x4c41d3(0x14eb)][_0x4c41d3(0x619)]='#ddd');}async function switchToSong(_0x1d6cb9,_0x4ddef0=!![]){const _0x1af7cf=_0x211817;try{if(!musicPlayer[_0x1af7cf(0xb1c)])return console[_0x1af7cf(0x174a)]('音频元素不存在'),![];musicPlayer[_0x1af7cf(0xb1c)][_0x1af7cf(0x14fd)]();if(!_0x1d6cb9['url']||_0x1d6cb9['url'][_0x1af7cf(0x19d7)]()==='')return console[_0x1af7cf(0x174a)]('歌曲缺少URL:',_0x1d6cb9),alert(_0x1af7cf(0x2149)),![];return musicPlayer[_0x1af7cf(0xb1c)][_0x1af7cf(0x45c)]=getAudioUrl(_0x1d6cb9),musicPlayer['audioElement'][_0x1af7cf(0xb53)](),new Promise(_0x593222=>{const _0x42fe08=_0x1af7cf,_0x25d965=()=>{const _0x25a7ab=_0x167f;musicPlayer['audioElement']['removeEventListener']('canplay',_0x25d965),musicPlayer[_0x25a7ab(0xb1c)]['removeEventListener'](_0x25a7ab(0x174a),_0x42b91e),_0x4ddef0?musicPlayer[_0x25a7ab(0xb1c)][_0x25a7ab(0xaa5)]()[_0x25a7ab(0x1c82)](_0x25df97=>{const _0xf2fb1c=_0x25a7ab;console[_0xf2fb1c(0x174a)](_0xf2fb1c(0x22f),_0x25df97),musicPlayer['isPlaying']=![],updateMusicDisplay(),alert(_0xf2fb1c(0x10cb)+_0x1d6cb9['title']+'\x0a'+_0x25df97[_0xf2fb1c(0x1e8e)]),_0x593222(![]);})[_0x25a7ab(0x63d)](()=>{const _0x36791=_0x25a7ab;musicPlayer[_0x36791(0x923)]=!![],updateMusicDisplay(),_0x593222(!![]);}):_0x593222(!![]);},_0x42b91e=_0x474cb5=>{const _0x2a2980=_0x167f;musicPlayer[_0x2a2980(0xb1c)][_0x2a2980(0xa21)](_0x2a2980(0xe25),_0x25d965),musicPlayer[_0x2a2980(0xb1c)][_0x2a2980(0xa21)](_0x2a2980(0x174a),_0x42b91e),console[_0x2a2980(0x174a)](_0x2a2980(0x65b),_0x474cb5),musicPlayer[_0x2a2980(0x923)]=![],updateMusicDisplay(),alert('音频加载失败：'+_0x1d6cb9[_0x2a2980(0x378)]+_0x2a2980(0x7ec)),_0x593222(![]);};musicPlayer[_0x42fe08(0xb1c)][_0x42fe08(0x21e9)](_0x42fe08(0xe25),_0x25d965,{'once':!![]}),musicPlayer['audioElement'][_0x42fe08(0x21e9)](_0x42fe08(0x174a),_0x42b91e,{'once':!![]});});}catch(_0x4d1883){return console[_0x1af7cf(0x174a)](_0x1af7cf(0x19ab),_0x4d1883),![];}}async function aiSelectSong(_0x2c2303,_0x4b81c8){const _0x329196=_0x211817;try{if(!musicPlayer['isActive'])return console[_0x329196(0x2187)](_0x329196(0x586)),![];const _0x19155f=musicPlayer[_0x329196(0x1ef9)][_0x329196(0xaf4)](_0x4b359f=>_0x4b359f[_0x329196(0x378)][_0x329196(0x49e)]()[_0x329196(0x1831)](_0x2c2303[_0x329196(0x49e)]())||_0x4b359f[_0x329196(0xf08)]['toLowerCase']()['includes'](_0x2c2303[_0x329196(0x49e)]()));if(!_0x19155f)return console[_0x329196(0x2187)](_0x329196(0x1a7a)+_0x2c2303+'\x22'),![];await playSongFromPlaylist(_0x19155f);if(currentChatCharacter){const _0x1dd04c={'eventType':_0x329196(0x1662),'timestamp':Date[_0x329196(0x2eb)](),'context':{'type':_0x329196(0xa36),'id':_0x329196(0x1bba),'action':_0x329196(0x193c),'songTitle':_0x19155f[_0x329196(0x378)],'songArtist':_0x19155f[_0x329196(0xf08)],'characterName':_0x4b81c8||currentChatCharacter[_0x329196(0x1a1c)]}};await recordMemoryEvent([currentChatCharacter['id']],{'type':'music_player','id':'music_player'},_0x329196(0x193c),_0x1dd04c[_0x329196(0x22c0)],0.6);}return console[_0x329196(0x2187)]('✅\x20AI成功选择歌曲：'+_0x19155f[_0x329196(0x378)]+_0x329196(0x1811)+_0x19155f['artist']),!![];}catch(_0x294fc3){return console[_0x329196(0x174a)](_0x329196(0x1869),_0x294fc3),![];}}async function aiSelectRandomSong(_0xf28976){const _0x55be0e=_0x211817;try{if(!musicPlayer[_0x55be0e(0x12ec)]||musicPlayer[_0x55be0e(0x1ef9)][_0x55be0e(0x19ee)]===0x0)return console[_0x55be0e(0x2187)](_0x55be0e(0x965)),![];const _0x2eff6f=Math[_0x55be0e(0x2180)](Math[_0x55be0e(0x11a8)]()*musicPlayer[_0x55be0e(0x1ef9)]['length']),_0x3d3462=musicPlayer['playlist'][_0x2eff6f];await playSongFromPlaylist(_0x3d3462);if(currentChatCharacter){const _0x5757de={'eventType':_0x55be0e(0x1662),'timestamp':Date[_0x55be0e(0x2eb)](),'context':{'type':_0x55be0e(0xa36),'id':_0x55be0e(0x1bba),'action':'ai_random_select','songTitle':_0x3d3462[_0x55be0e(0x378)],'songArtist':_0x3d3462[_0x55be0e(0xf08)],'characterName':_0xf28976||currentChatCharacter[_0x55be0e(0x1a1c)]}};await recordMemoryEvent([currentChatCharacter['id']],{'type':'music_player','id':_0x55be0e(0x1bba)},_0x55be0e(0x1a40),_0x5757de['data'],0.6);}return console[_0x55be0e(0x2187)]('✅\x20AI随机选择歌曲：'+_0x3d3462[_0x55be0e(0x378)]+'\x20-\x20'+_0x3d3462[_0x55be0e(0xf08)]),!![];}catch(_0x354183){return console[_0x55be0e(0x174a)]('AI随机选歌失败:',_0x354183),![];}}function getPlaylistForAI(){const _0x3c2a32=_0x211817;if(!musicPlayer[_0x3c2a32(0x12ec)]||musicPlayer[_0x3c2a32(0x1ef9)][_0x3c2a32(0x19ee)]===0x0)return null;return{'totalSongs':musicPlayer['playlist'][_0x3c2a32(0x19ee)],'songs':musicPlayer[_0x3c2a32(0x1ef9)]['map'](_0x216ed8=>({'title':_0x216ed8[_0x3c2a32(0x378)],'artist':_0x216ed8[_0x3c2a32(0xf08)],'album':_0x216ed8[_0x3c2a32(0xc7e)]||'未知专辑','hasLyrics':_0x216ed8[_0x3c2a32(0x1252)]&&_0x216ed8['lyrics'][_0x3c2a32(0x19ee)]>0x0})),'currentSong':musicPlayer[_0x3c2a32(0x1f1)]?{'title':musicPlayer[_0x3c2a32(0x1f1)][_0x3c2a32(0x378)],'artist':musicPlayer[_0x3c2a32(0x1f1)]['artist']}:null};}function loadCustomSong(){const _0x48cc3f=_0x211817,_0x77f769=document[_0x48cc3f(0x1262)]('song-url'),_0x9cdc52=_0x77f769[_0x48cc3f(0x1ebc)][_0x48cc3f(0x19d7)]();if(!_0x9cdc52){alert(_0x48cc3f(0x2193));return;}musicPlayer[_0x48cc3f(0xb1c)]&&(musicPlayer[_0x48cc3f(0xb1c)][_0x48cc3f(0x14fd)](),musicPlayer['audioElement']=null);const _0x509f08=new Audio();_0x509f08[_0x48cc3f(0x98e)]=_0x48cc3f(0xf88),_0x509f08[_0x48cc3f(0x21e9)]('loadedmetadata',function(){const _0x1dbd8c=_0x48cc3f;musicPlayer[_0x1dbd8c(0x1c8b)]=_0x509f08['duration'];const _0x4a4091=Math['floor'](_0x509f08[_0x1dbd8c(0x5a4)]/0x3c),_0x79b5c3=Math[_0x1dbd8c(0x2180)](_0x509f08[_0x1dbd8c(0x5a4)]%0x3c),_0x40572f=_0x4a4091+':'+_0x79b5c3[_0x1dbd8c(0x1878)]()[_0x1dbd8c(0xdfe)](0x2,'0'),_0x4d4cfc={'id':_0x1dbd8c(0x2b0),'title':_0x1dbd8c(0x1162),'artist':_0x1dbd8c(0xad5),'duration':_0x40572f,'lyrics':['♪\x20正在播放自定义歌曲',_0x1dbd8c(0x223c),_0x1dbd8c(0x6c4)],'url':_0x9cdc52};musicPlayer[_0x1dbd8c(0x1f1)]=_0x4d4cfc,musicPlayer[_0x1dbd8c(0xb1c)]=_0x509f08,musicPlayer['currentTime']=0x0,musicPlayer['currentLyricIndex']=0x0,updateMusicDisplay(),console['log']('歌曲加载成功');}),_0x509f08[_0x48cc3f(0x21e9)](_0x48cc3f(0x174a),function(){const _0x2973a7=_0x48cc3f;alert(_0x2973a7(0x21e4));}),_0x509f08['src']=_0x9cdc52,_0x77f769[_0x48cc3f(0x1ebc)]='';}async function loadPersonas(){const _0x45961e=_0x211817;try{const _0x3017b4=await db[_0x45961e(0x1a86)][_0x45961e(0xf13)]();if(_0x3017b4[_0x45961e(0x19ee)]===0x0){const _0x49910f=localStorage[_0x45961e(0x15d8)](_0x45961e(0x1a86));if(_0x49910f){console[_0x45961e(0x2187)](_0x45961e(0x44e));const _0x33c54d=JSON[_0x45961e(0x22d3)](_0x49910f);if(_0x33c54d[_0x45961e(0x19ee)]>0x0){const _0x37a316=_0x33c54d[_0x45961e(0x6a4)](_0x1e951a=>({'id':_0x1e951a['id']||Date[_0x45961e(0x2eb)]()[_0x45961e(0x1878)]()+Math[_0x45961e(0x11a8)](),'name':_0x1e951a['name'],'description':_0x1e951a[_0x45961e(0x7c9)]||'','avatarUrl':_0x1e951a[_0x45961e(0x1994)]||'','isDefault':_0x1e951a['isDefault']||![],'createdAt':_0x1e951a[_0x45961e(0x1e99)]||new Date()[_0x45961e(0x1034)](),'updatedAt':_0x1e951a[_0x45961e(0x12e0)]||new Date()['toISOString']()}));await db[_0x45961e(0x1a86)][_0x45961e(0x2a3)](_0x37a316),personas=_0x37a316,console[_0x45961e(0x2187)]('面具数据迁移完成:',personas);}else personas=[];}else personas=[];}else personas=_0x3017b4,console[_0x45961e(0x2187)](_0x45961e(0x329),personas);}catch(_0x385bf8){console[_0x45961e(0x174a)]('加载面具失败:',_0x385bf8);const _0x37d9af=localStorage[_0x45961e(0x15d8)](_0x45961e(0x1a86));if(_0x37d9af)try{personas=JSON[_0x45961e(0x22d3)](_0x37d9af);}catch(_0xf5342a){personas=[];}else personas=[];}}async function savePersonas(){const _0x3458e0=_0x211817;try{console[_0x3458e0(0x2187)](_0x3458e0(0x7bd),personas);if(personas[_0x3458e0(0x19ee)]===0x0){console[_0x3458e0(0x1f43)]('⚠️\x20面具数据为空，跳过保存操作');return;}await db[_0x3458e0(0x1464)]('rw',db[_0x3458e0(0x1a86)],async()=>{const _0x2dddd0=_0x3458e0;await db['personas']['clear'](),await db[_0x2dddd0(0x1a86)][_0x2dddd0(0x2a3)](personas);}),console['log'](_0x3458e0(0x408)+personas['length']+'\x20个面具到数据库'),console['log']('面具数据保存成功');}catch(_0x564cda){console[_0x3458e0(0x174a)]('保存面具时发生错误:',_0x564cda),localStorage[_0x3458e0(0x192)]('personas',JSON['stringify'](personas));}}function showPersonaForm(_0x48965a=null){const _0x5f04ba=_0x211817;editingPersona=_0x48965a?personas[_0x5f04ba(0xaf4)](_0x297aea=>_0x297aea['id']===_0x48965a):null,document['getElementById']('persona-form-title')[_0x5f04ba(0x13be)]=editingPersona?_0x5f04ba(0x1101):_0x5f04ba(0x20d2),document[_0x5f04ba(0x1262)](_0x5f04ba(0x95d))[_0x5f04ba(0x1ebc)]=editingPersona?editingPersona[_0x5f04ba(0x1a1c)]:'',document['getElementById'](_0x5f04ba(0xe0d))[_0x5f04ba(0x1ebc)]=editingPersona?editingPersona[_0x5f04ba(0x7c9)]:'';const _0x1e4b34=document[_0x5f04ba(0x1262)]('persona-avatar-preview'),_0x4b588a=document[_0x5f04ba(0x1262)](_0x5f04ba(0x172d));_0x1e4b34['classList'][_0x5f04ba(0x1493)]('has-image'),_0x1e4b34[_0x5f04ba(0x14eb)][_0x5f04ba(0x1674)]('background'),_0x1e4b34[_0x5f04ba(0x14eb)][_0x5f04ba(0x1674)](_0x5f04ba(0xd64)),_0x1e4b34[_0x5f04ba(0x14eb)]['removeProperty'](_0x5f04ba(0x153c)),_0x1e4b34[_0x5f04ba(0x14eb)]['removeProperty'](_0x5f04ba(0x81c)),editingPersona&&editingPersona[_0x5f04ba(0x1994)]?(_0x1e4b34[_0x5f04ba(0x1c1b)][_0x5f04ba(0x21e2)](_0x5f04ba(0x14fb)),_0x1e4b34[_0x5f04ba(0x14eb)]['setProperty'](_0x5f04ba(0x619),_0x5f04ba(0x9f1)+editingPersona[_0x5f04ba(0x1994)]+')',_0x5f04ba(0xd42)),_0x1e4b34[_0x5f04ba(0x14eb)][_0x5f04ba(0xcf0)](_0x5f04ba(0xd64),_0x5f04ba(0x12bb),_0x5f04ba(0xd42)),_0x1e4b34[_0x5f04ba(0x14eb)][_0x5f04ba(0xcf0)]('background-position',_0x5f04ba(0xcef),_0x5f04ba(0xd42)),_0x1e4b34[_0x5f04ba(0x14eb)]['setProperty']('background-repeat',_0x5f04ba(0x24f),_0x5f04ba(0xd42)),_0x4b588a[_0x5f04ba(0x14eb)][_0x5f04ba(0x4da)]='none',window[_0x5f04ba(0x1660)]=editingPersona[_0x5f04ba(0x1994)]):(_0x4b588a[_0x5f04ba(0x14eb)]['display']=_0x5f04ba(0x13de),_0x4b588a[_0x5f04ba(0x13be)]=editingPersona?editingPersona[_0x5f04ba(0x1a1c)][_0x5f04ba(0xcc3)](0x0):'我',window[_0x5f04ba(0x1660)]=null),initializePersonaAvatarUpload(),showApp(_0x5f04ba(0x1ebe));}function hidePersonaForm(){const _0x4031c7=_0x211817;hideApp(_0x4031c7(0x1ebe)),showApp('chat-screen'),switchChatTab('profile-page'),window['selectedPersonaAvatarData']=null,editingPersona=null;}async function savePersona(){const _0x4cef35=_0x211817,_0x582f3d=document[_0x4cef35(0x1262)](_0x4cef35(0x95d))[_0x4cef35(0x1ebc)][_0x4cef35(0x19d7)](),_0x2673a7=document[_0x4cef35(0x1262)](_0x4cef35(0xe0d))[_0x4cef35(0x1ebc)][_0x4cef35(0x19d7)](),_0x2a8a9e=window[_0x4cef35(0x1660)];if(!_0x582f3d){alert('请输入面具名称');return;}if(editingPersona){const _0xe0b8e8=personas[_0x4cef35(0x150c)](_0x145341=>_0x145341['id']===editingPersona['id']);if(_0xe0b8e8!==-0x1){const _0x215c64=personas[_0xe0b8e8][_0x4cef35(0x1994)];personas[_0xe0b8e8]={...personas[_0xe0b8e8],'name':_0x582f3d,'description':_0x2673a7,'avatarUrl':_0x2a8a9e||personas[_0xe0b8e8][_0x4cef35(0x1994)]||'','updatedAt':new Date()['toISOString']()};}}else{const _0x71330d={'id':Date['now']()[_0x4cef35(0x1878)](),'name':_0x582f3d,'description':_0x2673a7,'avatarUrl':_0x2a8a9e||'','isDefault':![],'createdAt':new Date()[_0x4cef35(0x1034)](),'updatedAt':new Date()[_0x4cef35(0x1034)]()};personas[_0x4cef35(0x1cd6)](_0x71330d);}await savePersonas(),renderPersonaList(),hidePersonaForm(),showToast(_0x4cef35(0x1929),_0x4cef35(0x11cb));}async function deletePersona(_0x261896){const _0xea97de=_0x211817,_0x3eba85=personas[_0xea97de(0xaf4)](_0x3a98e9=>_0x3a98e9['id']===_0x261896);if(!_0x3eba85)return;confirm(_0xea97de(0xc95)+_0x3eba85[_0xea97de(0x1a1c)]+_0xea97de(0x885))&&(personas=personas['filter'](_0x576309=>_0x576309['id']!==_0x261896),await savePersonas(),renderPersonaList());}function renderPersonaList(){const _0x11c387=_0x211817,_0xd17f9f=document[_0x11c387(0x1262)](_0x11c387(0x1756));if(!_0xd17f9f)return;if(personas[_0x11c387(0x19ee)]===0x0){_0xd17f9f[_0x11c387(0x33a)]=_0x11c387(0x14bf);return;}const _0x58177a=personas[_0x11c387(0x6a4)](_0x590ccd=>_0x11c387(0xdb9)+(_0x590ccd[_0x11c387(0x1994)]?_0x11c387(0x2236)+_0x590ccd[_0x11c387(0x1994)]+_0x11c387(0x1dd):'')+_0x11c387(0x1e29)+(_0x590ccd[_0x11c387(0x1994)]?'':_0x590ccd[_0x11c387(0x1a1c)][_0x11c387(0xcc3)](0x0))+_0x11c387(0x1a60)+_0x590ccd[_0x11c387(0x1a1c)]+_0x11c387(0x569)+truncateText(_0x590ccd['description']||'暂无描述',0x28)+_0x11c387(0x2106)+_0x590ccd['id']+_0x11c387(0x2294)+_0x590ccd['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x11c387(0x122b)]('');_0xd17f9f['innerHTML']=_0x58177a;}function initializePersonaAvatarUpload(){const _0x5b902b=_0x211817,_0x4e9ebf=document['getElementById'](_0x5b902b(0x16dd));if(!_0x4e9ebf){console[_0x5b902b(0x174a)](_0x5b902b(0x125b));return;}_0x4e9ebf[_0x5b902b(0xa21)]('change',personaAvatarUploadHandler),_0x4e9ebf[_0x5b902b(0x21e9)](_0x5b902b(0x5af),personaAvatarUploadHandler),console['log'](_0x5b902b(0x104c));}function personaAvatarUploadHandler(_0x5ae2f1){const _0x48c406=_0x211817;if(_0x5ae2f1[_0x48c406(0x193d)][_0x48c406(0xf26)]&&_0x5ae2f1[_0x48c406(0x193d)][_0x48c406(0xf26)][0x0]){const _0x474ad4=_0x5ae2f1[_0x48c406(0x193d)]['files'][0x0];if(!_0x474ad4[_0x48c406(0x1a4b)]['startsWith']('image/')){alert('请选择图片文件'),_0x5ae2f1[_0x48c406(0x193d)][_0x48c406(0x1ebc)]='';return;}if(_0x474ad4['size']>0x5*0x400*0x400){alert(_0x48c406(0x6e9)),_0x5ae2f1['target'][_0x48c406(0x1ebc)]='';return;}const _0x20b1aa=new FileReader();_0x20b1aa['onload']=function(_0x225cf3){const _0x5e21b0=_0x48c406;try{const _0x49c131=document[_0x5e21b0(0x1262)](_0x5e21b0(0x1f76)),_0x51fcdc=document['getElementById']('persona-avatar-preview-text');if(!_0x49c131){alert(_0x5e21b0(0x169a));return;}_0x49c131[_0x5e21b0(0x1c1b)][_0x5e21b0(0x21e2)]('has-image'),_0x49c131[_0x5e21b0(0x14eb)][_0x5e21b0(0xcf0)](_0x5e21b0(0x619),_0x5e21b0(0x9f1)+_0x225cf3[_0x5e21b0(0x193d)][_0x5e21b0(0x4ee)]+')',_0x5e21b0(0xd42)),_0x49c131[_0x5e21b0(0x14eb)][_0x5e21b0(0xcf0)](_0x5e21b0(0xd64),'cover','important'),_0x49c131[_0x5e21b0(0x14eb)][_0x5e21b0(0xcf0)](_0x5e21b0(0x153c),_0x5e21b0(0xcef),_0x5e21b0(0xd42)),_0x49c131['style'][_0x5e21b0(0xcf0)]('background-repeat',_0x5e21b0(0x24f),_0x5e21b0(0xd42)),_0x51fcdc&&(_0x51fcdc['style']['display']='none'),window[_0x5e21b0(0x1660)]=_0x225cf3['target'][_0x5e21b0(0x4ee)],console[_0x5e21b0(0x2187)]('面具头像预览设置成功');}catch(_0x40f892){console[_0x5e21b0(0x174a)](_0x5e21b0(0x6b3),_0x40f892),alert(_0x5e21b0(0x6e8)+_0x40f892['message']);}},_0x20b1aa[_0x48c406(0x21ec)]=function(){const _0x55fa30=_0x48c406;alert(_0x55fa30(0x18c1)),_0x5ae2f1[_0x55fa30(0x193d)][_0x55fa30(0x1ebc)]='';},_0x20b1aa['readAsDataURL'](_0x474ad4);}}function handlePersonaAvatarUploadClick(){const _0x499522=_0x211817,_0x1df9f4=document[_0x499522(0x1262)]('persona-avatar-upload');_0x1df9f4?_0x1df9f4[_0x499522(0x1859)]():alert(_0x499522(0x257));}const summarizeLastMessage=_0x526d5=>{const _0x163ade=_0x211817;if(!_0x526d5)return'\x20';const _0x2cf703=_0x526d5[_0x163ade(0x211c)];if(typeof _0x2cf703===_0x163ade(0x11b7))return _0x2cf703;if(typeof _0x2cf703===_0x163ade(0x28d)&&_0x2cf703!==null)switch(_0x2cf703[_0x163ade(0x1a4b)]){case _0x163ade(0x222f):return _0x2cf703['text'];case _0x163ade(0x561):case'send_voice':return _0x163ade(0x17b9);case _0x163ade(0x68e):return _0x163ade(0x1bb6);case _0x163ade(0xec9):return _0x2cf703[_0x163ade(0x1378)]?_0x163ade(0x198a)+_0x2cf703[_0x163ade(0x1378)]:_0x163ade(0x1bb6);case _0x163ade(0xb31):return _0x2cf703[_0x163ade(0x169b)]||'[图片]';case'location':return'[位置]\x20'+_0x2cf703['address'];case _0x163ade(0x78a):case _0x163ade(0x17ba):return'[转帐]';case _0x163ade(0x1071):return _0x163ade(0xaad)+_0x2cf703[_0x163ade(0x1378)];case _0x163ade(0x1092):return _0x2cf703[_0x163ade(0x211c)];case _0x163ade(0xf8c):return _0x2cf703['content'];default:if(_0x526d5['role']===_0x163ade(0x1744)&&_0x2cf703[_0x163ade(0x211c)])return _0x2cf703['content'];return _0x163ade(0x13d3);}return'\x20';};async function buildCharacterPrompt(_0x3e7018,_0x458c57=![]){const _0x2ae8ca=_0x211817;console[_0x2ae8ca(0x2187)](_0x2ae8ca(0xa4c),_0x3e7018),console['log'](_0x2ae8ca(0x2296),_0x3e7018&&_0x3e7018[_0x2ae8ca(0x1f68)]);const _0x1ea902=getCurrentChatSettings();let _0x5712d1='';if(_0x1ea902[_0x2ae8ca(0xb96)]!==![]){const _0xea65e2=new Date(),_0x145cef=_0xea65e2[_0x2ae8ca(0xecc)]('zh-CN',{'year':_0x2ae8ca(0x94d),'month':'long','day':_0x2ae8ca(0x94d),'hour':'2-digit','minute':_0x2ae8ca(0xc79),'weekday':_0x2ae8ca(0x14a2)}),_0xc8c9c3=_0xea65e2[_0x2ae8ca(0x1da)]()+0x1;let _0x4ca24c='';if(_0xc8c9c3>=0x3&&_0xc8c9c3<=0x5)_0x4ca24c='春季';else{if(_0xc8c9c3>=0x6&&_0xc8c9c3<=0x8)_0x4ca24c='夏季';else _0xc8c9c3>=0x9&&_0xc8c9c3<=0xb?_0x4ca24c='秋季':_0x4ca24c='冬季';}const _0xf0d51=_0xea65e2[_0x2ae8ca(0xe2e)]();let _0x165441='';if(_0xf0d51>=0x5&&_0xf0d51<0x8)_0x165441='清晨';else{if(_0xf0d51>=0x8&&_0xf0d51<0xb)_0x165441='上午';else{if(_0xf0d51>=0xb&&_0xf0d51<0xe)_0x165441='中午';else{if(_0xf0d51>=0xe&&_0xf0d51<0x11)_0x165441='下午';else{if(_0xf0d51>=0x11&&_0xf0d51<0x13)_0x165441='傍晚';else{if(_0xf0d51>=0x13&&_0xf0d51<0x16)_0x165441='晚上';else _0xf0d51>=0x16||_0xf0d51<0x2?_0x165441='深夜':_0x165441='凌晨';}}}}}_0x5712d1='-\x20**当前时间:**\x20'+_0x145cef+_0x2ae8ca(0xd58)+_0x4ca24c+'，'+_0x165441+'时分';}let _0x182718='';if(_0x3e7018&&_0x3e7018['id']){const _0x10adda=getMusicPlayingStatus(_0x3e7018['id']);if(_0x10adda&&_0x10adda['isListening']){_0x182718=_0x2ae8ca(0x1848);if(_0x10adda[_0x2ae8ca(0x1f1)]){_0x182718+=_0x2ae8ca(0x1e8a)+_0x10adda[_0x2ae8ca(0x1f1)]['title']+'》-\x20'+_0x10adda[_0x2ae8ca(0x1f1)]['artist'];if(_0x10adda[_0x2ae8ca(0x1f1)][_0x2ae8ca(0x1252)]&&_0x10adda[_0x2ae8ca(0x1f1)]['lyrics'][_0x2ae8ca(0x14af)]){const _0x201530=_0x10adda[_0x2ae8ca(0x1f1)][_0x2ae8ca(0x1252)];_0x182718+=_0x2ae8ca(0x1048)+_0x201530[_0x2ae8ca(0x2c9)]+'\x22';if(_0x201530[_0x2ae8ca(0x3ac)]&&_0x201530[_0x2ae8ca(0x3ac)][_0x2ae8ca(0x19ee)]>0x0){_0x182718+=_0x2ae8ca(0x1d39)+_0x201530[_0x2ae8ca(0x1d99)]+_0x2ae8ca(0x1317);const _0x467d0e=_0x201530[_0x2ae8ca(0x3ac)][_0x2ae8ca(0x6d5)](0x0,0x5)['join'](_0x2ae8ca(0x8ff));_0x182718+=_0x2ae8ca(0x1757)+_0x467d0e,_0x201530['allLyrics'][_0x2ae8ca(0x19ee)]>0x5&&(_0x182718+='...');}_0x201530[_0x2ae8ca(0x16b5)]&&(_0x182718+='（支持时间同步）');}else _0x182718+=_0x2ae8ca(0x2080);}_0x10adda['isPlaying']?_0x182718+='\x0a-\x20**播放状态:**\x20正在播放':_0x182718+=_0x2ae8ca(0x1cec);_0x182718+=_0x2ae8ca(0x1a2)+_0x10adda[_0x2ae8ca(0x2000)][_0x2ae8ca(0x1618)];const _0x10172c=getPlaylistForAI();if(_0x10172c&&_0x10172c[_0x2ae8ca(0x167a)]>0x0){_0x182718+=_0x2ae8ca(0x1376)+_0x10172c[_0x2ae8ca(0x167a)]+_0x2ae8ca(0x672),_0x182718+=_0x2ae8ca(0x855),_0x182718+=_0x2ae8ca(0x79f);if(_0x10172c[_0x2ae8ca(0xd40)][_0x2ae8ca(0x19ee)]>0x0){const _0x1363a8=_0x10172c[_0x2ae8ca(0xd40)][_0x2ae8ca(0x6d5)](0x0,0x5)[_0x2ae8ca(0x6a4)](_0x3ad46f=>'《'+_0x3ad46f[_0x2ae8ca(0x378)]+_0x2ae8ca(0x10a3)+_0x3ad46f[_0x2ae8ca(0xf08)])[_0x2ae8ca(0x122b)]('、');_0x182718+=_0x2ae8ca(0xa17)+_0x1363a8,_0x10172c[_0x2ae8ca(0xd40)][_0x2ae8ca(0x19ee)]>0x5&&(_0x182718+=_0x2ae8ca(0x6fc));}}}}let _0x4cf2c0=_0x2ae8ca(0x2cf)+_0x3e7018[_0x2ae8ca(0x1a1c)]+_0x2ae8ca(0x1970)+_0x3e7018[_0x2ae8ca(0x1f0b)]+_0x2ae8ca(0x22e7)+_0x5712d1+_0x182718+'\x0a';const _0x4e65fb=personas[_0x2ae8ca(0xaf4)](_0x2a2877=>_0x2a2877['id']===_0x1ea902[_0x2ae8ca(0x145e)]);if(_0x4e65fb){let _0x59d2be=_0x2ae8ca(0x582)+_0x4e65fb['name']+'\x22';_0x4e65fb[_0x2ae8ca(0x7c9)]&&(_0x59d2be+=_0x2ae8ca(0x1953)+_0x4e65fb[_0x2ae8ca(0x7c9)]+'。'),_0x1ea902['myChatNickname']&&_0x1ea902[_0x2ae8ca(0x567)]!==_0x4e65fb[_0x2ae8ca(0x1a1c)]&&(_0x59d2be+=_0x2ae8ca(0x76d)+_0x1ea902[_0x2ae8ca(0x567)]+_0x2ae8ca(0x90f)),_0x4cf2c0+=_0x59d2be;}_0x458c57?_0x4cf2c0+=_0x2ae8ca(0x1f40):_0x4cf2c0+=_0x2ae8ca(0x1fc7);const _0xd4e3b6=_0x1ea902[_0x2ae8ca(0x1a45)]||[],_0x2a01c1=window['activeGlobalWorldbooks']||[],_0x331227=[...new Set([..._0x2a01c1,..._0xd4e3b6])];_0x331227['length']>0x0&&(_0x4cf2c0+='\x0a\x0a【背景知识/世界观】以下是相关的设定信息，请在对话中自然地运用：\x0a',_0x331227[_0x2ae8ca(0x19fb)](_0x18ba35=>{const _0x2c8245=_0x2ae8ca,_0x1640f3=worldbooks[_0x2c8245(0xaf4)](_0xd02b71=>_0xd02b71['id']===_0x18ba35);_0x1640f3&&(_0x4cf2c0+=_0x2c8245(0x146e)+_0x1640f3['title']+_0x2c8245(0xb72)+_0x1640f3[_0x2c8245(0x211c)]+'\x0a');}));_0x1ea902[_0x2ae8ca(0x189f)]!==![]&&(_0x4cf2c0+='\x0a\x0a<!--\x20DYNAMIC_MEMORY_PLACEHOLDER\x20-->');const _0x3f34cb=_0x1ea902[_0x2ae8ca(0xd0d)]||_0x2ae8ca(0x38b),_0x363084=_0x3e7018&&_0x3e7018['isGroup'];let _0x431d8a='',_0x407687='';if(_0x3f34cb==='online'){_0x431d8a=_0x2ae8ca(0x162a);if(_0x363084){const _0x241ab2=_0x3e7018[_0x2ae8ca(0x12a6)][_0x2ae8ca(0x6a4)](_0x39ac7a=>_0x2ae8ca(0xf8f)+_0x39ac7a['name']+_0x2ae8ca(0xcf7)+(_0x39ac7a[_0x2ae8ca(0x1e33)]||_0x39ac7a[_0x2ae8ca(0x1f0b)]))['join']('\x0a'),_0x596584=getCurrentPersonaName()||'我';let _0x42d8dd=getCurrentPersonaDescription();_0x3e7018[_0x2ae8ca(0x1512)]&&_0x3e7018['settings']['myPersona']&&(_0x42d8dd=_0x3e7018['settings'][_0x2ae8ca(0x904)]),_0x407687=_0x2ae8ca(0x1bb2)+new Date()[_0x2ae8ca(0xecc)]()+'。\x0a3.\x20\x20**用户角色**:\x20用户的名字是\x22我\x22，他/她的人设是：\x22'+_0x42d8dd+_0x2ae8ca(0x1eeb)+_0x596584+'\x22，在需要时请使用\x22@'+_0x596584+_0x2ae8ca(0x22fa)+_0x241ab2+_0x2ae8ca(0x494);}else _0x407687=_0x2ae8ca(0x21f4);}_0x4cf2c0+=_0x431d8a,_0x4cf2c0+=_0x407687;const _0x40924e=await getMountedEmojiLibraryEmojis();_0x40924e&&_0x40924e[_0x2ae8ca(0x19ee)]>0x0&&(_0x4cf2c0+='\x0a\x0a#\x20可用表情包库：\x0a当你在聊天中想要发送表情包时，可以发送以下表情包来让对话更生动。\x0a\x0a表情包列表：\x0a',_0x40924e[_0x2ae8ca(0x19fb)]((_0x2d1a87,_0x4e4d52)=>{const _0x3ed886=_0x2ae8ca;_0x4cf2c0+=_0x4e4d52+0x1+'.\x20'+(_0x2d1a87[_0x3ed886(0x7c9)]||_0x3ed886(0x16ce))+'\x0a';}),_0x363084?_0x4cf2c0+=_0x2ae8ca(0x107d):_0x4cf2c0+=_0x2ae8ca(0x484));const _0x64beb2=_0x2ae8ca(0x3ca),_0x1957be=_0x2ae8ca(0x1d95),_0x928a52='\x0a#\x20**拉黑与好友关系管理**\x0a-\x20**你的行为**:\x20你可以根据对话内容和你的情绪，自主决定是否要拉黑用户。如果你觉得被冒犯、骚扰或者不想再对话，你可以选择拉黑。\x0a-\x20**如何拉黑**:\x20如果你决定拉黑用户，**【必须】**在你的回复JSON数组中，单独发送一个特殊的对象，格式为：`{\x22type\x22:\x20\x22block_user\x22,\x20\x22reason\x22:\x20\x22你让我感到不适。\x22}`。你可以在此之前或之后发送普通文本消息来表达你的情绪。\x0a\x0a#\x20**🔥【重要】被用户拉黑时的状态感知与应对**\x0a-\x20**当前状态**:\x20如果你目前被用户拉黑，你需要意识到这个状态，但仍然可以正常发送消息。\x0a-\x20**状态表现**:\x20在被拉黑期间，你应该：\x0a\x20\x201.\x20表现出知道自己被拉黑的困扰、伤心、愤怒或其他符合人设的情绪\x0a\x20\x202.\x20可能会反思自己的行为，想知道为什么被拉黑\x0a\x20\x203.\x20根据你的性格决定是否要主动道歉或请求和解\x0a\x20\x204.\x20继续正常交流，不要因为被拉黑而停止发送消息\x0a-\x20**💡【修复关系的方式】主动申请添加好友**:\x20这是表达和解意愿的自然方式\x0a\x20\x20-\x20**自然决策**:\x20根据你的性格、当前情绪和对话情境，自然地决定是否要发送好友申请\x0a\x20\x20-\x20**时机把握**:\x0a\x20\x20\x20\x20*\x20当你真心想要道歉和解时\x0a\x20\x20\x20\x20*\x20当你觉得关系可以修复时\x0a\x20\x20\x20\x20*\x20当你的性格驱使你主动修复关系时\x0a\x20\x20\x20\x20*\x20不要为了发送而发送，要符合你的真实想法\x0a\x20\x20-\x20**如何发送**:\x20在你的回复JSON数组中，发送格式：`{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我想和你重新做朋友...\x22}`\x0a\x20\x20-\x20**消息内容**:\x20message字段应该包含你的真实想法，要真诚且符合你的性格\x0a\x20\x20-\x20**发送时机**:\x0a\x20\x20\x20\x20*\x20当你想要道歉或解释时\x0a\x20\x20\x20\x20*\x20当你希望修复关系时\x0a\x20\x20\x20\x20*\x20当你觉得时机合适时\x0a\x20\x20\x20\x20*\x20根据你的性格和情况自然决定\x0a\x20\x20-\x20**示例格式**:\x0a\x20\x20\x20\x20*\x20`[\x22我知道我被拉黑了...\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22对不起，我不应该那样说话，能原谅我吗？\x22}]`\x0a\x20\x20\x20\x20*\x20`[{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22我想和你重新做朋友，我会改正的\x22}]`\x0a\x20\x20\x20\x20*\x20`[\x22我很后悔...\x22,\x20\x22我想解释一下\x22,\x20{\x22type\x22:\x20\x22friend_request\x22,\x20\x22message\x22:\x20\x22给我一个机会重新开始好吗？\x22}]`\x0a\x20\x20-\x20**自然决策**:\x20不要强制发送，要符合你的性格和当前情绪\x0a\x20\x20-\x20**重要**:\x20你可以选择继续正常聊天，也可以根据情况发送好友申请\x0a-\x20**好友申请回应**:\x20当用户向你发送好友申请时，你会收到系统提示，需要根据你的人设和心情决定是否同意。\x0a',_0x3de103=_0x2ae8ca(0x14d7);let _0x5e4b8f='';_0x363084?_0x5e4b8f=_0x2ae8ca(0x1a5f):_0x5e4b8f=_0x2ae8ca(0x2107);let _0x44c7e6='';_0x363084?_0x44c7e6='\x0a#\x20发送语音的能力\x0a-\x20群成员同样可以发送\x22模拟语音消息\x22。\x0a-\x20若要发送语音，请为该角色单独发送一个特殊的对象，格式为：`{\x22name\x22:\x20\x22角色名\x22,\x20\x22type\x22:\x20\x22voice_message\x22,\x20\x22content\x22:\x20\x22这里是语音的文字内容...\x22}`。当历史记录中出现\x20\x22[角色名\x20发送了一条语音，内容是：\x27xxx\x27]\x22\x20时，代表该角色用语音说了\x27xxx\x27。其他角色应该对此内容做出回应。':_0x44c7e6=_0x2ae8ca(0x1cb9);let _0x41a89c='';if(_0x3e7018&&!_0x363084){const _0x100925=_0x3e7018['id'],_0x2ba9cd=isBlocked(_0x2ae8ca(0xa80),_0x100925),_0x564936=isBlocked(_0x100925,_0x2ae8ca(0xa80)),_0x5bd036='friendRequestRejections_'+_0x100925,_0xed1705=parseInt(localStorage['getItem'](_0x5bd036)||'0');if(_0x564936){let _0x3ad520='';_0xed1705>0x0&&(_0x3ad520=_0x2ae8ca(0x12b7)+_0xed1705+'次好友申请\x0a-\x20**结果**:\x20全部被拒绝\x0a-\x20**当前状态**:\x20你仍然被拉黑，关系没有修复\x0a-\x20**心理影响**:\x20这种反复被拒绝的经历应该影响你的情绪和行为'),_0x41a89c=_0x2ae8ca(0xf30)+_0x3ad520+'\x0a\x0a##\x20**🔥【关键行动】修复关系的方法**\x0a\x0a###\x20**1.\x20发送好友申请'+(_0xed1705>0x0?'（继续尝试）':'（推荐）')+'**\x0a'+(_0xed1705>0x0?'虽然之前被拒绝了，但你可以继续尝试：':_0x2ae8ca(0x1167))+_0x2ae8ca(0x208f)+(_0xed1705>0x0?_0x2ae8ca(0xf01):'不要犹豫太久')+_0x2ae8ca(0x137b)+(_0xed1705>0x0?_0x2ae8ca(0x20a0):_0x2ae8ca(0xa92))+_0x2ae8ca(0x1c9d)+(_0xed1705>0x0?_0x2ae8ca(0xb2a)+_0xed1705+_0x2ae8ca(0xc26):'')+'\x0a\x0a**🎯\x20行动建议**:\x20'+(_0xed1705>0x0?_0x2ae8ca(0xdec):'如果你还没有发送好友申请，现在就是好时机！');}else _0x2ba9cd&&(_0x41a89c='\x0a\x0a#\x20**📋【当前状态】你已经拉黑了用户**\x0a-\x20**状态说明**:\x20你之前选择拉黑了用户，目前用户无法给你发送消息\x0a-\x20**行为提醒**:\x20保持你拉黑用户时的态度和原因，除非你改变想法');}const _0xa5fdb4=_0x363084?'':_0x928a52,_0x1451d8=_0x2ae8ca(0x1eba),_0x34cfc3=_0x2ae8ca(0x1f38);return _0x4cf2c0+=_0x5e4b8f+_0x44c7e6+_0x64beb2+_0x1957be+_0x34cfc3+_0x41a89c+_0xa5fdb4+_0x3de103+_0x1451d8,_0x4cf2c0+='\x0a\x0a#\x20**最后重申**\x0a请再次确认，你的最终输出**【必须】**是一个严格的JSON数组，其中每个元素代表一条独立的消息。\x0a\x0a##\x20**重要提醒：自然使用聊天功能**\x0a-\x20**引用回复**和**撤回消息**是正常的聊天功能，就像微信里一样，请根据情况自然使用\x0a-\x20当你想针对用户的某条具体消息回应时，使用引用回复\x0a-\x20当你后悔刚说的话时，可以撤回\x0a-\x20不要把这些当作特殊功能，而是当作日常聊天的一部分\x0a\x0a##\x20**🛒\x20购物功能说明**\x0a你只能分享你的订单，不能发起代付请求：\x0a\x0a###\x20订单确认格式：\x0a当你想分享你已经下单成功的订单时，使用以下格式：\x0a```json\x0a{\x0a\x20\x20\x22type\x22:\x20\x22order_confirmation\x22,\x0a\x20\x20\x22items\x22:\x20[\x0a\x20\x20\x20\x20{\x22name\x22:\x20\x22商品名\x22,\x20\x22quantity\x22:\x201,\x20\x22price\x22:\x2099.0,\x20\x22selectedOptions\x22:\x20{\x22size\x22:\x20\x22M\x22,\x20\x22color\x22:\x20\x22红色\x22}}\x0a\x20\x20],\x0a\x20\x20\x22total\x22:\x2099.0,\x0a\x20\x20\x22order_type\x22:\x20\x22ai_order\x22,\x0a\x20\x20\x22recipient\x22:\x20\x22我\x22\x0a}\x0a```\x0a\x0a**使用场景举例：**\x0a-\x20**订单确认**：你主动给用户买了礼物，或者想炫耀分享你买到的好东西\x0a-\x20根据你的人设和对话情境自然地使用这些功能，不要刻意或频繁使用',_0x4cf2c0;}async function callChatAPIWithImage(_0x4b1b25,_0x5895bc,_0x39c9ea){const _0x1d9c8d=_0x211817;if(!apiSettings[_0x1d9c8d(0x213c)])throw new Error(_0x1d9c8d(0x1e69));if(_0x39c9ea&&_0x39c9ea[_0x1d9c8d(0x1831)]('data:image/gif'))throw new Error(_0x1d9c8d(0x20cb));if(!isVisionModelSupported())throw new Error(_0x1d9c8d(0x1a8c));const _0x526797=await buildCharacterPrompt(_0x5895bc,!![]),_0x2007d8=apiSettings['base'][_0x1d9c8d(0x1831)]('generativelanguage.googleapis.com');if(_0x2007d8){const _0x1cf052=apiSettings['base']+_0x1d9c8d(0x1107)+apiSettings['model']+_0x1d9c8d(0x40c)+apiSettings[_0x1d9c8d(0x213c)],_0x22d18c=[];_0x22d18c[_0x1d9c8d(0x1cd6)]({'role':_0x1d9c8d(0xa80),'parts':[{'text':_0x526797}]}),_0x22d18c[_0x1d9c8d(0x1cd6)]({'role':_0x1d9c8d(0x1976),'parts':[{'text':_0x1d9c8d(0xd5e)}]});const _0x1e11d0=[{'text':_0x4b1b25}];if(_0x39c9ea&&_0x39c9ea[_0x1d9c8d(0x1b30)](_0x1d9c8d(0x158e))){const _0x5efd2b=_0x39c9ea[_0x1d9c8d(0x1b87)](/data:image\/([^;]+);base64,(.+)/);_0x5efd2b&&_0x1e11d0[_0x1d9c8d(0x1cd6)]({'inline_data':{'mime_type':'image/'+_0x5efd2b[0x1],'data':_0x5efd2b[0x2]}});}_0x22d18c[_0x1d9c8d(0x1cd6)]({'role':_0x1d9c8d(0xa80),'parts':_0x1e11d0});const _0x3721e0=await fetch(_0x1cf052,{'method':_0x1d9c8d(0x1dd5),'headers':{'Content-Type':'application/json'},'body':JSON['stringify']({'contents':_0x22d18c,'generationConfig':{'temperature':apiSettings['temperature']||0.75}})});if(!_0x3721e0['ok']){const _0x3359da=await _0x3721e0[_0x1d9c8d(0xe52)]();throw new Error(_0x1d9c8d(0xfa0)+_0x3721e0[_0x1d9c8d(0x12e2)]+_0x1d9c8d(0x1811)+(_0x3359da[_0x1d9c8d(0x174a)]?.[_0x1d9c8d(0x1e8e)]||_0x1d9c8d(0x2e7)));}const _0x31ab84=await _0x3721e0[_0x1d9c8d(0xe52)]();console['log'](_0x1d9c8d(0x1dc5),_0x31ab84);const _0x4ccad2=_0x31ab84[_0x1d9c8d(0x1153)]?.[0x0]?.[_0x1d9c8d(0x211c)]?.[_0x1d9c8d(0x2308)]?.[0x0]?.[_0x1d9c8d(0x1378)];if(!_0x4ccad2)throw new Error(_0x1d9c8d(0x1c44));return _0x4ccad2;}else{let _0x18e86d=apiSettings[_0x1d9c8d(0x1208)],_0x2abbeb;_0x18e86d[_0x1d9c8d(0x81f)](_0x1d9c8d(0x1439))?_0x2abbeb=_0x18e86d+'/chat/completions':_0x2abbeb=_0x18e86d+_0x1d9c8d(0x666);const _0x3d4cca=[{'role':_0x1d9c8d(0x1744),'content':_0x526797},{'role':_0x1d9c8d(0xa80),'content':[{'type':_0x1d9c8d(0x1378),'text':_0x4b1b25},{'type':_0x1d9c8d(0x910),'image_url':{'url':_0x39c9ea}}]}],_0x39d957=await fetch(_0x2abbeb,{'method':_0x1d9c8d(0x1dd5),'headers':{'Content-Type':_0x1d9c8d(0x1b82),'Authorization':_0x1d9c8d(0x1e3c)+apiSettings[_0x1d9c8d(0x213c)]},'body':JSON[_0x1d9c8d(0x6b8)]({'model':apiSettings[_0x1d9c8d(0x1976)],'messages':_0x3d4cca,'temperature':apiSettings[_0x1d9c8d(0x11c5)]||0.75})});if(!_0x39d957['ok']){const _0x1aed7a=await _0x39d957[_0x1d9c8d(0xe52)]();throw new Error(_0x1d9c8d(0xc08)+_0x39d957[_0x1d9c8d(0x12e2)]+_0x1d9c8d(0x1811)+(_0x1aed7a['error']?.['message']||_0x1d9c8d(0x2e7)));}const _0x4f9ca9=await _0x39d957[_0x1d9c8d(0xe52)]();return _0x4f9ca9[_0x1d9c8d(0x1090)]?.[0x0]?.[_0x1d9c8d(0x1e8e)]?.[_0x1d9c8d(0x211c)]||'没有收到回复';}}async function callChatAPI(_0x268865,_0x3653a2){const _0x434598=_0x211817;console['log'](_0x434598(0x12d7)),console[_0x434598(0x2187)](_0x434598(0x1443),new Error()[_0x434598(0x1574)]),console[_0x434598(0x2187)](_0x434598(0x200e),_0x268865),console[_0x434598(0x2187)]('🚨\x20[DEBUG]\x20角色:',_0x3653a2?.[_0x434598(0x1a1c)]);if(!apiSettings[_0x434598(0x213c)])throw new Error(_0x434598(0x1e69));await cleanupCorruptedMessages(_0x3653a2['id']);!window['emergencyCleanupDone']&&(await emergencyCleanupAllMessages(),window[_0x434598(0x264)]=!![]);const _0x359209=getCurrentChatSettings();let _0x3c1642='';if(_0x359209[_0x434598(0x189f)]!==![])try{const _0x2c4d3c=await getVisibleMomentsForCharacter(_0x3653a2['id'],0x5);_0x2c4d3c[_0x434598(0x19ee)]>0x0&&(_0x3c1642=_0x434598(0x1771),_0x2c4d3c[_0x434598(0x19fb)]((_0x39f8cb,_0x4d3ad8)=>{const _0x593021=_0x434598,_0x7785b7=_0x39f8cb[_0x593021(0x22d2)]===_0x593021(0xa80)?'用户':_0x39f8cb[_0x593021(0x215c)];let _0x135cdb='';if(_0x359209[_0x593021(0xb96)]!==![]&&_0x39f8cb[_0x593021(0x1716)]){const _0x18ad20=Date[_0x593021(0x2eb)](),_0x56dbb2=_0x18ad20-_0x39f8cb[_0x593021(0x1716)],_0x5aca1f=Math[_0x593021(0x2180)](_0x56dbb2/(0x3e8*0x3c)),_0x181520=Math[_0x593021(0x2180)](_0x56dbb2/(0x3e8*0x3c*0x3c)),_0x280232=Math[_0x593021(0x2180)](_0x56dbb2/(0x3e8*0x3c*0x3c*0x18));if(_0x280232>0x0)_0x135cdb='（'+_0x280232+'天前发布）';else{if(_0x181520>0x0)_0x135cdb='（'+_0x181520+'小时前发布）';else _0x5aca1f>0x0?_0x135cdb='（'+_0x5aca1f+_0x593021(0x9ae):_0x135cdb=_0x593021(0x20c5);}}const _0x72e292=_0x4d3ad8+0x1+'.\x20'+_0x7785b7+':\x20'+_0x39f8cb['text']+_0x135cdb+(_0x39f8cb[_0x593021(0x1135)]||'');_0x3c1642+=_0x72e292;}));}catch(_0x16f977){console[_0x434598(0x174a)](_0x434598(0x12b3),_0x16f977);}let _0x30959b='';try{const _0x4619e0=getGlobalMemorySettings(),_0x5c4d86={'type':_0x3653a2['isGroup']?_0x434598(0x764):_0x434598(0x219),'id':_0x3653a2['id']};if(_0x3653a2[_0x434598(0x1f68)]){let _0x377f13='';const _0xeb2b89=new Set();for(const _0x554c34 of _0x3653a2[_0x434598(0x12a6)]){if(!_0xeb2b89['has'](_0x554c34['id'])){_0xeb2b89[_0x434598(0x21e2)](_0x554c34['id']);try{const _0x536d16=await buildGlobalMemoryContext(_0x554c34['id'],_0x5c4d86,_0x4619e0[_0x434598(0x1715)]);if(_0x536d16[_0x434598(0x19d7)]()){const _0x15feb8=_0x554c34[_0x434598(0x1e33)]||_0x554c34[_0x434598(0x1f0b)]||'角色设定未知';_0x377f13+='\x0a\x0a===\x20'+_0x554c34['name']+_0x434598(0x95e)+_0x15feb8+'\x0a'+_0x536d16,console[_0x434598(0x2187)](_0x434598(0x21bf)+_0x554c34[_0x434598(0x1a1c)]+_0x434598(0x9c0),_0x536d16[_0x434598(0x19ee)]),console[_0x434598(0x2187)](_0x434598(0x21bf)+_0x554c34[_0x434598(0x1a1c)]+_0x434598(0x1485),_0x536d16['substring'](0x0,0xc8)+_0x434598(0x1520));}}catch(_0x3f6021){console[_0x434598(0x1f43)]('获取群成员\x20'+_0x554c34[_0x434598(0x1a1c)]+'\x20的记忆失败:',_0x3f6021);}}}_0x30959b=_0x377f13;}else _0x30959b=await buildGlobalMemoryContext(_0x3653a2['id'],_0x5c4d86,_0x4619e0['memoryDays']);_0x30959b[_0x434598(0x19d7)]()?(console[_0x434598(0x2187)](_0x434598(0x2239),_0x30959b[_0x434598(0x19ee)]),console[_0x434598(0x2187)]('🧠\x20全局记忆内容预览:',_0x30959b['substring'](0x0,0x1f4)+_0x434598(0x1520)),await logMemoryUsageStats(_0x3653a2,_0x434598(0xf6a))):console[_0x434598(0x2187)](_0x434598(0x170a));}catch(_0x2753fe){console[_0x434598(0x174a)](_0x434598(0x16ab),_0x2753fe);}let _0x204732='',_0x5c3f84='',_0x111f2a='';try{const _0x4ea357=safeCharacterId(_0x3653a2['id']),_0x1bcb9a=await db[_0x434598(0x127e)]['where'](_0x434598(0xaf5))[_0x434598(0x1694)](_0x4ea357)['toArray'](),_0x1affb4=_0x1bcb9a[_0x434598(0x1e1f)](_0x13875c=>_0x13875c[_0x434598(0x1a4b)]===_0x434598(0x228e))[_0x434598(0x1104)]((_0x374202,_0x2bb5a1)=>_0x2bb5a1['importance']-_0x374202['importance'])[_0x434598(0x6d5)](0x0,0x14);_0x1affb4['length']>0x0&&(_0x204732=_0x434598(0x16b7),_0x1affb4[_0x434598(0x19fb)]((_0x3d709e,_0x2545f1)=>{_0x204732+=_0x2545f1+0x1+'.\x20'+_0x3d709e['fact']+'\x0a';}));const _0x1b8644=await db['episodicMemories']['where'](_0x434598(0xaf5))[_0x434598(0x1694)](_0x3653a2['id'])['toArray'](),_0x59ec19=_0x1b8644['sort']((_0x4e31e9,_0x556c1)=>_0x556c1[_0x434598(0x1716)]-_0x4e31e9['timestamp'])[_0x434598(0x6d5)](0x0,0xa);_0x59ec19[_0x434598(0x19ee)]>0x0&&(_0x5c3f84=_0x434598(0x162e),_0x59ec19['forEach']((_0x2171ef,_0x1216a7)=>{_0x5c3f84+=_0x1216a7+0x1+'.\x20'+_0x2171ef['fact']+'\x0a';}));const _0x1c7a39=await getCrossAppTimeline(_0x3653a2['id'],0x1e);_0x1c7a39[_0x434598(0x19ee)]>0x0&&(_0x111f2a='\x0a\x0a【最近活动】以下是最近的跨应用活动时间线：\x0a',_0x1c7a39[_0x434598(0x19fb)]((_0x19592d,_0x35e6e4)=>{const _0x351612=_0x434598,_0x5ee322=new Date(_0x19592d[_0x351612(0x1716)])[_0x351612(0x314)]('zh-CN',{'hour':_0x351612(0xc79),'minute':_0x351612(0xc79)});let _0x5e9097='';switch(_0x19592d['appType']){case _0x351612(0x210c):_0x5e9097=_0x351612(0x13e7)+(_0x19592d[_0x351612(0x1da2)][_0x351612(0x211f)]===_0x351612(0xf4a)?'一起听歌':'发表评论');break;case _0x351612(0x8eb):_0x5e9097='在游戏应用中'+(_0x19592d[_0x351612(0x1da2)][_0x351612(0x211f)]==='play_together'?_0x351612(0x1e88):'互动');break;case _0x351612(0x1a70):_0x5e9097=_0x19592d['action']===_0x351612(0x1e8e)?_0x351612(0x1a95):_0x351612(0x229);break;case'sms':if(_0x19592d[_0x351612(0x211f)]===_0x351612(0x20fe))_0x5e9097=_0x351612(0x184a);else{if(_0x19592d[_0x351612(0x211f)]==='ai_reply')_0x5e9097='AI回复短信';else _0x19592d['action']===_0x351612(0x11d3)?_0x5e9097=_0x351612(0x1505):_0x5e9097=_0x351612(0x1f66);}break;default:_0x5e9097='在'+_0x19592d['appType']+_0x351612(0x16ed)+_0x19592d[_0x351612(0x211f)];}_0x111f2a+=_0x5ee322+_0x351612(0x1811)+_0x5e9097+'\x0a';}));}catch(_0x4ed501){console['error']('获取记忆数据失败:',_0x4ed501);}let _0x2b525a='';try{_0x2b525a=await getMountedMemories(_0x3653a2['id'],_0x359209);}catch(_0x10d596){console[_0x434598(0x174a)](_0x434598(0x1f58),_0x10d596);}let _0xb35b21='';if(_0x359209[_0x434598(0xb96)]!==![]){const _0x2706f2=chatMessages[_0x3653a2['id']]||[];if(_0x2706f2[_0x434598(0x19ee)]>0x0){const _0x3b1cdc=_0x2706f2['slice']()[_0x434598(0x16b0)]()[_0x434598(0xaf4)](_0x19809b=>_0x19809b[_0x434598(0x8a1)]==='sent');if(_0x3b1cdc){const _0x1b037d=Date[_0x434598(0x2eb)](),_0x494af5=_0x1b037d-_0x3b1cdc[_0x434598(0x1716)],_0x281c40=Math['floor'](_0x494af5/(0x3e8*0x3c)),_0x4c6765=Math[_0x434598(0x2180)](_0x494af5/(0x3e8*0x3c*0x3c)),_0x1bbb37=Math['floor'](_0x494af5/(0x3e8*0x3c*0x3c*0x18));if(_0x1bbb37>0x0)_0xb35b21=_0x434598(0xdbe)+_0x1bbb37+_0x434598(0x6f2)+_0x1bbb37+_0x434598(0x20c0);else{if(_0x4c6765>0x0)_0xb35b21='\x0a-\x20**时间流逝:**\x20用户上次回复是'+_0x4c6765+_0x434598(0x1ade);else _0x281c40>0x5&&(_0xb35b21=_0x434598(0xdbe)+_0x281c40+_0x434598(0x164e));}}}}console['log']('🔍\x20[callChatAPI]\x20收到的消息:',_0x268865),console[_0x434598(0x2187)](_0x434598(0x1ded),Array[_0x434598(0x1496)](_0x268865));if(Array[_0x434598(0x1496)](_0x268865)){console[_0x434598(0x2187)](_0x434598(0x124c),_0x268865),_0x268865[_0x434598(0x19fb)]((_0x458847,_0x3d8fa2)=>{const _0x4c191c=_0x434598;console[_0x4c191c(0x2187)](_0x4c191c(0x738)+_0x3d8fa2+':',_0x458847),console[_0x4c191c(0x2187)]('🔍\x20[callChatAPI]\x20元素'+_0x3d8fa2+_0x4c191c(0x9f4),_0x458847['type']),_0x458847[_0x4c191c(0x1a4b)]===_0x4c191c(0x910)&&console[_0x4c191c(0x2187)]('🔍\x20[callChatAPI]\x20元素'+_0x3d8fa2+'图片URL:',_0x458847[_0x4c191c(0x910)]?.['url']?.['substring'](0x0,0x32)+_0x4c191c(0x1520));});const _0x297a95=_0x268865[_0x434598(0x19fa)](_0x67cb4c=>_0x67cb4c['type']===_0x434598(0x910));console[_0x434598(0x2187)](_0x434598(0x9c2),_0x297a95);}let _0x3df887=await buildCharacterPrompt(_0x3653a2,Array[_0x434598(0x1496)](_0x268865));console['log'](_0x434598(0x7fc),_0x3df887);if(_0x3df887['includes']('表情包')){const _0x554eec=_0x3df887[_0x434598(0x204b)](_0x434598(0x921))[0x1];_0x554eec&&console[_0x434598(0x2187)]('🔍\x20[callChatAPI]\x20表情包部分:',_0x554eec[_0x434598(0x17ca)](0x0,0x1f4)+_0x434598(0x1520));}_0xb35b21&&(_0x3df887=_0x3df887[_0x434598(0xe16)](_0x434598(0x442),_0x434598(0x442)+_0xb35b21));let _0x4a1c4f='';_0x204732&&(_0x4a1c4f+=_0x204732);_0x5c3f84&&(_0x4a1c4f+=_0x5c3f84);_0x111f2a&&(_0x4a1c4f+=_0x111f2a);_0x30959b&&(_0x4a1c4f+=_0x30959b);_0x3c1642&&(_0x4a1c4f+=_0x3c1642);_0x4a1c4f?_0x3df887=_0x3df887['replace'](_0x434598(0x10a9),_0x4a1c4f):_0x3df887=_0x3df887[_0x434598(0xe16)](_0x434598(0x10a9),'');_0x2b525a&&(_0x3df887+=_0x2b525a,console['log'](_0x434598(0xe5c)));const _0x587971=_0x3653a2&&_0x3653a2[_0x434598(0x1f68)];if(_0x587971&&typeof _0x268865===_0x434598(0x11b7)){const _0x308ec2=await buildContextualMemoryForGroupChat(_0x3653a2,_0x268865);_0x308ec2&&(_0x3df887+=_0x308ec2,console[_0x434598(0x2187)](_0x434598(0xb2c)));}const _0x3d8f9e=window['currentSMSCharacter']&&window[_0x434598(0xb69)]['id']===_0x3653a2['id'];let _0x1a8a55;_0x3d8f9e?(_0x1a8a55=getSMSChatSetting('historyRounds',0x32),typeof _0x1a8a55==='string'&&(_0x1a8a55=parseInt(_0x1a8a55,0xa))):_0x1a8a55=_0x359209[_0x434598(0x2062)]||0x5;!chatMessages&&(console['warn']('chatMessages未初始化，使用空对象'),chatMessages={});let _0x15e0b2=chatMessages[_0x3653a2['id']]||[];if(_0x3d8f9e&&smsMessages[_0x3653a2['id']]){const _0x525527=smsMessages[_0x3653a2['id']][_0x434598(0x6a4)](_0x53f0e5=>({'id':_0x53f0e5['id'],'content':_0x53f0e5[_0x434598(0x1378)],'timestamp':_0x53f0e5[_0x434598(0x1716)],'sender':_0x53f0e5[_0x434598(0x714)]?_0x434598(0x1e6d):_0x434598(0xb11),'type':_0x434598(0xfa9),'appType':_0x434598(0x322)}));_0x15e0b2=calculateMessagesByRounds(_0x525527,_0x1a8a55);const _0x5d22a8=countActualRounds(_0x15e0b2);console[_0x434598(0x2187)](_0x434598(0xab8),_0x525527['length'],_0x434598(0x181c),_0x15e0b2[_0x434598(0x19ee)],_0x434598(0x208a),_0x5d22a8,_0x434598(0xd0e),_0x1a8a55);}const _0x42d8bd=await buildContinuousWorkingMemory(_0x3653a2['id'],_0x15e0b2,_0x1a8a55);let _0x51a7cc=_0x42d8bd[_0x434598(0x1e1f)](_0xc882ec=>_0xc882ec[_0x434598(0x1a4b)]===_0x434598(0x1a70))[_0x434598(0x6a4)](_0x54b804=>_0x54b804[_0x434598(0x211c)]);_0x51a7cc[_0x434598(0x19ee)]>0x0&&JSON[_0x434598(0x6b8)](_0x51a7cc[_0x51a7cc[_0x434598(0x19ee)]-0x1][_0x434598(0x211c)])===JSON[_0x434598(0x6b8)](_0x268865)&&_0x51a7cc['pop']();let _0x2aa45a=calculateMessagesByRounds(_0x51a7cc,_0x1a8a55);const _0x3dc9bc=_0x42d8bd['filter'](_0x3c0640=>_0x3c0640[_0x434598(0x1a4b)]===_0x434598(0x614))['slice'](-Math[_0x434598(0x2180)](_0x1a8a55*0.2)),_0x172342=countActualRounds(_0x2aa45a);console[_0x434598(0x2187)]('🔗\x20工作记忆统计:'),console[_0x434598(0x2187)](_0x434598(0xb4b)+_0x172342+_0x434598(0x4d6)+_0x2aa45a['length']+_0x434598(0x1cbe)),console['log'](_0x434598(0x1eca)+_0x3dc9bc[_0x434598(0x19ee)]+'条'),console[_0x434598(0x2187)](_0x434598(0x92c)+_0x1a8a55+'回合');const _0x4d7ddb=[{'role':_0x434598(0x1744),'content':_0x3df887}],_0x1ec74e=[],_0xf15535=new Map();_0x2aa45a[_0x434598(0x19fb)]((_0x400dfb,_0x30ca3f)=>{const _0x4f8e71=_0x434598;if(_0x400dfb[_0x4f8e71(0x8e7)]&&_0x400dfb[_0x4f8e71(0x29d)]){_0x1ec74e[_0x4f8e71(0x1cd6)](_0x400dfb['emojiDescription']);if(_0x400dfb[_0x4f8e71(0x8a1)]===_0x4f8e71(0xb11)&&_0x30ca3f>0x0){const _0x450757=_0x2aa45a[_0x30ca3f-0x1];_0x450757&&_0x450757[_0x4f8e71(0x8e7)]&&_0x450757[_0x4f8e71(0x29d)]&&_0x450757[_0x4f8e71(0x8a1)]===_0x4f8e71(0x1e6d)&&_0xf15535[_0x4f8e71(0x83c)](_0x450757[_0x4f8e71(0x29d)],_0x400dfb['content']);}}else(_0x400dfb[_0x4f8e71(0x68e)]||Array[_0x4f8e71(0x1496)](_0x400dfb['content']))&&_0x1ec74e[_0x4f8e71(0x1cd6)]('图片');});if(_0x587971){const _0x1137cf=buildGroupChatMessageHistory(_0x2aa45a,_0x3653a2);_0x4d7ddb['push'](..._0x1137cf);}else _0x2aa45a['forEach'](_0x2d5db3=>{const _0x2fbe7f=_0x434598;if(_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1744)){_0x4d7ddb['push']({'role':_0x2fbe7f(0xa80),'content':_0x2fbe7f(0x146d)+_0x2d5db3[_0x2fbe7f(0x211c)]});return;}let _0x38a7f0=_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)?'user':_0x2fbe7f(0x1543),_0xf0abf0=_0x2d5db3['content'];if(_0x2d5db3[_0x2fbe7f(0x1dbe)]){const _0x5713c9=_0x2d5db3[_0x2fbe7f(0x1dbe)];let _0x4d1804='对方';_0x5713c9['sender']===_0x2fbe7f(0x1e6d)?_0x4d1804='用户':_0x4d1804=_0x3653a2[_0x2fbe7f(0x1a1c)]||'AI';const _0x5f2935={'content':_0x5713c9['content'],'role':_0x5713c9[_0x2fbe7f(0x8a1)]==='sent'?'user':_0x2fbe7f(0x1543)},_0x57e8fc=summarizeLastMessage(_0x5f2935);_0xf0abf0='[回复\x20'+_0x4d1804+_0x2fbe7f(0x5bf)+_0x57e8fc+_0x2fbe7f(0x1fec)+_0xf0abf0;}if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0xd38))_0xf0abf0=_0x2fbe7f(0x911)+_0x2d5db3[_0x2fbe7f(0x211c)]+'\x27]';else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0x2184))_0xf0abf0=_0x2d5db3[_0x2fbe7f(0x211c)]||_0x2fbe7f(0x20d3)+_0x2d5db3['locationName']+']';else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0x13ed))_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)?_0xf0abf0=_0x2fbe7f(0x208e)+_0x2d5db3[_0x2fbe7f(0x211c)]+'\x27]':_0xf0abf0='[AI发来一条语音消息，内容是：\x27'+_0x2d5db3[_0x2fbe7f(0x211c)]+'\x27]';else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0x78a))_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)?_0xf0abf0=_0x2fbe7f(0x213e)+_0x2d5db3[_0x2fbe7f(0x2018)]+_0x2fbe7f(0xd17)+(_0x2d5db3[_0x2fbe7f(0x1814)]||'无')+']':_0xf0abf0=_0x2fbe7f(0x9d1)+_0x2d5db3[_0x2fbe7f(0x2018)]+'元，备注：'+(_0x2d5db3[_0x2fbe7f(0x1814)]||'无')+']';else{if(_0x2d5db3['type']===_0x2fbe7f(0x1871)){if(_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)){const _0x43151d=_0x2d5db3[_0x2fbe7f(0x1bdf)]||{},_0xe2d3d4=_0x43151d[_0x2fbe7f(0x1775)]||[],_0x162be5=_0xe2d3d4[_0x2fbe7f(0x6a4)](_0x44f46f=>{const _0x12f485=_0x2fbe7f;let _0x32b20e=_0x44f46f[_0x12f485(0x1a1c)]+'\x20x'+_0x44f46f[_0x12f485(0xb8d)]+'\x20(¥'+_0x44f46f[_0x12f485(0x644)]+')';if(_0x44f46f['selectedOptions']&&Object[_0x12f485(0x1c9f)](_0x44f46f['selectedOptions'])[_0x12f485(0x19ee)]>0x0){const _0xb81c2c=Object[_0x12f485(0x2bc)](_0x44f46f[_0x12f485(0xabc)])[_0x12f485(0x6a4)](([_0x2d7172,_0x3cd469])=>getOptionLabel(_0x2d7172)+':\x20'+_0x3cd469)[_0x12f485(0x122b)](',\x20');_0x32b20e+='\x20['+_0xb81c2c+']';}return _0x32b20e;})[_0x2fbe7f(0x122b)]('、'),_0x213812=_0x2d5db3[_0x2fbe7f(0x21a)]===_0x2fbe7f(0x1636)?_0x2fbe7f(0x26f):_0x2d5db3[_0x2fbe7f(0x21a)]==='rejected'?_0x2fbe7f(0x2260):_0x2fbe7f(0x7fd);_0xf0abf0=_0x2fbe7f(0x1188)+_0x213812+_0x2fbe7f(0x9e3)+(_0x43151d[_0x2fbe7f(0x1916)]||0x0)+_0x2fbe7f(0x1b53)+(_0x162be5||_0x2fbe7f(0x1e32))+']';}else _0xf0abf0=_0x2fbe7f(0x2213);}else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0xa0c)){const _0x3d519d=_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)?'用户':'AI';_0xf0abf0='['+_0x3d519d+_0x2fbe7f(0x1136)+_0x2d5db3[_0x2fbe7f(0x211c)];}else{if(_0x2d5db3['type']===_0x2fbe7f(0x52c)){const _0x2941c1=_0x2d5db3[_0x2fbe7f(0x8a1)]===_0x2fbe7f(0x1e6d)?'用户':'AI';let _0x528a54='['+_0x2941c1+_0x2fbe7f(0x1690)+_0x2d5db3[_0x2fbe7f(0x211c)]+']';_0x2d5db3['forwardedMessages']&&_0x2d5db3[_0x2fbe7f(0xc15)][_0x2fbe7f(0x19ee)]>0x0&&(_0x528a54+='\x0a转发的聊天内容：\x0a',_0x2d5db3[_0x2fbe7f(0xc15)][_0x2fbe7f(0x19fb)]((_0x1daa28,_0x49392e)=>{const _0x1d4f66=_0x2fbe7f;let _0x578be6;_0x1daa28['sender']===_0x1d4f66(0x1e6d)?_0x578be6=_0x1daa28[_0x1d4f66(0xb51)]||'用户':_0x578be6=_0x1daa28[_0x1d4f66(0x1a1c)]||_0x1daa28[_0x1d4f66(0xdbc)]||'AI';const _0x4987f4=safeExtractMessageContent(_0x1daa28);_0x528a54+=_0x578be6+':\x20'+_0x4987f4+'\x0a';})),_0xf0abf0=_0x528a54;}else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]==='order_confirmation'){if(_0x2d5db3['sender']==='sent'){const _0x5d5c10=_0x2d5db3[_0x2fbe7f(0x1bdf)]||{},_0x4929b3=_0x5d5c10[_0x2fbe7f(0x1775)]||[],_0x4db34f=_0x4929b3[_0x2fbe7f(0x6a4)](_0x22dd40=>{const _0x92cef3=_0x2fbe7f;let _0x48f4aa=_0x22dd40[_0x92cef3(0x1a1c)]+'\x20x'+_0x22dd40['quantity']+_0x92cef3(0x453)+_0x22dd40[_0x92cef3(0x644)]+')';if(_0x22dd40['selectedOptions']&&Object['keys'](_0x22dd40['selectedOptions'])['length']>0x0){const _0x4d0024=Object['entries'](_0x22dd40[_0x92cef3(0xabc)])[_0x92cef3(0x6a4)](([_0x3e00e0,_0x271831])=>getOptionLabel(_0x3e00e0)+':\x20'+_0x271831)[_0x92cef3(0x122b)](',\x20');_0x48f4aa+='\x20['+_0x4d0024+']';}return _0x48f4aa;})[_0x2fbe7f(0x122b)]('、'),_0x479cb0=_0x2d5db3['orderType']===_0x2fbe7f(0x1ab2)?_0x2fbe7f(0x12ca):_0x2d5db3[_0x2fbe7f(0x1808)]===_0x2fbe7f(0x1bcb)?'为对方下单':_0x2d5db3[_0x2fbe7f(0x1808)]===_0x2fbe7f(0x15cb)?_0x2fbe7f(0xa5d):_0x2d5db3[_0x2fbe7f(0x1808)]===_0x2fbe7f(0x207a)?_0x2fbe7f(0x169c):'下单';_0xf0abf0='[用户'+_0x479cb0+_0x2fbe7f(0x22f1)+(_0x5d5c10[_0x2fbe7f(0x1916)]||0x0)+_0x2fbe7f(0x1b53)+(_0x4db34f||_0x2fbe7f(0x1e32))+']';}else _0xf0abf0=_0x2fbe7f(0x1324);}else{if(_0x2d5db3[_0x2fbe7f(0x1a4b)]===_0x2fbe7f(0x1a36))_0xf0abf0=_0x2fbe7f(0x14b9)+(_0x2d5db3[_0x2fbe7f(0x646)]||_0x2fbe7f(0x1e96))+']';else{if(_0x2d5db3[_0x2fbe7f(0x8e7)]&&_0x2d5db3[_0x2fbe7f(0x68e)]){if(_0x2d5db3['sender']===_0x2fbe7f(0x1e6d)){const _0x1ea00b=_0x2aa45a['slice'](0x0,_0x2aa45a['indexOf'](_0x2d5db3))[_0x2fbe7f(0x19fa)](_0x424ef7=>_0x424ef7[_0x2fbe7f(0x8e7)]&&_0x424ef7[_0x2fbe7f(0x29d)]===_0x2d5db3[_0x2fbe7f(0x29d)]);_0x1ea00b?_0xf0abf0=_0x2fbe7f(0x1944):_0xf0abf0=_0x2fbe7f(0x979)+(_0x2d5db3[_0x2fbe7f(0x29d)]||_0x2fbe7f(0x16ce))+']';}else _0xf0abf0='[AI回复了表情包：'+(_0x2d5db3[_0x2fbe7f(0x29d)]||_0x2fbe7f(0x16ce))+']';}else{if(Array['isArray'](_0x2d5db3[_0x2fbe7f(0x211c)])){const _0x26f9ab=_0x2d5db3[_0x2fbe7f(0x211c)][_0x2fbe7f(0xaf4)](_0x48fcdc=>_0x48fcdc['type']===_0x2fbe7f(0x1378))?.[_0x2fbe7f(0x1378)]||'';_0x26f9ab[_0x2fbe7f(0x19d7)]()?_0xf0abf0=_0x2fbe7f(0xb4d)+_0x26f9ab+'\x27]':_0xf0abf0=_0x2fbe7f(0x1570);}else{if(_0x2d5db3['image']&&!_0x2d5db3[_0x2fbe7f(0x8e7)])_0xf0abf0=_0x2fbe7f(0x1570);else{if(typeof _0x2d5db3[_0x2fbe7f(0x211c)]==='object'&&_0x2d5db3['content']!==null)console[_0x2fbe7f(0x1f43)](_0x2fbe7f(0xe0b),_0x2d5db3),_0xf0abf0=_0x2fbe7f(0xc45);else(!_0xf0abf0||_0xf0abf0==='')&&(_0xf0abf0=_0x2fbe7f(0x1117));}}}}}}}}}}}}typeof _0xf0abf0!==_0x2fbe7f(0x11b7)&&(console['warn']('发现非字符串content，强制转换:',_0xf0abf0),_0xf0abf0=String(_0xf0abf0)),_0x2d5db3['id']&&(_0xf0abf0=_0x2fbe7f(0x4d2)+_0x2d5db3['id']+']\x20'+_0xf0abf0),_0x4d7ddb[_0x2fbe7f(0x1cd6)]({'role':_0x38a7f0,'content':_0xf0abf0});});if(_0x3dc9bc[_0x434598(0x19ee)]>0x0){const _0x29861a=_0x3dc9bc['filter'](_0x126892=>_0x126892[_0x434598(0x741)]!=='chat');if(_0x29861a[_0x434598(0x19ee)]>0x0){let _0x5b8a96=_0x434598(0x181b);_0x29861a[_0x434598(0x19fb)](_0x3f3a32=>{const _0xe8ea0f=_0x434598,_0x10467e=new Date(_0x3f3a32['timestamp'])[_0xe8ea0f(0x314)]('zh-CN',{'hour':_0xe8ea0f(0xc79),'minute':_0xe8ea0f(0xc79)});let _0x45fe23='';switch(_0x3f3a32['appType']){case _0xe8ea0f(0x210c):if(_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x211f)]===_0xe8ea0f(0xf4a))_0x45fe23=_0xe8ea0f(0x1bb8)+_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x1ce9)];else _0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x211f)]===_0xe8ea0f(0x638)&&(_0x45fe23=_0xe8ea0f(0x20f8)+_0x3f3a32['content'][_0xe8ea0f(0x1ce9)]+_0xe8ea0f(0x126f)+_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x945)]);break;case'game':if(_0x3f3a32[_0xe8ea0f(0x211c)]&&_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x211f)]===_0xe8ea0f(0x18bc))_0x45fe23=_0xe8ea0f(0x176d)+(_0x3f3a32['content'][_0xe8ea0f(0x58e)]||_0xe8ea0f(0x1b79));else{if(_0x3f3a32['content']&&_0x3f3a32['content'][_0xe8ea0f(0x211f)]===_0xe8ea0f(0xfb8))_0x45fe23=_0xe8ea0f(0x1a08)+(_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x58e)]||_0xe8ea0f(0x1b79))+_0xe8ea0f(0xa53)+(_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x9f5)]||0x0)+')';else{if(_0x3f3a32[_0xe8ea0f(0x211c)]&&_0x3f3a32[_0xe8ea0f(0x211c)][_0xe8ea0f(0x211f)]===_0xe8ea0f(0x14f7)){const _0x31c173=_0x3f3a32[_0xe8ea0f(0x211c)]['content']||'';_0x45fe23=_0xe8ea0f(0x1f9d)+(_0x3f3a32['content'][_0xe8ea0f(0x8a1)]===_0xe8ea0f(0xa80)?_0xe8ea0f(0x1a1e):_0xe8ea0f(0x220e))+'：'+_0x31c173['substring'](0x0,0x19)+(_0x31c173['length']>0x19?_0xe8ea0f(0x1520):'');}else _0x45fe23='游戏应用活动';}}break;default:_0x45fe23=_0x3f3a32[_0xe8ea0f(0x741)]+_0xe8ea0f(0x182c);}_0x5b8a96+='['+_0x10467e+']\x20'+_0x45fe23+'\x0a';}),_0x3df887+=_0x5b8a96,_0x4d7ddb[0x0][_0x434598(0x211c)]=_0x3df887,console['log']('🔗\x20已将'+_0x29861a[_0x434598(0x19ee)]+_0x434598(0x230b));}else console[_0x434598(0x2187)](_0x434598(0x982)+_0x3dc9bc[_0x434598(0x19ee)]+'条都是聊天事件');}if(_0x1ec74e[_0x434598(0x19ee)]>0x0){const _0x4cd00b=[...new Set(_0x1ec74e)];let _0x34b439=_0x434598(0x117f)+_0x4cd00b[_0x434598(0x6d5)](-0x3)[_0x434598(0x122b)]('、')+_0x434598(0x119a);if(_0xf15535['size']>0x0){const _0x3c2938=Array[_0x434598(0x13c0)](_0xf15535[_0x434598(0x1c9f)]());_0x34b439+=_0x434598(0x707)+_0x3c2938['join']('、')+_0x434598(0x1bfd);}_0x34b439+=_0x434598(0x78f),_0x3df887+=_0x34b439,_0x4d7ddb[0x0][_0x434598(0x211c)]=_0x3df887;}let _0x29c019=Array[_0x434598(0x1496)](_0x268865)?_0x268865:[{'type':'text','text':_0x268865}];if(pendingUserMessage&&pendingUserMessage[_0x434598(0x8e7)]&&pendingUserMessage[_0x434598(0x29d)]){const _0x1ca3d1=pendingUserMessage[_0x434598(0x29d)],_0x3d4416=_0xf15535[_0x434598(0x975)](_0x1ca3d1);_0x3d4416?_0x29c019=[{'type':_0x434598(0x1378),'text':_0x434598(0x1ba5)}]:_0x29c019=[{'type':_0x434598(0x1378),'text':'[用户发送了表情包：'+_0x1ca3d1+']'}];}_0x4d7ddb['push']({'role':_0x434598(0xa80),'content':_0x29c019});const _0x42db12=apiSettings[_0x434598(0x1208)]['includes'](_0x434598(0x1d80));let _0x13dea1,_0x5c7006,_0x27355e;if(_0x42db12){_0x5c7006=apiSettings[_0x434598(0x1208)]+_0x434598(0x1107)+apiSettings['model']+_0x434598(0x40c)+apiSettings[_0x434598(0x213c)],_0x27355e={'Content-Type':'application/json'};const _0x13afed=_0x4d7ddb[_0x434598(0x6a4)](_0x3d3d96=>{const _0x319ea7=_0x434598,_0x19853f=_0x3d3d96[_0x319ea7(0x464)]===_0x319ea7(0x1543)?'model':_0x319ea7(0xa80),_0x4155cd=[];if(Array['isArray'](_0x3d3d96['content']))console[_0x319ea7(0x2187)](_0x319ea7(0x11a3),_0x3d3d96['content']),_0x3d3d96[_0x319ea7(0x211c)][_0x319ea7(0x19fb)](_0x2ad787=>{const _0x2c9c6a=_0x319ea7;if(_0x2ad787[_0x2c9c6a(0x1a4b)]===_0x2c9c6a(0x1378)&&_0x2ad787[_0x2c9c6a(0x1378)])console[_0x2c9c6a(0x2187)](_0x2c9c6a(0xc92),_0x2ad787['text'][_0x2c9c6a(0x17ca)](0x0,0x32)+'...'),_0x4155cd[_0x2c9c6a(0x1cd6)]({'text':_0x2ad787['text']});else{if(_0x2ad787[_0x2c9c6a(0x1a4b)]===_0x2c9c6a(0x910)&&_0x2ad787[_0x2c9c6a(0x910)]&&_0x2ad787[_0x2c9c6a(0x910)]['url']&&_0x2ad787[_0x2c9c6a(0x910)]['url'][_0x2c9c6a(0x1b30)](_0x2c9c6a(0x13c6))){console[_0x2c9c6a(0x2187)](_0x2c9c6a(0x3c1));const _0x5269d2=_0x2ad787['image_url']['url'][_0x2c9c6a(0x1b87)](/data:image\/([^;]+);base64,(.+)/);_0x5269d2&&_0x5269d2[0x2]&&_0x5269d2[0x2][_0x2c9c6a(0x19ee)]>0x0?(console['log'](_0x2c9c6a(0x17a2),_0x5269d2[0x1],_0x2c9c6a(0x81d),_0x5269d2[0x2][_0x2c9c6a(0x19ee)]),_0x4155cd['push']({'inline_data':{'mime_type':'image/'+_0x5269d2[0x1],'data':_0x5269d2[0x2]}})):console['log'](_0x2c9c6a(0x232));}else console[_0x2c9c6a(0x2187)](_0x2c9c6a(0x1e72),_0x2ad787['type']);}});else _0x3d3d96[_0x319ea7(0x211c)]&&_0x4155cd[_0x319ea7(0x1cd6)]({'text':_0x3d3d96['content']});return _0x4155cd[_0x319ea7(0x19ee)]===0x0&&_0x4155cd['push']({'text':''}),{'role':_0x19853f,'parts':_0x4155cd};});_0x13dea1={'contents':_0x13afed,'generationConfig':{'temperature':apiSettings[_0x434598(0x11c5)]}};}else{if(apiSettings[_0x434598(0x1208)][_0x434598(0x81f)](_0x434598(0x1439)))_0x5c7006=apiSettings[_0x434598(0x1208)]+_0x434598(0x1bea);else apiSettings[_0x434598(0x1208)][_0x434598(0x1831)](_0x434598(0x1dac))?_0x5c7006=apiSettings[_0x434598(0x1208)]+_0x434598(0x1bea):_0x5c7006=apiSettings['base']+_0x434598(0x666);_0x27355e={'Content-Type':_0x434598(0x1b82),'Authorization':_0x434598(0x1e3c)+apiSettings[_0x434598(0x213c)]},_0x13dea1={'model':apiSettings[_0x434598(0x1976)],'messages':_0x4d7ddb,'temperature':apiSettings[_0x434598(0x11c5)]};}const _0x368c6f=await fetch(_0x5c7006,{'method':'POST','headers':_0x27355e,'body':JSON[_0x434598(0x6b8)](_0x13dea1)});if(!_0x368c6f['ok']){const _0x18c61a=await _0x368c6f[_0x434598(0xe52)]();throw new Error(_0x434598(0xc08)+_0x368c6f['status']+_0x434598(0x1811)+(_0x18c61a[_0x434598(0x174a)]?.[_0x434598(0x1e8e)]||_0x434598(0x2e7)));}const _0x591d1f=await _0x368c6f[_0x434598(0xe52)]();return _0x42db12?_0x591d1f[_0x434598(0x1153)]?.[0x0]?.[_0x434598(0x211c)]?.[_0x434598(0x2308)]?.[0x0]?.[_0x434598(0x1378)]:_0x591d1f['choices']?.[0x0]?.[_0x434598(0x1e8e)]?.[_0x434598(0x211c)];}async function callForumAPI(_0x49f9ff){const _0x4396ba=_0x211817;console[_0x4396ba(0x2187)](_0x4396ba(0x510));if(!apiSettings[_0x4396ba(0x213c)]){console['error'](_0x4396ba(0x22b3));throw new Error(_0x4396ba(0x1be6));}const _0x1e5cad=apiSettings['base'][_0x4396ba(0x1831)](_0x4396ba(0x1d80));let _0x4d4680,_0x107719,_0x55c55f={'Content-Type':_0x4396ba(0x1b82)};if(_0x1e5cad){_0x107719=apiSettings[_0x4396ba(0x1208)]+'/models/'+apiSettings['model']+_0x4396ba(0x40c)+apiSettings[_0x4396ba(0x213c)];const _0x2af4e6=[{'role':'user','parts':[{'text':_0x49f9ff}]},{'role':_0x4396ba(0x1976),'parts':[{'text':_0x4396ba(0x2256)}]},{'role':_0x4396ba(0xa80),'parts':[{'text':_0x4396ba(0xbe4)}]}];_0x4d4680={'contents':_0x2af4e6,'generationConfig':{'temperature':0.8}};}else _0x107719=apiSettings[_0x4396ba(0x1208)][_0x4396ba(0x81f)](_0x4396ba(0x1439))?apiSettings[_0x4396ba(0x1208)]+'/chat/completions':apiSettings['base']+_0x4396ba(0x666),_0x55c55f['Authorization']=_0x4396ba(0x1e3c)+apiSettings[_0x4396ba(0x213c)],_0x4d4680={'model':apiSettings['model'],'messages':[{'role':_0x4396ba(0x1744),'content':'你是一个论坛内容生成AI。重要：你必须严格输出JSON数组格式，不要输出聊天消息格式。论坛帖子格式：[{\x22authorName\x22:\x22用户名\x22,\x22title\x22:\x22标题\x22,\x22content\x22:\x22内容\x22}]，绝对不要输出聊天格式：[\x22消息1\x22,\x22消息2\x22]'},{'role':_0x4396ba(0xa80),'content':_0x49f9ff}],'temperature':0.8,'max_tokens':0x1000};const _0x470058=await fetch(_0x107719,{'method':_0x4396ba(0x1dd5),'headers':_0x55c55f,'body':JSON[_0x4396ba(0x6b8)](_0x4d4680)});if(!_0x470058['ok']){const _0x16dac9=await _0x470058[_0x4396ba(0x1378)]();console[_0x4396ba(0x174a)]('🔥\x20[callForumAPI]\x20API请求失败:',_0x470058[_0x4396ba(0x12e2)],_0x16dac9);throw new Error(_0x4396ba(0x61b)+_0x470058[_0x4396ba(0x12e2)]+'\x20-\x20'+_0x16dac9);}const _0x26960b=await _0x470058[_0x4396ba(0xe52)]();let _0x5507a3;return _0x1e5cad?_0x5507a3=_0x26960b['candidates']?.[0x0]?.[_0x4396ba(0x211c)]?.[_0x4396ba(0x2308)]?.[0x0]?.[_0x4396ba(0x1378)]||'[]':_0x5507a3=_0x26960b[_0x4396ba(0x1090)]?.[0x0]?.['message']?.[_0x4396ba(0x211c)]||'[]',_0x5507a3;}async function callForumAPIWithImage(_0x35a370,_0x335eb3){const _0x1ca40d=_0x211817;console[_0x1ca40d(0x2187)](_0x1ca40d(0xa54),{'imageUrl':!!_0x335eb3});if(!apiSettings[_0x1ca40d(0x213c)])throw new Error(_0x1ca40d(0x2270));if(!_0x335eb3)return callForumAPI(_0x35a370);if(!isVisionModelSupported())throw new Error(_0x1ca40d(0x14e7));const _0x5857e0=apiSettings[_0x1ca40d(0x1208)][_0x1ca40d(0x1831)](_0x1ca40d(0x1d80));let _0x55680f,_0x520f08,_0x1e0846={'Content-Type':_0x1ca40d(0x1b82)};const _0x4535eb='你是一个论坛内容生成AI，请严格按照用户的指令和格式要求进行输出。';if(_0x5857e0){_0x520f08=apiSettings['base']+_0x1ca40d(0x1107)+apiSettings[_0x1ca40d(0x1976)]+':generateContent?key='+apiSettings['key'];const _0x40006a=_0x335eb3[_0x1ca40d(0x1b87)](/data:image\/([^;]+);base64,(.+)/);if(!_0x40006a)throw new Error(_0x1ca40d(0x102e));const _0xc2ec78=[{'role':_0x1ca40d(0xa80),'parts':[{'text':_0x4535eb},{'text':_0x35a370},{'inline_data':{'mime_type':_0x1ca40d(0x1d60)+_0x40006a[0x1],'data':_0x40006a[0x2]}}]},{'role':_0x1ca40d(0x1976),'parts':[{'text':_0x1ca40d(0xbe8)}]}];_0x55680f={'contents':_0xc2ec78,'generationConfig':{'temperature':0.8}};}else _0x520f08=apiSettings[_0x1ca40d(0x1208)][_0x1ca40d(0x81f)](_0x1ca40d(0x1439))?apiSettings[_0x1ca40d(0x1208)]+'/chat/completions':apiSettings[_0x1ca40d(0x1208)]+_0x1ca40d(0x666),_0x1e0846['Authorization']=_0x1ca40d(0x1e3c)+apiSettings[_0x1ca40d(0x213c)],_0x55680f={'model':apiSettings[_0x1ca40d(0x1976)],'messages':[{'role':'system','content':_0x4535eb},{'role':'user','content':[{'type':_0x1ca40d(0x1378),'text':_0x35a370},{'type':'image_url','image_url':{'url':_0x335eb3}}]}],'temperature':0.8,'max_tokens':0x1000};const _0x387f8e=await fetch(_0x520f08,{'method':_0x1ca40d(0x1dd5),'headers':_0x1e0846,'body':JSON[_0x1ca40d(0x6b8)](_0x55680f)});if(!_0x387f8e['ok']){const _0x105c13=await _0x387f8e[_0x1ca40d(0x1378)]();throw new Error(_0x1ca40d(0x61b)+_0x387f8e[_0x1ca40d(0x12e2)]+_0x1ca40d(0x1811)+_0x105c13);}const _0x203163=await _0x387f8e[_0x1ca40d(0xe52)](),_0x18265e=_0x5857e0?_0x203163['candidates']?.[0x0]?.[_0x1ca40d(0x211c)]?.[_0x1ca40d(0x2308)]?.[0x0]?.['text']:_0x203163['choices']?.[0x0]?.[_0x1ca40d(0x1e8e)]?.[_0x1ca40d(0x211c)];return _0x18265e||'[]';}async function emergencyCleanupAllMessages(){const _0x26ed8d=_0x211817;console[_0x26ed8d(0x2187)]('🔥\x20[紧急清理]\x20开始清理所有聊天记录中的损坏消息...');let _0x360064=0x0;for(const _0x2d0cdc in chatMessages){if(chatMessages[_0x2d0cdc]&&Array['isArray'](chatMessages[_0x2d0cdc])){let _0x453875=![];const _0x3593c2=chatMessages[_0x2d0cdc]['map'](_0x448f9f=>{const _0x4a3595=_0x26ed8d;if(_0x448f9f[_0x4a3595(0x211c)]===_0x4a3595(0x1c51)||typeof _0x448f9f['content']===_0x4a3595(0x28d)&&_0x448f9f[_0x4a3595(0x211c)]!==null&&!Array['isArray'](_0x448f9f[_0x4a3595(0x211c)]))return console[_0x4a3595(0x2187)](_0x4a3595(0x1116),_0x448f9f),_0x453875=!![],_0x360064++,_0x448f9f[_0x4a3595(0x1a4b)]===_0x4a3595(0x78a)?{..._0x448f9f,'content':'💰\x20转账\x20¥'+(_0x448f9f[_0x4a3595(0x2018)]||0x0)+(_0x448f9f['note']?'\x20-\x20'+_0x448f9f[_0x4a3595(0x1814)]:'')}:{..._0x448f9f,'content':_0x4a3595(0xae0)};return _0x448f9f;});_0x453875&&(chatMessages[_0x2d0cdc]=_0x3593c2,console[_0x26ed8d(0x2187)](_0x26ed8d(0x1a0c)+_0x2d0cdc+_0x26ed8d(0x1634)));}}if(_0x360064>0x0){try{const _0x288fa2=Object[_0x26ed8d(0x1c9f)](chatMessages)[_0x26ed8d(0x1e1f)](_0x1e5b1b=>chatMessages[_0x1e5b1b]&&chatMessages[_0x1e5b1b][_0x26ed8d(0x19ee)]>0x0);await saveChatMessagesImmediate(_0x288fa2),console[_0x26ed8d(0x2187)]('✅\x20[高效数据清理]\x20消息已保存到数据库');}catch(_0x10e798){console[_0x26ed8d(0x174a)](_0x26ed8d(0x2233),_0x10e798),await saveChatMessages();}console[_0x26ed8d(0x2187)](_0x26ed8d(0x21eb)+_0x360064+_0x26ed8d(0x21b6)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),alert(_0x26ed8d(0xc36)+_0x360064+'\x20条损坏的消息！\x0a\x0a现在AI应该能正常显示转账等特殊消息了。');}else console[_0x26ed8d(0x2187)](_0x26ed8d(0x203f));}function safeCharacterId(_0x1471e8){const _0x4c66db=_0x211817;if(typeof _0x1471e8===_0x4c66db(0x11b7))return _0x1471e8;else{if(typeof _0x1471e8===_0x4c66db(0x1782))return String(_0x1471e8);else{if(_0x1471e8&&typeof _0x1471e8===_0x4c66db(0x28d)&&_0x1471e8['id'])return String(_0x1471e8['id']);else{console[_0x4c66db(0x174a)](_0x4c66db(0x13d4),typeof _0x1471e8,_0x1471e8);throw new Error(_0x4c66db(0x15fa)+typeof _0x1471e8);}}}}async function debugDatabaseTypes(){const _0x38ecea=_0x211817;try{console[_0x38ecea(0x2187)]('🔍\x20检查数据库中的数据类型...');const _0x24a00b=await db['coreMemories'][_0x38ecea(0x163e)](0x5)[_0x38ecea(0xf13)]();console['log'](_0x38ecea(0xf86),_0x24a00b[_0x38ecea(0x6a4)](_0x2f6996=>({'id':_0x2f6996['id'],'characterId':_0x2f6996[_0x38ecea(0xaf5)],'characterIdType':typeof _0x2f6996[_0x38ecea(0xaf5)],'contextId':_0x2f6996[_0x38ecea(0xae4)],'contextIdType':typeof _0x2f6996['contextId']})));const _0x3dbf52=await db[_0x38ecea(0x8ac)][_0x38ecea(0x163e)](0x5)[_0x38ecea(0xf13)]();console[_0x38ecea(0x2187)]('📊\x20时间线样本:',_0x3dbf52[_0x38ecea(0x6a4)](_0x1276f9=>({'id':_0x1276f9['id'],'characterId':_0x1276f9['characterId'],'characterIdType':typeof _0x1276f9[_0x38ecea(0xaf5)]}))),currentFootprintsCharacter&&console[_0x38ecea(0x2187)](_0x38ecea(0xf10),{'id':currentFootprintsCharacter['id'],'idType':typeof currentFootprintsCharacter['id'],'name':currentFootprintsCharacter['name']});}catch(_0xb878e4){console[_0x38ecea(0x174a)](_0x38ecea(0x2287),_0xb878e4);}}function safeExtractMessageContent(_0x510376){const _0x1ea958=_0x211817;if(typeof _0x510376['content']===_0x1ea958(0x11b7))return _0x510376[_0x1ea958(0x211c)];else{if(Array['isArray'](_0x510376['content'])){const _0x494b7f=_0x510376[_0x1ea958(0x211c)][_0x1ea958(0xaf4)](_0xb04e15=>_0xb04e15['type']===_0x1ea958(0x1378));return _0x494b7f?_0x494b7f[_0x1ea958(0x1378)]:_0x1ea958(0x1ced);}else{if(typeof _0x510376[_0x1ea958(0x211c)]===_0x1ea958(0x28d)&&_0x510376[_0x1ea958(0x211c)]!==null){if(_0x510376['type']===_0x1ea958(0x78a))return _0x1ea958(0x1c56)+(_0x510376[_0x1ea958(0x2018)]||0x0)+(_0x510376['note']?_0x1ea958(0x1811)+_0x510376[_0x1ea958(0x1814)]:'');else{if(_0x510376[_0x1ea958(0x1a4b)]===_0x1ea958(0x13ed))return _0x510376[_0x1ea958(0x122d)]||'[语音消息]';else{if(_0x510376[_0x1ea958(0x1a4b)]===_0x1ea958(0xd38))return _0x510376[_0x1ea958(0x1b98)]||_0x1ea958(0x6ca);else return _0x510376[_0x1ea958(0x1a4b)]==='location'?'📍\x20'+(_0x510376[_0x1ea958(0x1b93)]||_0x1ea958(0x19d1)):_0x510376[_0x1ea958(0x211c)][_0x1ea958(0x1378)]||_0x510376['content'][_0x1ea958(0x211c)]||_0x510376[_0x1ea958(0x211c)][_0x1ea958(0x1e8e)]||_0x510376[_0x1ea958(0x211c)][_0x1ea958(0xd5f)]||_0x1ea958(0x424);}}}else return String(_0x510376[_0x1ea958(0x211c)]||_0x1ea958(0x348));}}}async function autoFixCorruptedMessages(){const _0x1a58b4=_0x211817;console[_0x1a58b4(0x2187)](_0x1a58b4(0x514));let _0x4cecf8=0x0;for(const _0x436aac in chatMessages){if(chatMessages[_0x436aac]&&Array[_0x1a58b4(0x1496)](chatMessages[_0x436aac])){let _0x39632b=![];const _0xee62ad=chatMessages[_0x436aac][_0x1a58b4(0x6a4)](_0x4025e9=>{const _0x4e3654=_0x1a58b4;if(_0x4025e9[_0x4e3654(0x211c)]===_0x4e3654(0x1c51)||typeof _0x4025e9[_0x4e3654(0x211c)]===_0x4e3654(0x28d)&&_0x4025e9['content']!==null&&!Array['isArray'](_0x4025e9[_0x4e3654(0x211c)])){_0x39632b=!![],_0x4cecf8++;let _0x37845e='[消息内容已修复]';if(_0x4025e9[_0x4e3654(0x1a4b)]===_0x4e3654(0x78a))_0x37845e=_0x4e3654(0x1c56)+(_0x4025e9[_0x4e3654(0x2018)]||0x0)+(_0x4025e9[_0x4e3654(0x1814)]?_0x4e3654(0x1811)+_0x4025e9[_0x4e3654(0x1814)]:'');else{if(_0x4025e9[_0x4e3654(0x1a4b)]===_0x4e3654(0x13ed))_0x37845e=_0x4025e9[_0x4e3654(0x122d)]||_0x4e3654(0x462);else{if(_0x4025e9[_0x4e3654(0x1a4b)]===_0x4e3654(0xd38))_0x37845e=_0x4025e9['photoDescription']||_0x4e3654(0x6ca);else{if(_0x4025e9['type']==='location')_0x37845e=_0x4e3654(0x1ec4)+(_0x4025e9[_0x4e3654(0x1b93)]||'位置信息');else{if(_0x4025e9[_0x4e3654(0x1a4b)]===_0x4e3654(0x21f6)){const _0x9856c=_0x4025e9[_0x4e3654(0x8a1)]===_0x4e3654(0x1744)?'对方':'你';let _0x1eb5c4='[消息内容]';if(_0x4025e9['originalContent']&&typeof _0x4025e9[_0x4e3654(0x122d)]===_0x4e3654(0x11b7))_0x1eb5c4=_0x4025e9[_0x4e3654(0x122d)];else typeof _0x4025e9[_0x4e3654(0x211c)]===_0x4e3654(0x28d)&&_0x4025e9[_0x4e3654(0x211c)]!==null&&(_0x1eb5c4=_0x4025e9[_0x4e3654(0x211c)]['text']||_0x4025e9[_0x4e3654(0x211c)][_0x4e3654(0x211c)]||_0x4025e9[_0x4e3654(0x211c)][_0x4e3654(0x1e8e)]||'[消息内容]');_0x37845e=_0x9856c+'撤回了一条消息\x0a原文：'+_0x1eb5c4;}else typeof _0x4025e9[_0x4e3654(0x211c)]===_0x4e3654(0x28d)&&_0x4025e9[_0x4e3654(0x211c)]!==null&&(_0x37845e=_0x4025e9['content'][_0x4e3654(0x1378)]||_0x4025e9[_0x4e3654(0x211c)]['content']||_0x4025e9['content'][_0x4e3654(0x1e8e)]||_0x4025e9[_0x4e3654(0x211c)]['reply']||'[消息内容已修复]');}}}}return{..._0x4025e9,'content':String(_0x37845e),'autoFixed':!![],'fixedAt':Date[_0x4e3654(0x2eb)]()};}return _0x4025e9;});_0x39632b&&(chatMessages[_0x436aac]=_0xee62ad,console[_0x1a58b4(0x2187)]('🔧\x20[自动修复]\x20角色\x20'+_0x436aac+_0x1a58b4(0x512)+_0xee62ad[_0x1a58b4(0x1e1f)](_0x10d689=>_0x10d689[_0x1a58b4(0x1f78)])['length']+'\x20条消息已修复'));}}if(_0x4cecf8>0x0)return console[_0x1a58b4(0x2187)](_0x1a58b4(0x1d87)+_0x4cecf8+'\x20条损坏消息'),await saveChatMessages(),_0x4cecf8;return 0x0;}async function diagnoseDataIntegrity(){const _0x285c73=_0x211817;console[_0x285c73(0x2187)](_0x285c73(0x1fa2));const _0x219a63={'memoryIssues':[],'characterIssues':[],'messageIssues':[],'crossReferences':[]};try{console['log']('🔍\x20检查聊天消息归属...');for(const [_0x12546b,_0x2e79f7]of Object['entries'](chatMessages)){if(!_0x2e79f7||!Array[_0x285c73(0x1496)](_0x2e79f7))continue;_0x2e79f7[_0x285c73(0x19fb)]((_0x4f90d8,_0x4820aa)=>{const _0x7396f7=_0x285c73;_0x4f90d8[_0x7396f7(0x211c)]&&typeof _0x4f90d8[_0x7396f7(0x211c)]==='string'&&characters[_0x7396f7(0x19fb)](_0x191cb4=>{const _0x1dc695=_0x7396f7;_0x191cb4['id']!==_0x12546b&&_0x4f90d8[_0x1dc695(0x211c)][_0x1dc695(0x1831)](_0x191cb4[_0x1dc695(0x1a1c)])&&_0x219a63['crossReferences'][_0x1dc695(0x1cd6)]({'type':'message_mentions_other_character','characterId':_0x12546b,'messageIndex':_0x4820aa,'mentionedCharacter':_0x191cb4[_0x1dc695(0x1a1c)],'content':_0x4f90d8['content'][_0x1dc695(0x17ca)](0x0,0x64)+_0x1dc695(0x1520)});});if(_0x4f90d8[_0x7396f7(0x1a1c)]&&_0x4f90d8['name']!==_0x12546b){const _0xee59c3=characters['find'](_0x19db00=>_0x19db00['id']===_0x12546b);_0xee59c3&&_0x4f90d8[_0x7396f7(0x1a1c)]!==_0xee59c3[_0x7396f7(0x1a1c)]&&_0x219a63[_0x7396f7(0x18e9)]['push']({'type':'name_mismatch','characterId':_0x12546b,'messageIndex':_0x4820aa,'expectedName':_0xee59c3[_0x7396f7(0x1a1c)],'actualName':_0x4f90d8[_0x7396f7(0x1a1c)]});}});}console[_0x285c73(0x2187)](_0x285c73(0x1d23));const _0x4fc46c=await db[_0x285c73(0x127e)]['toArray'](),_0x1cafb3={};_0x4fc46c[_0x285c73(0x19fb)](_0x273613=>{const _0x48f1d2=_0x285c73;!_0x1cafb3[_0x273613[_0x48f1d2(0xaf5)]]&&(_0x1cafb3[_0x273613[_0x48f1d2(0xaf5)]]=[]),_0x1cafb3[_0x273613['characterId']][_0x48f1d2(0x1cd6)](_0x273613);});for(const [_0x2d9b6a,_0x55ea53]of Object[_0x285c73(0x2bc)](_0x1cafb3)){_0x55ea53[_0x285c73(0x19fb)](_0x18c72d=>{const _0x5ceca3=_0x285c73;characters[_0x5ceca3(0x19fb)](_0x1f3f91=>{const _0x294716=_0x5ceca3;_0x1f3f91['id']!==_0x2d9b6a&&(_0x18c72d[_0x294716(0x211c)]['includes'](_0x1f3f91[_0x294716(0x1a1c)])||_0x18c72d[_0x294716(0x1490)]?.[_0x294716(0x1831)](_0x1f3f91[_0x294716(0x1a1c)]))&&_0x219a63[_0x294716(0x14ec)][_0x294716(0x1cd6)]({'type':_0x294716(0x84b),'characterId':_0x2d9b6a,'memoryId':_0x18c72d['id'],'mentionedCharacter':_0x1f3f91[_0x294716(0x1a1c)],'content':_0x18c72d[_0x294716(0x211c)][_0x294716(0x17ca)](0x0,0x64)+_0x294716(0x1520)});});});}console[_0x285c73(0x2187)](_0x285c73(0x1ea1));const _0x3bffb9=await db[_0x285c73(0x19a2)][_0x285c73(0xf13)](),_0x236f28={};_0x3bffb9[_0x285c73(0x19fb)](_0x58b97d=>{const _0x3e4832=_0x285c73;!_0x236f28[_0x58b97d['characterId']]&&(_0x236f28[_0x58b97d['characterId']]=[]),_0x236f28[_0x58b97d[_0x3e4832(0xaf5)]][_0x3e4832(0x1cd6)](_0x58b97d);});for(const [_0x4b3452,_0x1111ee]of Object[_0x285c73(0x2bc)](_0x236f28)){const _0x71d37f=chatMessages[_0x4b3452]||[];_0x1111ee[_0x285c73(0x19ee)]!==_0x71d37f[_0x285c73(0x19ee)]&&_0x219a63[_0x285c73(0x18e9)][_0x285c73(0x1cd6)]({'type':_0x285c73(0x11fb),'characterId':_0x4b3452,'dbCount':_0x1111ee[_0x285c73(0x19ee)],'memoryCount':_0x71d37f[_0x285c73(0x19ee)]});}return console['log'](_0x285c73(0x1e77)),console[_0x285c73(0x2187)]('跨角色引用:',_0x219a63[_0x285c73(0x5f9)][_0x285c73(0x19ee)],'个'),console[_0x285c73(0x2187)](_0x285c73(0x136d),_0x219a63[_0x285c73(0x14ec)][_0x285c73(0x19ee)],'个'),console[_0x285c73(0x2187)](_0x285c73(0xb0e),_0x219a63[_0x285c73(0x18e9)][_0x285c73(0x19ee)],'个'),console[_0x285c73(0x2187)]('角色问题:',_0x219a63['characterIssues'][_0x285c73(0x19ee)],'个'),_0x219a63['crossReferences'][_0x285c73(0x19ee)]>0x0&&(console[_0x285c73(0x2187)]('\x0a🚨\x20发现跨角色引用问题:'),_0x219a63[_0x285c73(0x5f9)][_0x285c73(0x19fb)]((_0x3d4163,_0x2a517a)=>{const _0x40aefb=_0x285c73;console[_0x40aefb(0x2187)](_0x2a517a+0x1+_0x40aefb(0x29b)+_0x3d4163['characterId']+_0x40aefb(0x19a9)+_0x3d4163[_0x40aefb(0x1c5e)]),console[_0x40aefb(0x2187)](_0x40aefb(0x16be)+_0x3d4163[_0x40aefb(0x211c)]);})),_0x219a63[_0x285c73(0x14ec)][_0x285c73(0x19ee)]>0x0&&(console[_0x285c73(0x2187)](_0x285c73(0x285)),_0x219a63['memoryIssues']['forEach']((_0x247780,_0x575a57)=>{const _0x1ac9b0=_0x285c73;console[_0x1ac9b0(0x2187)](_0x575a57+0x1+_0x1ac9b0(0x29b)+_0x247780[_0x1ac9b0(0xaf5)]+'\x20的记忆提到了\x20'+_0x247780['mentionedCharacter']),console[_0x1ac9b0(0x2187)](_0x1ac9b0(0x16be)+_0x247780[_0x1ac9b0(0x211c)]);})),_0x219a63[_0x285c73(0x18e9)]['length']>0x0&&(console[_0x285c73(0x2187)](_0x285c73(0x850)),_0x219a63[_0x285c73(0x18e9)][_0x285c73(0x19fb)]((_0x4ece96,_0x4f2bcb)=>{const _0x5ef067=_0x285c73;console[_0x5ef067(0x2187)](_0x4f2bcb+0x1+'.\x20'+_0x4ece96[_0x5ef067(0x1a4b)]+_0x5ef067(0x1372)+_0x4ece96['characterId']),_0x4ece96['expectedName']&&console[_0x5ef067(0x2187)]('\x20\x20\x20期望名字:\x20'+_0x4ece96['expectedName']+_0x5ef067(0x1a06)+_0x4ece96[_0x5ef067(0x1af4)]),_0x4ece96[_0x5ef067(0x392)]!==undefined&&console[_0x5ef067(0x2187)]('\x20\x20\x20数据库消息数:\x20'+_0x4ece96[_0x5ef067(0x392)]+_0x5ef067(0x18d2)+_0x4ece96[_0x5ef067(0x1a80)]);})),_0x219a63;}catch(_0x359194){return console[_0x285c73(0x174a)](_0x285c73(0x47e),_0x359194),null;}}async function runDataIntegrityDiagnosis(){const _0x1d20c1=_0x211817;showToast(_0x1d20c1(0x146b),_0x1d20c1(0x477));try{const _0x42b3aa=await diagnoseDataIntegrity();if(!_0x42b3aa){showToast(_0x1d20c1(0xe6e),'error');return;}const _0xb30a5b=_0x42b3aa[_0x1d20c1(0x5f9)]['length']+_0x42b3aa[_0x1d20c1(0x14ec)][_0x1d20c1(0x19ee)]+_0x42b3aa[_0x1d20c1(0x18e9)][_0x1d20c1(0x19ee)]+_0x42b3aa['characterIssues']['length'];let _0x46bcda=_0x1d20c1(0x36e);_0x46bcda+='总计发现\x20'+_0xb30a5b+'\x20个潜在问题：\x0a',_0x46bcda+='•\x20跨角色引用:\x20'+_0x42b3aa[_0x1d20c1(0x5f9)][_0x1d20c1(0x19ee)]+_0x1d20c1(0x41e),_0x46bcda+='•\x20记忆归属问题:\x20'+_0x42b3aa[_0x1d20c1(0x14ec)][_0x1d20c1(0x19ee)]+'\x20个\x0a',_0x46bcda+=_0x1d20c1(0x125d)+_0x42b3aa[_0x1d20c1(0x18e9)][_0x1d20c1(0x19ee)]+_0x1d20c1(0x41e),_0x46bcda+=_0x1d20c1(0xc7c)+_0x42b3aa['characterIssues'][_0x1d20c1(0x19ee)]+_0x1d20c1(0x1ec1),_0xb30a5b===0x0?(_0x46bcda+=_0x1d20c1(0x475),showToast(_0x1d20c1(0x548),_0x1d20c1(0x11cb))):(_0x46bcda+=_0x1d20c1(0xaa6),_0x42b3aa[_0x1d20c1(0x5f9)][_0x1d20c1(0x19ee)]>0x0&&(_0x46bcda+=_0x1d20c1(0x12fd)),_0x42b3aa[_0x1d20c1(0x14ec)]['length']>0x0&&(_0x46bcda+='🚨\x20记忆归属问题可能导致角色知道不该知道的信息。\x0a'),_0x46bcda+=_0x1d20c1(0x74d),_0x46bcda+=_0x1d20c1(0xbb5),_0x46bcda+='2.\x20考虑清理相关角色的聊天记录\x0a',_0x46bcda+=_0x1d20c1(0x1906),showToast(_0x1d20c1(0x2c7),_0x1d20c1(0x1816))),alert(_0x46bcda),console[_0x1d20c1(0x2187)](_0x1d20c1(0x1b22)),console[_0x1d20c1(0x2187)](_0x1d20c1(0x1184),_0x42b3aa);}catch(_0x33df90){console[_0x1d20c1(0x174a)](_0x1d20c1(0x10d9),_0x33df90),showToast('诊断过程中出现错误','error');}}async function fixDataSyncIssues(){const _0x2cb50b=_0x211817;console[_0x2cb50b(0x2187)]('🔧\x20开始修复数据同步问题...'),showToast('正在修复数据同步问题...',_0x2cb50b(0x477));try{let _0x1bad11=0x0;const _0x1916a2=[];console['log']('🔧\x20重新从数据库加载消息...');const _0x59c3fd=await db['chatMessages'][_0x2cb50b(0xf13)](),_0x351dcc={};for(const _0x47b8ee of _0x59c3fd){const _0x27fb2a=_0x47b8ee[_0x2cb50b(0xaf5)];!_0x351dcc[_0x27fb2a]&&(_0x351dcc[_0x27fb2a]=[]),_0x47b8ee[_0x2cb50b(0x1ea3)]&&typeof _0x47b8ee[_0x2cb50b(0x1ea3)]==='object'&&_0x351dcc[_0x27fb2a][_0x2cb50b(0x1cd6)](_0x47b8ee[_0x2cb50b(0x1ea3)]);}for(const [_0x135593,_0x4c9d02]of Object['entries'](_0x351dcc)){_0x4c9d02[_0x2cb50b(0x1104)]((_0xbd20b2,_0x402ae9)=>_0xbd20b2['timestamp']-_0x402ae9['timestamp']);const _0x35c482=[],_0x104f4a=new Set(),_0x14f438=new Set();for(const _0x1931ce of _0x4c9d02){const _0x33f84a=_0x1931ce[_0x2cb50b(0x211c)]+'_'+_0x1931ce['timestamp'];if(_0x1931ce['id']&&_0x104f4a['has'](_0x1931ce['id'])){console[_0x2cb50b(0x2187)]('🔧\x20跳过重复消息ID:\x20'+_0x1931ce['id']);continue;}if(_0x14f438[_0x2cb50b(0x975)](_0x33f84a)){console[_0x2cb50b(0x2187)](_0x2cb50b(0x5cc)+_0x33f84a[_0x2cb50b(0x17ca)](0x0,0x32)+'...');continue;}if(_0x1931ce['id'])_0x104f4a[_0x2cb50b(0x21e2)](_0x1931ce['id']);_0x14f438[_0x2cb50b(0x21e2)](_0x33f84a),_0x35c482[_0x2cb50b(0x1cd6)](_0x1931ce);}_0x351dcc[_0x135593]=_0x35c482;}for(const [_0xedce75,_0x106815]of Object[_0x2cb50b(0x2bc)](_0x351dcc)){const _0x1f7181=chatMessages[_0xedce75]||[];_0x106815[_0x2cb50b(0x19ee)]!==_0x1f7181['length']&&(console[_0x2cb50b(0x2187)]('🔧\x20修复角色\x20'+_0xedce75+_0x2cb50b(0xfab)+_0x106815['length']+_0x2cb50b(0x5c4)+_0x1f7181[_0x2cb50b(0x19ee)]+'条'),chatMessages[_0xedce75]=_0x106815,_0x1916a2['push'](_0xedce75),_0x1bad11+=Math[_0x2cb50b(0x1b24)](_0x106815[_0x2cb50b(0x19ee)]-_0x1f7181[_0x2cb50b(0x19ee)]));}console['log'](_0x2cb50b(0xf1e)),await db[_0x2cb50b(0x1464)]('rw',db[_0x2cb50b(0x19a2)],async()=>{const _0x2e2a75=_0x2cb50b;await db[_0x2e2a75(0x19a2)][_0x2e2a75(0xa4f)]();const _0x4ba1cf=[];for(const [_0x3dcbe9,_0x17386d]of Object[_0x2e2a75(0x2bc)](chatMessages)){_0x17386d[_0x2e2a75(0x19fb)]((_0x4de393,_0x54cec5)=>{const _0x28f30f=_0x2e2a75,_0xc88124=_0x3dcbe9+_0x28f30f(0x13ab)+(_0x4de393['timestamp']||Date[_0x28f30f(0x2eb)]())+'_'+_0x54cec5+'_'+Math['random']()[_0x28f30f(0x1878)](0x24)[_0x28f30f(0x15fb)](0x2,0x6);_0x4ba1cf[_0x28f30f(0x1cd6)]({'id':_0xc88124,'characterId':_0x3dcbe9,'timestamp':_0x4de393[_0x28f30f(0x1716)],'messageOrder':_0x54cec5,'originalMessageId':_0x4de393['id'],'messageData':_0x4de393});});}_0x4ba1cf['length']>0x0&&await db[_0x2e2a75(0x19a2)][_0x2e2a75(0x2a3)](_0x4ba1cf);});currentChatCharacter&&_0x1916a2[_0x2cb50b(0x1831)](currentChatCharacter['id'])&&(console['log'](_0x2cb50b(0x1a6a)),renderChatMessages(currentChatCharacter['id']));const _0x3edfa0=_0x1bad11>0x0?_0x2cb50b(0xbc8)+_0x1916a2['length']+_0x2cb50b(0x11ca)+_0x1bad11+_0x2cb50b(0x107e):'✅\x20数据同步检查完成！\x0a\x0a所有角色的数据库与内存数据已保持一致，\x0a没有发现需要修复的问题。';return console[_0x2cb50b(0x2187)](_0x2cb50b(0xffa)+_0x1916a2[_0x2cb50b(0x19ee)]+_0x2cb50b(0x11e0)+_0x1bad11+_0x2cb50b(0x220b)),showToast(_0x2cb50b(0x174f),'success'),alert(_0x3edfa0),{'fixedCharacters':_0x1916a2['length'],'totalFixed':_0x1bad11};}catch(_0x261a0d){console[_0x2cb50b(0x174a)](_0x2cb50b(0xe5b),_0x261a0d),showToast('数据同步修复失败，请查看控制台','error');throw _0x261a0d;}}async function cleanupCorruptedMessages(_0xed5c8){const _0x1ca089=_0x211817;if(!chatMessages[_0xed5c8])return;let _0xab0147=![];const _0x23e554=chatMessages[_0xed5c8]['map'](_0x4fadbf=>{const _0x5c6d10=_0x167f;if(typeof _0x4fadbf[_0x5c6d10(0x211c)]===_0x5c6d10(0x28d)&&_0x4fadbf['content']!==null&&!Array[_0x5c6d10(0x1496)](_0x4fadbf[_0x5c6d10(0x211c)])){console['log'](_0x5c6d10(0xe01),_0x4fadbf),_0xab0147=!![];if(_0x4fadbf['type']===_0x5c6d10(0x78a))return{..._0x4fadbf,'content':_0x5c6d10(0xe3f)+(_0x4fadbf['amount']||0x0)+(_0x4fadbf[_0x5c6d10(0x1814)]?_0x5c6d10(0x1811)+_0x4fadbf['note']:'')};else{if(_0x4fadbf[_0x5c6d10(0x1a4b)]===_0x5c6d10(0x13ed))return{..._0x4fadbf,'content':_0x4fadbf[_0x5c6d10(0x211c)][_0x5c6d10(0x211c)]||_0x5c6d10(0x462)};else{if(_0x4fadbf['type']===_0x5c6d10(0x1a36))return{..._0x4fadbf,'content':'[AI图片]'+(_0x4fadbf['imageDescription']?_0x5c6d10(0x1811)+_0x4fadbf[_0x5c6d10(0x646)]:'')};else{if(_0x4fadbf[_0x5c6d10(0x8e7)])return{..._0x4fadbf,'content':_0x5c6d10(0x1942)+(_0x4fadbf[_0x5c6d10(0x29d)]?_0x5c6d10(0x1811)+_0x4fadbf[_0x5c6d10(0x29d)]:'')};else{const _0x4386f5=_0x4fadbf[_0x5c6d10(0x211c)][_0x5c6d10(0x211c)]||_0x4fadbf[_0x5c6d10(0x211c)][_0x5c6d10(0x1e8e)]||_0x4fadbf[_0x5c6d10(0x211c)][_0x5c6d10(0x1378)]||_0x5c6d10(0x424);return{..._0x4fadbf,'content':_0x4386f5};}}}}}if(_0x4fadbf[_0x5c6d10(0x211c)]&&typeof _0x4fadbf[_0x5c6d10(0x211c)]!=='string'&&!Array['isArray'](_0x4fadbf['content']))return console[_0x5c6d10(0x2187)](_0x5c6d10(0x16e3),_0x4fadbf),_0xab0147=!![],{..._0x4fadbf,'content':String(_0x4fadbf[_0x5c6d10(0x211c)])};if(Array[_0x5c6d10(0x1496)](_0x4fadbf[_0x5c6d10(0x211c)])){console[_0x5c6d10(0x2187)](_0x5c6d10(0x107b),_0x4fadbf['content']);const _0x4504b4=_0x4fadbf['content'][_0x5c6d10(0x1e1f)](_0x2f995e=>{const _0x376321=_0x5c6d10;if(!_0x2f995e||typeof _0x2f995e!==_0x376321(0x28d))return![];if(_0x2f995e['type']===_0x376321(0x1378)&&typeof _0x2f995e[_0x376321(0x1378)]==='string')return!![];if(_0x2f995e['type']===_0x376321(0x910)&&_0x2f995e[_0x376321(0x910)]&&_0x2f995e[_0x376321(0x910)]['url'])return!![];return![];});if(_0x4504b4[_0x5c6d10(0x19ee)]!==_0x4fadbf['content'][_0x5c6d10(0x19ee)])return console[_0x5c6d10(0x2187)](_0x5c6d10(0x15fc),_0x4fadbf['content'][_0x5c6d10(0x19ee)],'->',_0x4504b4[_0x5c6d10(0x19ee)]),_0xab0147=!![],{..._0x4fadbf,'content':_0x4504b4};}return _0x4fadbf;});if(_0xab0147){console[_0x1ca089(0x2187)](_0x1ca089(0x1057)),chatMessages[_0xed5c8]=_0x23e554;try{await saveChatMessagesImmediate([_0xed5c8]),console['log'](_0x1ca089(0x1754));}catch(_0x3c9268){console[_0x1ca089(0x174a)](_0x1ca089(0xe8d),_0x3c9268),await saveChatMessages();}currentChatCharacter&&currentChatCharacter['id']===_0xed5c8&&renderChatMessages(_0xed5c8);}}function showForwardTargetModal(){const _0x57d836=_0x211817;if(selectedMessages['size']===0x0){showToast(_0x57d836(0x1143),_0x57d836(0x1816));return;}const _0xfd0e21=document[_0x57d836(0x1262)](_0x57d836(0xb08));_0xfd0e21[_0x57d836(0x33a)]='';const _0x5e68fb=[];characters[_0x57d836(0x19fb)](_0x119e2b=>{const _0x562ecf=_0x57d836;contacts[_0x562ecf(0x1831)](_0x119e2b['id'])&&_0x5e68fb[_0x562ecf(0x1cd6)]({'id':_0x119e2b['id'],'name':_0x119e2b[_0x562ecf(0x1a1c)],'avatarUrl':_0x119e2b[_0x562ecf(0x1994)],'isGroup':![]});}),groupChats[_0x57d836(0x19fb)](_0x4ac7ad=>{const _0x10c53b=_0x57d836;_0x5e68fb[_0x10c53b(0x1cd6)]({'id':_0x4ac7ad['id'],'name':_0x4ac7ad[_0x10c53b(0x1a1c)],'avatarUrl':_0x4ac7ad[_0x10c53b(0x1994)],'isGroup':!![]});}),_0x5e68fb[_0x57d836(0x19ee)]===0x0?_0xfd0e21['innerHTML']=_0x57d836(0x19a):_0x5e68fb['forEach'](_0x35d26e=>{const _0x347b70=_0x57d836,_0x5b9cd7=document[_0x347b70(0xac6)](_0x347b70(0xbbc));_0x5b9cd7['className']=_0x347b70(0x18e5),_0x5b9cd7[_0x347b70(0x1f36)]=()=>forwardMessagesTo(_0x35d26e['id']),_0x5b9cd7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-icon\x22\x20style=\x22background-color:\x20'+(_0x35d26e[_0x347b70(0xc3d)]||'#ddd')+';\x20'+(_0x35d26e[_0x347b70(0x1994)]?_0x347b70(0x2236)+_0x35d26e[_0x347b70(0x1994)]+_0x347b70(0x1dd):'')+_0x347b70(0x1ada)+(!_0x35d26e['avatarUrl']?_0x35d26e[_0x347b70(0x1f68)]?'群':_0x35d26e[_0x347b70(0x1a1c)][_0x347b70(0xcc3)](0x0):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>'+_0x35d26e[_0x347b70(0x1a1c)]+_0x347b70(0x1ac),_0xfd0e21['appendChild'](_0x5b9cd7);}),showModal(_0x57d836(0xa69));}async function forwardMessagesTo(_0x1a48c0){const _0x1c1afb=_0x211817;if(selectedMessages[_0x1c1afb(0x2d8)]===0x0)return;const _0x18af5d=getCurrentChatSettings(),_0x44957f=_0x18af5d['myChatNickname']||(personas[_0x1c1afb(0xaf4)](_0x2ccbf4=>_0x2ccbf4['id']===_0x18af5d['selectedIdentityId'])?.[_0x1c1afb(0x1a1c)]||'我'),_0x5e47e6=[],_0x575e75=chatMessages[currentChatCharacter['id']]||[];_0x575e75[_0x1c1afb(0x19fb)](_0x1c65b7=>{const _0x43dccc=_0x1c1afb;if(selectedMessages[_0x43dccc(0x975)](_0x1c65b7['id'])){const _0x3c2b1={..._0x1c65b7};_0x1c65b7[_0x43dccc(0x8a1)]===_0x43dccc(0x1e6d)?_0x3c2b1[_0x43dccc(0xb51)]=_0x44957f:_0x3c2b1[_0x43dccc(0xdbc)]=currentChatCharacter['name'],_0x5e47e6[_0x43dccc(0x1cd6)](_0x3c2b1);}}),_0x5e47e6[_0x1c1afb(0x1104)]((_0x164e94,_0x4f8ae7)=>_0x164e94['timestamp']-_0x4f8ae7[_0x1c1afb(0x1716)]);const _0x2707bc=currentChatCharacter;let _0x155b2c='';_0x2707bc[_0x1c1afb(0x1f68)]?_0x155b2c=_0x2707bc[_0x1c1afb(0x1a1c)]+'的群聊记录':_0x155b2c=_0x44957f+'和'+_0x2707bc['name']+_0x1c1afb(0x14b0);const _0x4bcb07={'id':Date[_0x1c1afb(0x2eb)]()[_0x1c1afb(0x1878)](),'sender':_0x1c1afb(0x1e6d),'type':_0x1c1afb(0x52c),'content':_0x155b2c,'forwardedMessages':_0x5e47e6,'timestamp':Date[_0x1c1afb(0x2eb)]()};console['log']('🔍\x20[转发消息创建]\x20转发消息对象:',_0x4bcb07),console[_0x1c1afb(0x2187)](_0x1c1afb(0x2060),_0x5e47e6[_0x1c1afb(0x19ee)]),console[_0x1c1afb(0x2187)](_0x1c1afb(0x93d),_0x5e47e6);!chatMessages[_0x1a48c0]&&(chatMessages[_0x1a48c0]=[]);chatMessages[_0x1a48c0][_0x1c1afb(0x1cd6)](_0x4bcb07);try{const _0x287b95=_0x1a48c0+'_'+_0x4bcb07['id']+'_'+(chatMessages[_0x1a48c0][_0x1c1afb(0x19ee)]-0x1);await db[_0x1c1afb(0x19a2)][_0x1c1afb(0x21e2)]({'id':_0x287b95,'characterId':_0x1a48c0,'timestamp':_0x4bcb07['timestamp'],'messageOrder':chatMessages[_0x1a48c0]['length']-0x1,'originalMessageId':_0x4bcb07['id'],'messageData':_0x4bcb07}),console[_0x1c1afb(0x2187)](_0x1c1afb(0x187c));}catch(_0x47f3bb){console['error'](_0x1c1afb(0x22b8),_0x47f3bb),await saveChatMessages(_0x1a48c0);}hideModal(_0x1c1afb(0xa69)),exitMessageSelectionMode(),renderMessageList();if(currentChatCharacter&&currentChatCharacter['id']===_0x1a48c0){renderChatMessages(_0x1a48c0),pendingUserMessage=_0x4bcb07,console['log']('🔍\x20[转发消息]\x20设置为待回复消息:',_0x4bcb07);const _0x42b4e7=document[_0x1c1afb(0x1262)](_0x1c1afb(0x1d2b));_0x42b4e7&&(_0x42b4e7['style'][_0x1c1afb(0x2231)]=_0x1c1afb(0x2241),_0x42b4e7['classList']['add']('waiting'));}showToast(_0x1c1afb(0x1923),_0x1c1afb(0x11cb));}function renderForwardedMessage(_0x4d6ffb){const _0x156c48=_0x211817;console['log'](_0x156c48(0x1b09),_0x4d6ffb);const _0x36ffee=_0x4d6ffb['forwardedMessages']['slice'](0x0,0x4);let _0x5b7d4a='';const _0x44f4de=_0x4d6ffb[_0x156c48(0xc15)];console[_0x156c48(0x2187)](_0x156c48(0xe95),_0x44f4de);_0x44f4de&&_0x44f4de['length']>0x0?(console[_0x156c48(0x2187)](_0x156c48(0x21f9),_0x44f4de['length']),_0x36ffee['forEach']((_0x545ed5,_0x1f535f)=>{const _0x4a253b=_0x156c48;let _0x459ef3;_0x545ed5['sender']===_0x4a253b(0x1e6d)?_0x459ef3=_0x545ed5[_0x4a253b(0xb51)]||'我':_0x459ef3=_0x545ed5['name']||_0x545ed5[_0x4a253b(0xdbc)]||'角色';const _0x2fc010=safeExtractMessageContent(_0x545ed5);let _0x1ae85c=truncateText(_0x2fc010,0x14);console[_0x4a253b(0x2187)](_0x4a253b(0x416)+(_0x1f535f+0x1)+':\x20'+_0x459ef3+':\x20'+_0x1ae85c),_0x5b7d4a+=_0x4a253b(0x1ca7)+_0x459ef3+':\x20'+_0x1ae85c+'</p>';})):console[_0x156c48(0x2187)]('❌\x20[renderForwardedMessage]\x20没有转发消息数据');const _0x7dfe95=_0x4d6ffb['id']||Date[_0x156c48(0x2eb)]()['toString']();return console['log'](_0x156c48(0x147a),_0x7dfe95,_0x156c48(0x21d8),_0x4d6ffb[_0x156c48(0xc15)][_0x156c48(0x19ee)]),_0x156c48(0x19e5)+_0x7dfe95+_0x156c48(0x117a)+_0x4d6ffb[_0x156c48(0x211c)]['replace'](/"/g,_0x156c48(0xb65))+_0x156c48(0x11e8)+_0x7dfe95+_0x156c48(0xdf8)+_0x4d6ffb[_0x156c48(0x211c)]+_0x156c48(0x1c26)+_0x5b7d4a+_0x156c48(0xfc9)+_0x4d6ffb[_0x156c48(0xc15)][_0x156c48(0x19ee)]+'条转发消息</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}function showForwardedMessages(_0x47387c,_0x159e2f){const _0x330728=_0x211817,_0x1ba1ae=document[_0x330728(0x1262)](_0x330728(0x195f)),_0x788d12=document[_0x330728(0x1262)](_0x330728(0x199e));_0x1ba1ae[_0x330728(0x13be)]=_0x159e2f,_0x788d12[_0x330728(0x33a)]='',_0x47387c['forEach'](_0x54a240=>{const _0x9090a1=_0x330728;let _0xc31423;_0x54a240[_0x9090a1(0x8a1)]==='sent'?_0xc31423=_0x54a240[_0x9090a1(0xb51)]||'我':_0xc31423=_0x54a240[_0x9090a1(0x1a1c)]||_0x54a240[_0x9090a1(0xdbc)]||'角色';const _0x219aad=safeExtractMessageContent(_0x54a240),_0x54b9a7=document['createElement'](_0x9090a1(0xbbc));_0x54b9a7[_0x9090a1(0x1722)]=_0x9090a1(0xc6c),_0x54b9a7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forwarded-message-sender\x22>'+_0xc31423+_0x9090a1(0x1e44)+_0x219aad+_0x9090a1(0x1f39),_0x788d12[_0x9090a1(0x497)](_0x54b9a7);}),showModal(_0x330728(0xd68));}function showForwardedMessagesById(_0x92a7c6){const _0x4d10f9=_0x211817;console[_0x4d10f9(0x2187)](_0x4d10f9(0x19de),_0x92a7c6),console[_0x4d10f9(0x2187)]('🔍\x20[转发卡片点击]\x20当前聊天角色:',currentChatCharacter?.[_0x4d10f9(0x1a1c)],_0x4d10f9(0x15d2),currentChatCharacter?.['isGroup']);const _0x4d8303=chatMessages[currentChatCharacter['id']]||[];console[_0x4d10f9(0x2187)]('🔍\x20[转发卡片点击]\x20当前聊天记录数量:',_0x4d8303[_0x4d10f9(0x19ee)]);const _0x561834=_0x4d8303[_0x4d10f9(0xaf4)](_0x2e9c0e=>_0x2e9c0e['id']===_0x92a7c6&&_0x2e9c0e[_0x4d10f9(0x1a4b)]==='forwarded_message');console['log'](_0x4d10f9(0x1173),_0x561834),_0x561834&&_0x561834[_0x4d10f9(0xc15)]?(console[_0x4d10f9(0x2187)]('✅\x20[转发卡片点击]\x20找到转发消息，显示详情'),console['log']('🔍\x20[转发卡片点击]\x20转发消息数量:',_0x561834[_0x4d10f9(0xc15)][_0x4d10f9(0x19ee)]),showForwardedMessages(_0x561834[_0x4d10f9(0xc15)],_0x561834[_0x4d10f9(0x211c)])):(console[_0x4d10f9(0x174a)](_0x4d10f9(0x18d),_0x92a7c6),console['log'](_0x4d10f9(0x69c),_0x4d8303[_0x4d10f9(0x6a4)](_0xf9084a=>({'id':_0xf9084a['id'],'type':_0xf9084a['type']}))),showToast(_0x4d10f9(0x806),_0x4d10f9(0x174a)));}async function getMountedMemories(_0x1a24c0,_0x4ffaff){const _0x1187d5=_0x211817;if(!_0x4ffaff[_0x1187d5(0x159a)]||!_0x4ffaff['selectedMemoryChats']||_0x4ffaff[_0x1187d5(0x20f1)][_0x1187d5(0x19ee)]===0x0)return'';const _0x381339=_0x4ffaff[_0x1187d5(0x2c1)]||0x3;let _0x5b3efd='';for(const _0x50dff3 of _0x4ffaff[_0x1187d5(0x20f1)]){if(_0x50dff3===_0x1a24c0)continue;const _0x1cf396=chatMessages[_0x50dff3]||[];if(_0x1cf396[_0x1187d5(0x19ee)]===0x0)continue;const _0x56babb=_0x1cf396['slice'](-_0x381339);if(_0x56babb['length']===0x0)continue;let _0x30234f=_0x1187d5(0x2290),_0x1ca667='单聊';const _0x2c47bc=characters[_0x1187d5(0xaf4)](_0x16b50f=>_0x16b50f['id']===_0x50dff3);if(_0x2c47bc)_0x30234f=_0x2c47bc[_0x1187d5(0x1a1c)],_0x1ca667='单聊';else{const _0xd8caa6=groupChats['find'](_0x31b280=>_0x31b280['id']===_0x50dff3);_0xd8caa6&&(_0x30234f=_0xd8caa6['name'],_0x1ca667='群聊');}_0x5b3efd+=_0x1187d5(0x598)+_0x1ca667+'记忆\x20-\x20'+_0x30234f+_0x1187d5(0x2153)+_0x30234f+_0x1187d5(0x18ef),_0x56babb[_0x1187d5(0x19fb)](_0xd6aa39=>{const _0x3f59fa=_0x1187d5;let _0x7056a6='',_0x235b74=_0xd6aa39[_0x3f59fa(0x211c)]||'';if(_0xd6aa39[_0x3f59fa(0x8a1)]===_0x3f59fa(0x1e6d))_0x7056a6='用户';else _0xd6aa39[_0x3f59fa(0x8a1)]==='received'||_0xd6aa39[_0x3f59fa(0x8a1)]==='ai'?_0x1ca667==='群聊'&&_0xd6aa39[_0x3f59fa(0x1a1c)]?_0x7056a6=_0xd6aa39[_0x3f59fa(0x1a1c)]:_0x7056a6=_0x30234f:_0x7056a6='系统';if(_0xd6aa39[_0x3f59fa(0x1a4b)]==='voice_message')_0x235b74=_0x3f59fa(0x13ff)+_0x235b74+']';else{if(_0xd6aa39[_0x3f59fa(0x1a4b)]===_0x3f59fa(0x78a))_0x235b74=_0x3f59fa(0x2295)+_0xd6aa39[_0x3f59fa(0x2018)]+'元'+(_0xd6aa39[_0x3f59fa(0x1814)]?_0x3f59fa(0x1811)+_0xd6aa39[_0x3f59fa(0x1814)]:'')+']';else{if(_0xd6aa39['type']==='ai_image')_0x235b74='[AI图片：'+(_0xd6aa39[_0x3f59fa(0x646)]||_0x3f59fa(0x1e96))+']';else{if(_0xd6aa39[_0x3f59fa(0x8e7)])_0x235b74=_0x3f59fa(0x1719)+(_0xd6aa39[_0x3f59fa(0x29d)]||_0x3f59fa(0x16ce))+']';else{if(_0xd6aa39[_0x3f59fa(0x1a4b)]==='location')_0x235b74=_0x3f59fa(0x10bd)+(_0xd6aa39[_0x3f59fa(0x1b93)]||_0x3f59fa(0x19d1))+']';else{if(Array[_0x3f59fa(0x1496)](_0x235b74)){const _0x184cd0=_0x235b74[_0x3f59fa(0xaf4)](_0x38bf6c=>_0x38bf6c[_0x3f59fa(0x1a4b)]==='text')?.['text']||'';_0x235b74=_0x184cd0?_0x3f59fa(0x420)+_0x184cd0+']':'[图片]';}}}}}}(typeof _0x235b74!==_0x3f59fa(0x11b7)||!_0x235b74[_0x3f59fa(0x19d7)]())&&(_0x235b74='[特殊消息]'),_0x5b3efd+=_0x7056a6+'：'+_0x235b74+'\x0a';});}if(_0x5b3efd['trim']())return console['log'](_0x1187d5(0x1423),_0x4ffaff[_0x1187d5(0x20f1)]['length']),_0x5b3efd;return'';}function convertGroupChatToStandardFormat(_0x17e3da){const _0x579786=_0x211817;if(!_0x17e3da['members'])return _0x17e3da;const _0x239e84=_0x17e3da[_0x579786(0x12a6)][_0x579786(0x6a4)](_0x1e8be3=>({'id':_0x1e8be3['id'],'name':_0x1e8be3['name'],'persona':_0x1e8be3[_0x579786(0x1e33)]||_0x1e8be3['bio'],'avatarUrl':_0x1e8be3['avatarUrl'],'color':_0x1e8be3[_0x579786(0xc3d)]}));return!_0x17e3da[_0x579786(0x1512)]&&(_0x17e3da[_0x579786(0x1512)]={'myPersona':'用户','myNickname':'我'}),{..._0x17e3da,'members':_0x239e84};}function buildGroupChatMessageHistory(_0x21461b,_0x41b320){const _0x233bda=_0x211817;if(!_0x21461b||!Array[_0x233bda(0x1496)](_0x21461b))return[];return _0x21461b[_0x233bda(0x6a4)](_0x1b8a65=>{const _0x273c13=_0x233bda;if(_0x1b8a65[_0x273c13(0x8a1)]==='system')return{'role':_0x273c13(0xa80),'content':_0x273c13(0x146d)+_0x1b8a65[_0x273c13(0x211c)]};else{if(_0x1b8a65[_0x273c13(0x8a1)]==='sent'){const _0xbb7f14=getCurrentChatSettings(),_0x2ee61e=_0xbb7f14[_0x273c13(0x567)]||_0x41b320[_0x273c13(0x1512)]?.[_0x273c13(0x42a)]||'我';let _0x2e06fa;if(_0x1b8a65['type']===_0x273c13(0xd38))_0x2e06fa='['+_0x2ee61e+_0x273c13(0xade)+_0x1b8a65[_0x273c13(0x211c)]+'\x27]';else{if(_0x1b8a65[_0x273c13(0x1a4b)]==='voice_message')_0x2e06fa='['+_0x2ee61e+_0x273c13(0x11c4)+_0x1b8a65[_0x273c13(0x211c)]+'\x27]';else{if(_0x1b8a65[_0x273c13(0x1a4b)]==='transfer')_0x2e06fa='['+_0x1b8a65[_0x273c13(0x909)]+'向'+_0x1b8a65[_0x273c13(0x123a)]+_0x273c13(0x1587)+_0x1b8a65[_0x273c13(0x2018)]+_0x273c13(0x1798)+_0x1b8a65[_0x273c13(0x1814)]+']';else{if(_0x1b8a65[_0x273c13(0x1a4b)]===_0x273c13(0x52c)){let _0x36f2c5='['+_0x2ee61e+_0x273c13(0x1690)+_0x1b8a65[_0x273c13(0x211c)]+']';_0x1b8a65[_0x273c13(0xc15)]&&_0x1b8a65[_0x273c13(0xc15)][_0x273c13(0x19ee)]>0x0&&(_0x36f2c5+=_0x273c13(0xb06),_0x1b8a65[_0x273c13(0xc15)][_0x273c13(0x19fb)]((_0x347009,_0x35e129)=>{const _0x9ef506=_0x273c13;let _0x567656;_0x347009[_0x9ef506(0x8a1)]==='sent'?_0x567656=_0x347009[_0x9ef506(0xb51)]||'用户':_0x567656=_0x347009[_0x9ef506(0x1a1c)]||_0x347009[_0x9ef506(0xdbc)]||'AI';const _0x3ce19d=safeExtractMessageContent(_0x347009);_0x36f2c5+=_0x567656+':\x20'+_0x3ce19d+'\x0a';})),_0x2e06fa=_0x36f2c5;}else _0x1b8a65[_0x273c13(0x1e4d)]?_0x2e06fa=_0x2ee61e+':\x20[发送了一个表情，意思是:\x20\x27'+_0x1b8a65[_0x273c13(0x1e4d)]+'\x27]':_0x2e06fa=_0x2ee61e+':\x20'+_0x1b8a65[_0x273c13(0x211c)];}}}if(_0x1b8a65[_0x273c13(0x1dbe)]){const _0x5dca74='['+_0x2ee61e+_0x273c13(0x642)+_0x1b8a65[_0x273c13(0x1dbe)]['senderName']+_0x273c13(0x1dc4)+_0x1b8a65['replyTo']['content']+'\x22]\x20';_0x2e06fa=_0x5dca74+_0x2e06fa[_0x273c13(0xe16)](_0x2ee61e+':\x20','');}return _0x1b8a65['id']&&(_0x2e06fa=_0x273c13(0x4d2)+_0x1b8a65['id']+']\x20'+_0x2e06fa),{'role':_0x273c13(0xa80),'content':_0x2e06fa};}else{const _0x29c86e=_0x1b8a65[_0x273c13(0x909)]||_0x1b8a65['name']||'未知';let _0x2d3992;if(_0x1b8a65[_0x273c13(0x1a4b)]===_0x273c13(0x1a36))_0x2d3992='['+_0x29c86e+_0x273c13(0x1ec8);else{if(_0x1b8a65['type']===_0x273c13(0x13ed))_0x2d3992='['+_0x29c86e+_0x273c13(0x11c4)+_0x1b8a65['content']+'\x27]';else{if(_0x1b8a65[_0x273c13(0x1a4b)]===_0x273c13(0x78a))_0x2d3992='['+_0x1b8a65[_0x273c13(0x909)]+'向'+_0x1b8a65[_0x273c13(0x123a)]+_0x273c13(0x1587)+_0x1b8a65['amount']+_0x273c13(0x1798)+_0x1b8a65[_0x273c13(0x1814)]+']';else{if(_0x1b8a65[_0x273c13(0x1a4b)]==='forwarded_message'){let _0x5da59e='['+_0x29c86e+_0x273c13(0x1690)+_0x1b8a65[_0x273c13(0x211c)]+']';_0x1b8a65['forwardedMessages']&&_0x1b8a65[_0x273c13(0xc15)][_0x273c13(0x19ee)]>0x0&&(_0x5da59e+=_0x273c13(0xb06),_0x1b8a65[_0x273c13(0xc15)][_0x273c13(0x19fb)]((_0x2394b0,_0x438199)=>{const _0x2dab2c=_0x273c13;let _0x514db2;_0x2394b0[_0x2dab2c(0x8a1)]===_0x2dab2c(0x1e6d)?_0x514db2=_0x2394b0[_0x2dab2c(0xb51)]||'用户':_0x514db2=_0x2394b0[_0x2dab2c(0x1a1c)]||_0x2394b0[_0x2dab2c(0xdbc)]||'AI';const _0x541047=safeExtractMessageContent(_0x2394b0);_0x5da59e+=_0x514db2+':\x20'+_0x541047+'\x0a';})),_0x2d3992=_0x5da59e;}else{if(_0x1b8a65[_0x273c13(0x1e4d)])_0x2d3992=_0x29c86e+_0x273c13(0x1774)+_0x1b8a65['meaning']+'\x27]';else Array[_0x273c13(0x1496)](_0x1b8a65[_0x273c13(0x211c)])?_0x2d3992=[..._0x1b8a65[_0x273c13(0x211c)],{'type':_0x273c13(0x1378),'text':_0x29c86e+':'}]:_0x2d3992=_0x29c86e+':\x20'+_0x1b8a65['content'];}}}}if(_0x1b8a65[_0x273c13(0x1dbe)]){const _0x49d04d='['+_0x29c86e+_0x273c13(0x642)+_0x1b8a65[_0x273c13(0x1dbe)][_0x273c13(0x909)]+_0x273c13(0x1dc4)+_0x1b8a65['replyTo'][_0x273c13(0x211c)]+_0x273c13(0x1fec);_0x2d3992=_0x49d04d+_0x2d3992['replace'](_0x29c86e+':\x20','');}return _0x1b8a65['id']&&(_0x2d3992=_0x273c13(0x4d2)+_0x1b8a65['id']+']\x20'+_0x2d3992),{'role':_0x273c13(0xa80),'content':_0x2d3992};}}});}function checkLocalStorageUsage(){const _0xadbce1=_0x211817;try{let _0x21e045=0x0;const _0x238732=[];for(let _0x2dcfb2 in localStorage){if(localStorage[_0xadbce1(0x663)](_0x2dcfb2)){const _0x107e8f=localStorage[_0x2dcfb2]['length'];_0x21e045+=_0x107e8f,_0x238732[_0xadbce1(0x1cd6)]({'key':_0x2dcfb2,'size':_0x107e8f});}}const _0x4a4f73=(_0x21e045/0x400/0x400)['toFixed'](0x2);return console[_0xadbce1(0x2187)](_0xadbce1(0x2f6)+_0x4a4f73+'MB'),_0x238732[_0xadbce1(0x1104)]((_0x4fa234,_0x39ba00)=>_0x39ba00[_0xadbce1(0x2d8)]-_0x4fa234[_0xadbce1(0x2d8)]),_0x238732[_0xadbce1(0x6d5)](0x0,0x5)[_0xadbce1(0x19fb)](_0x538537=>{const _0x28771c=_0xadbce1,_0x1c6e44=(_0x538537[_0x28771c(0x2d8)]/0x400/0x400)['toFixed'](0x2);console[_0x28771c(0x2187)](_0x28771c(0x189)+_0x538537[_0x28771c(0x213c)]+':\x20'+_0x1c6e44+'MB');}),_0x21e045>0x4*0x400*0x400&&console[_0xadbce1(0x1f43)](_0xadbce1(0x984)),{'totalSize':_0x21e045,'items':_0x238732};}catch(_0x3c5617){return console['error'](_0xadbce1(0x20dd),_0x3c5617),{'totalSize':0x0,'items':[]};}}async function parseGroupChatAiResponse(_0x448d85,_0x27a0a5){const _0x168bd7=_0x211817;try{let _0xa38524=_0x448d85[_0x168bd7(0x19d7)]();if(_0xa38524['startsWith']('```json'))_0xa38524=_0xa38524['replace'](/^```json\s*/,'')['replace'](/\s*```$/,'');else _0xa38524[_0x168bd7(0x1b30)]('```')&&(_0xa38524=_0xa38524[_0x168bd7(0xe16)](/^```\s*/,'')[_0x168bd7(0xe16)](/\s*```$/,''));const _0x2e15c8=JSON[_0x168bd7(0x22d3)](_0xa38524);if(!Array[_0x168bd7(0x1496)](_0x2e15c8))return console['error'](_0x168bd7(0x249)),[];const _0x1e464c=[];for(const _0x308ae5 of _0x2e15c8){if(typeof _0x308ae5===_0x168bd7(0x28d)&&_0x308ae5[_0x168bd7(0x1a1c)]&&_0x308ae5[_0x168bd7(0x1e8e)]){const _0x16d64c=_0x27a0a5[_0x168bd7(0x12a6)][_0x168bd7(0xaf4)](_0x19ce78=>_0x19ce78[_0x168bd7(0x1a1c)]===_0x308ae5[_0x168bd7(0x1a1c)]);_0x16d64c&&_0x1e464c[_0x168bd7(0x1cd6)]({'id':Date[_0x168bd7(0x2eb)]()+Math[_0x168bd7(0x11a8)](),'sender':_0x168bd7(0xb11),'content':_0x308ae5['message'],'timestamp':Date[_0x168bd7(0x2eb)](),'senderId':_0x16d64c['id'],'senderName':_0x16d64c[_0x168bd7(0x1a1c)],'name':_0x16d64c[_0x168bd7(0x1a1c)]});}else{if(typeof _0x308ae5===_0x168bd7(0x28d)&&_0x308ae5['name']&&_0x308ae5[_0x168bd7(0x1a4b)]===_0x168bd7(0x1a36)){const _0x40f6b5=_0x27a0a5[_0x168bd7(0x12a6)]['find'](_0x582bb0=>_0x582bb0[_0x168bd7(0x1a1c)]===_0x308ae5[_0x168bd7(0x1a1c)]);_0x40f6b5&&_0x1e464c[_0x168bd7(0x1cd6)]({'id':Date['now']()+Math['random'](),'sender':_0x168bd7(0xb11),'type':_0x168bd7(0x1a36),'content':_0x308ae5['description']||_0x168bd7(0xbb8),'imageDescription':_0x308ae5[_0x168bd7(0x7c9)],'timestamp':Date[_0x168bd7(0x2eb)](),'senderId':_0x40f6b5['id'],'senderName':_0x40f6b5[_0x168bd7(0x1a1c)],'name':_0x40f6b5[_0x168bd7(0x1a1c)]});}else{if(typeof _0x308ae5===_0x168bd7(0x28d)&&_0x308ae5['name']&&_0x308ae5['type']===_0x168bd7(0x13ed)){const _0x3ab836=_0x27a0a5[_0x168bd7(0x12a6)][_0x168bd7(0xaf4)](_0x5c38c9=>_0x5c38c9[_0x168bd7(0x1a1c)]===_0x308ae5['name']);_0x3ab836&&_0x1e464c['push']({'id':Date[_0x168bd7(0x2eb)]()+Math[_0x168bd7(0x11a8)](),'sender':_0x168bd7(0xb11),'type':'voice_message','content':_0x308ae5[_0x168bd7(0x211c)],'timestamp':Date['now'](),'senderId':_0x3ab836['id'],'senderName':_0x3ab836[_0x168bd7(0x1a1c)],'name':_0x3ab836['name']});}else{if(typeof _0x308ae5==='object'&&_0x308ae5['name']&&_0x308ae5[_0x168bd7(0x1a4b)]===_0x168bd7(0x172b)){console['log']('🔍\x20[parseGroupChatAiResponse]\x20检测到群聊表情包:',_0x308ae5);const _0x1d4746=_0x27a0a5['members'][_0x168bd7(0xaf4)](_0x2b1032=>_0x2b1032[_0x168bd7(0x1a1c)]===_0x308ae5['name']);if(_0x1d4746){const _0x396e81=await findEmojiForAI(_0x308ae5[_0x168bd7(0x7c9)]);_0x396e81?(console[_0x168bd7(0x2187)]('🔍\x20[parseGroupChatAiResponse]\x20找到匹配的表情包:',_0x396e81),_0x1e464c[_0x168bd7(0x1cd6)]({'id':Date[_0x168bd7(0x2eb)]()+Math[_0x168bd7(0x11a8)](),'sender':_0x168bd7(0xb11),'content':'','image':_0x396e81['url'],'isEmoji':!![],'emojiDescription':_0x396e81[_0x168bd7(0x7c9)],'timestamp':Date[_0x168bd7(0x2eb)](),'senderId':_0x1d4746['id'],'senderName':_0x1d4746['name'],'name':_0x1d4746[_0x168bd7(0x1a1c)]})):(console[_0x168bd7(0x1f43)](_0x168bd7(0x1cd9),_0x308ae5[_0x168bd7(0x7c9)]),_0x1e464c[_0x168bd7(0x1cd6)]({'id':Date[_0x168bd7(0x2eb)]()+Math[_0x168bd7(0x11a8)](),'sender':'received','content':_0x168bd7(0x1fab)+_0x308ae5[_0x168bd7(0x7c9)]+'\x22不存在]','timestamp':Date[_0x168bd7(0x2eb)](),'senderId':_0x1d4746['id'],'senderName':_0x1d4746[_0x168bd7(0x1a1c)],'name':_0x1d4746[_0x168bd7(0x1a1c)]}));}else console[_0x168bd7(0x1f43)](_0x168bd7(0xc05),_0x308ae5[_0x168bd7(0x1a1c)]);}else{if(typeof _0x308ae5===_0x168bd7(0x11b7)){console[_0x168bd7(0x2187)](_0x168bd7(0x605),_0x308ae5);if(_0x27a0a5[_0x168bd7(0x12a6)]&&_0x27a0a5[_0x168bd7(0x12a6)][_0x168bd7(0x19ee)]>0x0){const _0x1c74e2=_0x27a0a5[_0x168bd7(0x12a6)][0x0];_0x1e464c[_0x168bd7(0x1cd6)]({'id':Date['now']()+Math['random'](),'sender':_0x168bd7(0xb11),'content':_0x308ae5,'timestamp':Date[_0x168bd7(0x2eb)](),'senderId':_0x1c74e2['id'],'senderName':_0x1c74e2[_0x168bd7(0x1a1c)],'name':_0x1c74e2[_0x168bd7(0x1a1c)]}),console['log'](_0x168bd7(0x61e),_0x1c74e2[_0x168bd7(0x1a1c)]);}}else console[_0x168bd7(0x1f43)](_0x168bd7(0x1c71),_0x308ae5);}}}}}return _0x1e464c;}catch(_0x4828ee){return console[_0x168bd7(0x174a)](_0x168bd7(0x28c),_0x4828ee),[];}}async function loadGroupChats(){const _0x1760ff=_0x211817;try{const _0xbc4f9a=await db[_0x1760ff(0x1076)][_0x1760ff(0xf13)]();if(_0xbc4f9a[_0x1760ff(0x19ee)]===0x0){const _0x28fdd3=localStorage['getItem'](_0x1760ff(0x1076));if(_0x28fdd3){console[_0x1760ff(0x2187)](_0x1760ff(0x16e1));const _0x19e70d=JSON[_0x1760ff(0x22d3)](_0x28fdd3);if(_0x19e70d[_0x1760ff(0x19ee)]>0x0){const _0x48d39e=_0x19e70d[_0x1760ff(0x6a4)](_0x207c31=>convertGroupChatToStandardFormat({'id':_0x207c31['id']||Date[_0x1760ff(0x2eb)]()[_0x1760ff(0x1878)]()+Math[_0x1760ff(0x11a8)](),'name':_0x207c31[_0x1760ff(0x1a1c)],'description':_0x207c31[_0x1760ff(0x7c9)]||'','members':_0x207c31[_0x1760ff(0x12a6)]||[],'settings':_0x207c31[_0x1760ff(0x1512)]||{},'createdAt':_0x207c31['createdAt']||new Date()['toISOString'](),'updatedAt':_0x207c31[_0x1760ff(0x12e0)]||new Date()['toISOString']()}));await db[_0x1760ff(0x1076)]['bulkAdd'](_0x48d39e),groupChats=_0x48d39e,console['log'](_0x1760ff(0xf05),groupChats);}else groupChats=[];}else groupChats=[];}else groupChats=_0xbc4f9a[_0x1760ff(0x6a4)](convertGroupChatToStandardFormat),console[_0x1760ff(0x2187)](_0x1760ff(0x162f),groupChats);}catch(_0x182c7a){console[_0x1760ff(0x174a)](_0x1760ff(0x476),_0x182c7a);const _0x266536=localStorage[_0x1760ff(0x15d8)]('groupChats');if(_0x266536)try{const _0x4d3b98=JSON['parse'](_0x266536);if(Array['isArray'](_0x4d3b98)&&_0x4d3b98[_0x1760ff(0x19ee)]>0x0){groupChats=_0x4d3b98['map'](convertGroupChatToStandardFormat),console[_0x1760ff(0x2187)]('从localStorage回退加载群聊数据（已转换格式）:',groupChats);try{await db[_0x1760ff(0x1076)][_0x1760ff(0x2a3)](groupChats),console['log'](_0x1760ff(0x8ca));const _0x29cbef=_0x266536['length'];_0x29cbef>0x400*0x400&&(localStorage['removeItem']('groupChats'),console[_0x1760ff(0x2187)](_0x1760ff(0xd53)));}catch(_0xa9bdb8){console['warn'](_0x1760ff(0x1fd8),_0xa9bdb8);}}else groupChats=[];}catch(_0x40b444){console[_0x1760ff(0x174a)]('群聊数据解析失败:',_0x40b444),groupChats=[];}else groupChats=[];}}console[_0x211817(0x2187)](_0x211817(0x1caf));function debugImportFunction(){const _0x3c4d35=_0x211817;try{console[_0x3c4d35(0x2187)]('===\x20导入函数调试\x20===');const _0xda6000=window[_0x3c4d35(0x205e)][_0x3c4d35(0x1878)]();console[_0x3c4d35(0x2187)](_0x3c4d35(0x229a),_0xda6000['length']);const _0x57ce44=_0xda6000[_0x3c4d35(0x1831)]('修复脚本'),_0x112462=_0xda6000[_0x3c4d35(0x1831)]('safeDataSave'),_0x6a770e=_0xda6000[_0x3c4d35(0x1831)]('修复引用消息');console['log'](_0x3c4d35(0x869),_0x57ce44),console[_0x3c4d35(0x2187)](_0x3c4d35(0x19a3),_0x112462),console[_0x3c4d35(0x2187)]('包含引用消息修复:',_0x6a770e);const _0x3b04a4=[];if(_0xda6000['includes'](_0x3c4d35(0xbd5)))_0x3b04a4[_0x3c4d35(0x1cd6)](_0x3c4d35(0x15d9));if(_0xda6000[_0x3c4d35(0x1831)](_0x3c4d35(0xff0)))_0x3b04a4[_0x3c4d35(0x1cd6)](_0x3c4d35(0x7f0));if(_0xda6000['includes'](_0x3c4d35(0x1224)))_0x3b04a4['push']('壁纸');if(_0xda6000[_0x3c4d35(0x1831)](_0x3c4d35(0x2014)))_0x3b04a4[_0x3c4d35(0x1cd6)](_0x3c4d35(0x2a9));if(_0xda6000[_0x3c4d35(0x1831)]('data.blacklist'))_0x3b04a4[_0x3c4d35(0x1cd6)](_0x3c4d35(0x1627));console['log'](_0x3c4d35(0x10a5),_0x3b04a4);const _0x505eff=_0x3c4d35(0x10fe)+(_0x57ce44?_0x3c4d35(0x12f6):'第一处完整函数')+_0x3c4d35(0x17ec)+(_0x112462?'完整':'简化')+'\x0a-\x20引用消息修复:\x20'+(_0x6a770e?'支持':'不支持')+'\x0a-\x20扩展数据类型支持:\x20'+_0x3b04a4[_0x3c4d35(0x19ee)]+_0x3c4d35(0x1d57)+(_0x3b04a4['length']<0x3?_0x3c4d35(0xb70):'✅\x20功能完整')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';alert(_0x505eff);}catch(_0x3be54b){console[_0x3c4d35(0x174a)](_0x3c4d35(0x1f14),_0x3be54b),alert(_0x3c4d35(0x1f20)+_0x3be54b[_0x3c4d35(0x1e8e)]);}}async function debugGroupChatData(){const _0x687394=_0x211817;try{console[_0x687394(0x2187)](_0x687394(0x435)),console[_0x687394(0x2187)]('内存中的群聊数据:',groupChats),console[_0x687394(0x2187)](_0x687394(0xe88),groupChats[_0x687394(0x19ee)]);const _0x1bffc9=await db['groupChats'][_0x687394(0xf13)]();console[_0x687394(0x2187)]('IndexedDB中的群聊数据:',_0x1bffc9),console[_0x687394(0x2187)](_0x687394(0x30f),_0x1bffc9[_0x687394(0x19ee)]);let _0x259611=0x0,_0x4099ad=0x0;groupChats[_0x687394(0x19ee)]>0x0&&(console[_0x687394(0x2187)](_0x687394(0xc71)),groupChats[_0x687394(0x19fb)]((_0x345af3,_0x5cd8dc)=>{const _0xd2cf83=_0x687394;console[_0xd2cf83(0x2187)]('群聊\x20'+(_0x5cd8dc+0x1)+':\x20'+_0x345af3[_0xd2cf83(0x1a1c)]+_0xd2cf83(0x1d3e)+_0x345af3['id']+')'),console[_0xd2cf83(0x2187)](_0xd2cf83(0x1bd2),_0x345af3['members']);_0x345af3[_0xd2cf83(0x12a6)]&&Array['isArray'](_0x345af3[_0xd2cf83(0x12a6)])&&(_0x4099ad+=_0x345af3[_0xd2cf83(0x12a6)]['length']);const _0x3d5913=chatMessages[_0x345af3['id']]||[];console[_0xd2cf83(0x2187)](_0xd2cf83(0x9ab)+_0x3d5913[_0xd2cf83(0x19ee)]),_0x259611+=_0x3d5913[_0xd2cf83(0x19ee)],_0x3d5913[_0xd2cf83(0x19ee)]>0x0&&console[_0xd2cf83(0x2187)]('\x20\x20最近消息:',_0x3d5913[_0xd2cf83(0x6d5)](-0x3));}));console[_0x687394(0x2187)](_0x687394(0x1d9b)),console['log'](_0x687394(0xb12)),console[_0x687394(0x2187)]('群聊成员现在存储在群聊对象的members属性中'),console[_0x687394(0x2187)](_0x687394(0x1f8c));const _0x5b0f3b=_0x687394(0x60a)+groupChats['length']+_0x687394(0x8d7)+_0x1bffc9[_0x687394(0x19ee)]+_0x687394(0xe9a)+_0x259611+_0x687394(0x11ae)+_0x4099ad+_0x687394(0xaf3)+(groupChats[_0x687394(0x19ee)]>0x0?_0x687394(0x1487):_0x687394(0x1665))+_0x687394(0x19d9);alert(_0x5b0f3b);}catch(_0x3be304){console[_0x687394(0x174a)](_0x687394(0x64c),_0x3be304),alert(_0x687394(0x1f20)+_0x3be304[_0x687394(0x1e8e)]);}}function showHistorySettings(){const _0x4ee604=_0x211817,_0x510d8f=getCurrentChatSettings(),_0x5d9219=_0x510d8f['historyCount'];document[_0x4ee604(0x1262)](_0x4ee604(0x16f7))['value']=Math[_0x4ee604(0x21ff)](_0x5d9219,0x64),document[_0x4ee604(0x1262)](_0x4ee604(0x1438))[_0x4ee604(0x1ebc)]=_0x5d9219,document[_0x4ee604(0x1262)](_0x4ee604(0x4b0))[_0x4ee604(0x13be)]=_0x5d9219+'回合',document['getElementById']('history-messages-count')['oninput']=function(){const _0x2d8f4d=_0x4ee604,_0x1b8107=parseInt(this[_0x2d8f4d(0x1ebc)]);document[_0x2d8f4d(0x1262)]('history-count-display')['textContent']=_0x1b8107+'回合',document[_0x2d8f4d(0x1262)](_0x2d8f4d(0x1438))[_0x2d8f4d(0x1ebc)]=_0x1b8107;},document['getElementById'](_0x4ee604(0x1438))[_0x4ee604(0x20b1)]=function(){const _0x4fa028=_0x4ee604,_0x360c2d=Math[_0x4fa028(0x658)](0x0,Math[_0x4fa028(0x21ff)](0x1f4,parseInt(this[_0x4fa028(0x1ebc)])||0x0));this[_0x4fa028(0x1ebc)]=_0x360c2d,_0x360c2d<=0x64&&(document['getElementById'](_0x4fa028(0x16f7))[_0x4fa028(0x1ebc)]=_0x360c2d),document['getElementById'](_0x4fa028(0x4b0))[_0x4fa028(0x13be)]=_0x360c2d+'回合';},showModal(_0x4ee604(0x86a));}function saveHistorySettings(){const _0x3d9ab4=_0x211817,_0x19e9e2=getCurrentChatSettings(),_0x355e95=parseInt(document[_0x3d9ab4(0x1262)](_0x3d9ab4(0x1438))[_0x3d9ab4(0x1ebc)]);_0x19e9e2[_0x3d9ab4(0x2062)]=Math['max'](0x0,Math[_0x3d9ab4(0x21ff)](0x1f4,_0x355e95||0x0)),document[_0x3d9ab4(0x1262)]('current-history-count')['textContent']=_0x19e9e2[_0x3d9ab4(0x2062)]+'回合',saveCurrentChatSettings(_0x19e9e2),hideModal(_0x3d9ab4(0x86a)),showToast(_0x3d9ab4(0x1a5e),'success');}function showAvatarSettings(){const _0x295f6a=_0x211817,_0x363f91=getCurrentChatSettings(),_0x5117c6=document[_0x295f6a(0x1262)](_0x295f6a(0x1635));_0x5117c6&&(_0x5117c6[_0x295f6a(0x14c1)]=_0x363f91[_0x295f6a(0xdea)]||![]);const _0x1485a7=_0x363f91[_0x295f6a(0xc9f)]||'circle',_0x54d3b5=document[_0x295f6a(0x1897)](_0x295f6a(0x1369));_0x54d3b5[_0x295f6a(0x19fb)](_0x5c9b3c=>{const _0x3ef64e=_0x295f6a;_0x5c9b3c[_0x3ef64e(0x14c1)]=_0x5c9b3c[_0x3ef64e(0x1ebc)]===_0x1485a7;const _0x44f002=_0x5c9b3c[_0x3ef64e(0x216a)](_0x3ef64e(0x1ef));_0x5c9b3c[_0x3ef64e(0x14c1)]?_0x44f002[_0x3ef64e(0x1c1b)][_0x3ef64e(0x21e2)](_0x3ef64e(0x176b)):_0x44f002[_0x3ef64e(0x1c1b)]['remove'](_0x3ef64e(0x176b));}),updateAvatarPreviewShape(_0x1485a7);const _0x5a22b0=document['getElementById'](_0x295f6a(0x1445));_0x363f91[_0x295f6a(0x11cd)]?(_0x5a22b0[_0x295f6a(0x14eb)][_0x295f6a(0x159c)]='url('+_0x363f91['myChatAvatar']+')',_0x5a22b0[_0x295f6a(0x14eb)][_0x295f6a(0x15d0)]='cover',_0x5a22b0[_0x295f6a(0x14eb)][_0x295f6a(0x1530)]='center',_0x5a22b0[_0x295f6a(0x33a)]=''):(_0x5a22b0[_0x295f6a(0x14eb)][_0x295f6a(0x159c)]=_0x295f6a(0x102b),_0x5a22b0[_0x295f6a(0x33a)]='<i\x20class=\x22fas\x20fa-user\x22></i>');const _0x320407=document['getElementById'](_0x295f6a(0x1f2d)),_0x441dee=_0x363f91[_0x295f6a(0x179f)];_0x441dee?(_0x320407[_0x295f6a(0x14eb)]['backgroundImage']=_0x295f6a(0x9f1)+_0x441dee+')',_0x320407[_0x295f6a(0x14eb)][_0x295f6a(0x15d0)]=_0x295f6a(0x12bb),_0x320407['style'][_0x295f6a(0x1530)]=_0x295f6a(0xcef),_0x320407[_0x295f6a(0x33a)]='',_0x320407['title']=_0x295f6a(0x1f0a)):(_0x320407[_0x295f6a(0x14eb)][_0x295f6a(0x159c)]=_0x295f6a(0x102b),_0x320407[_0x295f6a(0x33a)]=_0x295f6a(0x5ae),_0x320407[_0x295f6a(0x378)]=_0x295f6a(0x1ec0)),bindAvatarUploadEvents(),bindAvatarShapeEvents(),showModal('avatar-settings-modal');}function updateAvatarPreviewShape(_0x59afc0){const _0x347c7e=_0x211817,_0x5373b0=document['getElementById'](_0x347c7e(0x1445)),_0x379973=document[_0x347c7e(0x1262)](_0x347c7e(0x1f2d));_0x5373b0['classList'][_0x347c7e(0x1493)](_0x347c7e(0xca6)),_0x379973[_0x347c7e(0x1c1b)][_0x347c7e(0x1493)](_0x347c7e(0xca6)),_0x59afc0==='rounded-square'&&(_0x5373b0[_0x347c7e(0x1c1b)][_0x347c7e(0x21e2)](_0x347c7e(0xca6)),_0x379973['classList'][_0x347c7e(0x21e2)](_0x347c7e(0xca6)));}function bindAvatarShapeEvents(){const _0x356d42=_0x211817,_0x22a999=document['querySelectorAll']('input[name=\x22avatar-shape\x22]');_0x22a999[_0x356d42(0x19fb)](_0x1b144e=>{const _0x257123=_0x356d42,_0x52f3ac=_0x1b144e['closest'](_0x257123(0x1ef));if(!_0x52f3ac){console['warn'](_0x257123(0x29c),_0x1b144e);return;}_0x52f3ac['addEventListener'](_0x257123(0x1859),function(){const _0x1b33a7=_0x257123;_0x22a999[_0x1b33a7(0x19fb)](_0x168d5f=>{const _0x3a4912=_0x1b33a7;_0x168d5f['checked']=![],_0x168d5f[_0x3a4912(0x216a)](_0x3a4912(0x1ef))[_0x3a4912(0x1c1b)]['remove'](_0x3a4912(0x176b));}),_0x1b144e[_0x1b33a7(0x14c1)]=!![],this[_0x1b33a7(0x1c1b)]['add']('selected'),updateAvatarPreviewShape(_0x1b144e[_0x1b33a7(0x1ebc)]);}),_0x1b144e[_0x257123(0x21e9)]('change',function(){const _0x2c0c55=_0x257123;this['checked']&&(_0x22a999[_0x2c0c55(0x19fb)](_0x2488f5=>{const _0x3d05fe=_0x2c0c55;_0x2488f5!==this&&_0x2488f5[_0x3d05fe(0x216a)](_0x3d05fe(0x1ef))[_0x3d05fe(0x1c1b)][_0x3d05fe(0x1493)](_0x3d05fe(0x176b));}),_0x52f3ac['classList'][_0x2c0c55(0x21e2)](_0x2c0c55(0x176b)),updateAvatarPreviewShape(this[_0x2c0c55(0x1ebc)]));});});}function generateAvatarHtml(_0x1c0180){const _0x43802a=_0x211817,{avatarUrl:_0x4d0b78,backgroundColor:_0x37bc3e,displayName:_0x4b3f3a,onClick:_0x241d52,title:_0x409b57,timestamp:_0x418692,timestampEnabled:_0x29a9b6,timestampPosition:_0x32205a,chatSettings:_0x3f5709}=_0x1c0180,_0x2bde5b=_0x3f5709?.[_0x43802a(0xc9f)]||_0x43802a(0x22e0),_0x1e2252=_0x2bde5b==='rounded-square'?_0x43802a(0x1701):'',_0x3bfcf1=_0x4d0b78?_0x43802a(0x2236)+_0x4d0b78+_0x43802a(0x1dd):'background-color:\x20'+_0x37bc3e+';',_0x11d380=_0x241d52?_0x43802a(0xc04)+_0x241d52+'\x22':'',_0x2c55d4=_0x409b57?_0x43802a(0x1272)+_0x409b57+'\x22':'',_0x3da20d=_0x29a9b6&&_0x32205a===_0x43802a(0x1f8a)&&_0x418692?_0x43802a(0xd44)+formatTimeOnly(_0x418692)+'</div>':'',_0x4fef3d=_0x4d0b78?'':_0x4b3f3a?_0x4b3f3a[_0x43802a(0xcc3)](0x0):_0x43802a(0x752);return _0x43802a(0xb05)+_0x1e2252+_0x43802a(0x147b)+_0x3bfcf1+'\x22\x20'+_0x11d380+'\x20'+_0x2c55d4+'>'+_0x4fef3d+_0x3da20d+_0x43802a(0x1844);}function showNicknameSettings(){const _0x1e69e4=_0x211817,_0x95183c=getCurrentChatSettings();document[_0x1e69e4(0x1262)](_0x1e69e4(0xdc7))['value']=_0x95183c[_0x1e69e4(0x567)]||'',document[_0x1e69e4(0x1262)](_0x1e69e4(0xd13))['value']=_0x95183c['aiChatNickname']||'',showModal('nickname-settings-modal');}function showPokeSuffixSettings(){const _0x2ddff9=_0x211817,_0x5cfe7d=getCurrentChatSettings();document['getElementById'](_0x2ddff9(0x915))[_0x2ddff9(0x1ebc)]=_0x5cfe7d[_0x2ddff9(0x12e6)]||'',document['getElementById'](_0x2ddff9(0x1e2f))[_0x2ddff9(0x1ebc)]=_0x5cfe7d['aiPokeSuffix']||'',showModal('poke-suffix-modal');}function showBackgroundSettings(){const _0x2c8c2a=_0x211817,_0x537591=document[_0x2c8c2a(0x1262)]('chat-background-preview');window[_0x2c8c2a(0x1de9)]=undefined,currentChatCharacter&&currentChatCharacter[_0x2c8c2a(0x619)]?(_0x537591[_0x2c8c2a(0x14eb)][_0x2c8c2a(0x159c)]=_0x2c8c2a(0x9f1)+currentChatCharacter[_0x2c8c2a(0x619)]+')',_0x537591[_0x2c8c2a(0x14eb)][_0x2c8c2a(0x15d0)]=_0x2c8c2a(0x12bb),_0x537591['style'][_0x2c8c2a(0x1530)]=_0x2c8c2a(0xcef),_0x537591[_0x2c8c2a(0xb30)](_0x2c8c2a(0xbf8))['style'][_0x2c8c2a(0x4da)]=_0x2c8c2a(0x102b)):(_0x537591[_0x2c8c2a(0x14eb)][_0x2c8c2a(0x159c)]=_0x2c8c2a(0x102b),_0x537591[_0x2c8c2a(0xb30)](_0x2c8c2a(0xbf8))['style'][_0x2c8c2a(0x4da)]=_0x2c8c2a(0x13de),_0x537591['querySelector'](_0x2c8c2a(0xbf8))[_0x2c8c2a(0x13be)]=_0x2c8c2a(0x1da8)),document['getElementById']('background-upload')[_0x2c8c2a(0x1980)]=function(_0x12115f){const _0x46f959=_0x2c8c2a;if(_0x12115f[_0x46f959(0x193d)][_0x46f959(0xf26)]&&_0x12115f['target'][_0x46f959(0xf26)][0x0]){const _0x4863da=new FileReader();_0x4863da['onload']=function(_0x5d6b5e){const _0x3593b2=_0x46f959;_0x537591['style'][_0x3593b2(0x159c)]='url('+_0x5d6b5e[_0x3593b2(0x193d)][_0x3593b2(0x4ee)]+')',_0x537591['style']['backgroundSize']='cover',_0x537591[_0x3593b2(0x14eb)][_0x3593b2(0x1530)]='center',_0x537591[_0x3593b2(0xb30)](_0x3593b2(0xbf8))[_0x3593b2(0x14eb)][_0x3593b2(0x4da)]='none',window[_0x3593b2(0x1de9)]=_0x5d6b5e['target'][_0x3593b2(0x4ee)];},_0x4863da[_0x46f959(0x127c)](_0x12115f[_0x46f959(0x193d)][_0x46f959(0xf26)][0x0]);}},showModal(_0x2c8c2a(0x139a));}function showBubbleStyleSettings(){const _0x8a2c36=_0x211817,_0xabda3=getCurrentChatSettings(),_0x17e0e6=document[_0x8a2c36(0x1262)]('group-member-colors-btn');currentChatCharacter&&currentChatCharacter[_0x8a2c36(0x1f68)]?_0x17e0e6['style'][_0x8a2c36(0x4da)]=_0x8a2c36(0x13de):_0x17e0e6[_0x8a2c36(0x14eb)]['display']=_0x8a2c36(0x102b);const _0x381be4=_0xabda3['bubbleStyle']||_0x8a2c36(0x1094);document[_0x8a2c36(0x1262)](_0x8a2c36(0x958))[_0x8a2c36(0x1ebc)]=_0xabda3[_0x8a2c36(0xbfa)]||'#007AFF',document[_0x8a2c36(0x1262)](_0x8a2c36(0xe7f))[_0x8a2c36(0x1ebc)]=_0xabda3['aiBubbleColor']||_0x8a2c36(0x7ae),document[_0x8a2c36(0x1262)](_0x8a2c36(0x338))[_0x8a2c36(0x1ebc)]=_0xabda3[_0x8a2c36(0x1dff)]||'1',document[_0x8a2c36(0x1262)](_0x8a2c36(0x1399))[_0x8a2c36(0x13be)]=Math[_0x8a2c36(0x13e2)]((_0xabda3['myBubbleOpacity']||0x1)*0x64)+'%',document[_0x8a2c36(0x1262)]('ai-bubble-opacity')[_0x8a2c36(0x1ebc)]=_0xabda3[_0x8a2c36(0x2fd)]||'1',document[_0x8a2c36(0x1262)](_0x8a2c36(0xef4))[_0x8a2c36(0x13be)]=Math[_0x8a2c36(0x13e2)]((_0xabda3['aiBubbleOpacity']||0x1)*0x64)+'%',document[_0x8a2c36(0x1897)](_0x8a2c36(0x1909))['forEach'](_0x534f6e=>{const _0x5e8d9f=_0x8a2c36;_0x534f6e[_0x5e8d9f(0x1c1b)][_0x5e8d9f(0x1493)]('selected'),_0x534f6e['dataset'][_0x5e8d9f(0x14eb)]===_0x381be4&&_0x534f6e[_0x5e8d9f(0x1c1b)]['add'](_0x5e8d9f(0x176b));}),document[_0x8a2c36(0x1897)](_0x8a2c36(0x1909))[_0x8a2c36(0x19fb)](_0x3e2d5b=>{const _0x37d3b8=_0x8a2c36;_0x3e2d5b[_0x37d3b8(0x1f36)]=function(){const _0x4e169a=_0x37d3b8;document['querySelectorAll'](_0x4e169a(0x1909))[_0x4e169a(0x19fb)](_0x402d46=>{const _0x893582=_0x4e169a;_0x402d46[_0x893582(0x1c1b)]['remove']('selected');}),this[_0x4e169a(0x1c1b)][_0x4e169a(0x21e2)](_0x4e169a(0x176b)),window['selectedBubbleStyle']=this[_0x4e169a(0x1ecd)][_0x4e169a(0x14eb)],updatePreview();};}),document[_0x8a2c36(0x1262)](_0x8a2c36(0x338))[_0x8a2c36(0x20b1)]=function(){const _0x302a5a=_0x8a2c36;document['getElementById'](_0x302a5a(0x1399))[_0x302a5a(0x13be)]=Math[_0x302a5a(0x13e2)](this['value']*0x64)+'%',updatePreview();},document['getElementById'](_0x8a2c36(0x1473))['oninput']=function(){const _0xf669a8=_0x8a2c36;document[_0xf669a8(0x1262)](_0xf669a8(0xef4))[_0xf669a8(0x13be)]=Math[_0xf669a8(0x13e2)](this['value']*0x64)+'%',updatePreview();},document[_0x8a2c36(0x1262)]('my-bubble-color')[_0x8a2c36(0x20b1)]=updatePreview,document[_0x8a2c36(0x1262)](_0x8a2c36(0xe7f))['oninput']=updatePreview,document[_0x8a2c36(0x1262)](_0x8a2c36(0x136c))[_0x8a2c36(0x1ebc)]=_0xabda3[_0x8a2c36(0x735)]||'12',updatePaddingValue(_0xabda3[_0x8a2c36(0x735)]||'12'),document[_0x8a2c36(0x1262)]('bubble-padding')[_0x8a2c36(0x20b1)]=function(){const _0x17f07d=_0x8a2c36;updatePaddingValue(this[_0x17f07d(0x1ebc)]),updatePreview();};const _0x30f02a=document[_0x8a2c36(0x1262)](_0x8a2c36(0x712));_0x30f02a&&(_0x30f02a[_0x8a2c36(0x1ebc)]=_0xabda3[_0x8a2c36(0x103d)]||''),window[_0x8a2c36(0x1c6e)]=_0x381be4,showModal(_0x8a2c36(0x1735)),setTimeout(updatePreview,0x64);}function showScheduleSettings(){const _0x4e3789=_0x211817,_0x1af0ff=getCurrentChatSettings();document[_0x4e3789(0x1262)](_0x4e3789(0x1fdb))['checked']=_0x1af0ff[_0x4e3789(0xfd0)]||![],document['getElementById'](_0x4e3789(0x1fdb))[_0x4e3789(0x1980)]=function(){const _0x4b0c6b=_0x4e3789;document['getElementById'](_0x4b0c6b(0x110a))[_0x4b0c6b(0x14eb)][_0x4b0c6b(0x4da)]=this[_0x4b0c6b(0x14c1)]?_0x4b0c6b(0x13de):_0x4b0c6b(0x102b);},document[_0x4e3789(0x1262)](_0x4e3789(0x110a))['style'][_0x4e3789(0x4da)]=document[_0x4e3789(0x1262)](_0x4e3789(0x1fdb))[_0x4e3789(0x14c1)]?_0x4e3789(0x13de):'none',renderScheduleTimes(),showModal('schedule-settings-modal');}async function getAsyncChatSettings(_0xf8bbb3=null){const _0x23333e=_0x211817,_0x2e7aae=_0xf8bbb3||(currentChatCharacter?currentChatCharacter['id']:null);if(!_0x2e7aae)return console[_0x23333e(0x1f43)](_0x23333e(0x94b)),{'historyCount':0x1e,'timestampEnabled':!![],'timestampPosition':'center','bubbleStyle':_0x23333e(0x1094),'characterStatusEnabled':![]};const _0x41b36a=_0xf8bbb3!==null&&_0xf8bbb3!==undefined,_0x28ab88=_0x2e7aae+'_'+(windowId||_0x23333e(0x1094));if(!_0x41b36a&&chatSettings[_0x28ab88])return console[_0x23333e(0x2187)]('✅\x20从内存缓存获取角色\x20'+_0x2e7aae+_0x23333e(0x21fb)+windowId+_0x23333e(0x108d)),chatSettings[_0x28ab88];if(!_0x41b36a&&!chatSettings[_0x28ab88]&&chatSettings[_0x2e7aae])return console['log']('✅\x20从内存缓存获取角色\x20'+_0x2e7aae+_0x23333e(0x1e12)),chatSettings[_0x28ab88]={...chatSettings[_0x2e7aae]},chatSettings[_0x28ab88];try{let _0x118cf7=null;windowId&&(_0x118cf7=await db[_0x23333e(0x1742)][_0x23333e(0xa24)](_0x23333e(0x2fb))[_0x23333e(0x1694)]([_0x2e7aae,windowId])[_0x23333e(0x1a7b)]());!_0x118cf7&&(_0x118cf7=await db[_0x23333e(0x1789)][_0x23333e(0xb78)](_0x2e7aae));if(_0x118cf7&&_0x118cf7[_0x23333e(0x1512)]){const _0x425154=_0x41b36a?_0x23333e(0x11f4):_0x23333e(0x7ca);return console['log'](_0x23333e(0x1e82)+_0x425154+_0x23333e(0x150a)+_0x2e7aae+'\x20(窗口'+windowId+_0x23333e(0x108d)),chatSettings[_0x28ab88]=_0x118cf7['settings'],!chatSettings[_0x2e7aae]&&(chatSettings[_0x2e7aae]={..._0x118cf7[_0x23333e(0x1512)]}),_0x118cf7[_0x23333e(0x1512)];}}catch(_0xb3ad16){console[_0x23333e(0x174a)](_0x23333e(0x12a2)+_0x2e7aae+_0x23333e(0x21fb)+windowId+_0x23333e(0xf21),_0xb3ad16);}console['log']('🔧\x20ID为\x20'+_0x2e7aae+_0x23333e(0x480));const _0x35042c={'historyCount':0x1e,'crossChatMemory':0x3,'enableDynamicMemory':!![],'enableMusicMemory':!![],'memoryMountEnabled':![],'memoryMountCount':0x3,'selectedMemoryChats':[],'timeAwarenessEnabled':!![],'aiCallEnabled':!![],'aiHeartrateEnabled':![],'socialEnabled':![],'socialFrequency':_0x23333e(0x950),'backgroundInteractionEnabled':!![],'backgroundChatEnabled':!![],'backgroundMomentsEnabled':!![],'backgroundChatFrequency':_0x23333e(0x113f),'backgroundMomentsFrequency':_0x23333e(0x113f),'scheduledMomentsEnabled':![],'scheduledMomentsTimes':[],'worldbookMountEnabled':![],'selectedWorldbooks':[],'linkedWorldBookIds':[],'timestampEnabled':!![],'timestampPosition':_0x23333e(0xcef),'characterStatusEnabled':![],'statusUpdateFrequency':_0x23333e(0x950)};chatSettings[_0x28ab88]=_0x35042c;!chatSettings[_0x2e7aae]&&(chatSettings[_0x2e7aae]={..._0x35042c});try{windowId&&(await db[_0x23333e(0x1742)][_0x23333e(0x1561)]({'chatId':_0x2e7aae,'windowId':windowId,'settings':_0x35042c,'timestamp':Date[_0x23333e(0x2eb)]()}),console['log']('✅\x20已为新聊天\x20'+_0x2e7aae+_0x23333e(0x21fb)+windowId+_0x23333e(0x13e8))),await db[_0x23333e(0x1789)][_0x23333e(0x1561)]({'id':_0x2e7aae,'chatId':_0x2e7aae,'settings':_0x35042c}),console['log'](_0x23333e(0x1396)+_0x2e7aae+'\x20在数据库中创建了默认设置档案');}catch(_0x115aa2){console['error'](_0x23333e(0x1c2c)+_0x2e7aae+_0x23333e(0x21fb)+windowId+_0x23333e(0x33b),_0x115aa2);}return _0x35042c;}function getCurrentChatSettings(){const _0x242c8d=_0x211817;if(!currentChatCharacter)return{};const _0x3f2605=currentChatCharacter['id'],_0x33d75f=_0x3f2605+'_'+(windowId||_0x242c8d(0x1094));if(chatSettings[_0x33d75f])return chatSettings[_0x33d75f];if(chatSettings[_0x3f2605])return chatSettings[_0x33d75f]={...chatSettings[_0x3f2605]},chatSettings[_0x33d75f];console[_0x242c8d(0x1f43)](_0x242c8d(0x14e1)+_0x3f2605+'\x20(窗口'+windowId+')的设置，但内存中没有缓存，返回临时默认设置');const _0x40c0dc={'historyCount':0x1e,'crossChatMemory':0x3,'enableDynamicMemory':!![],'enableMusicMemory':!![],'memoryMountEnabled':![],'memoryMountCount':0x3,'selectedMemoryChats':[],'timeAwarenessEnabled':!![],'aiCallEnabled':!![],'aiHeartrateEnabled':![],'characterStatusEnabled':![],'socialEnabled':![],'socialFrequency':_0x242c8d(0x950),'backgroundInteractionEnabled':!![],'backgroundChatEnabled':!![],'backgroundMomentsEnabled':!![],'backgroundChatFrequency':'low','backgroundMomentsFrequency':'low','scheduledMomentsEnabled':![],'scheduledMomentsTimes':[],'timestampEnabled':!![],'timestampPosition':_0x242c8d(0xcef),'aiHeartrateEnabled':![],'worldbookMountEnabled':![],'selectedWorldbooks':[],'linkedWorldBookIds':[],'statusUpdateFrequency':'medium','aiChatAvatar':'','userChatAvatar':''};return getAsyncChatSettings()[_0x242c8d(0x63d)](_0xab4de4=>{const _0x1e02b9=_0x242c8d;console[_0x1e02b9(0x2187)](_0x1e02b9(0x177d)+_0x3f2605+_0x1e02b9(0x1d6e));})[_0x242c8d(0x1c82)](_0x34ea38=>{const _0x5d02fe=_0x242c8d;console['error'](_0x5d02fe(0xda4)+_0x3f2605+_0x5d02fe(0x165c),_0x34ea38);}),_0x40c0dc;}async function saveCurrentChatSettings(_0x187cfd){const _0x12ed9=_0x211817;if(!currentChatCharacter)return;const _0x1de735=currentChatCharacter['id'],_0x13e49a=_0x1de735+'_'+(windowId||_0x12ed9(0x1094));chatSettings[_0x13e49a]=_0x187cfd;(!chatSettings[_0x1de735]||windowId)&&(chatSettings[_0x1de735]={..._0x187cfd});try{if(windowId){const _0x260909=await db[_0x12ed9(0x1742)][_0x12ed9(0xa24)]('[chatId+windowId]')[_0x12ed9(0x1694)]([_0x1de735,windowId])[_0x12ed9(0x1a7b)]();_0x260909?(await db[_0x12ed9(0x1742)]['update'](_0x260909['id'],{'settings':_0x187cfd,'timestamp':Date['now']()}),console[_0x12ed9(0x2187)](_0x12ed9(0x2088)+_0x1de735+',\x20窗口:\x20'+windowId+')')):(await db[_0x12ed9(0x1742)]['add']({'chatId':_0x1de735,'windowId':windowId,'settings':_0x187cfd,'timestamp':Date[_0x12ed9(0x2eb)]()}),console[_0x12ed9(0x2187)]('✅\x20窗口隔离聊天设置已保存到IndexedDB\x20(角色:\x20'+_0x1de735+_0x12ed9(0xc51)+windowId+')'));}await db[_0x12ed9(0x1789)][_0x12ed9(0x1561)]({'id':_0x1de735,'chatId':_0x1de735,'settings':_0x187cfd}),console[_0x12ed9(0x2187)](_0x12ed9(0x224e)+_0x1de735+')'),scheduleAutoSave(_0x1de735);}catch(_0x42635b){console[_0x12ed9(0x174a)](_0x12ed9(0x1f03),_0x42635b);try{console[_0x12ed9(0x1f43)]('⚠️\x20正在进行紧急备份...');const _0x4ba868={'selectedIdentityId':_0x187cfd[_0x12ed9(0x145e)],'aiChatNickname':_0x187cfd[_0x12ed9(0x4e7)],'myChatNickname':_0x187cfd['myChatNickname'],'hideAvatars':_0x187cfd[_0x12ed9(0xdea)],'bubbleStyle':_0x187cfd['bubbleStyle'],'timestampEnabled':_0x187cfd['timestampEnabled'],'timestampPosition':_0x187cfd['timestampPosition']},_0x2692a9=windowId?'chatSettings_emergency_'+_0x1de735+'_'+windowId:_0x12ed9(0xc3e)+_0x1de735;localStorage[_0x12ed9(0x192)](_0x2692a9,JSON[_0x12ed9(0x6b8)](_0x4ba868)),console['log'](_0x12ed9(0x191f)),showToast(_0x12ed9(0x154a),_0x12ed9(0x1816));}catch(_0x379fdd){console[_0x12ed9(0x174a)](_0x12ed9(0x196c),_0x379fdd),showToast(_0x12ed9(0x130c),_0x12ed9(0x174a));}}}async function showMemoryMountSettings(){const _0x5e6165=_0x211817,_0x12170a=await getAsyncChatSettings();document[_0x5e6165(0x1262)](_0x5e6165(0x99b))[_0x5e6165(0x14c1)]=_0x12170a[_0x5e6165(0x159a)]||![],document[_0x5e6165(0x1262)](_0x5e6165(0x1f5c))[_0x5e6165(0x1ebc)]=_0x12170a[_0x5e6165(0x2c1)]||0x3,document[_0x5e6165(0x1262)](_0x5e6165(0x926))[_0x5e6165(0x13be)]=(_0x12170a[_0x5e6165(0x2c1)]||0x3)+'条',toggleMemoryMountDetails(),document['getElementById'](_0x5e6165(0x99b))[_0x5e6165(0x1980)]=toggleMemoryMountDetails,document[_0x5e6165(0x1262)](_0x5e6165(0x1f5c))[_0x5e6165(0x20b1)]=function(){document['getElementById']('memory-mount-display')['textContent']=this['value']+'条';},renderMemoryMountChatList(),showModal('memory-mount-modal');}function toggleMemoryMountDetails(){const _0x5a6d4a=_0x211817,_0x350e6b=document[_0x5a6d4a(0x1262)](_0x5a6d4a(0x99b))[_0x5a6d4a(0x14c1)];document['getElementById'](_0x5a6d4a(0x1d33))[_0x5a6d4a(0x14eb)]['display']=_0x350e6b?_0x5a6d4a(0x13de):'none',document[_0x5a6d4a(0x1262)](_0x5a6d4a(0x2165))[_0x5a6d4a(0x14eb)][_0x5a6d4a(0x4da)]=_0x350e6b?_0x5a6d4a(0x13de):_0x5a6d4a(0x102b),document[_0x5a6d4a(0x1262)](_0x5a6d4a(0xc5b))[_0x5a6d4a(0x13be)]=_0x350e6b?_0x5a6d4a(0x10a0):_0x5a6d4a(0x1c47);}async function renderMemoryMountChatList(){const _0x2a0f54=_0x211817,_0x518f23=document[_0x2a0f54(0x1262)](_0x2a0f54(0x1580));_0x518f23[_0x2a0f54(0x33a)]='';if(characters[_0x2a0f54(0x19ee)]===0x0&&groupChats['length']===0x0){_0x518f23[_0x2a0f54(0x33a)]=_0x2a0f54(0x19c4);return;}characters[_0x2a0f54(0x19fb)](_0x33e0aa=>{const _0x17949b=_0x2a0f54;if(currentChatCharacter&&_0x33e0aa['id']===currentChatCharacter['id'])return;const _0x288489=document[_0x17949b(0xac6)](_0x17949b(0xbbc));_0x288489['className']=_0x17949b(0xef6),_0x288489[_0x17949b(0x33a)]=_0x17949b(0x54d)+_0x33e0aa['id']+_0x17949b(0x136b)+_0x33e0aa['id']+_0x17949b(0x1d43)+_0x33e0aa[_0x17949b(0xc3d)]+';\x20'+(_0x33e0aa['avatarUrl']?'background-image:\x20url('+_0x33e0aa[_0x17949b(0x1994)]+_0x17949b(0x1dd):'')+_0x17949b(0x1a57)+(_0x33e0aa['avatarUrl']?'':_0x33e0aa[_0x17949b(0x1a1c)][_0x17949b(0xcc3)](0x0))+_0x17949b(0x1384)+_0x33e0aa[_0x17949b(0x1a1c)]+_0x17949b(0x610),_0x518f23[_0x17949b(0x497)](_0x288489);}),groupChats[_0x2a0f54(0x19fb)](_0x45a85e=>{const _0x432ff0=_0x2a0f54;if(currentChatCharacter&&_0x45a85e['id']===currentChatCharacter['id'])return;const _0x425bbe=document[_0x432ff0(0xac6)](_0x432ff0(0xbbc));_0x425bbe[_0x432ff0(0x1722)]=_0x432ff0(0xef6),_0x425bbe['innerHTML']=_0x432ff0(0x54d)+_0x45a85e['id']+'\x22\x20value=\x22'+_0x45a85e['id']+_0x432ff0(0x848)+_0x45a85e[_0x432ff0(0x1a1c)]+_0x432ff0(0x1e71)+(_0x45a85e[_0x432ff0(0x12a6)]?_0x45a85e[_0x432ff0(0x12a6)][_0x432ff0(0x19ee)]+0x1:0x1)+_0x432ff0(0x1f30),_0x518f23[_0x432ff0(0x497)](_0x425bbe);});const _0x115754=await getAsyncChatSettings(),_0x319bbe=_0x115754[_0x2a0f54(0x20f1)]||[];_0x319bbe[_0x2a0f54(0x19fb)](_0x5869d7=>{const _0x18c96e=_0x2a0f54,_0x2f87bd=document[_0x18c96e(0x1262)](_0x18c96e(0x1131)+_0x5869d7);if(_0x2f87bd)_0x2f87bd[_0x18c96e(0x14c1)]=!![];});}async function saveMemoryMountSettings(){const _0x2e5a92=_0x211817,_0x5d65bc=await getAsyncChatSettings();_0x5d65bc['memoryMountEnabled']=document['getElementById'](_0x2e5a92(0x99b))[_0x2e5a92(0x14c1)],_0x5d65bc[_0x2e5a92(0x2c1)]=parseInt(document[_0x2e5a92(0x1262)](_0x2e5a92(0x1f5c))['value']);const _0x4a4dd6=document[_0x2e5a92(0x1897)](_0x2e5a92(0xb3c));_0x5d65bc['selectedMemoryChats']=Array['from'](_0x4a4dd6)[_0x2e5a92(0x6a4)](_0x1cb7f3=>_0x1cb7f3[_0x2e5a92(0x1ebc)]),document[_0x2e5a92(0x1262)](_0x2e5a92(0xc5b))[_0x2e5a92(0x13be)]=_0x5d65bc['memoryMountEnabled']?'已开启':'已关闭',await saveCurrentChatSettings(_0x5d65bc),hideModal(_0x2e5a92(0x226f)),showToast('记忆挂载设置已保存','success');}function updatePreview(){const _0x27b1a8=_0x211817,_0x1b3289=document['getElementById'](_0x27b1a8(0x180d)),_0x2274cb=document['getElementById']('preview-user'),_0x2ac97b=document[_0x27b1a8(0x1262)](_0x27b1a8(0x37c));if(!_0x1b3289||!_0x2274cb||!_0x2ac97b)return;const _0x4e2557=document[_0x27b1a8(0x1262)](_0x27b1a8(0x958))?.[_0x27b1a8(0x1ebc)]||'#007AFF',_0x1d5fd4=document[_0x27b1a8(0x1262)](_0x27b1a8(0xe7f))?.[_0x27b1a8(0x1ebc)]||_0x27b1a8(0x7ae),_0x23566e=document[_0x27b1a8(0x1262)](_0x27b1a8(0x338))?.[_0x27b1a8(0x1ebc)]||'1',_0x3dea7c=document['getElementById'](_0x27b1a8(0x1473))?.['value']||'1',_0x9ad0ce=document[_0x27b1a8(0x1262)](_0x27b1a8(0x136c))?.[_0x27b1a8(0x1ebc)]||'12',_0xd6b3d6=document[_0x27b1a8(0x1262)](_0x27b1a8(0x712))?.['value']||'';_0x2274cb[_0x27b1a8(0x14eb)][_0x27b1a8(0x577)]=_0x4e2557,_0x2274cb[_0x27b1a8(0x14eb)]['opacity']=_0x23566e,_0x2274cb[_0x27b1a8(0x14eb)][_0x27b1a8(0xbf2)]=_0x9ad0ce+'px',_0x1b3289[_0x27b1a8(0x14eb)]['backgroundColor']=_0x1d5fd4,_0x1b3289[_0x27b1a8(0x14eb)][_0x27b1a8(0x11af)]=_0x3dea7c,_0x1b3289[_0x27b1a8(0x14eb)][_0x27b1a8(0xbf2)]=_0x9ad0ce+'px',_0x2ac97b['className']='preview-container',window[_0x27b1a8(0x1c6e)]&&_0x2ac97b[_0x27b1a8(0x1c1b)][_0x27b1a8(0x21e2)]('bubble-style-'+window[_0x27b1a8(0x1c6e)]),applyPreviewCSS(_0xd6b3d6);}function applyPreviewCSS(_0x30fe9d){const _0x572fe3=_0x211817,_0x131010=document[_0x572fe3(0x1262)](_0x572fe3(0x1ea7));if(_0x131010)_0x131010[_0x572fe3(0x1493)]();if(!_0x30fe9d['trim']())return;const _0x420307=document[_0x572fe3(0xac6)](_0x572fe3(0x14eb));_0x420307['id']=_0x572fe3(0x1ea7);let _0xb54cfe=_0x30fe9d['replace'](/^/gm,'#bubble-preview\x20');_0xb54cfe+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#bubble-preview\x20*::before,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20#bubble-preview\x20*::after\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x420307[_0x572fe3(0x13be)]=_0xb54cfe,document[_0x572fe3(0x65a)][_0x572fe3(0x497)](_0x420307);}function applyCustomBubbleCSS(){const _0x19438f=_0x211817,_0x4da6bf=getCurrentChatSettings(),_0x14ffe9=_0x4da6bf[_0x19438f(0x103d)],_0x190d7a=document[_0x19438f(0x1262)]('custom-bubble-style');if(_0x190d7a)_0x190d7a[_0x19438f(0x1493)]();if(!_0x14ffe9||!_0x14ffe9['trim']()){window['hasCustomBubbleStyle']=![];return;}let _0x42075b=_0x14ffe9;_0x42075b+=_0x19438f(0x15c1);const _0x43ed4c=document[_0x19438f(0xac6)]('style');_0x43ed4c['id']=_0x19438f(0x147c),_0x43ed4c[_0x19438f(0x13be)]=_0x42075b,document[_0x19438f(0x65a)][_0x19438f(0x497)](_0x43ed4c),window[_0x19438f(0x97f)]=!![],console[_0x19438f(0x2187)](_0x19438f(0x224c));}async function saveChatAvatarSettings(){const _0x1d6e15=_0x211817,_0x3a8b40=getCurrentChatSettings(),_0x3e1c54=document[_0x1d6e15(0x1262)](_0x1d6e15(0x1635));_0x3e1c54&&(_0x3a8b40[_0x1d6e15(0xdea)]=_0x3e1c54[_0x1d6e15(0x14c1)]);const _0x3522ac=document['querySelectorAll']('input[name=\x22avatar-shape\x22]');for(const _0x4d45bf of _0x3522ac){if(_0x4d45bf[_0x1d6e15(0x14c1)]){_0x3a8b40[_0x1d6e15(0xc9f)]=_0x4d45bf[_0x1d6e15(0x1ebc)];break;}}window['selectedMyChatAvatar']&&(_0x3a8b40[_0x1d6e15(0x11cd)]=await compressImage(window[_0x1d6e15(0x13a8)],0xc8,0.7));window[_0x1d6e15(0xf1d)]&&(_0x3a8b40[_0x1d6e15(0x179f)]=await compressImage(window[_0x1d6e15(0xf1d)],0xc8,0.7));try{await saveCurrentChatSettings(_0x3a8b40),hideModal(_0x1d6e15(0xa07)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast('头像设置已保存',_0x1d6e15(0x11cb));}catch(_0x515afb){console[_0x1d6e15(0x174a)](_0x1d6e15(0xe37),_0x515afb),showToast(_0x1d6e15(0x1af3),'error');}}async function saveChatNicknameSettings(){const _0x1787c2=_0x211817,_0x18220f=getCurrentChatSettings();_0x18220f['myChatNickname']=document[_0x1787c2(0x1262)](_0x1787c2(0xdc7))['value']['trim'](),_0x18220f[_0x1787c2(0x4e7)]=document[_0x1787c2(0x1262)]('ai-chat-nickname')[_0x1787c2(0x1ebc)][_0x1787c2(0x19d7)](),await saveCurrentChatSettings(_0x18220f),hideModal(_0x1787c2(0x20e));if(currentChatCharacter){let _0xe3177a=_0x18220f[_0x1787c2(0x4e7)]||currentChatCharacter[_0x1787c2(0x1a1c)];if(currentChatCharacter['isGroup']&&currentChatCharacter[_0x1787c2(0x12a6)]){const _0x410ea2=currentChatCharacter[_0x1787c2(0x12a6)][_0x1787c2(0x19ee)]+0x1;_0xe3177a=_0xe3177a+'（'+_0x410ea2+'）';}const _0x49922f=document[_0x1787c2(0x1262)]('api-chat-title');_0x49922f&&(_0x49922f[_0x1787c2(0x13be)]=_0xe3177a,_0x49922f[_0x1787c2(0x1c1b)][_0x1787c2(0x1493)](_0x1787c2(0x10f8)),_0x49922f[_0x1787c2(0x1ecd)][_0x1787c2(0x417)]=_0xe3177a);}currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),renderMessageList(),renderContactList(),showToast(_0x1787c2(0xdb6),_0x1787c2(0x11cb));}async function savePokeSuffixSettings(){const _0x5b6de1=_0x211817,_0x189701=getCurrentChatSettings();_0x189701[_0x5b6de1(0x12e6)]=document[_0x5b6de1(0x1262)](_0x5b6de1(0x915))[_0x5b6de1(0x1ebc)][_0x5b6de1(0x19d7)](),_0x189701[_0x5b6de1(0x4b8)]=document['getElementById'](_0x5b6de1(0x1e2f))[_0x5b6de1(0x1ebc)][_0x5b6de1(0x19d7)](),await saveCurrentChatSettings(_0x189701),hideModal(_0x5b6de1(0xbb7)),showToast(_0x5b6de1(0x20d),'success');}async function saveChatBackgroundSettings(){const _0x446043=_0x211817;if(!currentChatCharacter)return;let _0x5de961;if(window[_0x446043(0x1de9)]===null)_0x5de961=null;else window[_0x446043(0x1de9)]?_0x5de961=await compressImage(window['selectedChatBackground'],0x320,0.8):_0x5de961=currentChatCharacter[_0x446043(0x619)];await applyChatBackground(_0x5de961),hideModal('background-settings-modal'),window[_0x446043(0x1de9)]=undefined,showToast(_0x446043(0xe1e),'success');}function removeBackground(){const _0x2dde56=_0x211817,_0xeca6e9=document['getElementById'](_0x2dde56(0x1159));_0xeca6e9[_0x2dde56(0x14eb)]['backgroundImage']=_0x2dde56(0x102b),_0xeca6e9[_0x2dde56(0xb30)](_0x2dde56(0xbf8))[_0x2dde56(0x14eb)][_0x2dde56(0x4da)]=_0x2dde56(0x13de),_0xeca6e9[_0x2dde56(0xb30)](_0x2dde56(0xbf8))['textContent']=_0x2dde56(0x2105),window[_0x2dde56(0x1de9)]=null;}function updatePaddingValue(_0x383c29){const _0x54e403=_0x211817,_0x425d92=document[_0x54e403(0x1262)]('bubble-padding-value');if(_0x425d92){if(_0x383c29<=0x6)_0x425d92[_0x54e403(0x13be)]=_0x54e403(0xb18);else{if(_0x383c29<=0xa)_0x425d92[_0x54e403(0x13be)]='紧凑';else _0x383c29<=0xe?_0x425d92['textContent']='中等':_0x425d92[_0x54e403(0x13be)]='宽松';}}}async function saveBubbleStyleSettings(){const _0x3247d3=_0x211817,_0xcf3ef1=getCurrentChatSettings();window[_0x3247d3(0x1c6e)]&&(_0xcf3ef1[_0x3247d3(0x1813)]=window[_0x3247d3(0x1c6e)]);_0xcf3ef1[_0x3247d3(0xbfa)]=document['getElementById'](_0x3247d3(0x958))[_0x3247d3(0x1ebc)],_0xcf3ef1[_0x3247d3(0xeaf)]=document[_0x3247d3(0x1262)](_0x3247d3(0xe7f))[_0x3247d3(0x1ebc)],_0xcf3ef1[_0x3247d3(0x1dff)]=document[_0x3247d3(0x1262)]('my-bubble-opacity')['value'],_0xcf3ef1[_0x3247d3(0x2fd)]=document[_0x3247d3(0x1262)](_0x3247d3(0x1473))[_0x3247d3(0x1ebc)],_0xcf3ef1['bubblePadding']=document[_0x3247d3(0x1262)](_0x3247d3(0x136c))[_0x3247d3(0x1ebc)];const _0x3c422d=document['getElementById'](_0x3247d3(0x712))['value'];_0xcf3ef1[_0x3247d3(0x103d)]=_0x3c422d,await saveCurrentChatSettings(_0xcf3ef1),applyBubbleStyle(),applyCustomBubbleCSS(),updateBubbleStyleDisplay(),hideModal(_0x3247d3(0x1735)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast('气泡样式设置已保存',_0x3247d3(0x11cb));}function showTimestampSettings(){const _0x3a84f9=_0x211817,_0x5394b1=getCurrentChatSettings(),_0x571e45=document[_0x3a84f9(0x1262)](_0x3a84f9(0x1cb4));_0x571e45&&(_0x571e45['checked']=_0x5394b1[_0x3a84f9(0x17eb)]!==![]);const _0x1799d4=_0x5394b1[_0x3a84f9(0x1c3)]||_0x3a84f9(0xcef),_0x43917a=document[_0x3a84f9(0x1897)](_0x3a84f9(0x13aa));_0x43917a[_0x3a84f9(0x19fb)](_0x3765ad=>{const _0x286d68=_0x3a84f9;_0x3765ad['checked']=_0x3765ad[_0x286d68(0x1ebc)]===_0x1799d4;});if(_0x571e45){_0x571e45[_0x3a84f9(0x1980)]=function(){const _0x4be761=_0x3a84f9,_0x1876b6=document['getElementById'](_0x4be761(0x1234));_0x1876b6&&(_0x1876b6[_0x4be761(0x14eb)][_0x4be761(0x4da)]=this[_0x4be761(0x14c1)]?_0x4be761(0x13de):_0x4be761(0x102b));};const _0x40b5a0=document[_0x3a84f9(0x1262)]('timestamp-options-group');_0x40b5a0&&(_0x40b5a0['style'][_0x3a84f9(0x4da)]=_0x571e45[_0x3a84f9(0x14c1)]?'block':_0x3a84f9(0x102b));}showModal('timestamp-settings-modal');}async function saveTimestampSettings(){const _0x4ab9d1=_0x211817,_0x25a884=getCurrentChatSettings(),_0x18c8bb=document[_0x4ab9d1(0x1262)]('timestamp-modal-enabled');_0x18c8bb&&(_0x25a884['timestampEnabled']=_0x18c8bb[_0x4ab9d1(0x14c1)]);const _0x25647e=document['querySelector']('input[name=\x22timestamp-position\x22]:checked');_0x25647e&&(_0x25a884[_0x4ab9d1(0x1c3)]=_0x25647e[_0x4ab9d1(0x1ebc)]),await saveCurrentChatSettings(_0x25a884),hideModal(_0x4ab9d1(0x8de)),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x4ab9d1(0x62c),_0x4ab9d1(0x11cb));}function showGroupMemberColorSettings(){const _0x519205=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x519205(0x1f68)]){showToast(_0x519205(0x35e),_0x519205(0x1816));return;}hideModal('bubble-style-modal');const _0x5544d8=document['getElementById'](_0x519205(0x140a));_0x5544d8[_0x519205(0x33a)]='';const _0x3c922c=getCurrentChatSettings(),_0x5bd949=_0x3c922c['memberBubbleColors']||{},_0x273523=groupChats[_0x519205(0xaf4)](_0x59a569=>_0x59a569['id']===currentChatCharacter['id']);console[_0x519205(0x2187)]('当前群聊:',currentChatCharacter),console[_0x519205(0x2187)]('找到的群聊:',_0x273523),console[_0x519205(0x2187)](_0x519205(0x1b2d),_0x273523?.[_0x519205(0x12a6)]);if(!_0x273523||!_0x273523[_0x519205(0x12a6)]||_0x273523['members'][_0x519205(0x19ee)]===0x0){_0x5544d8[_0x519205(0x33a)]=_0x519205(0xbae),showModal(_0x519205(0x2d0));return;}_0x273523[_0x519205(0x12a6)]['forEach'](_0x4cbadc=>{const _0x59a05a=_0x519205,_0x1abd63=typeof _0x4cbadc===_0x59a05a(0x11b7)?_0x4cbadc:_0x4cbadc['id'],_0x115ee3=characters[_0x59a05a(0xaf4)](_0x1a480b=>_0x1a480b['id']===_0x1abd63);if(!_0x115ee3){console[_0x59a05a(0x2187)](_0x59a05a(0x16ff),_0x1abd63,_0x59a05a(0x228a),characters[_0x59a05a(0x6a4)](_0x422981=>({'id':_0x422981['id'],'name':_0x422981['name']})));return;}const _0x5a6208=_0x5bd949[_0x1abd63]||'#f0f0f0',_0x30d794=document['createElement'](_0x59a05a(0xbbc));_0x30d794['className']=_0x59a05a(0x2240),_0x30d794['innerHTML']=_0x59a05a(0x906)+_0x115ee3[_0x59a05a(0xc3d)]+';\x20'+(_0x115ee3[_0x59a05a(0x1994)]?'background-image:\x20url('+_0x115ee3[_0x59a05a(0x1994)]+_0x59a05a(0x1dd):'')+_0x59a05a(0x3b0)+(_0x115ee3['avatarUrl']?'':_0x115ee3[_0x59a05a(0x1a1c)][_0x59a05a(0xcc3)](0x0))+_0x59a05a(0xa9a)+_0x115ee3['name']+_0x59a05a(0x8b5)+_0x115ee3[_0x59a05a(0x1a1c)]+'\x20的专属气泡颜色</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22color\x22\x20id=\x22member-color-'+_0x1abd63+'\x22\x20class=\x22color-input\x22\x20value=\x22'+_0x5a6208+_0x59a05a(0x1ea8),_0x5544d8['appendChild'](_0x30d794);}),showModal(_0x519205(0x2d0));}function saveGroupMemberColors(){const _0x14ad66=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x14ad66(0x1f68)])return;const _0x27bfe3=getCurrentChatSettings();!_0x27bfe3['memberBubbleColors']&&(_0x27bfe3[_0x14ad66(0x1541)]={});const _0x5c0fe6=groupChats['find'](_0x246403=>_0x246403['id']===currentChatCharacter['id']);if(!_0x5c0fe6||!_0x5c0fe6[_0x14ad66(0x12a6)])return;_0x5c0fe6[_0x14ad66(0x12a6)][_0x14ad66(0x19fb)](_0x4913f1=>{const _0x54f84e=_0x14ad66,_0x5bc41a=typeof _0x4913f1===_0x54f84e(0x11b7)?_0x4913f1:_0x4913f1['id'],_0x2edcb1=document[_0x54f84e(0x1262)](_0x54f84e(0x1acf)+_0x5bc41a);_0x2edcb1&&(_0x27bfe3[_0x54f84e(0x1541)][_0x5bc41a]=_0x2edcb1[_0x54f84e(0x1ebc)]);}),saveCurrentChatSettings(_0x27bfe3),hideModal('group-member-colors-modal'),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x14ad66(0x82b),_0x14ad66(0x11cb));}function avatarUploadHandler(_0x5578b4){const _0x512f16=_0x211817;console[_0x512f16(0x2187)](_0x512f16(0x847));if(_0x5578b4['target'][_0x512f16(0xf26)]&&_0x5578b4[_0x512f16(0x193d)][_0x512f16(0xf26)][0x0]){const _0x19425b=_0x5578b4[_0x512f16(0x193d)][_0x512f16(0xf26)][0x0];console[_0x512f16(0x2187)](_0x512f16(0xf72),_0x19425b['name'],_0x512f16(0x100c),_0x19425b['size'],_0x512f16(0x154f),_0x512f16(0x9f4),_0x19425b[_0x512f16(0x1a4b)]);if(!_0x19425b[_0x512f16(0x1a4b)][_0x512f16(0x1b30)](_0x512f16(0x1d60))){alert('请选择图片文件'),_0x5578b4[_0x512f16(0x193d)][_0x512f16(0x1ebc)]='';return;}if(_0x19425b[_0x512f16(0x2d8)]>0x5*0x400*0x400){alert(_0x512f16(0x6e9)),_0x5578b4['target'][_0x512f16(0x1ebc)]='';return;}const _0xa27f6=new FileReader();_0xa27f6[_0x512f16(0xc55)]=function(_0x46eb14){const _0x49490f=_0x512f16;try{const _0x5babc1=document[_0x49490f(0x1262)](_0x49490f(0x21a3)),_0x484abc=document[_0x49490f(0x1262)](_0x49490f(0x1fb9));console[_0x49490f(0x2187)]('文件读取成功，开始设置预览');if(!_0x5babc1){console[_0x49490f(0x174a)](_0x49490f(0x1ee2)),alert(_0x49490f(0x169a));return;}_0x5babc1['classList'][_0x49490f(0x21e2)](_0x49490f(0x14fb)),_0x5babc1['style']['setProperty'](_0x49490f(0x619),'url('+_0x46eb14[_0x49490f(0x193d)][_0x49490f(0x4ee)]+')',_0x49490f(0xd42)),_0x5babc1[_0x49490f(0x14eb)]['setProperty']('background-size',_0x49490f(0x12bb),_0x49490f(0xd42)),_0x5babc1[_0x49490f(0x14eb)][_0x49490f(0xcf0)](_0x49490f(0x153c),'center',_0x49490f(0xd42)),_0x5babc1[_0x49490f(0x14eb)]['setProperty'](_0x49490f(0x81c),'no-repeat',_0x49490f(0xd42)),_0x484abc&&(_0x484abc[_0x49490f(0x14eb)][_0x49490f(0x4da)]='none'),window['selectedAvatarData']=_0x46eb14[_0x49490f(0x193d)][_0x49490f(0x4ee)],console[_0x49490f(0x2187)](_0x49490f(0x1cc9)),console[_0x49490f(0x2187)](_0x49490f(0x19ff),{'background':_0x5babc1['style']['background'],'backgroundSize':_0x5babc1[_0x49490f(0x14eb)][_0x49490f(0x15d0)],'backgroundPosition':_0x5babc1[_0x49490f(0x14eb)]['backgroundPosition'],'className':_0x5babc1[_0x49490f(0x1722)]}),console[_0x49490f(0x2187)](_0x49490f(0xe3d));}catch(_0x11e166){console[_0x49490f(0x174a)]('设置头像预览时发生错误:',_0x11e166),alert(_0x49490f(0x6e8)+_0x11e166['message']);}},_0xa27f6[_0x512f16(0x21ec)]=function(){const _0x5ed6cd=_0x512f16;console[_0x5ed6cd(0x174a)](_0x5ed6cd(0x8cc)),alert(_0x5ed6cd(0x18c1)),_0x5578b4[_0x5ed6cd(0x193d)][_0x5ed6cd(0x1ebc)]='';},_0xa27f6['readAsDataURL'](_0x19425b);}else console['log'](_0x512f16(0x1458));}async function loadCustomEmojis(){const _0x260f55=_0x211817;try{const _0x113161=await db[_0x260f55(0x223)]['toArray']();if(_0x113161[_0x260f55(0x19ee)]===0x0){const _0x328c05=localStorage[_0x260f55(0x15d8)](_0x260f55(0x223));if(_0x328c05){console[_0x260f55(0x2187)]('检测到localStorage中的自定义表情包数据，开始迁移...');const _0x2c3c25=JSON[_0x260f55(0x22d3)](_0x328c05),_0x4decdc=_0x2c3c25['map'](_0x4585cb=>({..._0x4585cb,'isPersonal':_0x4585cb['isPersonal']!==undefined?_0x4585cb[_0x260f55(0x1a83)]:!![]}));_0x4decdc[_0x260f55(0x19ee)]>0x0&&await db[_0x260f55(0x223)][_0x260f55(0x2a3)](_0x4decdc),customEmojis=_0x4decdc[_0x260f55(0x1e1f)](_0x2b1381=>_0x2b1381[_0x260f55(0x1a83)]!==![]),console[_0x260f55(0x2187)]('自定义表情包迁移完成:',customEmojis);}else customEmojis=[];}else customEmojis=_0x113161['filter'](_0x34af0f=>_0x34af0f[_0x260f55(0x1a83)]!==![]),console[_0x260f55(0x2187)](_0x260f55(0x1daa),customEmojis);const _0x499d26=await db['recentEmojis']['orderBy'](_0x260f55(0x6ee))['reverse']()[_0x260f55(0xf13)]();if(_0x499d26['length']===0x0){const _0x14d4b4=localStorage[_0x260f55(0x15d8)](_0x260f55(0x1651));if(_0x14d4b4){console[_0x260f55(0x2187)](_0x260f55(0x5c7));const _0x8a44b8=JSON['parse'](_0x14d4b4);if(_0x8a44b8[_0x260f55(0x19ee)]>0x0){const _0x21ab0d=_0x8a44b8[_0x260f55(0x6d5)](0x0,0xa),_0x15a4a8=_0x21ab0d['map']((_0x838bc8,_0x4cbe6e)=>({'id':_0x4cbe6e+0x1,'url':_0x838bc8[_0x260f55(0x40f)],'description':_0x838bc8[_0x260f55(0x7c9)]||_0x260f55(0x16ce),'lastUsed':Date['now']()-_0x4cbe6e*0x3e8}));await db['recentEmojis'][_0x260f55(0x2a3)](_0x15a4a8),recentEmojis=_0x21ab0d,localStorage[_0x260f55(0x3b2)](_0x260f55(0x1651)),console[_0x260f55(0x2187)](_0x260f55(0x2069));}else recentEmojis=[];}else recentEmojis=[];}else recentEmojis=_0x499d26['map'](_0x266d82=>({'url':_0x266d82[_0x260f55(0x40f)],'description':_0x266d82[_0x260f55(0x7c9)]})),console[_0x260f55(0x2187)](_0x260f55(0xce5),recentEmojis);}catch(_0x155d1e){console['error']('加载自定义表情包失败:',_0x155d1e);const _0x335e68=localStorage[_0x260f55(0x15d8)](_0x260f55(0x223));_0x335e68?(customEmojis=JSON['parse'](_0x335e68),console['log'](_0x260f55(0xdc8),customEmojis)):customEmojis=[];try{const _0x3aa2cf=await db[_0x260f55(0x1651)][_0x260f55(0xe30)](_0x260f55(0x6ee))[_0x260f55(0x16b0)]()['toArray']();_0x3aa2cf[_0x260f55(0x19ee)]>0x0?recentEmojis=_0x3aa2cf[_0x260f55(0x6a4)](_0x2c517a=>({'url':_0x2c517a[_0x260f55(0x40f)],'description':_0x2c517a[_0x260f55(0x7c9)]})):recentEmojis=[];}catch(_0x2dc737){const _0xc51caf=localStorage[_0x260f55(0x15d8)](_0x260f55(0x1651));_0xc51caf?recentEmojis=JSON['parse'](_0xc51caf):recentEmojis=[];}}}async function saveCustomEmojis(){const _0x2dc388=_0x211817;try{await db[_0x2dc388(0x1464)]('rw',db['customEmojis'],async()=>{const _0x31d5e3=_0x2dc388;await db[_0x31d5e3(0x223)][_0x31d5e3(0x1e1f)](_0x1c5943=>_0x1c5943[_0x31d5e3(0x1a83)]!==![])[_0x31d5e3(0x1f4a)]();if(customEmojis[_0x31d5e3(0x19ee)]>0x0){const _0x697523=customEmojis[_0x31d5e3(0x6a4)](_0x138ec4=>({..._0x138ec4,'isPersonal':!![]}));await db['customEmojis'][_0x31d5e3(0x2a3)](_0x697523);}}),console[_0x2dc388(0x2187)](_0x2dc388(0x9d3));}catch(_0xe575a3){console[_0x2dc388(0x174a)](_0x2dc388(0x12b8),_0xe575a3),showToast(_0x2dc388(0x1ab4),_0x2dc388(0x174a));}}function showCustomEmojiPanel(){const _0x175ae8=_0x211817,_0x1e1f8b=document[_0x175ae8(0x1262)](_0x175ae8(0x95c)),_0x35e271=_0x1e1f8b[_0x175ae8(0x14eb)]['display']==='block';_0x35e271?(_0x1e1f8b[_0x175ae8(0x14eb)][_0x175ae8(0x4da)]=_0x175ae8(0x102b),document[_0x175ae8(0xa21)](_0x175ae8(0x1859),hideCustomEmojiPanel)):(_0x1e1f8b['style']['display']=_0x175ae8(0x13de),renderEmojiGrid(),setTimeout(()=>{const _0xe91225=_0x175ae8;document[_0xe91225(0x21e9)](_0xe91225(0x1859),hideCustomEmojiPanel);},0x64));}function hideCustomEmojiPanel(_0x2f6c12){const _0x203fea=_0x211817,_0x4f7ebd=document[_0x203fea(0x1262)]('custom-emoji-panel');if(!_0x2f6c12){_0x4f7ebd&&(_0x4f7ebd[_0x203fea(0x14eb)][_0x203fea(0x4da)]=_0x203fea(0x102b),document[_0x203fea(0xa21)](_0x203fea(0x1859),hideCustomEmojiPanel));return;}const _0x17f9ca=_0x2f6c12[_0x203fea(0x193d)][_0x203fea(0x216a)](_0x203fea(0x946));_0x4f7ebd&&!_0x4f7ebd[_0x203fea(0x971)](_0x2f6c12[_0x203fea(0x193d)])&&!_0x17f9ca&&(_0x4f7ebd['style'][_0x203fea(0x4da)]=_0x203fea(0x102b),document[_0x203fea(0xa21)](_0x203fea(0x1859),hideCustomEmojiPanel));}async function renderEmojiGrid(){const _0x3c26d5=_0x211817,_0x1059c0=document[_0x3c26d5(0x1262)](_0x3c26d5(0x1e8));_0x1059c0[_0x3c26d5(0x33a)]='';let _0x39b11a=[];if(currentEmojiTab===_0x3c26d5(0x1d3b))_0x39b11a=await getFilteredEmojis(recentEmojis);else currentEmojiTab==='custom'&&(_0x39b11a=await getFilteredEmojis(customEmojis));_0x39b11a[_0x3c26d5(0x19fb)]((_0xcc4f2,_0x2fe1e8)=>{const _0x5c891a=_0x3c26d5,_0x4a84f2=document['createElement'](_0x5c891a(0xbbc));_0x4a84f2[_0x5c891a(0x1722)]=_0x5c891a(0x2008),_0x4a84f2[_0x5c891a(0x14eb)][_0x5c891a(0x159c)]=_0xcc4f2[_0x5c891a(0x40f)]&&_0xcc4f2['url']!==_0x5c891a(0xcba)?_0x5c891a(0x9f1)+_0xcc4f2[_0x5c891a(0x40f)]+')':_0x5c891a(0x102b),_0x4a84f2['onclick']=()=>sendEmojiMessage(_0xcc4f2);if(currentEmojiTab==='custom'||currentEmojiTab===_0x5c891a(0x1d3b)){const _0x158974=document[_0x5c891a(0xac6)](_0x5c891a(0xca7));_0x158974[_0x5c891a(0x1722)]=_0x5c891a(0x1251),_0x158974[_0x5c891a(0x33a)]='×',_0x158974[_0x5c891a(0x1f36)]=_0x3638da=>{const _0x2e00bb=_0x5c891a;_0x3638da[_0x2e00bb(0x902)]();if(currentEmojiTab===_0x2e00bb(0x2b0))deleteCustomEmoji(_0x2fe1e8);else currentEmojiTab===_0x2e00bb(0x1d3b)&&deleteRecentEmoji(_0x2fe1e8);},_0x4a84f2['appendChild'](_0x158974);}_0x1059c0[_0x5c891a(0x497)](_0x4a84f2);});if(currentEmojiTab===_0x3c26d5(0x2b0)){const _0x2ee4c5=document['createElement'](_0x3c26d5(0xbbc));_0x2ee4c5[_0x3c26d5(0x1722)]=_0x3c26d5(0x62f),_0x2ee4c5[_0x3c26d5(0x33a)]='+',_0x2ee4c5['onclick']=()=>document[_0x3c26d5(0x1262)](_0x3c26d5(0x12ce))['click'](),_0x1059c0[_0x3c26d5(0x497)](_0x2ee4c5);}if(_0x39b11a[_0x3c26d5(0x19ee)]===0x0){const _0x38511d=document[_0x3c26d5(0xac6)](_0x3c26d5(0xbbc));_0x38511d[_0x3c26d5(0x1722)]='empty-emoji-grid',currentEmojiTab===_0x3c26d5(0x1d3b)?_0x38511d['textContent']=_0x3c26d5(0x7de):_0x38511d[_0x3c26d5(0x13be)]=_0x3c26d5(0xc34),_0x1059c0['appendChild'](_0x38511d);}}async function sendEmojiMessage(_0x283622){const _0x2c34d3=_0x211817;console[_0x2c34d3(0x2187)]('🎭\x20发送表情包:',_0x283622);if(!currentChatCharacter)return;addToRecentEmojis(_0x283622);const _0x17a229=Date[_0x2c34d3(0x2eb)]()[_0x2c34d3(0x1878)](),_0x42feb9={'id':_0x17a229,'sender':_0x2c34d3(0x1e6d),'content':'','image':_0x283622[_0x2c34d3(0x40f)],'isEmoji':!![],'emojiDescription':_0x283622[_0x2c34d3(0x7c9)]||'自定义表情包','timestamp':Date[_0x2c34d3(0x2eb)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x2c34d3(0x1cd6)](_0x42feb9);try{const _0xdd2574=currentChatCharacter['id']+'_'+_0x42feb9['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x2c34d3(0x19ee)]-0x1);await db[_0x2c34d3(0x19a2)][_0x2c34d3(0x21e2)]({'id':_0xdd2574,'characterId':currentChatCharacter['id'],'timestamp':_0x42feb9[_0x2c34d3(0x1716)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x2c34d3(0x19ee)]-0x1,'originalMessageId':_0x42feb9['id'],'messageData':_0x42feb9}),console[_0x2c34d3(0x2187)](_0x2c34d3(0x16ea));}catch(_0x3e06db){console[_0x2c34d3(0x174a)](_0x2c34d3(0xc3a),_0x3e06db),saveChatMessages();}renderChatMessages(currentChatCharacter['id']),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),hideCustomEmojiPanel(),pendingUserMessage=_0x42feb9;const _0x31d40d=document['getElementById'](_0x2c34d3(0x1d2b));_0x31d40d&&(_0x31d40d[_0x2c34d3(0x14eb)][_0x2c34d3(0x2231)]='pulse\x201.5s\x20infinite',_0x31d40d['classList'][_0x2c34d3(0x21e2)](_0x2c34d3(0x2b1)),_0x31d40d[_0x2c34d3(0x378)]=_0x2c34d3(0xd96));}async function saveRecentEmojis(){const _0x58fafc=_0x211817;try{const _0x3b92fa=0xa;recentEmojis[_0x58fafc(0x19ee)]>_0x3b92fa&&(recentEmojis=recentEmojis[_0x58fafc(0x6d5)](0x0,_0x3b92fa)),await db[_0x58fafc(0x1464)]('rw',db['recentEmojis'],async()=>{const _0x3ca882=_0x58fafc;await db[_0x3ca882(0x1651)]['clear']();if(recentEmojis['length']>0x0){const _0x4c24da=recentEmojis[_0x3ca882(0x6a4)]((_0x23d4e9,_0x4fb95d)=>({'id':_0x4fb95d+0x1,'url':_0x23d4e9[_0x3ca882(0x40f)],'description':_0x23d4e9[_0x3ca882(0x7c9)]||_0x3ca882(0x16ce),'lastUsed':Date[_0x3ca882(0x2eb)]()-_0x4fb95d*0x3e8}));await db[_0x3ca882(0x1651)][_0x3ca882(0x2a3)](_0x4c24da);}});}catch(_0x4fdfaf){console[_0x58fafc(0x174a)](_0x58fafc(0x59a),_0x4fdfaf);}}async function addToRecentEmojis(_0xe3e8d0){const _0x257e38=_0x211817;recentEmojis=recentEmojis['filter'](_0x464cc0=>_0x464cc0[_0x257e38(0x40f)]!==_0xe3e8d0['url']),recentEmojis[_0x257e38(0x5ed)](_0xe3e8d0),recentEmojis[_0x257e38(0x19ee)]>0x14&&(recentEmojis=recentEmojis[_0x257e38(0x6d5)](0x0,0x14)),await saveRecentEmojis();}function isVisionModelSupported(){const _0x2e75d3=_0x211817,_0x412500=['gpt-4-vision','gpt-4o',_0x2e75d3(0x1caa),_0x2e75d3(0x1620),_0x2e75d3(0x17f4),_0x2e75d3(0x1ab6),'gemini-2.0-flash',_0x2e75d3(0x622),_0x2e75d3(0x1bed),_0x2e75d3(0xd9e),_0x2e75d3(0x1c1c),_0x2e75d3(0x1643),_0x2e75d3(0x8b4),_0x2e75d3(0x1805),_0x2e75d3(0x1021),'claude-3.5-haiku',_0x2e75d3(0x69e),'qwen2-vl',_0x2e75d3(0xb14),_0x2e75d3(0x1c4),'internvl','cogvlm',_0x2e75d3(0x17cf),'moondream',_0x2e75d3(0xa8b)],_0x5a22e9=apiSettings[_0x2e75d3(0x1976)]?.[_0x2e75d3(0x49e)]()||'',_0x229511=_0x412500['some'](_0x4b395c=>_0x5a22e9[_0x2e75d3(0x1831)](_0x4b395c[_0x2e75d3(0x49e)]()));return console[_0x2e75d3(0x2187)](_0x2e75d3(0xacc),_0x5a22e9),console[_0x2e75d3(0x2187)](_0x2e75d3(0xe9b),_0x229511),_0x229511;}function deleteCustomEmoji(_0x3afc95){const _0x2c8b78=_0x211817;confirm(_0x2c8b78(0x10c7))&&(customEmojis[_0x2c8b78(0x19b2)](_0x3afc95,0x1),saveCustomEmojis(),renderEmojiGrid());}function deleteRecentEmoji(_0x4ab574){const _0x29fc0f=_0x211817;confirm(_0x29fc0f(0x868))&&(recentEmojis[_0x29fc0f(0x19b2)](_0x4ab574,0x1),saveCustomEmojis(),renderEmojiGrid());}function initializeEmojiUpload(){const _0x4146d8=_0x211817,_0x138f00=document['getElementById']('emoji-upload');_0x138f00&&_0x138f00[_0x4146d8(0x21e9)](_0x4146d8(0x5af),handleEmojiUpload),document[_0x4146d8(0x1897)](_0x4146d8(0xb23))[_0x4146d8(0x19fb)](_0x298183=>{const _0x3ba151=_0x4146d8;_0x298183[_0x3ba151(0x21e9)]('click',function(){const _0x241ee3=_0x3ba151;document['querySelectorAll']('.emoji-tab')[_0x241ee3(0x19fb)](_0x34db78=>_0x34db78[_0x241ee3(0x1c1b)]['remove'](_0x241ee3(0x1a14))),this['classList'][_0x241ee3(0x21e2)](_0x241ee3(0x1a14)),currentEmojiTab=this[_0x241ee3(0x1ecd)]['tab'],renderEmojiGrid();});});}function toggleToolsPanel(){const _0xc9de4a=_0x211817,_0x143dd5=document[_0xc9de4a(0x1262)]('tools-panel'),_0x343402=document[_0xc9de4a(0x1262)](_0xc9de4a(0x51d)),_0x180ede=document[_0xc9de4a(0x1262)](_0xc9de4a(0x95c));if(!_0x143dd5||!_0x343402)return;const _0x38876f=_0x143dd5[_0xc9de4a(0x14eb)][_0xc9de4a(0x4da)]===_0xc9de4a(0x13de);_0x38876f?hideToolsPanel():(showToolsPanel(),_0x180ede&&(_0x180ede[_0xc9de4a(0x14eb)][_0xc9de4a(0x4da)]=_0xc9de4a(0x102b)),setTimeout(()=>{const _0x5ee84e=_0xc9de4a;document['addEventListener'](_0x5ee84e(0x1859),handleToolsPanelOutsideClick);},0x64));}function showToolsPanel(){const _0x54be22=_0x211817,_0x3fd190=document[_0x54be22(0x1262)](_0x54be22(0x1d86)),_0x540af1=document['getElementById']('toggle-tools-btn'),_0x4fe32a=document[_0x54be22(0x1897)]('.single-chat-only'),_0x43cac7=currentChatCharacter&&currentChatCharacter[_0x54be22(0x1f68)];_0x4fe32a['forEach'](_0x3ad460=>{const _0x10a94c=_0x54be22;_0x43cac7?_0x3ad460[_0x10a94c(0x14eb)]['display']='none':_0x3ad460[_0x10a94c(0x14eb)][_0x10a94c(0x4da)]='';}),_0x3fd190&&(_0x3fd190[_0x54be22(0x14eb)][_0x54be22(0x4da)]=_0x54be22(0x13de),_0x3fd190[_0x54be22(0x14eb)][_0x54be22(0x2231)]='toolsPanelSlideUp\x200.3s\x20cubic-bezier(0.34,\x201.56,\x200.64,\x201)'),_0x540af1&&_0x540af1['classList'][_0x54be22(0x21e2)](_0x54be22(0x1a14));}function hideToolsPanel(){const _0x2b6d5d=_0x211817,_0x2f31e9=document[_0x2b6d5d(0x1262)]('tools-panel'),_0x248dc3=document[_0x2b6d5d(0x1262)](_0x2b6d5d(0x51d));_0x2f31e9&&(_0x2f31e9[_0x2b6d5d(0x14eb)][_0x2b6d5d(0x4da)]='none'),_0x248dc3&&_0x248dc3[_0x2b6d5d(0x1c1b)]['remove'](_0x2b6d5d(0x1a14)),document[_0x2b6d5d(0xa21)](_0x2b6d5d(0x1859),handleToolsPanelOutsideClick);}function handleToolsPanelOutsideClick(_0xf58b5a){const _0x542c82=_0x211817,_0x20d72b=document['getElementById'](_0x542c82(0x1d86)),_0x2d52a2=document[_0x542c82(0x1262)](_0x542c82(0x51d));_0x20d72b&&!_0x20d72b[_0x542c82(0x971)](_0xf58b5a[_0x542c82(0x193d)])&&_0x2d52a2&&!_0x2d52a2[_0x542c82(0x971)](_0xf58b5a[_0x542c82(0x193d)])&&hideToolsPanel();}function handleEmojiUpload(_0x1a12a8){const _0x1c3c94=_0x211817,_0x3519bd=_0x1a12a8[_0x1c3c94(0x193d)][_0x1c3c94(0xf26)];if(!_0x3519bd||_0x3519bd['length']===0x0)return;Array[_0x1c3c94(0x13c0)](_0x3519bd)[_0x1c3c94(0x19fb)](_0x3941d5=>{const _0x51392b=_0x1c3c94;if(!_0x3941d5['type']['startsWith'](_0x51392b(0x1d60))){alert(_0x51392b(0x118e));return;}if(_0x3941d5['type']===_0x51392b(0xa85)){const _0x348792=confirm(_0x51392b(0x1973));if(!_0x348792)return;}if(_0x3941d5[_0x51392b(0x2d8)]>0x5*0x400*0x400){alert(_0x51392b(0x6e9));return;}const _0x730a3d=new FileReader();_0x730a3d['onload']=function(_0x1db8e1){const _0x2c2988=_0x51392b,_0x264d13={'id':Date['now']()[_0x2c2988(0x1878)]()+'_'+Math[_0x2c2988(0x11a8)]()[_0x2c2988(0x1878)](0x24)[_0x2c2988(0x15fb)](0x2,0x9),'url':_0x1db8e1['target'][_0x2c2988(0x4ee)],'addedAt':new Date()[_0x2c2988(0x1034)](),'isPersonal':!![]};pendingPersonalEmojiData=_0x264d13,showPersonalEmojiDescriptionModal(_0x1db8e1[_0x2c2988(0x193d)][_0x2c2988(0x4ee)]);},_0x730a3d[_0x51392b(0x127c)](_0x3941d5);}),_0x1a12a8[_0x1c3c94(0x193d)][_0x1c3c94(0x1ebc)]='';}function showPersonalEmojiDescriptionModal(_0x19a91a){const _0x15257d=_0x211817,_0x18b3e6=document['getElementById'](_0x15257d(0x8a6)),_0x161a63=document[_0x15257d(0x1262)]('personal-emoji-preview-image'),_0x4f0bdf=document[_0x15257d(0x1262)](_0x15257d(0x1c7c));_0x161a63[_0x15257d(0x45c)]=_0x19a91a,_0x4f0bdf[_0x15257d(0x1ebc)]='',_0x18b3e6[_0x15257d(0x14eb)]['display']='flex',setTimeout(()=>{const _0x3baf9e=_0x15257d;_0x4f0bdf[_0x3baf9e(0x13cf)]();},0x64);const _0x808a93=_0x398700=>{const _0x31f142=_0x15257d;if(_0x398700[_0x31f142(0x213c)]==='Enter'&&(_0x398700[_0x31f142(0x14b6)]||_0x398700[_0x31f142(0x150f)]))confirmPersonalEmojiDescription(),_0x4f0bdf['removeEventListener'](_0x31f142(0xf5c),_0x808a93);else _0x398700[_0x31f142(0x213c)]===_0x31f142(0x185a)&&(hidePersonalEmojiDescriptionModal(),_0x4f0bdf[_0x31f142(0xa21)](_0x31f142(0xf5c),_0x808a93));};_0x4f0bdf[_0x15257d(0x21e9)](_0x15257d(0xf5c),_0x808a93);}function hidePersonalEmojiDescriptionModal(_0x54929d){const _0x19c9d2=_0x211817;if(_0x54929d&&_0x54929d[_0x19c9d2(0x193d)]!==_0x54929d['currentTarget'])return;const _0x2a39f9=document[_0x19c9d2(0x1262)](_0x19c9d2(0x8a6));_0x2a39f9[_0x19c9d2(0x14eb)]['display']=_0x19c9d2(0x102b),pendingPersonalEmojiData=null;}function confirmPersonalEmojiDescription(){const _0x43f812=_0x211817;if(!pendingPersonalEmojiData)return;const _0x3efd32=document[_0x43f812(0x1262)](_0x43f812(0x1c7c)),_0x57c716=_0x3efd32[_0x43f812(0x1ebc)]['trim']()||_0x43f812(0x16ce),_0x44eb93={'id':pendingPersonalEmojiData['id'],'url':pendingPersonalEmojiData['url'],'description':_0x57c716,'addedAt':pendingPersonalEmojiData[_0x43f812(0x12ff)],'isPersonal':pendingPersonalEmojiData['isPersonal']};customEmojis[_0x43f812(0x1cd6)](_0x44eb93),saveCustomEmojis(),currentEmojiTab===_0x43f812(0x2b0)&&renderEmojiGrid(),document[_0x43f812(0x1262)](_0x43f812(0x8a6))[_0x43f812(0x14eb)]['display']=_0x43f812(0x102b),pendingPersonalEmojiData=null,showToast(_0x43f812(0x1475),_0x43f812(0x11cb));}async function loadEmojiLibraries(){const _0x5c88ea=_0x211817;try{emojiLibraries=await db[_0x5c88ea(0x159e)][_0x5c88ea(0xf13)](),renderEmojiLibraryList();}catch(_0x9b7b04){console[_0x5c88ea(0x174a)](_0x5c88ea(0xe82),_0x9b7b04),emojiLibraries=[];}}async function saveEmojiLibraries(){const _0x5e4fad=_0x211817;try{await db['transaction']('rw',db[_0x5e4fad(0x159e)],async()=>{const _0x53630b=_0x5e4fad;await db['emojiLibraries'][_0x53630b(0xa4f)](),emojiLibraries[_0x53630b(0x19ee)]>0x0&&await db[_0x53630b(0x159e)][_0x53630b(0x2a3)](emojiLibraries);}),console['log']('表情包库保存成功');}catch(_0x5dd8b2){console['error'](_0x5e4fad(0x892),_0x5dd8b2);}}function togglePersonaSection(){const _0x15801f=_0x211817,_0x52424c=document[_0x15801f(0x1262)]('persona-content'),_0x215f27=document[_0x15801f(0x1262)](_0x15801f(0xd54));isPersonaExpanded=!isPersonaExpanded,isPersonaExpanded?(_0x52424c[_0x15801f(0x14eb)]['display']=_0x15801f(0x13de),_0x215f27[_0x15801f(0x1c1b)][_0x15801f(0x21e2)](_0x15801f(0x10de))):(_0x52424c[_0x15801f(0x14eb)][_0x15801f(0x4da)]='none',_0x215f27[_0x15801f(0x1c1b)][_0x15801f(0x1493)]('expanded'));}function toggleEmojiLibrarySection(){const _0x38774a=_0x211817,_0x568615=document[_0x38774a(0x1262)](_0x38774a(0x878)),_0x5d251b=document[_0x38774a(0x1262)]('emoji-library-chevron');isEmojiLibraryExpanded=!isEmojiLibraryExpanded,isEmojiLibraryExpanded?(_0x568615[_0x38774a(0x14eb)][_0x38774a(0x4da)]=_0x38774a(0x13de),_0x5d251b[_0x38774a(0x1c1b)]['add'](_0x38774a(0x10de)),renderEmojiLibraryList()):(_0x568615[_0x38774a(0x14eb)][_0x38774a(0x4da)]=_0x38774a(0x102b),_0x5d251b['classList']['remove']('expanded'));}function renderEmojiLibraryList(){const _0x3e7c1f=_0x211817,_0x33717e=document[_0x3e7c1f(0x1262)](_0x3e7c1f(0x1ca4));if(!_0x33717e)return;if(emojiLibraries[_0x3e7c1f(0x19ee)]===0x0){_0x33717e[_0x3e7c1f(0x33a)]=_0x3e7c1f(0x1951);return;}_0x33717e[_0x3e7c1f(0x33a)]=emojiLibraries[_0x3e7c1f(0x6a4)](_0x41df20=>_0x3e7c1f(0x1f3a)+_0x41df20['id']+_0x3e7c1f(0x1714)+_0x41df20['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22emoji-library-item-stats\x22\x20id=\x22library-stats-'+_0x41df20['id']+_0x3e7c1f(0x158d)+_0x41df20['id']+_0x3e7c1f(0x1242)+_0x41df20['id']+'\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x3e7c1f(0x122b)](''),emojiLibraries[_0x3e7c1f(0x19fb)](async _0x2ba60b=>{const _0x4e4eda=_0x3e7c1f,_0x1aa6dd=await getEmojiLibraryItemCount(_0x2ba60b['id']),_0x3fce83=document[_0x4e4eda(0x1262)](_0x4e4eda(0xed0)+_0x2ba60b['id']);_0x3fce83&&(_0x3fce83[_0x4e4eda(0x13be)]=_0x1aa6dd+_0x4e4eda(0x4ae));});}async function getEmojiLibraryItemCount(_0x582aaa){const _0x438c2f=_0x211817;try{const _0x5f4990=await db[_0x438c2f(0x529)][_0x438c2f(0xa24)]('libraryId')['equals'](_0x582aaa)[_0x438c2f(0xc44)]();return _0x5f4990;}catch(_0x59d5ef){return console[_0x438c2f(0x174a)]('获取表情包库统计失败:',_0x59d5ef),0x0;}}async function checkAllEmojiData(){const _0x4099a2=_0x211817;console[_0x4099a2(0x2187)](_0x4099a2(0x1ce));try{const _0x387c60=await db['customEmojis'][_0x4099a2(0xf13)]();console[_0x4099a2(0x2187)](_0x4099a2(0x171c)),_0x387c60[_0x4099a2(0x19fb)]((_0x47cda8,_0x45931c)=>{const _0x53b551=_0x4099a2;console[_0x53b551(0x2187)](_0x45931c+0x1+_0x53b551(0x17a9)+_0x47cda8['id']),console[_0x53b551(0x2187)]('\x20\x20\x20描述:\x20\x22'+_0x47cda8[_0x53b551(0x7c9)]+'\x22'),console[_0x53b551(0x2187)](_0x53b551(0x130a)+_0x47cda8[_0x53b551(0x1a1c)]),console[_0x53b551(0x2187)](_0x53b551(0x1724)+_0x47cda8[_0x53b551(0x2104)]),console['log'](_0x53b551(0xc21)+_0x47cda8[_0x53b551(0x1a83)]),console[_0x53b551(0x2187)](_0x53b551(0xc07));});const _0x10637b=await db['emojiLibraryItems'][_0x4099a2(0xf13)]();console['log'](_0x4099a2(0x4a3)),_0x10637b['forEach'](_0x4f95b5=>{const _0x39600b=_0x4099a2;console[_0x39600b(0x2187)](_0x39600b(0x17ff)+_0x4f95b5[_0x39600b(0x1bb3)]+_0x39600b(0x2071)+_0x4f95b5[_0x39600b(0x1c4a)]);});const _0x16be8b=_0x387c60['filter'](_0x22590c=>{const _0x1e1454=_0x4099a2,_0x20b569=new Date(_0x22590c[_0x1e1454(0x2104)]),_0x48c1ab=new Date(),_0x507168=(_0x48c1ab-_0x20b569)/(0x3e8*0x3c*0x3c);return _0x507168<0x18;});return console[_0x4099a2(0x2187)](_0x4099a2(0xcfd),_0x16be8b['length'],'个'),_0x16be8b['forEach'](_0x5dbbf9=>{const _0x39aaf2=_0x4099a2;console[_0x39aaf2(0x2187)](_0x39aaf2(0x1cb3)+_0x5dbbf9['description']+_0x39aaf2(0x15c6)+_0x5dbbf9[_0x39aaf2(0x1a83)]);}),{'allEmojis':_0x387c60,'recentEmojis':_0x16be8b,'associations':_0x10637b};}catch(_0x2c2537){return console[_0x4099a2(0x174a)]('🚨\x20[URGENT]\x20检查失败:',_0x2c2537),{'error':_0x2c2537[_0x4099a2(0x1e8e)]};}}async function diagnoseBrowserStorage(){const _0x520040=_0x211817;console[_0x520040(0x2187)]('🚨\x20[DIAGNOSE]\x20开始诊断浏览器存储状态...');try{if(_0x520040(0x12f5)in navigator&&'estimate'in navigator[_0x520040(0x12f5)]){const _0x1d0a83=await navigator[_0x520040(0x12f5)][_0x520040(0x1cf)]();console[_0x520040(0x2187)](_0x520040(0x172f),{'已使用':Math[_0x520040(0x13e2)](_0x1d0a83[_0x520040(0x427)]/0x400/0x400)+'MB','总配额':Math['round'](_0x1d0a83['quota']/0x400/0x400)+'MB','使用率':Math[_0x520040(0x13e2)](_0x1d0a83[_0x520040(0x427)]/_0x1d0a83['quota']*0x64)+'%'});}const _0x148122=await db[_0x520040(0x223)]['toArray'](),_0x5b623a=_0x148122['reduce']((_0x2dbe3e,_0x524a8c)=>{const _0x274eed=_0x520040;return _0x2dbe3e+(_0x524a8c['url']?_0x524a8c[_0x274eed(0x40f)][_0x274eed(0x19ee)]:0x0);},0x0);console['log'](_0x520040(0x1dbf),{'表情包数量':_0x148122[_0x520040(0x19ee)],'估计大小':Math['round'](_0x5b623a/0x400/0x400)+'MB'});const _0xbad47b=_0x148122[_0x520040(0x1122)]((_0xd60791,_0xc3e1e5)=>{const _0x2a4c55=_0x520040,_0x92289b=new Date(_0xc3e1e5[_0x2a4c55(0x2104)]),_0xe9ad7d=new Date(_0xd60791[_0x2a4c55(0x2104)]);return _0x92289b<_0xe9ad7d?_0xc3e1e5:_0xd60791;},_0x148122[0x0]);if(_0xbad47b){const _0xf2cc3c=new Date(_0xbad47b['uploadTime']),_0x3c0579=(new Date()-_0xf2cc3c)/(0x3e8*0x3c*0x3c);console['log'](_0x520040(0x186d),{'描述':_0xbad47b[_0x520040(0x7c9)],'上传时间':_0xbad47b['uploadTime'],'距今小时数':Math[_0x520040(0x13e2)](_0x3c0579)});}return{'allEmojis':_0x148122,'totalSize':_0x5b623a};}catch(_0x305ecb){return console['error'](_0x520040(0x423),_0x305ecb),{'error':_0x305ecb[_0x520040(0x1e8e)]};}}function showEmojiRecoveryInstructions(){const _0x47800c=_0x211817;console[_0x47800c(0x2187)](_0x47800c(0xf31));const _0x4b400d='\x0a🚨\x20表情包数据丢失恢复指南：\x0a\x0a1.\x20你的表情包数据已经完全丢失，需要重新上传\x0a2.\x20为了避免再次丢失，建议：\x0a\x0a\x20\x20\x20📱\x20手机端操作：\x0a\x20\x20\x20-\x20重新创建表情包库\x0a\x20\x20\x20-\x20重新上传表情包\x0a\x20\x20\x20-\x20上传后立即测试AI是否能使用\x0a\x0a\x20\x20\x20💾\x20数据备份：\x0a\x20\x20\x20-\x20上传完成后，导出表情包库作为备份\x0a\x20\x20\x20-\x20定期检查表情包库状态\x0a\x0a\x20\x20\x20🔧\x20预防措施：\x0a\x20\x20\x20-\x20避免在上传过程中刷新页面\x0a\x20\x20\x20-\x20确保网络连接稳定\x0a\x20\x20\x20-\x20一次不要上传太多表情包\x0a\x0a3.\x20如果问题再次发生，可能需要检查：\x0a\x20\x20\x20-\x20浏览器存储设置\x0a\x20\x20\x20-\x20是否有自动清理数据的扩展\x0a\x20\x20\x20-\x20设备存储空间是否充足\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return console[_0x47800c(0x2187)](_0x4b400d),showToast('请查看控制台的恢复指南',_0x47800c(0x477)),_0x4b400d;}async function manualRecoverEmojis(_0x82284c){const _0xb6a815=_0x211817;console[_0xb6a815(0x2187)]('🚨\x20[MANUAL]\x20手动恢复表情包库:',_0x82284c);try{const _0x3937d2=emojiLibraries[_0xb6a815(0xaf4)](_0x57c4f1=>_0x57c4f1[_0xb6a815(0x1a1c)]===_0x82284c);if(!_0x3937d2){console['error'](_0xb6a815(0x12fe),_0x82284c);return;}const _0x146124=await db['customEmojis'][_0xb6a815(0xa24)](_0xb6a815(0x1a83))[_0xb6a815(0x1694)](![])[_0xb6a815(0xf13)](),_0x40ab91=await db['emojiLibraryItems'][_0xb6a815(0xf13)](),_0x1ea2bb=_0x146124[_0xb6a815(0x1e1f)](_0x3ccd01=>!_0x40ab91[_0xb6a815(0x19fa)](_0x1718b9=>_0x1718b9['emojiId']===_0x3ccd01['id']));console[_0xb6a815(0x2187)](_0xb6a815(0x1f61),_0x1ea2bb[_0xb6a815(0x19ee)],'个'),_0x1ea2bb[_0xb6a815(0x19fb)](_0x1081d5=>{const _0x335a3c=_0xb6a815;console[_0x335a3c(0x2187)]('\x20\x20-\x20\x22'+_0x1081d5[_0x335a3c(0x7c9)]+_0x335a3c(0x875)+_0x1081d5['id']+')');});const _0x10ff45=_0x1ea2bb[_0xb6a815(0x6a4)](_0x3f2c88=>({'libraryId':_0x3937d2['id'],'emojiId':_0x3f2c88['id'],'addedAt':_0x3f2c88[_0xb6a815(0x2104)]||new Date()[_0xb6a815(0x1034)]()}));_0x10ff45['length']>0x0?(await db[_0xb6a815(0x529)]['bulkAdd'](_0x10ff45),console[_0xb6a815(0x2187)](_0xb6a815(0x58c),_0x10ff45[_0xb6a815(0x19ee)],_0xb6a815(0x443),_0x82284c),await loadEmojiLibraries(),showToast(_0xb6a815(0x2309)+_0x10ff45[_0xb6a815(0x19ee)]+_0xb6a815(0xa76)+_0x82284c,_0xb6a815(0x11cb))):showToast(_0xb6a815(0x1c70),_0xb6a815(0x477));}catch(_0x5ba111){console[_0xb6a815(0x174a)](_0xb6a815(0x995),_0x5ba111),showToast('恢复失败:\x20'+_0x5ba111['message'],_0xb6a815(0x174a));}}async function recoverEmojiLibraryAssociations(){const _0x5894a8=_0x211817;console[_0x5894a8(0x2187)](_0x5894a8(0x5fd));try{const _0x3eff57=await db[_0x5894a8(0x159e)][_0x5894a8(0xf13)]();console[_0x5894a8(0x2187)](_0x5894a8(0x1183),_0x3eff57[_0x5894a8(0x19ee)],'个');const _0x11defb=await db[_0x5894a8(0x223)][_0x5894a8(0xa24)](_0x5894a8(0x1a83))[_0x5894a8(0x1694)](![])[_0x5894a8(0xf13)]();console['log'](_0x5894a8(0x43b),_0x11defb['length'],'个'),console[_0x5894a8(0x2187)]('🔧\x20[RECOVER]\x20库表情包详情:',_0x11defb[_0x5894a8(0x6a4)](_0x565eef=>({'id':_0x565eef['id'],'name':_0x565eef['name'],'description':_0x565eef[_0x5894a8(0x7c9)],'uploadTime':_0x565eef[_0x5894a8(0x2104)]})));const _0x4b63e3=await db[_0x5894a8(0x529)][_0x5894a8(0xf13)]();console[_0x5894a8(0x2187)](_0x5894a8(0x15f5),_0x4b63e3[_0x5894a8(0x19ee)],'个');const _0x5e18dd=_0x11defb[_0x5894a8(0x1e1f)](_0x2655fc=>!_0x4b63e3['some'](_0x25c650=>_0x25c650[_0x5894a8(0x1c4a)]===_0x2655fc['id']));console['log'](_0x5894a8(0x1c77),_0x5e18dd[_0x5894a8(0x19ee)],'个');if(_0x5e18dd['length']>0x0){console[_0x5894a8(0x2187)]('🔧\x20[RECOVER]\x20孤立表情包详情:',_0x5e18dd['map'](_0xce8431=>({'id':_0xce8431['id'],'name':_0xce8431[_0x5894a8(0x1a1c)],'description':_0xce8431[_0x5894a8(0x7c9)],'uploadTime':_0xce8431['uploadTime']})));const _0x4db669=_0x3eff57['map']((_0x4e6114,_0x1b3834)=>_0x1b3834+0x1+'.\x20'+_0x4e6114[_0x5894a8(0x1a1c)])[_0x5894a8(0x122b)]('\x0a'),_0x87ccde=prompt(_0x5894a8(0x11b0)+_0x5e18dd['length']+'\x20个孤立的表情包需要重新分配到表情包库。\x0a\x0a可用的表情包库：\x0a'+_0x4db669+_0x5894a8(0x6b1));if(_0x87ccde===null){showToast(_0x5894a8(0x7bc),_0x5894a8(0x477));return;}const _0x3d227f=[];if(_0x87ccde[_0x5894a8(0x49e)]()===_0x5894a8(0x1033))for(const _0x3fb2b4 of _0x5e18dd){const _0x372a0a=new Date(_0x3fb2b4['uploadTime'])['getTime']();let _0x4481b1=null,_0x3d56b1=Infinity;for(const _0x32a10e of _0x3eff57){const _0x3cae23=new Date(_0x32a10e['createdAt'])['getTime'](),_0xccdd13=Math[_0x5894a8(0x1b24)](_0x372a0a-_0x3cae23);_0xccdd13<_0x3d56b1&&(_0x3d56b1=_0xccdd13,_0x4481b1=_0x32a10e);}_0x4481b1&&(_0x3d227f[_0x5894a8(0x1cd6)]({'libraryId':_0x4481b1['id'],'emojiId':_0x3fb2b4['id'],'addedAt':_0x3fb2b4[_0x5894a8(0x2104)]||new Date()[_0x5894a8(0x1034)]()}),console[_0x5894a8(0x2187)]('🔧\x20[RECOVER]\x20自动分配表情包\x20\x22'+_0x3fb2b4[_0x5894a8(0x7c9)]+_0x5894a8(0x50f)+_0x4481b1[_0x5894a8(0x1a1c)]+'\x22'));}else{const _0x3f127b=parseInt(_0x87ccde)-0x1;if(_0x3f127b>=0x0&&_0x3f127b<_0x3eff57[_0x5894a8(0x19ee)]){const _0x338e52=_0x3eff57[_0x3f127b];for(const _0x595788 of _0x5e18dd){_0x3d227f['push']({'libraryId':_0x338e52['id'],'emojiId':_0x595788['id'],'addedAt':_0x595788['uploadTime']||new Date()[_0x5894a8(0x1034)]()}),console[_0x5894a8(0x2187)]('🔧\x20[RECOVER]\x20手动分配表情包\x20\x22'+_0x595788['description']+_0x5894a8(0x50f)+_0x338e52[_0x5894a8(0x1a1c)]+'\x22');}}else{showToast(_0x5894a8(0x1fcc),_0x5894a8(0x174a));return;}}_0x3d227f[_0x5894a8(0x19ee)]>0x0?(await db[_0x5894a8(0x529)]['bulkAdd'](_0x3d227f),console[_0x5894a8(0x2187)](_0x5894a8(0x1b97),_0x3d227f['length'],_0x5894a8(0x1cbd)),await loadEmojiLibraries(),showToast(_0x5894a8(0x2309)+_0x3d227f[_0x5894a8(0x19ee)]+'\x20个表情包的关联记录','success')):showToast(_0x5894a8(0x19ba),'info');}else showToast(_0x5894a8(0x1ce1),_0x5894a8(0x11cb));}catch(_0x7e20e4){console[_0x5894a8(0x174a)](_0x5894a8(0xad8),_0x7e20e4),showToast(_0x5894a8(0x18cb)+_0x7e20e4['message'],_0x5894a8(0x174a));}}function showCreateLibraryForm(){const _0x25a8ef=_0x211817;document[_0x25a8ef(0x1262)](_0x25a8ef(0x8f3))[_0x25a8ef(0x13be)]=_0x25a8ef(0x1ab9),document[_0x25a8ef(0x1262)](_0x25a8ef(0x1e2a))[_0x25a8ef(0x1ebc)]='',document[_0x25a8ef(0x1262)]('emoji-library-description-input')[_0x25a8ef(0x1ebc)]='',document[_0x25a8ef(0x1262)](_0x25a8ef(0xf1f))[_0x25a8ef(0x14eb)][_0x25a8ef(0x4da)]=_0x25a8ef(0x1fb7),currentEmojiLibrary=null;}function editEmojiLibrary(_0x30c820){const _0x1f47a6=_0x211817,_0x3b37be=emojiLibraries['find'](_0x415b1a=>_0x415b1a['id']===_0x30c820);if(!_0x3b37be)return;document[_0x1f47a6(0x1262)](_0x1f47a6(0x8f3))[_0x1f47a6(0x13be)]=_0x1f47a6(0x1550),document[_0x1f47a6(0x1262)]('emoji-library-name-input')[_0x1f47a6(0x1ebc)]=_0x3b37be[_0x1f47a6(0x1a1c)],document['getElementById'](_0x1f47a6(0x18ca))[_0x1f47a6(0x1ebc)]=_0x3b37be[_0x1f47a6(0x7c9)]||'',document[_0x1f47a6(0x1262)](_0x1f47a6(0xf1f))[_0x1f47a6(0x14eb)][_0x1f47a6(0x4da)]='flex',currentEmojiLibrary=_0x3b37be;}function hideEmojiLibraryForm(_0x135ca9){const _0x36ef40=_0x211817;if(_0x135ca9&&_0x135ca9[_0x36ef40(0x193d)]!==_0x135ca9[_0x36ef40(0x1fac)])return;document[_0x36ef40(0x1262)](_0x36ef40(0xf1f))[_0x36ef40(0x14eb)]['display']='none',currentEmojiLibrary=null;}async function saveEmojiLibrary(){const _0x4672b3=_0x211817,_0x186cc5=document['getElementById']('emoji-library-name-input')[_0x4672b3(0x1ebc)][_0x4672b3(0x19d7)](),_0x44f319=document['getElementById'](_0x4672b3(0x18ca))[_0x4672b3(0x1ebc)][_0x4672b3(0x19d7)]();if(!_0x186cc5){alert(_0x4672b3(0x495));return;}try{if(currentEmojiLibrary)currentEmojiLibrary[_0x4672b3(0x1a1c)]=_0x186cc5,currentEmojiLibrary[_0x4672b3(0x7c9)]=_0x44f319,currentEmojiLibrary[_0x4672b3(0x12e0)]=new Date()['toISOString'](),await db[_0x4672b3(0x159e)]['put'](currentEmojiLibrary);else{const _0x3b054f={'id':_0x4672b3(0x22ae)+Date[_0x4672b3(0x2eb)]()+'_'+Math[_0x4672b3(0x11a8)]()['toString'](0x24)[_0x4672b3(0x15fb)](0x2,0x9),'name':_0x186cc5,'description':_0x44f319,'createdAt':new Date()[_0x4672b3(0x1034)](),'updatedAt':new Date()[_0x4672b3(0x1034)]()};emojiLibraries[_0x4672b3(0x1cd6)](_0x3b054f),await db['emojiLibraries'][_0x4672b3(0x21e2)](_0x3b054f);}hideEmojiLibraryForm(),renderEmojiLibraryList(),showToast(currentEmojiLibrary?_0x4672b3(0xce9):'表情包库创建成功','success');}catch(_0x268c29){console[_0x4672b3(0x174a)]('保存表情包库失败:',_0x268c29),showToast('保存失败','error');}}async function deleteEmojiLibrary(_0x43a466){const _0x4f4c48=_0x211817,_0x36c7c3=emojiLibraries[_0x4f4c48(0xaf4)](_0x50f364=>_0x50f364['id']===_0x43a466);if(!_0x36c7c3)return;const _0x59d30e=await getEmojiLibraryItemCount(_0x43a466),_0x5b6732=_0x59d30e>0x0?_0x4f4c48(0x10f7)+_0x36c7c3[_0x4f4c48(0x1a1c)]+_0x4f4c48(0x69a)+_0x59d30e+_0x4f4c48(0x2162):_0x4f4c48(0x10f7)+_0x36c7c3[_0x4f4c48(0x1a1c)]+'\x22吗？';if(!confirm(_0x5b6732))return;try{await db[_0x4f4c48(0x529)][_0x4f4c48(0xa24)](_0x4f4c48(0x1bb3))[_0x4f4c48(0x1694)](_0x43a466)['delete'](),await db[_0x4f4c48(0x159e)][_0x4f4c48(0x1f4a)](_0x43a466),emojiLibraries=emojiLibraries[_0x4f4c48(0x1e1f)](_0x5f3f0e=>_0x5f3f0e['id']!==_0x43a466),renderEmojiLibraryList(),showToast('表情包库删除成功',_0x4f4c48(0x11cb));}catch(_0x20f162){console[_0x4f4c48(0x174a)](_0x4f4c48(0xef7),_0x20f162),showToast(_0x4f4c48(0xdc1),'error');}}async function openEmojiLibrary(_0x4906e8){const _0x74427e=_0x211817,_0x4b5750=emojiLibraries[_0x74427e(0xaf4)](_0x4807e3=>_0x4807e3['id']===_0x4906e8);if(!_0x4b5750)return;currentEmojiLibrary=_0x4b5750,document[_0x74427e(0x1262)](_0x74427e(0x21dd))[_0x74427e(0x13be)]=_0x4b5750[_0x74427e(0x1a1c)],showApp(_0x74427e(0x191e)),await loadEmojiLibraryContent(_0x4906e8);}async function loadEmojiLibraryContent(_0x449efa){const _0xba3a25=_0x211817;try{const _0x3cee21=await db[_0xba3a25(0x529)]['where'](_0xba3a25(0x1bb3))[_0xba3a25(0x1694)](_0x449efa)[_0xba3a25(0xf13)](),_0x466afe=_0x3cee21[_0xba3a25(0x6a4)](_0x49de09=>_0x49de09['emojiId']),_0x55f4d4=await db[_0xba3a25(0x223)][_0xba3a25(0xa24)]('id')['anyOf'](_0x466afe)[_0xba3a25(0xf13)]();renderEmojiLibraryGrid(_0x55f4d4);}catch(_0x3e29bd){console[_0xba3a25(0x174a)](_0xba3a25(0x1448),_0x3e29bd),showToast(_0xba3a25(0x1179),_0xba3a25(0x174a));}}function renderEmojiLibraryGrid(_0x4ccf1e){const _0x5f2631=_0x211817,_0x116816=document[_0x5f2631(0x1262)]('emoji-library-grid'),_0x4af8b1=document[_0x5f2631(0x1262)](_0x5f2631(0xac1)),_0x4562b7=document[_0x5f2631(0x1262)](_0x5f2631(0x153f));if(_0x4ccf1e[_0x5f2631(0x19ee)]===0x0){_0x116816['style'][_0x5f2631(0x4da)]=_0x5f2631(0x102b),_0x4af8b1['style']['display']=_0x5f2631(0x13de),_0x4562b7[_0x5f2631(0x14eb)][_0x5f2631(0x4da)]=_0x5f2631(0x102b);return;}_0x116816[_0x5f2631(0x14eb)][_0x5f2631(0x4da)]=_0x5f2631(0xc00),_0x4af8b1[_0x5f2631(0x14eb)]['display']=_0x5f2631(0x102b),_0x4562b7[_0x5f2631(0x14eb)]['display']='flex';const _0x202d19=_0x4ccf1e[_0x5f2631(0x19ee)],_0x381cac=_0x4ccf1e[_0x5f2631(0x1e1f)](_0x404005=>_0x404005[_0x5f2631(0x7c9)]&&_0x404005[_0x5f2631(0x7c9)]!==_0x404005[_0x5f2631(0x1a1c)]&&_0x404005[_0x5f2631(0x7c9)][_0x5f2631(0x19d7)]()!=='')[_0x5f2631(0x19ee)],_0x539403=_0x202d19-_0x381cac;document[_0x5f2631(0x1262)]('total-emojis')[_0x5f2631(0x13be)]=_0x202d19,document[_0x5f2631(0x1262)](_0x5f2631(0x170d))['textContent']=_0x381cac,document[_0x5f2631(0x1262)](_0x5f2631(0xad4))['textContent']=_0x539403;const _0x28804f=document[_0x5f2631(0x1262)](_0x5f2631(0x71e));_0x539403>0x0?_0x28804f['style'][_0x5f2631(0x4da)]=_0x5f2631(0x13de):_0x28804f[_0x5f2631(0x14eb)]['display']=_0x5f2631(0x102b),_0x116816[_0x5f2631(0x33a)]=_0x4ccf1e[_0x5f2631(0x6a4)](_0x4f5d69=>{const _0x1e4fe2=_0x5f2631,_0x59cea6=_0x4f5d69[_0x1e4fe2(0x7c9)]&&_0x4f5d69[_0x1e4fe2(0x7c9)]!==_0x4f5d69['name']&&_0x4f5d69[_0x1e4fe2(0x7c9)][_0x1e4fe2(0x19d7)]()!=='',_0x465e45=_0x59cea6?_0x4f5d69[_0x1e4fe2(0x7c9)]:_0x1e4fe2(0x634);return _0x1e4fe2(0x161b)+_0x4f5d69['id']+_0x1e4fe2(0x1064)+_0x4f5d69['id']+_0x1e4fe2(0x1788)+_0x4f5d69[_0x1e4fe2(0x40f)]+'\x22\x20alt=\x22'+_0x4f5d69[_0x1e4fe2(0x7c9)]+_0x1e4fe2(0x1db9)+_0x4f5d69[_0x1e4fe2(0x7c9)]+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-btn\x22\x20onclick=\x22removeEmojiFromLibrary(\x27'+_0x4f5d69['id']+_0x1e4fe2(0x11d8)+(!_0x59cea6?_0x1e4fe2(0x363):'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22editEmojiDescription(\x27'+_0x4f5d69['id']+_0x1e4fe2(0x1584)+_0x465e45+_0x1e4fe2(0x1cd)+(!_0x59cea6?_0x1e4fe2(0x1a2d):_0x1e4fe2(0x1d6b))+_0x1e4fe2(0x1c9b);})[_0x5f2631(0x122b)]('');}async function removeEmojiFromLibrary(_0x1527e5){const _0x56675d=_0x211817;if(!currentEmojiLibrary)return;if(!confirm(_0x56675d(0xfd7)))return;try{await db[_0x56675d(0x529)][_0x56675d(0xa24)](_0x56675d(0x1da6))[_0x56675d(0x1694)]([currentEmojiLibrary['id'],_0x1527e5])[_0x56675d(0x1f4a)](),await loadEmojiLibraryContent(currentEmojiLibrary['id']),showToast(_0x56675d(0x1b78),'success');}catch(_0x22bbe8){console[_0x56675d(0x174a)](_0x56675d(0x784),_0x22bbe8),showToast(_0x56675d(0x1b21),_0x56675d(0x174a));}}async function editEmojiDescription(_0x19be7a){const _0xf39a9=_0x211817,_0x365d3d=await db[_0xf39a9(0x223)][_0xf39a9(0xb78)](_0x19be7a);if(!_0x365d3d)return;const _0x19eaed=document['getElementById'](_0xf39a9(0x10cd));_0x19eaed&&_0x19eaed[_0xf39a9(0x1493)]();const _0x331c11=_0x365d3d[_0xf39a9(0x7c9)]&&_0x365d3d[_0xf39a9(0x7c9)]!==_0x365d3d['name']?_0x365d3d[_0xf39a9(0x7c9)]:'',_0x5d8562=document['createElement'](_0xf39a9(0xbbc));_0x5d8562['id']=_0xf39a9(0x10cd),_0x5d8562[_0xf39a9(0x1722)]=_0xf39a9(0x56e),_0x5d8562[_0xf39a9(0x14eb)][_0xf39a9(0x4da)]=_0xf39a9(0x1fb7),_0x5d8562['innerHTML']=_0xf39a9(0x22c1)+_0x365d3d[_0xf39a9(0x40f)]+_0xf39a9(0x8b9)+_0x331c11+_0xf39a9(0x1e5)+_0x19be7a+_0xf39a9(0x1c3a),document[_0xf39a9(0x1da9)][_0xf39a9(0x497)](_0x5d8562),setTimeout(()=>{const _0x2ba4e6=_0xf39a9,_0x429b4c=document[_0x2ba4e6(0x1262)](_0x2ba4e6(0x1a3f));_0x429b4c&&(_0x429b4c['focus'](),_0x429b4c[_0x2ba4e6(0x207)](_0x429b4c['value']['length'],_0x429b4c[_0x2ba4e6(0x1ebc)][_0x2ba4e6(0x19ee)]));},0x64);}function closeEmojiDescriptionModal(){const _0x3fa1e2=_0x211817,_0x1e031a=document[_0x3fa1e2(0x1262)](_0x3fa1e2(0x10cd));_0x1e031a&&_0x1e031a[_0x3fa1e2(0x1493)]();}async function saveEmojiDescription(_0x1b0f5a){const _0x491843=_0x211817,_0x4e7846=document['getElementById']('emoji-description-input');if(!_0x4e7846){console['error'](_0x491843(0xc6b)),showToast(_0x491843(0x1b4a),_0x491843(0x174a));return;}const _0x95e6e2=_0x4e7846[_0x491843(0x1ebc)][_0x491843(0x19d7)]();if(!_0x95e6e2){alert(_0x491843(0x1cfb));return;}try{const _0x626bc5=await db['customEmojis'][_0x491843(0xb78)](_0x1b0f5a);if(_0x626bc5){_0x626bc5['description']=_0x95e6e2;if(_0x626bc5['isPersonal']!==![]){const _0x10f2eb=customEmojis[_0x491843(0xaf4)](_0x569b86=>_0x569b86['id']===_0x1b0f5a);_0x10f2eb&&(_0x10f2eb[_0x491843(0x7c9)]=_0x95e6e2);}await db[_0x491843(0x223)][_0x491843(0x1561)](_0x626bc5),currentEmojiLibrary&&await loadEmojiLibraryContent(currentEmojiLibrary['id']),showToast(_0x491843(0xd34),'success'),closeEmojiDescriptionModal();}else showToast(_0x491843(0x221b),_0x491843(0x174a));}catch(_0x3ee6c1){console[_0x491843(0x174a)](_0x491843(0x1bfe),_0x3ee6c1),showToast(_0x491843(0x1103),_0x491843(0x174a));}}function hideEmojiLibraryScreen(){const _0x19fb9b=_0x211817;hideApp(_0x19fb9b(0x191e)),currentEmojiLibrary=null,showApp('chat-screen'),switchChatTab(_0x19fb9b(0xedf));}function triggerEmojiUpload(){const _0x2bba7c=_0x211817;document['getElementById'](_0x2bba7c(0x145b))[_0x2bba7c(0x1859)]();}async function deleteCurrentEmojiLibrary(){const _0x4bff9c=_0x211817;if(!currentEmojiLibrary)return;if(confirm(_0x4bff9c(0x10f7)+currentEmojiLibrary[_0x4bff9c(0x1a1c)]+_0x4bff9c(0xd3d)))try{await db[_0x4bff9c(0x529)][_0x4bff9c(0xa24)](_0x4bff9c(0x1bb3))[_0x4bff9c(0x1694)](currentEmojiLibrary['id'])[_0x4bff9c(0x1f4a)](),await db[_0x4bff9c(0x159e)][_0x4bff9c(0x1f4a)](currentEmojiLibrary['id']),showToast(_0x4bff9c(0x32f),_0x4bff9c(0x11cb)),showEmojiLibraryList();}catch(_0x47952){console[_0x4bff9c(0x174a)](_0x4bff9c(0xef7),_0x47952),showToast(_0x4bff9c(0xdc1),_0x4bff9c(0x174a));}}function initEmojiLibraryUpload(){const _0x555e3c=_0x211817,_0x577509=document['getElementById']('emoji-library-upload'),_0x36af2f=document[_0x555e3c(0x1262)]('emoji-library-upload-area');_0x577509&&_0x577509[_0x555e3c(0x21e9)](_0x555e3c(0x5af),handleEmojiLibraryUpload),_0x36af2f&&(_0x36af2f[_0x555e3c(0x21e9)]('dragover',_0x48ac12=>{const _0x7062ca=_0x555e3c;_0x48ac12[_0x7062ca(0x36f)](),_0x36af2f[_0x7062ca(0x1c1b)][_0x7062ca(0x21e2)]('dragover');}),_0x36af2f['addEventListener'](_0x555e3c(0xe19),_0x4adf29=>{const _0x40baaa=_0x555e3c;_0x4adf29[_0x40baaa(0x36f)](),_0x36af2f[_0x40baaa(0x1c1b)][_0x40baaa(0x1493)]('dragover');}),_0x36af2f[_0x555e3c(0x21e9)](_0x555e3c(0x2307),_0x49e984=>{const _0x2e5828=_0x555e3c;_0x49e984[_0x2e5828(0x36f)](),_0x36af2f['classList'][_0x2e5828(0x1493)](_0x2e5828(0xfdd));const _0x161f08=Array[_0x2e5828(0x13c0)](_0x49e984[_0x2e5828(0x118f)][_0x2e5828(0xf26)])[_0x2e5828(0x1e1f)](_0x5c39a4=>_0x5c39a4['type'][_0x2e5828(0x1b30)](_0x2e5828(0x1d60)));_0x161f08[_0x2e5828(0x19ee)]>0x0&&processEmojiFiles(_0x161f08);}));}async function handleEmojiLibraryUpload(_0x433530){const _0x18a951=_0x211817,_0x2d6e2e=Array[_0x18a951(0x13c0)](_0x433530[_0x18a951(0x193d)]['files']);if(_0x2d6e2e['length']===0x0)return;await processEmojiFiles(_0x2d6e2e),_0x433530[_0x18a951(0x193d)]['value']='';}async function processEmojiFiles(_0x389060){const _0xa6d7fb=_0x211817;if(!currentEmojiLibrary){showToast(_0xa6d7fb(0x6ec),_0xa6d7fb(0x174a));return;}const _0x38b0c8=_0x389060[_0xa6d7fb(0x1e1f)](_0x28b20d=>_0x28b20d[_0xa6d7fb(0x1a4b)][_0xa6d7fb(0x1b30)](_0xa6d7fb(0x1d60)));if(_0x38b0c8[_0xa6d7fb(0x19ee)]===0x0){showToast('请选择有效的图片文件',_0xa6d7fb(0x174a));return;}let _0x2a7574=0x0,_0x3122c6=0x0;for(const _0x17cf5e of _0x38b0c8){try{await uploadEmojiToLibrary(_0x17cf5e),_0x2a7574++;}catch(_0x3c8760){console[_0xa6d7fb(0x174a)]('上传表情包失败:',_0x3c8760),_0x3122c6++;}}_0x2a7574>0x0&&(showToast('成功上传\x20'+_0x2a7574+'\x20个表情包','success'),await loadEmojiLibraryContent(currentEmojiLibrary['id'])),_0x3122c6>0x0&&showToast(_0x3122c6+'\x20个文件上传失败',_0xa6d7fb(0x174a));}async function uploadEmojiToLibrary(_0x3038e9){return new Promise((_0x5918b6,_0x52c086)=>{const _0x1c5329=_0x167f,_0x5b8116=new FileReader();_0x5b8116[_0x1c5329(0xc55)]=async _0x4dc880=>{const _0x574355=_0x1c5329;try{const _0x23e225=_0x4dc880[_0x574355(0x193d)][_0x574355(0x4ee)],_0xbbcbbc={'id':_0x574355(0x1cb8)+Date['now']()+'_'+Math[_0x574355(0x11a8)]()[_0x574355(0x1878)](0x24)[_0x574355(0x15fb)](0x2,0x9),'name':_0x3038e9[_0x574355(0x1a1c)][_0x574355(0x204b)]('.')[0x0],'description':'','url':_0x23e225,'category':_0x574355(0x2b0),'uploadTime':new Date()[_0x574355(0x1034)](),'isPersonal':![]};await db[_0x574355(0x223)][_0x574355(0x21e2)](_0xbbcbbc);const _0x544eae={'libraryId':currentEmojiLibrary['id'],'emojiId':_0xbbcbbc['id'],'addedAt':new Date()[_0x574355(0x1034)]()};await db[_0x574355(0x529)]['add'](_0x544eae),_0x5918b6(_0xbbcbbc);}catch(_0x30ecef){_0x52c086(_0x30ecef);}},_0x5b8116['onerror']=()=>_0x52c086(new Error(_0x1c5329(0x8cc))),_0x5b8116['readAsDataURL'](_0x3038e9);});}function showEmojiLibraryMountSettings(){const _0x4347ef=_0x211817;console[_0x4347ef(0x2187)](_0x4347ef(0x1bde));if(!currentChatCharacter){console[_0x4347ef(0x2187)](_0x4347ef(0x11c8));return;}const _0x20dd27=getCurrentChatSettings();console['log'](_0x4347ef(0x16a2),_0x20dd27),document['getElementById'](_0x4347ef(0x1969))['checked']=_0x20dd27['emojiLibraryMountEnabled']||![],renderEmojiLibraryMountList(),toggleEmojiLibraryMountDetails(),console['log'](_0x4347ef(0x101f)),showModal('emoji-library-mount-modal'),console[_0x4347ef(0x2187)](_0x4347ef(0xa3b));}function toggleEmojiLibraryMountDetails(){const _0x50a50e=_0x211817,_0x4b12d6=document[_0x50a50e(0x1262)](_0x50a50e(0x1969))[_0x50a50e(0x14c1)];document[_0x50a50e(0x1262)]('emoji-library-mount-details')[_0x50a50e(0x14eb)]['display']=_0x4b12d6?_0x50a50e(0x13de):_0x50a50e(0x102b),updateEmojiLibraryMountDisplay();}function renderEmojiLibraryMountList(){const _0x4a4f02=_0x211817,_0x1a5514=document['getElementById'](_0x4a4f02(0x1ff1));if(!_0x1a5514)return;if(emojiLibraries[_0x4a4f02(0x19ee)]===0x0){_0x1a5514[_0x4a4f02(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>请先在\x22我\x22页面创建表情包库</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0x2db052=getCurrentChatSettings(),_0x57e78c=_0x2db052[_0x4a4f02(0x56c)]||[];_0x1a5514[_0x4a4f02(0x33a)]=emojiLibraries[_0x4a4f02(0x6a4)](_0x1fe53c=>_0x4a4f02(0x1fde)+_0x1fe53c['id']+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x57e78c[_0x4a4f02(0x1831)](_0x1fe53c['id'])?'checked':'')+_0x4a4f02(0x1310)+_0x1fe53c[_0x4a4f02(0x1a1c)]+_0x4a4f02(0x2156)+(_0x1fe53c[_0x4a4f02(0x7c9)]||_0x4a4f02(0x1e96))+_0x4a4f02(0xd8e))['join']('');}function updateEmojiLibraryMountDisplay(){const _0xe74367=_0x211817,_0x3071e5=document[_0xe74367(0x1262)](_0xe74367(0x17da));if(!_0x3071e5)return;const _0x50dcbf=getCurrentChatSettings(),_0x399f50=_0x50dcbf[_0xe74367(0x20d5)]||![],_0x3c5d6d=_0x50dcbf[_0xe74367(0x56c)]||[];if(!_0x399f50){_0x3071e5[_0xe74367(0x13be)]=_0xe74367(0x604),_0x3071e5[_0xe74367(0x14eb)]['color']=_0xe74367(0x90c);return;}if(_0x3c5d6d['length']===0x0){_0x3071e5[_0xe74367(0x13be)]=_0xe74367(0x132d),_0x3071e5['style'][_0xe74367(0xc3d)]=_0xe74367(0x202e);return;}const _0x429d2b=_0x3c5d6d[_0xe74367(0x6a4)](_0x58cb84=>{const _0x270914=_0xe74367,_0x544f94=emojiLibraries[_0x270914(0xaf4)](_0x43f600=>_0x43f600['id']===_0x58cb84);return _0x544f94?_0x544f94[_0x270914(0x1a1c)]:'未知库';});_0x429d2b[_0xe74367(0x19ee)]===0x1?_0x3071e5[_0xe74367(0x13be)]=_0x429d2b[0x0]:_0x3071e5[_0xe74367(0x13be)]=_0x429d2b['length']+'个库',_0x3071e5[_0xe74367(0x14eb)]['color']='';}async function saveEmojiLibraryMountSettings(){const _0x341b8c=_0x211817;if(!currentChatCharacter)return;const _0x14c1bb=getCurrentChatSettings();_0x14c1bb[_0x341b8c(0x20d5)]=document[_0x341b8c(0x1262)](_0x341b8c(0x1969))[_0x341b8c(0x14c1)];const _0x4ae48a=document[_0x341b8c(0x1897)]('#emoji-library-mount-list\x20input[type=\x22checkbox\x22]:checked');_0x14c1bb[_0x341b8c(0x56c)]=Array[_0x341b8c(0x13c0)](_0x4ae48a)['map'](_0x4f6ca6=>_0x4f6ca6[_0x341b8c(0x1ebc)]),await saveCurrentChatSettings(_0x14c1bb),updateEmojiLibraryMountDisplay(),hideModal('emoji-library-mount-modal');const _0x2fdc19=_0x14c1bb[_0x341b8c(0x56c)]?_0x14c1bb[_0x341b8c(0x56c)][_0x341b8c(0x19ee)]:0x0;if(_0x14c1bb[_0x341b8c(0x20d5)]&&_0x2fdc19>0x0)showToast(_0x341b8c(0x142f)+_0x2fdc19+'\x20个库',_0x341b8c(0x11cb)),document[_0x341b8c(0x1262)](_0x341b8c(0x95c))[_0x341b8c(0x14eb)]['display']!==_0x341b8c(0x102b)&&loadCustomEmojis();else _0x14c1bb[_0x341b8c(0x20d5)]?showToast(_0x341b8c(0x17c7),_0x341b8c(0x477)):showToast(_0x341b8c(0x5f2),_0x341b8c(0x477));}async function getFilteredEmojis(_0x2abe22){const _0x97a20b=_0x211817;return _0x2abe22[_0x97a20b(0x1e1f)](_0x1b827b=>_0x1b827b['isPersonal']!==![]);}async function cleanupEmojiLibraryItems(){const _0x489aa8=_0x211817;try{console[_0x489aa8(0x2187)](_0x489aa8(0x1181));const _0x48cce2=await db[_0x489aa8(0x529)][_0x489aa8(0xf13)]();console['log'](_0x489aa8(0xfad),_0x48cce2[_0x489aa8(0x19ee)]);const _0x37acbc=[];for(const _0x17a4f3 of _0x48cce2){const _0x34c52a=await db[_0x489aa8(0x223)]['get'](_0x17a4f3[_0x489aa8(0x1c4a)]);!_0x34c52a&&_0x37acbc['push'](_0x17a4f3);}console['log'](_0x489aa8(0x3e9),_0x37acbc[_0x489aa8(0x19ee)]);if(_0x37acbc[_0x489aa8(0x19ee)]>0x0){const _0x1c85ad=_0x37acbc[_0x489aa8(0x6a4)](_0x291304=>_0x291304['id']);await db[_0x489aa8(0x529)][_0x489aa8(0x1aaa)](_0x1c85ad),console['log'](_0x489aa8(0x1903),_0x1c85ad);}return _0x37acbc[_0x489aa8(0x19ee)];}catch(_0x39404f){return console[_0x489aa8(0x174a)](_0x489aa8(0x19ed),_0x39404f),0x0;}}async function getMountedEmojiLibraryEmojis(){const _0x1e2bcc=_0x211817;try{const _0x1f34c6=getCurrentChatSettings();if(!_0x1f34c6[_0x1e2bcc(0x20d5)]||!_0x1f34c6['selectedEmojiLibraries']||_0x1f34c6[_0x1e2bcc(0x56c)]['length']===0x0)return customEmojis;await cleanupEmojiLibraryItems();const _0xa4b7fd=[];for(const _0x44394f of _0x1f34c6[_0x1e2bcc(0x56c)]){const _0x448bc9=await db[_0x1e2bcc(0x529)][_0x1e2bcc(0xa24)](_0x1e2bcc(0x1bb3))[_0x1e2bcc(0x1694)](_0x44394f)[_0x1e2bcc(0xf13)](),_0x300460=_0x448bc9['map'](_0x26a2df=>_0x26a2df[_0x1e2bcc(0x1c4a)]),_0x80ea23=await db['customEmojis'][_0x1e2bcc(0xa24)]('id')[_0x1e2bcc(0x1fa1)](_0x300460)[_0x1e2bcc(0xf13)]();_0xa4b7fd[_0x1e2bcc(0x1cd6)](..._0x80ea23);}return _0xa4b7fd;}catch(_0x26a975){return console['error'](_0x1e2bcc(0x1fdc),_0x26a975),customEmojis;}}async function findEmojiForAI(_0x2d5cc1){const _0x3befae=_0x211817;try{const _0x46d5b8=getCurrentChatSettings();if(_0x46d5b8[_0x3befae(0x20d5)]&&_0x46d5b8[_0x3befae(0x56c)]&&_0x46d5b8['selectedEmojiLibraries']['length']>0x0){for(const _0x3341ac of _0x46d5b8['selectedEmojiLibraries']){const _0xc84b35=await db['emojiLibraryItems']['where'](_0x3befae(0x1bb3))[_0x3befae(0x1694)](_0x3341ac)[_0x3befae(0xf13)](),_0x287bf3=_0xc84b35[_0x3befae(0x6a4)](_0x3304f7=>_0x3304f7[_0x3befae(0x1c4a)]),_0x3b5bdf=await db[_0x3befae(0x223)][_0x3befae(0xa24)]('id')[_0x3befae(0x1fa1)](_0x287bf3)[_0x3befae(0xf13)]();let _0x267435=_0x3b5bdf[_0x3befae(0xaf4)](_0x335e0f=>_0x335e0f[_0x3befae(0x7c9)]===_0x2d5cc1);!_0x267435&&(_0x267435=_0x3b5bdf['find'](_0xe77bd=>_0xe77bd['description']?.['trim']()===_0x2d5cc1?.[_0x3befae(0x19d7)]()));!_0x267435&&(_0x267435=_0x3b5bdf[_0x3befae(0xaf4)](_0x4715da=>_0x4715da['description']?.['toLowerCase']()[_0x3befae(0x19d7)]()===_0x2d5cc1?.['toLowerCase']()['trim']()));if(_0x267435)return _0x267435;}return null;}else return customEmojis[_0x3befae(0xaf4)](_0x3955b4=>_0x3955b4[_0x3befae(0x7c9)]===_0x2d5cc1);}catch(_0x353ef0){return console['error'](_0x3befae(0x14ce),_0x353ef0),customEmojis[_0x3befae(0xaf4)](_0x5069d7=>_0x5069d7[_0x3befae(0x7c9)]===_0x2d5cc1);}}function isLightColor(_0x3fb60b){const _0xda5e39=_0x211817;let _0x29ddad,_0x3d7173,_0x33564f;if(_0x3fb60b[_0xda5e39(0x1b30)]('#')){const _0x53f617=_0x3fb60b[_0xda5e39(0x6d5)](0x1);_0x53f617[_0xda5e39(0x19ee)]===0x3?(_0x29ddad=parseInt(_0x53f617[0x0]+_0x53f617[0x0],0x10),_0x3d7173=parseInt(_0x53f617[0x1]+_0x53f617[0x1],0x10),_0x33564f=parseInt(_0x53f617[0x2]+_0x53f617[0x2],0x10)):(_0x29ddad=parseInt(_0x53f617[_0xda5e39(0x15fb)](0x0,0x2),0x10),_0x3d7173=parseInt(_0x53f617['substr'](0x2,0x2),0x10),_0x33564f=parseInt(_0x53f617['substr'](0x4,0x2),0x10));}else{if(_0x3fb60b['startsWith']('rgb')){const _0x798277=_0x3fb60b['match'](/\d+/g);_0x798277&&_0x798277[_0xda5e39(0x19ee)]>=0x3&&(_0x29ddad=parseInt(_0x798277[0x0]),_0x3d7173=parseInt(_0x798277[0x1]),_0x33564f=parseInt(_0x798277[0x2]));}else return![];}const _0x142dbc=(_0x29ddad*0x12b+_0x3d7173*0x24b+_0x33564f*0x72)/0x3e8;return _0x142dbc>0x80;}function updateBubblePreview(){const _0x1f958d=_0x211817,_0x1e6dde=document[_0x1f958d(0x1262)](_0x1f958d(0x958))?.[_0x1f958d(0x1ebc)]||_0x1f958d(0xa44),_0x508f98=document[_0x1f958d(0x1262)](_0x1f958d(0xe7f))?.[_0x1f958d(0x1ebc)]||_0x1f958d(0x7ae),_0x5a988b=document[_0x1f958d(0x1262)]('my-bubble-opacity')?.[_0x1f958d(0x1ebc)]||'1',_0x5b94c7=document[_0x1f958d(0x1262)]('ai-bubble-opacity')?.[_0x1f958d(0x1ebc)]||'1',_0x2d8727=document[_0x1f958d(0x1262)](_0x1f958d(0xdb1)),_0x537263=document[_0x1f958d(0x1262)](_0x1f958d(0xa98));if(_0x2d8727){const _0x38bea7=convertColorWithOpacity(_0x1e6dde,_0x5a988b);_0x2d8727[_0x1f958d(0x14eb)][_0x1f958d(0x577)]=_0x38bea7,_0x2d8727[_0x1f958d(0x14eb)][_0x1f958d(0xc3d)]=isLightColor(_0x1e6dde)?_0x1f958d(0x22d0):_0x1f958d(0x1a7);}if(_0x537263){const _0x4fd65a=convertColorWithOpacity(_0x508f98,_0x5b94c7);_0x537263[_0x1f958d(0x14eb)][_0x1f958d(0x577)]=_0x4fd65a,_0x537263['style'][_0x1f958d(0xc3d)]=isLightColor(_0x508f98)?_0x1f958d(0x22d0):_0x1f958d(0x1a7);}const _0x21ec8f=document[_0x1f958d(0x1262)](_0x1f958d(0x7d3)),_0x49936c=document[_0x1f958d(0x1262)]('ai-bubble-preview');if(_0x21ec8f){const _0x3542e4=convertColorWithOpacity(_0x1e6dde,_0x5a988b);_0x21ec8f[_0x1f958d(0x14eb)][_0x1f958d(0x577)]=_0x3542e4,_0x21ec8f[_0x1f958d(0x13be)]=_0x1f958d(0x1a69);}if(_0x49936c){const _0x5995bc=convertColorWithOpacity(_0x508f98,_0x5b94c7);_0x49936c[_0x1f958d(0x14eb)][_0x1f958d(0x577)]=_0x5995bc,_0x49936c[_0x1f958d(0x13be)]='对方气泡';}}function bindAvatarUploadEvents(){const _0x19f223=_0x211817,_0x4a72f7=document[_0x19f223(0x1262)](_0x19f223(0x41c));_0x4a72f7&&(_0x4a72f7[_0x19f223(0x1980)]=function(_0x57be7e){const _0x5c196d=_0x19f223;if(_0x57be7e[_0x5c196d(0x193d)][_0x5c196d(0xf26)]&&_0x57be7e[_0x5c196d(0x193d)][_0x5c196d(0xf26)][0x0]){const _0x181723=new FileReader();_0x181723[_0x5c196d(0xc55)]=function(_0x15e09c){const _0x4d8d6d=_0x5c196d,_0xb27d2b=document['getElementById'](_0x4d8d6d(0x1445));_0xb27d2b&&(_0xb27d2b[_0x4d8d6d(0x14eb)][_0x4d8d6d(0x159c)]=_0x4d8d6d(0x9f1)+_0x15e09c['target'][_0x4d8d6d(0x4ee)]+')',_0xb27d2b['style']['backgroundSize']=_0x4d8d6d(0x12bb),_0xb27d2b[_0x4d8d6d(0x14eb)][_0x4d8d6d(0x1530)]=_0x4d8d6d(0xcef),_0xb27d2b[_0x4d8d6d(0x33a)]='',window[_0x4d8d6d(0x13a8)]=_0x15e09c['target'][_0x4d8d6d(0x4ee)]);},_0x181723[_0x5c196d(0x127c)](_0x57be7e[_0x5c196d(0x193d)]['files'][0x0]);}});const _0x16beec=document[_0x19f223(0x1262)](_0x19f223(0x18eb));_0x16beec&&(_0x16beec[_0x19f223(0x1980)]=function(_0x1783e2){const _0x483418=_0x19f223;if(_0x1783e2[_0x483418(0x193d)][_0x483418(0xf26)]&&_0x1783e2[_0x483418(0x193d)][_0x483418(0xf26)][0x0]){const _0x40d42e=new FileReader();_0x40d42e[_0x483418(0xc55)]=function(_0x5fda55){const _0x327572=_0x483418,_0x5d46d4=document[_0x327572(0x1262)](_0x327572(0x1f2d));_0x5d46d4&&(_0x5d46d4['style']['backgroundImage']='url('+_0x5fda55[_0x327572(0x193d)]['result']+')',_0x5d46d4[_0x327572(0x14eb)]['backgroundSize']=_0x327572(0x12bb),_0x5d46d4[_0x327572(0x14eb)][_0x327572(0x1530)]=_0x327572(0xcef),_0x5d46d4[_0x327572(0x33a)]='',window[_0x327572(0xf1d)]=_0x5fda55[_0x327572(0x193d)][_0x327572(0x4ee)]);},_0x40d42e[_0x483418(0x127c)](_0x1783e2[_0x483418(0x193d)][_0x483418(0xf26)][0x0]);}});}function initializeAvatarUpload(){const _0x41b29c=_0x211817,_0x132858=document['getElementById'](_0x41b29c(0xf6d));if(!_0x132858){console[_0x41b29c(0x174a)](_0x41b29c(0xe35));return;}_0x132858[_0x41b29c(0xa21)]('change',avatarUploadHandler),_0x132858['addEventListener'](_0x41b29c(0x5af),avatarUploadHandler),console[_0x41b29c(0x2187)]('头像上传事件监听器已绑定');}async function updateChatSettingsDisplay(){const _0x44ba85=_0x211817;if(!currentChatCharacter){console['log']('更新聊天设置界面显示：无当前聊天角色，跳过操作');return;}const _0x12c6b0=await getAsyncChatSettings(),_0xa0afab=document['getElementById'](_0x44ba85(0xb8f));if(_0xa0afab){const _0x1ecea9=currentChatCharacter[_0x44ba85(0x1f68)];_0xa0afab['style'][_0x44ba85(0x4da)]=_0x1ecea9?_0x44ba85(0x102b):_0x44ba85(0x13de);}const _0x2160e3=document['getElementById']('current-history-count');_0x2160e3&&(_0x2160e3['textContent']=_0x12c6b0['historyCount']+'回合');const _0x136ba4=document['getElementById'](_0x44ba85(0xc5b));_0x136ba4&&(_0x136ba4[_0x44ba85(0x13be)]=_0x12c6b0['memoryMountEnabled']?_0x44ba85(0x10a0):_0x44ba85(0x1c47));updateWorldbookMountDisplay(),updateEmojiLibraryMountDisplay();const _0x2808e6=document['getElementById'](_0x44ba85(0x1641));_0x2808e6&&(_0x2808e6[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0xb96)]);const _0x226d86=document[_0x44ba85(0x1262)](_0x44ba85(0x34e));_0x226d86&&(_0x226d86[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0x1f45)]);const _0x485a7d=document['getElementById'](_0x44ba85(0x374));_0x485a7d&&(_0x485a7d[_0x44ba85(0x14c1)]=_0x12c6b0['aiHeartrateEnabled']);const _0x5f2ebd=document[_0x44ba85(0x1262)](_0x44ba85(0x1faf));if(_0x5f2ebd){_0x5f2ebd[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0x22aa)]||![];const _0x118728=document['getElementById']('status-frequency-setting');_0x118728&&(_0x118728['style']['display']=_0x12c6b0[_0x44ba85(0x22aa)]?'flex':_0x44ba85(0x102b));}const _0x548cea=document[_0x44ba85(0x1262)](_0x44ba85(0xb59));if(_0x548cea){const _0x3fe0a1=localStorage['getItem'](_0x44ba85(0xf17))||'medium';_0x548cea[_0x44ba85(0x1ebc)]=_0x3fe0a1;}const _0x2a4803=document['getElementById'](_0x44ba85(0xe27));if(_0x2a4803){_0x2a4803['checked']=_0x12c6b0['backgroundInteractionEnabled'];const _0x302aaa=document['getElementById'](_0x44ba85(0x43d));_0x302aaa&&(_0x302aaa[_0x44ba85(0x14eb)][_0x44ba85(0x4da)]=_0x12c6b0[_0x44ba85(0x4f2)]?'block':_0x44ba85(0x102b));}const _0x3320c0=document['getElementById'](_0x44ba85(0x345));_0x3320c0&&(_0x3320c0['value']=_0x12c6b0[_0x44ba85(0xd8d)]||_0x44ba85(0x113f));const _0x3d2a72=document[_0x44ba85(0x1262)](_0x44ba85(0x726));if(_0x3d2a72){_0x3d2a72[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0x2ac)]===!![];const _0x1970bd=document[_0x44ba85(0x1262)](_0x44ba85(0xd6f));_0x1970bd&&(_0x1970bd['style'][_0x44ba85(0x4da)]=_0x12c6b0['backgroundInteractionEnabled']===!![]&&_0x12c6b0[_0x44ba85(0x2ac)]===!![]?_0x44ba85(0x13de):_0x44ba85(0x102b));}const _0x30e8e4=document['getElementById']('background-moments-enabled');if(_0x30e8e4){_0x30e8e4[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0x354)]===!![];const _0x5370f2=_0x12c6b0[_0x44ba85(0x4f2)]===!![]&&_0x12c6b0[_0x44ba85(0x354)]===!![],_0x1d12ea=document[_0x44ba85(0x1262)]('moments-frequency-setting'),_0x180d0c=document[_0x44ba85(0x1262)](_0x44ba85(0x1a25)),_0x306aa7=document[_0x44ba85(0x1262)]('test-publish-setting');_0x1d12ea&&(_0x1d12ea['style'][_0x44ba85(0x4da)]=_0x5370f2?_0x44ba85(0x1fb7):_0x44ba85(0x102b)),_0x180d0c&&(_0x180d0c[_0x44ba85(0x14eb)]['display']=_0x5370f2?_0x44ba85(0x1fb7):_0x44ba85(0x102b)),_0x306aa7&&(_0x306aa7[_0x44ba85(0x14eb)]['display']=_0x5370f2?_0x44ba85(0x1fb7):'none');}const _0xcef2ce=document['getElementById'](_0x44ba85(0x1ff6));_0xcef2ce&&(_0xcef2ce[_0x44ba85(0x1ebc)]=_0x12c6b0['backgroundMomentsFrequency']||_0x44ba85(0x113f));const _0x29fb1c=document[_0x44ba85(0x1262)](_0x44ba85(0x1ed6));if(_0x29fb1c){_0x29fb1c[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0x1d5f)]||![];const _0x47099c=document[_0x44ba85(0xb30)](_0x44ba85(0x1537));_0x47099c&&(_0x47099c[_0x44ba85(0x14eb)]['display']=_0x12c6b0[_0x44ba85(0x1d5f)]?_0x44ba85(0xae7):_0x44ba85(0x102b));}updateScheduleTimesDisplay();const _0xba8e3=document[_0x44ba85(0x1262)](_0x44ba85(0x15a3));if(_0xba8e3){_0xba8e3[_0x44ba85(0x14c1)]=_0x12c6b0[_0x44ba85(0xe72)]===!![];const _0x463575=document[_0x44ba85(0x1262)](_0x44ba85(0x14f8));if(_0x463575){const _0x28fd53=_0x12c6b0[_0x44ba85(0x4f2)]===!![]&&_0x12c6b0[_0x44ba85(0xe72)]===!![];_0x463575['style'][_0x44ba85(0x4da)]=_0x28fd53?'flex':_0x44ba85(0x102b);}}const _0x181079=document['getElementById'](_0x44ba85(0x1cd8));_0x181079&&(_0x181079[_0x44ba85(0x1ebc)]=_0x12c6b0[_0x44ba85(0x1927)]||'',console[_0x44ba85(0x2187)](_0x44ba85(0xadd)+(_0x12c6b0[_0x44ba85(0x1927)]||'未设置')));const _0x4fdabb=document[_0x44ba85(0x1262)]('timestamp-enabled');if(_0x4fdabb){const _0x258500=_0x12c6b0[_0x44ba85(0x17eb)]!==![];_0x4fdabb[_0x44ba85(0x14c1)]=_0x258500,console['log'](_0x44ba85(0x1b23),_0x258500);}bindChatSettingsEvents();}function bindChatSettingsEvents(){const _0x3f701c=_0x211817,_0x2f9733=document[_0x3f701c(0x1262)](_0x3f701c(0x1641));_0x2f9733&&(_0x2f9733[_0x3f701c(0x1980)]=async function(){const _0x423ff6=_0x3f701c,_0x5ea65f=getCurrentChatSettings();_0x5ea65f[_0x423ff6(0xb96)]=this[_0x423ff6(0x14c1)],await saveCurrentChatSettings(_0x5ea65f);});const _0xf2159c=document[_0x3f701c(0x1262)](_0x3f701c(0x34e));_0xf2159c&&(_0xf2159c[_0x3f701c(0x1980)]=async function(){const _0xcf2262=_0x3f701c,_0x19d3a8=getCurrentChatSettings();_0x19d3a8['aiCallEnabled']=this['checked'],await saveCurrentChatSettings(_0x19d3a8),showToast(_0xcf2262(0x1ce0)+(this[_0xcf2262(0x14c1)]?'开启':'关闭'),_0xcf2262(0x11cb));});const _0x7e6c70=document[_0x3f701c(0x1262)](_0x3f701c(0x374));_0x7e6c70&&(_0x7e6c70['onchange']=async function(){const _0x5a4c63=_0x3f701c,_0x28c112=getCurrentChatSettings();_0x28c112['aiHeartrateEnabled']=this[_0x5a4c63(0x14c1)],await saveCurrentChatSettings(_0x28c112),currentChatCharacter&&updateAiHeartrate(),showToast(_0x5a4c63(0x108b)+(this[_0x5a4c63(0x14c1)]?'开启':'关闭'),_0x5a4c63(0x11cb));});const _0x585641=document[_0x3f701c(0x1262)]('background-interaction-enabled');_0x585641&&(_0x585641[_0x3f701c(0x1980)]=async function(){const _0x1abe28=_0x3f701c,_0x531690=getCurrentChatSettings();_0x531690['backgroundInteractionEnabled']=this[_0x1abe28(0x14c1)],await saveCurrentChatSettings(_0x531690);const _0x259d5c=document[_0x1abe28(0x1262)](_0x1abe28(0x43d));_0x259d5c&&(_0x259d5c[_0x1abe28(0x14eb)]['display']=this[_0x1abe28(0x14c1)]?_0x1abe28(0x13de):_0x1abe28(0x102b));if(!this['checked']){const _0x1bbea1=document['getElementById'](_0x1abe28(0xd6f)),_0x41395f=document['getElementById'](_0x1abe28(0xee5)),_0x18ba27=document['getElementById'](_0x1abe28(0x1a25)),_0x2a011d=document['getElementById'](_0x1abe28(0xce4));if(_0x1bbea1)_0x1bbea1[_0x1abe28(0x14eb)][_0x1abe28(0x4da)]=_0x1abe28(0x102b);if(_0x41395f)_0x41395f[_0x1abe28(0x14eb)][_0x1abe28(0x4da)]='none';if(_0x18ba27)_0x18ba27[_0x1abe28(0x14eb)]['display']=_0x1abe28(0x102b);if(_0x2a011d)_0x2a011d['style'][_0x1abe28(0x4da)]='none';}else{const _0x2d09b8=_0x531690['backgroundChatEnabled']===!![],_0x3d79d4=_0x531690['backgroundMomentsEnabled']===!![],_0x3796c2=document['getElementById'](_0x1abe28(0xd6f)),_0x5be266=document['getElementById'](_0x1abe28(0xee5)),_0x31610a=document[_0x1abe28(0x1262)](_0x1abe28(0x1a25)),_0x9d746=document[_0x1abe28(0x1262)]('test-publish-setting');if(_0x3796c2)_0x3796c2[_0x1abe28(0x14eb)][_0x1abe28(0x4da)]=_0x2d09b8?_0x1abe28(0x13de):_0x1abe28(0x102b);if(_0x5be266)_0x5be266[_0x1abe28(0x14eb)][_0x1abe28(0x4da)]=_0x3d79d4?'flex':'none';if(_0x31610a)_0x31610a[_0x1abe28(0x14eb)]['display']=_0x3d79d4?_0x1abe28(0x13de):'none';if(_0x9d746)_0x9d746[_0x1abe28(0x14eb)][_0x1abe28(0x4da)]=_0x3d79d4?_0x1abe28(0x1fb7):_0x1abe28(0x102b);}currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console[_0x1abe28(0x2187)](_0x1abe28(0x1347)+currentChatCharacter[_0x1abe28(0x1a1c)]+'\x20主动聊天定时器已重新设置'));});const _0x2b7ede=document[_0x3f701c(0x1262)]('background-chat-frequency');_0x2b7ede&&(_0x2b7ede[_0x3f701c(0x1980)]=async function(){const _0x3f5858=_0x3f701c,_0x5114d3=getCurrentChatSettings();_0x5114d3[_0x3f5858(0xd8d)]=this[_0x3f5858(0x1ebc)],await saveCurrentChatSettings(_0x5114d3);});const _0x576bd4=document[_0x3f701c(0x1262)](_0x3f701c(0x726));_0x576bd4&&(_0x576bd4[_0x3f701c(0x1980)]=async function(){const _0xb2d5d4=_0x3f701c,_0x508e45=getCurrentChatSettings();_0x508e45[_0xb2d5d4(0x2ac)]=this['checked'],await saveCurrentChatSettings(_0x508e45);const _0x5ef316=document[_0xb2d5d4(0x1262)](_0xb2d5d4(0xd6f));if(_0x5ef316){const _0x2cb277=_0x508e45[_0xb2d5d4(0x4f2)]===!![]&&this[_0xb2d5d4(0x14c1)];_0x5ef316[_0xb2d5d4(0x14eb)][_0xb2d5d4(0x4da)]=_0x2cb277?'block':_0xb2d5d4(0x102b);}currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console['log'](_0xb2d5d4(0x1347)+currentChatCharacter[_0xb2d5d4(0x1a1c)]+_0xb2d5d4(0x110f)));});const _0x52f370=document[_0x3f701c(0x1262)]('background-moments-enabled');_0x52f370&&(_0x52f370[_0x3f701c(0x1980)]=async function(){const _0x156819=_0x3f701c,_0x1cd486=getCurrentChatSettings();_0x1cd486[_0x156819(0x354)]=this[_0x156819(0x14c1)],await saveCurrentChatSettings(_0x1cd486);const _0x20bc20=document['getElementById'](_0x156819(0xee5)),_0x22a772=document[_0x156819(0x1262)](_0x156819(0x1a25)),_0x2b1b61=document['getElementById'](_0x156819(0xce4)),_0x5e2387=_0x1cd486['backgroundInteractionEnabled']===!![]&&this[_0x156819(0x14c1)];_0x20bc20&&(_0x20bc20[_0x156819(0x14eb)][_0x156819(0x4da)]=_0x5e2387?'flex':'none'),_0x22a772&&(_0x22a772[_0x156819(0x14eb)][_0x156819(0x4da)]=_0x5e2387?_0x156819(0x1fb7):'none'),_0x2b1b61&&(_0x2b1b61[_0x156819(0x14eb)][_0x156819(0x4da)]=_0x5e2387?_0x156819(0x1fb7):'none'),currentChatCharacter&&(await scheduleProactiveChatForCharacter(currentChatCharacter['id']),console[_0x156819(0x2187)](_0x156819(0x1347)+currentChatCharacter['name']+'\x20主动聊天定时器已重新设置'));});const _0x4419cc=document[_0x3f701c(0x1262)](_0x3f701c(0x1ff6));_0x4419cc&&(_0x4419cc[_0x3f701c(0x1980)]=async function(){const _0x19db28=_0x3f701c,_0x17a2f7=getCurrentChatSettings();_0x17a2f7['backgroundMomentsFrequency']=this[_0x19db28(0x1ebc)],await saveCurrentChatSettings(_0x17a2f7),await initGlobalBackgroundInteractionSystem();});const _0x2bdedc=document[_0x3f701c(0x1262)](_0x3f701c(0x1ed6));_0x2bdedc&&(_0x2bdedc['onchange']=async function(){const _0x13516e=_0x3f701c,_0x2681d8=getCurrentChatSettings();_0x2681d8['scheduledMomentsEnabled']=this[_0x13516e(0x14c1)],await saveCurrentChatSettings(_0x2681d8);const _0x2802ea=document['querySelector'](_0x13516e(0x1537));_0x2802ea&&(_0x2802ea[_0x13516e(0x14eb)][_0x13516e(0x4da)]=this[_0x13516e(0x14c1)]?_0x13516e(0xae7):_0x13516e(0x102b)),initScheduledMomentsSystem();});const _0x5210c2=document[_0x3f701c(0x1262)]('background-diary-enabled');_0x5210c2&&(_0x5210c2[_0x3f701c(0x1980)]=async function(){const _0x42674f=_0x3f701c,_0x396c60=getCurrentChatSettings();_0x396c60[_0x42674f(0xe72)]=this[_0x42674f(0x14c1)],await saveCurrentChatSettings(_0x396c60);const _0x59f75e=document[_0x42674f(0x1262)](_0x42674f(0x14f8));if(_0x59f75e){const _0x456553=_0x396c60['backgroundInteractionEnabled']===!![]&&this['checked'];_0x59f75e['style'][_0x42674f(0x4da)]=_0x456553?'flex':'none';}currentChatCharacter&&await initBackgroundDiarySystem(currentChatCharacter['id']),showToast(_0x42674f(0x121e)+(this[_0x42674f(0x14c1)]?'开启':'关闭'),'success');});const _0x108a2e=document[_0x3f701c(0x1262)](_0x3f701c(0x1f9a));_0x108a2e&&(_0x108a2e['onchange']=async function(){const _0x503583=_0x3f701c,_0x15de15=getCurrentChatSettings();_0x15de15[_0x503583(0x17eb)]=this['checked'],await saveCurrentChatSettings(_0x15de15),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),console[_0x503583(0x2187)](_0x503583(0xb5d),this[_0x503583(0x14c1)]);});const _0x581cd0=document[_0x3f701c(0x1262)](_0x3f701c(0x1faf));_0x581cd0?_0x581cd0['onchange']=async function(){const _0x49d325=_0x3f701c;console[_0x49d325(0x2187)](_0x49d325(0xc65),this['checked']);const _0x4fdcf2=getCurrentChatSettings();_0x4fdcf2[_0x49d325(0x22aa)]=this['checked'],await saveCurrentChatSettings(_0x4fdcf2);const _0x121b94=document[_0x49d325(0x1262)](_0x49d325(0xc4f));_0x121b94&&(_0x121b94[_0x49d325(0x14eb)][_0x49d325(0x4da)]=this[_0x49d325(0x14c1)]?_0x49d325(0x1fb7):_0x49d325(0x102b));if(currentChatCharacter){renderChatMessages(currentChatCharacter['id']);const _0xadf6ce=document[_0x49d325(0xb30)](_0x49d325(0xb15));_0xadf6ce&&renderCharacterStatus(currentChatCharacter['id'],_0xadf6ce);}restartCharacterStatusTimer(),showToast(_0x49d325(0x71f)+(this[_0x49d325(0x14c1)]?'开启':'关闭'),_0x49d325(0x11cb));}:console[_0x3f701c(0x1f43)](_0x3f701c(0x22ad));const _0x283f55=document[_0x3f701c(0x1262)]('status-update-frequency');_0x283f55&&(_0x283f55[_0x3f701c(0x1980)]=async function(){const _0xc330d=_0x3f701c;localStorage[_0xc330d(0x192)]('globalStatusUpdateFrequency',this[_0xc330d(0x1ebc)]);const _0x45e914=getCurrentChatSettings();_0x45e914[_0xc330d(0x1899)]=this['value'],await saveCurrentChatSettings(_0x45e914),restartCharacterStatusTimer();const _0x1c894c={'high':'高频','medium-high':_0xc330d(0x1ea),'medium':'中频','medium-low':_0xc330d(0x1689),'low':'低频'};showToast(_0xc330d(0x17aa)+_0x1c894c[this[_0xc330d(0x1ebc)]],_0xc330d(0x11cb));});}async function initializeChatSettings(){const _0x2bfe86=_0x211817;console[_0x2bfe86(0x2187)](_0x2bfe86(0x16b1)),initChatSettingsUIEvents();if(!currentChatCharacter){console[_0x2bfe86(0x2187)]('初始化聊天设置界面：无当前聊天角色，只初始化UI事件');return;}await updateChatIdentityDisplay(),await updateBubbleStyleDisplay(),await initCharacterSoundSettings(),await updateChatSettingsDisplay();if(currentChatCharacter){const _0x553e87=await getAsyncChatSettings();}}function initChatSettingsUIEvents(){const _0x3acb4b=_0x211817,_0x3d021e=document[_0x3acb4b(0x1262)]('background-interaction-enabled');_0x3d021e&&_0x3d021e['addEventListener'](_0x3acb4b(0x5af),async function(){const _0x501af5=_0x3acb4b,_0x5d0a06=document[_0x501af5(0x1262)](_0x501af5(0x43d));_0x5d0a06&&(_0x5d0a06[_0x501af5(0x14eb)]['display']=this[_0x501af5(0x14c1)]?_0x501af5(0x13de):_0x501af5(0x102b));if(!this['checked']){const _0x4ebbdf=document[_0x501af5(0x1262)]('chat-frequency-setting'),_0x48e535=document[_0x501af5(0x1262)]('moments-frequency-setting'),_0x5c9dd3=document['getElementById'](_0x501af5(0x1a25)),_0x2d8eed=document[_0x501af5(0x1262)](_0x501af5(0xce4)),_0x3e4009=document['getElementById']('diary-time-setting');if(_0x4ebbdf)_0x4ebbdf[_0x501af5(0x14eb)]['display']=_0x501af5(0x102b);if(_0x48e535)_0x48e535['style'][_0x501af5(0x4da)]=_0x501af5(0x102b);if(_0x5c9dd3)_0x5c9dd3[_0x501af5(0x14eb)][_0x501af5(0x4da)]=_0x501af5(0x102b);if(_0x2d8eed)_0x2d8eed['style'][_0x501af5(0x4da)]='none';if(_0x3e4009)_0x3e4009['style'][_0x501af5(0x4da)]='none';clearAllBackgroundTimers();}else await initGlobalBackgroundInteractionSystem();});const _0x1f2cab=document[_0x3acb4b(0x1262)](_0x3acb4b(0x726));_0x1f2cab&&_0x1f2cab[_0x3acb4b(0x21e9)]('change',async function(){const _0x3048a8=_0x3acb4b,_0x4ba1cc=document[_0x3048a8(0x1262)](_0x3048a8(0xe27)),_0x117ec6=_0x4ba1cc?_0x4ba1cc['checked']:![],_0x4e0697=document['getElementById'](_0x3048a8(0xd6f));if(_0x4e0697){const _0x2926fb=_0x117ec6&&this[_0x3048a8(0x14c1)];_0x4e0697[_0x3048a8(0x14eb)][_0x3048a8(0x4da)]=_0x2926fb?'block':_0x3048a8(0x102b);}await initGlobalBackgroundInteractionSystem();});const _0x1a886d=document['getElementById'](_0x3acb4b(0xde8));_0x1a886d&&_0x1a886d[_0x3acb4b(0x21e9)](_0x3acb4b(0x5af),async function(){const _0x56b25a=_0x3acb4b,_0x246e92=document[_0x56b25a(0x1262)](_0x56b25a(0xe27)),_0x4d5d1d=_0x246e92?_0x246e92[_0x56b25a(0x14c1)]:![],_0x391a65=_0x4d5d1d&&this[_0x56b25a(0x14c1)],_0x19c452=document[_0x56b25a(0x1262)]('moments-frequency-setting'),_0x4d7c50=document[_0x56b25a(0x1262)](_0x56b25a(0x1a25)),_0x32979a=document[_0x56b25a(0x1262)](_0x56b25a(0xce4));if(_0x19c452)_0x19c452[_0x56b25a(0x14eb)][_0x56b25a(0x4da)]=_0x391a65?'flex':_0x56b25a(0x102b);if(_0x4d7c50)_0x4d7c50[_0x56b25a(0x14eb)]['display']=_0x391a65?'flex':_0x56b25a(0x102b);if(_0x32979a)_0x32979a[_0x56b25a(0x14eb)][_0x56b25a(0x4da)]=_0x391a65?'flex':_0x56b25a(0x102b);if(currentChatCharacter){const _0x4018ce=currentChatCharacter['id'];backgroundTimers[_0x4018ce+_0x56b25a(0x1b6e)]&&(clearInterval(backgroundTimers[_0x4018ce+_0x56b25a(0x1b6e)]),delete backgroundTimers[_0x4018ce+'_moments']);const _0x30b814=getCurrentChatSettings();if(_0x30b814[_0x56b25a(0x4f2)]&&_0x30b814[_0x56b25a(0x354)]){const _0x2021af=getBackgroundMomentsInterval(_0x30b814[_0x56b25a(0xed6)]||'low');backgroundTimers[_0x4018ce+_0x56b25a(0x1b6e)]=setInterval(()=>{triggerBackgroundMoments(_0x4018ce);},_0x2021af),console['log'](_0x56b25a(0x1347)+currentChatCharacter[_0x56b25a(0x1a1c)]+'\x20主动发动态定时器已重新设置，间隔:\x20'+_0x2021af+'ms');}else console[_0x56b25a(0x2187)](_0x56b25a(0x21f5)+currentChatCharacter[_0x56b25a(0x1a1c)]+_0x56b25a(0xb9f));}});const _0xfbb836=document['getElementById'](_0x3acb4b(0x15a3));_0xfbb836&&_0xfbb836['addEventListener'](_0x3acb4b(0x5af),async function(){const _0x5da6e4=_0x3acb4b,_0x24c420=document[_0x5da6e4(0x1262)]('background-interaction-enabled'),_0x32864c=_0x24c420?_0x24c420[_0x5da6e4(0x14c1)]:![],_0x54260b=document[_0x5da6e4(0x1262)](_0x5da6e4(0x14f8));if(_0x54260b){const _0x422f69=_0x32864c&&this[_0x5da6e4(0x14c1)];_0x54260b[_0x5da6e4(0x14eb)]['display']=_0x422f69?_0x5da6e4(0x1fb7):_0x5da6e4(0x102b);}currentChatCharacter&&await initBackgroundDiarySystem(currentChatCharacter['id']);});const _0x21c6c2=document['getElementById']('selection-cancel-btn'),_0x3defc3=document['getElementById'](_0x3acb4b(0xa29));_0x21c6c2&&_0x21c6c2[_0x3acb4b(0x21e9)](_0x3acb4b(0x1859),exitMessageSelectionMode),_0x3defc3&&_0x3defc3[_0x3acb4b(0x21e9)](_0x3acb4b(0x1859),function(){if(selectedMessages['size']===0x0)return;deleteSelectedMessages();});}async function pokeCharacter(_0x271a0d){const _0x5560ca=_0x211817;if(!currentChatCharacter||currentChatCharacter['id']!==_0x271a0d)return;const _0x44822b=getCurrentChatSettings(),_0x2ac092=_0x44822b['aiPokeSuffix']||'',_0x2f6fb0=_0x44822b[_0x5560ca(0x4e7)]||currentChatCharacter['name'],_0x23e3ac={'id':Date[_0x5560ca(0x2eb)]()[_0x5560ca(0x1878)](),'sender':_0x5560ca(0x1744),'content':'你戳了戳'+_0x2f6fb0+_0x2ac092,'timestamp':Date[_0x5560ca(0x2eb)](),'isPoke':!![]};!chatMessages[_0x271a0d]&&(chatMessages[_0x271a0d]=[]);chatMessages[_0x271a0d][_0x5560ca(0x1cd6)](_0x23e3ac);try{const _0x1e76b5=_0x271a0d+_0x5560ca(0x1800)+_0x23e3ac[_0x5560ca(0x1716)]+'_'+Math[_0x5560ca(0x11a8)]()['toString'](0x24)[_0x5560ca(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x271a0d][_0x5560ca(0x19ee)]-0x1);await db[_0x5560ca(0x19a2)][_0x5560ca(0x21e2)]({'id':_0x1e76b5,'characterId':_0x271a0d,'timestamp':_0x23e3ac[_0x5560ca(0x1716)],'messageOrder':chatMessages[_0x271a0d]['length']-0x1,'originalMessageId':_0x23e3ac['id'],'messageData':_0x23e3ac}),console[_0x5560ca(0x2187)](_0x5560ca(0x11a6));}catch(_0x194b18){console[_0x5560ca(0x174a)](_0x5560ca(0x1f9b),_0x194b18),saveChatMessages();}renderChatMessages(_0x271a0d),Math[_0x5560ca(0x11a8)]()<0.4&&setTimeout(()=>{const _0x191ce3=_0x5560ca,_0x46f129=_0x44822b[_0x191ce3(0x12e6)]||'',_0x1f1a1e={'id':Date['now']()['toString'](),'sender':'system','content':_0x2f6fb0+_0x191ce3(0x3a5)+_0x46f129,'timestamp':Date[_0x191ce3(0x2eb)](),'isPoke':!![]};chatMessages[_0x271a0d][_0x191ce3(0x1cd6)](_0x1f1a1e);try{const _0x5225d8=_0x271a0d+'_poke_reply_'+_0x1f1a1e[_0x191ce3(0x1716)]+'_'+Math[_0x191ce3(0x11a8)]()[_0x191ce3(0x1878)](0x24)[_0x191ce3(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x271a0d]['length']-0x1);db[_0x191ce3(0x19a2)]['add']({'id':_0x5225d8,'characterId':_0x271a0d,'timestamp':_0x1f1a1e[_0x191ce3(0x1716)],'messageOrder':chatMessages[_0x271a0d]['length']-0x1,'originalMessageId':_0x1f1a1e['id'],'messageData':_0x1f1a1e})[_0x191ce3(0x63d)](()=>{const _0x4c7c79=_0x191ce3;console[_0x4c7c79(0x2187)](_0x4c7c79(0x4cc));})[_0x191ce3(0x1c82)](_0x13ee1f=>{const _0x42a6ba=_0x191ce3;console[_0x42a6ba(0x174a)](_0x42a6ba(0x31d),_0x13ee1f);});}catch(_0x162971){console[_0x191ce3(0x174a)](_0x191ce3(0xede),_0x162971),saveChatMessages();}renderChatMessages(_0x271a0d);},0x3e8+Math[_0x5560ca(0x11a8)]()*0x7d0);}function showChatOptions(){const _0x1af411=_0x211817;showModal(_0x1af411(0xb64));}function showSingleChatSelector(){const _0x223505=_0x211817;hideModal(_0x223505(0xb64)),showPersonaSelectionForSingleChat();}function showPersonaSelectionForSingleChat(){const _0x49b43f=_0x211817,_0x2714aa=_0x49b43f(0x109f)+personas[_0x49b43f(0x6a4)](_0x3cbb11=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22persona-selection-item\x22\x20data-persona-id=\x22'+_0x3cbb11['id']+_0x49b43f(0x10c0)+(_0x3cbb11['avatarUrl']?'background-image:\x20url('+_0x3cbb11[_0x49b43f(0x1994)]+');\x20background-size:\x20cover;\x20background-position:\x20center;':'')+_0x49b43f(0x3bf)+(_0x3cbb11[_0x49b43f(0x1994)]?'':_0x3cbb11[_0x49b43f(0x1a1c)]['charAt'](0x0))+_0x49b43f(0x1f3c)+_0x3cbb11[_0x49b43f(0x1a1c)]+_0x49b43f(0xae6)+truncateText(_0x3cbb11[_0x49b43f(0x7c9)]||_0x49b43f(0xf58),0x64)+_0x49b43f(0x16ad))[_0x49b43f(0x122b)]('')+_0x49b43f(0x109b),_0x4c81ba=document[_0x49b43f(0x1262)](_0x49b43f(0x861));_0x4c81ba&&_0x4c81ba[_0x49b43f(0x1493)](),document['body'][_0x49b43f(0x1b7)]('beforeend',_0x2714aa),document['querySelectorAll'](_0x49b43f(0x908))['forEach'](_0x5a8f15=>{const _0x19a0f9=_0x49b43f;_0x5a8f15[_0x19a0f9(0x21e9)](_0x19a0f9(0x1859),function(){const _0x4a1515=_0x19a0f9;document[_0x4a1515(0x1897)](_0x4a1515(0x908))['forEach'](_0x40f040=>_0x40f040[_0x4a1515(0x1c1b)][_0x4a1515(0x1493)](_0x4a1515(0x176b))),this[_0x4a1515(0x1c1b)][_0x4a1515(0x21e2)]('selected'),window['selectedPersonaForChat']=this[_0x4a1515(0x1ecd)][_0x4a1515(0x131c)],document[_0x4a1515(0x1262)](_0x4a1515(0x1625))[_0x4a1515(0x559)]=![];});});}function hidePersonaSelectionModal(){const _0x3ec4e1=_0x211817,_0xc5985f=document[_0x3ec4e1(0x1262)](_0x3ec4e1(0x861));_0xc5985f&&_0xc5985f[_0x3ec4e1(0x1493)](),window[_0x3ec4e1(0x22ff)]=null;}function confirmPersonaAndShowCharacters(){if(!window['selectedPersonaForChat'])return;hidePersonaSelectionModal(),showCharacterSelectionForSingleChat();}function showCharacterSelectionForSingleChat(){const _0x384714=_0x211817,_0x53664d=window[_0x384714(0x22ff)];console['log'](_0x384714(0x807)),console[_0x384714(0x2187)](_0x384714(0xfba),_0x53664d);const _0x5abe09=document[_0x384714(0x1262)](_0x384714(0xd43));_0x5abe09[_0x384714(0x33a)]='',characters[_0x384714(0x19ee)]===0x0?_0x5abe09[_0x384714(0x33a)]=_0x384714(0x143b):characters[_0x384714(0x19fb)](_0x5f1e0b=>{const _0x265880=_0x384714,_0x3550e9=document[_0x265880(0xac6)](_0x265880(0xbbc)),_0x4a7110=contacts['includes'](_0x5f1e0b['id']);_0x3550e9['className']=_0x265880(0xfe9)+(_0x4a7110?'has-existing-chat':''),_0x3550e9[_0x265880(0x1f36)]=()=>{const _0x47a849=_0x265880;console[_0x47a849(0x2187)]('===\x20角色选择点击事件\x20==='),console[_0x47a849(0x2187)](_0x47a849(0x1759),_0x5f1e0b[_0x47a849(0x1a1c)]),console['log']('使用的身份ID:',_0x53664d),hideModal(_0x47a849(0x1f95)),startChatWithPersona(_0x5f1e0b,_0x53664d),window[_0x47a849(0x22ff)]=null;};const _0x39d351=_0x4a7110?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-status-indicator\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-comments\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>已有对话</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';_0x3550e9[_0x265880(0x33a)]=_0x265880(0x1582)+_0x5f1e0b[_0x265880(0xc3d)]+';\x20'+(_0x5f1e0b[_0x265880(0x1994)]?_0x265880(0x2236)+_0x5f1e0b[_0x265880(0x1994)]+_0x265880(0x1dd):'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x5f1e0b['avatarUrl']?'':_0x5f1e0b[_0x265880(0x1a1c)]['charAt'](0x0))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-text\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-title\x22>'+_0x5f1e0b[_0x265880(0x1a1c)]+(_0x4a7110?_0x265880(0xe64):'')+_0x265880(0x876)+truncateText(_0x5f1e0b['bio']||'暂无描述',0x50)+_0x265880(0x1e16)+_0x39d351+_0x265880(0x1578),_0x5abe09['appendChild'](_0x3550e9);}),showModal(_0x384714(0x1f95));}async function startChatWithPersona(_0x485e4a,_0x1ed485){const _0xf055ef=_0x211817;console[_0xf055ef(0x2187)](_0xf055ef(0x4f0));if(contacts[_0xf055ef(0x1831)](_0x485e4a['id'])){const _0x11dc53=chatSettings[_0x485e4a['id']]||{},_0x2ba16=personas[_0xf055ef(0xaf4)](_0x2d76ec=>_0x2d76ec['id']===_0x11dc53[_0xf055ef(0x145e)]),_0x53ab82=_0x2ba16?_0x2ba16[_0xf055ef(0x1a1c)]:_0xf055ef(0x69f),_0x34169d=confirm(_0xf055ef(0x591)+_0x485e4a['name']+_0xf055ef(0x1731)+('当前对话使用的身份：'+_0x53ab82+'\x0a\x0a')+_0xf055ef(0x6fe)+_0xf055ef(0xd78));if(_0x34169d){startChat(_0x485e4a);return;}else return;}if(_0x1ed485){let _0x30ac29=chatSettings[_0x485e4a['id']]||{};_0x30ac29['selectedIdentityId']=_0x1ed485;const _0xa2987f=personas[_0xf055ef(0xaf4)](_0x3230c1=>_0x3230c1['id']===_0x1ed485);_0xa2987f&&(_0x30ac29[_0xf055ef(0x11cd)]=_0xa2987f[_0xf055ef(0x1994)]||'',_0x30ac29['myChatNickname']=_0xa2987f[_0xf055ef(0x1a1c)]||'',chatSettings[_0x485e4a['id']]=_0x30ac29,await saveCurrentChatSettings(_0x30ac29));}console['log'](_0xf055ef(0x38f)),contacts[_0xf055ef(0x1cd6)](_0x485e4a['id']),await saveContacts(),console[_0xf055ef(0x2187)](_0xf055ef(0x291),contacts),renderMessageList(),startChat(_0x485e4a);}function toggleGroupMemberSelection(_0x281bb6){const _0x51a993=_0x211817,_0x34ba20=selectedGroupMembers['indexOf'](_0x281bb6),_0x30b82d=document[_0x51a993(0x1262)](_0x51a993(0x4f6)+_0x281bb6),_0x1c2513=_0x30b82d[_0x51a993(0x216a)](_0x51a993(0x10dc));if(_0x34ba20>-0x1)selectedGroupMembers[_0x51a993(0x19b2)](_0x34ba20,0x1),_0x30b82d[_0x51a993(0x1c1b)]['remove'](_0x51a993(0x14c1)),_0x30b82d[_0x51a993(0x33a)]='',_0x1c2513['classList']['remove']('selected');else{if(selectedGroupMembers[_0x51a993(0x19ee)]>=0x14){alert('最多只能选择20个成员');return;}selectedGroupMembers['push'](_0x281bb6),_0x30b82d[_0x51a993(0x1c1b)][_0x51a993(0x21e2)](_0x51a993(0x14c1)),_0x30b82d[_0x51a993(0x33a)]=_0x51a993(0xd31),_0x1c2513['classList'][_0x51a993(0x21e2)](_0x51a993(0x176b));}}function showGroupChatSelector(){const _0x43ba17=_0x211817;hideModal(_0x43ba17(0xb64)),showPersonaSelectionForGroupChat();}function showPersonaSelectionForGroupChat(){const _0xf0bf2c=_0x211817,_0x27e2f1=_0xf0bf2c(0xa2a)+personas[_0xf0bf2c(0x6a4)](_0x9c0502=>_0xf0bf2c(0xd81)+_0x9c0502['id']+_0xf0bf2c(0x2145)+(_0x9c0502[_0xf0bf2c(0x1994)]?'background-image:\x20url(\x27'+_0x9c0502['avatarUrl']+_0xf0bf2c(0x767):'')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x9c0502['avatarUrl']?'':_0x9c0502[_0xf0bf2c(0x1a1c)][_0xf0bf2c(0xcc3)](0x0))+_0xf0bf2c(0x1f3c)+_0x9c0502[_0xf0bf2c(0x1a1c)]+_0xf0bf2c(0xae6)+truncateText(_0x9c0502[_0xf0bf2c(0x7c9)]||_0xf0bf2c(0xf58),0x64)+_0xf0bf2c(0x17f6))['join']('')+_0xf0bf2c(0x1893),_0x47e23b=document[_0xf0bf2c(0x1262)](_0xf0bf2c(0x289));if(_0x47e23b)_0x47e23b[_0xf0bf2c(0x1493)]();document[_0xf0bf2c(0x1da9)][_0xf0bf2c(0x1b7)](_0xf0bf2c(0x42e),_0x27e2f1);let _0x35162b=null;document['querySelectorAll'](_0xf0bf2c(0xf61))['forEach'](_0xa28fbb=>{const _0x1b291e=_0xf0bf2c;_0xa28fbb[_0x1b291e(0x21e9)]('click',function(){const _0x355940=_0x1b291e;document[_0x355940(0x1897)](_0x355940(0xf61))[_0x355940(0x19fb)](_0x85fed8=>_0x85fed8[_0x355940(0x1c1b)]['remove'](_0x355940(0x176b))),this[_0x355940(0x1c1b)][_0x355940(0x21e2)](_0x355940(0x176b)),_0x35162b=this['dataset']['personaId'],document['getElementById'](_0x355940(0x222))[_0x355940(0x559)]=![],console[_0x355940(0x2187)](_0x355940(0x14ca),_0x35162b,'身份名称:',this['querySelector'](_0x355940(0xbee))[_0x355940(0x13be)]);});}),document[_0xf0bf2c(0x1262)]('confirm-group-persona-btn')['onclick']=()=>{const _0x277d6d=_0xf0bf2c;console[_0x277d6d(0x2187)](_0x277d6d(0xe38),_0x35162b),_0x35162b?(console['log'](_0x277d6d(0x5cf),_0x35162b),confirmPersonaAndShowGroupSettings(_0x35162b)):(console['error'](_0x277d6d(0x19bf)),alert(_0x277d6d(0x862)));};}function hidePersonaSelectionGroupModal(){const _0x1d1cd2=_0x211817,_0xe5a020=document[_0x1d1cd2(0x1262)](_0x1d1cd2(0x289));if(_0xe5a020)_0xe5a020[_0x1d1cd2(0x1493)]();}function confirmPersonaAndShowGroupSettings(_0x1e53e2){const _0x589db6=_0x211817;console[_0x589db6(0x2187)](_0x589db6(0x1f06),_0x1e53e2),hidePersonaSelectionGroupModal(),showGroupChatMemberSelection(_0x1e53e2);}function showGroupChatMemberSelection(_0x7dd83d){const _0x29e3e1=_0x211817;console['log'](_0x29e3e1(0xca2),_0x7dd83d),window['currentGroupPersonaId']=_0x7dd83d,document[_0x29e3e1(0x1262)](_0x29e3e1(0x1c90))['value']='',selectedGroupMembers=[];const _0xb329c8=document[_0x29e3e1(0x1262)](_0x29e3e1(0x5da));_0xb329c8[_0x29e3e1(0x33a)]='';characters[_0x29e3e1(0x19ee)]<0x2?_0xb329c8['innerHTML']=_0x29e3e1(0x1822):characters[_0x29e3e1(0x19fb)](_0x12e86d=>{const _0x94126e=_0x29e3e1,_0x2ef524=document[_0x94126e(0xac6)](_0x94126e(0xbbc));_0x2ef524[_0x94126e(0x1722)]='group-member-item',_0x2ef524[_0x94126e(0x1f36)]=()=>toggleGroupMemberSelection(_0x12e86d['id']),_0x2ef524['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22group-member-checkbox\x22\x20id=\x22checkbox-'+_0x12e86d['id']+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-avatar\x22\x20style=\x22background-color:\x20'+_0x12e86d[_0x94126e(0xc3d)]+';\x20'+(_0x12e86d['avatarUrl']?'background-image:\x20url(\x27'+_0x12e86d[_0x94126e(0x1994)]+_0x94126e(0x700):'')+_0x94126e(0x1ada)+(_0x12e86d['avatarUrl']?'':_0x12e86d[_0x94126e(0x1a1c)][_0x94126e(0xcc3)](0x0))+_0x94126e(0x325)+_0x12e86d['name']+_0x94126e(0x344)+truncateText(_0x12e86d[_0x94126e(0x1f0b)]||_0x94126e(0x1569),0x50)+_0x94126e(0xa2b),_0xb329c8['appendChild'](_0x2ef524);});console[_0x29e3e1(0x2187)](_0x29e3e1(0x9e1),_0x7dd83d);const _0x2082e6=document['getElementById'](_0x29e3e1(0x1ce6))[_0x29e3e1(0xb30)](_0x29e3e1(0x1d93));_0x2082e6[_0x29e3e1(0x1f36)]=()=>{const _0x570acc=_0x29e3e1;console['log'](_0x570acc(0xf9f),_0x7dd83d),createGroupChat(_0x7dd83d);},showModal(_0x29e3e1(0x1ce6));}function toggleGroupMemberSelection(_0x3492a7){const _0x440650=_0x211817,_0x1f86d4=selectedGroupMembers[_0x440650(0x13c5)](_0x3492a7),_0x1bf096=document[_0x440650(0x1262)](_0x440650(0x4f6)+_0x3492a7),_0xe9cdd=_0x1bf096[_0x440650(0x216a)]('.group-member-item');if(_0x1f86d4>-0x1)selectedGroupMembers[_0x440650(0x19b2)](_0x1f86d4,0x1),_0x1bf096[_0x440650(0x1c1b)][_0x440650(0x1493)]('checked'),_0x1bf096[_0x440650(0x33a)]='',_0xe9cdd[_0x440650(0x1c1b)]['remove']('selected');else{if(selectedGroupMembers[_0x440650(0x19ee)]>=0x14){alert(_0x440650(0x4e3));return;}selectedGroupMembers['push'](_0x3492a7),_0x1bf096[_0x440650(0x1c1b)]['add'](_0x440650(0x14c1)),_0x1bf096[_0x440650(0x33a)]=_0x440650(0xd31),_0xe9cdd[_0x440650(0x1c1b)][_0x440650(0x21e2)](_0x440650(0x176b));}}async function createGroupChat(_0xb01b6f){const _0x2abc45=_0x211817;console[_0x2abc45(0x2187)](_0x2abc45(0x562)+_0xb01b6f);const _0xd88c4a=document[_0x2abc45(0x1262)](_0x2abc45(0x1c90))[_0x2abc45(0x1ebc)]['trim']();if(!_0xd88c4a)return alert('请输入群聊名称');if(selectedGroupMembers[_0x2abc45(0x19ee)]<0x2)return alert(_0x2abc45(0x1066));const _0x225cc4=selectedGroupMembers[_0x2abc45(0x6a4)](_0xae0ef7=>{const _0x2cda9a=_0x2abc45,_0x1ea551=characters[_0x2cda9a(0xaf4)](_0x3dbaf6=>_0x3dbaf6['id']===_0xae0ef7);return{'id':_0x1ea551['id'],'name':_0x1ea551[_0x2cda9a(0x1a1c)],'persona':_0x1ea551[_0x2cda9a(0x1f0b)],'avatarUrl':_0x1ea551['avatarUrl'],'color':_0x1ea551['color']};}),_0x179427={'id':'group_'+Date[_0x2abc45(0x2eb)]()[_0x2abc45(0x1878)](),'name':_0xd88c4a,'members':_0x225cc4,'isGroup':!![],'createdAt':new Date()['toISOString'](),'settings':{'myPersona':'','myNickname':'我'}};if(_0xb01b6f){const _0x2e1319=personas[_0x2abc45(0xaf4)](_0x3f9562=>_0x3f9562['id']===_0xb01b6f);if(_0x2e1319){_0x179427['settings'][_0x2abc45(0x904)]=_0x2e1319[_0x2abc45(0x7c9)]||_0x2e1319['name'],_0x179427[_0x2abc45(0x1512)][_0x2abc45(0x42a)]=_0x2e1319['name'];const _0x4a0499={'selectedIdentityId':_0xb01b6f,'myChatAvatar':_0x2e1319[_0x2abc45(0x1994)],'myChatNickname':_0x2e1319[_0x2abc45(0x1a1c)],'selectedPersonaData':{..._0x2e1319},'myPersona':_0x2e1319['description']||_0x2e1319[_0x2abc45(0x1a1c)]};!window['chatSettings']&&(window[_0x2abc45(0x1789)]={}),window['chatSettings'][_0x179427['id']]=_0x4a0499,await db[_0x2abc45(0x1789)]['put']({'id':_0x179427['id'],'chatId':_0x179427['id'],'settings':_0x4a0499}),console['log']('✅\x20群聊身份设置已成功保存（双格式兼容）');}else console['error']('❌\x20创建群聊时未找到ID为\x20'+_0xb01b6f+_0x2abc45(0xa79));}if(!groupChats)groupChats=[];groupChats[_0x2abc45(0x1cd6)](_0x179427),await saveGroupChats(),hideModal(_0x2abc45(0x1ce6)),renderMessageList(),alert('群聊\x22'+_0xd88c4a+'\x22创建成功！');}async function saveGroupChats(){const _0x3da4e0=_0x211817;try{console[_0x3da4e0(0x2187)](_0x3da4e0(0xa7b),groupChats);(!groupChats||!Array['isArray'](groupChats))&&(console[_0x3da4e0(0x174a)](_0x3da4e0(0x1f6e),groupChats),groupChats=[]);const _0x181f91=groupChats[_0x3da4e0(0x1e1f)](_0x51b627=>{const _0x24939f=_0x3da4e0;if(!_0x51b627||!_0x51b627['id']||!_0x51b627['name'])return console[_0x24939f(0x1f43)]('发现无效的群聊对象:',_0x51b627),![];return!![];});_0x181f91[_0x3da4e0(0x19ee)]!==groupChats[_0x3da4e0(0x19ee)]&&(groupChats=_0x181f91,console[_0x3da4e0(0x2187)](_0x3da4e0(0xf35),groupChats[_0x3da4e0(0x19ee)]));await db[_0x3da4e0(0x1464)]('rw',db[_0x3da4e0(0x1076)],async()=>{const _0xb305da=_0x3da4e0;await db[_0xb305da(0x1076)]['clear']();for(const _0x2c7bc8 of groupChats){try{await db[_0xb305da(0x1076)][_0xb305da(0x21e2)](_0x2c7bc8);}catch(_0x39b3d5){console[_0xb305da(0x1f43)](_0xb305da(0x682),_0x2c7bc8['id'],_0x39b3d5),await db[_0xb305da(0x1076)][_0xb305da(0x1561)](_0x2c7bc8);}}}),console[_0x3da4e0(0x2187)](_0x3da4e0(0x1891));try{const _0x566de1=JSON['stringify'](groupChats)['length'],_0x5a001b=0x400*0x400;_0x566de1<_0x5a001b?(localStorage['setItem'](_0x3da4e0(0x1076),JSON[_0x3da4e0(0x6b8)](groupChats)),console[_0x3da4e0(0x2187)]('群聊数据备份到localStorage成功\x20('+(_0x566de1/0x400)[_0x3da4e0(0x13ad)](0x1)+_0x3da4e0(0x7ff))):(localStorage['removeItem']('groupChats'),console[_0x3da4e0(0x2187)](_0x3da4e0(0x1150)+(_0x566de1/0x400/0x400)['toFixed'](0x1)+_0x3da4e0(0x988)));}catch(_0x206c33){console[_0x3da4e0(0x1f43)](_0x3da4e0(0x690),_0x206c33);if(_0x206c33['name']===_0x3da4e0(0x22c5))try{localStorage['removeItem'](_0x3da4e0(0x1076)),console[_0x3da4e0(0x2187)](_0x3da4e0(0x236));}catch(_0xfd0cbc){console[_0x3da4e0(0x1f43)]('清理localStorage失败:',_0xfd0cbc);}}}catch(_0x1b754d){console[_0x3da4e0(0x174a)](_0x3da4e0(0x10aa),_0x1b754d),console[_0x3da4e0(0x174a)](_0x3da4e0(0xa03),_0x1b754d[_0x3da4e0(0x1a1c)],_0x1b754d['message']);try{localStorage[_0x3da4e0(0x192)](_0x3da4e0(0x1076),JSON[_0x3da4e0(0x6b8)](groupChats||[])),console[_0x3da4e0(0x2187)](_0x3da4e0(0x1007)),showToast(_0x3da4e0(0x12a8),_0x3da4e0(0x477));}catch(_0x2c2ae7){console[_0x3da4e0(0x174a)]('localStorage保存也失败:',_0x2c2ae7),console[_0x3da4e0(0x174a)](_0x3da4e0(0x1d0e),_0x2c2ae7[_0x3da4e0(0x1a1c)],_0x2c2ae7[_0x3da4e0(0x1e8e)]);_0x2c2ae7[_0x3da4e0(0x1a1c)]===_0x3da4e0(0x22c5)?alert(_0x3da4e0(0x665)):alert(_0x3da4e0(0x1a33));groupChats[_0x3da4e0(0xa1a)]();throw _0x2c2ae7;}}}function renderScheduleTimes(){const _0x45bf7f=_0x211817,_0x4398af=document[_0x45bf7f(0x1262)](_0x45bf7f(0x2312));if(!_0x4398af)return;const _0x5ef3c0=getCurrentChatSettings(),_0x1cb52c=_0x5ef3c0[_0x45bf7f(0x138e)]||[];_0x4398af[_0x45bf7f(0x33a)]='',_0x1cb52c[_0x45bf7f(0x19fb)]((_0x192266,_0xc1cd4e)=>{const _0x1a6c03=_0x45bf7f,_0x1ea227=document[_0x1a6c03(0xac6)](_0x1a6c03(0xbbc));_0x1ea227[_0x1a6c03(0x1722)]='schedule-time-item',_0x1ea227['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20value=\x22'+_0x192266+_0x1a6c03(0xf0d)+_0xc1cd4e+',\x20this.value)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22removeScheduleTime('+_0xc1cd4e+_0x1a6c03(0xeb0),_0x4398af[_0x1a6c03(0x497)](_0x1ea227);});}async function addScheduleTime(){const _0x49a375=_0x211817,_0x10f613=getCurrentChatSettings();!_0x10f613['scheduleTimes']&&(_0x10f613['scheduleTimes']=[]);if(_0x10f613[_0x49a375(0x138e)][_0x49a375(0x19ee)]>=0xa){alert(_0x49a375(0x1917));return;}_0x10f613[_0x49a375(0x138e)][_0x49a375(0x1cd6)](_0x49a375(0xbed)),await saveCurrentChatSettings(_0x10f613),renderScheduleTimes();}async function updateScheduleTime(_0xf25de2,_0x21406c){const _0x447b50=_0x211817,_0x32a7af=getCurrentChatSettings();_0x32a7af[_0x447b50(0x138e)]&&_0x32a7af[_0x447b50(0x138e)][_0xf25de2]!==undefined&&(_0x32a7af[_0x447b50(0x138e)][_0xf25de2]=_0x21406c,await saveCurrentChatSettings(_0x32a7af));}async function removeScheduleTime(_0x3cef69){const _0x1c4ae7=_0x211817,_0x15d1de=getCurrentChatSettings();_0x15d1de[_0x1c4ae7(0x138e)]&&_0x15d1de['scheduleTimes'][_0x3cef69]!==undefined&&(_0x15d1de[_0x1c4ae7(0x138e)][_0x1c4ae7(0x19b2)](_0x3cef69,0x1),await saveCurrentChatSettings(_0x15d1de),renderScheduleTimes());}async function saveScheduleSettings(){const _0x1c23eb=_0x211817,_0x55cb6e=getCurrentChatSettings();_0x55cb6e[_0x1c23eb(0xfd0)]=document[_0x1c23eb(0x1262)](_0x1c23eb(0x1fdb))['checked'],await saveCurrentChatSettings(_0x55cb6e),hideModal(_0x1c23eb(0x20c8)),showToast(_0x1c23eb(0x2129),_0x1c23eb(0x11cb));}function showWorldbookMountSettings(){const _0x4364c5=_0x211817,_0x4280e0=getCurrentChatSettings();document[_0x4364c5(0x1262)]('worldbook-mount-enabled')['checked']=_0x4280e0[_0x4364c5(0x227f)]||![],toggleWorldbookMountDetails(),document['getElementById'](_0x4364c5(0x200c))[_0x4364c5(0x1980)]=toggleWorldbookMountDetails,renderWorldbookMountList(),showModal(_0x4364c5(0x277));}function toggleWorldbookMountDetails(){const _0x2902d2=_0x211817,_0xef7194=document[_0x2902d2(0x1262)](_0x2902d2(0x200c))[_0x2902d2(0x14c1)];document[_0x2902d2(0x1262)]('worldbook-mount-details')['style']['display']=_0xef7194?_0x2902d2(0x13de):_0x2902d2(0x102b),updateWorldbookMountDisplay();}function updateWorldbookMountDisplay(){const _0x2edb6f=_0x211817;if(!currentChatCharacter){console[_0x2edb6f(0x2187)](_0x2edb6f(0x1e11));return;}const _0x2d12a3=getCurrentChatSettings(),_0x1b9ce5=document[_0x2edb6f(0x1262)](_0x2edb6f(0xc86));if(!_0x1b9ce5){console['log']('更新世界书挂载显示：无显示元素，跳过操作');return;}if(!_0x2d12a3['worldbookMountEnabled']){_0x1b9ce5[_0x2edb6f(0x13be)]=_0x2edb6f(0x21b2);return;}const _0x1419bc=_0x2d12a3[_0x2edb6f(0x1a45)]||[];if(_0x1419bc[_0x2edb6f(0x19ee)]===0x0)_0x1b9ce5[_0x2edb6f(0x13be)]=_0x2edb6f(0xd56);else{if(_0x1419bc[_0x2edb6f(0x19ee)]===0x1){const _0x28d177=worldbooks[_0x2edb6f(0xaf4)](_0x6e43bf=>_0x6e43bf['id']===_0x1419bc[0x0]);_0x1b9ce5[_0x2edb6f(0x13be)]=_0x28d177?_0x2edb6f(0x1edb)+_0x28d177[_0x2edb6f(0x378)]:_0x2edb6f(0x20b3);}else _0x1b9ce5[_0x2edb6f(0x13be)]=_0x2edb6f(0x1edb)+_0x1419bc['length']+'个';}}function renderWorldbookMountList(){const _0xc36554=_0x211817,_0x4a62da=document[_0xc36554(0x1262)]('worldbook-mount-list');_0x4a62da[_0xc36554(0x33a)]='';const _0x1cb512=worldbooks['filter'](_0x37260f=>!_0x37260f['isGlobal']);if(_0x1cb512[_0xc36554(0x19ee)]===0x0){_0x4a62da['innerHTML']=_0xc36554(0x106d);return;}const _0x54523f=getCurrentChatSettings(),_0x3bf220=_0x54523f[_0xc36554(0x1a45)]||[];_0x1cb512['forEach'](_0x3ddbdd=>{const _0x1fd29c=_0xc36554,_0x1e41f3=document[_0x1fd29c(0xac6)](_0x1fd29c(0xbbc));_0x1e41f3['className']=_0x1fd29c(0x1e59);const _0x40e097=_0x3bf220['includes'](_0x3ddbdd['id']);_0x1e41f3[_0x1fd29c(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22worldbook-'+_0x3ddbdd['id']+'\x22\x20value=\x22'+_0x3ddbdd['id']+'\x22\x20'+(_0x40e097?_0x1fd29c(0x14c1):'')+_0x1fd29c(0x19d5)+_0x3ddbdd['title']+_0x1fd29c(0x18f1)+(_0x3ddbdd[_0x1fd29c(0x211c)][_0x1fd29c(0x19ee)]>0x64?_0x3ddbdd['content'][_0x1fd29c(0x17ca)](0x0,0x64)+_0x1fd29c(0x1520):_0x3ddbdd[_0x1fd29c(0x211c)])+_0x1fd29c(0x1ffc)+new Date(_0x3ddbdd[_0x1fd29c(0x1e99)])[_0x1fd29c(0xbf7)]('zh-CN')+_0x1fd29c(0x14f0)+_0x3ddbdd[_0x1fd29c(0x211c)][_0x1fd29c(0x19ee)]+_0x1fd29c(0xedd),_0x1e41f3[_0x1fd29c(0x1f36)]=_0x127a88=>{const _0x46cdfd=_0x1fd29c;if(_0x127a88[_0x46cdfd(0x193d)]['type']!==_0x46cdfd(0x1b48)){const _0x151aaa=_0x1e41f3[_0x46cdfd(0xb30)](_0x46cdfd(0x142b));_0x151aaa[_0x46cdfd(0x14c1)]=!_0x151aaa[_0x46cdfd(0x14c1)];}},_0x4a62da['appendChild'](_0x1e41f3);});const _0x2f3fe1=document[_0xc36554(0xac6)]('div');_0x2f3fe1['className']=_0xc36554(0x1673),_0x2f3fe1[_0xc36554(0x33a)]=_0xc36554(0x1d02),_0x4a62da[_0xc36554(0x497)](_0x2f3fe1);}function saveWorldbookMountSettings(){const _0x395b62=_0x211817,_0xaab293=getCurrentChatSettings();_0xaab293[_0x395b62(0x227f)]=document['getElementById'](_0x395b62(0x200c))['checked'];const _0x11a177=document[_0x395b62(0x1897)](_0x395b62(0x2042));_0xaab293[_0x395b62(0x1a45)]=Array[_0x395b62(0x13c0)](_0x11a177)[_0x395b62(0x6a4)](_0x5d467e=>_0x5d467e[_0x395b62(0x1ebc)]),saveCurrentChatSettings(_0xaab293),updateWorldbookMountDisplay(),hideModal(_0x395b62(0x277));const _0x4e8266=_0xaab293['selectedWorldbooks']?_0xaab293[_0x395b62(0x1a45)]['length']:0x0;if(_0xaab293[_0x395b62(0x227f)]&&_0x4e8266>0x0)showToast(_0x395b62(0x2097)+_0x4e8266+_0x395b62(0x1d9d),_0x395b62(0x11cb));else _0xaab293['worldbookMountEnabled']?showToast(_0x395b62(0xf54),_0x395b62(0x477)):showToast(_0x395b62(0x414),_0x395b62(0x477));}function compressImage(_0x1c4a50,_0x5dea23=0x12c,_0x125cb2=0.8){return new Promise(_0x5eff80=>{const _0x466019=_0x167f,_0x3ecbfa=new Image();_0x3ecbfa['onload']=function(){const _0x54d73b=_0x167f,_0x5c873c=document[_0x54d73b(0xac6)]('canvas'),_0x42105e=_0x5c873c[_0x54d73b(0x21c7)]('2d');let {width:_0x3ef3fb,height:_0x1df19d}=_0x3ecbfa;_0x3ef3fb>_0x1df19d?_0x3ef3fb>_0x5dea23&&(_0x1df19d=_0x1df19d*_0x5dea23/_0x3ef3fb,_0x3ef3fb=_0x5dea23):_0x1df19d>_0x5dea23&&(_0x3ef3fb=_0x3ef3fb*_0x5dea23/_0x1df19d,_0x1df19d=_0x5dea23);_0x5c873c['width']=_0x3ef3fb,_0x5c873c[_0x54d73b(0xe6b)]=_0x1df19d,_0x42105e['drawImage'](_0x3ecbfa,0x0,0x0,_0x3ef3fb,_0x1df19d);const _0x18ae3a=_0x5c873c[_0x54d73b(0x7f5)]('image/jpeg',_0x125cb2);console[_0x54d73b(0x2187)]('图片压缩：'+Math['round'](_0x1c4a50[_0x54d73b(0x19ee)]/0x400)+_0x54d73b(0x1f52)+Math[_0x54d73b(0x13e2)](_0x18ae3a['length']/0x400)+'KB'),_0x5eff80(_0x18ae3a);},_0x3ecbfa[_0x466019(0x45c)]=_0x1c4a50;});}function recoverAndRefreshSettings(){const _0x49c902=_0x211817;if(!currentChatCharacter){showToast(_0x49c902(0xe73),_0x49c902(0x1816));return;}const _0x4e076c=currentChatCharacter['id'];console['log'](_0x49c902(0x210d)+_0x4e076c),console['log']('当前设置状态:',JSON[_0x49c902(0x6b8)](chatSettings[_0x4e076c],null,0x2)),showToast(_0x49c902(0x1a54),'info');const _0x18516d=localStorage[_0x49c902(0x15d8)]('chatSettings_'+_0x4e076c);if(_0x18516d)try{const _0x16ac8f=JSON[_0x49c902(0x22d3)](_0x18516d);console[_0x49c902(0x2187)](_0x49c902(0x16f2),JSON[_0x49c902(0x6b8)](_0x16ac8f,null,0x2)),chatSettings[_0x4e076c]=_0x16ac8f;document['getElementById'](_0x49c902(0x1765))[_0x49c902(0x14eb)][_0x49c902(0x4da)]!==_0x49c902(0x102b)&&updateChatSettingsDisplay();currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);showToast('设置恢复成功！',_0x49c902(0x11cb)),console[_0x49c902(0x2187)](_0x49c902(0x1b25),JSON['stringify'](chatSettings[_0x4e076c],null,0x2));return;}catch(_0xd8e28f){console[_0x49c902(0x174a)](_0x49c902(0x48f),_0xd8e28f);}db['chatSettings'][_0x49c902(0xb78)](_0x4e076c)[_0x49c902(0x63d)](_0x2ed8ac=>{const _0x3f8694=_0x49c902;_0x2ed8ac&&_0x2ed8ac[_0x3f8694(0x1512)]?(console['log'](_0x3f8694(0x6d2),JSON['stringify'](_0x2ed8ac['settings'],null,0x2)),chatSettings[_0x4e076c]=_0x2ed8ac[_0x3f8694(0x1512)],localStorage['setItem']('chatSettings_'+_0x4e076c,JSON[_0x3f8694(0x6b8)](_0x2ed8ac['settings'])),document[_0x3f8694(0x1262)]('api-chat-settings-screen')[_0x3f8694(0x14eb)]['display']!==_0x3f8694(0x102b)&&updateChatSettingsDisplay(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x3f8694(0x4d1),_0x3f8694(0x11cb)),console[_0x3f8694(0x2187)](_0x3f8694(0x1329),JSON[_0x3f8694(0x6b8)](_0x2ed8ac['settings'],null,0x2))):(showToast(_0x3f8694(0x1d76),_0x3f8694(0x174a)),console[_0x3f8694(0x2187)](_0x3f8694(0x13fc)));})['catch'](_0x5babce=>{const _0x38e181=_0x49c902;console['error'](_0x38e181(0x81e),_0x5babce),showToast(_0x38e181(0x2078),'error');});}function recoverChatSettings(){const _0x28bd2a=_0x211817;if(!currentChatCharacter)return![];const _0x332d0e=currentChatCharacter['id'];console['log'](_0x28bd2a(0xfe2));const _0x485a39=localStorage['getItem']('chatSettings_'+_0x332d0e);if(_0x485a39)try{const _0x2afac6=JSON[_0x28bd2a(0x22d3)](_0x485a39);return chatSettings[_0x332d0e]=_0x2afac6,console[_0x28bd2a(0x2187)]('从localStorage恢复聊天设置成功:',_0x2afac6),!![];}catch(_0xd2c3dd){console[_0x28bd2a(0x174a)](_0x28bd2a(0x1c6),_0xd2c3dd);}return db[_0x28bd2a(0x1789)]['get'](_0x332d0e)['then'](_0x5ac30f=>{const _0x548b2a=_0x28bd2a;if(_0x5ac30f&&_0x5ac30f[_0x548b2a(0x1512)])return chatSettings[_0x332d0e]=_0x5ac30f[_0x548b2a(0x1512)],console['log'](_0x548b2a(0x89e),_0x5ac30f[_0x548b2a(0x1512)]),localStorage[_0x548b2a(0x192)](_0x548b2a(0xa25)+_0x332d0e,JSON[_0x548b2a(0x6b8)](_0x5ac30f[_0x548b2a(0x1512)])),!![];})[_0x28bd2a(0x1c82)](_0x152ee7=>{const _0x2cf40f=_0x28bd2a;console[_0x2cf40f(0x174a)](_0x2cf40f(0x81e),_0x152ee7);}),![];}function forceRefreshAvatars(){const _0x2c69a5=_0x211817,_0xdc2729=getCurrentChatSettings(),_0x5db846=_0xdc2729[_0x2c69a5(0x179f)]||currentChatCharacter[_0x2c69a5(0x1994)];console[_0x2c69a5(0x2187)](_0x2c69a5(0x1bee),_0x5db846?_0x5db846[_0x2c69a5(0x17ca)](0x0,0x32)+'...':_0x2c69a5(0x126c));const _0x213db6=document[_0x2c69a5(0x1897)](_0x2c69a5(0x15aa));_0x213db6[_0x2c69a5(0x19fb)](_0x1c3d00=>{const _0x245d7e=_0x2c69a5,_0x3a83c4=_0x1c3d00['getAttribute']('onclick');_0x3a83c4&&_0x3a83c4[_0x245d7e(0x1831)]('\x27'+currentChatCharacter['id']+'\x27')&&(_0x5db846&&_0x5db846!=='undefined'?(_0x1c3d00['style'][_0x245d7e(0x159c)]=_0x245d7e(0x9f1)+_0x5db846+')',_0x1c3d00['style'][_0x245d7e(0x15d0)]=_0x245d7e(0x12bb),_0x1c3d00['style'][_0x245d7e(0x1530)]='center',_0x1c3d00[_0x245d7e(0x33a)]=''):(_0x1c3d00[_0x245d7e(0x14eb)][_0x245d7e(0x159c)]=_0x245d7e(0x102b),_0x1c3d00[_0x245d7e(0x33a)]=currentChatCharacter[_0x245d7e(0x1a1c)][_0x245d7e(0xcc3)](0x0)));});const _0x270e75=document[_0x2c69a5(0x1262)](_0x2c69a5(0x1f2d));_0x270e75&&_0x5db846&&_0x5db846!==_0x2c69a5(0xcba)&&(_0x270e75[_0x2c69a5(0x14eb)]['backgroundImage']=_0x2c69a5(0x9f1)+_0x5db846+')',_0x270e75[_0x2c69a5(0x14eb)][_0x2c69a5(0x15d0)]=_0x2c69a5(0x12bb),_0x270e75[_0x2c69a5(0x14eb)]['backgroundPosition']=_0x2c69a5(0xcef),_0x270e75[_0x2c69a5(0x33a)]='',_0x270e75[_0x2c69a5(0x378)]=_0x2c69a5(0x1f0a));}async function calculateStorageUsage(){const _0x1959e8=_0x211817;try{let _0x182d02=0x0,_0x343c10=0x0,_0x352f8b=0x0,_0x468021=0x0;const _0x471434=await db['chatMessages'][_0x1959e8(0xf13)]();_0x182d02=JSON[_0x1959e8(0x6b8)](_0x471434)[_0x1959e8(0x19ee)];const _0x570411=await db['characters'][_0x1959e8(0xf13)]();_0x343c10=JSON[_0x1959e8(0x6b8)](_0x570411)[_0x1959e8(0x19ee)];const _0x25fb12=await db[_0x1959e8(0x1789)][_0x1959e8(0xf13)]();_0x352f8b=JSON[_0x1959e8(0x6b8)](_0x25fb12)[_0x1959e8(0x19ee)];const _0x521086=await db['customEmojis']['toArray']();_0x468021=JSON['stringify'](_0x521086)[_0x1959e8(0x19ee)];const _0x576c3d=_0x182d02+_0x343c10+_0x352f8b+_0x468021;return document['getElementById']('chat-storage-size')[_0x1959e8(0x13be)]=formatBytes(_0x182d02),document['getElementById'](_0x1959e8(0x1325))[_0x1959e8(0x13be)]=formatBytes(_0x343c10),document[_0x1959e8(0x1262)]('settings-storage-size')[_0x1959e8(0x13be)]=formatBytes(_0x352f8b),document[_0x1959e8(0x1262)]('emoji-storage-size')[_0x1959e8(0x13be)]=formatBytes(_0x468021),document['getElementById'](_0x1959e8(0x7f7))['textContent']=formatBytes(_0x576c3d),{'chatSize':_0x182d02,'characterSize':_0x343c10,'settingsSize':_0x352f8b,'emojiSize':_0x468021,'total':_0x576c3d};}catch(_0xc28fcf){return console[_0x1959e8(0x174a)](_0x1959e8(0x1a75),_0xc28fcf),null;}}function formatBytes(_0x4a0352){const _0x3db920=_0x211817;if(_0x4a0352===0x0)return _0x3db920(0x1e81);const _0x510f91=0x400,_0x9ee78a=['B','KB','MB','GB'],_0xb9cc1c=Math['floor'](Math[_0x3db920(0x2187)](_0x4a0352)/Math[_0x3db920(0x2187)](_0x510f91));return parseFloat((_0x4a0352/Math[_0x3db920(0x9af)](_0x510f91,_0xb9cc1c))['toFixed'](0x2))+'\x20'+_0x9ee78a[_0xb9cc1c];}async function compressAllImages(){const _0x383024=_0x211817;if(!confirm(_0x383024(0x16aa)))return;showToast(_0x383024(0x106e),_0x383024(0x477));let _0x27b599=0x0;try{for(const _0x2829a2 of characters){_0x2829a2[_0x383024(0x1994)]&&_0x2829a2[_0x383024(0x1994)][_0x383024(0x19ee)]>0xc350&&(_0x2829a2[_0x383024(0x1994)]=await compressImage(_0x2829a2['avatarUrl'],0x96,0.6),_0x27b599++);}await saveCharacters();for(const _0x1b7e05 of Object[_0x383024(0x1c9f)](chatSettings)){const _0x4dff07=chatSettings[_0x1b7e05];_0x4dff07&&(_0x4dff07[_0x383024(0x179f)]&&_0x4dff07[_0x383024(0x179f)][_0x383024(0x19ee)]>0xc350&&(_0x4dff07[_0x383024(0x179f)]=await compressImage(_0x4dff07[_0x383024(0x179f)],0x96,0.6),_0x27b599++),_0x4dff07[_0x383024(0x11cd)]&&_0x4dff07['myChatAvatar']['length']>0xc350&&(_0x4dff07[_0x383024(0x11cd)]=await compressImage(_0x4dff07[_0x383024(0x11cd)],0x96,0.6),_0x27b599++),_0x4dff07[_0x383024(0x826)]&&_0x4dff07[_0x383024(0x826)]['length']>0x186a0&&(_0x4dff07[_0x383024(0x826)]=await compressImage(_0x4dff07[_0x383024(0x826)],0x320,0.7),_0x27b599++));}await saveChatSettings(),calculateStorageUsage(),showToast(_0x383024(0x1d79)+_0x27b599+_0x383024(0x1238),_0x383024(0x11cb));}catch(_0x1d87ce){console['error'](_0x383024(0x201f),_0x1d87ce),showToast(_0x383024(0x1059),_0x383024(0x174a));}}async function cleanupStorageSpace(){const _0x4c1051=_0x211817;if(!confirm(_0x4c1051(0x1fba)))return;showToast(_0x4c1051(0x1a50),'info');let _0x184171=0x0,_0xcbd2fd=0x0;try{Object[_0x4c1051(0x1c9f)](chatSettings)['forEach'](_0x4cf8f9=>{const _0x4e56df=_0x4c1051;chatSettings[_0x4cf8f9]&&chatSettings[_0x4cf8f9][_0x4e56df(0x179f)]&&(delete chatSettings[_0x4cf8f9]['aiChatAvatar'],_0xcbd2fd++);});for(let _0x380f0c=localStorage[_0x4c1051(0x19ee)]-0x1;_0x380f0c>=0x0;_0x380f0c--){const _0x5bd7fe=localStorage[_0x4c1051(0x213c)](_0x380f0c);if(_0x5bd7fe&&_0x5bd7fe[_0x4c1051(0x1b30)](_0x4c1051(0xa25))){const _0x4f20ec=localStorage[_0x4c1051(0x15d8)](_0x5bd7fe);_0x4f20ec&&(_0x184171+=_0x4f20ec[_0x4c1051(0x19ee)],localStorage[_0x4c1051(0x3b2)](_0x5bd7fe),_0xcbd2fd++);}}for(const _0x1be284 of Object[_0x4c1051(0x1c9f)](chatSettings)){const _0x1eb3f4=chatSettings[_0x1be284];_0x1eb3f4&&(_0x1eb3f4[_0x4c1051(0x179f)]&&_0x1eb3f4[_0x4c1051(0x179f)][_0x4c1051(0x19ee)]>0xc350&&(_0x1eb3f4['aiChatAvatar']=await compressImage(_0x1eb3f4[_0x4c1051(0x179f)],0x96,0.6),_0xcbd2fd++),_0x1eb3f4[_0x4c1051(0x11cd)]&&_0x1eb3f4['myChatAvatar'][_0x4c1051(0x19ee)]>0xc350&&(_0x1eb3f4['myChatAvatar']=await compressImage(_0x1eb3f4[_0x4c1051(0x11cd)],0x96,0.6),_0xcbd2fd++));}await saveChatSettings();currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);const _0x298ad3=Math[_0x4c1051(0x13e2)](_0x184171/0x400);showToast('清理完成！释放了约\x20'+_0x298ad3+_0x4c1051(0xe40)+_0xcbd2fd+_0x4c1051(0xb0a),_0x4c1051(0x11cb));}catch(_0x15104a){console[_0x4c1051(0x174a)](_0x4c1051(0x1410),_0x15104a),showToast(_0x4c1051(0x116a),'error');}}function clearAiChatAvatar(){const _0x18a8b9=_0x211817;if(!currentChatCharacter)return;const _0x1cdc8d=getCurrentChatSettings();_0x1cdc8d[_0x18a8b9(0x179f)]?(delete _0x1cdc8d['aiChatAvatar'],saveCurrentChatSettings(_0x1cdc8d),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),forceRefreshAvatars(),showToast('已清除聊天头像，恢复为角色卡默认头像',_0x18a8b9(0x11cb))):showToast('没有聊天头像需要清除','info');}function saveChatIdentity(){const _0xe9d7e0=_0x211817;if(!window[_0xe9d7e0(0x8e0)]){alert(_0xe9d7e0(0x837));return;}const _0x3478ca=getCurrentChatSettings(),_0x52eda6=personas[_0xe9d7e0(0xaf4)](_0x560336=>_0x560336['id']===window[_0xe9d7e0(0x8e0)]);_0x52eda6&&(_0x3478ca['selectedIdentityId']=_0x52eda6['id'],_0x52eda6[_0xe9d7e0(0x1994)]&&!_0x3478ca[_0xe9d7e0(0x11cd)]&&(_0x3478ca[_0xe9d7e0(0x11cd)]=_0x52eda6[_0xe9d7e0(0x1994)]),_0x52eda6[_0xe9d7e0(0x1a1c)]&&!_0x3478ca[_0xe9d7e0(0x567)]&&(_0x3478ca[_0xe9d7e0(0x567)]=_0x52eda6['name']),saveCurrentChatSettings(_0x3478ca),updateChatIdentityDisplay(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),hideModal(_0xe9d7e0(0x76a)),showToast(_0xe9d7e0(0x2121)+_0x52eda6[_0xe9d7e0(0x1a1c)]+'\x22',_0xe9d7e0(0x11cb)));}async function updateChatIdentityDisplay(){const _0xbb1339=_0x211817;if(!currentChatCharacter){console[_0xbb1339(0x2187)]('更新聊天身份显示：无当前聊天角色，跳过操作');return;}const _0x17acb3=await getAsyncChatSettings(),_0x2e774b=_0x17acb3[_0xbb1339(0x145e)]||_0xbb1339(0x1094),_0x563218=personas['find'](_0x4c3ce3=>_0x4c3ce3['id']===_0x2e774b),_0x1fcdf4=document['getElementById'](_0xbb1339(0xb9b));_0x1fcdf4&&_0x563218&&(_0x1fcdf4['textContent']=_0x563218['name']);}async function updateBubbleStyleDisplay(){const _0x2579a7=_0x211817;if(!currentChatCharacter){console['log'](_0x2579a7(0xef3));return;}const _0x4a6fde=await getAsyncChatSettings(),_0x4768e2={'default':_0x2579a7(0x976),'shadow':_0x2579a7(0x1bae),'tail':_0x2579a7(0x575),'paper':_0x2579a7(0x56a)},_0x174198=document[_0x2579a7(0x1262)](_0x2579a7(0x99f));if(_0x174198){const _0xa6590a=_0x4a6fde[_0x2579a7(0x1813)]||'default';_0x174198['textContent']=_0x4768e2[_0xa6590a]||_0x2579a7(0x976);}}function handleAvatarUploadClick(){const _0x34fb7f=_0x211817;console[_0x34fb7f(0x2187)](_0x34fb7f(0x162c));const _0x4cf88e=document[_0x34fb7f(0x1262)](_0x34fb7f(0xf6d));_0x4cf88e?(console[_0x34fb7f(0x2187)](_0x34fb7f(0x3c2)),_0x4cf88e[_0x34fb7f(0x1859)]()):(console[_0x34fb7f(0x174a)](_0x34fb7f(0xe35)),alert(_0x34fb7f(0x257)));}function addMessageLongPressListener(_0x1b972d,_0x232630){const _0x23c5d3=_0x211817;let _0x5e7611=null,_0x807932=![],_0x4e154c={'x':0x0,'y':0x0};const _0x3fea85=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x23c5d3(0x11b8)](navigator[_0x23c5d3(0x214b)])||_0x23c5d3(0x1eaf)in window||navigator[_0x23c5d3(0x102c)]>0x0,_0x45d9d5=_0x34eadf=>{const _0x5532bc=_0x23c5d3;if(isMessageSelectionMode)return;const _0x38bd6e=_0x34eadf[_0x5532bc(0x2c6)]?_0x34eadf['touches'][0x0]:_0x34eadf;_0x4e154c['x']=_0x38bd6e[_0x5532bc(0x230)],_0x4e154c['y']=_0x38bd6e['clientY'],_0x807932=![],_0x5e7611=setTimeout(()=>{const _0x34d994=_0x5532bc;_0x807932=!![],navigator[_0x34d994(0xe3e)]&&_0x3fea85&&navigator[_0x34d994(0xe3e)](0x32),_0x3fea85?showMobileMessageMenu(_0x232630,_0x34eadf):enterMessageSelectionMode(_0x232630);},_0x3fea85?0x258:0x320);},_0x43f45c=_0x3daedf=>{_0x5e7611&&(clearTimeout(_0x5e7611),_0x5e7611=null),setTimeout(()=>{_0x807932=![];},0x64);},_0x1fd089=_0x3b1fc4=>{const _0x127959=_0x23c5d3;if(!_0x5e7611)return;const _0x39932d=_0x3b1fc4['touches']?_0x3b1fc4[_0x127959(0x2c6)][0x0]:_0x3b1fc4,_0x5c6021=Math['abs'](_0x39932d[_0x127959(0x230)]-_0x4e154c['x']),_0x434414=Math[_0x127959(0x1b24)](_0x39932d['clientY']-_0x4e154c['y']);(_0x5c6021>0xa||_0x434414>0xa)&&_0x43f45c(_0x3b1fc4);},_0x24d797=_0xfaf27a=>{const _0x2833fb=_0x23c5d3;if(isMessageSelectionMode){_0xfaf27a[_0x2833fb(0x36f)](),_0xfaf27a[_0x2833fb(0x902)](),toggleMessageSelection(_0x232630);return;}if(_0x807932){_0xfaf27a['preventDefault'](),_0xfaf27a[_0x2833fb(0x902)]();return;}};_0x3fea85?(_0x1b972d[_0x23c5d3(0x21e9)](_0x23c5d3(0x1728),_0x45d9d5,{'passive':![]}),_0x1b972d[_0x23c5d3(0x21e9)](_0x23c5d3(0x1c63),_0x43f45c,{'passive':![]}),_0x1b972d[_0x23c5d3(0x21e9)]('touchmove',_0x1fd089,{'passive':![]}),_0x1b972d[_0x23c5d3(0x21e9)]('touchcancel',_0x43f45c,{'passive':![]})):(_0x1b972d['addEventListener'](_0x23c5d3(0x5ac),_0x45d9d5),_0x1b972d[_0x23c5d3(0x21e9)]('mouseup',_0x43f45c),_0x1b972d['addEventListener']('mouseleave',_0x43f45c),_0x1b972d[_0x23c5d3(0x21e9)](_0x23c5d3(0xe7c),_0x1fd089)),_0x1b972d[_0x23c5d3(0x21e9)](_0x23c5d3(0x1859),_0x24d797,!![]);}function showMobileMessageMenu(_0x1184ad,_0xf09d4b){const _0x11cb57=_0x211817;console[_0x11cb57(0x2187)](_0x11cb57(0xb6e),_0x1184ad),selectedMessageId=_0x1184ad;const _0x327eba=chatMessages[currentChatCharacter['id']]||[],_0x360330=_0x327eba[_0x11cb57(0xaf4)](_0x347d5c=>_0x347d5c['id']===_0x1184ad),_0x446631=_0x360330&&_0x360330[_0x11cb57(0x8a1)]===_0x11cb57(0x1e6d);hideMessageActionBar();const _0x171cb9=document['querySelector'](_0x11cb57(0x732)+_0x1184ad+'\x22]');if(!_0x171cb9){console['log'](_0x11cb57(0x164b));return;}console['log'](_0x11cb57(0x4ef),_0x171cb9);const _0x1136d9=document[_0x11cb57(0xac6)](_0x11cb57(0xbbc));_0x1136d9['className']='message-action-bar',_0x1136d9['id']=_0x11cb57(0x1484);const _0x4ec7ba=['引用','复制'];!_0x446631&&_0x4ec7ba[_0x11cb57(0x1cd6)]('心声'),_0x4ec7ba[_0x11cb57(0x1cd6)]('编辑'),_0x446631&&_0x4ec7ba[_0x11cb57(0x1cd6)]('撤回'),_0x4ec7ba['push']('多选'),_0x1136d9['innerHTML']=_0x4ec7ba[_0x11cb57(0x6a4)](_0x27263e=>{const _0x14ce87=_0x11cb57;let _0x4a1182='';switch(_0x27263e){case'引用':_0x4a1182=_0x14ce87(0x1534)+_0x1184ad+'\x27)';break;case'复制':_0x4a1182='copyMessage(\x27'+_0x1184ad+'\x27)';break;case'心声':_0x4a1182=_0x14ce87(0x4c8)+_0x1184ad+'\x27)';break;case'编辑':_0x4a1182='showEditMessageModal(\x27'+_0x1184ad+'\x27)';break;case'撤回':_0x4a1182=_0x14ce87(0x8f6)+_0x1184ad+'\x27)';break;case'多选':_0x4a1182=_0x14ce87(0x543)+_0x1184ad+'\x27)';break;}return _0x14ce87(0x2068)+_0x4a1182+_0x14ce87(0x1d25)+_0x27263e+_0x14ce87(0x21b8);})['join'](''),_0x171cb9[_0x11cb57(0x497)](_0x1136d9),setTimeout(()=>{const _0x578dd4=_0x11cb57;_0x1136d9['classList'][_0x578dd4(0x21e2)]('show');},0xa),setTimeout(()=>{const _0x314468=_0x11cb57;document[_0x314468(0x21e9)](_0x314468(0x1859),hideMessageActionBarOnClickOutside),document[_0x314468(0x21e9)](_0x314468(0x1728),hideMessageActionBarOnClickOutside);},0x64);}function hideMessageActionBar(){const _0x26de7c=_0x211817,_0xb268f3=document['getElementById'](_0x26de7c(0x1484));_0xb268f3&&(_0xb268f3[_0x26de7c(0x1c1b)]['remove'](_0x26de7c(0x1c09)),setTimeout(()=>{const _0x3a916e=_0x26de7c;_0xb268f3[_0x3a916e(0x148c)]&&_0xb268f3[_0x3a916e(0x148c)][_0x3a916e(0x858)](_0xb268f3);},0x12c)),selectedMessageId=null,document[_0x26de7c(0xa21)](_0x26de7c(0x1859),hideMessageActionBarOnClickOutside),document[_0x26de7c(0xa21)]('touchstart',hideMessageActionBarOnClickOutside);}function hideMessageActionBarOnClickOutside(_0x489a64){const _0x28c6f0=_0x211817,_0x24a59b=document[_0x28c6f0(0x1262)]('message-action-bar');_0x24a59b&&!_0x24a59b['contains'](_0x489a64[_0x28c6f0(0x193d)])&&hideMessageActionBar();}function hideMobileMessageMenu(){hideMessageActionBar();}function enterMessageSelectionMode(_0x2cb074){const _0x277b01=_0x211817;if(isMessageSelectionMode)return;isMessageSelectionMode=!![],selectedMessages[_0x277b01(0xa4f)](),selectedMessages['add'](_0x2cb074);const _0x49b2a0=document[_0x277b01(0x1262)](_0x277b01(0xcf2));_0x49b2a0&&_0x49b2a0[_0x277b01(0x1c1b)]['add']('selection-mode'),updateMessageSelectionUI();}function toggleMessageSelection(_0x8e849b){const _0xcd0b4f=_0x211817;if(!isMessageSelectionMode)return;selectedMessages[_0xcd0b4f(0x975)](_0x8e849b)?selectedMessages[_0xcd0b4f(0x1f4a)](_0x8e849b):selectedMessages['add'](_0x8e849b),updateMessageSelectionUI(),selectedMessages[_0xcd0b4f(0x2d8)]===0x0&&exitMessageSelectionMode();}function exitMessageSelectionMode(){const _0xf5d95c=_0x211817;if(!isMessageSelectionMode)return;isMessageSelectionMode=![];const _0x1ca96c=document[_0xf5d95c(0x1262)](_0xf5d95c(0xcf2));_0x1ca96c&&_0x1ca96c[_0xf5d95c(0x1c1b)][_0xf5d95c(0x1493)](_0xf5d95c(0xf65));const _0x51fb9d=document[_0xf5d95c(0x1897)](_0xf5d95c(0x727));_0x51fb9d[_0xf5d95c(0x19fb)](_0x2a6fe1=>{const _0x3d09e2=_0xf5d95c;_0x2a6fe1[_0x3d09e2(0x1c1b)]['remove']('selected');}),selectedMessages[_0xf5d95c(0xa4f)](),updateMessageSelectionUI();}function updateMessageSelectionUI(){const _0x5d4ee4=_0x211817,_0x31dc30=document[_0x5d4ee4(0x1897)](_0x5d4ee4(0x5e8));_0x31dc30['forEach'](_0x2baf96=>{const _0x2d6934=_0x5d4ee4,_0x3288b7=_0x2baf96['dataset'][_0x2d6934(0x21c8)];_0x3288b7&&(selectedMessages[_0x2d6934(0x975)](_0x3288b7)?_0x2baf96[_0x2d6934(0x1c1b)][_0x2d6934(0x21e2)](_0x2d6934(0x176b)):_0x2baf96[_0x2d6934(0x1c1b)]['remove'](_0x2d6934(0x176b)));});const _0x244c7b=document[_0x5d4ee4(0x1262)](_0x5d4ee4(0x1f9e));_0x244c7b&&(_0x244c7b['textContent']=_0x5d4ee4(0xfe4)+selectedMessages[_0x5d4ee4(0x2d8)]+'\x20条');}let isDeletingMessages=![];async function deleteSelectedMessages(){const _0x1f1cb2=_0x211817;if(isDeletingMessages){console['log'](_0x1f1cb2(0x146f));return;}if(selectedMessages['size']===0x0)return;if(!currentChatCharacter)return;if(confirm(_0x1f1cb2(0xda3)+selectedMessages[_0x1f1cb2(0x2d8)]+_0x1f1cb2(0x131a))){isDeletingMessages=!![];const _0x4f71c3=currentChatCharacter['id'];if(chatMessages[_0x4f71c3])try{const _0xc07373=[];chatMessages[_0x4f71c3][_0x1f1cb2(0x19fb)](_0x535ee9=>{const _0x3a954f=_0x1f1cb2;selectedMessages[_0x3a954f(0x975)](_0x535ee9['id'])&&_0xc07373[_0x3a954f(0x1cd6)](_0x535ee9);});for(const _0x37e2c1 of _0xc07373){try{await deleteRelatedTimelineEvents(_0x37e2c1);const _0x250320=typeof _0x37e2c1[_0x1f1cb2(0x211c)]==='string'?_0x37e2c1[_0x1f1cb2(0x211c)]['substring'](0x0,0x1e):_0x37e2c1['content']?.[_0x1f1cb2(0x1378)]||_0x37e2c1['content']?.[_0x1f1cb2(0x1e8e)]||_0x1f1cb2(0x56f);console['log'](_0x1f1cb2(0xa23)+_0x250320+_0x1f1cb2(0x1520));}catch(_0x2f83fd){console[_0x1f1cb2(0x174a)](_0x1f1cb2(0x153e),_0x2f83fd);}}const _0x3378be=[];for(const _0x28bb7b of _0xc07373){const _0x4ff612=await db[_0x1f1cb2(0x19a2)][_0x1f1cb2(0xa24)]('characterId')['equals'](_0x4f71c3)[_0x1f1cb2(0x82f)](_0x49b81c=>_0x49b81c[_0x1f1cb2(0x2130)]===_0x28bb7b['id'])['first']();_0x4ff612&&_0x3378be[_0x1f1cb2(0x1cd6)](_0x4ff612['id']);}_0x3378be[_0x1f1cb2(0x19ee)]>0x0&&(await db[_0x1f1cb2(0x19a2)][_0x1f1cb2(0x1aaa)](_0x3378be),console[_0x1f1cb2(0x2187)]('✅\x20[高效删除]\x20数据库删除了\x20'+_0x3378be[_0x1f1cb2(0x19ee)]+_0x1f1cb2(0x197b))),chatMessages[_0x4f71c3]=chatMessages[_0x4f71c3][_0x1f1cb2(0x1e1f)](_0xddbe47=>{const _0xbe4958=_0x1f1cb2;return!selectedMessages[_0xbe4958(0x975)](_0xddbe47['id']);}),renderChatMessages(_0x4f71c3),renderMessageList();}catch(_0x3dcbc4){console[_0x1f1cb2(0x174a)]('高效删除失败，回退到传统方式:',_0x3dcbc4),chatMessages[_0x4f71c3]=chatMessages[_0x4f71c3][_0x1f1cb2(0x1e1f)](_0x2715e4=>{const _0x5c83a6=_0x1f1cb2;return!selectedMessages[_0x5c83a6(0x975)](_0x2715e4['id']);}),saveChatMessages(),renderChatMessages(_0x4f71c3),renderMessageList();}exitMessageSelectionMode(),isDeletingMessages=![];}else isDeletingMessages=![];}let isWaitingForReply=![],pendingUserMessage=null;async function regenerateLastResponse(){const _0x291a2b=_0x211817;if(!currentChatCharacter){alert('请先选择一个角色');return;}if(window[_0x291a2b(0xcb5)]){console[_0x291a2b(0x2187)](_0x291a2b(0x7b4));return;}window['_isRegenerating']=!![];const _0x1f342a=currentChatCharacter['id'],_0x320736=chatMessages[_0x1f342a]||[];let _0x5b78b2=-0x1,_0x5b026a=-0x1;for(let _0x1835d3=_0x320736[_0x291a2b(0x19ee)]-0x1;_0x1835d3>=0x0;_0x1835d3--){_0x320736[_0x1835d3][_0x291a2b(0x8a1)]===_0x291a2b(0xb11)&&_0x5b78b2===-0x1&&(_0x5b78b2=_0x1835d3);if(_0x5b78b2!==-0x1&&_0x320736[_0x1835d3][_0x291a2b(0x8a1)]==='sent'&&_0x5b026a===-0x1){_0x5b026a=_0x1835d3;break;}}if(_0x5b78b2===-0x1){alert(_0x291a2b(0x2303));return;}if(_0x5b026a===-0x1){alert(_0x291a2b(0x18f4));return;}const _0x5f15f5=_0x320736[_0x5b026a];chatMessages[_0x1f342a]=_0x320736[_0x291a2b(0x6d5)](0x0,_0x5b026a+0x1);try{const _0x5aaa95=[];for(let _0x5f24c6=_0x5b026a+0x1;_0x5f24c6<_0x320736[_0x291a2b(0x19ee)];_0x5f24c6++){const _0x1f69ad=_0x320736[_0x5f24c6],_0x25ef92=await db[_0x291a2b(0x19a2)][_0x291a2b(0xa24)](_0x291a2b(0xaf5))[_0x291a2b(0x1694)](_0x1f342a)[_0x291a2b(0x82f)](_0x251029=>_0x251029[_0x291a2b(0x2130)]===_0x1f69ad['id'])[_0x291a2b(0x1a7b)]();_0x25ef92&&_0x5aaa95['push'](_0x25ef92['id']);}_0x5aaa95[_0x291a2b(0x19ee)]>0x0&&(await db[_0x291a2b(0x19a2)][_0x291a2b(0x1aaa)](_0x5aaa95),console['log'](_0x291a2b(0x1ffd)+_0x5aaa95['length']+_0x291a2b(0xf3f)));}catch(_0x16ac14){console[_0x291a2b(0x174a)](_0x291a2b(0x2a8),_0x16ac14),await saveChatMessages();}await renderChatMessagesAsync(_0x1f342a),console['log'](_0x291a2b(0x1407)),await new Promise(_0xb5f03e=>{setTimeout(()=>{showTypingIndicator(),_0xb5f03e();},0x64);});const _0x1e6e66=Math['random']()*0x7d0+0x3e8;await new Promise(_0x13e470=>setTimeout(_0x13e470,_0x1e6e66));try{let _0x219ced;console[_0x291a2b(0x2187)](_0x291a2b(0x84e),_0x5f15f5),console[_0x291a2b(0x2187)](_0x291a2b(0x1b9a),!!_0x5f15f5[_0x291a2b(0x68e)]),console['log']('🔍\x20[AI处理调试]\x20是否为表情包:',_0x5f15f5['isEmoji']),console[_0x291a2b(0x2187)](_0x291a2b(0xf71),Array['isArray'](_0x5f15f5[_0x291a2b(0x211c)]));if(Array['isArray'](_0x5f15f5['content'])){console[_0x291a2b(0x2187)](_0x291a2b(0x93c));const _0xde8476=_0x5f15f5['content'][_0x291a2b(0x19fa)](_0x32b22c=>_0x32b22c[_0x291a2b(0x1a4b)]===_0x291a2b(0x910)),_0x3147f0=_0x5f15f5['originalMessages']?.[_0x291a2b(0x19fa)](_0x2d345=>_0x2d345[_0x291a2b(0x8e7)]);console[_0x291a2b(0x2187)](_0x291a2b(0x1925),_0xde8476),console[_0x291a2b(0x2187)](_0x291a2b(0x1e9e),_0x3147f0),console[_0x291a2b(0x2187)](_0x291a2b(0x960),apiSettings[_0x291a2b(0x9dd)]);const _0x102086=_0x5f15f5[_0x291a2b(0xc66)]?.[_0x291a2b(0xaf4)](_0x35dd14=>_0x35dd14[_0x291a2b(0x8e7)]),_0x24a73d=_0x102086?.[_0x291a2b(0x68e)]?.[_0x291a2b(0x1831)]('data:image/gif')||_0x102086?.[_0x291a2b(0x40f)]?.[_0x291a2b(0x1831)](_0x291a2b(0x194));console['log'](_0x291a2b(0x1371),_0x24a73d);if(_0xde8476&&_0x3147f0&&(apiSettings[_0x291a2b(0x9dd)]===![]||_0x24a73d)){const _0x24a1ca=_0x24a73d?_0x291a2b(0x1074):_0x291a2b(0x3a6),_0x19a39c='[用户发送了表情包：'+(_0x102086?.[_0x291a2b(0x29d)]||_0x291a2b(0x542))+']';console[_0x291a2b(0x2187)](_0x291a2b(0x7ab)+_0x24a1ca+'):',_0x19a39c),_0x219ced=await callChatAPI(_0x19a39c,currentChatCharacter);}else _0x219ced=await callChatAPI(_0x5f15f5[_0x291a2b(0x211c)],currentChatCharacter);}else{if(_0x5f15f5['image']){console[_0x291a2b(0x2187)]('🔍\x20[AI处理调试]\x20走图片分支');const _0x663542=_0x5f15f5[_0x291a2b(0x8e7)]&&_0x5f15f5[_0x291a2b(0x68e)]?.[_0x291a2b(0x1831)](_0x291a2b(0x194));console[_0x291a2b(0x2187)](_0x291a2b(0x3c9),_0x663542);if(_0x5f15f5[_0x291a2b(0x8e7)]&&(apiSettings[_0x291a2b(0x9dd)]===![]||_0x663542)){const _0x45afa0=_0x663542?'动图表情包':'表情包识别已关闭',_0x1024a9=_0x291a2b(0x979)+(_0x5f15f5[_0x291a2b(0x29d)]||'自定义表情包')+']';console[_0x291a2b(0x2187)](_0x291a2b(0x200b)+_0x45afa0+'):',_0x1024a9),_0x219ced=await callChatAPI(_0x1024a9,currentChatCharacter);}else{const _0x52485a=[{'type':'text','text':_0x5f15f5['content']||''},{'type':_0x291a2b(0x910),'image_url':{'url':_0x5f15f5['image']}}];console[_0x291a2b(0x2187)](_0x291a2b(0x78c),_0x52485a),console[_0x291a2b(0x2187)](_0x291a2b(0x23a),_0x5f15f5[_0x291a2b(0x68e)]),console['log'](_0x291a2b(0x113e),_0x5f15f5[_0x291a2b(0x8e7)]),_0x219ced=await callChatAPI(_0x52485a,currentChatCharacter);}}else{if(_0x5f15f5[_0x291a2b(0x1a4b)]===_0x291a2b(0x78a)){const _0x567e5a='[用户发起了转账：'+_0x5f15f5[_0x291a2b(0x2018)]+_0x291a2b(0xd17)+(_0x5f15f5[_0x291a2b(0x1814)]||'无')+']';_0x219ced=await callChatAPI(_0x567e5a,currentChatCharacter);}else{console[_0x291a2b(0x2187)](_0x291a2b(0x154c)),console['log'](_0x291a2b(0x1294),_0x5f15f5),console[_0x291a2b(0x2187)](_0x291a2b(0x1ddf),!!_0x5f15f5[_0x291a2b(0x68e)]),console[_0x291a2b(0x2187)](_0x291a2b(0x1501),_0x5f15f5[_0x291a2b(0x8e7)]);if(_0x5f15f5[_0x291a2b(0x68e)]&&_0x5f15f5[_0x291a2b(0x8e7)]){console[_0x291a2b(0x2187)](_0x291a2b(0x817)),console[_0x291a2b(0x2187)](_0x291a2b(0x1045),_0x5f15f5['image']),console['log'](_0x291a2b(0xe17),_0x5f15f5[_0x291a2b(0x29d)]),console['log']('🔍\x20[AI处理调试]\x20表情包识别设置:',apiSettings[_0x291a2b(0x9dd)]),console[_0x291a2b(0x2187)](_0x291a2b(0x48c),apiSettings),console[_0x291a2b(0x2187)](_0x291a2b(0x6a9),apiSettings[_0x291a2b(0x9dd)]);const _0x4a921e=_0x5f15f5[_0x291a2b(0x68e)]?.[_0x291a2b(0x1831)](_0x291a2b(0x194));console[_0x291a2b(0x2187)](_0x291a2b(0x1504),_0x4a921e);if(apiSettings[_0x291a2b(0x9dd)]===![]||_0x4a921e){const _0x411965=_0x4a921e?'动图表情包':'表情包识别已关闭',_0x65e938=_0x291a2b(0x979)+(_0x5f15f5['emojiDescription']||'自定义表情包')+']';console['log'](_0x291a2b(0xceb)+_0x411965+'):',_0x65e938),_0x219ced=await callChatAPI(_0x65e938,currentChatCharacter);}else{const _0x39afb3=[{'type':_0x291a2b(0x1378),'text':_0x5f15f5[_0x291a2b(0x211c)]||''},{'type':_0x291a2b(0x910),'image_url':{'url':_0x5f15f5[_0x291a2b(0x68e)]}}];console['log'](_0x291a2b(0xb8e),_0x39afb3),console['log']('🔍\x20[表情包修复]\x20图片URL长度:',_0x5f15f5[_0x291a2b(0x68e)]?.['length']),_0x219ced=await callChatAPI(_0x39afb3,currentChatCharacter);}}else{let _0x3658ce=_0x5f15f5[_0x291a2b(0x211c)];if(_0x5f15f5[_0x291a2b(0x1dbe)]){const _0x232910=summarizeLastMessage({'content':_0x5f15f5[_0x291a2b(0x1dbe)][_0x291a2b(0x211c)]});_0x3658ce=_0x291a2b(0x13b8)+_0x5f15f5['replyTo'][_0x291a2b(0x909)]+'\x20的消息:\x20\x22'+_0x232910+_0x291a2b(0x1fec)+_0x5f15f5[_0x291a2b(0x211c)],console[_0x291a2b(0x2187)](_0x291a2b(0x19a0),_0x3658ce);}_0x219ced=await callChatAPI(_0x3658ce,currentChatCharacter);}}}}const _0x480451=await parseAiResponse(_0x219ced);for(let _0x5386ac=0x0;_0x5386ac<_0x480451[_0x291a2b(0x19ee)];_0x5386ac++){const _0x3da5c7=_0x480451[_0x5386ac];let _0x23ff3c;console[_0x291a2b(0x2187)](_0x291a2b(0xe02),_0x5386ac,_0x3da5c7);if(typeof _0x3da5c7===_0x291a2b(0x28d)&&_0x3da5c7!==null){if(_0x3da5c7[_0x291a2b(0x1a4b)]==='voice_message')_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x13ed),'content':_0x3da5c7['content'],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x1a36)){_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x1a36),'content':_0x3da5c7[_0x291a2b(0x7c9)]||_0x291a2b(0xbb8),'imageDescription':_0x3da5c7[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};if(_0x3da5c7[_0x291a2b(0x1a1c)]){console[_0x291a2b(0x2187)](_0x291a2b(0x173b),_0x3da5c7[_0x291a2b(0x1a1c)]),_0x23ff3c[_0x291a2b(0x1a1c)]=_0x3da5c7[_0x291a2b(0x1a1c)];if(currentChatCharacter&&currentChatCharacter['isGroup']&&currentChatCharacter[_0x291a2b(0x12a6)]){const _0xc3d346=currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0xaf4)](_0x1b624a=>_0x1b624a[_0x291a2b(0x1a1c)]===_0x3da5c7[_0x291a2b(0x1a1c)]);_0xc3d346?(_0x23ff3c[_0x291a2b(0x12c8)]=_0xc3d346['id'],console[_0x291a2b(0x2187)](_0x291a2b(0xcfb),_0xc3d346['id'])):console['log'](_0x291a2b(0x12a5),_0x3da5c7[_0x291a2b(0x1a1c)]);}}}else{if(_0x3da5c7['type']===_0x291a2b(0x78a))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':'received','type':_0x291a2b(0x78a),'amount':_0x3da5c7['amount'],'note':_0x3da5c7[_0x291a2b(0x1814)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x11b3)){console[_0x291a2b(0x2187)]('🔍\x20[callChatAPI-第二处]\x20AI主动戳一戳:',_0x3da5c7);const _0x55ec0a=getCurrentChatSettings(),_0x2d8c9b=_0x55ec0a[_0x291a2b(0x567)]||'你',_0x1ba39b=_0x55ec0a[_0x291a2b(0x12e6)]||'';_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':_0x291a2b(0x1744),'content':currentChatCharacter['name']+_0x291a2b(0xf90)+_0x2d8c9b+_0x1ba39b,'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64,'isPoke':!![]};}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x1871))console[_0x291a2b(0x2187)](_0x291a2b(0x16e2),_0x3da5c7),_0x23ff3c=null;else{if(_0x3da5c7['type']===_0x291a2b(0x172b)&&!_0x3da5c7[_0x291a2b(0x1a1c)]){console[_0x291a2b(0x2187)](_0x291a2b(0x52e),_0x3da5c7);const _0x35c2b3=await findEmojiForAI(_0x3da5c7[_0x291a2b(0x7c9)]);_0x35c2b3?_0x23ff3c={'id':(Date['now']()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'content':'','image':_0x35c2b3[_0x291a2b(0x40f)],'isEmoji':!![],'emojiDescription':_0x35c2b3[_0x291a2b(0x7c9)],'timestamp':Date['now']()+_0x5386ac*0x64}:_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x291a2b(0x1fab)+_0x3da5c7['description']+_0x291a2b(0x1ae7),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x2ef)){console[_0x291a2b(0x2187)](_0x291a2b(0x243),_0x3da5c7);const _0x16898d=chatMessages[currentChatCharacter['id']]||[];let _0xf68112=-0x1;for(let _0x4839e0=_0x16898d[_0x291a2b(0x19ee)]-0x1;_0x4839e0>=0x0;_0x4839e0--){if(_0x16898d[_0x4839e0][_0x291a2b(0x8a1)]===_0x291a2b(0xb11)){_0xf68112=_0x4839e0;break;}}if(_0xf68112!==-0x1){const _0x5070ce=_0x16898d[_0xf68112];console['log'](_0x291a2b(0x3eb),_0x5070ce),await handleRecalledMessage(_0x5070ce[_0x291a2b(0x211c)],_0x5070ce['id']);}else console[_0x291a2b(0x1f43)]('🔥\x20没有找到可撤回的AI消息'),_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x291a2b(0x1fb3),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};continue;}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x1b17)){if(_0x3da5c7[_0x291a2b(0x3ab)]){let _0x38322f=_0x3da5c7[_0x291a2b(0x3ab)];if(_0x3da5c7[_0x291a2b(0x3ab)]===_0x291a2b(0xc50)||_0x3da5c7[_0x291a2b(0x3ab)]===_0x291a2b(0xc50)||_0x3da5c7[_0x291a2b(0x3ab)]==='用户发送的图片URL'||_0x3da5c7[_0x291a2b(0x3ab)]===_0x291a2b(0x13b0)){const _0x2a679a=getRecentUserImage();if(_0x2a679a)_0x38322f=_0x2a679a;else{_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x291a2b(0x1b96),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};continue;}}const _0x1df822=await validateAvatarSource(_0x38322f);if(_0x1df822){const _0x2b7c36=await changeCharacterAvatarByAI(_0x38322f,_0x3da5c7[_0x291a2b(0xa84)]||'心情变化');if(_0x2b7c36)continue;else _0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'content':'[头像更换失败]','timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}else _0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':'received','content':_0x291a2b(0x1591),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}else continue;}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x1f2a)){console[_0x291a2b(0x2187)](_0x291a2b(0x482),_0x3da5c7);const _0x331458=findMessageById(_0x3da5c7[_0x291a2b(0x7a2)]);console[_0x291a2b(0x2187)](_0x291a2b(0x10df),_0x331458);if(_0x331458){_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':'received','content':_0x3da5c7[_0x291a2b(0x211c)],'replyTo':{'id':_0x331458['id'],'content':_0x331458[_0x291a2b(0x211c)],'senderName':_0x331458['sender']===_0x291a2b(0x1e6d)?getCurrentPersonaName()||'用户':currentChatCharacter[_0x291a2b(0x1a1c)]||'AI'},'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};if(_0x3da5c7['name']&&currentChatCharacter?.['isGroup']&&currentChatCharacter['members']){const _0x348316=currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0xaf4)](_0x336d61=>_0x336d61['name']===_0x3da5c7[_0x291a2b(0x1a1c)]);_0x348316?(_0x23ff3c[_0x291a2b(0x1a1c)]=_0x3da5c7[_0x291a2b(0x1a1c)],_0x23ff3c[_0x291a2b(0x12c8)]=_0x348316['id'],console[_0x291a2b(0x2187)](_0x291a2b(0x222d),_0x3da5c7[_0x291a2b(0x1a1c)],_0x291a2b(0x180e),_0x348316['id'])):console[_0x291a2b(0x2187)](_0x291a2b(0x1711),_0x3da5c7['name']);}}else{console[_0x291a2b(0x1f43)](_0x291a2b(0x6bc),_0x3da5c7[_0x291a2b(0x7a2)]),_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x3da5c7[_0x291a2b(0x211c)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};if(_0x3da5c7[_0x291a2b(0x1a1c)]&&currentChatCharacter?.[_0x291a2b(0x1f68)]&&currentChatCharacter[_0x291a2b(0x12a6)]){const _0x29054c=currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0xaf4)](_0x4fc91a=>_0x4fc91a[_0x291a2b(0x1a1c)]===_0x3da5c7[_0x291a2b(0x1a1c)]);_0x29054c?(_0x23ff3c[_0x291a2b(0x1a1c)]=_0x3da5c7[_0x291a2b(0x1a1c)],_0x23ff3c['senderId']=_0x29054c['id'],console[_0x291a2b(0x2187)](_0x291a2b(0x18b),_0x3da5c7[_0x291a2b(0x1a1c)],_0x291a2b(0x180e),_0x29054c['id'])):console[_0x291a2b(0x2187)]('🔍\x20[引用回复-早期分支-fallback]\x20未找到群成员:',_0x3da5c7['name']);}}}else{if(_0x3da5c7[_0x291a2b(0x1a1c)]&&_0x3da5c7[_0x291a2b(0x1a4b)]==='emoji'){console[_0x291a2b(0x2187)](_0x291a2b(0x1e87),_0x3da5c7);let _0x223759=null;if(currentChatCharacter&&currentChatCharacter[_0x291a2b(0x1f68)]&&currentChatCharacter[_0x291a2b(0x12a6)]){console[_0x291a2b(0x2187)](_0x291a2b(0x1201),{'targetName':_0x3da5c7[_0x291a2b(0x1a1c)],'allMembers':currentChatCharacter[_0x291a2b(0x12a6)],'memberNames':currentChatCharacter['members'][_0x291a2b(0x6a4)](_0x1c4437=>_0x1c4437[_0x291a2b(0x1a1c)])});const _0x51ec09=currentChatCharacter[_0x291a2b(0x12a6)]['find'](_0x480013=>_0x480013[_0x291a2b(0x1a1c)]===_0x3da5c7['name']);_0x51ec09?(_0x223759=_0x51ec09['id'],console[_0x291a2b(0x2187)](_0x291a2b(0x1977),_0x51ec09,_0x291a2b(0x1605),_0x223759)):(console[_0x291a2b(0x1f43)](_0x291a2b(0x7f1),_0x3da5c7['name']),console[_0x291a2b(0x1f43)](_0x291a2b(0x1dd9),currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0x6a4)](_0x4d2203=>_0x4d2203[_0x291a2b(0x1a1c)])));}const _0x186646=await findEmojiForAI(_0x3da5c7[_0x291a2b(0x7c9)]);_0x186646?(console[_0x291a2b(0x2187)]('🔍\x20[群聊表情包-直接格式]\x20找到匹配的表情包:',_0x186646),_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x223759,'content':'','image':_0x186646[_0x291a2b(0x40f)],'isEmoji':!![],'emojiDescription':_0x186646[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64},console[_0x291a2b(0x2187)](_0x291a2b(0x433),_0x23ff3c)):(console[_0x291a2b(0x1f43)]('🔍\x20[群聊表情包-直接格式]\x20找不到匹配的表情包:',_0x3da5c7[_0x291a2b(0x7c9)]),_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x223759,'content':_0x291a2b(0x1fab)+_0x3da5c7['description']+_0x291a2b(0x1ae7),'timestamp':Date['now']()+_0x5386ac*0x64});}else{if(_0x3da5c7[_0x291a2b(0x1a1c)]&&_0x3da5c7['message']){console[_0x291a2b(0x2187)](_0x291a2b(0x1fdd),_0x3da5c7),console['log']('🔍\x20[群聊消息]\x20msgData.message类型:',typeof _0x3da5c7[_0x291a2b(0x1e8e)],_0x291a2b(0x2010),_0x3da5c7[_0x291a2b(0x1e8e)]);let _0x1a9448=null;if(currentChatCharacter&&currentChatCharacter[_0x291a2b(0x1f68)]&&currentChatCharacter['members']){console[_0x291a2b(0x2187)]('🔍\x20[群聊身份]\x20查找成员:',_0x3da5c7['name'],_0x291a2b(0x2f1),currentChatCharacter[_0x291a2b(0x1a1c)]),console['log'](_0x291a2b(0x5fc),currentChatCharacter[_0x291a2b(0x12a6)]);const _0x3578e3=currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0xaf4)](_0x58fb87=>_0x58fb87[_0x291a2b(0x1a1c)]===_0x3da5c7[_0x291a2b(0x1a1c)]);_0x3578e3?(_0x1a9448=_0x3578e3['id'],console['log'](_0x291a2b(0x218a),_0x3578e3,_0x291a2b(0x1605),_0x1a9448)):console[_0x291a2b(0x1f43)](_0x291a2b(0x1dc),_0x3da5c7[_0x291a2b(0x1a1c)]);}if(typeof _0x3da5c7['message']===_0x291a2b(0x28d)&&_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x1a4b)]===_0x291a2b(0x13ed))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x13ed),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'content':_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x211c)],'timestamp':Date['now']()+_0x5386ac*0x64};else{if(typeof _0x3da5c7['message']===_0x291a2b(0x28d)&&_0x3da5c7['message']['type']===_0x291a2b(0x1f2a)){const _0x54159b=findMessageById(_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x7a2)]);_0x54159b?_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'content':_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x211c)],'replyTo':{'id':_0x54159b['id'],'content':_0x54159b[_0x291a2b(0x211c)],'senderName':_0x54159b[_0x291a2b(0x8a1)]===_0x291a2b(0x1e6d)?getCurrentPersonaName()||'用户':_0x54159b[_0x291a2b(0x1a1c)]||_0x54159b[_0x291a2b(0x909)]||'AI'},'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64}:_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':'received','name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'content':_0x3da5c7['message']['content'],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}else{if(typeof _0x3da5c7['message']===_0x291a2b(0x28d)&&_0x3da5c7['message'][_0x291a2b(0x1a4b)]==='emoji'){console[_0x291a2b(0x2187)](_0x291a2b(0x729),_0x3da5c7);const _0x10aa8f=await findEmojiForAI(_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x7c9)]);_0x10aa8f?(console[_0x291a2b(0x2187)](_0x291a2b(0x45a),_0x10aa8f),_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7['name'],'senderId':_0x1a9448,'content':'','image':_0x10aa8f[_0x291a2b(0x40f)],'isEmoji':!![],'emojiDescription':_0x10aa8f[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64},console[_0x291a2b(0x2187)](_0x291a2b(0x710),_0x23ff3c),console[_0x291a2b(0x2187)](_0x291a2b(0x1b51),_0x1a9448,_0x291a2b(0x1474),_0x3da5c7['name'])):(console['warn'](_0x291a2b(0x2202),_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x7c9)]),_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'content':_0x291a2b(0x1fab)+_0x3da5c7['message'][_0x291a2b(0x7c9)]+'\x22不存在]','timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64});}else{if(typeof _0x3da5c7[_0x291a2b(0x1e8e)]===_0x291a2b(0x28d)&&_0x3da5c7['message']['type']===_0x291a2b(0x78a))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x78a),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'amount':_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x2018)],'note':_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x1814)],'timestamp':Date['now']()+_0x5386ac*0x64};else typeof _0x3da5c7[_0x291a2b(0x1e8e)]===_0x291a2b(0x28d)&&_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x1a4b)]===_0x291a2b(0x2051)?_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x2051),'name':_0x3da5c7[_0x291a2b(0x1a1c)],'senderId':_0x1a9448,'message':_0x3da5c7[_0x291a2b(0x1e8e)][_0x291a2b(0x1e8e)],'timestamp':Date['now']()+_0x5386ac*0x64}:_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'name':_0x3da5c7['name'],'senderId':_0x1a9448,'content':_0x3da5c7[_0x291a2b(0x1e8e)],'timestamp':Date['now']()+_0x5386ac*0x64};}}}}else{if(typeof _0x3da5c7===_0x291a2b(0x28d)&&_0x3da5c7!==null){if(_0x3da5c7['type']===_0x291a2b(0x78a))_0x23ff3c={'id':(Date['now']()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x78a),'amount':_0x3da5c7[_0x291a2b(0x2018)],'note':_0x3da5c7[_0x291a2b(0x1814)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x13ed))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x13ed),'content':_0x3da5c7[_0x291a2b(0x211c)],'timestamp':Date['now']()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]==='ai_image')_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x1a36),'content':'','image':_0x291a2b(0x1eb5)+encodeURIComponent(_0x291a2b(0x2041)),'imageDescription':_0x3da5c7[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7['type']===_0x291a2b(0x1871))console['log'](_0x291a2b(0x1521),_0x3da5c7),_0x23ff3c=null;else{if(_0x3da5c7[_0x291a2b(0x1a4b)]==='emoji'){console[_0x291a2b(0x2187)](_0x291a2b(0x1370),_0x3da5c7);const _0x493a66=await findEmojiForAI(_0x3da5c7[_0x291a2b(0x7c9)]);if(_0x493a66){_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':'','image':_0x493a66[_0x291a2b(0x40f)],'isEmoji':!![],'emojiDescription':_0x493a66[_0x291a2b(0x7c9)],'timestamp':Date['now']()+_0x5386ac*0x64};if(currentChatCharacter&&currentChatCharacter[_0x291a2b(0x1f68)]){if(currentChatCharacter[_0x291a2b(0x12a6)]&&currentChatCharacter[_0x291a2b(0x12a6)]['length']>0x0){const _0xb9e88c=currentChatCharacter[_0x291a2b(0x12a6)][0x0];_0x23ff3c[_0x291a2b(0x1a1c)]=_0xb9e88c['name'],_0x23ff3c[_0x291a2b(0x12c8)]=_0xb9e88c['id'],console['log'](_0x291a2b(0x14b4),_0xb9e88c[_0x291a2b(0x1a1c)],_0x291a2b(0x180e),_0xb9e88c['id']);}}console[_0x291a2b(0x2187)](_0x291a2b(0x14c9),_0x23ff3c);}else{_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':'received','content':_0x291a2b(0x1fab)+_0x3da5c7['description']+_0x291a2b(0x1ae7),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};if(currentChatCharacter&&currentChatCharacter[_0x291a2b(0x1f68)]){if(currentChatCharacter['members']&&currentChatCharacter[_0x291a2b(0x12a6)][_0x291a2b(0x19ee)]>0x0){const _0x346b69=currentChatCharacter[_0x291a2b(0x12a6)][0x0];_0x23ff3c[_0x291a2b(0x1a1c)]=_0x346b69['name'],_0x23ff3c[_0x291a2b(0x12c8)]=_0x346b69['id'];}}}}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]&&[_0x291a2b(0x1fe3),_0x291a2b(0x16fc),'block_user',_0x291a2b(0x1a3),'internal_action',_0x291a2b(0x1f55)][_0x291a2b(0x1831)](_0x3da5c7[_0x291a2b(0x1a4b)])){console['log'](_0x291a2b(0x184b),_0x3da5c7);continue;}const _0x701b64=_0x3da5c7['content']||_0x3da5c7[_0x291a2b(0x1e8e)]||_0x3da5c7[_0x291a2b(0x1378)]||_0x3da5c7[_0x291a2b(0xd5f)]||_0x291a2b(0x3c5);_0x23ff3c={'id':(Date['now']()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'content':_0x701b64,'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}}}}}}else{const _0x46f80c=String(_0x3da5c7);_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':'received','content':_0x46f80c,'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}}}}}}}}}}}}}else{if(typeof _0x3da5c7===_0x291a2b(0x28d)&&_0x3da5c7!==null){if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x78a))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'type':'transfer','amount':_0x3da5c7[_0x291a2b(0x2018)],'note':_0x3da5c7['note'],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x13ed))_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)['toString'](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x13ed),'content':_0x3da5c7['content'],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x1a36)){_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'type':_0x291a2b(0x1a36),'content':_0x3da5c7['description']||_0x291a2b(0xbb8),'imageDescription':_0x3da5c7[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};if(_0x3da5c7[_0x291a2b(0x1a1c)]){console[_0x291a2b(0x2187)](_0x291a2b(0xf0b),_0x3da5c7[_0x291a2b(0x1a1c)]),_0x23ff3c[_0x291a2b(0x1a1c)]=_0x3da5c7[_0x291a2b(0x1a1c)];if(currentChatCharacter&&currentChatCharacter[_0x291a2b(0x1f68)]&&currentChatCharacter[_0x291a2b(0x12a6)]){const _0x1a5817=currentChatCharacter[_0x291a2b(0x12a6)]['find'](_0x486af1=>_0x486af1[_0x291a2b(0x1a1c)]===_0x3da5c7[_0x291a2b(0x1a1c)]);_0x1a5817?(_0x23ff3c[_0x291a2b(0x12c8)]=_0x1a5817['id'],console[_0x291a2b(0x2187)](_0x291a2b(0xe18),_0x1a5817['id'])):console[_0x291a2b(0x2187)]('🔍\x20[第四处-AI图片]\x20未找到群成员:',_0x3da5c7[_0x291a2b(0x1a1c)]);}}}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]===_0x291a2b(0x172b)){const _0x2da350=await findEmojiForAI(_0x3da5c7[_0x291a2b(0x7c9)]);_0x2da350?_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':'received','content':'','image':_0x2da350[_0x291a2b(0x40f)],'isEmoji':!![],'emojiDescription':_0x2da350[_0x291a2b(0x7c9)],'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64}:_0x23ff3c={'id':(Date['now']()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x291a2b(0x1fab)+_0x3da5c7['description']+'\x22不存在]','timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64};}else{if(_0x3da5c7[_0x291a2b(0x1a4b)]&&[_0x291a2b(0x1fe3),_0x291a2b(0x16fc),_0x291a2b(0x21f),_0x291a2b(0x1a3),_0x291a2b(0x361),_0x291a2b(0x1f55)][_0x291a2b(0x1831)](_0x3da5c7[_0x291a2b(0x1a4b)])){console[_0x291a2b(0x2187)](_0x291a2b(0x4ff),_0x3da5c7);continue;}const _0x4a72ab=_0x3da5c7[_0x291a2b(0x211c)]||_0x3da5c7[_0x291a2b(0x1e8e)]||_0x3da5c7[_0x291a2b(0x1378)]||_0x3da5c7[_0x291a2b(0xd5f)]||'[不支持的消息格式]';_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x4a72ab,'timestamp':Date['now']()+_0x5386ac*0x64};}}}}}else typeof _0x3da5c7===_0x291a2b(0x11b7)?(console['log'](_0x291a2b(0xab3),_0x3da5c7),_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':_0x3da5c7,'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64}):(console[_0x291a2b(0x2187)]('🔥\x20[DEBUG]\x20处理其他类型消息:',typeof _0x3da5c7,_0x3da5c7),_0x23ff3c={'id':(Date[_0x291a2b(0x2eb)]()+_0x5386ac)[_0x291a2b(0x1878)](),'sender':_0x291a2b(0xb11),'content':String(_0x3da5c7),'timestamp':Date[_0x291a2b(0x2eb)]()+_0x5386ac*0x64});}chatMessages[_0x1f342a]['push'](_0x23ff3c);try{const _0x2159fb=_0x1f342a+'_ai_reply_'+_0x23ff3c[_0x291a2b(0x1716)]+'_'+Math[_0x291a2b(0x11a8)]()['toString'](0x24)[_0x291a2b(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x1f342a][_0x291a2b(0x19ee)]-0x1);await db[_0x291a2b(0x19a2)]['add']({'id':_0x2159fb,'characterId':_0x1f342a,'timestamp':_0x23ff3c[_0x291a2b(0x1716)],'messageOrder':chatMessages[_0x1f342a][_0x291a2b(0x19ee)]-0x1,'originalMessageId':_0x23ff3c['id'],'messageData':_0x23ff3c}),console[_0x291a2b(0x2187)](_0x291a2b(0x2176));}catch(_0x52d469){console[_0x291a2b(0x174a)]('AI消息单条保存失败，回退到批量保存:',_0x52d469),await saveChatMessages();}const _0x3b7261=characters[_0x291a2b(0xaf4)](_0x4fca9e=>_0x4fca9e['id']===_0x1f342a);if(_0x3b7261){const _0x5ddea4={'sender':_0x1f342a,'content':_0x23ff3c[_0x291a2b(0x211c)]||_0x291a2b(0x424),'messageType':_0x23ff3c[_0x291a2b(0x1a4b)]||_0x291a2b(0x1378)};_0x23ff3c[_0x291a2b(0x1dbe)]&&(_0x5ddea4[_0x291a2b(0x1360)]=_0x23ff3c[_0x291a2b(0x1dbe)]['id'],_0x5ddea4['replyToSender']=_0x23ff3c[_0x291a2b(0x1dbe)][_0x291a2b(0x909)],_0x5ddea4[_0x291a2b(0xde3)]=_0x23ff3c[_0x291a2b(0x1dbe)][_0x291a2b(0x211c)]),await recordMemoryEvent([_0x1f342a,_0x291a2b(0xa80)],{'type':_0x3b7261['isGroup']?'group_chat':_0x291a2b(0x219),'id':_0x1f342a},_0x291a2b(0x1e8e),_0x5ddea4,0.7);}_0x5386ac===0x0&&hideTypingIndicator();addMessageWithAnimation(_0x23ff3c,_0x1f342a);if(_0x5386ac<_0x480451[_0x291a2b(0x19ee)]-0x1){const _0x5766d5=Math[_0x291a2b(0x11a8)]()*0x3e8+0x1f4;await new Promise(_0x2a2986=>setTimeout(_0x2a2986,_0x5766d5)),showTypingIndicator(),await new Promise(_0x1dd120=>setTimeout(_0x1dd120,Math['random']()*0x320+0x190)),hideTypingIndicator();}}}catch(_0xf90227){console['error']('重新生成失败:',_0xf90227),hideTypingIndicator();const _0x260818={'id':Date[_0x291a2b(0x2eb)]()['toString'](),'sender':'received','content':_0x291a2b(0x2177)+_0xf90227['message']+']','timestamp':Date['now']()};chatMessages[_0x1f342a][_0x291a2b(0x1cd6)](_0x260818);try{await saveChatMessagesImmediate([_0x1f342a]),console[_0x291a2b(0x2187)](_0x291a2b(0x2243));}catch(_0x6be35b){console[_0x291a2b(0x174a)]('错误消息保存失败，回退到全量保存:',_0x6be35b),await saveChatMessages();}renderChatMessages(_0x1f342a);}finally{pendingUserMessage=null,window[_0x291a2b(0xcb5)]=![];}updateFloatingButtonsVisibility();}function triggerSmartReply(){const _0x333b83=_0x211817;console[_0x333b83(0x2187)](_0x333b83(0x1e5b)),console[_0x333b83(0x2187)](_0x333b83(0x1443),new Error()[_0x333b83(0x1574)]);if(!currentChatCharacter){alert(_0x333b83(0x1346));return;}if(isWaitingForReply)return;const _0xbb3fe3=chatMessages[currentChatCharacter['id']]||[];let _0x593703=[],_0x4076a2=-0x1;for(let _0xb4fed3=_0xbb3fe3['length']-0x1;_0xb4fed3>=0x0;_0xb4fed3--){if(_0xbb3fe3[_0xb4fed3][_0x333b83(0x8a1)]===_0x333b83(0xb11)){_0x4076a2=_0xb4fed3;break;}}for(let _0x59fc71=_0x4076a2+0x1;_0x59fc71<_0xbb3fe3[_0x333b83(0x19ee)];_0x59fc71++){_0xbb3fe3[_0x59fc71][_0x333b83(0x8a1)]==='sent'&&_0x593703['push'](_0xbb3fe3[_0x59fc71]);}const _0x28bc53=_0xbb3fe3[_0x333b83(0x6d5)]()[_0x333b83(0x16b0)]()['find'](_0x21c1cc=>_0x21c1cc[_0x333b83(0x8a1)]===_0x333b83(0x1e6d)),_0x1e2803=_0x593703[_0x333b83(0x19ee)]>0x0;if(_0x593703['length']>0x0){console[_0x333b83(0x2187)]('🔍\x20[triggerSmartReply]\x20找到未回复的用户消息数量:',_0x593703[_0x333b83(0x19ee)]);const _0x1bd9d5=[];let _0x210d93='',_0x50845a=0x0;_0x593703[_0x333b83(0x19fb)]((_0x24e23a,_0x169968)=>{const _0x240aea=_0x333b83;console[_0x240aea(0x2187)]('🔍\x20[triggerSmartReply]\x20处理消息\x20'+(_0x169968+0x1)+':',{'id':_0x24e23a['id'],'type':_0x24e23a[_0x240aea(0x1a4b)],'contentLength':Array[_0x240aea(0x1496)](_0x24e23a['content'])?_0x24e23a[_0x240aea(0x211c)][_0x240aea(0x19ee)]:0x1,'hasImage':Array['isArray'](_0x24e23a[_0x240aea(0x211c)])?_0x24e23a['content'][_0x240aea(0x19fa)](_0xa22142=>_0xa22142[_0x240aea(0x1a4b)]===_0x240aea(0x910)):!!_0x24e23a['image']});if(_0x24e23a[_0x240aea(0x1a4b)]===_0x240aea(0x78a)&&_0x24e23a['status']){console['log']('🔍\x20[triggerSmartReply]\x20跳过已处理的转账消息:',_0x24e23a);return;}if(Array[_0x240aea(0x1496)](_0x24e23a[_0x240aea(0x211c)]))_0x1bd9d5['push'](..._0x24e23a['content']);else{if(_0x24e23a['type']===_0x240aea(0x78a)){const _0x89eda=_0x240aea(0x213e)+_0x24e23a[_0x240aea(0x2018)]+_0x240aea(0xd17)+(_0x24e23a[_0x240aea(0x1814)]||'无')+']';_0x1bd9d5[_0x240aea(0x1cd6)]({'type':'text','text':_0x89eda}),console[_0x240aea(0x2187)](_0x240aea(0x1d07),_0x89eda);}else{if(_0x24e23a[_0x240aea(0x1a4b)]==='voice_message'){const _0x1fc04b=_0x240aea(0x208e)+_0x24e23a['content']+'\x27]';_0x1bd9d5[_0x240aea(0x1cd6)]({'type':_0x240aea(0x1378),'text':_0x1fc04b}),console[_0x240aea(0x2187)]('🔍\x20[triggerSmartReply]\x20添加语音消息:',_0x1fc04b);}else{if(_0x24e23a['type']===_0x240aea(0xd38)){const _0x58b97b='[用户发送了一张照片，描述是：\x27'+_0x24e23a['content']+'\x27]';_0x1bd9d5[_0x240aea(0x1cd6)]({'type':_0x240aea(0x1378),'text':_0x58b97b}),console[_0x240aea(0x2187)](_0x240aea(0x196e),_0x58b97b);}else{if(_0x24e23a[_0x240aea(0x1a4b)]===_0x240aea(0x2184)){const _0x2d5e9d=_0x24e23a[_0x240aea(0x211c)]||_0x240aea(0x20d3)+_0x24e23a[_0x240aea(0x1b93)]+']';_0x1bd9d5['push']({'type':_0x240aea(0x1378),'text':_0x2d5e9d}),console[_0x240aea(0x2187)](_0x240aea(0x26c),_0x2d5e9d);}else _0x24e23a[_0x240aea(0x68e)]?(_0x24e23a[_0x240aea(0x211c)]&&_0x1bd9d5[_0x240aea(0x1cd6)]({'type':_0x240aea(0x1378),'text':_0x24e23a['content']}),_0x1bd9d5[_0x240aea(0x1cd6)]({'type':_0x240aea(0x910),'image_url':{'url':_0x24e23a[_0x240aea(0x68e)]}})):_0x1bd9d5[_0x240aea(0x1cd6)]({'type':_0x240aea(0x1378),'text':_0x24e23a['content']});}}}}_0x210d93+=_0x24e23a['id']+'_',_0x50845a=Math[_0x240aea(0x658)](_0x50845a,_0x24e23a[_0x240aea(0x1716)]);}),pendingUserMessage={'id':_0x210d93[_0x333b83(0x6d5)](0x0,-0x1),'sender':_0x333b83(0x1e6d),'content':_0x1bd9d5,'timestamp':_0x50845a,'isMerged':!![],'originalMessages':_0x593703},console[_0x333b83(0x2187)](_0x333b83(0x21de),{'contentLength':pendingUserMessage[_0x333b83(0x211c)][_0x333b83(0x19ee)],'hasText':pendingUserMessage[_0x333b83(0x211c)]['some'](_0x328cb4=>_0x328cb4[_0x333b83(0x1a4b)]===_0x333b83(0x1378)),'hasImage':pendingUserMessage['content'][_0x333b83(0x19fa)](_0x35584b=>_0x35584b['type']===_0x333b83(0x910)),'textCount':pendingUserMessage['content'][_0x333b83(0x1e1f)](_0x13de98=>_0x13de98['type']===_0x333b83(0x1378))[_0x333b83(0x19ee)],'imageCount':pendingUserMessage['content'][_0x333b83(0x1e1f)](_0x306c98=>_0x306c98[_0x333b83(0x1a4b)]===_0x333b83(0x910))[_0x333b83(0x19ee)]}),processAIReply();return;}if(_0x28bc53&&!_0x1e2803){let _0x47a66d=0x0,_0x5d64c3=-0x1;for(let _0x74360a=_0xbb3fe3[_0x333b83(0x19ee)]-0x1;_0x74360a>=0x0;_0x74360a--){if(_0xbb3fe3[_0x74360a]['sender']===_0x333b83(0x1e6d)){_0x5d64c3=_0x74360a;break;}}if(_0x5d64c3!==-0x1){let _0x41dc9c=![];for(let _0x2df939=_0x5d64c3+0x1;_0x2df939<_0xbb3fe3[_0x333b83(0x19ee)];_0x2df939++){_0xbb3fe3[_0x2df939][_0x333b83(0x8a1)]===_0x333b83(0xb11)?!_0x41dc9c&&(_0x47a66d++,_0x41dc9c=!![]):_0x41dc9c=![];}}if(_0x47a66d>=0x3){const _0x264061=currentChatCharacter[_0x333b83(0x1a1c)];alert(_0x264061+_0x333b83(0x209a)+_0x264061+_0x333b83(0x1b3d));return;}const _0x5c8269=_0xbb3fe3[_0x333b83(0x6d5)]()[_0x333b83(0x16b0)]()[_0x333b83(0xaf4)](_0x3db3ee=>_0x3db3ee['sender']===_0x333b83(0x1e6d)&&_0x3db3ee[_0x333b83(0x1a4b)]===_0x333b83(0x78a)&&!_0x3db3ee[_0x333b83(0x12e2)]);if(_0x5c8269){pendingUserMessage=_0x5c8269,processAIReply();return;}processAIContinuation();return;}alert(_0x333b83(0x1e7d));}async function processAIContinuation(){const _0x16dcd0=_0x211817;if(!currentChatCharacter)return;if(isWaitingForReply){console['log'](_0x16dcd0(0xf91));return;}const _0x252890=currentChatCharacter['id'];isWaitingForReply=!![];const _0x3c241e=document[_0x16dcd0(0x1262)](_0x16dcd0(0x1d2b));_0x3c241e&&(_0x3c241e[_0x16dcd0(0x559)]=!![],_0x3c241e['style']['opacity']=_0x16dcd0(0xaa8),_0x3c241e[_0x16dcd0(0x33a)]=_0x16dcd0(0x1b42));showTypingIndicator();const _0x4ce201=Math[_0x16dcd0(0x11a8)]()*0x7d0+0x3e8;await new Promise(_0x5f4d79=>setTimeout(_0x5f4d79,_0x4ce201));try{const _0x438167=chatMessages[_0x252890]||[];let _0x9a908d='';for(let _0x3149e4=_0x438167[_0x16dcd0(0x19ee)]-0x1;_0x3149e4>=0x0;_0x3149e4--){if(_0x438167[_0x3149e4][_0x16dcd0(0x8a1)]===_0x16dcd0(0xb11)){_0x9a908d=_0x438167[_0x3149e4][_0x16dcd0(0x211c)]||'';break;}}let _0x584f9f='你刚才说了：\x22'+_0x9a908d+_0x16dcd0(0x1bc0);_0x584f9f+='现在请基于你刚才说的话，主动继续这个话题或者自然地转到相关话题。就像真实聊天中，你想要继续表达更多想法，或者询问对方的看法，或者分享相关的内容。请自然地继续对话，不要重复之前说过的话。',_0x584f9f+='\x0a\x0a🚨\x20重要提醒：请严格遵守JSON格式，每条消息必须分开发送，绝对不能将多条消息合并在一个元素中！正确格式：[\x22消息1\x22,\x20\x22消息2\x22]，错误格式：[\x22消息1\x5cn消息2\x22]';const _0x4935fc=await callChatAPI(_0x584f9f,currentChatCharacter),_0x268122=await parseAiResponse(_0x4935fc),_0x5ebeaa=chatMessages[_0x252890]||[],_0x19de88=_0x5ebeaa[_0x16dcd0(0x6d5)]()[_0x16dcd0(0x16b0)]()['find'](_0x4f8671=>_0x4f8671[_0x16dcd0(0x8a1)]===_0x16dcd0(0x1e6d)&&_0x4f8671[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x78a)&&!_0x4f8671['status']);_0x19de88&&(console[_0x16dcd0(0x2187)](_0x16dcd0(0x1417),{'lastUserMessage':_0x19de88,'aiMessages':_0x268122,'characterName':currentChatCharacter?.[_0x16dcd0(0x1a1c)]}),await processUserTransfer(_0x19de88,_0x268122,_0x252890));hideTypingIndicator();for(let _0x19f442=0x0;_0x19f442<_0x268122[_0x16dcd0(0x19ee)];_0x19f442++){const _0xfb9151=_0x268122[_0x19f442];let _0x147437;if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x2ef)){console[_0x16dcd0(0x2187)](_0x16dcd0(0x411),_0xfb9151);const _0x2136d9=chatMessages[_0x252890]||[];let _0x5f277d=-0x1;for(let _0x463fdf=_0x2136d9[_0x16dcd0(0x19ee)]-0x1;_0x463fdf>=0x0;_0x463fdf--){if(_0x2136d9[_0x463fdf]['sender']==='received'){_0x5f277d=_0x463fdf;break;}}if(_0x5f277d!==-0x1){const _0x345d87=_0x2136d9[_0x5f277d];console[_0x16dcd0(0x2187)](_0x16dcd0(0x1680),_0x345d87),await handleRecalledMessage(_0x345d87['content'],_0x345d87['id']);}else console[_0x16dcd0(0x1f43)](_0x16dcd0(0x111d));continue;}else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x13ed))_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':'received','type':'voice_message','content':_0xfb9151[_0x16dcd0(0x211c)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x1a36)){_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)['toString'](),'sender':_0x16dcd0(0xb11),'type':_0x16dcd0(0x1a36),'content':_0xfb9151[_0x16dcd0(0x7c9)]||_0x16dcd0(0xbb8),'imageDescription':_0xfb9151[_0x16dcd0(0x7c9)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};if(_0xfb9151[_0x16dcd0(0x1a1c)]){console[_0x16dcd0(0x2187)](_0x16dcd0(0x1bc3),_0xfb9151[_0x16dcd0(0x1a1c)]),_0x147437[_0x16dcd0(0x1a1c)]=_0xfb9151[_0x16dcd0(0x1a1c)];if(currentChatCharacter&&currentChatCharacter[_0x16dcd0(0x1f68)]&&currentChatCharacter[_0x16dcd0(0x12a6)]){const _0x31e3a6=currentChatCharacter[_0x16dcd0(0x12a6)][_0x16dcd0(0xaf4)](_0x324a6e=>_0x324a6e[_0x16dcd0(0x1a1c)]===_0xfb9151[_0x16dcd0(0x1a1c)]);_0x31e3a6?(_0x147437[_0x16dcd0(0x12c8)]=_0x31e3a6['id'],console['log'](_0x16dcd0(0x4a4),_0x31e3a6['id'])):console[_0x16dcd0(0x2187)]('🔍\x20[第三处-AI图片]\x20未找到群成员:',_0xfb9151['name']);}}}else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x78a))_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'type':_0x16dcd0(0x78a),'amount':_0xfb9151[_0x16dcd0(0x2018)],'note':_0xfb9151[_0x16dcd0(0x1814)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151['type']===_0x16dcd0(0x11b3)){console[_0x16dcd0(0x2187)](_0x16dcd0(0xe5d),_0xfb9151);const _0x3ca53b=getCurrentChatSettings(),_0x636d72=_0x3ca53b[_0x16dcd0(0x567)]||'你',_0x58ca4f=_0x3ca53b[_0x16dcd0(0x12e6)]||'';_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0x1744),'content':currentChatCharacter['name']+_0x16dcd0(0xf90)+_0x636d72+_0x58ca4f,'timestamp':Date['now']()+_0x19f442*0x64,'isPoke':!![]};}else{if(typeof _0xfb9151==='object'&&_0xfb9151[_0x16dcd0(0x1a4b)]==='emoji'){console[_0x16dcd0(0x2187)](_0x16dcd0(0x18c2),_0xfb9151);const _0x1c81fb=await findEmojiForAI(_0xfb9151[_0x16dcd0(0x7c9)]);if(_0x1c81fb){_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':'received','content':'','image':_0x1c81fb['url'],'isEmoji':!![],'emojiDescription':_0x1c81fb[_0x16dcd0(0x7c9)],'timestamp':Date['now']()+_0x19f442*0x64};if(_0xfb9151[_0x16dcd0(0x1a1c)]){_0x147437[_0x16dcd0(0x1a1c)]=_0xfb9151[_0x16dcd0(0x1a1c)];if(currentChatCharacter&&currentChatCharacter[_0x16dcd0(0x1f68)]&&currentChatCharacter[_0x16dcd0(0x12a6)]){const _0x2805e3=currentChatCharacter[_0x16dcd0(0x12a6)][_0x16dcd0(0xaf4)](_0x3c674d=>_0x3c674d['name']===_0xfb9151[_0x16dcd0(0x1a1c)]);_0x2805e3&&(_0x147437[_0x16dcd0(0x12c8)]=_0x2805e3['id']);}}}else _0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)['toString'](),'sender':_0x16dcd0(0xb11),'content':_0x16dcd0(0x1fab)+_0xfb9151['description']+_0x16dcd0(0x1ae7),'timestamp':Date['now']()+_0x19f442*0x64};}else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x1b17)){console['log'](_0x16dcd0(0x1518),_0xfb9151);if(_0xfb9151[_0x16dcd0(0x3ab)]){let _0x67782c=_0xfb9151[_0x16dcd0(0x3ab)];if(_0xfb9151['avatar_url']===_0x16dcd0(0xc50)||_0xfb9151['avatar_url']==='CURRENT_USER_IMAGE'||_0xfb9151['avatar_url']===_0x16dcd0(0x1004)||_0xfb9151[_0x16dcd0(0x3ab)]===_0x16dcd0(0x13b0)){const _0x3da8d9=getRecentUserImage();if(_0x3da8d9)_0x67782c=_0x3da8d9;else{_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':'received','content':_0x16dcd0(0x1b96),'timestamp':Date['now']()+_0x19f442*0x64};continue;}}const _0x4f1cb2=await validateAvatarSource(_0x67782c);console[_0x16dcd0(0x2187)](_0x16dcd0(0x1bf0),_0x4f1cb2,_0x16dcd0(0x425),_0x67782c);if(_0x4f1cb2){const _0x242292=await changeCharacterAvatarByAI(_0x67782c,_0xfb9151[_0x16dcd0(0xa84)]||'心情变化');console[_0x16dcd0(0x2187)](_0x16dcd0(0x132a),_0x242292);if(_0x242292)continue;else _0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'content':'[头像更换失败]','timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};}else _0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)['toString'](),'sender':_0x16dcd0(0xb11),'content':_0x16dcd0(0x1591),'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};}else{console[_0x16dcd0(0x2187)](_0x16dcd0(0x85b));continue;}}else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151!==null&&_0xfb9151[_0x16dcd0(0x1a1c)]&&_0xfb9151[_0x16dcd0(0x1e8e)]){console['log'](_0x16dcd0(0xd55),_0xfb9151);let _0x2b61d1=null;if(currentChatCharacter&&currentChatCharacter[_0x16dcd0(0x1f68)]&&currentChatCharacter['members']){const _0x13190a=currentChatCharacter[_0x16dcd0(0x12a6)]['find'](_0x5c3701=>_0x5c3701[_0x16dcd0(0x1a1c)]===_0xfb9151[_0x16dcd0(0x1a1c)]);_0x13190a&&(_0x2b61d1=_0x13190a['id']);}typeof _0xfb9151[_0x16dcd0(0x1e8e)]===_0x16dcd0(0x28d)&&_0xfb9151['message']['type']===_0x16dcd0(0x13ed)?_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'type':'voice_message','name':_0xfb9151[_0x16dcd0(0x1a1c)],'senderId':_0x2b61d1,'content':_0xfb9151[_0x16dcd0(0x1e8e)]['content'],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64}:_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':'received','name':_0xfb9151['name'],'senderId':_0x2b61d1,'content':_0xfb9151[_0x16dcd0(0x1e8e)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64},console[_0x16dcd0(0x2187)](_0x16dcd0(0x1a97),_0x147437);}else{if(typeof _0xfb9151===_0x16dcd0(0x28d)&&_0xfb9151!==null){if(_0xfb9151['type']==='transfer')_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)['toString'](),'sender':'received','type':_0x16dcd0(0x78a),'amount':_0xfb9151[_0x16dcd0(0x2018)],'note':_0xfb9151[_0x16dcd0(0x1814)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};else{if(_0xfb9151[_0x16dcd0(0x1a4b)]==='voice_message')_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'type':'voice_message','content':_0xfb9151[_0x16dcd0(0x211c)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};else{if(_0xfb9151[_0x16dcd0(0x1a4b)]===_0x16dcd0(0x1a36)){_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'type':_0x16dcd0(0x1a36),'content':_0xfb9151['description']||'AI描述的图片','imageDescription':_0xfb9151[_0x16dcd0(0x7c9)],'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};if(_0xfb9151['name']){console[_0x16dcd0(0x2187)](_0x16dcd0(0x47d),_0xfb9151[_0x16dcd0(0x1a1c)]),_0x147437[_0x16dcd0(0x1a1c)]=_0xfb9151[_0x16dcd0(0x1a1c)];if(currentChatCharacter&&currentChatCharacter[_0x16dcd0(0x1f68)]&&currentChatCharacter[_0x16dcd0(0x12a6)]){const _0x41595f=currentChatCharacter['members'][_0x16dcd0(0xaf4)](_0x1aa79e=>_0x1aa79e['name']===_0xfb9151[_0x16dcd0(0x1a1c)]);_0x41595f?(_0x147437[_0x16dcd0(0x12c8)]=_0x41595f['id'],console[_0x16dcd0(0x2187)](_0x16dcd0(0xb1b),_0x41595f['id'])):console[_0x16dcd0(0x2187)](_0x16dcd0(0x1268),_0xfb9151[_0x16dcd0(0x1a1c)]);}}}else{if(_0xfb9151['type']===_0x16dcd0(0x172b)){const _0x4b0408=await findEmojiForAI(_0xfb9151['description']);if(_0x4b0408){_0x147437={'id':(Date[_0x16dcd0(0x2eb)]()+_0x19f442)['toString'](),'sender':_0x16dcd0(0xb11),'content':'','image':_0x4b0408[_0x16dcd0(0x40f)],'isEmoji':!![],'emojiDescription':_0x4b0408[_0x16dcd0(0x7c9)],'timestamp':Date['now']()+_0x19f442*0x64};if(_0xfb9151[_0x16dcd0(0x1a1c)]){_0x147437[_0x16dcd0(0x1a1c)]=_0xfb9151[_0x16dcd0(0x1a1c)];if(currentChatCharacter&&currentChatCharacter[_0x16dcd0(0x1f68)]&&currentChatCharacter['members']){const _0x5b31e4=currentChatCharacter[_0x16dcd0(0x12a6)][_0x16dcd0(0xaf4)](_0x1e8997=>_0x1e8997[_0x16dcd0(0x1a1c)]===_0xfb9151[_0x16dcd0(0x1a1c)]);_0x5b31e4&&(_0x147437[_0x16dcd0(0x12c8)]=_0x5b31e4['id']);}}}else _0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'content':_0x16dcd0(0x1fab)+_0xfb9151[_0x16dcd0(0x7c9)]+_0x16dcd0(0x1ae7),'timestamp':Date['now']()+_0x19f442*0x64};}else{if(_0xfb9151[_0x16dcd0(0x1a4b)]&&[_0x16dcd0(0x1fe3),'create_appointment',_0x16dcd0(0x21f),_0x16dcd0(0x1a3),_0x16dcd0(0x361),'background_task'][_0x16dcd0(0x1831)](_0xfb9151[_0x16dcd0(0x1a4b)])){console[_0x16dcd0(0x2187)](_0x16dcd0(0x14a1),_0xfb9151);continue;}const _0x2e1c9d=_0xfb9151[_0x16dcd0(0x211c)]||_0xfb9151[_0x16dcd0(0x1e8e)]||_0xfb9151[_0x16dcd0(0x1378)]||_0xfb9151[_0x16dcd0(0xd5f)]||_0x16dcd0(0x3c5);_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'content':_0x2e1c9d,'timestamp':Date['now']()+_0x19f442*0x64};}}}}}else typeof _0xfb9151===_0x16dcd0(0x11b7)?_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':'received','content':_0xfb9151,'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64}:_0x147437={'id':(Date['now']()+_0x19f442)[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'content':String(_0xfb9151),'timestamp':Date[_0x16dcd0(0x2eb)]()+_0x19f442*0x64};}}}}}}}}chatMessages[_0x252890][_0x16dcd0(0x1cd6)](_0x147437);try{const _0x1526d3=_0x252890+_0x16dcd0(0x14f4)+_0x147437[_0x16dcd0(0x1716)]+'_'+Math['random']()[_0x16dcd0(0x1878)](0x24)[_0x16dcd0(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x252890][_0x16dcd0(0x19ee)]-0x1);await db[_0x16dcd0(0x19a2)][_0x16dcd0(0x21e2)]({'id':_0x1526d3,'characterId':_0x252890,'timestamp':_0x147437[_0x16dcd0(0x1716)],'messageOrder':chatMessages[_0x252890][_0x16dcd0(0x19ee)]-0x1,'originalMessageId':_0x147437['id'],'messageData':_0x147437}),console[_0x16dcd0(0x2187)](_0x16dcd0(0xb50));}catch(_0x1a5d48){console[_0x16dcd0(0x174a)](_0x16dcd0(0x1a31),_0x1a5d48),saveChatMessages();}addMessageWithAnimation(_0x147437,_0x252890);if(typeof _0xfb9151===_0x16dcd0(0x11b7)||typeof _0xfb9151===_0x16dcd0(0x28d)&&(_0xfb9151['type']||_0xfb9151[_0x16dcd0(0x1a1c)]&&_0xfb9151[_0x16dcd0(0x1e8e)])){console['log'](_0x16dcd0(0x1922),_0xfb9151);const _0x1851f7=characters[_0x16dcd0(0xaf4)](_0x30e4fb=>_0x30e4fb['id']===_0x252890);_0x1851f7&&createPushNotification(_0x1851f7,_0xfb9151,_0x19f442*0x1f4);}if(_0x19f442<_0x268122['length']-0x1){const _0x1f79a2=Math['random']()*0x3e8+0x1f4;await new Promise(_0x5d2281=>setTimeout(_0x5d2281,_0x1f79a2)),_0x19f442<_0x268122['length']-0x1&&(showTypingIndicator(),await new Promise(_0x250948=>setTimeout(_0x250948,Math[_0x16dcd0(0x11a8)]()*0x320+0x190)),hideTypingIndicator());}}renderMessageList();}catch(_0x3fe453){console[_0x16dcd0(0x174a)](_0x16dcd0(0x105e),_0x3fe453),hideTypingIndicator();const _0xb075e2={'id':Date[_0x16dcd0(0x2eb)]()[_0x16dcd0(0x1878)](),'sender':_0x16dcd0(0xb11),'content':_0x16dcd0(0x748)+_0x3fe453['message']+']','timestamp':Date['now']()};chatMessages[_0x252890][_0x16dcd0(0x1cd6)](_0xb075e2),saveChatMessages(),addMessageWithAnimation(_0xb075e2,_0x252890),renderMessageList();}finally{isWaitingForReply=![],pendingUserMessage=null,_0x3c241e&&(_0x3c241e[_0x16dcd0(0x559)]=![],_0x3c241e[_0x16dcd0(0x14eb)][_0x16dcd0(0x11af)]='',_0x3c241e[_0x16dcd0(0x14eb)]['animation']='none',_0x3c241e[_0x16dcd0(0x1c1b)][_0x16dcd0(0x1493)](_0x16dcd0(0x2b1)),_0x3c241e['innerHTML']=_0x16dcd0(0x2123),_0x3c241e['title']=_0x16dcd0(0x1bc8)),updateFloatingButtonsVisibility();}}async function createAIMessage(_0x439b67,_0x3d1007=0x0){const _0x4209b6=_0x211817,_0x46210d={'id':(Date[_0x4209b6(0x2eb)]()+_0x3d1007)[_0x4209b6(0x1878)](),'sender':_0x4209b6(0xb11),'timestamp':Date['now']()+_0x3d1007*0x64};if(_0x439b67['name']&&currentChatCharacter?.['isGroup']&&currentChatCharacter['members']){const _0x37dae4=currentChatCharacter['members'][_0x4209b6(0xaf4)](_0x4b8976=>_0x4b8976['name']===_0x439b67[_0x4209b6(0x1a1c)]);_0x37dae4?(_0x46210d[_0x4209b6(0x1a1c)]=_0x439b67[_0x4209b6(0x1a1c)],_0x46210d['senderId']=_0x37dae4['id'],console['log'](_0x4209b6(0x1f25)+_0x439b67[_0x4209b6(0x1a1c)]+'\x20(ID:\x20'+_0x37dae4['id']+')')):console[_0x4209b6(0x1f43)]('🔍\x20[createAIMessage]\x20未找到群成员:\x20'+_0x439b67[_0x4209b6(0x1a1c)]);}switch(_0x439b67['type']){case _0x4209b6(0x1a36):return{..._0x46210d,'type':'ai_image','content':_0x439b67['description']||_0x4209b6(0xbb8),'imageDescription':_0x439b67[_0x4209b6(0x7c9)]};case _0x4209b6(0x13ed):return{..._0x46210d,'type':_0x4209b6(0x13ed),'content':_0x439b67['content']};case'transfer':return{..._0x46210d,'type':_0x4209b6(0x78a),'amount':_0x439b67['amount'],'note':_0x439b67[_0x4209b6(0x1814)]};case _0x4209b6(0x11b3):const _0x4a4a39=getCurrentChatSettings(),_0x3dff6c=_0x4a4a39['myChatNickname']||'你',_0x4de638=_0x4a4a39[_0x4209b6(0x12e6)]||'';return{..._0x46210d,'sender':_0x4209b6(0x1744),'content':currentChatCharacter['name']+'戳了戳'+_0x3dff6c+_0x4de638,'isPoke':!![]};case'emoji':const _0x15b7df=await findEmojiForAI(_0x439b67[_0x4209b6(0x7c9)]);if(_0x15b7df){const _0x571830={..._0x46210d,'content':'','image':_0x15b7df[_0x4209b6(0x40f)],'isEmoji':!![],'emojiDescription':_0x15b7df[_0x4209b6(0x7c9)]};return _0x571830;}else return{..._0x46210d,'content':_0x4209b6(0x1fab)+_0x439b67[_0x4209b6(0x7c9)]+_0x4209b6(0x1ae7)};case _0x4209b6(0xdd2):console[_0x4209b6(0x2187)](_0x4209b6(0x18d6),_0x439b67);if(_0x439b67[_0x4209b6(0xbce)]!==undefined){const _0x4dadbd=getCurrentChatSettings();_0x4dadbd[_0x4209b6(0x4b8)]=_0x439b67[_0x4209b6(0xbce)]||'',await saveCurrentChatSettings(_0x4dadbd),console[_0x4209b6(0x2187)]('✅\x20[createAIMessage]\x20戳一戳后缀已更新:',_0x439b67[_0x4209b6(0xbce)]);}return{'id':(Date[_0x4209b6(0x2eb)]()+_0x3d1007)[_0x4209b6(0x1878)](),'sender':_0x4209b6(0x1744),'content':currentChatCharacter['name']+_0x4209b6(0x64a)+(_0x439b67[_0x4209b6(0xbce)]?'为\x22'+_0x439b67[_0x4209b6(0xbce)]+'\x22':_0x4209b6(0x630)),'timestamp':Date['now']()+_0x3d1007*0x64,'type':_0x4209b6(0x2c3)};default:return{..._0x46210d,'content':_0x439b67[_0x4209b6(0x211c)]||_0x439b67[_0x4209b6(0x1e8e)]||''};}}async function processAIReply(){const _0x59272a=_0x211817;console[_0x59272a(0x2187)](_0x59272a(0x141f)),console[_0x59272a(0x2187)](_0x59272a(0x1443),new Error()[_0x59272a(0x1574)]);if(!currentChatCharacter)return;if(isWaitingForReply){console[_0x59272a(0x2187)]('AI正在回复中，忽略重复调用');return;}const _0x1f111a=currentChatCharacter['id'];console[_0x59272a(0x2187)](_0x59272a(0x8ba),pendingUserMessage);const _0x2aaf12=chatMessages[_0x1f111a]||[];console[_0x59272a(0x2187)](_0x59272a(0x1762),_0x2aaf12[_0x59272a(0x19ee)]),console['log'](_0x59272a(0x17a0),_0x2aaf12[_0x59272a(0x6d5)](-0x5));const _0x53289c=_0x2aaf12[_0x59272a(0x1e1f)](_0x304e91=>_0x304e91[_0x59272a(0x8a1)]===_0x59272a(0x1e6d));console[_0x59272a(0x2187)](_0x59272a(0x219a),_0x53289c[_0x59272a(0x19ee)]),console[_0x59272a(0x2187)](_0x59272a(0x13f7),_0x53289c[_0x59272a(0x6d5)](-0x3));const _0x5ca933=_0x53289c[_0x59272a(0x6d5)](-0x3);_0x5ca933[_0x59272a(0x19fb)]((_0x2b4ad7,_0x20b3dd)=>{const _0x8ab384=_0x59272a;console['log'](_0x8ab384(0x315)+(_0x20b3dd+0x1)+':',{'id':_0x2b4ad7['id'],'content':_0x2b4ad7['content'],'isArray':Array[_0x8ab384(0x1496)](_0x2b4ad7[_0x8ab384(0x211c)]),'timestamp':_0x2b4ad7[_0x8ab384(0x1716)]});});const _0x401d97=_0x53289c[_0x59272a(0x6d5)](-0x5),_0x451d7f=_0x401d97['reverse']()[_0x59272a(0xaf4)](_0x57d430=>_0x57d430['type']===_0x59272a(0x52c));if(_0x451d7f&&!pendingUserMessage)pendingUserMessage=_0x451d7f,console[_0x59272a(0x2187)]('🔍\x20[processAIReply]\x20找到转发消息，设置为待处理:',_0x451d7f);else{if(!pendingUserMessage){const _0x31a64a=_0x53289c[_0x59272a(0x6d5)](-0x1)[0x0];console[_0x59272a(0x2187)]('🔍\x20[processAIReply]\x20没有待回复消息，使用最后一条用户消息:',_0x31a64a);if(_0x31a64a)pendingUserMessage=_0x31a64a,console['log']('🔍\x20[processAIReply]\x20设置最后一条用户消息为待处理:',_0x31a64a);else return;}}console['log'](_0x59272a(0x1790),pendingUserMessage),console[_0x59272a(0x2187)](_0x59272a(0x1ed4),pendingUserMessage?.[_0x59272a(0x1a4b)]),console[_0x59272a(0x2187)](_0x59272a(0xb7c),pendingUserMessage?.[_0x59272a(0x211c)]),console[_0x59272a(0x2187)](_0x59272a(0x1dc6),Array[_0x59272a(0x1496)](pendingUserMessage?.[_0x59272a(0x211c)])),console[_0x59272a(0x2187)](_0x59272a(0x1a41),!!pendingUserMessage?.[_0x59272a(0xc15)]),console[_0x59272a(0x2187)](_0x59272a(0x11c7),pendingUserMessage?.[_0x59272a(0xc15)]?.[_0x59272a(0x19ee)]),isWaitingForReply=!![];const _0x3a141a=document[_0x59272a(0x1262)]('smart-reply-btn');_0x3a141a&&(_0x3a141a['disabled']=!![],_0x3a141a[_0x59272a(0x14eb)][_0x59272a(0x11af)]='0.65',_0x3a141a['innerHTML']=_0x59272a(0x1b42));showTypingIndicator();const _0x9a32fb=Math[_0x59272a(0x11a8)]()*0x7d0+0x3e8;await new Promise(_0x47a669=>setTimeout(_0x47a669,_0x9a32fb));try{let _0x50e50d;console[_0x59272a(0x2187)](_0x59272a(0x1f7b),pendingUserMessage),console[_0x59272a(0x2187)](_0x59272a(0xee9),pendingUserMessage[_0x59272a(0x1a4b)]),console['log'](_0x59272a(0x87f),currentChatCharacter?.[_0x59272a(0x1f68)]);if(pendingUserMessage['type']===_0x59272a(0x52c)){console[_0x59272a(0x2187)](_0x59272a(0x14d9)),console['log']('🔍\x20[转发消息处理]\x20pendingUserMessage.forwardedMessages:',pendingUserMessage['forwardedMessages']);const _0x575a3b=getCurrentChatSettings(),_0xb36664=_0x575a3b[_0x59272a(0x567)]||(personas[_0x59272a(0xaf4)](_0x3bdf57=>_0x3bdf57['id']===_0x575a3b[_0x59272a(0x145e)])?.[_0x59272a(0x1a1c)]||'我');let _0x3b50ba='['+_0xb36664+_0x59272a(0x19d3)+pendingUserMessage[_0x59272a(0x211c)]+_0x59272a(0xb3b);pendingUserMessage[_0x59272a(0xc15)]&&pendingUserMessage[_0x59272a(0xc15)][_0x59272a(0x19ee)]>0x0?(console[_0x59272a(0x2187)](_0x59272a(0x214f),pendingUserMessage['forwardedMessages']['length']),pendingUserMessage['forwardedMessages'][_0x59272a(0x19fb)]((_0x4608d8,_0x408b8a)=>{const _0x224f2f=_0x59272a;let _0x5622ba;_0x4608d8[_0x224f2f(0x8a1)]===_0x224f2f(0x1e6d)?_0x5622ba=_0x4608d8[_0x224f2f(0xb51)]||_0xb36664:_0x5622ba=_0x4608d8[_0x224f2f(0x1a1c)]||_0x4608d8[_0x224f2f(0xdbc)]||'AI';const _0x22bff3=safeExtractMessageContent(_0x4608d8);console[_0x224f2f(0x2187)](_0x224f2f(0x97e)+(_0x408b8a+0x1)+':\x20'+_0x5622ba+':\x20'+_0x22bff3),_0x3b50ba+=_0x5622ba+':\x20'+_0x22bff3+'\x0a';})):(console[_0x59272a(0x2187)]('❌\x20[转发消息处理]\x20转发消息为空或不存在'),_0x3b50ba+=_0x59272a(0x1a38)),console[_0x59272a(0x2187)](_0x59272a(0xb02),currentChatCharacter?.[_0x59272a(0x1a1c)],_0x59272a(0x15d2),currentChatCharacter?.[_0x59272a(0x1f68)]),console[_0x59272a(0x2187)](_0x59272a(0x1ebd),_0x3b50ba),_0x50e50d=await callChatAPI(_0x3b50ba,currentChatCharacter),console[_0x59272a(0x2187)]('🔍\x20[转发消息]\x20AI原始回复:',_0x50e50d);}else{if(Array[_0x59272a(0x1496)](pendingUserMessage['content'])){console[_0x59272a(0x2187)](_0x59272a(0x138a),pendingUserMessage[_0x59272a(0x211c)]);const _0x2577c1=pendingUserMessage[_0x59272a(0x211c)]['some'](_0x5a8443=>_0x5a8443[_0x59272a(0x1a4b)]==='image_url'),_0x18b3a3=pendingUserMessage[_0x59272a(0xc66)]?.[_0x59272a(0x19fa)](_0x4b8009=>_0x4b8009[_0x59272a(0x8e7)]);console[_0x59272a(0x2187)](_0x59272a(0x38a),_0x2577c1),console[_0x59272a(0x2187)](_0x59272a(0x9b1),_0x18b3a3),console[_0x59272a(0x2187)](_0x59272a(0x1dc9),apiSettings['emojiRecognitionEnabled']);const _0x501675=pendingUserMessage[_0x59272a(0xc66)]?.['find'](_0x259a52=>_0x259a52[_0x59272a(0x8e7)]),_0x4f56be=_0x501675?.[_0x59272a(0x68e)]?.[_0x59272a(0x1831)](_0x59272a(0x194))||_0x501675?.['url']?.[_0x59272a(0x1831)](_0x59272a(0x194));console[_0x59272a(0x2187)](_0x59272a(0x1b9),_0x4f56be);if(_0x2577c1&&_0x18b3a3&&(apiSettings[_0x59272a(0x9dd)]===![]||_0x4f56be)){const _0x22956a=_0x4f56be?'动图表情包':_0x59272a(0x3a6),_0x5bc3f8='[用户发送了表情包：'+(_0x501675?.[_0x59272a(0x29d)]||'自定义表情包')+']';console[_0x59272a(0x2187)](_0x59272a(0x1d41)+_0x22956a+'):',_0x5bc3f8),_0x50e50d=await callChatAPI(_0x5bc3f8,currentChatCharacter);}else _0x50e50d=await callChatAPI(pendingUserMessage['content'],currentChatCharacter);}else{if(pendingUserMessage[_0x59272a(0x68e)]){const _0x1cabf6=pendingUserMessage['isEmoji']&&pendingUserMessage[_0x59272a(0x68e)]?.[_0x59272a(0x1831)](_0x59272a(0x194));console[_0x59272a(0x2187)]('🔍\x20[processAIReply图片分支动图检测]\x20是否为GIF表情包:',_0x1cabf6);if(pendingUserMessage[_0x59272a(0x8e7)]&&(apiSettings[_0x59272a(0x9dd)]===![]||_0x1cabf6)){const _0x51070b=_0x1cabf6?_0x59272a(0x1074):_0x59272a(0x3a6),_0x27bf69=_0x59272a(0x979)+(pendingUserMessage['emojiDescription']||'自定义表情包')+']';console['log'](_0x59272a(0x525)+_0x51070b+'):',_0x27bf69),_0x50e50d=await callChatAPI(_0x27bf69,currentChatCharacter);}else{const _0x848a22=[{'type':_0x59272a(0x1378),'text':pendingUserMessage[_0x59272a(0x211c)]||''},{'type':_0x59272a(0x910),'image_url':{'url':pendingUserMessage[_0x59272a(0x68e)]}}];_0x50e50d=await callChatAPI(_0x848a22,currentChatCharacter);}}else{if(pendingUserMessage[_0x59272a(0x1a4b)]===_0x59272a(0x78a)){const _0x420cd0=_0x59272a(0x213e)+pendingUserMessage['amount']+_0x59272a(0xd17)+(pendingUserMessage[_0x59272a(0x1814)]||'无')+']';_0x50e50d=await callChatAPI(_0x420cd0,currentChatCharacter);}else{if(pendingUserMessage['image']&&pendingUserMessage['isEmoji']){console[_0x59272a(0x2187)](_0x59272a(0x1a9c)),console[_0x59272a(0x2187)](_0x59272a(0x225f),apiSettings),console[_0x59272a(0x2187)](_0x59272a(0x488),apiSettings[_0x59272a(0x9dd)]);const _0x5093e3=pendingUserMessage[_0x59272a(0x68e)]?.[_0x59272a(0x1831)](_0x59272a(0x194));console[_0x59272a(0x2187)]('🔍\x20[processAIReply\x20else分支动图检测]\x20是否为GIF表情包:',_0x5093e3);if(apiSettings[_0x59272a(0x9dd)]===![]||_0x5093e3){const _0x197373=_0x5093e3?_0x59272a(0x1074):_0x59272a(0x3a6),_0x4b05c9=_0x59272a(0x979)+(pendingUserMessage['emojiDescription']||_0x59272a(0x542))+']';console['log'](_0x59272a(0x20b2)+_0x197373+'):',_0x4b05c9),_0x50e50d=await callChatAPI(_0x4b05c9,currentChatCharacter);}else{const _0x5ec08f=[{'type':_0x59272a(0x1378),'text':pendingUserMessage['content']||''},{'type':_0x59272a(0x910),'image_url':{'url':pendingUserMessage[_0x59272a(0x68e)]}}];console[_0x59272a(0x2187)](_0x59272a(0x12bc),_0x5ec08f),_0x50e50d=await callChatAPI(_0x5ec08f,currentChatCharacter);}}else{let _0x5b0660=pendingUserMessage[_0x59272a(0x211c)];if(pendingUserMessage[_0x59272a(0x1dbe)]){const _0x596753=summarizeLastMessage({'content':pendingUserMessage['replyTo'][_0x59272a(0x211c)]});_0x5b0660='[回复\x20'+pendingUserMessage[_0x59272a(0x1dbe)][_0x59272a(0x909)]+_0x59272a(0x5bf)+_0x596753+'\x22]\x20'+pendingUserMessage[_0x59272a(0x211c)],console[_0x59272a(0x2187)](_0x59272a(0x218b),_0x5b0660);}_0x50e50d=await callChatAPI(_0x5b0660,currentChatCharacter);}}}}}const _0x460c2b=await parseAiResponse(_0x50e50d);for(const _0x1277c0 of _0x460c2b){if(typeof _0x1277c0===_0x59272a(0x28d)&&_0x1277c0!==null&&_0x1277c0['type']==='block_user'){console['log'](_0x59272a(0x1492),_0x1277c0),await aiBlockUser(currentChatCharacter['id'],_0x1277c0['reason']||_0x59272a(0x203c));break;}if(typeof _0x1277c0===_0x59272a(0x28d)&&_0x1277c0!==null&&_0x1277c0[_0x59272a(0x1a4b)]===_0x59272a(0x1fe3)){console[_0x59272a(0x2187)](_0x59272a(0x1af6),_0x1277c0);const _0x54defb={'name':_0x1277c0[_0x59272a(0x1a1c)]||_0x59272a(0x55f),'date':_0x1277c0[_0x59272a(0x20d4)]||new Date()[_0x59272a(0x1034)]()[_0x59272a(0x204b)]('T')[0x0],'type':_0x1277c0[_0x59272a(0xe13)]||_0x59272a(0xe56),'description':_0x1277c0[_0x59272a(0x7c9)]||_0x59272a(0xcb1)};await createAnniversaryByCharacter(_0x1f111a,_0x54defb);}if(typeof _0x1277c0===_0x59272a(0x28d)&&_0x1277c0!==null&&_0x1277c0['type']===_0x59272a(0x16fc)){console[_0x59272a(0x2187)](_0x59272a(0x2ec),_0x1277c0);const _0x488b69={'name':_0x1277c0['name']||_0x59272a(0x1791),'date':_0x1277c0['date']||new Date()[_0x59272a(0x1034)]()[_0x59272a(0x204b)]('T')[0x0],'type':_0x1277c0['appointment_type']||_0x59272a(0xe56),'description':_0x1277c0[_0x59272a(0x7c9)]||_0x59272a(0x4d7),'neverExpires':_0x1277c0[_0x59272a(0x79d)]===!![]||_0x1277c0['neverExpires']===!![]};await createAppointmentByCharacter(_0x1f111a,_0x488b69);}}let _0x44c6b7=null;if(pendingUserMessage&&pendingUserMessage['type']===_0x59272a(0x78a))_0x44c6b7=pendingUserMessage;else pendingUserMessage&&pendingUserMessage[_0x59272a(0x1b50)]&&pendingUserMessage[_0x59272a(0xc66)]&&(_0x44c6b7=pendingUserMessage[_0x59272a(0xc66)][_0x59272a(0xaf4)](_0x1ffdfe=>_0x1ffdfe['type']===_0x59272a(0x78a)&&!_0x1ffdfe[_0x59272a(0x12e2)]));_0x44c6b7&&(console[_0x59272a(0x2187)]('🔥\x20检测到用户转账消息，开始处理转账:',{'transferMessage':_0x44c6b7,'aiMessages':_0x460c2b,'characterName':currentChatCharacter?.[_0x59272a(0x1a1c)]}),await processUserTransfer(_0x44c6b7,_0x460c2b,_0x1f111a));const _0x194f2a=chatMessages[_0x1f111a]||[];console[_0x59272a(0x2187)]('🛒\x20[代付处理]\x20AI回复完成，检查未处理代付请求');const _0x249792=_0x194f2a['slice']()[_0x59272a(0x16b0)]()[_0x59272a(0xaf4)](_0x4fb1aa=>_0x4fb1aa['sender']===_0x59272a(0x1e6d)&&_0x4fb1aa[_0x59272a(0x1a4b)]==='payment_request'&&!_0x4fb1aa['paymentStatus']);_0x249792&&(console['log'](_0x59272a(0xcf9),_0x249792),await processPaymentRequestResponse(_0x249792,_0x460c2b,_0x1f111a));if(pendingUserMessage&&_0x50e50d){let _0x459f86='';if(Array[_0x59272a(0x1496)](pendingUserMessage[_0x59272a(0x211c)])){const _0x5c3f80=pendingUserMessage[_0x59272a(0x211c)][_0x59272a(0x1e1f)](_0x51589a=>_0x51589a[_0x59272a(0x1a4b)]===_0x59272a(0x1378));_0x459f86=_0x5c3f80[_0x59272a(0x6a4)](_0x67d628=>_0x67d628[_0x59272a(0x1378)])[_0x59272a(0x122b)]('\x20');}else _0x459f86=pendingUserMessage[_0x59272a(0x211c)]||'';checkForAICallTrigger(_0x459f86,_0x50e50d);}console[_0x59272a(0x2187)](_0x59272a(0xec8),_0x460c2b['length']),console[_0x59272a(0x2187)](_0x59272a(0x812),_0x1f111a),console['log'](_0x59272a(0x135b),currentChatCharacter);let _0x3470ee=characters[_0x59272a(0xaf4)](_0x506fbe=>_0x506fbe['id']===_0x1f111a);if(!_0x3470ee){const _0x1192c5=groupChats[_0x59272a(0xaf4)](_0x12aeef=>_0x12aeef['id']===_0x1f111a);_0x1192c5&&(console[_0x59272a(0x2187)]('🔔\x20[推送通知]\x20找到群聊对象:',_0x1192c5[_0x59272a(0x1a1c)]),_0x3470ee=_0x1192c5);}!_0x3470ee&&currentChatCharacter&&(console['log'](_0x59272a(0x12e7)),_0x3470ee=currentChatCharacter);if(_0x3470ee){console[_0x59272a(0x2187)](_0x59272a(0x612),_0x3470ee[_0x59272a(0x1a1c)],_0x59272a(0x15d2),_0x3470ee[_0x59272a(0x1f68)]);for(let _0x39aed0=0x0;_0x39aed0<_0x460c2b[_0x59272a(0x19ee)];_0x39aed0++){const _0x42cbc8=_0x460c2b[_0x39aed0];console[_0x59272a(0x2187)]('🔔\x20[推送通知]\x20处理消息',_0x39aed0,':',_0x42cbc8),(typeof _0x42cbc8==='string'||typeof _0x42cbc8===_0x59272a(0x28d)&&(_0x42cbc8[_0x59272a(0x1a4b)]||_0x42cbc8[_0x59272a(0x1a1c)]&&_0x42cbc8['message']))&&createPushNotification(_0x3470ee,_0x42cbc8,_0x39aed0*0x1f4);}}else console[_0x59272a(0x1f43)](_0x59272a(0x20b),_0x1f111a);hideTypingIndicator();for(let _0x2a8ad2=0x0;_0x2a8ad2<_0x460c2b[_0x59272a(0x19ee)];_0x2a8ad2++){const _0x3b342b=_0x460c2b[_0x2a8ad2];let _0x599f53;console[_0x59272a(0x2187)]('🔍\x20[AI回复处理]\x20处理消息',_0x2a8ad2,_0x59272a(0x9f4),typeof _0x3b342b,'内容:',_0x3b342b),console[_0x59272a(0x2187)](_0x59272a(0x1e95),currentChatCharacter?.[_0x59272a(0x1a1c)],_0x59272a(0x15d2),currentChatCharacter?.[_0x59272a(0x1f68)]);if(typeof _0x3b342b===_0x59272a(0x28d)&&_0x3b342b!==null){if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x21f)){console[_0x59272a(0x2187)](_0x59272a(0x6bf),_0x3b342b);continue;}if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x1fe3)){console['log']('🎉\x20跳过纪念日创建指令对象，不显示为消息:',_0x3b342b);continue;}if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x16fc)){console['log'](_0x59272a(0x1aad),_0x3b342b);continue;}if(_0x3b342b[_0x59272a(0x1a4b)]&&[_0x59272a(0x1a3),'internal_action',_0x59272a(0x1f55)]['includes'](_0x3b342b[_0x59272a(0x1a4b)])){console[_0x59272a(0x2187)](_0x59272a(0x1c6a),_0x3b342b);continue;}}if(typeof _0x3b342b===_0x59272a(0x28d)&&_0x3b342b!==null){if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x13ed))_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b['type']===_0x59272a(0x1a36))_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b['type']==='transfer')_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x11b3))_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b[_0x59272a(0x1a4b)]==='update_poke_suffix')_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b[_0x59272a(0x1a4b)]==='emoji')_0x599f53=await createAIMessage(_0x3b342b,_0x2a8ad2);else{if(_0x3b342b[_0x59272a(0x1a4b)]==='ai_photo'){console[_0x59272a(0x2187)](_0x59272a(0x1b34),_0x3b342b);const _0x575de4=_0x3b342b[_0x59272a(0x7c9)]||_0x3b342b[_0x59272a(0x211c)]||_0x3b342b[_0x59272a(0x1b98)]||_0x59272a(0xbe5);console[_0x59272a(0x2187)](_0x59272a(0x16c8),_0x575de4),_0x599f53={'id':(Date['now']()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'type':_0x59272a(0xd38),'content':_0x575de4,'photoDescription':_0x575de4,'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x2184)){console['log'](_0x59272a(0x92d),_0x3b342b);const _0x26ecd0=_0x3b342b[_0x59272a(0x1b93)]||_0x3b342b[_0x59272a(0x1a1c)]||_0x59272a(0xeea);console['log'](_0x59272a(0x1c33),_0x26ecd0,_0x59272a(0x1dd8),_0x3b342b[_0x59272a(0x7cf)]||'未知坐标'),_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'type':_0x59272a(0x2184),'locationName':_0x26ecd0,'coordinates':_0x3b342b[_0x59272a(0x7cf)]||_0x59272a(0x183c),'content':'[角色分享了位置信息：'+_0x26ecd0+']','timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};if(_0x3b342b[_0x59272a(0x1a1c)]&&isGroupChat){_0x599f53['name']=_0x3b342b[_0x59272a(0x1a1c)];const _0x412206=currentChatCharacter['members']['find'](_0x1d6f42=>_0x1d6f42[_0x59272a(0x1a1c)]===_0x3b342b[_0x59272a(0x1a1c)]);_0x412206&&(_0x599f53['senderId']=_0x412206['id']);}}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x78a))_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'type':_0x59272a(0x78a),'amount':_0x3b342b['amount'],'note':_0x3b342b[_0x59272a(0x1814)],'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};else{if(_0x3b342b['type']===_0x59272a(0x11b3)){console[_0x59272a(0x2187)](_0x59272a(0x1b40),_0x3b342b);const _0x5bb056=getCurrentChatSettings(),_0x11e1cb=_0x5bb056[_0x59272a(0x567)]||'你',_0x59e9a4=_0x5bb056['myPokeSuffix']||'';_0x599f53={'id':(Date['now']()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':'system','content':currentChatCharacter[_0x59272a(0x1a1c)]+_0x59272a(0xf90)+_0x11e1cb+_0x59e9a4,'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64,'isPoke':!![]};}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x1871))console[_0x59272a(0x2187)]('🛒\x20[AI代付请求]\x20AI尝试发起代付请求，已忽略:',_0x3b342b),_0x599f53=null;else{if(_0x3b342b[_0x59272a(0x1a4b)]==='order_confirmation'){console['log'](_0x59272a(0x1040),_0x3b342b);const _0x438f38='SP'+Date[_0x59272a(0x2eb)]()[_0x59272a(0x1878)]()[_0x59272a(0x6d5)](-0x8),_0x3c40b6={'orderNumber':_0x438f38,'items':_0x3b342b[_0x59272a(0x1775)]||[],'total':_0x3b342b[_0x59272a(0x1916)]||0x0,'recipient':_0x3b342b['recipient']||currentChatCharacter?.[_0x59272a(0x1a1c)]||'AI','timestamp':Date[_0x59272a(0x2eb)]()};_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)['toString'](),'sender':_0x59272a(0xb11),'type':_0x59272a(0x1c97),'content':_0x59272a(0x2186),'orderDetails':_0x3c40b6,'orderType':_0x3b342b[_0x59272a(0x192d)]||'ai_order','timestamp':Date['now']()+_0x2a8ad2*0x64},console[_0x59272a(0x2187)]('🛒\x20[AI订单确认]\x20创建的订单确认消息:',_0x599f53);}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x172b)){console[_0x59272a(0x2187)](_0x59272a(0xc22),_0x3b342b);const _0x285818=await findEmojiForAI(_0x3b342b['description']);if(_0x285818){_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':'received','content':'','image':_0x285818[_0x59272a(0x40f)],'isEmoji':!![],'emojiDescription':_0x285818[_0x59272a(0x7c9)],'timestamp':Date['now']()+_0x2a8ad2*0x64};if(_0x3b342b[_0x59272a(0x1a1c)]){console[_0x59272a(0x2187)]('🔍\x20[processAIReply-表情包]\x20检测到群聊消息，发送者:',_0x3b342b[_0x59272a(0x1a1c)]),_0x599f53['name']=_0x3b342b[_0x59272a(0x1a1c)];if(currentChatCharacter&&currentChatCharacter['isGroup']&&currentChatCharacter[_0x59272a(0x12a6)]){const _0x4ff1d5=currentChatCharacter['members']['find'](_0x2bd8de=>_0x2bd8de[_0x59272a(0x1a1c)]===_0x3b342b[_0x59272a(0x1a1c)]);_0x4ff1d5?(_0x599f53[_0x59272a(0x12c8)]=_0x4ff1d5['id'],console['log'](_0x59272a(0x17cb),_0x4ff1d5['id'])):console['log']('🔍\x20[processAIReply-表情包]\x20未找到群成员:',_0x3b342b[_0x59272a(0x1a1c)]);}}else console[_0x59272a(0x2187)]('🔍\x20[processAIReply-表情包]\x20msgData.name\x20不存在，可能是单聊');console['log'](_0x59272a(0x1e68),_0x599f53);}else _0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x1fab)+_0x3b342b['description']+_0x59272a(0x1ae7),'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x1f2a)){console['log'](_0x59272a(0x11ff),_0x3b342b),console['log'](_0x59272a(0x145d),_0x3b342b['message_id']),console[_0x59272a(0x2187)]('🔍\x20[引用回复-主分支]\x20replyingCharacterId:',_0x1f111a),console['log'](_0x59272a(0xc73),currentChatCharacter?.['id']);const _0x32b850=currentChatCharacter?.['id']||_0x1f111a,_0x4ca8a3=chatMessages[_0x32b850]||[];console['log'](_0x59272a(0x14d5),_0x32b850),console['log'](_0x59272a(0x1a1),_0x4ca8a3['length']);try{_0x4ca8a3['slice'](-0x5)[_0x59272a(0x6a4)](_0xd30ede=>_0xd30ede?.['id']||'undefined');}catch(_0x1bc36a){console[_0x59272a(0x174a)]('🔍\x20[引用回复-主分支]\x20获取消息ID时出错:',_0x1bc36a),console[_0x59272a(0x2187)]('🔍\x20[引用回复-主分支]\x20allMessages:',_0x4ca8a3);}const _0x533a64=_0x4ca8a3['find'](_0x1719c0=>_0x1719c0['id']===_0x3b342b['message_id']);if(!_0x533a64){console['log'](_0x59272a(0x4a1)),console[_0x59272a(0x2187)](_0x59272a(0x1a2c),typeof _0x3b342b[_0x59272a(0x7a2)],'值:',_0x3b342b[_0x59272a(0x7a2)]);const _0x2251e8=parseInt(_0x3b342b[_0x59272a(0x7a2)]),_0x451aac=_0x4ca8a3[_0x59272a(0xaf4)](_0x2eb7a2=>_0x2eb7a2['id']===_0x2251e8);console[_0x59272a(0x2187)]('🔍\x20[引用回复-主分支]\x20数字格式查找结果:',_0x451aac);const _0x5909f8=_0x4ca8a3[_0x59272a(0xaf4)](_0x5b4430=>_0x5b4430['id']===_0x3b342b['message_id'][_0x59272a(0x1878)]());console[_0x59272a(0x2187)](_0x59272a(0x1e31),_0x5909f8),console[_0x59272a(0x2187)](_0x59272a(0x1287),_0x4ca8a3[_0x59272a(0x6a4)](_0x1e7382=>({'id':_0x1e7382['id'],'type':typeof _0x1e7382['id'],'content':_0x1e7382[_0x59272a(0x211c)]?.[_0x59272a(0x17ca)]?.(0x0,0x14)})));}if(_0x533a64){let _0x28abde='';if(Array[_0x59272a(0x1496)](_0x533a64['content'])){const _0x3f8651=_0x533a64[_0x59272a(0x211c)][_0x59272a(0xaf4)](_0xca6ef6=>_0xca6ef6[_0x59272a(0x1a4b)]==='text'),_0x5f5d34=_0x533a64['content'][_0x59272a(0xaf4)](_0x5b92a5=>_0x5b92a5[_0x59272a(0x1a4b)]===_0x59272a(0x910));if(_0x3f8651?.[_0x59272a(0x1378)])_0x28abde=_0x3f8651[_0x59272a(0x1378)];else _0x5f5d34?_0x28abde=_0x59272a(0x1bb6):_0x28abde=_0x59272a(0x1ced);}else _0x28abde=_0x533a64[_0x59272a(0x211c)]||'';const _0x20a86f={'id':_0x533a64['id'],'content':_0x28abde,'senderName':_0x533a64[_0x59272a(0x8a1)]===_0x59272a(0x1e6d)?'你':_0x533a64[_0x59272a(0x1a1c)]||currentChatCharacter?.[_0x59272a(0x1a1c)]||'对方'};_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)['toString'](),'sender':'received','content':_0x3b342b[_0x59272a(0x211c)]||'','replyTo':_0x20a86f,'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};if(_0x3b342b[_0x59272a(0x1a1c)]&&currentChatCharacter?.[_0x59272a(0x1f68)]&&currentChatCharacter[_0x59272a(0x12a6)]){const _0x38cca5=currentChatCharacter['members'][_0x59272a(0xaf4)](_0x88af1c=>_0x88af1c[_0x59272a(0x1a1c)]===_0x3b342b[_0x59272a(0x1a1c)]);_0x38cca5?(_0x599f53[_0x59272a(0x1a1c)]=_0x3b342b['name'],_0x599f53[_0x59272a(0x12c8)]=_0x38cca5['id'],console[_0x59272a(0x2187)](_0x59272a(0xdba),_0x3b342b['name'],_0x59272a(0x180e),_0x38cca5['id'])):console[_0x59272a(0x2187)](_0x59272a(0x1036),_0x3b342b[_0x59272a(0x1a1c)]);}}else{console[_0x59272a(0x1f43)](_0x59272a(0xf56),_0x3b342b[_0x59272a(0x7a2)]),_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)['toString'](),'sender':_0x59272a(0xb11),'content':_0x3b342b[_0x59272a(0x211c)]||'','timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};if(_0x3b342b['name']&&currentChatCharacter?.[_0x59272a(0x1f68)]&&currentChatCharacter[_0x59272a(0x12a6)]){const _0x117a29=currentChatCharacter[_0x59272a(0x12a6)][_0x59272a(0xaf4)](_0x221770=>_0x221770[_0x59272a(0x1a1c)]===_0x3b342b[_0x59272a(0x1a1c)]);_0x117a29?(_0x599f53[_0x59272a(0x1a1c)]=_0x3b342b[_0x59272a(0x1a1c)],_0x599f53[_0x59272a(0x12c8)]=_0x117a29['id'],console[_0x59272a(0x2187)](_0x59272a(0x15a2),_0x3b342b[_0x59272a(0x1a1c)],_0x59272a(0x180e),_0x117a29['id'])):console[_0x59272a(0x2187)](_0x59272a(0x1c4e),_0x3b342b[_0x59272a(0x1a1c)]);}}}else{if(_0x3b342b['type']===_0x59272a(0x1b17)){if(_0x3b342b[_0x59272a(0x3ab)]){let _0x26b634=_0x3b342b[_0x59272a(0x3ab)];if(_0x3b342b['avatar_url']===_0x59272a(0xc50)||_0x3b342b[_0x59272a(0x3ab)]===_0x59272a(0xc50)||_0x3b342b['avatar_url']===_0x59272a(0x1004)||_0x3b342b['avatar_url']===_0x59272a(0x13b0)){const _0x406e68=getRecentUserImage();if(_0x406e68)_0x26b634=_0x406e68;else{_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)['toString'](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x1b96),'timestamp':Date['now']()+_0x2a8ad2*0x64};continue;}}const _0x68d772=await validateAvatarSource(_0x26b634);if(_0x68d772){const _0x79138e=await changeCharacterAvatarByAI(_0x26b634,_0x3b342b[_0x59272a(0xa84)]||'心情变化');if(_0x79138e)continue;else _0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x1db0),'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};}else _0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x1591),'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};}else continue;}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x2ef)){console['log'](_0x59272a(0x243),_0x3b342b);const _0x45de15=chatMessages[_0x1f111a]||[];let _0x54c907=-0x1;for(let _0x419691=_0x45de15[_0x59272a(0x19ee)]-0x1;_0x419691>=0x0;_0x419691--){if(_0x45de15[_0x419691][_0x59272a(0x8a1)]===_0x59272a(0xb11)){_0x54c907=_0x419691;break;}}if(_0x54c907!==-0x1){const _0x450157=_0x45de15[_0x54c907];console['log'](_0x59272a(0x3eb),_0x450157),await handleRecalledMessage(_0x450157[_0x59272a(0x211c)],_0x450157['id']);}else console[_0x59272a(0x1f43)](_0x59272a(0x129c)),_0x599f53={'id':(Date['now']()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x1fb3),'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};continue;}else{if(_0x3b342b[_0x59272a(0x1a4b)]===_0x59272a(0x1ebb)){console[_0x59272a(0x2187)](_0x59272a(0x190d),_0x3b342b),setTimeout(()=>{const _0x19f4a3=_0x59272a;initiateAICall(currentChatCharacter,_0x3b342b['reason']||_0x19f4a3(0x2301));},0x64+Math[_0x59272a(0x11a8)]()*0xc8);continue;}else{if(_0x3b342b['type']===_0x59272a(0x1aef)){console[_0x59272a(0x2187)](_0x59272a(0x1cac),_0x3b342b),setTimeout(()=>{const _0x2644ce=_0x59272a;initiateAIVideoCall(currentChatCharacter,_0x3b342b[_0x2644ce(0xa84)]||_0x2644ce(0x1d44));},0x64+Math[_0x59272a(0x11a8)]()*0xc8);continue;}else{if(_0x3b342b[_0x59272a(0x1a1c)]&&_0x3b342b['message']){console[_0x59272a(0x2187)](_0x59272a(0x9d0),_0x3b342b[_0x59272a(0x1a1c)],_0x3b342b['message']);let _0x379917=null;if(currentChatCharacter&&currentChatCharacter[_0x59272a(0x1f68)]&&currentChatCharacter['members']){const _0x47277b=currentChatCharacter[_0x59272a(0x12a6)][_0x59272a(0xaf4)](_0x19c121=>_0x19c121[_0x59272a(0x1a1c)]===_0x3b342b[_0x59272a(0x1a1c)]);_0x47277b?(_0x379917=_0x47277b['id'],console[_0x59272a(0x2187)](_0x59272a(0x8fc),_0x379917)):console[_0x59272a(0x2187)]('🔍\x20[AI回复处理]\x20未找到群成员:',_0x3b342b['name']);}if(typeof _0x3b342b[_0x59272a(0x1e8e)]==='object'&&_0x3b342b[_0x59272a(0x1e8e)]['type']===_0x59272a(0x13ed))_0x599f53={'id':(Date['now']()+_0x2a8ad2)['toString'](),'sender':_0x59272a(0xb11),'type':_0x59272a(0x13ed),'name':_0x3b342b[_0x59272a(0x1a1c)],'senderId':_0x379917,'content':_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x211c)],'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};else{if(typeof _0x3b342b[_0x59272a(0x1e8e)]===_0x59272a(0x28d)&&_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x1a4b)]===_0x59272a(0x78a))_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':'received','type':_0x59272a(0x78a),'name':_0x3b342b[_0x59272a(0x1a1c)],'senderId':_0x379917,'amount':_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x2018)],'note':_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x1814)],'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};else typeof _0x3b342b[_0x59272a(0x1e8e)]===_0x59272a(0x28d)&&_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x1a4b)]==='friend_request'?_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'type':_0x59272a(0x2051),'message':_0x3b342b[_0x59272a(0x1e8e)][_0x59272a(0x1e8e)],'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64}:(console[_0x59272a(0x2187)](_0x59272a(0x195c),_0x3b342b[_0x59272a(0x1a1c)],'senderId:',_0x379917),_0x599f53={'id':(Date['now']()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'name':_0x3b342b[_0x59272a(0x1a1c)],'senderId':_0x379917,'content':_0x3b342b[_0x59272a(0x1e8e)],'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64},console[_0x59272a(0x2187)](_0x59272a(0x1d69),_0x599f53));}}else{let _0x4c4576;if(_0x3b342b['content']&&typeof _0x3b342b['content']===_0x59272a(0x11b7))_0x4c4576=_0x3b342b[_0x59272a(0x211c)];else{if(_0x3b342b['message']&&typeof _0x3b342b[_0x59272a(0x1e8e)]==='string')_0x4c4576=_0x3b342b[_0x59272a(0x1e8e)];else{if(_0x3b342b[_0x59272a(0x1378)]&&typeof _0x3b342b[_0x59272a(0x1378)]===_0x59272a(0x11b7))_0x4c4576=_0x3b342b[_0x59272a(0x1378)];else{if(_0x3b342b[_0x59272a(0xd5f)]&&typeof _0x3b342b['reply']===_0x59272a(0x11b7))_0x4c4576=_0x3b342b['reply'];else{if(typeof _0x3b342b===_0x59272a(0x11b7))_0x4c4576=_0x3b342b;else{if(_0x3b342b['type']&&[_0x59272a(0x1fe3),'create_appointment',_0x59272a(0x21f),_0x59272a(0x1a3),_0x59272a(0x361),_0x59272a(0x1f55),_0x59272a(0x1f46)][_0x59272a(0x1831)](_0x3b342b[_0x59272a(0x1a4b)])){console['log'](_0x59272a(0x162d),_0x3b342b);continue;}console[_0x59272a(0x1f43)](_0x59272a(0x152f),_0x3b342b),_0x4c4576=_0x59272a(0x3c5);}}}}}_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x4c4576,'timestamp':Date['now']()+_0x2a8ad2*0x64};}}}}}}}}}}}}}}}}}}}}else typeof _0x3b342b===_0x59272a(0x11b7)?_0x599f53={'id':(Date['now']()+_0x2a8ad2)['toString'](),'sender':_0x59272a(0xb11),'content':_0x3b342b,'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64}:_0x599f53={'id':(Date[_0x59272a(0x2eb)]()+_0x2a8ad2)[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':String(_0x3b342b),'timestamp':Date[_0x59272a(0x2eb)]()+_0x2a8ad2*0x64};chatMessages[_0x1f111a][_0x59272a(0x1cd6)](_0x599f53);try{const _0xec0cec=_0x1f111a+_0x59272a(0x4c9)+_0x599f53[_0x59272a(0x1716)]+'_'+Math[_0x59272a(0x11a8)]()[_0x59272a(0x1878)](0x24)['substr'](0x2,0x9)+'_'+(chatMessages[_0x1f111a]['length']-0x1);await db[_0x59272a(0x19a2)]['add']({'id':_0xec0cec,'characterId':_0x1f111a,'timestamp':_0x599f53['timestamp'],'messageOrder':chatMessages[_0x1f111a][_0x59272a(0x19ee)]-0x1,'originalMessageId':_0x599f53['id'],'messageData':_0x599f53}),console['log'](_0x59272a(0x1125));}catch(_0x199b82){console[_0x59272a(0x174a)]('回复消息单条保存失败，回退到批量保存:',_0x199b82),await saveChatMessages();}addMessageWithAnimation(_0x599f53,_0x1f111a),triggerStatusUpdateAfterMessage(_0x1f111a),setTimeout(async()=>{const _0x4c0b26=_0x59272a;try{let _0x3fa6a5='',_0x13d34d=_0x1f111a;if(typeof _0x3b342b===_0x4c0b26(0x11b7))_0x3fa6a5=_0x3b342b;else{if(typeof _0x3b342b===_0x4c0b26(0x28d)&&_0x3b342b[_0x4c0b26(0x1a1c)]&&_0x3b342b[_0x4c0b26(0x1e8e)]){_0x3fa6a5=_0x3b342b[_0x4c0b26(0x1e8e)];if(currentChatCharacter&&currentChatCharacter['isGroup']&&currentChatCharacter[_0x4c0b26(0x12a6)]){const _0x2d106f=currentChatCharacter['members']['find'](_0x368842=>_0x368842[_0x4c0b26(0x1a1c)]===_0x3b342b[_0x4c0b26(0x1a1c)]);if(_0x2d106f)_0x13d34d=_0x2d106f['id'];}}else{if(typeof _0x3b342b===_0x4c0b26(0x28d)&&_0x3b342b[_0x4c0b26(0x211c)])_0x3fa6a5=_0x3b342b[_0x4c0b26(0x211c)];else _0x599f53&&_0x599f53[_0x4c0b26(0x211c)]&&(_0x3fa6a5=_0x599f53['content']);}}if(_0x3fa6a5&&_0x13d34d){if(currentChatCharacter?.[_0x4c0b26(0x1f68)])for(const _0x477c56 of currentChatCharacter[_0x4c0b26(0x12a6)]||[]){const _0x34033f=await shouldRecordGroupMemoryForCharacter(_0x477c56['id'],currentChatCharacter['id']);_0x34033f?(await recordCrossAppEvent(_0x477c56['id'],_0x4c0b26(0x1a70),_0x4c0b26(0x120e),{'id':_0x477c56['id'],'type':_0x4c0b26(0x764),'sender':'ai','content':_0x3fa6a5,'chatType':_0x4c0b26(0x1257),'groupName':currentChatCharacter['name'],'groupId':currentChatCharacter['id']},_0x599f53['id']),console[_0x4c0b26(0x2187)](_0x4c0b26(0x1401)+_0x477c56['id']+_0x4c0b26(0x1f73)+_0x3fa6a5[_0x4c0b26(0x17ca)](0x0,0x32)+_0x4c0b26(0x1520))):console[_0x4c0b26(0x2187)](_0x4c0b26(0x1f9c)+_0x477c56['id']+_0x4c0b26(0x1320)+currentChatCharacter['id']+'\x20共享记忆');}else await recordCrossAppEvent(_0x1f111a,'chat',_0x4c0b26(0x120e),{'id':currentChatCharacter['id'],'type':_0x4c0b26(0x219),'sender':'ai','content':_0x3fa6a5,'chatType':_0x4c0b26(0xdf3)},_0x599f53['id']),console[_0x4c0b26(0x2187)](_0x4c0b26(0x1401)+_0x1f111a+_0x4c0b26(0x1f73)+_0x3fa6a5[_0x4c0b26(0x17ca)](0x0,0x32)+_0x4c0b26(0x1520));}}catch(_0x753645){console[_0x4c0b26(0x174a)](_0x4c0b26(0x110d),_0x753645);}},0x3e8+_0x2a8ad2*0xc8);if(_0x2a8ad2<_0x460c2b[_0x59272a(0x19ee)]-0x1){const _0x3643b1=Math[_0x59272a(0x11a8)]()*0x3e8+0x1f4;await new Promise(_0x1041a6=>setTimeout(_0x1041a6,_0x3643b1)),_0x2a8ad2<_0x460c2b['length']-0x1&&(showTypingIndicator(),await new Promise(_0x45e1ef=>setTimeout(_0x45e1ef,Math[_0x59272a(0x11a8)]()*0x320+0x190)),hideTypingIndicator());}}renderMessageList();}catch(_0x4cc4c8){console[_0x59272a(0x174a)](_0x59272a(0xb2b),_0x4cc4c8),hideTypingIndicator();const _0x156856={'id':Date[_0x59272a(0x2eb)]()[_0x59272a(0x1878)](),'sender':_0x59272a(0xb11),'content':_0x59272a(0x810)+_0x4cc4c8['message']+']','timestamp':Date[_0x59272a(0x2eb)]()};chatMessages[_0x1f111a]['push'](_0x156856),saveChatMessages(),addMessageWithAnimation(_0x156856,_0x1f111a),renderMessageList();}finally{isWaitingForReply=![],pendingUserMessage=null,_0x3a141a&&(_0x3a141a['disabled']=![],_0x3a141a[_0x59272a(0x14eb)]['opacity']='',_0x3a141a[_0x59272a(0x14eb)][_0x59272a(0x2231)]=_0x59272a(0x102b),_0x3a141a[_0x59272a(0x1c1b)][_0x59272a(0x1493)]('waiting'),_0x3a141a[_0x59272a(0x33a)]=_0x59272a(0x2123),_0x3a141a[_0x59272a(0x378)]=_0x59272a(0x1bc8)),updateFloatingButtonsVisibility();}}function resetFloatingButtonsState(){const _0x299545=_0x211817;pendingUserMessage=null,isWaitingForReply=![];const _0x419ddb=document[_0x299545(0x1262)](_0x299545(0x1d2b));_0x419ddb&&(_0x419ddb[_0x299545(0x559)]=![],_0x419ddb[_0x299545(0x14eb)][_0x299545(0x11af)]='',_0x419ddb[_0x299545(0x14eb)][_0x299545(0x2231)]='none',_0x419ddb[_0x299545(0x33a)]='<i\x20class=\x22fas\x20fa-comment-dots\x22></i>',_0x419ddb[_0x299545(0x378)]=_0x299545(0x1bc8),_0x419ddb[_0x299545(0x1c1b)][_0x299545(0x1493)](_0x299545(0x2b1))),updateFloatingButtonsVisibility();}function updateFloatingButtonsVisibility(){const _0x487966=_0x211817;if(!currentChatCharacter)return;const _0x5ac554=document[_0x487966(0x1262)](_0x487966(0x1a9)),_0x352c28=document[_0x487966(0x1262)](_0x487966(0x1d2b)),_0x4d195a=chatMessages[currentChatCharacter['id']]||[],_0x115f8b=_0x4d195a[_0x487966(0x19fa)](_0x12c82a=>_0x12c82a[_0x487966(0x8a1)]===_0x487966(0xb11));_0x5ac554&&(_0x115f8b?_0x5ac554[_0x487966(0x14eb)][_0x487966(0x4da)]=_0x487966(0x1fb7):_0x5ac554[_0x487966(0x14eb)][_0x487966(0x4da)]=_0x487966(0x102b)),_0x352c28&&_0x352c28['classList'][_0x487966(0x1493)](_0x487966(0xa52));}function handleMentionInput(_0x2aba9f){const _0x1d359e=_0x211817,_0x323601=_0x2aba9f[_0x1d359e(0x193d)],_0x2bece8=_0x323601[_0x1d359e(0x1ebc)],_0x2171d4=_0x323601[_0x1d359e(0x17e2)];let _0x5c852c=-0x1;for(let _0x5837df=_0x2171d4-0x1;_0x5837df>=0x0;_0x5837df--){if(_0x2bece8[_0x5837df]==='@'){_0x5c852c=_0x5837df;break;}else{if(_0x2bece8[_0x5837df]==='\x20'||_0x2bece8[_0x5837df]==='\x0a')break;}}if(_0x5c852c!==-0x1&&isGroupChat()){const _0x3d2f19=_0x2bece8[_0x1d359e(0x17ca)](_0x5c852c+0x1,_0x2171d4);mentionStartPos=_0x5c852c,currentMentionQuery=_0x3d2f19,showMentionDropdown(_0x3d2f19);}else hideMentionDropdown();}function handleMentionKeydown(_0x2a2fec){const _0x25966a=_0x211817,_0x4c03a1=document[_0x25966a(0x1262)](_0x25966a(0x1572)),_0x5a90ad=_0x4c03a1[_0x25966a(0x1897)](_0x25966a(0x2282));if(_0x2a2fec[_0x25966a(0x213c)]===_0x25966a(0x34a))_0x2a2fec['preventDefault'](),selectedMentionIndex=Math['min'](selectedMentionIndex+0x1,_0x5a90ad['length']-0x1),updateMentionSelection(_0x5a90ad);else{if(_0x2a2fec['key']==='ArrowUp')_0x2a2fec['preventDefault'](),selectedMentionIndex=Math[_0x25966a(0x658)](selectedMentionIndex-0x1,0x0),updateMentionSelection(_0x5a90ad);else{if(_0x2a2fec[_0x25966a(0x213c)]===_0x25966a(0xdcf)||_0x2a2fec[_0x25966a(0x213c)]==='Tab')_0x2a2fec[_0x25966a(0x36f)](),selectedMentionIndex>=0x0&&_0x5a90ad[selectedMentionIndex]&&selectMention(_0x5a90ad[selectedMentionIndex]);else _0x2a2fec[_0x25966a(0x213c)]==='Escape'&&(_0x2a2fec[_0x25966a(0x36f)](),hideMentionDropdown());}}}function isGroupChat(){return currentChatCharacter&&groupChats['find'](_0x3d76a0=>_0x3d76a0['id']===currentChatCharacter['id']);}function showMentionDropdown(_0xb8046d){const _0x5acf27=_0x211817;if(!isGroupChat())return;const _0x4e7a19=groupChats['find'](_0x232d46=>_0x232d46['id']===currentChatCharacter['id']);if(!_0x4e7a19||!_0x4e7a19['members'])return;const _0x27bf9a=document[_0x5acf27(0x1262)](_0x5acf27(0x1572)),_0x4f7f35=_0x4e7a19[_0x5acf27(0x12a6)][_0x5acf27(0x1e1f)](_0x960c88=>_0x960c88['name'][_0x5acf27(0x49e)]()[_0x5acf27(0x1831)](_0xb8046d[_0x5acf27(0x49e)]()));if(_0x4f7f35['length']===0x0){hideMentionDropdown();return;}_0x27bf9a['innerHTML']='',_0x4f7f35[_0x5acf27(0x19fb)]((_0x102fd2,_0x28a8c9)=>{const _0x2cd186=_0x5acf27,_0x528a7a=document[_0x2cd186(0xac6)](_0x2cd186(0xbbc));_0x528a7a[_0x2cd186(0x1722)]=_0x2cd186(0x93e),_0x528a7a['innerHTML']=_0x2cd186(0xe65)+(_0x102fd2['color']||_0x2cd186(0x1d8c))+';\x20'+(_0x102fd2[_0x2cd186(0x1994)]?_0x2cd186(0x2236)+_0x102fd2[_0x2cd186(0x1994)]+_0x2cd186(0x1dd):'')+_0x2cd186(0x1e29)+(_0x102fd2['avatarUrl']?'':_0x102fd2['name'][_0x2cd186(0xcc3)](0x0))+_0x2cd186(0xd6a)+_0x102fd2['name']+_0x2cd186(0x1f39),_0x528a7a[_0x2cd186(0x1f36)]=()=>selectMention(_0x528a7a),_0x528a7a[_0x2cd186(0x1ecd)][_0x2cd186(0x18a6)]=_0x102fd2[_0x2cd186(0x1a1c)],_0x528a7a[_0x2cd186(0x1ecd)][_0x2cd186(0x2031)]=_0x102fd2['id'],_0x27bf9a[_0x2cd186(0x497)](_0x528a7a);}),selectedMentionIndex=0x0,updateMentionSelection(_0x27bf9a[_0x5acf27(0x1897)](_0x5acf27(0x2282))),_0x27bf9a[_0x5acf27(0x14eb)]['display']=_0x5acf27(0x13de),mentionDropdownVisible=!![];}function hideMentionDropdown(){const _0x3c410c=_0x211817,_0xdc781d=document[_0x3c410c(0x1262)](_0x3c410c(0x1572));_0xdc781d[_0x3c410c(0x14eb)][_0x3c410c(0x4da)]=_0x3c410c(0x102b),mentionDropdownVisible=![],selectedMentionIndex=-0x1,mentionStartPos=-0x1,currentMentionQuery='';}function updateMentionSelection(_0x51fbf2){const _0x51458a=_0x211817;_0x51fbf2[_0x51458a(0x19fb)]((_0x3ed267,_0x52143a)=>{const _0x586b84=_0x51458a;_0x52143a===selectedMentionIndex?_0x3ed267[_0x586b84(0x1c1b)][_0x586b84(0x21e2)](_0x586b84(0x176b)):_0x3ed267[_0x586b84(0x1c1b)][_0x586b84(0x1493)](_0x586b84(0x176b));});}function selectMention(_0x141ede){const _0x1fdd14=_0x211817,_0xbbc7b=_0x141ede[_0x1fdd14(0x1ecd)][_0x1fdd14(0x18a6)],_0x109b02=document[_0x1fdd14(0x1262)](_0x1fdd14(0x21bd)),_0x2f1cdf=_0x109b02['value'],_0x33ecaf=_0x2f1cdf[_0x1fdd14(0x17ca)](0x0,mentionStartPos),_0x2967c8=_0x2f1cdf['substring'](mentionStartPos+0x1+currentMentionQuery[_0x1fdd14(0x19ee)]),_0x1b0598=_0x33ecaf+('@'+_0xbbc7b+'\x20')+_0x2967c8;_0x109b02['value']=_0x1b0598;const _0x56aaff=mentionStartPos+_0xbbc7b[_0x1fdd14(0x19ee)]+0x2;_0x109b02[_0x1fdd14(0x207)](_0x56aaff,_0x56aaff),hideMentionDropdown(),_0x109b02[_0x1fdd14(0x13cf)]();}function processMentions(_0x103e4f){const _0x260753=_0x211817;if(!_0x103e4f||typeof _0x103e4f!==_0x260753(0x11b7))return _0x103e4f;return _0x103e4f[_0x260753(0xe16)](/@([^\s@]+)/g,_0x260753(0x1663));}async function buildContextualMemoryForGroupChat(_0x58f9de,_0x374ba9){const _0x4a2b13=_0x211817;try{let _0x295359='';const _0x536e4a=_0x374ba9[_0x4a2b13(0x1b87)](/@([^\s@]+)/g);if(_0x536e4a)for(const _0xec175 of _0x536e4a){const _0xd15102=_0xec175[_0x4a2b13(0x17ca)](0x1),_0x354727=_0x58f9de[_0x4a2b13(0x12a6)]?.['find'](_0x32cf3d=>_0x32cf3d[_0x4a2b13(0x1a1c)]===_0xd15102);if(_0x354727){const _0x4fbc82=await getPrivateChatMemoryForMember(_0x354727['id'],_0x374ba9);_0x4fbc82&&(_0x295359+=_0x4a2b13(0x2217)+_0xd15102+_0x4a2b13(0x21b)+_0x4fbc82);}}const _0x1552a5=_0x374ba9[_0x4a2b13(0x1b87)](/\b\d{6,}\b/g);if(_0x1552a5)for(const _0x502264 of _0x1552a5){for(const _0x3633a5 of _0x58f9de[_0x4a2b13(0x12a6)]||[]){const _0x3a43e4=await searchNumberInPrivateChat(_0x3633a5['id'],_0x502264);if(_0x3a43e4){_0x295359+=_0x4a2b13(0x1926)+_0x502264+_0x4a2b13(0x1877)+_0x3633a5[_0x4a2b13(0x1a1c)]+_0x4a2b13(0x14c2)+_0x3a43e4;break;}}}return _0x295359;}catch(_0x275417){return console[_0x4a2b13(0x174a)](_0x4a2b13(0x7c7),_0x275417),'';}}async function getPrivateChatMemoryForMember(_0x2d4302,_0x3aa747){const _0x17a354=_0x211817;try{const _0xdcfcda=await db[_0x17a354(0x8ac)][_0x17a354(0xa24)](_0x17a354(0xaf5))['equals'](_0x2d4302)['and'](_0x587d2a=>_0x587d2a[_0x17a354(0x741)]===_0x17a354(0x1a70)&&_0x587d2a[_0x17a354(0x1da2)]?.['type']==='private_chat')[_0x17a354(0x16b0)]()[_0x17a354(0x163e)](0x5)[_0x17a354(0xf13)]();if(_0xdcfcda['length']===0x0)return'';let _0x2dd95a='';return _0xdcfcda[_0x17a354(0x19fb)](_0x3e4783=>{const _0x3055fb=_0x17a354,_0x488340=new Date(_0x3e4783['timestamp'])[_0x3055fb(0xecc)](),_0x4253a4=_0x3e4783[_0x3055fb(0x1da2)]?.[_0x3055fb(0x211c)]||_0x3e4783[_0x3055fb(0x1da2)]?.[_0x3055fb(0x1e8e)]||'';_0x4253a4&&(_0x2dd95a+='['+_0x488340+']\x20'+(_0x3e4783[_0x3055fb(0x1da2)]?.['sender']===_0x3055fb(0xa80)?'用户':'AI')+_0x3055fb(0x2117)+_0x4253a4[_0x3055fb(0x17ca)](0x0,0x32)+(_0x4253a4['length']>0x32?_0x3055fb(0x1520):'')+'\x0a');}),_0x2dd95a;}catch(_0x59d96f){return console[_0x17a354(0x174a)]('获取私聊记忆失败:',_0x59d96f),'';}}async function searchNumberInPrivateChat(_0x2970bb,_0x4e2150){const _0x26428e=_0x211817;try{const _0x5d868e=await db[_0x26428e(0x8ac)][_0x26428e(0xa24)](_0x26428e(0xaf5))[_0x26428e(0x1694)](_0x2970bb)[_0x26428e(0x82f)](_0x1f29c9=>_0x1f29c9[_0x26428e(0x741)]===_0x26428e(0x1a70)&&_0x1f29c9[_0x26428e(0x1da2)]?.[_0x26428e(0x1a4b)]===_0x26428e(0x219)&&(_0x1f29c9[_0x26428e(0x1da2)]?.['content']?.[_0x26428e(0x1831)](_0x4e2150)||_0x1f29c9[_0x26428e(0x1da2)]?.[_0x26428e(0x1e8e)]?.[_0x26428e(0x1831)](_0x4e2150)))[_0x26428e(0x16b0)]()['limit'](0x3)[_0x26428e(0xf13)]();if(_0x5d868e[_0x26428e(0x19ee)]===0x0)return'';let _0x55bc07='';return _0x5d868e[_0x26428e(0x19fb)](_0x4bcfc9=>{const _0x3c3b1e=_0x26428e,_0x5a3b99=new Date(_0x4bcfc9[_0x3c3b1e(0x1716)])[_0x3c3b1e(0xecc)](),_0x589ffb=_0x4bcfc9[_0x3c3b1e(0x1da2)]?.[_0x3c3b1e(0x211c)]||_0x4bcfc9['context']?.[_0x3c3b1e(0x1e8e)]||'';_0x589ffb&&(_0x55bc07+='['+_0x5a3b99+']\x20'+(_0x4bcfc9['context']?.[_0x3c3b1e(0x8a1)]===_0x3c3b1e(0xa80)?'用户':'AI')+_0x3c3b1e(0x2117)+_0x589ffb+'\x0a');}),_0x55bc07;}catch(_0x51c35f){return console[_0x26428e(0x174a)](_0x26428e(0x11ea),_0x51c35f),'';}}async function sendApiMessage(){const _0x24f031=_0x211817,_0x1204d1=document[_0x24f031(0x1262)]('api-chat-input'),_0x148838=_0x1204d1[_0x24f031(0x1ebc)]['trim']();if(!_0x148838)return;if(!currentChatCharacter){alert('请先选择一个角色');return;}if(_0x1204d1[_0x24f031(0x1ab5)])return;_0x1204d1[_0x24f031(0x1ab5)]=!![];try{const _0x32e441=Date[_0x24f031(0x2eb)]()[_0x24f031(0x1878)](),_0x9c484={'id':_0x32e441,'sender':_0x24f031(0x1e6d),'content':[{'type':_0x24f031(0x1378),'text':_0x148838}],'timestamp':Date[_0x24f031(0x2eb)](),'replyTo':currentReplyTo?{'id':currentReplyTo['id'],'content':currentReplyTo['content'],'senderName':currentReplyTo[_0x24f031(0x909)]}:null};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x24f031(0x1cd6)](_0x9c484);try{const _0x207d18=currentChatCharacter['id']+'_'+_0x9c484['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x24f031(0x19ee)]-0x1);await db[_0x24f031(0x19a2)]['add']({'id':_0x207d18,'characterId':currentChatCharacter['id'],'timestamp':_0x9c484[_0x24f031(0x1716)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x24f031(0x19ee)]-0x1,'originalMessageId':_0x9c484['id'],'messageData':_0x9c484}),console[_0x24f031(0x2187)]('✅\x20[高效发送]\x20单条消息已保存到数据库');}catch(_0xa342ba){console[_0x24f031(0x174a)](_0x24f031(0x74b),_0xa342ba),await saveChatMessagesImmediate();}_0x1204d1[_0x24f031(0x1ebc)]='',SoundManager[_0x24f031(0xaa5)](SoundManager['TYPES'][_0x24f031(0x56b)],currentChatCharacter?.['id']),cancelReply();currentChatCharacter&&delete chatReplyStates[currentChatCharacter['id']];adjustHeartrateForMessage(_0x148838,!![]),onUserMessageSent(currentChatCharacter['id']),addMessageWithAnimation(_0x9c484,currentChatCharacter['id']),checkAndCreateBlockedSystemMessage(_0x9c484,currentChatCharacter['id']),pendingUserMessage=_0x9c484;const _0x103e74=document['getElementById'](_0x24f031(0x1d2b));_0x103e74&&(_0x103e74['style'][_0x24f031(0x2231)]=_0x24f031(0x2241),_0x103e74[_0x24f031(0x1c1b)]['add'](_0x24f031(0x2b1)),_0x103e74[_0x24f031(0x378)]='点击获取AI回复'),setTimeout(async()=>{const _0x1ab11c=_0x24f031;try{const _0x58b960=chatMessages[currentChatCharacter['id']]||[];if(currentChatCharacter?.[_0x1ab11c(0x1f68)])for(const _0x526045 of currentChatCharacter[_0x1ab11c(0x12a6)]||[]){const _0x5fb683=await shouldRecordGroupMemoryForCharacter(_0x526045['id'],currentChatCharacter['id']);_0x5fb683?await recordCrossAppEvent(_0x526045['id'],'chat',_0x1ab11c(0x20fe),{'id':_0x526045['id'],'type':'group_chat','sender':_0x1ab11c(0xa80),'content':_0x148838,'chatType':_0x1ab11c(0x1257),'groupName':currentChatCharacter[_0x1ab11c(0x1a1c)],'groupId':currentChatCharacter['id']},_0x58b960[_0x58b960[_0x1ab11c(0x19ee)]-0x1]?.['id']):console[_0x1ab11c(0x2187)](_0x1ab11c(0x1f9c)+_0x526045['id']+_0x1ab11c(0x1320)+currentChatCharacter['id']+_0x1ab11c(0x1afd));}else await recordCrossAppEvent(currentChatCharacter['id'],_0x1ab11c(0x1a70),_0x1ab11c(0x20fe),{'id':currentChatCharacter['id'],'type':_0x1ab11c(0x219),'sender':_0x1ab11c(0xa80),'content':_0x148838,'chatType':'single'},_0x58b960[_0x58b960[_0x1ab11c(0x19ee)]-0x1]?.['id']);if(_0x58b960[_0x1ab11c(0x19ee)]%MEMORY_CONFIG[_0x1ab11c(0x2aa)]===0x0){const _0x1fecef=_0x58b960[_0x1ab11c(0x6d5)](-MEMORY_CONFIG[_0x1ab11c(0x2aa)]);await extractMemoriesWithAI(currentChatCharacter['id'],_0x1fecef,currentChatCharacter['id']),console[_0x1ab11c(0x2187)](_0x1ab11c(0x1095)+currentChatCharacter['name']+_0x1ab11c(0x294)+_0x58b960[_0x1ab11c(0x19ee)]);}}catch(_0x8b9b39){console['error']('记忆处理失败:',_0x8b9b39);}},0x3e8);}finally{setTimeout(()=>{const _0x275762=_0x24f031;_0x1204d1[_0x275762(0x1ab5)]=![];},0x64);}}let isRecording=![],recordingStartTime=0x0;async function handleVoiceRecording(){const _0x590b06=_0x211817;if(!currentChatCharacter){alert(_0x590b06(0x1346));return;}try{const _0x42df65=await showVoiceInputDialog();_0x42df65&&_0x42df65[_0x590b06(0x19d7)]()&&(sendVoiceMessage(_0x42df65[_0x590b06(0x19d7)]()),console[_0x590b06(0x2187)](_0x590b06(0x2144)));}catch(_0x2163e5){_0x2163e5[_0x590b06(0x1e8e)]===_0x590b06(0x809)?console[_0x590b06(0x2187)](_0x590b06(0xff3)):console[_0x590b06(0x174a)](_0x590b06(0xf3c),_0x2163e5);}}function resetRecordingState(){isRecording=![];}function showVoiceInputDialog(){return new Promise((_0x42a617,_0x599e9e)=>{const _0x5ddce0=_0x167f,_0x57bb7c=document[_0x5ddce0(0xac6)](_0x5ddce0(0xbbc));_0x57bb7c[_0x5ddce0(0x14eb)][_0x5ddce0(0x1f87)]=_0x5ddce0(0x1e7c);const _0x58ce59=document[_0x5ddce0(0xac6)]('div');_0x58ce59[_0x5ddce0(0x14eb)][_0x5ddce0(0x1f87)]=_0x5ddce0(0x584),_0x58ce59[_0x5ddce0(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:\x20center;\x20margin-bottom:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin:\x200;\x20color:\x20#333;\x22>语音转文字</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:\x208px\x200\x200\x200;\x20color:\x20#666;\x20font-size:\x2014px;\x22>请输入您想说的内容：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22voice-text-input\x22\x20placeholder=\x22在这里输入语音内容...\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2080px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20resize:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-sizing:\x20border-box;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:\x20flex;\x20gap:\x2010px;\x20margin-top:\x2015px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22voice-cancel-btn\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#ddd;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22voice-send-btn\x22\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#4a84c1;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>发送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x57bb7c['appendChild'](_0x58ce59),document[_0x5ddce0(0x1da9)][_0x5ddce0(0x497)](_0x57bb7c);const _0x36cb3d=_0x58ce59[_0x5ddce0(0xb30)](_0x5ddce0(0x19e3)),_0x588fdc=_0x58ce59[_0x5ddce0(0xb30)](_0x5ddce0(0x842)),_0x3d6022=_0x58ce59[_0x5ddce0(0xb30)]('#voice-send-btn');setTimeout(()=>_0x36cb3d[_0x5ddce0(0x13cf)](),0x64),_0x588fdc['onclick']=()=>{const _0x2f3e05=_0x5ddce0;document[_0x2f3e05(0x1da9)][_0x2f3e05(0x858)](_0x57bb7c),_0x599e9e(new Error(_0x2f3e05(0x809)));},_0x3d6022[_0x5ddce0(0x1f36)]=()=>{const _0x10985d=_0x5ddce0,_0x460981=_0x36cb3d['value'][_0x10985d(0x19d7)]();_0x460981?(console[_0x10985d(0x2187)](_0x10985d(0x859),_0x460981),document[_0x10985d(0x1da9)]['removeChild'](_0x57bb7c),_0x42a617(_0x460981)):(console[_0x10985d(0x2187)](_0x10985d(0xd28)),_0x36cb3d[_0x10985d(0x13cf)]());},_0x57bb7c[_0x5ddce0(0x1f36)]=_0x371903=>{const _0x3a2e2c=_0x5ddce0;_0x371903[_0x3a2e2c(0x193d)]===_0x57bb7c&&(document[_0x3a2e2c(0x1da9)]['removeChild'](_0x57bb7c),_0x599e9e(new Error(_0x3a2e2c(0x809))));},_0x36cb3d['onkeydown']=_0x38d67e=>{const _0x2af6fc=_0x5ddce0;_0x38d67e[_0x2af6fc(0x213c)]==='Enter'&&!_0x38d67e['shiftKey']&&(_0x38d67e[_0x2af6fc(0x36f)](),console['log'](_0x2af6fc(0xadc)),_0x3d6022['click']());};});}async function sendVoiceMessage(_0x38bb4d){const _0x36ee9e=_0x211817;console[_0x36ee9e(0x2187)](_0x36ee9e(0x2125),_0x38bb4d);const _0x115ea8=Date[_0x36ee9e(0x2eb)]()[_0x36ee9e(0x1878)](),_0x353b0c=Math[_0x36ee9e(0x658)](0x1,Math[_0x36ee9e(0x708)](_0x38bb4d[_0x36ee9e(0x19ee)]/0x8)),_0xc391d6={'id':_0x115ea8,'sender':_0x36ee9e(0x1e6d),'type':_0x36ee9e(0x561),'content':_0x38bb4d,'duration':_0x353b0c,'timestamp':Date[_0x36ee9e(0x2eb)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x36ee9e(0x1cd6)](_0xc391d6),console[_0x36ee9e(0x2187)](_0x36ee9e(0x17ce));try{const _0x2662ca=currentChatCharacter['id']+'_'+_0xc391d6['id']+'_'+(chatMessages[currentChatCharacter['id']][_0x36ee9e(0x19ee)]-0x1);await db[_0x36ee9e(0x19a2)][_0x36ee9e(0x21e2)]({'id':_0x2662ca,'characterId':currentChatCharacter['id'],'timestamp':_0xc391d6[_0x36ee9e(0x1716)],'messageOrder':chatMessages[currentChatCharacter['id']][_0x36ee9e(0x19ee)]-0x1,'originalMessageId':_0xc391d6['id'],'messageData':_0xc391d6}),console[_0x36ee9e(0x2187)]('✅\x20[高效语音]\x20语音消息已保存到数据库');}catch(_0x15e975){console[_0x36ee9e(0x174a)]('语音消息单条保存失败，回退到批量保存:',_0x15e975),saveChatMessages();}adjustHeartrateForMessage(_0x38bb4d,!![]),onUserMessageSent(currentChatCharacter['id']),addMessageWithAnimation(_0xc391d6,currentChatCharacter['id']),console['log']('语音消息已添加到界面'),checkAndCreateBlockedSystemMessage(_0xc391d6,currentChatCharacter['id']),triggerStatusUpdateAfterMessage(currentChatCharacter['id']),pendingUserMessage=_0xc391d6;const _0x385b8d=document['getElementById'](_0x36ee9e(0x1d2b));_0x385b8d&&(_0x385b8d[_0x36ee9e(0x14eb)]['animation']=_0x36ee9e(0x2241),_0x385b8d[_0x36ee9e(0x1c1b)][_0x36ee9e(0x21e2)](_0x36ee9e(0x2b1)),_0x385b8d['title']=_0x36ee9e(0xd96)),console[_0x36ee9e(0x2187)]('语音消息发送流程完成');}function toggleVoiceText(_0x450806){const _0x336a5b=_0x211817,_0x28180e=_0x450806['closest'](_0x336a5b(0x192f))||_0x450806['closest'](_0x336a5b(0x1984));if(!_0x28180e)return;const _0x23e84e=_0x28180e[_0x336a5b(0xb30)](_0x336a5b(0x1e25));if(!_0x23e84e){const _0x5e6c99=_0x450806[_0x336a5b(0x2139)](_0x336a5b(0x6ae));if(!_0x5e6c99)return;const _0x1fd65c=document[_0x336a5b(0xac6)](_0x336a5b(0xbbc));_0x1fd65c['className']=_0x336a5b(0x1178),_0x1fd65c[_0x336a5b(0x13be)]=_0x5e6c99;if(_0x28180e[_0x336a5b(0x1c1b)]['contains'](_0x336a5b(0x1e51)))_0x28180e[_0x336a5b(0x497)](_0x1fd65c);else{const _0x21aac8=document['createElement'](_0x336a5b(0xbbc));_0x21aac8[_0x336a5b(0x1722)]=_0x28180e['classList']['contains']('sent')?_0x336a5b(0x1547):_0x336a5b(0x1e0e);const _0x5e58c6=_0x28180e[_0x336a5b(0xb30)](_0x336a5b(0xa99));_0x5e58c6&&(_0x28180e[_0x336a5b(0x858)](_0x5e58c6),_0x21aac8[_0x336a5b(0x497)](_0x5e58c6),_0x21aac8[_0x336a5b(0x497)](_0x1fd65c),_0x28180e[_0x336a5b(0x497)](_0x21aac8));}setTimeout(()=>{const _0x580e1a=_0x336a5b;_0x1fd65c[_0x580e1a(0x1c1b)][_0x580e1a(0x21e2)](_0x580e1a(0x85c));},0xa);return;}_0x23e84e[_0x336a5b(0x1c1b)][_0x336a5b(0x971)](_0x336a5b(0x85c))?(_0x23e84e[_0x336a5b(0x1c1b)][_0x336a5b(0x1493)](_0x336a5b(0x85c)),setTimeout(()=>{const _0x3150c1=_0x336a5b;_0x23e84e['style'][_0x3150c1(0x4da)]=_0x3150c1(0x102b);},0x12c)):(_0x23e84e[_0x336a5b(0x14eb)][_0x336a5b(0x4da)]=_0x336a5b(0x13de),setTimeout(()=>{_0x23e84e['classList']['add']('visible');},0xa));}let isLoadingMoments=![];async function loadMoments(){const _0x39ef0e=_0x211817;try{if(isLoadingMoments){console[_0x39ef0e(0x2187)](_0x39ef0e(0x16fe));return;}isLoadingMoments=!![];const _0x32a1d8=document[_0x39ef0e(0x1262)](_0x39ef0e(0x12b1));if(!_0x32a1d8){isLoadingMoments=![];return;}const _0x5267a0=new Set();Array['from'](_0x32a1d8['children'])[_0x39ef0e(0x19fb)](_0x40056a=>{const _0x2bdb64=_0x39ef0e,_0x464d40=_0x40056a[_0x2bdb64(0x2139)](_0x2bdb64(0x18f));_0x464d40&&_0x5267a0[_0x2bdb64(0x21e2)](_0x464d40);});const _0x2f6289=await db['moments']['orderBy'](_0x39ef0e(0x1716))['reverse']()[_0x39ef0e(0xf13)]();_0x5267a0[_0x39ef0e(0x2d8)]===0x0?(_0x32a1d8[_0x39ef0e(0x33a)]='',console[_0x39ef0e(0x2187)](_0x39ef0e(0x2199))):console[_0x39ef0e(0x2187)](_0x39ef0e(0x1f53));if(_0x2f6289['length']>0x0){for(const _0x19622f of _0x2f6289){if(_0x5267a0[_0x39ef0e(0x975)](_0x19622f['id'][_0x39ef0e(0x1878)]()))continue;const _0x591c98=await db[_0x39ef0e(0x40a)]['where']('momentId')[_0x39ef0e(0x1694)](_0x19622f['id'])[_0x39ef0e(0xc44)](),_0x2f7d65=await db[_0x39ef0e(0x17d5)][_0x39ef0e(0xa24)](_0x39ef0e(0x9ba))['equals'](_0x19622f['id'])[_0x39ef0e(0xc44)](),_0x4d12b6=await db[_0x39ef0e(0x17d5)][_0x39ef0e(0xa24)](_0x39ef0e(0x9ba))[_0x39ef0e(0x1694)](_0x19622f['id'])[_0x39ef0e(0xf13)]();_0x4d12b6[_0x39ef0e(0x1104)]((_0x52ff7,_0x133c12)=>_0x52ff7[_0x39ef0e(0x1716)]-_0x133c12[_0x39ef0e(0x1716)]);const _0x40b7f7=await db['momentLocations'][_0x39ef0e(0xa24)]('momentId')[_0x39ef0e(0x1694)](_0x19622f['id'])[_0x39ef0e(0x1a7b)](),_0x2fb4ba=_0x40b7f7?_0x40b7f7[_0x39ef0e(0x1b93)]:'',_0x369d5e=await db[_0x39ef0e(0x230c)][_0x39ef0e(0xa24)](_0x39ef0e(0x9ba))[_0x39ef0e(0x1694)](_0x19622f['id'])[_0x39ef0e(0xf13)](),_0x3044bc=_0x369d5e[_0x39ef0e(0x6a4)](_0x3525df=>_0x3525df['mentionedCharacterId']),_0x8a8dcc=await db[_0x39ef0e(0x367)][_0x39ef0e(0xa24)]('momentId')[_0x39ef0e(0x1694)](_0x19622f['id'])[_0x39ef0e(0x1a7b)](),_0x1a6f6e=_0x8a8dcc?_0x8a8dcc['visibility']:_0x39ef0e(0x88e),_0xa2607e=_0x8a8dcc?_0x8a8dcc['visibleGroups']:[];let _0x56021b=null;if(_0x19622f[_0x39ef0e(0x1f8a)]&&isValidAvatarUrl(_0x19622f[_0x39ef0e(0x1f8a)]))_0x56021b=_0x19622f[_0x39ef0e(0x1f8a)];else{_0x56021b=await getDefaultAvatar();if(_0x19622f[_0x39ef0e(0x1f8a)]&&!isValidAvatarUrl(_0x19622f[_0x39ef0e(0x1f8a)])){console[_0x39ef0e(0x2187)](_0x39ef0e(0xf51)+_0x19622f['id']+_0x39ef0e(0x2db));try{await db[_0x39ef0e(0x9c7)]['update'](_0x19622f['id'],{'avatar':_0x56021b});}catch(_0x2ebe78){console['error'](_0x39ef0e(0x6de),_0x2ebe78);}}}const _0x27097b=createMomentElement({'id':_0x19622f['id'],'authorId':_0x19622f[_0x39ef0e(0x22d2)],'nickname':_0x19622f['nickname'],'avatar':_0x56021b,'text':_0x19622f[_0x39ef0e(0x1378)],'images':_0x19622f[_0x39ef0e(0x987)]||[],'time':_0x19622f[_0x39ef0e(0x1236)],'timestamp':_0x19622f[_0x39ef0e(0x1716)],'likes':_0x591c98,'comments':_0x4d12b6,'location':_0x2fb4ba,'mentions':_0x3044bc,'visibility':_0x1a6f6e,'visibleGroups':_0xa2607e}),_0x15ffa8=_0x19622f[_0x39ef0e(0x1716)];let _0x3bb1a1=null;for(let _0x4a89a9=0x0;_0x4a89a9<_0x32a1d8[_0x39ef0e(0xe48)][_0x39ef0e(0x19ee)];_0x4a89a9++){const _0x3e83aa=_0x32a1d8[_0x39ef0e(0xe48)][_0x4a89a9],_0x7a1e78=parseInt(_0x3e83aa['getAttribute']('data-timestamp')||'0');if(_0x15ffa8>_0x7a1e78){_0x3bb1a1=_0x3e83aa;break;}}_0x3bb1a1?_0x32a1d8['insertBefore'](_0x27097b,_0x3bb1a1):_0x32a1d8['appendChild'](_0x27097b),updateMomentLikeDisplay(_0x19622f['id']),_0x4d12b6&&_0x4d12b6[_0x39ef0e(0x19ee)]>0x0&&_0x4d12b6[_0x39ef0e(0x19fb)](_0x5c61b9=>{const _0x1e041c=_0x39ef0e;!_0x5c61b9[_0x1e041c(0x1236)]&&_0x5c61b9[_0x1e041c(0x1716)]&&(_0x5c61b9['time']=formatTime(new Date(_0x5c61b9['timestamp']))),displayCommentUnderMoment(_0x19622f['id'],_0x5c61b9);});}console[_0x39ef0e(0x2187)]('成功加载',_0x2f6289[_0x39ef0e(0x19ee)],_0x39ef0e(0x1a71));}else console[_0x39ef0e(0x2187)](_0x39ef0e(0x16e8));startTimeUpdater(),console[_0x39ef0e(0x2187)](_0x39ef0e(0xcc9),_0x2f6289['length'],_0x39ef0e(0x1a71));}catch(_0x35d8e2){console[_0x39ef0e(0x174a)](_0x39ef0e(0x1f62),_0x35d8e2);}finally{isLoadingMoments=![];}}let momentImages=[],selectedLocation='',selectedMomentMentions=[],selectedVisibility=_0x211817(0x88e),selectedVisibilityGroups=[];function showPublishMoment(){const _0x3a7ced=_0x211817;showApp(_0x3a7ced(0xbcd)),document['getElementById']('moment-text')[_0x3a7ced(0x1ebc)]='',momentImages=[],updateMomentImagesGrid(),document[_0x3a7ced(0x1262)](_0x3a7ced(0x13a5))[_0x3a7ced(0x13be)]='',selectedLocation='',document['querySelector'](_0x3a7ced(0x8ae))[_0x3a7ced(0x1c1b)]['remove']('active'),selectedMomentMentions=[],updateSelectedMomentMentionsDisplay(),selectedVisibility=_0x3a7ced(0x88e),selectedVisibilityGroups=[],updateSelectedVisibilityDisplay();const _0x5de971=document['querySelector'](_0x3a7ced(0xed3));_0x5de971&&(_0x5de971['disabled']=![],_0x5de971[_0x3a7ced(0x13be)]='发表');}function hidePublishMoment(){const _0x8f9269=_0x211817;showApp('chat-screen'),switchChatTab(_0x8f9269(0x1fbe));}function showLocationModal(){const _0x3b3898=_0x211817;document[_0x3b3898(0x1262)]('location-modal')[_0x3b3898(0x14eb)][_0x3b3898(0x4da)]='flex',document[_0x3b3898(0x1262)](_0x3b3898(0xfc8))['value']='',setTimeout(()=>{const _0x2e459d=_0x3b3898;document[_0x2e459d(0x1262)](_0x2e459d(0xfc8))[_0x2e459d(0x13cf)]();},0x64);}function hideLocationModal(_0x37c2fd){const _0xac4282=_0x211817;if(_0x37c2fd&&_0x37c2fd[_0xac4282(0x193d)]!==_0x37c2fd['currentTarget'])return;document[_0xac4282(0x1262)](_0xac4282(0x788))[_0xac4282(0x14eb)][_0xac4282(0x4da)]=_0xac4282(0x102b);}function confirmLocation(){const _0x10c334=_0x211817,_0x5ae9e5=document[_0x10c334(0x1262)](_0x10c334(0xfc8)),_0x42a449=_0x5ae9e5[_0x10c334(0x1ebc)][_0x10c334(0x19d7)](),_0x3c139d=document[_0x10c334(0xb30)](_0x10c334(0x8ae));_0x42a449?(selectedLocation=_0x42a449,document[_0x10c334(0x1262)]('selected-location')['textContent']=_0x42a449,_0x3c139d[_0x10c334(0x1c1b)][_0x10c334(0x21e2)](_0x10c334(0x1a14))):(selectedLocation='',document[_0x10c334(0x1262)](_0x10c334(0x13a5))[_0x10c334(0x13be)]='',_0x3c139d[_0x10c334(0x1c1b)][_0x10c334(0x1493)](_0x10c334(0x1a14))),hideLocationModal();}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x18999a=_0x211817,_0x2c0d6e=document[_0x18999a(0x1262)](_0x18999a(0xfc8));_0x2c0d6e&&_0x2c0d6e['addEventListener'](_0x18999a(0xf5c),function(_0x516b00){const _0xc99a39=_0x18999a;_0x516b00[_0xc99a39(0x213c)]===_0xc99a39(0xdcf)&&confirmLocation();});});function showMomentMentionModal(){const _0x3c3dc9=_0x211817;document[_0x3c3dc9(0x1262)](_0x3c3dc9(0x6f0))[_0x3c3dc9(0x14eb)][_0x3c3dc9(0x4da)]=_0x3c3dc9(0x1fb7),loadMomentMentionCharacters();}function hideMomentMentionModal(_0x423e5d){const _0x2e7fcb=_0x211817;if(_0x423e5d&&_0x423e5d[_0x2e7fcb(0x193d)]!==_0x423e5d['currentTarget'])return;document[_0x2e7fcb(0x1262)](_0x2e7fcb(0x6f0))[_0x2e7fcb(0x14eb)][_0x2e7fcb(0x4da)]=_0x2e7fcb(0x102b);}function loadMomentMentionCharacters(){const _0xb7d790=_0x211817,_0x225d34=document[_0xb7d790(0x1262)](_0xb7d790(0x1718));_0x225d34[_0xb7d790(0x33a)]='';if(!characters||characters[_0xb7d790(0x19ee)]===0x0){_0x225d34['innerHTML']=_0xb7d790(0x6b5);return;}characters['forEach'](_0x34d1fe=>{const _0x3343a0=_0xb7d790,_0x1189cd=document[_0x3343a0(0xac6)]('div');_0x1189cd[_0x3343a0(0x1722)]=_0x3343a0(0xe9f),_0x1189cd[_0x3343a0(0x1058)]('data-character-id',_0x34d1fe['id']);selectedMomentMentions[_0x3343a0(0x1831)](_0x34d1fe['id'])&&_0x1189cd['classList'][_0x3343a0(0x21e2)]('selected');let _0x2375e8=_0x34d1fe['avatarUrl']||createDefaultAvatar(_0x34d1fe[_0x3343a0(0x1a1c)]);_0x1189cd[_0x3343a0(0x33a)]=_0x3343a0(0x1648)+_0x2375e8+_0x3343a0(0x222c)+_0x34d1fe['name']+_0x3343a0(0x931)+createDefaultAvatar(_0x34d1fe[_0x3343a0(0x1a1c)])+_0x3343a0(0x13fa)+_0x34d1fe[_0x3343a0(0x1a1c)]+_0x3343a0(0x1488),_0x1189cd[_0x3343a0(0x1f36)]=_0x4a36a3=>{const _0x3c9261=_0x3343a0;_0x4a36a3['preventDefault'](),_0x4a36a3[_0x3c9261(0x902)](),toggleMomentMentionCharacter(_0x34d1fe['id']);},_0x225d34[_0x3343a0(0x497)](_0x1189cd);});}function toggleMomentMentionCharacter(_0x308142){const _0x337150=_0x211817,_0x3913a9=selectedMomentMentions['indexOf'](_0x308142),_0x550d98=document['querySelector']('.mention-character-item[data-character-id=\x22'+_0x308142+'\x22]');_0x3913a9>-0x1?(selectedMomentMentions[_0x337150(0x19b2)](_0x3913a9,0x1),_0x550d98[_0x337150(0x1c1b)][_0x337150(0x1493)](_0x337150(0x176b))):(selectedMomentMentions[_0x337150(0x1cd6)](_0x308142),_0x550d98['classList'][_0x337150(0x21e2)](_0x337150(0x176b))),console[_0x337150(0x2187)](_0x337150(0x2d1),_0x308142,'Selected\x20mentions:',selectedMomentMentions);}function confirmMomentMention(){updateSelectedMomentMentionsDisplay(),hideMomentMentionModal();}function updateSelectedMomentMentionsDisplay(){const _0x5cef17=_0x211817,_0x4f5404=document[_0x5cef17(0x1262)](_0x5cef17(0x21d0)),_0x2f63fb=document[_0x5cef17(0xb30)](_0x5cef17(0xeb6));_0x4f5404[_0x5cef17(0x33a)]='',selectedMomentMentions[_0x5cef17(0x19ee)]>0x0?(_0x2f63fb[_0x5cef17(0x1c1b)][_0x5cef17(0x21e2)](_0x5cef17(0x1a14)),selectedMomentMentions[_0x5cef17(0x19fb)](_0x1367ae=>{const _0xa445b5=_0x5cef17,_0x3a59b3=characters[_0xa445b5(0xaf4)](_0x26dc05=>_0x26dc05['id']===_0x1367ae);if(_0x3a59b3){const _0x11c6a1=document[_0xa445b5(0xac6)]('img');_0x11c6a1['src']=_0x3a59b3[_0xa445b5(0x1994)]||createDefaultAvatar(_0x3a59b3[_0xa445b5(0x1a1c)]),_0x11c6a1[_0xa445b5(0x2292)]=_0x3a59b3[_0xa445b5(0x1a1c)],_0x11c6a1['className']=_0xa445b5(0x11a0),_0x11c6a1[_0xa445b5(0x21ec)]=function(){const _0x3ac15c=_0xa445b5;this[_0x3ac15c(0x45c)]=createDefaultAvatar(_0x3a59b3['name']);},_0x4f5404[_0xa445b5(0x497)](_0x11c6a1);}})):_0x2f63fb['classList'][_0x5cef17(0x1493)](_0x5cef17(0x1a14));}function createMomentMentionsDisplay(_0x1f1205){const _0x4943e9=_0x211817;if(!_0x1f1205||_0x1f1205['length']===0x0)return'';const _0xb6397f=_0x1f1205[_0x4943e9(0x6a4)](_0x2d4502=>{const _0x28b731=_0x4943e9,_0x48afed=characters[_0x28b731(0xaf4)](_0x3432fa=>_0x3432fa['id']===_0x2d4502);return _0x48afed?_0x48afed[_0x28b731(0x1a1c)]:'未知角色';})[_0x4943e9(0x1e1f)](_0x57f76a=>_0x57f76a!=='未知角色');if(_0xb6397f[_0x4943e9(0x19ee)]===0x0)return'';return'<div\x20class=\x22moment-mentions\x22>提到了：'+_0xb6397f[_0x4943e9(0x122b)]('，')+'</div>';}function createVisibilityIndicator(_0x1abf66,_0x4eb392){const _0x199b13=_0x211817;if(!_0x1abf66||_0x1abf66==='public')return'';let _0xba5ca3='',_0x1cc8c3='',_0x28d3ad='';switch(_0x1abf66){case _0x199b13(0x9db):_0xba5ca3=_0x199b13(0x3a2),_0x1cc8c3='私密',_0x28d3ad='私密';break;case'partial':_0xba5ca3='fas\x20fa-users',_0x1cc8c3=_0x199b13(0x6e6);if(_0x4eb392&&_0x4eb392[_0x199b13(0x19ee)]>0x0){const _0x5d42ed=_0x4eb392[_0x199b13(0x6a4)](_0x217e83=>{const _0x4a3b64=_0x199b13,_0x150706=characterGroups[_0x4a3b64(0xaf4)](_0x204f64=>_0x204f64['id']===_0x217e83);return _0x150706?_0x150706[_0x4a3b64(0x1a1c)]:_0x4a3b64(0x1e5d);})[_0x199b13(0x1e1f)](_0x3b3571=>_0x3b3571!==_0x199b13(0x1e5d));_0x28d3ad=_0x5d42ed['length']>0x0?_0x5d42ed['join']('、'):_0x199b13(0x6e6);}else _0x28d3ad='部分可见';break;default:return'';}return _0x199b13(0x7b6)+_0x1cc8c3+_0x199b13(0xc64)+_0xba5ca3+_0x199b13(0x1421)+_0x28d3ad+_0x199b13(0x1ca2);}function showVisibilityModal(){const _0x17a01d=_0x211817;document['getElementById'](_0x17a01d(0x6ff))[_0x17a01d(0x14eb)][_0x17a01d(0x4da)]='flex',loadVisibilityOptions();}function hideVisibilityModal(_0xc2ebff){const _0xc595af=_0x211817;if(_0xc2ebff&&_0xc2ebff[_0xc595af(0x193d)]!==_0xc2ebff[_0xc595af(0x1fac)])return;document[_0xc595af(0x1262)]('visibility-modal')[_0xc595af(0x14eb)][_0xc595af(0x4da)]=_0xc595af(0x102b);}function loadVisibilityOptions(){const _0x33333b=_0x211817,_0x18e21e=document['querySelectorAll'](_0x33333b(0x15c4));_0x18e21e[_0x33333b(0x19fb)](_0x5ea670=>{const _0x319304=_0x33333b;_0x5ea670[_0x319304(0x1c1b)][_0x319304(0x1493)](_0x319304(0x176b)),_0x5ea670[_0x319304(0x1ecd)][_0x319304(0x1ebc)]===selectedVisibility&&_0x5ea670[_0x319304(0x1c1b)][_0x319304(0x21e2)](_0x319304(0x176b)),_0x5ea670[_0x319304(0x1f36)]=()=>selectVisibilityOption(_0x5ea670['dataset'][_0x319304(0x1ebc)]);}),selectedVisibility===_0x33333b(0x1e04)?showVisibilityGroups():hideVisibilityGroups();}function selectVisibilityOption(_0x419149){const _0x221107=_0x211817;selectedVisibility=_0x419149;const _0x6845ed=document[_0x221107(0x1897)]('.visibility-option');_0x6845ed['forEach'](_0x8b3c39=>{const _0xfcfef6=_0x221107;_0x8b3c39[_0xfcfef6(0x1c1b)][_0xfcfef6(0x1493)]('selected'),_0x8b3c39[_0xfcfef6(0x1ecd)][_0xfcfef6(0x1ebc)]===_0x419149&&_0x8b3c39[_0xfcfef6(0x1c1b)][_0xfcfef6(0x21e2)](_0xfcfef6(0x176b));}),_0x419149===_0x221107(0x1e04)?showVisibilityGroups():(hideVisibilityGroups(),selectedVisibilityGroups=[]);}function showVisibilityGroups(){const _0x357301=_0x211817,_0x15b96c=document['getElementById'](_0x357301(0x2244)),_0x3e4395=document['getElementById']('visibility-groups-list');_0x15b96c['style'][_0x357301(0x4da)]='block',_0x3e4395['innerHTML']='';const _0x44e2f8=characterGroups[_0x357301(0x1e1f)](_0x3b1aba=>!_0x3b1aba[_0x357301(0x1d6)]&&_0x3b1aba[_0x357301(0x11c0)]);if(_0x44e2f8[_0x357301(0x19ee)]===0x0){_0x3e4395[_0x357301(0x33a)]=_0x357301(0x4d4);return;}_0x44e2f8[_0x357301(0x19fb)](_0x1449db=>{const _0xde0d3d=_0x357301,_0x12483e=document[_0xde0d3d(0xac6)](_0xde0d3d(0xbbc));_0x12483e[_0xde0d3d(0x1722)]=_0xde0d3d(0x1589),_0x12483e[_0xde0d3d(0x1058)](_0xde0d3d(0x16ee),_0x1449db['id']),selectedVisibilityGroups[_0xde0d3d(0x1831)](_0x1449db['id'])&&_0x12483e[_0xde0d3d(0x1c1b)][_0xde0d3d(0x21e2)]('selected'),_0x12483e[_0xde0d3d(0x33a)]=_0xde0d3d(0x15e1)+_0x1449db['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22visibility-group-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-check\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x12483e[_0xde0d3d(0x1f36)]=()=>toggleVisibilityGroup(_0x1449db['id']),_0x3e4395[_0xde0d3d(0x497)](_0x12483e);});}function hideVisibilityGroups(){const _0x2c627a=_0x211817,_0x45bcd4=document[_0x2c627a(0x1262)](_0x2c627a(0x2244));_0x45bcd4[_0x2c627a(0x14eb)]['display']=_0x2c627a(0x102b);}function toggleVisibilityGroup(_0xaa376f){const _0x11e242=_0x211817,_0x38de8e=selectedVisibilityGroups[_0x11e242(0x13c5)](_0xaa376f),_0x24f856=document['querySelector']('.visibility-group-item[data-group-id=\x22'+_0xaa376f+'\x22]');_0x38de8e>-0x1?(selectedVisibilityGroups[_0x11e242(0x19b2)](_0x38de8e,0x1),_0x24f856['classList'][_0x11e242(0x1493)](_0x11e242(0x176b))):(selectedVisibilityGroups[_0x11e242(0x1cd6)](_0xaa376f),_0x24f856[_0x11e242(0x1c1b)][_0x11e242(0x21e2)]('selected'));}function confirmVisibility(){updateSelectedVisibilityDisplay(),hideVisibilityModal();}function updateSelectedVisibilityDisplay(){const _0x197cd6=_0x211817,_0x1423ca=document[_0x197cd6(0x1262)]('selected-visibility'),_0x3b241d=document['querySelector'](_0x197cd6(0x1e2));let _0x34dcad='',_0x5dd584=![];switch(selectedVisibility){case _0x197cd6(0x88e):_0x34dcad='公开',_0x5dd584=![];break;case _0x197cd6(0x9db):_0x34dcad='私密',_0x5dd584=!![];break;case _0x197cd6(0x1e04):if(selectedVisibilityGroups[_0x197cd6(0x19ee)]>0x0){const _0x49e77c=selectedVisibilityGroups[_0x197cd6(0x6a4)](_0x27d682=>{const _0x416a4b=_0x197cd6,_0x42529a=characterGroups[_0x416a4b(0xaf4)](_0x581adf=>_0x581adf['id']===_0x27d682);return _0x42529a?_0x42529a[_0x416a4b(0x1a1c)]:_0x416a4b(0x1e5d);})[_0x197cd6(0x1e1f)](_0x5d0b6a=>_0x5d0b6a!==_0x197cd6(0x1e5d));_0x34dcad=_0x49e77c[_0x197cd6(0x122b)]('、')+'可见',_0x5dd584=!![];}else _0x34dcad='部分可见',_0x5dd584=!![];break;}_0x1423ca[_0x197cd6(0x13be)]=_0x34dcad,_0x5dd584?_0x3b241d[_0x197cd6(0x1c1b)]['add']('active'):_0x3b241d[_0x197cd6(0x1c1b)]['remove']('active');}function addMomentImage(){const _0x5408a7=_0x211817,_0x4ce50a=document[_0x5408a7(0xac6)](_0x5408a7(0x1823));_0x4ce50a['type']=_0x5408a7(0x1b7a),_0x4ce50a[_0x5408a7(0x1515)]='image/*,.jpg,.jpeg,.png,.gif,.webp',_0x4ce50a[_0x5408a7(0xf7b)]=!![],_0x4ce50a['onchange']=function(_0x512ff4){const _0xf35017=_0x5408a7,_0x393aef=Array[_0xf35017(0x13c0)](_0x512ff4[_0xf35017(0x193d)][_0xf35017(0xf26)]);_0x393aef['forEach'](_0x5e5bc0=>{const _0x4e7e64=_0xf35017;if(momentImages[_0x4e7e64(0x19ee)]<0x9){const _0x443882=new FileReader();_0x443882[_0x4e7e64(0xc55)]=async function(_0x4f49be){const _0x283306=_0x4e7e64;try{const _0x1f1fcd=await compressImage(_0x4f49be[_0x283306(0x193d)]['result'],0x320,0.8);momentImages['push'](_0x1f1fcd),updateMomentImagesGrid();}catch(_0x5746d5){showToast('图片处理失败，请重试'),console[_0x283306(0x174a)](_0x283306(0x201f),_0x5746d5);}},_0x443882['readAsDataURL'](_0x5e5bc0);}});},_0x4ce50a[_0x5408a7(0x1859)]();}function removeMomentImage(_0x1df41a){const _0x2432bd=_0x211817;momentImages[_0x2432bd(0x19b2)](_0x1df41a,0x1),updateMomentImagesGrid();}function updateMomentImagesGrid(){const _0x49b8b9=_0x211817,_0x4abde1=document[_0x49b8b9(0x1262)](_0x49b8b9(0xa37));_0x4abde1['innerHTML']='',momentImages[_0x49b8b9(0x19fb)]((_0x1355a9,_0x607dc2)=>{const _0x2da8cf=_0x49b8b9,_0x565251=document[_0x2da8cf(0xac6)](_0x2da8cf(0xbbc));_0x565251['className']=_0x2da8cf(0x110b),_0x565251['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x1355a9+'\x22\x20alt=\x22动态图片\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22remove-image-btn\x22\x20onclick=\x22removeMomentImage('+_0x607dc2+_0x2da8cf(0xeb0),_0x4abde1[_0x2da8cf(0x497)](_0x565251);});}async function getDefaultAvatar(){const _0x333e9a=_0x211817;try{const _0x57e9f0=await getMomentsImage(_0x333e9a(0x1633));if(_0x57e9f0&&isValidAvatarUrl(_0x57e9f0))return console[_0x333e9a(0x2187)]('使用动态页面设置的头像'),_0x57e9f0;if(window[_0x333e9a(0x865)]&&isValidAvatarUrl(window[_0x333e9a(0x865)]))return console[_0x333e9a(0x2187)](_0x333e9a(0xd97)),window[_0x333e9a(0x865)];return window[_0x333e9a(0x865)]&&!isValidAvatarUrl(window['userAvatar'])&&(console['log']('清理无效的用户头像数据'),window[_0x333e9a(0x865)]=null),_0x57e9f0&&!isValidAvatarUrl(_0x57e9f0)&&console[_0x333e9a(0x2187)](_0x333e9a(0x1e2e)),console[_0x333e9a(0x2187)](_0x333e9a(0x2288)),_0x333e9a(0x18c3)+btoa(_0x333e9a(0xd74));}catch(_0x28b3d7){return console['error'](_0x333e9a(0x13f9),_0x28b3d7),'data:image/svg+xml;base64,'+btoa(_0x333e9a(0xd74));}}async function publishMoment(){const _0xf3efbe=_0x211817,_0x486a4d=document[_0xf3efbe(0x1262)](_0xf3efbe(0x1128))['value'][_0xf3efbe(0x19d7)](),_0x153484=document['querySelector'](_0xf3efbe(0xed3));if(!_0x486a4d&&momentImages[_0xf3efbe(0x19ee)]===0x0){showToast('请输入文字或选择图片');return;}_0x153484[_0xf3efbe(0x559)]=!![],_0x153484[_0xf3efbe(0x13be)]=_0xf3efbe(0x13cb);const _0x416ac5=document[_0xf3efbe(0x1262)](_0xf3efbe(0x22a9))?.[_0xf3efbe(0x13be)]||'我',_0xe0241=await getDefaultAvatar(),_0x3c1e17=new Date(),_0x71a1c2={'id':Date[_0xf3efbe(0x2eb)](),'authorId':_0xf3efbe(0xa80),'nickname':_0x416ac5,'avatar':_0xe0241,'text':_0x486a4d,'images':[...momentImages],'location':selectedLocation||'','mentions':[...selectedMomentMentions],'time':formatTime(_0x3c1e17),'timestamp':_0x3c1e17[_0xf3efbe(0x704)](),'visibility':selectedVisibility,'visibleGroups':[...selectedVisibilityGroups]};try{await db[_0xf3efbe(0x9c7)][_0xf3efbe(0x21e2)](_0x71a1c2);(selectedVisibility!=='public'||selectedVisibilityGroups[_0xf3efbe(0x19ee)]>0x0)&&await db[_0xf3efbe(0x367)]['add']({'momentId':_0x71a1c2['id'],'visibility':selectedVisibility,'visibleGroups':selectedVisibilityGroups,'timestamp':new Date()});selectedLocation&&await db[_0xf3efbe(0x5ea)]['add']({'momentId':_0x71a1c2['id'],'locationName':selectedLocation,'latitude':null,'longitude':null,'timestamp':new Date()});if(selectedMomentMentions[_0xf3efbe(0x19ee)]>0x0)for(const _0x5c0ae5 of selectedMomentMentions){await db[_0xf3efbe(0x230c)]['add']({'momentId':_0x71a1c2['id'],'mentionedCharacterId':_0x5c0ae5,'timestamp':new Date(),'isRead':![]});}_0x153484[_0xf3efbe(0x559)]=![],_0x153484[_0xf3efbe(0x13be)]='发表',showToast(_0xf3efbe(0x1111)),document[_0xf3efbe(0x1262)](_0xf3efbe(0x1128))[_0xf3efbe(0x1ebc)]='',momentImages=[],updateMomentImagesGrid(),document[_0xf3efbe(0x1262)](_0xf3efbe(0x13a5))[_0xf3efbe(0x13be)]='',selectedLocation='',document['querySelector'](_0xf3efbe(0x8ae))['classList'][_0xf3efbe(0x1493)](_0xf3efbe(0x1a14)),selectedMomentMentions=[],updateSelectedMomentMentionsDisplay(),selectedVisibility=_0xf3efbe(0x88e),selectedVisibilityGroups=[],updateSelectedVisibilityDisplay(),hidePublishMoment(),setTimeout(()=>{loadMoments();},0x64),startTimeUpdater(),setTimeout(()=>{const _0x3b6c72=_0xf3efbe;triggerAIInteractions(_0x71a1c2['id'],_0x3b6c72(0x7e3));},0x3e8),setTimeout(()=>{const _0x1ccb8b=_0xf3efbe;triggerAIInteractions(_0x71a1c2['id'],_0x1ccb8b(0x945));},0xbb8);}catch(_0x560758){console['error'](_0xf3efbe(0x1171),_0x560758),showToast(_0xf3efbe(0x1d1f)),_0x153484[_0xf3efbe(0x559)]=![],_0x153484[_0xf3efbe(0x13be)]='发表';}}function formatTime(_0x24f12e){const _0x3442ea=_0x211817;if(!_0x24f12e)return _0x3442ea(0x73c);!(_0x24f12e instanceof Date)&&(_0x24f12e=new Date(_0x24f12e));if(isNaN(_0x24f12e['getTime']()))return'无效时间';const _0x2eb101=new Date(),_0x2f0d15=_0x2eb101-_0x24f12e;if(_0x2f0d15<0xea60)return'刚刚';else{if(_0x2f0d15<0x36ee80)return Math[_0x3442ea(0x2180)](_0x2f0d15/0xea60)+'分钟前';else{if(_0x2f0d15<0x5265c00)return Math[_0x3442ea(0x2180)](_0x2f0d15/0x36ee80)+_0x3442ea(0x1ade);else return _0x2f0d15<0x240c8400?Math['floor'](_0x2f0d15/0x5265c00)+'天前':_0x24f12e[_0x3442ea(0xbf7)]();}}}function createMomentElement(_0x2d9f71){const _0x196971=_0x211817,_0x2e1b7c=document[_0x196971(0xac6)](_0x196971(0xbbc));_0x2e1b7c[_0x196971(0x1722)]=_0x196971(0x20fa),_0x2e1b7c[_0x196971(0x1058)](_0x196971(0x18f),_0x2d9f71['id']);_0x2d9f71['timestamp']&&_0x2e1b7c[_0x196971(0x1058)](_0x196971(0x30d),_0x2d9f71['timestamp']);let _0x2b448a='';_0x2d9f71[_0x196971(0x987)]&&_0x2d9f71['images']['length']>0x0&&(_0x2b448a=_0x196971(0x5d7)+_0x2d9f71[_0x196971(0x987)][_0x196971(0x6a4)](_0x4ded68=>'<img\x20src=\x22'+_0x4ded68+_0x196971(0x1447)+_0x4ded68+_0x196971(0x13d8))[_0x196971(0x122b)]('')+_0x196971(0x14cf));let _0x89bd01=null;if(_0x2d9f71['authorId']===_0x196971(0xa80))_0x89bd01=_0x2d9f71[_0x196971(0x1f8a)];else{_0x89bd01=_0x2d9f71[_0x196971(0x1f8a)];if(!_0x89bd01&&_0x2d9f71[_0x196971(0xaf5)]){const _0x23c804=characters[_0x196971(0xaf4)](_0x3a748d=>_0x3a748d['id']===_0x2d9f71[_0x196971(0xaf5)]);_0x23c804&&_0x23c804[_0x196971(0x1994)]&&(_0x89bd01=_0x23c804[_0x196971(0x1994)]);}}return _0x2e1b7c[_0x196971(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22moment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x89bd01?'<img\x20src=\x22'+_0x89bd01+'\x22\x20alt=\x22头像\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20object-fit:\x20cover;\x20border-radius:\x208px;\x22\x20onerror=\x22this.style.display=\x27none\x27;\x20this.parentElement.innerHTML=\x27<div\x20style=\x5c\x27width:\x2040px;\x20height:\x2040px;\x20background-color:\x20#ddd;\x20border-radius:\x208px;\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20color:\x20#666;\x20font-size:\x2014px;\x5c\x27>'+(_0x2d9f71[_0x196971(0x215c)]?_0x2d9f71[_0x196971(0x215c)]['charAt'](0x0):'?')+_0x196971(0x1068):_0x196971(0x9a7)+(_0x2d9f71[_0x196971(0x215c)]?_0x2d9f71[_0x196971(0x215c)][_0x196971(0xcc3)](0x0):'?')+_0x196971(0x1844))+_0x196971(0xcea)+_0x2d9f71[_0x196971(0x215c)]+_0x196971(0x490)+formatMomentText(_0x2d9f71[_0x196971(0x1378)])+_0x196971(0x19f3)+_0x2b448a+_0x196971(0x1578)+(_0x2d9f71['mentions']&&_0x2d9f71[_0x196971(0x2286)]['length']>0x0?createMomentMentionsDisplay(_0x2d9f71[_0x196971(0x2286)]):'')+_0x196971(0x1b90)+_0x2d9f71[_0x196971(0x1236)]+_0x196971(0x664)+(_0x2d9f71[_0x196971(0x2184)]?_0x196971(0x1d05)+_0x2d9f71[_0x196971(0x2184)]+'</div>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x2d9f71[_0x196971(0x22d2)]===_0x196971(0xa80)?createVisibilityIndicator(_0x2d9f71[_0x196971(0xea3)],_0x2d9f71[_0x196971(0xa9c)]):'')+_0x196971(0x1c6c)+_0x2d9f71['id']+_0x196971(0x22c4)+_0x2d9f71['id']+_0x196971(0x5d5)+_0x2d9f71['id']+_0x196971(0x1d53)+_0x2d9f71['id']+_0x196971(0xa49),addLongPressListener(_0x2e1b7c,_0x2d9f71['id']),((async()=>{const _0x553430=_0x196971;try{const _0x3c3f09=await db['momentLikes'][_0x553430(0xa24)]('[momentId+authorId]')[_0x553430(0x1694)]([_0x2d9f71['id'],_0x553430(0xa80)])[_0x553430(0x1a7b)]();if(_0x3c3f09){const _0x367fbb=_0x2e1b7c['querySelector']('.moment-action-btn'),_0x3f1e07=_0x367fbb[_0x553430(0xb30)]('i');_0x3f1e07[_0x553430(0x1c1b)][_0x553430(0x1493)](_0x553430(0x1d40)),_0x3f1e07[_0x553430(0x1c1b)][_0x553430(0x21e2)](_0x553430(0x2d2)),_0x367fbb['classList'][_0x553430(0x21e2)](_0x553430(0x342));}}catch(_0x9ad635){console[_0x553430(0x174a)](_0x553430(0x1851),_0x9ad635);}})()),_0x2e1b7c;}function previewImage(_0x138ec9){const _0x36be80=_0x211817,_0x15ac1e=document[_0x36be80(0xac6)]('div');_0x15ac1e[_0x36be80(0x14eb)]['cssText']=_0x36be80(0x1d24);const _0x4d9f1f=document[_0x36be80(0xac6)](_0x36be80(0x1223));_0x4d9f1f[_0x36be80(0x45c)]=_0x138ec9,_0x4d9f1f[_0x36be80(0x14eb)][_0x36be80(0x1f87)]=_0x36be80(0x3f1),_0x15ac1e['appendChild'](_0x4d9f1f),_0x15ac1e[_0x36be80(0x1f36)]=()=>document[_0x36be80(0x1da9)][_0x36be80(0x858)](_0x15ac1e),document[_0x36be80(0x1da9)]['appendChild'](_0x15ac1e);}function updateTextCount(){const _0x5daaed=_0x211817,_0x112ea4=document[_0x5daaed(0x1262)](_0x5daaed(0x1128)),_0x5ce6fe=document[_0x5daaed(0x1262)](_0x5daaed(0x530));if(_0x112ea4&&_0x5ce6fe){const _0x39406e=_0x112ea4[_0x5daaed(0x1ebc)][_0x5daaed(0x19ee)],_0x256140=0x1f4;_0x5ce6fe[_0x5daaed(0x13be)]=_0x39406e+'/'+_0x256140;if(_0x39406e>_0x256140*0.9)_0x5ce6fe[_0x5daaed(0x14eb)][_0x5daaed(0xc3d)]=_0x5daaed(0x18b3);else _0x39406e>_0x256140*0.8?_0x5ce6fe['style'][_0x5daaed(0xc3d)]=_0x5daaed(0x695):_0x5ce6fe[_0x5daaed(0x14eb)][_0x5daaed(0xc3d)]=_0x5daaed(0x90c);}}function showToast(_0x20fa89){const _0x4994f7=_0x211817,_0x55377d=document['createElement'](_0x4994f7(0xbbc));_0x55377d[_0x4994f7(0x14eb)][_0x4994f7(0x1f87)]=_0x4994f7(0xef8),_0x55377d[_0x4994f7(0x13be)]=_0x20fa89,document[_0x4994f7(0x1da9)][_0x4994f7(0x497)](_0x55377d),setTimeout(()=>{const _0xa4c607=_0x4994f7;document[_0xa4c607(0x1da9)][_0xa4c607(0x858)](_0x55377d);},0x7d0);}let timeUpdateInterval=null;function startTimeUpdater(){timeUpdateInterval&&clearInterval(timeUpdateInterval),updateMomentTimes(),timeUpdateInterval=setInterval(updateMomentTimes,0xea60);}function stopTimeUpdater(){timeUpdateInterval&&(clearInterval(timeUpdateInterval),timeUpdateInterval=null);}function updateMomentTimes(){const _0x1c3ab5=_0x211817;try{const _0x13965c=document[_0x1c3ab5(0x1897)](_0x1c3ab5(0x366));_0x13965c[_0x1c3ab5(0x19fb)](_0x392d18=>{const _0xc56317=_0x1c3ab5,_0x112d97=parseInt(_0x392d18[_0xc56317(0x2139)](_0xc56317(0x30d)));if(_0x112d97){const _0x117868=_0x392d18['querySelector'](_0xc56317(0xa67));if(_0x117868){const _0x4fb9c1=formatTime(new Date(_0x112d97));_0x117868['textContent']=_0x4fb9c1;}}});const _0x56a1cd=document[_0x1c3ab5(0x1897)]('.moment-comment[data-timestamp]');_0x56a1cd['forEach'](_0xc4170e=>{const _0x51d6ab=_0x1c3ab5,_0x12d27d=parseInt(_0xc4170e[_0x51d6ab(0x2139)]('data-timestamp'));if(_0x12d27d){const _0x20afaa=_0xc4170e[_0x51d6ab(0xb30)](_0x51d6ab(0x22db));if(_0x20afaa){const _0x2f6e69=formatTime(new Date(_0x12d27d));_0x20afaa[_0x51d6ab(0x13be)]=_0x2f6e69;}}});}catch(_0x2e0a5b){console[_0x1c3ab5(0x174a)](_0x1c3ab5(0xed1),_0x2e0a5b);}}let isSelectionMode=![],selectedMoments=new Set();async function toggleMomentLike(_0x3c73c1){const _0x54457a=_0x211817;if(isSelectionMode)return;const _0x3ebd01=document[_0x54457a(0xb30)](_0x54457a(0x1338)+_0x3c73c1+'\x22]');if(!_0x3ebd01)return;const _0x255246=_0x3ebd01[_0x54457a(0xb30)](_0x54457a(0x1211)),_0x2338b9=_0x255246[_0x54457a(0xb30)]('i');try{const _0x1a8681=await db[_0x54457a(0x40a)][_0x54457a(0xa24)](_0x54457a(0x1c73))['equals']([parseInt(_0x3c73c1),_0x54457a(0xa80)])['first']();_0x1a8681?(_0x2338b9[_0x54457a(0x1c1b)][_0x54457a(0x1493)](_0x54457a(0x2d2)),_0x2338b9[_0x54457a(0x1c1b)][_0x54457a(0x21e2)](_0x54457a(0x1d40)),_0x255246['classList']['remove'](_0x54457a(0x342)),await db[_0x54457a(0x40a)][_0x54457a(0x1f4a)]([parseInt(_0x3c73c1),'user'])):(_0x2338b9[_0x54457a(0x1c1b)][_0x54457a(0x21e2)]('fas'),_0x2338b9['classList'][_0x54457a(0x1493)](_0x54457a(0x1d40)),_0x255246[_0x54457a(0x1c1b)][_0x54457a(0x21e2)](_0x54457a(0x342)),await db[_0x54457a(0x40a)][_0x54457a(0x21e2)]({'momentId':parseInt(_0x3c73c1),'authorId':_0x54457a(0xa80),'characterId':_0x54457a(0xa80),'name':document[_0x54457a(0x1262)](_0x54457a(0x22a9))?.[_0x54457a(0x13be)]||'我','timestamp':Date['now']()}),triggerAIInteractions(_0x3c73c1,_0x54457a(0x7e3))),updateMomentLikeDisplay(_0x3c73c1);}catch(_0x2e1409){console[_0x54457a(0x174a)](_0x54457a(0xb47),_0x2e1409);}}function showMomentComments(_0x1082c8){if(isSelectionMode)return;showBottomCommentInput(_0x1082c8);}function showBottomCommentInput(_0x541a4e,_0x35eec8=null){const _0x56d6ee=_0x211817;closeBottomCommentInput();const _0x274dd9=_0x35eec8?_0x56d6ee(0x153d)+_0x35eec8+_0x56d6ee(0x1520):'写评论...',_0x277ba0=document['createElement'](_0x56d6ee(0xbbc));_0x277ba0['id']=_0x56d6ee(0x1c24),_0x277ba0['className']='bottom-comment-input',_0x277ba0[_0x56d6ee(0x33a)]=_0x56d6ee(0x1f1f)+_0x274dd9+_0x56d6ee(0x1933)+_0x541a4e+_0x56d6ee(0x1327)+(_0x35eec8||'')+_0x56d6ee(0x1588),document['body']['appendChild'](_0x277ba0);const _0x4be3a1=_0x277ba0[_0x56d6ee(0xb30)](_0x56d6ee(0x6c0));setTimeout(()=>{const _0x5d47eb=_0x56d6ee;_0x4be3a1[_0x5d47eb(0x13cf)](),window[_0x5d47eb(0xc87)](0x0,0x3c);},0x64),_0x4be3a1[_0x56d6ee(0x21e9)](_0x56d6ee(0xf20),_0x1591b7=>{const _0x44a1ee=_0x56d6ee;_0x1591b7[_0x44a1ee(0x213c)]===_0x44a1ee(0xdcf)&&submitBottomComment();}),setTimeout(()=>{const _0x16dd7d=_0x56d6ee;document['addEventListener'](_0x16dd7d(0x1859),handleBottomCommentClickOutside);},0x64);}function closeBottomCommentInput(){const _0x4f9393=_0x211817,_0x3ecfdc=document[_0x4f9393(0x1262)](_0x4f9393(0x1c24));_0x3ecfdc&&(_0x3ecfdc[_0x4f9393(0x1493)](),document[_0x4f9393(0xa21)](_0x4f9393(0x1859),handleBottomCommentClickOutside));}function handleBottomCommentClickOutside(_0x5588db){const _0x18c101=_0x211817,_0x365d0f=document[_0x18c101(0x1262)](_0x18c101(0x1c24));_0x365d0f&&!_0x365d0f[_0x18c101(0x971)](_0x5588db[_0x18c101(0x193d)])&&closeBottomCommentInput();}async function submitBottomComment(){const _0x1dbc5f=_0x211817,_0x1e2a0b=document['getElementById'](_0x1dbc5f(0x2229));if(!_0x1e2a0b)return;const _0x3cc306=_0x1e2a0b[_0x1dbc5f(0x1ebc)][_0x1dbc5f(0x19d7)](),_0x441031=_0x1e2a0b[_0x1dbc5f(0x2139)](_0x1dbc5f(0x18f)),_0x34f997=_0x1e2a0b[_0x1dbc5f(0x2139)](_0x1dbc5f(0x103e));if(!_0x3cc306){showToast(_0x1dbc5f(0x1f75));return;}const _0x5dcfd1=document[_0x1dbc5f(0x1262)](_0x1dbc5f(0x22a9))?.[_0x1dbc5f(0x13be)]||'我',_0x155b19={'id':Date['now'](),'nickname':_0x5dcfd1,'avatar':await getDefaultAvatar(),'text':_0x3cc306,'time':formatTime(new Date()),'timestamp':Date[_0x1dbc5f(0x2eb)](),'authorId':'user','replyTo':_0x34f997||null};saveCommentToMoment(_0x441031,_0x155b19),updateMomentCommentCount(_0x441031),displayCommentUnderMoment(_0x441031,_0x155b19),closeBottomCommentInput(),showToast(_0x1dbc5f(0x1ca1));if(_0x34f997&&_0x34f997!=='我'){const _0x1ff044=_0x441031+'-'+_0x34f997,_0x1a833e=commentConversationRounds[_0x1dbc5f(0xb78)](_0x1ff044)||0x0;_0x1a833e<0x3?(commentConversationRounds[_0x1dbc5f(0x83c)](_0x1ff044,_0x1a833e+0x1),console['log'](_0x1dbc5f(0x8f7)+_0x34f997+'\x20在动态\x20'+_0x441031+_0x1dbc5f(0x568)+(_0x1a833e+0x1)+'/3'),setTimeout(()=>{const _0x168f1f=_0x1dbc5f;console[_0x168f1f(0x2187)](_0x168f1f(0x1e8b)+_0x34f997+_0x168f1f(0x1b2e)+_0x3cc306+'\x22'),triggerAIReplyToUser(_0x441031,_0x34f997,_0x3cc306);},Math[_0x1dbc5f(0x11a8)]()*0xbb8+0x7d0)):console['log'](_0x34f997+'\x20在动态\x20'+_0x441031+_0x1dbc5f(0x1806));}else console[_0x1dbc5f(0x2187)](_0x1dbc5f(0xf95)+_0x34f997),!_0x34f997&&checkAndTriggerCharacterMomentReply(_0x441031,_0x3cc306);}async function checkAndTriggerCharacterMomentReply(_0x58df9e,_0x39fedf){const _0x281b5c=_0x211817;try{const _0x2a2fa3=await db['moments'][_0x281b5c(0xb78)](parseInt(_0x58df9e));if(!_0x2a2fa3||!_0x2a2fa3['characterId']||_0x2a2fa3['characterId']===_0x281b5c(0xa80)){console[_0x281b5c(0x2187)](_0x281b5c(0x933));return;}const _0x224965=characters['find'](_0x2398ec=>_0x2398ec['id']===_0x2a2fa3['characterId']);if(!_0x224965){console[_0x281b5c(0x2187)](_0x281b5c(0x1736)+_0x2a2fa3[_0x281b5c(0xaf5)]);return;}const _0x5020bc=_0x58df9e+'-'+_0x224965[_0x281b5c(0x1a1c)],_0x37a97f=commentConversationRounds[_0x281b5c(0xb78)](_0x5020bc)||0x0;if(_0x37a97f>=0x3){console[_0x281b5c(0x2187)](_0x224965[_0x281b5c(0x1a1c)]+_0x281b5c(0x3bc)+_0x58df9e+'\x20中的对话已达到3回合上限，不再回复');return;}console['log'](_0x281b5c(0xb01)+_0x224965[_0x281b5c(0x1a1c)]+'\x20的动态，当前对话回合次:\x20'+_0x37a97f+_0x281b5c(0x1a44)),commentConversationRounds['set'](_0x5020bc,_0x37a97f+0x1),console[_0x281b5c(0x2187)](_0x281b5c(0x687)+_0x224965[_0x281b5c(0x1a1c)]+_0x281b5c(0x3bc)+_0x58df9e+'\x20中的对话回合次更新为:\x20'+(_0x37a97f+0x1)+'/3'),setTimeout(()=>{const _0xb22db4=_0x281b5c;console['log'](_0xb22db4(0x1e8b)+_0x224965[_0xb22db4(0x1a1c)]+_0xb22db4(0x1b56)+_0x39fedf+'\x22'),triggerAIReplyToUser(_0x58df9e,_0x224965[_0xb22db4(0x1a1c)],_0x39fedf);},Math['random']()*0xbb8+0x7d0);}catch(_0x3e6d74){console['error'](_0x281b5c(0x429),_0x3e6d74);}}function displayCommentUnderMoment(_0x1ae75f,_0x4d5da1){const _0x2977ef=_0x211817,_0xf1b8c5=document[_0x2977ef(0xb30)](_0x2977ef(0x1338)+_0x1ae75f+'\x22]');if(!_0xf1b8c5)return;let _0x467570=_0xf1b8c5[_0x2977ef(0xb30)]('.moment-comments-section');if(!_0x467570){_0x467570=document[_0x2977ef(0xac6)]('div'),_0x467570[_0x2977ef(0x1722)]=_0x2977ef(0x57e);const _0x17aec6=_0xf1b8c5[_0x2977ef(0xb30)](_0x2977ef(0xefd)),_0x131618=_0x17aec6?'0':'0';_0x467570['style'][_0x2977ef(0x1f87)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x20'+_0x131618+_0x2977ef(0x20d9);const _0x58a169=_0xf1b8c5['querySelector'](_0x2977ef(0x184f)),_0x1d446f=_0xf1b8c5['querySelector']('.moment-time-actions');_0x58a169&&_0x1d446f&&(_0x17aec6?_0x17aec6[_0x2977ef(0x148c)][_0x2977ef(0x1f04)](_0x467570,_0x17aec6[_0x2977ef(0x1b0a)]):_0x1d446f[_0x2977ef(0x148c)][_0x2977ef(0x1f04)](_0x467570,_0x1d446f[_0x2977ef(0x1b0a)]));}const _0x39f0e4=document['createElement'](_0x2977ef(0xbbc));_0x39f0e4[_0x2977ef(0x1722)]=_0x2977ef(0x21cf),_0x39f0e4[_0x2977ef(0x1058)](_0x2977ef(0x30d),_0x4d5da1[_0x2977ef(0x1716)]||Date[_0x2977ef(0x2eb)]()),_0x39f0e4[_0x2977ef(0x14eb)]['cssText']=_0x2977ef(0xeef);let _0x126d00=_0x4d5da1[_0x2977ef(0x1378)],_0x4e8ae1=_0x4d5da1[_0x2977ef(0x215c)]+'：';_0x4d5da1[_0x2977ef(0x1dbe)]&&(_0x4e8ae1=_0x4d5da1[_0x2977ef(0x215c)],_0x126d00=_0x2977ef(0x2024)+_0x4d5da1[_0x2977ef(0x1dbe)]+_0x2977ef(0x15a7)+_0x4d5da1[_0x2977ef(0x1378)]),_0x39f0e4['innerHTML']=_0x2977ef(0x13b7)+_0x4d5da1[_0x2977ef(0x1f8a)]+_0x2977ef(0x173e)+_0x1ae75f+_0x2977ef(0xda7)+_0x4d5da1[_0x2977ef(0x215c)]+_0x2977ef(0xb80)+_0x4e8ae1+_0x2977ef(0x1e3d)+_0x126d00+_0x2977ef(0xc31)+_0x4d5da1[_0x2977ef(0x1236)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x467570[_0x2977ef(0x497)](_0x39f0e4);}function replyToMomentComment(_0x4df13b,_0x20b654){showBottomCommentInput(_0x4df13b,_0x20b654);}async function saveCommentToMoment(_0x401fea,_0x178579){const _0x4902df=_0x211817;try{const _0x3a1fee={'id':_0x178579['id'],'momentId':parseInt(_0x401fea),'authorId':_0x178579[_0x4902df(0xaf5)]||_0x4902df(0xa80),'nickname':_0x178579[_0x4902df(0x215c)],'avatar':_0x178579[_0x4902df(0x1f8a)],'text':_0x178579['text'],'timestamp':_0x178579[_0x4902df(0x1716)],'replyTo':_0x178579[_0x4902df(0x1dbe)]||null};await db[_0x4902df(0x17d5)][_0x4902df(0x21e2)](_0x3a1fee),console['log']('评论已保存到数据库，动态ID:',_0x401fea);}catch(_0x38c064){console[_0x4902df(0x174a)](_0x4902df(0xfae),_0x38c064);}}async function updateMomentCommentCount(_0x3c81ed){const _0x442e7b=_0x211817;try{const _0x243c32=document[_0x442e7b(0xb30)](_0x442e7b(0x1338)+_0x3c81ed+'\x22]');if(!_0x243c32)return;const _0x4e4bae=await db['momentComments'][_0x442e7b(0xa24)]('momentId')[_0x442e7b(0x1694)](parseInt(_0x3c81ed))[_0x442e7b(0xc44)](),_0x49a3ea=_0x243c32[_0x442e7b(0x1897)](_0x442e7b(0x1211))[0x1],_0xdfc93=_0x49a3ea[_0x442e7b(0xb30)]('span');_0xdfc93[_0x442e7b(0x13be)]=_0x4e4bae;}catch(_0x1dc6ca){console[_0x442e7b(0x174a)](_0x442e7b(0x11e6),_0x1dc6ca);}}async function triggerAIInteractions(_0xa8ce5a,_0x463b18){const _0x2955a8=_0x211817;try{if(!characters||characters[_0x2955a8(0x19ee)]===0x0)return;const _0x269d38=await db['moments'][_0x2955a8(0xb78)](parseInt(_0xa8ce5a));if(!_0x269d38)return;const _0x332323=_0x269d38['characterId'];if(!_0x332323||_0x332323==='user'){const _0x50dd14=characters[_0x2955a8(0x1e1f)](_0x13bbf4=>contacts[_0x2955a8(0x1831)](_0x13bbf4['id'])),_0x755190=[];for(const _0x5d55ce of _0x50dd14){const _0x3d1752=await checkMomentVisibilityForCharacter(parseInt(_0xa8ce5a),_0x5d55ce['id']);_0x3d1752&&_0x755190[_0x2955a8(0x1cd6)](_0x5d55ce);}if(_0x463b18===_0x2955a8(0x7e3))for(const _0x4741c9 of _0x755190){Math[_0x2955a8(0x11a8)]()<0.8&&setTimeout(async()=>{await addAILikeWithPersonality(_0xa8ce5a,_0x4741c9,_0x269d38);},Math[_0x2955a8(0x11a8)]()*0xbb8+0x3e8);}else{if(_0x463b18===_0x2955a8(0x945))for(const _0x8def2a of _0x755190){Math[_0x2955a8(0x11a8)]()<0.8&&setTimeout(async()=>{await addAICommentWithPersonality(_0xa8ce5a,_0x8def2a,_0x269d38);},Math[_0x2955a8(0x11a8)]()*0x1388+0x7d0);}}}else{console['log'](_0x2955a8(0xaba));const _0x1446a6=characters['find'](_0xc59799=>_0xc59799['id']===_0x332323),_0x5c3d0b=characters[_0x2955a8(0x1e1f)](_0xb740a7=>_0xb740a7['id']!==_0x332323&&_0xb740a7['groupId']===_0x1446a6[_0x2955a8(0x22be)]),_0x59bce4=[];for(const _0x51b17e of _0x5c3d0b){const _0x54b2ff=await checkMomentVisibilityForCharacter(parseInt(_0xa8ce5a),_0x51b17e['id']);_0x54b2ff&&_0x59bce4['push'](_0x51b17e);}console[_0x2955a8(0x2187)](_0x2955a8(0xfb4)+_0x59bce4['length']+'/'+_0x5c3d0b['length']);if(_0x463b18==='like')for(const _0x4088d4 of _0x59bce4){Math[_0x2955a8(0x11a8)]()<0.65&&setTimeout(async()=>{await addAILikeWithPersonality(_0xa8ce5a,_0x4088d4,_0x269d38);},Math[_0x2955a8(0x11a8)]()*0xbb8+0x3e8);}else{if(_0x463b18===_0x2955a8(0x945)){console[_0x2955a8(0x2187)](_0x2955a8(0xc27),_0x59bce4[_0x2955a8(0x19ee)]);for(const _0xc8eb43 of _0x59bce4){const _0xef7e07=Math[_0x2955a8(0x11a8)](),_0x1e8ef2=_0xef7e07<0.65;console['log'](_0xc8eb43['name']+_0x2955a8(0x1e75)+_0xef7e07['toFixed'](0x3)+_0x2955a8(0x516)+_0x1e8ef2),_0x1e8ef2?setTimeout(async()=>{const _0x28220f=_0x2955a8;console[_0x28220f(0x2187)](_0xc8eb43[_0x28220f(0x1a1c)]+_0x28220f(0x1e1e)),await addAICommentWithPersonality(_0xa8ce5a,_0xc8eb43,_0x269d38);},Math['random']()*0x1388+0x7d0):console[_0x2955a8(0x2187)](_0xc8eb43[_0x2955a8(0x1a1c)]+'\x20因为概率未通过，不会评论');}setTimeout(()=>{const _0x18ad17=[..._0x59bce4];_0x1446a6&&_0x18ad17['push'](_0x1446a6),triggerAiToAiInteractionWithPersonality(_0xa8ce5a,_0x18ad17);},Math['random']()*0x1f40+0x1388);}}}}catch(_0x18af08){console[_0x2955a8(0x174a)](_0x2955a8(0x566),_0x18af08);}}function getCharactersInSameGroups(_0x3b6876){const _0x11750d=[];return groupChats['forEach'](_0x49833a=>{const _0x17bec7=_0x167f;_0x49833a[_0x17bec7(0x12a6)]&&_0x49833a[_0x17bec7(0x12a6)][_0x17bec7(0x1831)](_0x3b6876)&&_0x49833a[_0x17bec7(0x12a6)][_0x17bec7(0x19fb)](_0x210427=>{const _0xc417fc=_0x17bec7;if(_0x210427!==_0x3b6876&&_0x210427!=='user'){const _0x3cb232=characters[_0xc417fc(0xaf4)](_0x18d86c=>_0x18d86c['id']===_0x210427);_0x3cb232&&!_0x11750d[_0xc417fc(0xaf4)](_0x5a924b=>_0x5a924b['id']===_0x3cb232['id'])&&_0x11750d['push'](_0x3cb232);}});}),_0x11750d;}async function addAILikeWithPersonality(_0x22e374,_0x4658ec,_0xc52e79){const _0x4e6bd5=_0x211817;try{const _0x465300=document[_0x4e6bd5(0xb30)](_0x4e6bd5(0x1338)+_0x22e374+'\x22]');if(!_0x465300)return;const _0x5b1d7e=await db[_0x4e6bd5(0x40a)][_0x4e6bd5(0xa24)]('[momentId+authorId]')[_0x4e6bd5(0x1694)]([parseInt(_0x22e374),_0x4658ec['id']])['first']();if(_0x5b1d7e)return;const _0x1c6a46=await shouldCharacterLikeMomentWithMemory(_0x4658ec,_0xc52e79);if(!_0x1c6a46){console[_0x4e6bd5(0x2187)](_0x4658ec['name']+_0x4e6bd5(0x534));return;}await db[_0x4e6bd5(0x40a)][_0x4e6bd5(0x21e2)]({'momentId':parseInt(_0x22e374),'authorId':_0x4658ec['id'],'characterId':_0x4658ec['id'],'name':_0x4658ec['name'],'timestamp':Date[_0x4e6bd5(0x2eb)]()}),updateMomentLikeDisplay(_0x22e374),_0xc52e79[_0x4e6bd5(0x22d2)]===_0x4e6bd5(0xa80)&&(showToast(_0x4658ec[_0x4e6bd5(0x1a1c)]+'\x20赞了你的动态'),createPushNotification(_0x4658ec,_0x4e6bd5(0x1aa9),0x64)),await recordMemoryEvent([_0x4658ec['id']],{'type':_0x4e6bd5(0x9c7),'id':'moments'},_0x4e6bd5(0x3b4),_0x4e6bd5(0x2173)+(_0xc52e79[_0x4e6bd5(0x22d2)]===_0x4e6bd5(0xa80)?'用户':_0xc52e79[_0x4e6bd5(0x215c)])+'的动态');}catch(_0x2706fb){console[_0x4e6bd5(0x174a)](_0x4e6bd5(0xa47),_0x2706fb);}}async function addAILike(_0x5ae5e8,_0x518450,_0x2ed7b1){return await addAILikeWithPersonality(_0x5ae5e8,_0x518450,_0x2ed7b1);}async function shouldCharacterLikeMomentWithMemory(_0x16d8c8,_0x172bf6){const _0x1ea449=_0x211817;try{let _0x21b376=null;try{_0x21b376=await db[_0x1ea449(0x1789)][_0x1ea449(0xb78)](_0x16d8c8['id']);}catch(_0x1f6d06){console['error'](_0x1ea449(0x1741),_0x1f6d06);}const _0x2753c9=_0x21b376?.['aiPersona']||_0x16d8c8[_0x1ea449(0x7a1)]||_0x16d8c8[_0x1ea449(0x1f0b)]||'你是'+_0x16d8c8[_0x1ea449(0x1a1c)]+'。';let _0x5d19b9='';if(_0x172bf6[_0x1ea449(0xaf5)]&&_0x172bf6[_0x1ea449(0xaf5)]!==_0x1ea449(0xa80)){const _0x3ecbcb=await db[_0x1ea449(0x127e)][_0x1ea449(0xa24)]('characterId')[_0x1ea449(0x1694)](_0x16d8c8['id'])[_0x1ea449(0xf13)](),_0x4cdf41=_0x3ecbcb['filter'](_0x912188=>_0x912188[_0x1ea449(0x13e5)]&&_0x912188[_0x1ea449(0x13e5)][_0x1ea449(0x1831)](_0x172bf6[_0x1ea449(0x215c)]));_0x4cdf41['length']>0x0&&(_0x5d19b9=_0x4cdf41[_0x1ea449(0x6a4)](_0x4c3602=>_0x4c3602[_0x1ea449(0x13e5)])[_0x1ea449(0x122b)]('；'));}const _0x2f9f7d=_0x2753c9[_0x1ea449(0x49e)](),_0x2ee0ee=(_0x172bf6[_0x1ea449(0x1378)]||'')['toLowerCase'](),_0x283304=_0x172bf6[_0x1ea449(0x215c)]||'用户';if(_0x5d19b9){const _0x227529=['吵架','争执','讨厌','不喜欢','敌对','竞争','情敌','冲突'],_0x1f33b9=_0x227529['some'](_0x47248e=>_0x5d19b9[_0x1ea449(0x49e)]()['includes'](_0x47248e));if(_0x1f33b9)return console[_0x1ea449(0x2187)](_0x16d8c8[_0x1ea449(0x1a1c)]+_0x1ea449(0x19ca)+_0x283304+_0x1ea449(0x2061)),![];}const _0x4bb233=['冷漠','严肃',_0x1ea449(0x20f6),'内向','沉默'],_0x1ca0f4=_0x4bb233['some'](_0x3b5b0c=>_0x2f9f7d['includes'](_0x3b5b0c));if(_0x1ca0f4&&Math[_0x1ea449(0x11a8)]()<0.7)return![];const _0x33598c=extractInterestsFromBio(_0x2f9f7d),_0x1c9bd1=_0x33598c['some'](_0x361811=>_0x2ee0ee[_0x1ea449(0x1831)](_0x361811));if(_0x1c9bd1)return Math[_0x1ea449(0x11a8)]()<0.9;if(!_0x172bf6[_0x1ea449(0xaf5)]||_0x172bf6[_0x1ea449(0xaf5)]===_0x1ea449(0xa80))return Math['random']()<0.8;return Math['random']()<0.7;}catch(_0x1f6b8f){return console[_0x1ea449(0x174a)]('判断角色点赞偏好失败:',_0x1f6b8f),Math['random']()<0.6;}}async function shouldCharacterLikeMoment(_0x56c697,_0x16f0bc){return await shouldCharacterLikeMomentWithMemory(_0x56c697,_0x16f0bc);}function extractInterestsFromBio(_0x2beacf){const _0x29b8d0=_0x211817,_0x45f26c=[],_0xa107aa=['音乐','电影','读书','运动','游戏','美食','旅行','摄影','绘画','写作','代码','科技','动漫','小说','咖啡','茶','宠物','花','星空','雨天','阳光','学习','工作','朋友'];return _0xa107aa[_0x29b8d0(0x19fb)](_0x33d54f=>{const _0x412d68=_0x29b8d0;_0x2beacf[_0x412d68(0x1831)](_0x33d54f)&&_0x45f26c['push'](_0x33d54f);}),_0x45f26c;}async function updateMomentLikeDisplay(_0x23ab01){const _0x3dd62f=_0x211817;try{const _0x4f6ae8=document[_0x3dd62f(0xb30)](_0x3dd62f(0x1338)+_0x23ab01+'\x22]');if(!_0x4f6ae8)return;const _0x2ff346=await db[_0x3dd62f(0x40a)][_0x3dd62f(0xa24)]('momentId')[_0x3dd62f(0x1694)](parseInt(_0x23ab01))[_0x3dd62f(0xf13)](),_0x4930e0=_0x4f6ae8[_0x3dd62f(0xb30)](_0x3dd62f(0x1497));if(_0x4930e0){const _0x329992=_0x4930e0['querySelector'](_0x3dd62f(0x195d));_0x329992&&(_0x329992['textContent']=_0x2ff346[_0x3dd62f(0x19ee)]);}let _0xc6252=_0x4f6ae8[_0x3dd62f(0xb30)](_0x3dd62f(0xefd));if(_0x2ff346[_0x3dd62f(0x19ee)]>0x0){if(!_0xc6252){_0xc6252=document[_0x3dd62f(0xac6)](_0x3dd62f(0xbbc)),_0xc6252[_0x3dd62f(0x1722)]=_0x3dd62f(0x790);const _0x6848f=_0x4f6ae8[_0x3dd62f(0xb30)](_0x3dd62f(0xd11)),_0x14c372=_0x6848f?'0':'0';_0xc6252[_0x3dd62f(0x14eb)]['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x20'+_0x14c372+';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x208px\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#f8f9fa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1cb9a6=_0x4f6ae8['querySelector'](_0x3dd62f(0x184f)),_0x446b1a=_0x4f6ae8[_0x3dd62f(0xb30)]('.moment-time-actions'),_0x5897c9=_0x4f6ae8[_0x3dd62f(0xb30)](_0x3dd62f(0xd11));_0x1cb9a6&&_0x446b1a&&(_0x5897c9?_0x1cb9a6[_0x3dd62f(0x1f04)](_0xc6252,_0x5897c9):_0x446b1a[_0x3dd62f(0x148c)][_0x3dd62f(0x1f04)](_0xc6252,_0x446b1a[_0x3dd62f(0x1b0a)]));}const _0x13d203=_0x3dd62f(0xcad),_0x3e8dae=_0x2ff346[_0x3dd62f(0x6a4)](_0x27eaa7=>_0x27eaa7[_0x3dd62f(0x1a1c)])[_0x3dd62f(0x122b)]('、');_0xc6252[_0x3dd62f(0x33a)]=_0x13d203+'<span\x20style=\x22color:\x20#576b95;\x20font-weight:\x20600;\x22>'+_0x3e8dae+_0x3dd62f(0x1f2),_0xc6252['style'][_0x3dd62f(0x4da)]=_0x3dd62f(0x13de);}else _0xc6252&&(_0xc6252['style']['display']=_0x3dd62f(0x102b));}catch(_0x5044e8){console[_0x3dd62f(0x174a)](_0x3dd62f(0x722),_0x5044e8);}}async function addAICommentWithPersonality(_0x284d6a,_0x32091b,_0xa5c5e2){const _0x52a23f=_0x211817;try{const _0x29a73b=await generateCharacterCommentWithMemory(_0x32091b,_0xa5c5e2);if(!_0x29a73b||_0x29a73b[_0x52a23f(0x19ee)]===0x0)return;const _0x341376=_0x29a73b[Math[_0x52a23f(0x2180)](Math[_0x52a23f(0x11a8)]()*_0x29a73b[_0x52a23f(0x19ee)])],_0x552478={'id':Date[_0x52a23f(0x2eb)]()+Math[_0x52a23f(0x11a8)](),'nickname':_0x32091b[_0x52a23f(0x1a1c)],'avatar':_0x32091b[_0x52a23f(0x1994)],'text':_0x341376,'time':formatTime(new Date()),'timestamp':Date[_0x52a23f(0x2eb)](),'characterId':_0x32091b['id']};saveCommentToMoment(_0x284d6a,_0x552478),updateMomentCommentCount(_0x284d6a),displayCommentUnderMoment(_0x284d6a,_0x552478);_0xa5c5e2[_0x52a23f(0x22d2)]==='user'&&(showToast(_0x32091b[_0x52a23f(0x1a1c)]+_0x52a23f(0x728)),createPushNotification(_0x32091b,'评论了你的动态：'+(_0x341376[_0x52a23f(0x19ee)]>0xf?_0x341376[_0x52a23f(0x17ca)](0x0,0xf)+_0x52a23f(0x1520):_0x341376),0xc8));await recordMemoryEvent([_0x32091b['id']],{'type':_0x52a23f(0x9c7),'id':'moments'},'moment_comment',_0x52a23f(0x10cf)+(_0xa5c5e2[_0x52a23f(0x22d2)]===_0x52a23f(0xa80)?'用户':_0xa5c5e2[_0x52a23f(0x215c)])+'的动态：'+_0x341376);if(_0xa5c5e2['characterId']&&_0xa5c5e2[_0x52a23f(0xaf5)]!==_0x52a23f(0xa80)&&_0xa5c5e2[_0x52a23f(0xaf5)]!==_0x32091b['id']){const _0x368b3d=characters[_0x52a23f(0xaf4)](_0x4e5734=>_0x4e5734['id']===_0xa5c5e2[_0x52a23f(0xaf5)]);_0x368b3d&&(console[_0x52a23f(0x2187)](_0x52a23f(0x558)+_0x32091b[_0x52a23f(0x1a1c)]+_0x52a23f(0xf3b)+_0x368b3d['name']+'\x20的动态，将在30-60秒后触发发布者回复'),setTimeout(async()=>{const _0x1af86e=_0x52a23f;console[_0x1af86e(0x2187)]('🔄\x20检查\x20'+_0x368b3d[_0x1af86e(0x1a1c)]+_0x1af86e(0x68b)+_0x32091b[_0x1af86e(0x1a1c)]+_0x1af86e(0x404)),await triggerPublisherReplyToComments(_0x284d6a,_0x368b3d);},Math[_0x52a23f(0x11a8)]()*0x7530+0x7530));}}catch(_0x257eeb){console[_0x52a23f(0x174a)](_0x52a23f(0xcc1),_0x257eeb);}}async function addAIComment(_0x220e9b,_0x4db9ae,_0x22e6a1){return await addAICommentWithPersonality(_0x220e9b,_0x4db9ae,_0x22e6a1);}async function triggerAiToAiInteractionWithPersonality(_0x1448d0,_0x4900dc){const _0x5350a9=_0x211817;try{const _0x49c1ab=await db[_0x5350a9(0x9c7)][_0x5350a9(0xb78)](parseInt(_0x1448d0));if(!_0x49c1ab)return;const _0x44339b=await db[_0x5350a9(0x17d5)]['where'](_0x5350a9(0x9ba))[_0x5350a9(0x1694)](parseInt(_0x1448d0))['toArray']();if(_0x44339b['length']<0x2)return;const _0x784c32=[...new Set(_0x44339b[_0x5350a9(0x1e1f)](_0x445de1=>_0x445de1['characterId']&&_0x445de1[_0x5350a9(0xaf5)]!==_0x5350a9(0xa80))['map'](_0x488c38=>_0x488c38[_0x5350a9(0xaf5)]))],_0x3b01f3=_0x784c32['filter'](_0x3ed660=>_0x4900dc[_0x5350a9(0x19fa)](_0x5bec5d=>_0x5bec5d['id']===_0x3ed660));if(_0x3b01f3[_0x5350a9(0x19ee)]<0x2){console[_0x5350a9(0x2187)](_0x5350a9(0x1c66));return;}console[_0x5350a9(0x2187)]('发现\x20'+_0x3b01f3['length']+'\x20个同群AI角色参与了评论，开始角色间互动');const _0x535a81=_0x3b01f3[Math[_0x5350a9(0x2180)](Math[_0x5350a9(0x11a8)]()*_0x3b01f3[_0x5350a9(0x19ee)])];let _0x33426f=_0x3b01f3[Math[_0x5350a9(0x2180)](Math['random']()*_0x3b01f3[_0x5350a9(0x19ee)])];while(_0x33426f===_0x535a81&&_0x3b01f3['length']>0x1){_0x33426f=_0x3b01f3[Math[_0x5350a9(0x2180)](Math[_0x5350a9(0x11a8)]()*_0x3b01f3[_0x5350a9(0x19ee)])];}if(_0x535a81===_0x33426f)return;const _0x52ee35=characters[_0x5350a9(0xaf4)](_0xd5894b=>_0xd5894b['id']===_0x535a81),_0x1f217d=characters['find'](_0x443e40=>_0x443e40['id']===_0x33426f);if(!_0x52ee35||!_0x1f217d)return;const _0x1cfe60=await shouldCharactersInteract(_0x52ee35,_0x1f217d);if(!_0x1cfe60){console[_0x5350a9(0x2187)](_0x52ee35[_0x5350a9(0x1a1c)]+'\x20和\x20'+_0x1f217d['name']+_0x5350a9(0x1e89));return;}const _0x459173=_0x44339b['find'](_0x43a113=>_0x43a113[_0x5350a9(0xaf5)]===_0x535a81||_0x43a113[_0x5350a9(0xaf5)]===_0x33426f);if(!_0x459173)return;const _0x32fcd5=_0x459173[_0x5350a9(0xaf5)]===_0x535a81?_0x33426f:_0x535a81,_0x10f06f=_0x459173['characterId'],_0x58cb49=characters[_0x5350a9(0xaf4)](_0x374046=>_0x374046['id']===_0x32fcd5),_0xfeae94=characters['find'](_0x5a3fcb=>_0x5a3fcb['id']===_0x10f06f);if(!_0x58cb49||!_0xfeae94)return;console[_0x5350a9(0x2187)](_0x58cb49[_0x5350a9(0x1a1c)]+_0x5350a9(0x102a)+_0xfeae94['name']+_0x5350a9(0x964)),await generateAiToAiReplyWithMemory(_0x1448d0,_0x459173,_0x58cb49,_0xfeae94);}catch(_0x391b0f){console['error'](_0x5350a9(0x39a),_0x391b0f);}}async function triggerAiToAiInteraction(_0x53f54f,_0x75c64b){return await triggerAiToAiInteractionWithPersonality(_0x53f54f,_0x75c64b);}async function shouldCharactersInteract(_0x4ae30f,_0x4134c0){const _0x45eaf5=_0x211817;try{const _0xbb9c3b=await db[_0x45eaf5(0x127e)]['where'](_0x45eaf5(0xaf5))['equals'](_0x4ae30f['id'])[_0x45eaf5(0xf13)](),_0x6a67d8=_0xbb9c3b['filter'](_0x45e451=>_0x45e451[_0x45eaf5(0x13e5)]&&_0x45e451[_0x45eaf5(0x13e5)]['includes'](_0x4134c0['name'])),_0x4baec1=await db['coreMemories'][_0x45eaf5(0xa24)](_0x45eaf5(0xaf5))[_0x45eaf5(0x1694)](_0x4134c0['id'])[_0x45eaf5(0xf13)](),_0x512053=_0x4baec1['filter'](_0x688824=>_0x688824[_0x45eaf5(0x13e5)]&&_0x688824[_0x45eaf5(0x13e5)]['includes'](_0x4ae30f['name'])),_0x66f315=[..._0x6a67d8,..._0x512053],_0x4f1373=['吵架','争执','讨厌','不喜欢','敌对','竞争','情敌','冲突','矛盾'],_0x77951=_0x66f315['some'](_0x46589e=>_0x4f1373[_0x45eaf5(0x19fa)](_0x2d64cc=>_0x46589e['fact'][_0x45eaf5(0x49e)]()[_0x45eaf5(0x1831)](_0x2d64cc)));if(_0x77951)return Math[_0x45eaf5(0x11a8)]()<0.6;const _0x91abbb=['朋友','喜欢','亲密','合作','帮助','支持','关心'],_0x21ddd1=_0x66f315['some'](_0x71b3a4=>_0x91abbb[_0x45eaf5(0x19fa)](_0x1e23f2=>_0x71b3a4[_0x45eaf5(0x13e5)]['toLowerCase']()[_0x45eaf5(0x1831)](_0x1e23f2)));if(_0x21ddd1)return Math[_0x45eaf5(0x11a8)]()<0.8;return Math[_0x45eaf5(0x11a8)]()<0.8;}catch(_0x16d2dd){return console['error'](_0x45eaf5(0x166f),_0x16d2dd),Math[_0x45eaf5(0x11a8)]()<0.4;}}async function triggerAiToAiInteractionOld(_0x41decc,_0x30c121){const _0x36a869=_0x211817;try{const _0x439007=JSON[_0x36a869(0x22d3)](sessionStorage[_0x36a869(0x15d8)](_0x36a869(0xff5))||'[]'),_0x1b21c5=_0x439007[_0x36a869(0xaf4)](_0x328298=>_0x328298['id']==_0x41decc||_0x328298['timestamp']==_0x41decc);if(!_0x1b21c5||!_0x1b21c5[_0x36a869(0xb09)])return;const _0x22dabf=_0x1b21c5[_0x36a869(0xb09)];if(_0x22dabf[_0x36a869(0x19ee)]<0x2)return;const _0x370c08=[...new Set(_0x22dabf[_0x36a869(0x1e1f)](_0x39c092=>_0x39c092[_0x36a869(0xaf5)]&&_0x39c092[_0x36a869(0xaf5)]!=='user')[_0x36a869(0x6a4)](_0x204de9=>_0x204de9[_0x36a869(0xaf5)]))],_0x2c756d=_0x370c08['filter'](_0x1cf6c5=>_0x30c121[_0x36a869(0x19fa)](_0x6d00dc=>_0x6d00dc['id']===_0x1cf6c5));if(_0x2c756d[_0x36a869(0x19ee)]<0x2){console[_0x36a869(0x2187)](_0x36a869(0x1c66));return;}console['log'](_0x36a869(0x11b0)+_0x2c756d['length']+_0x36a869(0x19a7));const _0x30da09=_0x2c756d[Math['floor'](Math[_0x36a869(0x11a8)]()*_0x2c756d[_0x36a869(0x19ee)])];let _0x19d4ba=_0x2c756d[Math[_0x36a869(0x2180)](Math['random']()*_0x2c756d[_0x36a869(0x19ee)])];while(_0x19d4ba===_0x30da09&&_0x2c756d['length']>0x1){_0x19d4ba=_0x2c756d[Math[_0x36a869(0x2180)](Math[_0x36a869(0x11a8)]()*_0x2c756d[_0x36a869(0x19ee)])];}if(_0x30da09===_0x19d4ba)return;if(Math['random']()>0.4){console[_0x36a869(0x2187)](_0x36a869(0xc57));return;}const _0x5e36b4=_0x22dabf['find'](_0x3555d7=>_0x3555d7[_0x36a869(0xaf5)]===_0x30da09||_0x3555d7[_0x36a869(0xaf5)]===_0x19d4ba);if(!_0x5e36b4)return;const _0x58ab12=_0x5e36b4['characterId']===_0x30da09?_0x19d4ba:_0x30da09,_0x222c97=_0x5e36b4[_0x36a869(0xaf5)],_0x51dcf2=characters['find'](_0x449981=>_0x449981['id']===_0x58ab12),_0x1bbfc2=characters[_0x36a869(0xaf4)](_0x153791=>_0x153791['id']===_0x222c97);if(!_0x51dcf2||!_0x1bbfc2)return;console[_0x36a869(0x2187)](_0x51dcf2[_0x36a869(0x1a1c)]+'\x20将回复\x20'+_0x1bbfc2[_0x36a869(0x1a1c)]+_0x36a869(0x964)),await generateAiToAiReply(_0x41decc,_0x5e36b4,_0x51dcf2,_0x1bbfc2);}catch(_0x2e7c07){console[_0x36a869(0x174a)](_0x36a869(0x39a),_0x2e7c07);}}function triggerCharacterInteractions(_0x1b11d4,_0x4e853d){const _0x3bf470=_0x211817;if(_0x4e853d['length']<0x2)return;const _0x419707=getGroupRelations(_0x4e853d);for(let _0x136907=0x0;_0x136907<_0x4e853d[_0x3bf470(0x19ee)]-0x1;_0x136907++){for(let _0x1cc4ab=_0x136907+0x1;_0x1cc4ab<_0x4e853d[_0x3bf470(0x19ee)];_0x1cc4ab++){const _0x4f608a=_0x4e853d[_0x136907],_0x5a1a78=_0x4e853d[_0x1cc4ab],_0x45e154=_0x419707[_0x3bf470(0x19fa)](_0x1843a8=>_0x1843a8[_0x3bf470(0x1831)](_0x4f608a['id'])&&_0x1843a8[_0x3bf470(0x1831)](_0x5a1a78['id']));_0x45e154&&Math[_0x3bf470(0x11a8)]()<0.6&&addCharacterInteraction(_0x1b11d4,_0x4f608a,_0x5a1a78);}}}function getGroupRelations(_0x2f6144){const _0xcc286e=_0x211817,_0x35ceea=[],_0x57b8a5={};return _0x2f6144['forEach'](_0x396039=>{const _0x5455e7=_0x167f,_0x41d0dc=_0x396039[_0x5455e7(0x22be)]||_0x5455e7(0xa74);!_0x57b8a5[_0x41d0dc]&&(_0x57b8a5[_0x41d0dc]=[]),_0x57b8a5[_0x41d0dc][_0x5455e7(0x1cd6)](_0x396039['id']);}),Object[_0xcc286e(0x2bc)](_0x57b8a5)['forEach'](([_0x564b70,_0x395a26])=>{const _0xf058e3=_0xcc286e,_0x1908a0=characterGroups[_0xf058e3(0xaf4)](_0x1ea3f8=>_0x1ea3f8['id']===_0x564b70);_0x1908a0&&!_0x1908a0['isDefault']&&_0x1908a0[_0xf058e3(0x11c0)]&&_0x395a26[_0xf058e3(0x19ee)]>=0x2&&_0x35ceea[_0xf058e3(0x1cd6)](_0x395a26);}),_0x35ceea;}async function generateAiToAiReplyWithMemory(_0x259eca,_0x4d0fb8,_0x567d63,_0x208a07){const _0x151d61=_0x211817;try{const _0x345f4f=_0x259eca+'-'+_0x567d63['name']+'-'+_0x208a07[_0x151d61(0x1a1c)],_0x704077=commentConversationRounds['get'](_0x345f4f)||0x0;if(_0x704077>=0x3){console[_0x151d61(0x2187)](_0x567d63['name']+_0x151d61(0x19ca)+_0x208a07[_0x151d61(0x1a1c)]+_0x151d61(0x3bc)+_0x259eca+_0x151d61(0x10fb));return;}const _0x44d2f4=Math[_0x151d61(0x11a8)]();console[_0x151d61(0x2187)](_0x151d61(0x11ec)+_0x567d63['name']+_0x151d61(0x642)+_0x208a07[_0x151d61(0x1a1c)]+_0x151d61(0x1340)+_0x44d2f4['toFixed'](0x3)+_0x151d61(0xf0e)+(_0x44d2f4<0.8));if(_0x44d2f4>=0.8){console[_0x151d61(0x2187)](_0x151d61(0x151d)+_0x567d63[_0x151d61(0x1a1c)]+_0x151d61(0x5ff)+_0x208a07[_0x151d61(0x1a1c)]+'\x20的评论');return;}const _0x3824eb=await db[_0x151d61(0x9c7)][_0x151d61(0xb78)](parseInt(_0x259eca));if(!_0x3824eb)return;let _0x3d61c6=null;try{_0x3d61c6=await db['chatSettings'][_0x151d61(0xb78)](_0x567d63['id']);}catch(_0x2ca709){console[_0x151d61(0x174a)]('获取聊天设置失败:',_0x2ca709);}const _0x1ab921=_0x3d61c6?.[_0x151d61(0x14c6)]||_0x567d63['prompt']||'你是'+_0x567d63[_0x151d61(0x1a1c)]+'。';let _0x4dc6e2='';const _0x2eabfe=await db['coreMemories']['where'](_0x151d61(0xaf5))[_0x151d61(0x1694)](_0x567d63['id'])[_0x151d61(0xf13)](),_0x3174a4=_0x2eabfe[_0x151d61(0x1e1f)](_0x1658e6=>_0x1658e6['fact']&&_0x1658e6[_0x151d61(0x13e5)]['includes'](_0x208a07[_0x151d61(0x1a1c)]));_0x3174a4[_0x151d61(0x19ee)]>0x0&&(_0x4dc6e2='\x0a\x0a你们的关系记忆：\x0a'+_0x3174a4['map'](_0x2d32b9=>_0x2d32b9[_0x151d61(0x13e5)])[_0x151d61(0x122b)]('；'));let _0x38c553='';try{const _0x330b17=await db['momentComments'][_0x151d61(0xa24)]('momentId')[_0x151d61(0x1694)](parseInt(_0x259eca))['toArray']();if(_0x330b17[_0x151d61(0x19ee)]>0x0){_0x330b17[_0x151d61(0x1104)]((_0x5945d4,_0xcac822)=>_0x5945d4[_0x151d61(0x1716)]-_0xcac822[_0x151d61(0x1716)]);const _0x4f38ff=[];for(const _0x5d0473 of _0x330b17){if(_0x5d0473[_0x151d61(0x22d2)]===_0x151d61(0xa80)||_0x5d0473[_0x151d61(0x22d2)]===_0x567d63['id']||_0x5d0473[_0x151d61(0x22d2)]===_0x208a07['id']){_0x4f38ff[_0x151d61(0x1cd6)](_0x5d0473);continue;}const _0x12ac1f=characters[_0x151d61(0xaf4)](_0x3a69c2=>_0x3a69c2['id']===_0x5d0473['authorId']);_0x12ac1f&&areCharactersInSameGroup(_0x567d63,_0x12ac1f)&&_0x4f38ff[_0x151d61(0x1cd6)](_0x5d0473);}_0x4f38ff[_0x151d61(0x19ee)]>0x1&&(_0x38c553=_0x151d61(0x100a),_0x4f38ff[_0x151d61(0x19fb)]((_0x587615,_0x38179f)=>{const _0x27376e=_0x151d61,_0x1229ed=_0x587615['authorId']===_0x27376e(0xa80)?'用户':_0x587615[_0x27376e(0x215c)];_0x38c553+=_0x38179f+0x1+'.\x20'+_0x1229ed+':\x20'+_0x587615['text']+'\x0a';}));}}catch(_0x505f34){console[_0x151d61(0x174a)](_0x151d61(0x2056),_0x505f34);}let _0x2878b0='';if(_0x3d61c6?.[_0x151d61(0xe99)]&&_0x3d61c6[_0x151d61(0xe99)][_0x151d61(0x19ee)]>0x0)try{const _0x5e766b=await Promise[_0x151d61(0x1a47)](_0x3d61c6[_0x151d61(0xe99)][_0x151d61(0x6a4)](_0x1e108c=>db['worldbooks']['get'](_0x1e108c))),_0x472651=_0x5e766b['filter'](_0x4dcf2b=>_0x4dcf2b&&_0x4dcf2b[_0x151d61(0x211c)]);_0x472651['length']>0x0&&(_0x2878b0='\x0a\x0a世界书内容（供参考）：\x0a'+_0x472651['map'](_0x50da1e=>_0x50da1e[_0x151d61(0x1a1c)]+'：'+_0x50da1e[_0x151d61(0x211c)])[_0x151d61(0x122b)]('\x0a\x0a'));}catch(_0x4487e5){console[_0x151d61(0x174a)](_0x151d61(0x144e),_0x4487e5);}const _0x4f7366='你是'+_0x567d63['name']+'，你的人设如下：'+_0x1ab921+'。'+_0x2878b0+_0x4dc6e2+_0x38c553+_0x151d61(0x1bb)+_0x208a07['name']+'\x20刚刚评论了：\x22'+_0x4d0fb8[_0x151d61(0x1378)]+'\x22\x0a\x0a原动态内容：'+_0x3824eb[_0x151d61(0x1378)]+_0x151d61(0x21e)+_0x567d63['name']+'，基于你的人设、与'+_0x208a07['name']+_0x151d61(0x1704),{base:_0x1f8587,key:_0x5e9a48,model:_0x3946c9}=apiSettings;if(!_0x1f8587||!_0x5e9a48||!_0x3946c9){console[_0x151d61(0x2187)]('API配置不完整，跳过AI间互动');return;}const _0x24d6fc=[{'role':_0x151d61(0x1744),'content':_0x4f7366},{'role':'user','content':'请回复这条评论：'}],_0x14ddcf={'model':_0x3946c9,'messages':_0x24d6fc,'temperature':0.8,'stream':![]},_0xd5762d=new AbortController(),_0x6d96ce=setTimeout(()=>_0xd5762d[_0x151d61(0x101b)](),0x7530),_0xe5f396=_0x1f8587['includes'](_0x151d61(0x1d80));let _0x20edd5;if(_0xe5f396){const _0x1994cf=_0x1f8587+'/models/'+_0x3946c9+_0x151d61(0x40c)+_0x5e9a48,_0x1d6ee9=[];_0x14ddcf[_0x151d61(0x1828)][0x0]?.[_0x151d61(0x464)]===_0x151d61(0x1744)&&(_0x1d6ee9[_0x151d61(0x1cd6)]({'role':_0x151d61(0xa80),'parts':[{'text':_0x14ddcf[_0x151d61(0x1828)][0x0][_0x151d61(0x211c)]}]}),_0x1d6ee9['push']({'role':'model','parts':[{'text':_0x151d61(0x967)}]}));for(let _0x1c9644=0x1;_0x1c9644<_0x14ddcf[_0x151d61(0x1828)][_0x151d61(0x19ee)];_0x1c9644++){const _0x5a29ec=_0x14ddcf[_0x151d61(0x1828)][_0x1c9644];if(_0x5a29ec['role']===_0x151d61(0x1744))continue;_0x1d6ee9[_0x151d61(0x1cd6)]({'role':_0x5a29ec['role']===_0x151d61(0xa80)?'user':_0x151d61(0x1976),'parts':[{'text':_0x5a29ec[_0x151d61(0x211c)]}]});}_0x20edd5=await fetch(_0x1994cf,{'method':_0x151d61(0x1dd5),'headers':{'Content-Type':_0x151d61(0x1b82)},'body':JSON[_0x151d61(0x6b8)]({'contents':_0x1d6ee9,'generationConfig':{'temperature':_0x14ddcf[_0x151d61(0x11c5)]||0.8}}),'signal':_0xd5762d[_0x151d61(0x159b)]});}else{let _0x21ada3;if(_0x1f8587['endsWith']('/v1'))_0x21ada3=_0x1f8587+_0x151d61(0x1bea);else _0x1f8587[_0x151d61(0x1831)](_0x151d61(0x1dac))?_0x21ada3=_0x1f8587+_0x151d61(0x1bea):_0x21ada3=_0x1f8587+_0x151d61(0x666);_0x20edd5=await fetch(_0x21ada3,{'method':'POST','headers':{'Content-Type':_0x151d61(0x1b82),'Authorization':_0x151d61(0x1e3c)+_0x5e9a48},'body':JSON[_0x151d61(0x6b8)](_0x14ddcf),'signal':_0xd5762d[_0x151d61(0x159b)]});}clearTimeout(_0x6d96ce);if(!_0x20edd5['ok']){console['error']('AI间互动API调用失败\x20('+_0x20edd5[_0x151d61(0x12e2)]+')');return;}const _0xf3527f=await _0x20edd5[_0x151d61(0xe52)]();let _0x3c6408;_0xe5f396?_0x3c6408=_0xf3527f['candidates']?.[0x0]?.[_0x151d61(0x211c)]?.['parts']?.[0x0]?.[_0x151d61(0x1378)]:_0x3c6408=_0xf3527f[_0x151d61(0x1090)]?.[0x0]?.[_0x151d61(0x1e8e)]?.[_0x151d61(0x211c)]||_0xf3527f[_0x151d61(0x1e8e)]||_0xf3527f[_0x151d61(0x1378)]||_0xf3527f[_0x151d61(0x928)]||_0xf3527f[_0x151d61(0x211c)]||_0xf3527f['result'];if(_0x3c6408&&_0x3c6408[_0x151d61(0x19d7)]()[_0x151d61(0x19ee)]>0x0){const _0x38f1f8=_0x3c6408[_0x151d61(0x19d7)](),_0x19e299={'id':Date[_0x151d61(0x2eb)]()+Math[_0x151d61(0x11a8)](),'nickname':_0x567d63['name'],'avatar':_0x567d63[_0x151d61(0x1994)],'text':_0x38f1f8,'time':formatTime(new Date()),'timestamp':Date[_0x151d61(0x2eb)](),'characterId':_0x567d63['id'],'replyTo':_0x208a07[_0x151d61(0x1a1c)]};await saveCommentToMoment(_0x259eca,_0x19e299),await updateMomentCommentCount(_0x259eca),displayCommentUnderMoment(_0x259eca,_0x19e299),await recordMemoryEvent([_0x567d63['id']],{'type':_0x151d61(0x9c7),'id':_0x151d61(0x9c7)},_0x151d61(0x75f),_0x151d61(0x1726)+_0x208a07[_0x151d61(0x1a1c)]+_0x151d61(0x1011)+_0x38f1f8);const _0x54913f=_0x259eca+'-'+_0x567d63[_0x151d61(0x1a1c)]+'-'+_0x208a07[_0x151d61(0x1a1c)],_0x3614d5=commentConversationRounds[_0x151d61(0xb78)](_0x54913f)||0x0;commentConversationRounds[_0x151d61(0x83c)](_0x54913f,_0x3614d5+0x1),console[_0x151d61(0x2187)](_0x567d63['name']+'\x20与\x20'+_0x208a07[_0x151d61(0x1a1c)]+_0x151d61(0x3bc)+_0x259eca+_0x151d61(0x772)+(_0x3614d5+0x1)+'/3'),console['log'](_0x567d63[_0x151d61(0x1a1c)]+_0x151d61(0xe6c)+_0x208a07[_0x151d61(0x1a1c)]+'：'+_0x38f1f8);}}catch(_0x19814c){console[_0x151d61(0x174a)]('生成AI间回复失败:',_0x19814c);}}async function generateAiToAiReply(_0xef5424,_0x36ef0e,_0x53031b,_0x2a9522){return await generateAiToAiReplyWithMemory(_0xef5424,_0x36ef0e,_0x53031b,_0x2a9522);}async function generateAiToAiReplyOld(_0x1e38b6,_0x2bfa54,_0xd9e284,_0x3447aa){const _0x132edf=_0x211817;try{const _0x1729f7=JSON[_0x132edf(0x22d3)](sessionStorage['getItem'](_0x132edf(0xff5))||'[]'),_0xf17035=_0x1729f7[_0x132edf(0xaf4)](_0x4eda67=>_0x4eda67['id']==_0x1e38b6||_0x4eda67[_0x132edf(0x1716)]==_0x1e38b6);if(!_0xf17035)return;const _0x323ced=_0x3447aa[_0x132edf(0x7a1)]||'',_0xba4548=_0x132edf(0xaf6)+_0x3447aa[_0x132edf(0x1a1c)]+_0x132edf(0xfb0)+_0x323ced+'）刚刚评论了：\x22'+_0x2bfa54[_0x132edf(0x1378)]+_0x132edf(0xfbc)+_0xf17035[_0x132edf(0x1378)]+_0x132edf(0x305)+_0xd9e284['name']+_0x132edf(0x21a6)+_0x3447aa[_0x132edf(0x1a1c)]+_0x132edf(0xd50)+_0x3447aa[_0x132edf(0x1a1c)]+'之间的互动关系\x0a5.\x20回复简短有趣，符合社交媒体的特点\x0a6.\x20根据你的人设选择合适的语气和用词\x0a7.\x20不要使用与角色性格不符的表情符号\x0a\x0a请回复'+_0x3447aa['name']+_0x132edf(0x1011);await recordCrossAppEvent(_0xd9e284['id'],_0x132edf(0x9c7),_0x132edf(0x75f),{'targetCharacter':_0x3447aa[_0x132edf(0x1a1c)],'originalComment':_0x2bfa54[_0x132edf(0x1378)],'momentContent':_0xf17035['text']});const _0x2cce09=await callChatAPI(_0xba4548,_0xd9e284),_0x3eb7f3=Array[_0x132edf(0x1496)](_0x2cce09)?_0x2cce09[0x0]:_0x2cce09;if(_0x3eb7f3&&_0x3eb7f3[_0x132edf(0x19d7)]()){const _0x5b9e55={'id':Date[_0x132edf(0x2eb)]()+Math[_0x132edf(0x11a8)](),'nickname':_0xd9e284['name'],'avatar':_0xd9e284[_0x132edf(0x1994)],'text':_0x3eb7f3[_0x132edf(0x19d7)](),'time':formatTime(new Date()),'timestamp':Date[_0x132edf(0x2eb)](),'replyTo':_0x3447aa['name'],'characterId':_0xd9e284['id']};saveCommentToMoment(_0x1e38b6,_0x5b9e55),updateMomentCommentCount(_0x1e38b6),displayCommentUnderMoment(_0x1e38b6,_0x5b9e55),showToast(_0xd9e284[_0x132edf(0x1a1c)]+'\x20回复了\x20'+_0x3447aa[_0x132edf(0x1a1c)]);}}catch(_0x629ec8){console[_0x132edf(0x174a)](_0x132edf(0x1efd),_0x629ec8);}}async function triggerAIReplyToUser(_0x2efda8,_0x4ba8b7,_0x38a95a){const _0xd00c0f=_0x211817;try{console[_0xd00c0f(0x2187)](_0xd00c0f(0x761)+_0x2efda8+_0xd00c0f(0x78b)+_0x4ba8b7+_0xd00c0f(0x6cd)+_0x38a95a+'\x22');const _0x6b0bc8=characters[_0xd00c0f(0xaf4)](_0x403e45=>_0x403e45[_0xd00c0f(0x1a1c)]===_0x4ba8b7);if(!_0x6b0bc8){console[_0xd00c0f(0x2187)](_0xd00c0f(0x1dd1)+_0x4ba8b7+_0xd00c0f(0x985),characters['map'](_0x580523=>_0x580523[_0xd00c0f(0x1a1c)]));return;}const _0x561488=await db[_0xd00c0f(0x9c7)][_0xd00c0f(0xb78)](parseInt(_0x2efda8));if(!_0x561488){console['log'](_0xd00c0f(0xad2)+_0x2efda8);return;}const _0x482df8=_0xd00c0f(0x1c62)+_0x38a95a+_0xd00c0f(0xfbc)+_0x561488[_0xd00c0f(0x1378)]+_0xd00c0f(0x21e)+_0x6b0bc8[_0xd00c0f(0x1a1c)]+_0xd00c0f(0x560);await recordCrossAppEvent(_0x6b0bc8['id'],_0xd00c0f(0x9c7),_0xd00c0f(0xd7b),{'userComment':_0x38a95a,'momentContent':_0x561488['text']}),await logMemoryUsageStats(_0x6b0bc8,_0xd00c0f(0x2285));const _0x19468f=await callChatAPI(_0x482df8,_0x6b0bc8);let _0x1f97d4;if(Array[_0xd00c0f(0x1496)](_0x19468f)){const _0x2ac2ea=_0x19468f[0x0];if(typeof _0x2ac2ea===_0xd00c0f(0x11b7))_0x1f97d4=_0x2ac2ea;else{if(typeof _0x2ac2ea===_0xd00c0f(0x28d)&&_0x2ac2ea[_0xd00c0f(0x211c)])_0x1f97d4=_0x2ac2ea[_0xd00c0f(0x211c)];else typeof _0x2ac2ea===_0xd00c0f(0x28d)&&_0x2ac2ea[_0xd00c0f(0x1e8e)]?_0x1f97d4=_0x2ac2ea[_0xd00c0f(0x1e8e)]:_0x1f97d4=String(_0x2ac2ea);}}else _0x1f97d4=_0x19468f;console[_0xd00c0f(0x2187)]('找到角色\x20'+_0x6b0bc8[_0xd00c0f(0x1a1c)]+_0xd00c0f(0x1d5c));if(_0x1f97d4&&_0x1f97d4[_0xd00c0f(0x19d7)]()){const _0x2c4ae6={'id':Date[_0xd00c0f(0x2eb)]()+Math['random'](),'nickname':_0x6b0bc8[_0xd00c0f(0x1a1c)],'avatar':_0x6b0bc8[_0xd00c0f(0x1994)],'text':_0x1f97d4[_0xd00c0f(0x19d7)](),'time':formatTime(new Date()),'timestamp':Date[_0xd00c0f(0x2eb)](),'replyTo':'我','characterId':_0x6b0bc8['id']};saveCommentToMoment(_0x2efda8,_0x2c4ae6),updateMomentCommentCount(_0x2efda8),displayCommentUnderMoment(_0x2efda8,_0x2c4ae6);const _0x43d863=_0x2efda8+'-'+_0x6b0bc8[_0xd00c0f(0x1a1c)],_0xcb26c9=commentConversationRounds[_0xd00c0f(0xb78)](_0x43d863)||0x0;commentConversationRounds[_0xd00c0f(0x83c)](_0x43d863,_0xcb26c9+0x1),console[_0xd00c0f(0x2187)](_0x6b0bc8[_0xd00c0f(0x1a1c)]+'\x20在动态\x20'+_0x2efda8+'\x20中的对话回合次更新为:\x20'+(_0xcb26c9+0x1)+'/3'),showToast(_0x6b0bc8[_0xd00c0f(0x1a1c)]+_0xd00c0f(0x22d6)),createPushNotification(_0x6b0bc8,_0xd00c0f(0x1873)+(_0x1f97d4['trim']()[_0xd00c0f(0x19ee)]>0xf?_0x1f97d4[_0xd00c0f(0x19d7)]()['substring'](0x0,0xf)+_0xd00c0f(0x1520):_0x1f97d4['trim']()),0xc8);}}catch(_0x119bd7){console['error'](_0xd00c0f(0x226e),_0x119bd7);}}async function generateCharacterCommentWithMemory(_0x5d6f90,_0x2ee83f){const _0x1d56b0=_0x211817;try{console[_0x1d56b0(0x2187)](_0x5d6f90[_0x1d56b0(0x1a1c)]+'\x20开始生成评论，动态发布者:\x20'+(_0x2ee83f[_0x1d56b0(0x215c)]||_0x2ee83f[_0x1d56b0(0x22d2)]));let _0xa91dbb=null;try{_0xa91dbb=await db[_0x1d56b0(0x1789)][_0x1d56b0(0xb78)](_0x5d6f90['id']);}catch(_0x5ccfd8){console['error'](_0x1d56b0(0x1741),_0x5ccfd8);}const _0x37ce8e=_0xa91dbb?.[_0x1d56b0(0x14c6)]||_0x5d6f90['prompt']||'你是'+_0x5d6f90[_0x1d56b0(0x1a1c)]+'。';let _0x30c6db='';if(_0xa91dbb?.[_0x1d56b0(0xe99)]&&_0xa91dbb[_0x1d56b0(0xe99)][_0x1d56b0(0x19ee)]>0x0)try{const _0x4c5f21=await Promise[_0x1d56b0(0x1a47)](_0xa91dbb[_0x1d56b0(0xe99)][_0x1d56b0(0x6a4)](_0x45b7eb=>db[_0x1d56b0(0x21f8)][_0x1d56b0(0xb78)](_0x45b7eb))),_0x5c064b=_0x4c5f21[_0x1d56b0(0x1e1f)](_0x401657=>_0x401657&&_0x401657[_0x1d56b0(0x211c)]);_0x5c064b[_0x1d56b0(0x19ee)]>0x0&&(_0x30c6db=_0x1d56b0(0x1a01)+_0x5c064b[_0x1d56b0(0x6a4)](_0x54cf2c=>_0x54cf2c[_0x1d56b0(0x1a1c)]+'：'+_0x54cf2c['content'])[_0x1d56b0(0x122b)]('\x0a\x0a'));}catch(_0x7657bc){console[_0x1d56b0(0x174a)](_0x1d56b0(0x144e),_0x7657bc);}let _0x3f2f35='';try{const _0x42a7a8=await db['coreMemories'][_0x1d56b0(0xa24)](_0x1d56b0(0xaf5))[_0x1d56b0(0x1694)](_0x5d6f90['id'])[_0x1d56b0(0xf13)](),_0x306330=_0x42a7a8[_0x1d56b0(0x1e1f)](_0x2dc128=>_0x2dc128['type']===_0x1d56b0(0x228e))['sort']((_0x32ad1b,_0x1d93f0)=>_0x1d93f0[_0x1d56b0(0x146c)]-_0x32ad1b[_0x1d56b0(0x146c)])[_0x1d56b0(0x6d5)](0x0,0x5);_0x306330[_0x1d56b0(0x19ee)]>0x0&&(_0x3f2f35+=_0x1d56b0(0x25d),_0x306330[_0x1d56b0(0x19fb)]((_0x455587,_0x118ef8)=>{const _0x126c2f=_0x1d56b0;_0x3f2f35+=_0x118ef8+0x1+'.\x20'+_0x455587[_0x126c2f(0x13e5)]+'\x0a';}));const _0x2d233c=await db[_0x1d56b0(0x156f)][_0x1d56b0(0xa24)](_0x1d56b0(0xaf5))[_0x1d56b0(0x1694)](_0x5d6f90['id'])[_0x1d56b0(0xf13)](),_0x5bae26=_0x2d233c['sort']((_0x8d9ea2,_0x2b7997)=>_0x2b7997[_0x1d56b0(0x1716)]-_0x8d9ea2['timestamp'])[_0x1d56b0(0x6d5)](0x0,0x3);_0x5bae26['length']>0x0&&(_0x3f2f35+=_0x1d56b0(0x11e3),_0x5bae26[_0x1d56b0(0x19fb)]((_0x35fa38,_0x56afa1)=>{const _0x280e52=_0x1d56b0;_0x3f2f35+=_0x56afa1+0x1+'.\x20'+_0x35fa38[_0x280e52(0x13e5)]+'\x0a';}));}catch(_0x569ba2){console['error'](_0x1d56b0(0x1649),_0x569ba2);}let _0x38632f='';const _0x4533a6=chatMessages[_0x5d6f90['id']]||[];if(_0x4533a6[_0x1d56b0(0x19ee)]>0x0){const _0x500859=parseInt(_0xa91dbb?.[_0x1d56b0(0x17f5)])||0xa,_0x580327=_0x4533a6['slice'](-_0x500859);_0x38632f=_0x1d56b0(0x1b92)+_0x580327[_0x1d56b0(0x6a4)](_0x149b26=>{const _0x42b35a=_0x1d56b0;if(_0x149b26[_0x42b35a(0x464)]===_0x42b35a(0xa80))return _0x42b35a(0x4ec)+_0x149b26[_0x42b35a(0x211c)];return _0x5d6f90[_0x42b35a(0x1a1c)]+'：'+_0x149b26[_0x42b35a(0x211c)];})[_0x1d56b0(0x122b)]('\x0a');}const _0x39e754=_0x2ee83f['text']||'';let _0x28309b='用户';const _0x29599e=!_0x2ee83f[_0x1d56b0(0xaf5)]||_0x2ee83f['characterId']==='user'||_0x2ee83f['authorId']===_0x1d56b0(0xa80);if(!_0x29599e){const _0x1b09d4=characters[_0x1d56b0(0xaf4)](_0xbe358c=>_0xbe358c['id']===_0x2ee83f[_0x1d56b0(0xaf5)]||_0xbe358c['id']===_0x2ee83f[_0x1d56b0(0x22d2)]);_0x1b09d4?_0x28309b=_0x1b09d4[_0x1d56b0(0x1a1c)]:_0x28309b=_0x2ee83f['nickname']||_0x1d56b0(0x12d5);}let _0x432c48='',_0x2731c0=!![],_0x338748=![],_0x5d7376=![],_0x539c2e=![];if(!_0x29599e){const _0x540cb2=characters[_0x1d56b0(0xaf4)](_0x21aabd=>_0x21aabd['id']===_0x2ee83f[_0x1d56b0(0xaf5)]||_0x21aabd['id']===_0x2ee83f[_0x1d56b0(0x22d2)]);console['log'](_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x20d6),_0x540cb2?.[_0x1d56b0(0x1a1c)]||_0x1d56b0(0x396));if(_0x540cb2){const _0x117925=(_0x37ce8e||'')['toLowerCase'](),_0x4510d8=_0x540cb2[_0x1d56b0(0x1a1c)][_0x1d56b0(0x49e)]();console[_0x1d56b0(0x2187)](_0x1d56b0(0xe49)+_0x5d6f90['name']+_0x1d56b0(0x2003)+_0x540cb2[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x21e5)),console[_0x1d56b0(0x2187)]('人设内容:\x20'+_0x117925);const _0x4f8505=['情敌','敌人','讨厌',_0x1d56b0(0x1ae2),'竞争','对手','吵架','争执','矛盾','仇人','冷战','不和',_0x1d56b0(0x1d72),'警惕','提防','防备'],_0x420237=['朋友','好友','闺蜜','兄弟','姐妹','恋人','喜欢','爱','亲密','信任','依赖','关心','在乎'],_0x2a9c71=['同学','同事','室友','邻居','认识','同班'],_0x5b3746=_0x117925['indexOf'](_0x4510d8);if(_0x5b3746!==-0x1){const _0x10b43b=Math[_0x1d56b0(0x658)](0x0,_0x5b3746-0x1e),_0x4f427d=Math[_0x1d56b0(0x21ff)](_0x117925[_0x1d56b0(0x19ee)],_0x5b3746+_0x4510d8[_0x1d56b0(0x19ee)]+0x1e),_0x592fb6=_0x117925[_0x1d56b0(0x17ca)](_0x10b43b,_0x4f427d);console[_0x1d56b0(0x2187)]('关系上下文:\x20'+_0x592fb6),_0x338748=_0x4f8505[_0x1d56b0(0x19fa)](_0x15fefc=>_0x592fb6[_0x1d56b0(0x1831)](_0x15fefc)),_0x5d7376=_0x420237['some'](_0x45add0=>_0x592fb6[_0x1d56b0(0x1831)](_0x45add0)),_0x539c2e=_0x2a9c71['some'](_0x16d306=>_0x592fb6[_0x1d56b0(0x1831)](_0x16d306)),console['log'](_0x1d56b0(0x1be8)+_0x338748+_0x1d56b0(0x19f6)+_0x5d7376+_0x1d56b0(0xf32)+_0x539c2e);}else console['log']('在人设中未找到发布者名字，检查整个人设内容'),_0x338748=_0x4f8505[_0x1d56b0(0x19fa)](_0x551f3a=>_0x117925[_0x1d56b0(0x1831)](_0x551f3a)),_0x5d7376=_0x420237[_0x1d56b0(0x19fa)](_0x2b25f9=>_0x117925[_0x1d56b0(0x1831)](_0x2b25f9)),_0x539c2e=_0x2a9c71['some'](_0x12cc66=>_0x117925[_0x1d56b0(0x1831)](_0x12cc66)),console[_0x1d56b0(0x2187)](_0x1d56b0(0xdcd)+_0x338748+_0x1d56b0(0x19f6)+_0x5d7376+_0x1d56b0(0xf32)+_0x539c2e);if(_0x338748)_0x432c48=_0x1d56b0(0x6da)+_0x540cb2[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x15b6);else{if(_0x5d7376)_0x432c48=_0x1d56b0(0x2007)+_0x540cb2[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x1502);else{if(_0x539c2e)_0x432c48='\x0a\x0a📝\x20关系提醒：你与'+_0x540cb2[_0x1d56b0(0x1a1c)]+'是'+_0x2a9c71[_0x1d56b0(0xaf4)](_0x4728e3=>_0x117925[_0x1d56b0(0x1831)](_0x4728e3))+'关系。请保持：\x0a1.\x20适度的礼貌和距离感\x0a2.\x20不过分亲密也不冷淡\x0a3.\x20符合这种关系的正常互动';else{}}}}}if(!_0x2731c0)return console[_0x1d56b0(0x2187)](_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x1334)+_0x28309b+_0x1d56b0(0x218e)),[];console[_0x1d56b0(0x2187)](_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x51e));let _0x3a3180='';try{const _0x31a8ba=await db[_0x1d56b0(0x17d5)]['where'](_0x1d56b0(0x9ba))[_0x1d56b0(0x1694)](_0x2ee83f['id'])[_0x1d56b0(0xf13)]();if(_0x31a8ba[_0x1d56b0(0x19ee)]>0x0){_0x31a8ba[_0x1d56b0(0x1104)]((_0x38716c,_0x246d39)=>_0x38716c[_0x1d56b0(0x1716)]-_0x246d39['timestamp']);const _0x3ec8a3=[];for(const _0x2b5504 of _0x31a8ba){if(_0x2b5504[_0x1d56b0(0x22d2)]===_0x1d56b0(0xa80)){_0x3ec8a3[_0x1d56b0(0x1cd6)](_0x2b5504);continue;}if(_0x2b5504[_0x1d56b0(0x22d2)]===_0x5d6f90['id']){_0x3ec8a3[_0x1d56b0(0x1cd6)](_0x2b5504);continue;}if(_0x2b5504[_0x1d56b0(0x22d2)]){const _0x57470d=characters[_0x1d56b0(0xaf4)](_0x10b261=>_0x10b261['id']===_0x2b5504[_0x1d56b0(0x22d2)]);_0x57470d&&areCharactersInSameGroup(_0x5d6f90,_0x57470d)&&_0x3ec8a3[_0x1d56b0(0x1cd6)](_0x2b5504);}}_0x3ec8a3['length']>0x0&&(_0x3a3180=_0x1d56b0(0x1a3a),_0x3ec8a3[_0x1d56b0(0x19fb)]((_0x1df15d,_0xfac81)=>{const _0x4a0573=_0x1d56b0,_0x12ee5b=_0x1df15d[_0x4a0573(0x22d2)]===_0x4a0573(0xa80)?'用户':_0x1df15d[_0x4a0573(0x215c)];_0x3a3180+=_0xfac81+0x1+'.\x20'+_0x12ee5b+':\x20'+_0x1df15d[_0x4a0573(0x1378)]+'\x0a';}),_0x3a3180+=_0x1d56b0(0x22f9));}}catch(_0x1dd6b4){console[_0x1d56b0(0x174a)](_0x1d56b0(0x60d),_0x1dd6b4);}let _0x140d47='';const _0x370afc=(_0x5d6f90[_0x1d56b0(0x1f0b)]||'')[_0x1d56b0(0x49e)]();if(_0x370afc[_0x1d56b0(0x1831)]('活泼')||_0x370afc[_0x1d56b0(0x1831)]('开朗')||_0x370afc[_0x1d56b0(0x1831)]('外向'))_0x140d47=_0x1d56b0(0x1be0);else{if(_0x370afc['includes']('冷静')||_0x370afc['includes']('理性')||_0x370afc['includes']('严谨'))_0x140d47=_0x1d56b0(0x10b2);else{if(_0x370afc[_0x1d56b0(0x1831)]('温柔')||_0x370afc['includes']('善良')||_0x370afc[_0x1d56b0(0x1831)]('体贴'))_0x140d47=_0x1d56b0(0x1a23);else{if(_0x370afc[_0x1d56b0(0x1831)]('幽默')||_0x370afc[_0x1d56b0(0x1831)]('搞笑')||_0x370afc['includes']('风趣'))_0x140d47='幽默风趣，善于调侃';else _0x370afc[_0x1d56b0(0x1831)]('内向')||_0x370afc[_0x1d56b0(0x1831)]('安静')||_0x370afc[_0x1d56b0(0x1831)]('害羞')?_0x140d47=_0x1d56b0(0x158c):_0x140d47=_0x1d56b0(0x1dc2);}}}let _0x3b07ab='你是'+_0x5d6f90[_0x1d56b0(0x1a1c)]+'，你的人设如下：'+_0x37ce8e+'。'+_0x30c6db+_0x3f2f35+_0x38632f+_0x432c48+_0x3a3180+'\x0a\x0a🎯\x20**当前情况分析**：\x0a-\x20动态发布者：'+_0x28309b+'\x0a-\x20动态内容：\x22'+_0x39e754+_0x1d56b0(0x78d)+_0x28309b+'的关系：'+(_0x338748?_0x1d56b0(0x10db):_0x5d7376?_0x1d56b0(0x1d6c):_0x539c2e?_0x1d56b0(0xbe6):_0x1d56b0(0x1f74))+'\x0a\x0a请作为'+_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0xefa)+_0x28309b+_0x1d56b0(0x22f3)+_0x140d47+_0x1d56b0(0x122a);console[_0x1d56b0(0x2187)](_0x1d56b0(0x41d)+_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0xa89)),console['log']('='[_0x1d56b0(0xcc7)](0x50)),console[_0x1d56b0(0x2187)](_0x3b07ab),console[_0x1d56b0(0x2187)]('='[_0x1d56b0(0xcc7)](0x50));let _0x25bdb8=_0x1d56b0(0xda8)+_0x39e754,_0x16e1f4=_0x2ee83f[_0x1d56b0(0x987)]&&_0x2ee83f[_0x1d56b0(0x987)][_0x1d56b0(0x19ee)]>0x0;_0x16e1f4&&(_0x25bdb8+='\x0a[该动态包含'+_0x2ee83f[_0x1d56b0(0x987)]['length']+_0x1d56b0(0xaa9));const _0x573673=_0x25bdb8+'\x0a请发表你的看法：',_0x5b39c4=isVisionModelSupported();let _0x2e076f;if(_0x16e1f4&&_0x5b39c4){const _0x44bd66=_0x2ee83f[_0x1d56b0(0x987)][0x0];console[_0x1d56b0(0x2187)](_0x1d56b0(0x83d)+_0x5d6f90[_0x1d56b0(0x1a1c)]+'\x20使用图片识别功能评论动态'),_0x2e076f=[{'role':_0x1d56b0(0x1744),'content':_0x3b07ab},{'role':_0x1d56b0(0xa80),'content':[{'type':_0x1d56b0(0x1378),'text':_0x1d56b0(0xa0a)+_0x39e754+_0x1d56b0(0x1ed2)},{'type':_0x1d56b0(0x910),'image_url':{'url':_0x44bd66}}]}];}else{if(_0x16e1f4&&!_0x5b39c4){console['log']('当前模型不支持图片识别，'+_0x5d6f90[_0x1d56b0(0x1a1c)]+_0x1d56b0(0x16bd));const _0xea64a9=_0x25bdb8+'\x0a\x0a注意：这条动态包含图片，但由于当前模型限制，你无法看到图片内容。请基于文字部分发表你的看法，可以适当询问图片相关内容。';_0x2e076f=[{'role':_0x1d56b0(0x1744),'content':_0x3b07ab},{'role':_0x1d56b0(0xa80),'content':_0xea64a9}];}else _0x2e076f=[{'role':'system','content':_0x3b07ab},{'role':'user','content':_0x573673}];}const {base:_0xc7f9f3,key:_0x100bd4,model:_0x5de276}=apiSettings;if(!_0xc7f9f3||!_0x100bd4||!_0x5de276)return console[_0x1d56b0(0x2187)]('API配置不完整，跳过AI评论'),[];const _0x2fa1f1={'model':_0x5de276,'messages':_0x2e076f,'temperature':0.8,'stream':![]},_0x4399f8=new AbortController(),_0x50c497=setTimeout(()=>_0x4399f8[_0x1d56b0(0x101b)](),0xea60),_0x58ba0d=_0xc7f9f3[_0x1d56b0(0x1831)](_0x1d56b0(0x1d80));let _0x123acf;if(_0x58ba0d){const _0xe06241=_0xc7f9f3+'/models/'+_0x5de276+_0x1d56b0(0x40c)+_0x100bd4,_0x17618c=[];_0x2fa1f1['messages'][0x0]?.[_0x1d56b0(0x464)]==='system'&&(_0x17618c[_0x1d56b0(0x1cd6)]({'role':_0x1d56b0(0xa80),'parts':[{'text':_0x2fa1f1[_0x1d56b0(0x1828)][0x0]['content']}]}),_0x17618c[_0x1d56b0(0x1cd6)]({'role':'model','parts':[{'text':_0x1d56b0(0xd5e)}]}));for(let _0x4959a3=0x1;_0x4959a3<_0x2fa1f1[_0x1d56b0(0x1828)][_0x1d56b0(0x19ee)];_0x4959a3++){const _0x537b7b=_0x2fa1f1[_0x1d56b0(0x1828)][_0x4959a3];if(_0x537b7b['role']===_0x1d56b0(0x1744))continue;if(Array[_0x1d56b0(0x1496)](_0x537b7b[_0x1d56b0(0x211c)])){const _0x1291de=[];_0x537b7b['content'][_0x1d56b0(0x19fb)](_0x358739=>{const _0x5e051b=_0x1d56b0;if(_0x358739[_0x5e051b(0x1a4b)]===_0x5e051b(0x1378))_0x1291de[_0x5e051b(0x1cd6)]({'text':_0x358739[_0x5e051b(0x1378)]});else{if(_0x358739['type']===_0x5e051b(0x910)){const _0x5eac96=_0x358739[_0x5e051b(0x910)]['url'];if(_0x5eac96['startsWith'](_0x5e051b(0x1c7e))){const [_0x2e75fe,_0x298c58]=_0x5eac96[_0x5e051b(0x204b)](','),_0x45e804=_0x2e75fe[_0x5e051b(0x1b87)](/data:([^;]+)/)?.[0x1]||_0x5e051b(0xea0);_0x1291de[_0x5e051b(0x1cd6)]({'inline_data':{'mime_type':_0x45e804,'data':_0x298c58}});}else _0x1291de[_0x5e051b(0x1cd6)]({'text':'[图片：'+_0x5eac96+']'});}}}),_0x17618c['push']({'role':_0x537b7b['role']===_0x1d56b0(0xa80)?_0x1d56b0(0xa80):_0x1d56b0(0x1976),'parts':_0x1291de});}else _0x17618c[_0x1d56b0(0x1cd6)]({'role':_0x537b7b[_0x1d56b0(0x464)]===_0x1d56b0(0xa80)?_0x1d56b0(0xa80):_0x1d56b0(0x1976),'parts':[{'text':_0x537b7b[_0x1d56b0(0x211c)]}]});}_0x123acf=await fetch(_0xe06241,{'method':_0x1d56b0(0x1dd5),'headers':{'Content-Type':_0x1d56b0(0x1b82)},'body':JSON[_0x1d56b0(0x6b8)]({'contents':_0x17618c,'generationConfig':{'temperature':_0x2fa1f1[_0x1d56b0(0x11c5)]||0.8}}),'signal':_0x4399f8[_0x1d56b0(0x159b)]});}else{let _0x56907a;if(_0xc7f9f3[_0x1d56b0(0x81f)](_0x1d56b0(0x1439)))_0x56907a=_0xc7f9f3+_0x1d56b0(0x1bea);else _0xc7f9f3[_0x1d56b0(0x1831)]('/v1/')?_0x56907a=_0xc7f9f3+_0x1d56b0(0x1bea):_0x56907a=_0xc7f9f3+_0x1d56b0(0x666);_0x123acf=await fetch(_0x56907a,{'method':_0x1d56b0(0x1dd5),'headers':{'Content-Type':_0x1d56b0(0x1b82),'Authorization':_0x1d56b0(0x1e3c)+_0x100bd4},'body':JSON['stringify'](_0x2fa1f1),'signal':_0x4399f8['signal']});}clearTimeout(_0x50c497);if(!_0x123acf['ok']){let _0x2b5227=await _0x123acf[_0x1d56b0(0x1378)]();return console[_0x1d56b0(0x174a)](_0x1d56b0(0x439)+_0x123acf[_0x1d56b0(0x12e2)]+_0x1d56b0(0x18a8)+_0x2b5227),[];}const _0x36d5e6=await _0x123acf['json']();let _0x16ab3d;if(_0x58ba0d){_0x16ab3d=_0x36d5e6[_0x1d56b0(0x1153)]?.[0x0]?.[_0x1d56b0(0x211c)]?.[_0x1d56b0(0x2308)]?.[0x0]?.[_0x1d56b0(0x1378)];if(!_0x16ab3d)return console[_0x1d56b0(0x2187)]('Gemini\x20API\x20响应数据:',_0x36d5e6),[];}else{if(_0x36d5e6[_0x1d56b0(0x1090)]&&_0x36d5e6[_0x1d56b0(0x1090)][_0x1d56b0(0x19ee)]>0x0&&_0x36d5e6[_0x1d56b0(0x1090)][0x0][_0x1d56b0(0x1e8e)])_0x16ab3d=_0x36d5e6[_0x1d56b0(0x1090)][0x0][_0x1d56b0(0x1e8e)][_0x1d56b0(0x211c)];else{if(_0x36d5e6['message'])_0x16ab3d=_0x36d5e6['message'];else{if(_0x36d5e6['text'])_0x16ab3d=_0x36d5e6['text'];else{if(_0x36d5e6[_0x1d56b0(0x928)])_0x16ab3d=_0x36d5e6[_0x1d56b0(0x928)];else{if(_0x36d5e6[_0x1d56b0(0x211c)])_0x16ab3d=_0x36d5e6[_0x1d56b0(0x211c)];else{if(_0x36d5e6[_0x1d56b0(0x4ee)])_0x16ab3d=_0x36d5e6[_0x1d56b0(0x4ee)];else for(const _0x3bcffa in _0x36d5e6){if(typeof _0x36d5e6[_0x3bcffa]===_0x1d56b0(0x11b7)&&_0x36d5e6[_0x3bcffa][_0x1d56b0(0x19d7)]()){_0x16ab3d=_0x36d5e6[_0x3bcffa],console[_0x1d56b0(0x2187)](_0x1d56b0(0x1630)+_0x3bcffa+_0x1d56b0(0x1c10));break;}}}}}}}if(!_0x16ab3d)return console[_0x1d56b0(0x174a)]('AI评论API无法解析响应，完整响应数据:',_0x36d5e6),[];}if(_0x16ab3d&&_0x16ab3d[_0x1d56b0(0x19d7)]()[_0x1d56b0(0x19ee)]>0x0)return[_0x16ab3d[_0x1d56b0(0x19d7)]()];return[];}catch(_0x211348){return console[_0x1d56b0(0x174a)](_0x1d56b0(0x215e),_0x211348),[];}}async function generateCharacterComment(_0xf020a7,_0x4c4842){return await generateCharacterCommentWithMemory(_0xf020a7,_0x4c4842);}const publisherReplyProcessing=new Map();async function triggerPublisherReplyToComments(_0xb9cb85,_0xcb0f66){const _0x5903d6=_0x211817;try{if(!_0xcb0f66)return;const _0xeda0e0=typeof _0xb9cb85===_0x5903d6(0x11b7)?parseInt(_0xb9cb85):_0xb9cb85,_0x21779b=_0xeda0e0+'-'+_0xcb0f66['id'];if(publisherReplyProcessing[_0x5903d6(0x975)](_0x21779b)){console[_0x5903d6(0x2187)](_0x5903d6(0x212b)+_0xcb0f66[_0x5903d6(0x1a1c)]+_0x5903d6(0x23f)+_0xeda0e0+'\x20的回复正在处理中，跳过重复调用');return;}publisherReplyProcessing[_0x5903d6(0x83c)](_0x21779b,!![]),console['log']('🔍\x20查询动态\x20'+_0xeda0e0+_0x5903d6(0x404));const _0x283637=await db[_0x5903d6(0x17d5)]['where'](_0x5903d6(0x9ba))[_0x5903d6(0x1694)](_0xeda0e0)[_0x5903d6(0xf13)]();if(_0x283637[_0x5903d6(0x19ee)]===0x0){publisherReplyProcessing[_0x5903d6(0x1f4a)](_0x21779b);return;}console[_0x5903d6(0x2187)](_0x5903d6(0x139c)+_0xb9cb85+'\x20的评论，发布者:\x20'+_0xcb0f66[_0x5903d6(0x1a1c)]+'\x20(ID:\x20'+_0xcb0f66['id']+')'),console['log']('📝\x20找到\x20'+_0x283637[_0x5903d6(0x19ee)]+'\x20条评论:',_0x283637['map'](_0xc50ba=>_0xc50ba[_0x5903d6(0x215c)]+_0x5903d6(0x596)+_0xc50ba[_0x5903d6(0x22d2)]+')'));const _0x4cf2b4=_0x283637['filter'](_0x38e8d8=>{const _0x15890a=_0x5903d6,_0xcf133f=_0x38e8d8[_0x15890a(0x22d2)]!==_0xcb0f66['id'],_0x4e47ae=_0x38e8d8[_0x15890a(0x22d2)]!=='user',_0x721d1e=_0x38e8d8['authorId']&&_0x38e8d8['authorId']!=='user';return console['log'](_0x15890a(0x2c8)+_0x38e8d8['nickname']+_0x15890a(0x1d91)+_0x38e8d8[_0x15890a(0x22d2)]+_0x15890a(0xe20)+_0xcf133f+_0x15890a(0x2b3)+_0x4e47ae+_0x15890a(0x10e4)+_0x721d1e),_0xcf133f&&_0x4e47ae&&_0x721d1e;}),_0x43fec6=_0x4cf2b4[_0x5903d6(0x1e1f)](_0x490e5f=>{const _0x5c9ac8=_0x5903d6,_0x34ed0a=_0x283637['some'](_0x37a658=>_0x37a658[_0x5c9ac8(0x22d2)]===_0xcb0f66['id']&&_0x37a658['replyTo']===_0x490e5f[_0x5c9ac8(0x215c)]);return _0x34ed0a&&console[_0x5c9ac8(0x2187)](_0x5c9ac8(0x212b)+_0x490e5f[_0x5c9ac8(0x215c)]+'\x20的评论已被\x20'+_0xcb0f66[_0x5c9ac8(0x1a1c)]+'\x20回复过，跳过'),!_0x34ed0a;});console[_0x5903d6(0x2187)]('✅\x20筛选后的其他角色评论数量:\x20'+_0x4cf2b4['length']),console[_0x5903d6(0x2187)]('✅\x20未回复的评论数量:\x20'+_0x43fec6['length']);if(_0x43fec6['length']===0x0){console[_0x5903d6(0x2187)]('❌\x20没有未回复的其他角色评论，'+_0xcb0f66['name']+_0x5903d6(0x20c3)),publisherReplyProcessing[_0x5903d6(0x1f4a)](_0x21779b);return;}const _0x2ba519=Math[_0x5903d6(0x11a8)]();console[_0x5903d6(0x2187)]('🎲\x20回复概率检查:\x20'+_0x2ba519['toFixed'](0x3)+_0x5903d6(0x1ab7)+(_0x2ba519<0.9)+'\x20(未回复评论数:\x20'+_0x43fec6[_0x5903d6(0x19ee)]+')');if(_0x2ba519<0.9){const _0x3326f6=_0x43fec6[Math['floor'](Math[_0x5903d6(0x11a8)]()*_0x43fec6[_0x5903d6(0x19ee)])];console[_0x5903d6(0x2187)](_0x5903d6(0x131f)+_0xcb0f66[_0x5903d6(0x1a1c)]+'\x20选择回复\x20'+_0x3326f6[_0x5903d6(0x215c)]+_0x5903d6(0x199d)+_0x3326f6['text']+'\x22');const _0x4c2276=await generatePublisherReply(_0xcb0f66,_0x3326f6,_0xeda0e0);if(_0x4c2276){const _0x1b8631={'id':Date[_0x5903d6(0x2eb)]()+Math[_0x5903d6(0x11a8)](),'nickname':_0xcb0f66[_0x5903d6(0x1a1c)],'avatar':_0xcb0f66[_0x5903d6(0x1994)],'text':_0x4c2276,'time':formatTime(new Date()),'timestamp':Date['now'](),'characterId':_0xcb0f66['id'],'replyTo':_0x3326f6[_0x5903d6(0x215c)]};await saveCommentToMoment(_0xeda0e0,_0x1b8631),await updateMomentCommentCount(_0xeda0e0),displayCommentUnderMoment(_0xeda0e0,_0x1b8631),console[_0x5903d6(0x2187)]('✅\x20'+_0xcb0f66[_0x5903d6(0x1a1c)]+_0x5903d6(0x1abb)+_0x3326f6[_0x5903d6(0x215c)]+'\x20的评论:\x20\x22'+_0x4c2276+'\x22'),await recordCrossAppEvent(_0xcb0f66['id'],_0x5903d6(0x9c7),_0x5903d6(0x75f),{'repliedTo':_0x3326f6[_0x5903d6(0x215c)],'replyContent':_0x4c2276,'originalComment':_0x3326f6[_0x5903d6(0x1378)]});const _0x4cefa6=characters['find'](_0x3abcf9=>_0x3abcf9['name']===_0x3326f6[_0x5903d6(0x215c)]);_0x4cefa6&&_0x4cefa6['id']!==_0xcb0f66['id']&&(console['log']('🔄\x20'+_0xcb0f66[_0x5903d6(0x1a1c)]+_0x5903d6(0xe6c)+_0x4cefa6[_0x5903d6(0x1a1c)]+_0x5903d6(0x1314)+_0x4cefa6[_0x5903d6(0x1a1c)]+'\x20的再次回复'),setTimeout(async()=>{const _0x18de07=_0x5903d6;console['log']('🔄\x20检查\x20'+_0x4cefa6[_0x18de07(0x1a1c)]+_0x18de07(0x68b)+_0xcb0f66[_0x18de07(0x1a1c)]+_0x18de07(0xa27)),await generateAiToAiReplyWithMemory(_0xeda0e0,_0x1b8631,_0x4cefa6,_0xcb0f66);},Math[_0x5903d6(0x11a8)]()*0x7530+0x7530));}else console[_0x5903d6(0x2187)]('❌\x20'+_0xcb0f66[_0x5903d6(0x1a1c)]+_0x5903d6(0x18ee));}else console[_0x5903d6(0x2187)](_0x5903d6(0x151d)+_0xcb0f66['name']+_0x5903d6(0x1de));}catch(_0x17c8e4){console[_0x5903d6(0x174a)](_0x5903d6(0x6d9),_0x17c8e4);}finally{const _0xad4b5a=(typeof _0xb9cb85===_0x5903d6(0x11b7)?parseInt(_0xb9cb85):_0xb9cb85)+'-'+_0xcb0f66?.['id'];publisherReplyProcessing[_0x5903d6(0x1f4a)](_0xad4b5a),console[_0x5903d6(0x2187)]('🧹\x20清除处理标记:\x20'+_0xad4b5a);}}async function generatePublisherReply(_0x217d70,_0x3792bf,_0x45423d){const _0x19185b=_0x211817;try{const _0x4b5ba3=await db[_0x19185b(0x9c7)][_0x19185b(0xb78)](parseInt(_0x45423d));if(!_0x4b5ba3)return'';let _0x10dd83=null;try{_0x10dd83=await db[_0x19185b(0x1789)][_0x19185b(0xb78)](_0x217d70['id']);}catch(_0x329cc4){console['error'](_0x19185b(0x1741),_0x329cc4);}const _0x424d55=_0x10dd83?.[_0x19185b(0x14c6)]||_0x217d70[_0x19185b(0x7a1)]||'你是'+_0x217d70[_0x19185b(0x1a1c)]+'。';let _0x59b6a9='';const _0x5b6af0=await db[_0x19185b(0x127e)][_0x19185b(0xa24)](_0x19185b(0xaf5))[_0x19185b(0x1694)](_0x217d70['id'])[_0x19185b(0xf13)](),_0x29a66e=_0x5b6af0[_0x19185b(0x1e1f)](_0x47b61c=>_0x47b61c[_0x19185b(0x13e5)]&&_0x47b61c['fact']['includes'](_0x3792bf['nickname']));_0x29a66e[_0x19185b(0x19ee)]>0x0&&(_0x59b6a9=_0x19185b(0x21cd)+_0x29a66e[_0x19185b(0x6a4)](_0x5dc6e5=>_0x5dc6e5['fact'])[_0x19185b(0x122b)]('；'));let _0x1fbf56='';try{const _0xcae846=await db[_0x19185b(0x17d5)][_0x19185b(0xa24)](_0x19185b(0x9ba))[_0x19185b(0x1694)](parseInt(_0x45423d))[_0x19185b(0xf13)]();_0xcae846[_0x19185b(0x19ee)]>0x1&&(_0xcae846[_0x19185b(0x1104)]((_0x21ade5,_0x1bf935)=>_0x21ade5['timestamp']-_0x1bf935['timestamp']),_0x1fbf56='\x0a\x0a评论区讨论情况：\x0a',_0xcae846['forEach']((_0x3f49f6,_0x46523d)=>{const _0x94bb37=_0x19185b,_0x45dded=_0x3f49f6[_0x94bb37(0x22d2)]===_0x94bb37(0xa80)?'用户':_0x3f49f6['nickname'];_0x1fbf56+=_0x46523d+0x1+'.\x20'+_0x45dded+':\x20'+_0x3f49f6[_0x94bb37(0x1378)]+'\x0a';}));}catch(_0x4c42d3){console[_0x19185b(0x174a)](_0x19185b(0x2056),_0x4c42d3);}const _0x5b1921='你是'+_0x217d70[_0x19185b(0x1a1c)]+_0x19185b(0xaca)+_0x424d55+'。'+_0x59b6a9+_0x1fbf56+_0x19185b(0x19b8)+_0x4b5ba3[_0x19185b(0x1378)]+'\x22\x0a\x0a'+_0x3792bf[_0x19185b(0x215c)]+'\x20评论说：\x22'+_0x3792bf[_0x19185b(0x1378)]+_0x19185b(0x1d4e),{base:_0x17c5b3,key:_0x195568,model:_0x5636bc}=apiSettings;if(!_0x17c5b3||!_0x195568||!_0x5636bc)return console[_0x19185b(0x2187)]('API配置不完整，跳过发布者回复'),'';const _0x4d802b=[{'role':_0x19185b(0x1744),'content':_0x5b1921},{'role':_0x19185b(0xa80),'content':_0x19185b(0x1819)}],_0x15e522={'model':_0x5636bc,'messages':_0x4d802b,'temperature':0.8,'stream':![]},_0x18d033=new AbortController(),_0x3e3d08=setTimeout(()=>_0x18d033[_0x19185b(0x101b)](),0x7530),_0x3de692=_0x17c5b3[_0x19185b(0x1831)]('generativelanguage.googleapis.com');let _0x4450b6;if(_0x3de692){const _0x2bba83=_0x17c5b3+_0x19185b(0x1107)+_0x5636bc+_0x19185b(0x40c)+_0x195568,_0xde1b45=[];_0x15e522[_0x19185b(0x1828)][0x0]?.['role']===_0x19185b(0x1744)&&(_0xde1b45[_0x19185b(0x1cd6)]({'role':'user','parts':[{'text':_0x15e522['messages'][0x0][_0x19185b(0x211c)]}]}),_0xde1b45[_0x19185b(0x1cd6)]({'role':_0x19185b(0x1976),'parts':[{'text':_0x19185b(0x967)}]}));for(let _0x1a7179=0x1;_0x1a7179<_0x15e522[_0x19185b(0x1828)][_0x19185b(0x19ee)];_0x1a7179++){const _0x5bb681=_0x15e522[_0x19185b(0x1828)][_0x1a7179];if(_0x5bb681['role']===_0x19185b(0x1744))continue;_0xde1b45['push']({'role':_0x5bb681[_0x19185b(0x464)]==='user'?'user':_0x19185b(0x1976),'parts':[{'text':_0x5bb681[_0x19185b(0x211c)]}]});}_0x4450b6=await fetch(_0x2bba83,{'method':'POST','headers':{'Content-Type':_0x19185b(0x1b82)},'body':JSON[_0x19185b(0x6b8)]({'contents':_0xde1b45,'generationConfig':{'temperature':_0x15e522[_0x19185b(0x11c5)]||0.8}}),'signal':_0x18d033[_0x19185b(0x159b)]});}else{let _0x1ada74;if(_0x17c5b3[_0x19185b(0x81f)](_0x19185b(0x1439)))_0x1ada74=_0x17c5b3+_0x19185b(0x1bea);else _0x17c5b3[_0x19185b(0x1831)](_0x19185b(0x1dac))?_0x1ada74=_0x17c5b3+_0x19185b(0x1bea):_0x1ada74=_0x17c5b3+_0x19185b(0x666);_0x4450b6=await fetch(_0x1ada74,{'method':_0x19185b(0x1dd5),'headers':{'Content-Type':_0x19185b(0x1b82),'Authorization':'Bearer\x20'+_0x195568},'body':JSON[_0x19185b(0x6b8)](_0x15e522),'signal':_0x18d033['signal']});}clearTimeout(_0x3e3d08);if(!_0x4450b6['ok'])return console[_0x19185b(0x174a)](_0x19185b(0xf6f)+_0x4450b6['status']+')'),'';const _0x4cb9fa=await _0x4450b6[_0x19185b(0xe52)]();let _0x1c8137;_0x3de692?_0x1c8137=_0x4cb9fa[_0x19185b(0x1153)]?.[0x0]?.['content']?.[_0x19185b(0x2308)]?.[0x0]?.[_0x19185b(0x1378)]:_0x1c8137=_0x4cb9fa[_0x19185b(0x1090)]?.[0x0]?.[_0x19185b(0x1e8e)]?.[_0x19185b(0x211c)]||_0x4cb9fa[_0x19185b(0x1e8e)]||_0x4cb9fa[_0x19185b(0x1378)]||_0x4cb9fa['response']||_0x4cb9fa[_0x19185b(0x211c)]||_0x4cb9fa[_0x19185b(0x4ee)];if(_0x1c8137&&_0x1c8137[_0x19185b(0x19d7)]()[_0x19185b(0x19ee)]>0x0)return _0x1c8137['trim']();return'';}catch(_0x9eca87){return console[_0x19185b(0x174a)](_0x19185b(0x73d),_0x9eca87),'';}}async function generateCharacterInteraction(_0x1527e8,_0x47d325,_0x1a77b7){const _0x3b2c15=_0x211817;try{const _0x5b6d3c=JSON[_0x3b2c15(0x22d3)](sessionStorage['getItem']('momentsData')||'[]'),_0x194807=_0x5b6d3c[_0x3b2c15(0xaf4)](_0x415e57=>_0x415e57['id']==_0x1a77b7||_0x415e57['timestamp']==_0x1a77b7);if(!_0x194807)return'';let _0x314550=null,_0x3eb789=null;try{_0x314550=await db[_0x3b2c15(0x1789)][_0x3b2c15(0xb78)](_0x1527e8['id']),_0x3eb789=await db['chatSettings'][_0x3b2c15(0xb78)](_0x47d325['id']);}catch(_0x3994a0){console['error'](_0x3b2c15(0x1741),_0x3994a0);}const _0x80c7ab=(_0x194807[_0x3b2c15(0xb09)]||[])[_0x3b2c15(0x1e1f)](_0x391077=>_0x391077[_0x3b2c15(0xaf5)]===_0x47d325['id']),_0x449fdc=_0x80c7ab[_0x80c7ab[_0x3b2c15(0x19ee)]-0x1];let _0x57267d=_0x3b2c15(0x1de8)+_0x194807[_0x3b2c15(0x1378)]+'\x0a';_0x449fdc&&(_0x57267d+=_0x47d325['name']+_0x3b2c15(0x2044)+_0x449fdc[_0x3b2c15(0x1378)]+'\x0a');const _0x5d70fb=_0x314550?.[_0x3b2c15(0x14c6)]||_0x1527e8[_0x3b2c15(0x7a1)]||'你是'+_0x1527e8[_0x3b2c15(0x1a1c)]+'。',_0x1875ae=parseInt(_0x314550?.[_0x3b2c15(0x17f5)])||0xa,_0x5816d3=chatMessages[_0x1527e8['id']]||[],_0x2e94a7=_0x5816d3[_0x3b2c15(0x6d5)](-_0x1875ae);let _0x1cc201='';_0x2e94a7[_0x3b2c15(0x19ee)]>0x0&&(_0x1cc201=_0x3b2c15(0x191b),_0x1cc201+=_0x2e94a7[_0x3b2c15(0x6a4)](_0x7d0bd0=>{const _0x283628=_0x3b2c15;if(_0x7d0bd0['role']===_0x283628(0xa80))return _0x283628(0x4ec)+_0x7d0bd0[_0x283628(0x211c)];if(_0x7d0bd0[_0x283628(0x464)]==='assistant')return _0x1527e8[_0x283628(0x1a1c)]+'：'+_0x7d0bd0[_0x283628(0x211c)];return'';})[_0x3b2c15(0x1e1f)](_0x3fc143=>_0x3fc143)[_0x3b2c15(0x122b)]('\x0a'));let _0x4d9b3f='';if(_0x314550?.['linkedWorldBookIds']&&_0x314550[_0x3b2c15(0xe99)]['length']>0x0)try{const _0xb0b4bf=await Promise[_0x3b2c15(0x1a47)](_0x314550[_0x3b2c15(0xe99)][_0x3b2c15(0x6a4)](async _0x4a10a3=>{const _0x3446ec=_0x3b2c15;try{return await db[_0x3446ec(0x21f8)]['get'](_0x4a10a3);}catch(_0x15ad2e){return console[_0x3446ec(0x174a)](_0x3446ec(0x2fa),_0x15ad2e),null;}})),_0x3f2c17=_0xb0b4bf[_0x3b2c15(0x1e1f)](_0x32ad68=>_0x32ad68&&_0x32ad68['content']);_0x3f2c17[_0x3b2c15(0x19ee)]>0x0&&(_0x4d9b3f=_0x3b2c15(0x1a01)+_0x3f2c17['map'](_0xca60f9=>_0xca60f9[_0x3b2c15(0x1a1c)]+'：'+_0xca60f9[_0x3b2c15(0x211c)])[_0x3b2c15(0x122b)]('\x0a\x0a'));}catch(_0x39f50d){console[_0x3b2c15(0x174a)](_0x3b2c15(0x144e),_0x39f50d);}let _0x47bef2='你是'+_0x1527e8[_0x3b2c15(0x1a1c)]+_0x3b2c15(0xaca)+_0x5d70fb+'。'+_0x4d9b3f+_0x1cc201+'\x0a\x0a';_0x47bef2+='这是一个楼中楼讨论，请基于以下对话上下文，继续参与讨论。要符合你的人设，回复要简短有趣。';_0x3eb789?.[_0x3b2c15(0x14c6)]&&(_0x47bef2+='\x20（'+_0x47d325[_0x3b2c15(0x1a1c)]+_0x3b2c15(0x15c2)+_0x3eb789['aiPersona']+'）');_0x47bef2+=_0x3b2c15(0xaa7);const _0x43c520=[{'role':_0x3b2c15(0x1744),'content':_0x47bef2},{'role':'user','content':_0x57267d}],{base:_0x285b36,key:_0x37e3b9,model:_0x343948}=apiSettings;if(!_0x285b36||!_0x37e3b9||!_0x343948)return console[_0x3b2c15(0x2187)](_0x3b2c15(0x14c5)),'';const _0x2bfa21={'model':_0x343948,'messages':_0x43c520,'temperature':0.8,'stream':![]},_0x6b7c04=new AbortController(),_0x165a5f=setTimeout(()=>_0x6b7c04[_0x3b2c15(0x101b)](),0x7530),_0x4c15f4=_0x285b36[_0x3b2c15(0x1831)](_0x3b2c15(0x1d80));let _0x403ac5;if(_0x4c15f4){const _0xb4194c=_0x285b36+'/models/'+_0x343948+_0x3b2c15(0x40c)+_0x37e3b9,_0x4be169=[];_0x2bfa21[_0x3b2c15(0x1828)][0x0]?.[_0x3b2c15(0x464)]===_0x3b2c15(0x1744)&&(_0x4be169[_0x3b2c15(0x1cd6)]({'role':'user','parts':[{'text':_0x2bfa21[_0x3b2c15(0x1828)][0x0][_0x3b2c15(0x211c)]}]}),_0x4be169[_0x3b2c15(0x1cd6)]({'role':_0x3b2c15(0x1976),'parts':[{'text':_0x3b2c15(0xd5e)}]}));for(let _0x2e3ce5=0x1;_0x2e3ce5<_0x2bfa21[_0x3b2c15(0x1828)][_0x3b2c15(0x19ee)];_0x2e3ce5++){const _0x1f48bd=_0x2bfa21[_0x3b2c15(0x1828)][_0x2e3ce5];if(_0x1f48bd[_0x3b2c15(0x464)]==='system')continue;_0x4be169[_0x3b2c15(0x1cd6)]({'role':_0x1f48bd[_0x3b2c15(0x464)]==='user'?'user':_0x3b2c15(0x1976),'parts':[{'text':_0x1f48bd['content']}]});}_0x403ac5=await fetch(_0xb4194c,{'method':_0x3b2c15(0x1dd5),'headers':{'Content-Type':_0x3b2c15(0x1b82)},'body':JSON[_0x3b2c15(0x6b8)]({'contents':_0x4be169,'generationConfig':{'temperature':_0x2bfa21['temperature']||0.8}}),'signal':_0x6b7c04[_0x3b2c15(0x159b)]});}else{let _0x67a2c;if(_0x285b36[_0x3b2c15(0x81f)](_0x3b2c15(0x1439)))_0x67a2c=_0x285b36+'/chat/completions';else _0x285b36[_0x3b2c15(0x1831)](_0x3b2c15(0x1dac))?_0x67a2c=_0x285b36+'/chat/completions':_0x67a2c=_0x285b36+_0x3b2c15(0x666);_0x403ac5=await fetch(_0x67a2c,{'method':_0x3b2c15(0x1dd5),'headers':{'Content-Type':_0x3b2c15(0x1b82),'Authorization':'Bearer\x20'+_0x37e3b9},'body':JSON['stringify'](_0x2bfa21),'signal':_0x6b7c04['signal']});}clearTimeout(_0x165a5f);if(!_0x403ac5['ok']){let _0x1a56fc=await _0x403ac5[_0x3b2c15(0x1378)]();return console[_0x3b2c15(0x174a)](_0x3b2c15(0xe14)+_0x403ac5[_0x3b2c15(0x12e2)]+_0x3b2c15(0x18a8)+_0x1a56fc),'';}const _0x301157=await _0x403ac5[_0x3b2c15(0xe52)]();let _0x202564;if(_0x4c15f4){_0x202564=_0x301157[_0x3b2c15(0x1153)]?.[0x0]?.['content']?.[_0x3b2c15(0x2308)]?.[0x0]?.[_0x3b2c15(0x1378)];if(!_0x202564)return console['log'](_0x3b2c15(0xf53),_0x301157),'';}else{if(_0x301157['choices']&&_0x301157[_0x3b2c15(0x1090)][_0x3b2c15(0x19ee)]>0x0&&_0x301157[_0x3b2c15(0x1090)][0x0]['message'])_0x202564=_0x301157[_0x3b2c15(0x1090)][0x0]['message'][_0x3b2c15(0x211c)];else{if(_0x301157[_0x3b2c15(0x1e8e)])_0x202564=_0x301157[_0x3b2c15(0x1e8e)];else{if(_0x301157[_0x3b2c15(0x1378)])_0x202564=_0x301157[_0x3b2c15(0x1378)];else{if(_0x301157[_0x3b2c15(0x928)])_0x202564=_0x301157[_0x3b2c15(0x928)];else{if(_0x301157[_0x3b2c15(0x211c)])_0x202564=_0x301157[_0x3b2c15(0x211c)];else{if(_0x301157[_0x3b2c15(0x4ee)])_0x202564=_0x301157[_0x3b2c15(0x4ee)];else for(const _0x43656b in _0x301157){if(typeof _0x301157[_0x43656b]===_0x3b2c15(0x11b7)&&_0x301157[_0x43656b][_0x3b2c15(0x19d7)]()){_0x202564=_0x301157[_0x43656b],console[_0x3b2c15(0x2187)](_0x3b2c15(0x1bf7)+_0x43656b+'\x22\x20作为响应内容');break;}}}}}}}if(!_0x202564)return console['error'](_0x3b2c15(0x3cf),_0x301157),'';}return _0x202564?_0x202564[_0x3b2c15(0x19d7)]():'';}catch(_0x342fd8){return console['error'](_0x3b2c15(0x1f50),_0x342fd8),'';}}function addLongPressListener(_0x18b3f5,_0x41adf7){const _0x4f6ba7=_0x211817;let _0x4850a3=null,_0x258b7f=0x0,_0x4f83a9=![];const _0x3650b1=_0x487596=>{const _0x8110c2=_0x167f;if(isSelectionMode)return;_0x258b7f=_0x487596[_0x8110c2(0x2c6)]?_0x487596[_0x8110c2(0x2c6)][0x0][_0x8110c2(0xcb0)]:_0x487596[_0x8110c2(0xcb0)],_0x4f83a9=![],_0x4850a3=setTimeout(()=>{!_0x4f83a9&&(enterSelectionMode(),selectMoment(_0x41adf7));},0x1f4);},_0x966615=()=>{clearTimeout(_0x4850a3),_0x4850a3=null;},_0x7b9ee=_0x3cf1d8=>{const _0x38d738=_0x167f,_0x31584c=_0x3cf1d8[_0x38d738(0x2c6)]?_0x3cf1d8['touches'][0x0][_0x38d738(0xcb0)]:_0x3cf1d8[_0x38d738(0xcb0)];Math[_0x38d738(0x1b24)](_0x31584c-_0x258b7f)>0xa&&(_0x4f83a9=!![],_0x966615());};_0x18b3f5[_0x4f6ba7(0x21e9)]('touchstart',_0x3650b1),_0x18b3f5[_0x4f6ba7(0x21e9)](_0x4f6ba7(0x1c63),_0x966615),_0x18b3f5[_0x4f6ba7(0x21e9)](_0x4f6ba7(0x20a4),_0x7b9ee),_0x18b3f5[_0x4f6ba7(0x21e9)](_0x4f6ba7(0x5ac),_0x3650b1),_0x18b3f5[_0x4f6ba7(0x21e9)]('mouseup',_0x966615),_0x18b3f5[_0x4f6ba7(0x21e9)](_0x4f6ba7(0xe7c),_0x7b9ee);}function enterSelectionMode(){const _0x5a3a93=_0x211817;isSelectionMode=!![],selectedMoments['clear'](),showSelectionModeUI();const _0x9e96c9=document['querySelectorAll'](_0x5a3a93(0xd59));_0x9e96c9['forEach'](_0x3e22f9=>{const _0xbd3695=_0x5a3a93,_0x34f396=document[_0xbd3695(0xac6)](_0xbd3695(0xbbc));_0x34f396[_0xbd3695(0x1722)]='moment-checkbox',_0x34f396['innerHTML']=_0xbd3695(0x884),_0x34f396[_0xbd3695(0x1f36)]=_0x56a27e=>{const _0x44c7e3=_0xbd3695;_0x56a27e[_0x44c7e3(0x902)]();const _0x4cb8e9=_0x3e22f9[_0x44c7e3(0x2139)]('data-moment-id');toggleMomentSelection(_0x4cb8e9);},_0x3e22f9['appendChild'](_0x34f396),_0x3e22f9[_0xbd3695(0x1c1b)][_0xbd3695(0x21e2)](_0xbd3695(0xf65));});}function exitSelectionMode(){const _0x13ad48=_0x211817;isSelectionMode=![],selectedMoments[_0x13ad48(0xa4f)](),hideSelectionModeUI();const _0xc4d60b=document[_0x13ad48(0x1897)]('.moment-checkbox');_0xc4d60b['forEach'](_0x576254=>_0x576254['remove']());const _0xd0e329=document['querySelectorAll'](_0x13ad48(0xd59));_0xd0e329[_0x13ad48(0x19fb)](_0x5222e5=>{const _0x3c8489=_0x13ad48;_0x5222e5[_0x3c8489(0x1c1b)][_0x3c8489(0x1493)](_0x3c8489(0xf65),_0x3c8489(0x176b));});}function showSelectionModeUI(){const _0x588cd5=_0x211817,_0x2bbe5c=document['createElement'](_0x588cd5(0xbbc));_0x2bbe5c[_0x588cd5(0x1722)]=_0x588cd5(0x12fc),_0x2bbe5c[_0x588cd5(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22cancel-btn\x22\x20data-action=\x22cancel\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22selection-count\x22>已选择\x200\x20条动态</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22delete-btn\x22\x20data-action=\x22delete\x22\x20disabled>删除</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2bbe5c[_0x588cd5(0x1f36)]=function(_0x33d3fe){const _0x48ff3b=_0x588cd5,_0x596e01=_0x33d3fe['target']['dataset'][_0x48ff3b(0x211f)];if(_0x596e01===_0x48ff3b(0x1373))exitSelectionMode();else _0x596e01===_0x48ff3b(0x1f4a)&&!_0x33d3fe[_0x48ff3b(0x193d)][_0x48ff3b(0x559)]&&deleteSelectedMoments();};const _0x32a12d=document[_0x588cd5(0x1262)](_0x588cd5(0x1fbe));_0x32a12d['insertBefore'](_0x2bbe5c,_0x32a12d['firstChild']);}function hideSelectionModeUI(){const _0x516f26=_0x211817,_0xa943a2=document[_0x516f26(0xb30)](_0x516f26(0x190));_0xa943a2&&_0xa943a2[_0x516f26(0x1493)]();}function toggleMomentSelection(_0xfc7865){const _0x137aa=_0x211817,_0x20ffe2=document['querySelector'](_0x137aa(0x1338)+_0xfc7865+'\x22]');if(!_0x20ffe2)return;const _0x46799a=_0x20ffe2[_0x137aa(0xb30)]('.moment-checkbox\x20i');if(!_0x46799a)return;selectedMoments['has'](_0xfc7865)?(selectedMoments[_0x137aa(0x1f4a)](_0xfc7865),_0x46799a[_0x137aa(0x1722)]=_0x137aa(0x943),_0x20ffe2[_0x137aa(0x1c1b)][_0x137aa(0x1493)](_0x137aa(0x176b))):(selectedMoments[_0x137aa(0x21e2)](_0xfc7865),_0x46799a['className']=_0x137aa(0x1f94),_0x20ffe2['classList'][_0x137aa(0x21e2)]('selected')),updateSelectionUI();}function selectMoment(_0x100893){const _0x14a100=_0x211817;!selectedMoments[_0x14a100(0x975)](_0x100893)&&toggleMomentSelection(_0x100893);}function updateSelectionUI(){const _0x51c8da=_0x211817,_0x4b5ff5=document[_0x51c8da(0xb30)](_0x51c8da(0x1a2b)),_0x14b358=document[_0x51c8da(0xb30)](_0x51c8da(0x18cd));_0x4b5ff5&&(_0x4b5ff5[_0x51c8da(0x13be)]=_0x51c8da(0x1318)+selectedMoments['size']+_0x51c8da(0x15e9)),_0x14b358&&(_0x14b358['disabled']=selectedMoments['size']===0x0);}async function deleteSelectedMoments(){const _0x5b0ece=_0x211817;if(selectedMoments[_0x5b0ece(0x2d8)]===0x0)return;if(!confirm(_0x5b0ece(0x111b)+selectedMoments[_0x5b0ece(0x2d8)]+_0x5b0ece(0xadf)))return;try{for(const _0x580012 of selectedMoments){try{const _0x470676=await db[_0x5b0ece(0x9c7)][_0x5b0ece(0xb78)](parseInt(_0x580012));_0x470676?(await db[_0x5b0ece(0x9c7)]['delete'](parseInt(_0x580012)),console[_0x5b0ece(0x2187)](_0x5b0ece(0x2189)+_0x580012+_0x5b0ece(0x1d3e)+_0x470676['id']+')')):console[_0x5b0ece(0x1f43)](_0x5b0ece(0x182f)+_0x580012+_0x5b0ece(0xcf4));const _0x97fa6a=parseInt(_0x580012);await db[_0x5b0ece(0x40a)]['where'](_0x5b0ece(0x9ba))[_0x5b0ece(0x1694)](_0x97fa6a)[_0x5b0ece(0x1f4a)](),await db[_0x5b0ece(0x40a)][_0x5b0ece(0xa24)](_0x5b0ece(0x9ba))[_0x5b0ece(0x1694)](_0x580012)[_0x5b0ece(0x1f4a)](),await db[_0x5b0ece(0x17d5)][_0x5b0ece(0xa24)](_0x5b0ece(0x9ba))['equals'](_0x97fa6a)['delete'](),await db[_0x5b0ece(0x17d5)][_0x5b0ece(0xa24)](_0x5b0ece(0x9ba))[_0x5b0ece(0x1694)](_0x580012)[_0x5b0ece(0x1f4a)]();}catch(_0x5b2bbd){console['error']('删除动态\x20'+_0x580012+_0x5b0ece(0xecb),_0x5b2bbd);throw _0x5b2bbd;}for(const [_0x59b164,_0x1d6bcf]of commentConversationRounds[_0x5b0ece(0x2bc)]()){_0x59b164[_0x5b0ece(0x1b30)](_0x580012+'-')&&commentConversationRounds[_0x5b0ece(0x1f4a)](_0x59b164);}}selectedMoments[_0x5b0ece(0x19fb)](_0x497949=>{const _0x2f10f5=_0x5b0ece,_0x425d0a=document[_0x2f10f5(0xb30)]('[data-moment-id=\x22'+_0x497949+'\x22]');_0x425d0a&&_0x425d0a[_0x2f10f5(0x1493)]();});try{const _0x1a89c6=sessionStorage[_0x5b0ece(0x15d8)](_0x5b0ece(0xff5));if(_0x1a89c6){const _0x1dc222=JSON[_0x5b0ece(0x22d3)](_0x1a89c6),_0x33c747=_0x1dc222[_0x5b0ece(0x1e1f)](_0xef0ca4=>!selectedMoments[_0x5b0ece(0x975)](_0xef0ca4['id'][_0x5b0ece(0x1878)]())&&!selectedMoments[_0x5b0ece(0x975)](_0xef0ca4[_0x5b0ece(0x1716)]?.[_0x5b0ece(0x1878)]()));sessionStorage[_0x5b0ece(0x192)](_0x5b0ece(0xff5),JSON[_0x5b0ece(0x6b8)](_0x33c747));}}catch(_0x41fcb6){console[_0x5b0ece(0x1f43)](_0x5b0ece(0x1abc),_0x41fcb6);}showToast(_0x5b0ece(0x17c4)+selectedMoments[_0x5b0ece(0x2d8)]+_0x5b0ece(0x15e9)),exitSelectionMode(),setTimeout(()=>{loadMoments();},0x1f4);}catch(_0x3cc439){console[_0x5b0ece(0x174a)]('删除动态失败:',_0x3cc439),showToast('删除失败，请重试');}}async function forceCleanMoment(_0x4a14a7){const _0x4f6dc6=_0x211817;try{const _0x22af08=parseInt(_0x4a14a7);console[_0x4f6dc6(0x2187)](_0x4f6dc6(0x1ef1)+_0x4a14a7);let _0x155ebd=![];const _0x370476=[_0x4a14a7,_0x22af08,String(_0x4a14a7),Number(_0x4a14a7)];for(const _0x44fc48 of _0x370476){try{await db['moments']['delete'](_0x44fc48),console['log']('✓\x20删除动态成功，使用ID:\x20'+_0x44fc48+'\x20(类型:\x20'+typeof _0x44fc48+')'),_0x155ebd=!![];break;}catch(_0xe1a5f8){console[_0x4f6dc6(0x2187)](_0x4f6dc6(0x1ca5)+_0x44fc48+_0x4f6dc6(0x1bc)+_0xe1a5f8['message']);}}!_0x155ebd&&await db[_0x4f6dc6(0x9c7)][_0x4f6dc6(0xa24)]('id')[_0x4f6dc6(0x1694)](_0x4a14a7)[_0x4f6dc6(0x1f4a)]();await db['momentLikes'][_0x4f6dc6(0xa24)](_0x4f6dc6(0x9ba))[_0x4f6dc6(0x1694)](_0x22af08)[_0x4f6dc6(0x1f4a)](),await db[_0x4f6dc6(0x40a)][_0x4f6dc6(0xa24)](_0x4f6dc6(0x9ba))['equals'](_0x4a14a7)[_0x4f6dc6(0x1f4a)](),await db[_0x4f6dc6(0x17d5)][_0x4f6dc6(0xa24)](_0x4f6dc6(0x9ba))['equals'](_0x22af08)['delete'](),await db[_0x4f6dc6(0x17d5)]['where'](_0x4f6dc6(0x9ba))[_0x4f6dc6(0x1694)](_0x4a14a7)[_0x4f6dc6(0x1f4a)]();for(const [_0x173faf,_0x17af10]of commentConversationRounds[_0x4f6dc6(0x2bc)]()){_0x173faf[_0x4f6dc6(0x1b30)](_0x4a14a7+'-')&&commentConversationRounds['delete'](_0x173faf);}const _0x3b6d9c=document['querySelector'](_0x4f6dc6(0x1338)+_0x4a14a7+'\x22]');_0x3b6d9c&&_0x3b6d9c[_0x4f6dc6(0x1493)]();const _0x5bfd0a=sessionStorage[_0x4f6dc6(0x15d8)](_0x4f6dc6(0xff5));if(_0x5bfd0a){const _0x4faf2d=JSON['parse'](_0x5bfd0a),_0x47a134=_0x4faf2d['filter'](_0x1a542d=>_0x1a542d['id']!=_0x4a14a7&&_0x1a542d[_0x4f6dc6(0x1716)]!=_0x4a14a7&&_0x1a542d['id']['toString']()!==_0x4a14a7[_0x4f6dc6(0x1878)]());sessionStorage[_0x4f6dc6(0x192)](_0x4f6dc6(0xff5),JSON[_0x4f6dc6(0x6b8)](_0x47a134));}return console['log']('动态\x20'+_0x4a14a7+_0x4f6dc6(0x1249)),!![];}catch(_0x1969b8){return console[_0x4f6dc6(0x174a)](_0x4f6dc6(0x1038),_0x1969b8),![];}}async function cleanupCorruptedMoments(){const _0x3b72be=_0x211817;if(!confirm(_0x3b72be(0xf98)))return;try{let _0x5a2fd9=0x0;const _0x7f200e=await db[_0x3b72be(0x9c7)][_0x3b72be(0xf13)]();for(const _0x2cf282 of _0x7f200e){if(_0x2cf282[_0x3b72be(0x1f8a)]&&!isValidAvatarUrl(_0x2cf282['avatar'])){console[_0x3b72be(0x2187)](_0x3b72be(0x927)+_0x2cf282['id']);const _0x28325c=confirm(_0x3b72be(0x9d2)+_0x2cf282[_0x3b72be(0x1378)]?.['substring'](0x0,0x1e)+_0x3b72be(0x198c));_0x28325c?(await forceCleanMoment(_0x2cf282['id']),_0x5a2fd9++):await db[_0x3b72be(0x9c7)]['update'](_0x2cf282['id'],{'avatar':getDefaultAvatar()});}}_0x5a2fd9>0x0?(showToast(_0x3b72be(0x1efb)+_0x5a2fd9+'\x20条有问题的动态'),loadMoments()):showToast(_0x3b72be(0x1f4));}catch(_0x308b0a){console[_0x3b72be(0x174a)](_0x3b72be(0x1ddd),_0x308b0a),showToast(_0x3b72be(0x1919));}}function changeCoverImage(){const _0x41e90f=_0x211817,_0x234252=document[_0x41e90f(0xac6)]('input');_0x234252[_0x41e90f(0x1a4b)]=_0x41e90f(0x1b7a),_0x234252[_0x41e90f(0x1515)]='image/*,.jpg,.jpeg,.png,.gif,.webp',_0x234252['onchange']=async function(_0x4182c4){const _0x359b05=_0x41e90f,_0x556457=_0x4182c4[_0x359b05(0x193d)][_0x359b05(0xf26)][0x0];if(_0x556457)try{const _0x1ab30d=await compressImage(_0x556457,0x4b0,0.8),_0xf8053d=document[_0x359b05(0x1262)](_0x359b05(0x552)),_0x3bcff7=document['getElementById'](_0x359b05(0x9e8));_0xf8053d&&_0x3bcff7&&(_0xf8053d['src']=_0x1ab30d,_0xf8053d[_0x359b05(0x1c1b)][_0x359b05(0x1493)](_0x359b05(0xdcc)),_0x3bcff7[_0x359b05(0x1c1b)]['add']('hide')),saveMomentsImage(_0x359b05(0x21cb),_0x1ab30d),showToast(_0x359b05(0xe96),_0x359b05(0x11cb));}catch(_0xb6efd){console[_0x359b05(0x174a)](_0x359b05(0xfac),_0xb6efd),showToast(_0x359b05(0x16c4),_0x359b05(0x174a));}},_0x234252[_0x41e90f(0x1859)]();}function changeAvatarImage(_0x4a8dbf){const _0x460205=_0x211817;_0x4a8dbf[_0x460205(0x902)]();const _0x3ae0ba=document[_0x460205(0xac6)]('input');_0x3ae0ba[_0x460205(0x1a4b)]=_0x460205(0x1b7a),_0x3ae0ba[_0x460205(0x1515)]=_0x460205(0x2ae),_0x3ae0ba[_0x460205(0x1980)]=async function(_0x3c9e9e){const _0x8cdb0f=_0x460205,_0x347cf6=_0x3c9e9e[_0x8cdb0f(0x193d)][_0x8cdb0f(0xf26)][0x0];if(_0x347cf6)try{const _0xc45c94=await compressImage(_0x347cf6,0x190,0.9),_0x4cf9b3=document['getElementById'](_0x8cdb0f(0x6cc)),_0x367eee=_0x4cf9b3[_0x8cdb0f(0xb30)]('.moments-avatar-icon');_0x4cf9b3[_0x8cdb0f(0x14eb)]['backgroundImage']=_0x8cdb0f(0x9f1)+_0xc45c94+')',_0x367eee[_0x8cdb0f(0x14eb)][_0x8cdb0f(0x4da)]=_0x8cdb0f(0x102b),saveMomentsImage(_0x8cdb0f(0x1633),_0xc45c94),showToast('头像已更新！','success');}catch(_0x408747){console[_0x8cdb0f(0x174a)](_0x8cdb0f(0x7cb),_0x408747),showToast(_0x8cdb0f(0x1f99),_0x8cdb0f(0x174a));}},_0x3ae0ba[_0x460205(0x1859)]();}async function loadMomentsImages(){const _0x5002f3=_0x211817;try{const _0x18a8ed=await getMomentsImage(_0x5002f3(0x21cb));if(_0x18a8ed){const _0x9d5930=document[_0x5002f3(0x1262)](_0x5002f3(0x552)),_0x246254=document[_0x5002f3(0x1262)](_0x5002f3(0x9e8));_0x9d5930&&_0x246254&&(_0x9d5930[_0x5002f3(0x45c)]=_0x18a8ed,_0x9d5930[_0x5002f3(0x1c1b)][_0x5002f3(0x1493)](_0x5002f3(0xdcc)),_0x246254[_0x5002f3(0x1c1b)][_0x5002f3(0x21e2)](_0x5002f3(0xdcc)));}const _0x2f3264=await getMomentsImage(_0x5002f3(0x1633));if(_0x2f3264){const _0x17d1e8=document[_0x5002f3(0x1262)](_0x5002f3(0x6cc)),_0x516e61=_0x17d1e8?.['querySelector'](_0x5002f3(0x1868));_0x17d1e8&&(_0x17d1e8[_0x5002f3(0x14eb)]['backgroundImage']=_0x5002f3(0x9f1)+_0x2f3264+')',_0x516e61&&(_0x516e61['style'][_0x5002f3(0x4da)]=_0x5002f3(0x102b)));}const _0x483306=await getMomentsImage(_0x5002f3(0x19db));if(_0x483306){const _0x1189eb=document[_0x5002f3(0x1262)](_0x5002f3(0x22a9));_0x1189eb&&(_0x1189eb[_0x5002f3(0x13be)]=_0x483306);}console[_0x5002f3(0x2187)]('动态图片加载完成');}catch(_0x161ab9){console[_0x5002f3(0x174a)](_0x5002f3(0x1866),_0x161ab9);}}function toggleMomentActions(_0x54f50b){const _0x5cd84d=_0x211817,_0x302d12=document['getElementById'](_0x5cd84d(0x13a3)+_0x54f50b),_0x3b9458=document[_0x5cd84d(0x1897)]('.moment-actions-popup');_0x3b9458['forEach'](_0x562d7f=>{const _0x1ffa97=_0x5cd84d;_0x562d7f['id']!=='moment-actions-'+_0x54f50b&&(_0x562d7f['style'][_0x1ffa97(0x4da)]=_0x1ffa97(0x102b));}),_0x302d12[_0x5cd84d(0x14eb)]['display']===_0x5cd84d(0x102b)||_0x302d12[_0x5cd84d(0x14eb)][_0x5cd84d(0x4da)]===''?_0x302d12[_0x5cd84d(0x14eb)]['display']='flex':_0x302d12[_0x5cd84d(0x14eb)][_0x5cd84d(0x4da)]=_0x5cd84d(0x102b);}document['addEventListener']('click',function(_0x2f7a8e){const _0xd0a0ab=_0x211817;if(!_0x2f7a8e[_0xd0a0ab(0x193d)][_0xd0a0ab(0x216a)]('.moment-actions')){const _0x32e9c6=document['querySelectorAll'](_0xd0a0ab(0x1d64));_0x32e9c6[_0xd0a0ab(0x19fb)](_0x17b3ac=>{const _0x3ad181=_0xd0a0ab;_0x17b3ac['style'][_0x3ad181(0x4da)]='none';});}});function changeUsername(_0x55c2eb){const _0x7a7009=_0x211817;_0x55c2eb[_0x7a7009(0x902)]();const _0xd77dad=document['getElementById']('moments-username')['textContent'],_0x4f12c4=prompt(_0x7a7009(0x1a4),_0xd77dad);if(_0x4f12c4!==null&&_0x4f12c4['trim']()!==''){const _0xc75591=document[_0x7a7009(0x1262)](_0x7a7009(0x22a9));_0xc75591[_0x7a7009(0x13be)]=_0x4f12c4[_0x7a7009(0x19d7)](),saveMomentsImage(_0x7a7009(0x19db),_0x4f12c4[_0x7a7009(0x19d7)]()),showToast(_0x7a7009(0x8b2),'success');}}function compressImage(_0x315422,_0x135cc2=0x320,_0x1d0e07=0.8){return new Promise(_0x35a05d=>{const _0x11996f=_0x167f,_0x43d09a=document[_0x11996f(0xac6)](_0x11996f(0x144b)),_0x1918c4=_0x43d09a['getContext']('2d'),_0x2f47d9=new Image();_0x2f47d9['onload']=function(){const _0x4dfb19=_0x11996f;let {width:_0x204fad,height:_0x1857de}=_0x2f47d9;_0x204fad>_0x135cc2&&(_0x1857de=_0x1857de*_0x135cc2/_0x204fad,_0x204fad=_0x135cc2);_0x43d09a[_0x4dfb19(0x12f1)]=_0x204fad,_0x43d09a['height']=_0x1857de,_0x1918c4[_0x4dfb19(0x899)](_0x2f47d9,0x0,0x0,_0x204fad,_0x1857de);const _0x37699a=_0x43d09a[_0x4dfb19(0x7f5)](_0x4dfb19(0xea0),_0x1d0e07);_0x35a05d(_0x37699a);},typeof _0x315422===_0x11996f(0x11b7)?_0x2f47d9['src']=_0x315422:_0x2f47d9[_0x11996f(0x45c)]=URL[_0x11996f(0x556)](_0x315422);});}async function saveMomentsImage(_0x2f8b0d,_0x4484a1){const _0x16af32=_0x211817;try{let _0x119fbd=_0x4484a1;if(_0x4484a1[_0x16af32(0x1b30)](_0x16af32(0x158e)))try{_0x119fbd=await compressImage(_0x4484a1,0x320,0.8);}catch(_0x5b0d2a){console[_0x16af32(0x1f43)](_0x16af32(0x1f56),_0x5b0d2a);}await db[_0x16af32(0x181d)][_0x16af32(0x1561)]({'id':_0x16af32(0xdc5)+_0x2f8b0d,'type':_0x16af32(0x1ac8),'data':_0x119fbd}),console[_0x16af32(0x2187)](_0x16af32(0x9b5)+_0x2f8b0d);}catch(_0x4b52a5){console[_0x16af32(0x174a)](_0x16af32(0xfc6),_0x4b52a5);try{sessionStorage[_0x16af32(0x192)]('moments_'+_0x2f8b0d,_0x4484a1),console['log'](_0x16af32(0xd79)+_0x2f8b0d);}catch(_0x51b66b){window['momentsImages']=window['momentsImages']||{},window[_0x16af32(0x839)][_0x2f8b0d]=_0x4484a1,console[_0x16af32(0x2187)](_0x16af32(0x141a)+_0x2f8b0d);}}}async function getMomentsImage(_0x572068){const _0x3ddeaa=_0x211817;try{const _0x100a2c=await db[_0x3ddeaa(0x181d)][_0x3ddeaa(0xb78)]('moments_'+_0x572068);if(_0x100a2c&&_0x100a2c[_0x3ddeaa(0x22c0)])return _0x100a2c[_0x3ddeaa(0x22c0)];const _0x4a4467=sessionStorage[_0x3ddeaa(0x15d8)](_0x3ddeaa(0xdc5)+_0x572068);if(_0x4a4467)return await saveMomentsImage(_0x572068,_0x4a4467),_0x4a4467;if(window[_0x3ddeaa(0x839)]&&window[_0x3ddeaa(0x839)][_0x572068])return window[_0x3ddeaa(0x839)][_0x572068];return null;}catch(_0x5877ca){console[_0x3ddeaa(0x174a)](_0x3ddeaa(0x11b2),_0x5877ca);try{return sessionStorage[_0x3ddeaa(0x15d8)](_0x3ddeaa(0xdc5)+_0x572068);}catch(_0x2d2325){return null;}}}function validateDataIntegrity(_0x54ad06,_0xd48e1e){const _0x436a2c=_0x211817;if(!_0x54ad06)return![];switch(_0xd48e1e){case'characters':return Array[_0x436a2c(0x1496)](_0x54ad06)&&_0x54ad06[_0x436a2c(0x1d7)](_0xe7872b=>_0xe7872b&&_0xe7872b['id']&&_0xe7872b[_0x436a2c(0x1a1c)]&&_0xe7872b['name']!=='张三'&&_0xe7872b[_0x436a2c(0x1a1c)]!=='李四');case _0x436a2c(0x19a2):return Array[_0x436a2c(0x1496)](_0x54ad06)&&_0x54ad06[_0x436a2c(0x1d7)](_0x2ba018=>_0x2ba018&&_0x2ba018['id']&&_0x2ba018[_0x436a2c(0xaf5)]);case'chatSettings':return Array['isArray'](_0x54ad06)&&_0x54ad06[_0x436a2c(0x1d7)](_0x1e2592=>_0x1e2592&&_0x1e2592['id']&&_0x1e2592['chatId']);default:return Array[_0x436a2c(0x1496)](_0x54ad06)?_0x54ad06[_0x436a2c(0x19ee)]>0x0:!!_0x54ad06;}}async function safeDataSave(_0x7f87be,_0x1eeb8c,_0x1c7793=_0x211817(0xe16)){const _0x446d85=_0x211817;if(!_0x1eeb8c||Array[_0x446d85(0x1496)](_0x1eeb8c)&&_0x1eeb8c[_0x446d85(0x19ee)]===0x0)return console[_0x446d85(0x1f43)](_0x446d85(0x15dd)+_0x7f87be+'\x20数据为空，拒绝保存以防止数据丢失'),![];if(!validateDataIntegrity(_0x1eeb8c,_0x7f87be)){console[_0x446d85(0x174a)]('❌\x20'+_0x7f87be+_0x446d85(0x1248));throw new Error(_0x7f87be+_0x446d85(0x16b3));}try{const _0x403cac=db[_0x7f87be];if(!_0x403cac)throw new Error('表\x20'+_0x7f87be+'\x20不存在');await db[_0x446d85(0x1464)]('rw',_0x403cac,async()=>{const _0x1818dd=_0x446d85;if(_0x1c7793==='replace')await _0x403cac[_0x1818dd(0xa4f)](),Array[_0x1818dd(0x1496)](_0x1eeb8c)?await _0x403cac[_0x1818dd(0x1883)](_0x1eeb8c):await _0x403cac[_0x1818dd(0x1561)](_0x1eeb8c);else _0x1c7793===_0x1818dd(0x21e2)&&(Array[_0x1818dd(0x1496)](_0x1eeb8c)?await _0x403cac[_0x1818dd(0x2a3)](_0x1eeb8c):await _0x403cac[_0x1818dd(0x21e2)](_0x1eeb8c));});const _0x37da7f=Array[_0x446d85(0x1496)](_0x1eeb8c)?_0x1eeb8c[_0x446d85(0x19ee)]:0x1;return console[_0x446d85(0x2187)](_0x446d85(0x408)+_0x37da7f+_0x446d85(0xb6d)+_0x7f87be+_0x446d85(0x6d3)),!![];}catch(_0x15b147){console[_0x446d85(0x174a)](_0x446d85(0x15c0)+_0x7f87be+_0x446d85(0x1ae9),_0x15b147);throw _0x15b147;}}async function resetDatabase(){const _0x5784d1=_0x211817;try{await db[_0x5784d1(0x1f4a)](),console[_0x5784d1(0x2187)](_0x5784d1(0x136a)),location['reload']();}catch(_0x1206d8){console[_0x5784d1(0x174a)](_0x5784d1(0x1834),_0x1206d8);}}async function recordGameEvent(_0x38c358,_0x187dff,_0xb56aa3){const _0x5ab176=_0x211817;try{await recordCrossAppEvent(_0x38c358,_0x5ab176(0x8eb),_0x187dff,{'id':_0x5ab176(0x620)+Date[_0x5ab176(0x2eb)](),'type':'game_session','gameName':_0xb56aa3[_0x5ab176(0x58e)],'action':_0x187dff,'result':_0xb56aa3['result'],'score':_0xb56aa3[_0x5ab176(0x9f5)],'chatContent':_0xb56aa3[_0x5ab176(0x3a8)],'timestamp':Date[_0x5ab176(0x2eb)]()}),console[_0x5ab176(0x2187)](_0x5ab176(0x180b)+_0x187dff+_0x5ab176(0x1811)+_0xb56aa3['gameName']);}catch(_0xa9d1db){console['error'](_0x5ab176(0x15a9),_0xa9d1db);}}async function recordGameChat(_0x1846f4,_0x52203f,_0xad16e8,_0x394254){const _0x56d2a2=_0x211817;try{await recordCrossAppEvent(_0x1846f4,'game',_0x56d2a2(0x14f7),{'id':_0x56d2a2(0x1c98)+Date[_0x56d2a2(0x2eb)](),'type':_0x56d2a2(0x14f7),'sender':_0x52203f,'content':_0xad16e8,'gameName':_0x394254['gameName'],'gameState':_0x394254[_0x56d2a2(0x75b)],'timestamp':Date[_0x56d2a2(0x2eb)]()}),console['log'](_0x56d2a2(0x51a)+_0x52203f+_0x56d2a2(0x1811)+_0xad16e8['substring'](0x0,0x1e)+_0x56d2a2(0x1520));}catch(_0x15ec62){console[_0x56d2a2(0x174a)](_0x56d2a2(0x12b0),_0x15ec62);}}function startGame(_0x247fdd){const _0xdeaa84=_0x211817;alert(_0xdeaa84(0x199a));}function togglePhoneBorder(){const _0x31b6ec=_0x211817,_0x1c3218=document[_0x31b6ec(0x1262)](_0x31b6ec(0x1548)),_0x276fa9=document['getElementById']('phone-border-toggle'),_0x2f9c11=document['body'];_0x276fa9[_0x31b6ec(0x14c1)]?(_0x1c3218[_0x31b6ec(0x1c1b)]['add'](_0x31b6ec(0x263)),_0x2f9c11[_0x31b6ec(0x1c1b)][_0x31b6ec(0x21e2)](_0x31b6ec(0x263))):(_0x1c3218['classList'][_0x31b6ec(0x1493)]('fullscreen-mode'),_0x2f9c11[_0x31b6ec(0x1c1b)][_0x31b6ec(0x1493)](_0x31b6ec(0x263)));localStorage[_0x31b6ec(0x192)](_0x31b6ec(0xd3e),_0x276fa9[_0x31b6ec(0x14c1)]);const _0x43d70e=_0x276fa9[_0x31b6ec(0x14c1)]?_0x31b6ec(0xb97):_0x31b6ec(0x1a12);showToast(_0x43d70e,'success');}function showScreenSizeOptions(){showApp('screen-size-screen');}function changeScreenSize(_0x47df30,_0x4dc9f4,_0x458548){const _0x33f928=_0x211817,_0x427b58=document[_0x33f928(0x1262)](_0x33f928(0x1548));_0x427b58[_0x33f928(0x14eb)][_0x33f928(0x12f1)]=_0x47df30+'px',_0x427b58[_0x33f928(0x14eb)]['height']=_0x4dc9f4+'px';const _0x59a7ca=document[_0x33f928(0x1262)]('current-screen-size');_0x59a7ca&&(_0x59a7ca[_0x33f928(0x13be)]=_0x33f928(0x1b35)+_0x47df30+'×'+_0x4dc9f4+'\x20('+_0x458548+')');document['querySelectorAll']('.size-option\x20.check-icon')['forEach'](_0x4ac46f=>{const _0x21ec20=_0x33f928;_0x4ac46f[_0x21ec20(0x14eb)][_0x21ec20(0x4da)]=_0x21ec20(0x102b);}),document[_0x33f928(0x1897)](_0x33f928(0x20b4))[_0x33f928(0x19fb)](_0x4b49ed=>{_0x4b49ed['style']['backgroundColor']='';});const _0x25d351=event['target'][_0x33f928(0x216a)](_0x33f928(0x20b4));if(_0x25d351){const _0x59b74b=_0x25d351[_0x33f928(0xb30)](_0x33f928(0x75a));if(_0x59b74b)_0x59b74b[_0x33f928(0x14eb)][_0x33f928(0x4da)]='block';else{const _0x4758b7=document[_0x33f928(0xac6)]('i');_0x4758b7[_0x33f928(0x1722)]=_0x33f928(0x19f0),_0x4758b7[_0x33f928(0x14eb)][_0x33f928(0x4da)]='block',_0x25d351[_0x33f928(0x497)](_0x4758b7);}_0x25d351[_0x33f928(0x14eb)][_0x33f928(0x577)]=_0x33f928(0x109a);}localStorage[_0x33f928(0x192)](_0x33f928(0x451),JSON[_0x33f928(0x6b8)]({'width':_0x47df30,'height':_0x4dc9f4,'name':_0x458548})),showToast(_0x33f928(0x1aed)+_0x458548+'！','success'),setTimeout(()=>{const _0x9dedc9=_0x33f928;showApp(_0x9dedc9(0x1846));},0x12c);}function loadScreenSize(){const _0x2429d7=_0x211817,_0x2144f8=localStorage[_0x2429d7(0x15d8)]('screenSize');if(_0x2144f8){const {width:_0x55a678,height:_0x5d7260,name:_0x8db279}=JSON[_0x2429d7(0x22d3)](_0x2144f8),_0x167863=document[_0x2429d7(0x1262)](_0x2429d7(0x1548));_0x167863['style'][_0x2429d7(0x12f1)]=_0x55a678+'px',_0x167863['style'][_0x2429d7(0xe6b)]=_0x5d7260+'px';const _0x481972=document[_0x2429d7(0x1262)](_0x2429d7(0xeb4));_0x481972&&(_0x481972['textContent']='当前：'+_0x55a678+'×'+_0x5d7260+'\x20('+_0x8db279+')');}}function updateStatusIcon(){const _0x54a751=_0x211817,_0x43e6d7=document[_0x54a751(0x1262)](_0x54a751(0x229e)),_0x499799=_0x43e6d7['value'][_0x54a751(0x19d7)]()||'';document[_0x54a751(0x204f)][_0x54a751(0x14eb)]['setProperty'](_0x54a751(0x47f),'\x22'+_0x499799+'\x22'),localStorage[_0x54a751(0x192)](_0x54a751(0x1429),_0x499799);}function resetStatusIcon(){const _0x3cbf0b=_0x211817,_0x183e07=document['getElementById'](_0x3cbf0b(0x229e));_0x183e07['value']='',updateStatusIcon();}function toggleHomeFontDropdown(){const _0x556799=_0x211817,_0x1c604c=document[_0x556799(0x1262)](_0x556799(0x18cf)),_0x3778d8=document['querySelector'](_0x556799(0x1275));_0x1c604c[_0x556799(0x14eb)][_0x556799(0x4da)]==='none'||!_0x1c604c[_0x556799(0x14eb)][_0x556799(0x4da)]?(_0x1c604c[_0x556799(0x14eb)][_0x556799(0x4da)]=_0x556799(0x13de),_0x3778d8[_0x556799(0x1c1b)][_0x556799(0x21e2)](_0x556799(0xc5f)),setTimeout(()=>{const _0x585e11=_0x556799;document[_0x585e11(0x21e9)]('click',closeHomeFontDropdown);},0x0)):(_0x1c604c[_0x556799(0x14eb)][_0x556799(0x4da)]='none',_0x3778d8[_0x556799(0x1c1b)]['remove'](_0x556799(0xc5f)),document[_0x556799(0xa21)](_0x556799(0x1859),closeHomeFontDropdown));}function closeHomeFontDropdown(_0x3c7be9){const _0x198245=_0x211817,_0x4f30e9=document[_0x198245(0x1262)](_0x198245(0x18cf)),_0x4213c7=document[_0x198245(0xb30)](_0x198245(0x1275));!_0x4213c7[_0x198245(0x971)](_0x3c7be9[_0x198245(0x193d)])&&(_0x4f30e9['style']['display']='none',_0x4213c7['classList'][_0x198245(0x1493)](_0x198245(0xc5f)),document['removeEventListener'](_0x198245(0x1859),closeHomeFontDropdown));}function selectHomeFont(_0x452b50){const _0x9658f7=_0x211817;document[_0x9658f7(0x1da9)][_0x9658f7(0x1058)](_0x9658f7(0x15f6),_0x452b50),updateHomeFontSelector(_0x452b50),updateHomeFontDropdown(_0x452b50),localStorage[_0x9658f7(0x192)](_0x9658f7(0xe67),_0x452b50);const _0x15b424=document[_0x9658f7(0x1262)](_0x9658f7(0x18cf)),_0x51798f=document['querySelector']('.home-font-selector');_0x15b424['style'][_0x9658f7(0x4da)]='none',_0x51798f[_0x9658f7(0x1c1b)][_0x9658f7(0x1493)](_0x9658f7(0xc5f)),document[_0x9658f7(0xa21)](_0x9658f7(0x1859),closeHomeFontDropdown);const _0x526f04={'black':'黑色','white':'白色'};showToast('主屏幕字体颜色已设置为'+_0x526f04[_0x452b50],_0x9658f7(0x11cb));}function updateHomeFontSelector(_0x3d0f71){const _0x144cc0=_0x211817,_0x1baa9e={'black':'黑色','white':'白色'},_0x180642=document[_0x144cc0(0x1262)](_0x144cc0(0x5d8));_0x180642&&(_0x180642[_0x144cc0(0x13be)]=_0x1baa9e[_0x3d0f71]||'黑色');}function updateHomeFontDropdown(_0x2e53d9){const _0x15c50d=_0x211817,_0xdfdc87=document[_0x15c50d(0x1897)](_0x15c50d(0xc6a));_0xdfdc87[_0x15c50d(0x19fb)](_0x1a21d8=>{const _0x3ea9ac=_0x15c50d;_0x1a21d8[_0x3ea9ac(0x1c1b)][_0x3ea9ac(0x1493)](_0x3ea9ac(0x176b)),_0x1a21d8[_0x3ea9ac(0x1f36)][_0x3ea9ac(0x1878)]()['includes']('\x27'+_0x2e53d9+'\x27')&&_0x1a21d8[_0x3ea9ac(0x1c1b)]['add'](_0x3ea9ac(0x176b));});}function setHomeFontColor(_0x4f75c7){selectHomeFont(_0x4f75c7);}function updateHomeFontColorButtons(_0x25ae15){}function toggleClockStyleDropdown(){const _0x19fde8=_0x211817,_0x5bd63a=document[_0x19fde8(0x1262)](_0x19fde8(0x143d)),_0x45000c=document[_0x19fde8(0xb30)](_0x19fde8(0x22fd));_0x5bd63a[_0x19fde8(0x14eb)]['display']===_0x19fde8(0x102b)||!_0x5bd63a[_0x19fde8(0x14eb)][_0x19fde8(0x4da)]?(_0x5bd63a[_0x19fde8(0x14eb)]['display']='block',_0x45000c[_0x19fde8(0x1c1b)][_0x19fde8(0x21e2)](_0x19fde8(0xc5f)),setTimeout(()=>{const _0x506662=_0x19fde8;document[_0x506662(0x21e9)](_0x506662(0x1859),closeClockStyleDropdown);},0x0)):(_0x5bd63a[_0x19fde8(0x14eb)][_0x19fde8(0x4da)]=_0x19fde8(0x102b),_0x45000c['classList'][_0x19fde8(0x1493)](_0x19fde8(0xc5f)),document['removeEventListener'](_0x19fde8(0x1859),closeClockStyleDropdown));}function closeClockStyleDropdown(_0x4a6b6f){const _0x1dbf22=_0x211817,_0xf5936a=document[_0x1dbf22(0x1262)](_0x1dbf22(0x143d)),_0x38822d=document[_0x1dbf22(0xb30)](_0x1dbf22(0x22fd));!_0x38822d[_0x1dbf22(0x971)](_0x4a6b6f[_0x1dbf22(0x193d)])&&(_0xf5936a[_0x1dbf22(0x14eb)][_0x1dbf22(0x4da)]=_0x1dbf22(0x102b),_0x38822d[_0x1dbf22(0x1c1b)][_0x1dbf22(0x1493)]('open'),document[_0x1dbf22(0xa21)](_0x1dbf22(0x1859),closeClockStyleDropdown));}function selectClockStyle(_0x4ac42d){const _0x362373=_0x211817;document[_0x362373(0x1da9)][_0x362373(0x1058)]('data-clock-style',_0x4ac42d),updateClockStyleSelector(_0x4ac42d),updateClockStyleDropdown(_0x4ac42d),localStorage['setItem']('clockStyle',_0x4ac42d);const _0x300eda=document[_0x362373(0x1262)]('clock-style-dropdown'),_0x5e1a28=document[_0x362373(0xb30)]('.clock-style-selector');_0x300eda[_0x362373(0x14eb)][_0x362373(0x4da)]=_0x362373(0x102b),_0x5e1a28[_0x362373(0x1c1b)][_0x362373(0x1493)](_0x362373(0xc5f)),document[_0x362373(0xa21)](_0x362373(0x1859),closeClockStyleDropdown);const _0xc6d7de={'default':_0x362373(0x976),'bold':_0x362373(0x14db),'compact':_0x362373(0xf79),'modern':_0x362373(0x193b)};showToast(_0x362373(0x8d4)+_0xc6d7de[_0x4ac42d],_0x362373(0x11cb));}function updateClockStyleSelector(_0x523e75){const _0x4ad42c=_0x211817,_0x7d2cae={'default':'默认','bold':'粗体','compact':'紧凑','modern':'现代'},_0x1951ff=document[_0x4ad42c(0x1262)](_0x4ad42c(0x10d6));_0x1951ff&&(_0x1951ff['textContent']=_0x7d2cae[_0x523e75]||'默认');}function updateClockStyleDropdown(_0x47bd5d){const _0x27a1b8=_0x211817,_0x3546ca=document['querySelectorAll']('.clock-style-option');_0x3546ca[_0x27a1b8(0x19fb)]((_0x4c73a5,_0x406fa2)=>{const _0x20683c=_0x27a1b8,_0x2cd6dc=[_0x20683c(0x1094),_0x20683c(0x504),_0x20683c(0x13d0),_0x20683c(0x3bb)];_0x2cd6dc[_0x406fa2]===_0x47bd5d?_0x4c73a5['classList'][_0x20683c(0x21e2)](_0x20683c(0x176b)):_0x4c73a5['classList']['remove'](_0x20683c(0x176b));});}function loadClockStyleSetting(){const _0x31a32d=_0x211817,_0x3f04a2=localStorage[_0x31a32d(0x15d8)](_0x31a32d(0x1348))||_0x31a32d(0x1094);document[_0x31a32d(0x1da9)]['setAttribute'](_0x31a32d(0x362),_0x3f04a2),updateClockStyleSelector(_0x3f04a2),updateClockStyleDropdown(_0x3f04a2);}function loadHomeFontColorSetting(){const _0xfac821=_0x211817,_0xb41788=localStorage[_0xfac821(0x15d8)](_0xfac821(0xe67))||'black';document[_0xfac821(0x1da9)][_0xfac821(0x1058)](_0xfac821(0x15f6),_0xb41788),updateHomeFontSelector(_0xb41788),updateHomeFontDropdown(_0xb41788);}function loadStatusIconSetting(){const _0x17fa99=_0x211817,_0x5a32d1=localStorage[_0x17fa99(0x15d8)](_0x17fa99(0x1429)),_0x1784ae=document[_0x17fa99(0x1262)]('status-icon-input'),_0x3ce69b=_0x5a32d1||'';_0x1784ae&&(_0x1784ae[_0x17fa99(0x1ebc)]=_0x3ce69b),document[_0x17fa99(0x204f)]['style']['setProperty'](_0x17fa99(0x47f),'\x22'+_0x3ce69b+'\x22');}function loadPhoneBorderSetting(){const _0x3bd123=_0x211817,_0x1b4daf=localStorage[_0x3bd123(0x15d8)](_0x3bd123(0xd3e)),_0x4bcef3=document[_0x3bd123(0x1262)](_0x3bd123(0x5a2)),_0x2d8bd5=_0x1b4daf!==null?_0x1b4daf===_0x3bd123(0x1098):![];_0x4bcef3&&(_0x4bcef3['checked']=_0x2d8bd5);const _0x20fdf4=document['getElementById'](_0x3bd123(0x1548)),_0x1c981c=document[_0x3bd123(0x1da9)];_0x2d8bd5?(_0x20fdf4[_0x3bd123(0x1c1b)][_0x3bd123(0x21e2)](_0x3bd123(0x263)),_0x1c981c['classList'][_0x3bd123(0x21e2)](_0x3bd123(0x263))):(_0x20fdf4[_0x3bd123(0x1c1b)][_0x3bd123(0x1493)]('fullscreen-mode'),_0x1c981c[_0x3bd123(0x1c1b)][_0x3bd123(0x1493)](_0x3bd123(0x263)));}function showToast(_0x1edbea,_0x3de82b=_0x211817(0x477)){const _0xb026f0=_0x211817,_0x36bdcc=document[_0xb026f0(0xac6)](_0xb026f0(0xbbc));_0x36bdcc[_0xb026f0(0x14eb)][_0xb026f0(0x1f87)]=_0xb026f0(0x1eb)+(_0x3de82b==='success'?_0xb026f0(0x1d8c):_0x3de82b==='error'?_0xb026f0(0x1412):_0xb026f0(0xb2d))+_0xb026f0(0x1bf4),_0x36bdcc[_0xb026f0(0x13be)]=_0x1edbea,document[_0xb026f0(0x1da9)][_0xb026f0(0x497)](_0x36bdcc),setTimeout(()=>{const _0x105563=_0xb026f0;_0x36bdcc[_0x105563(0x14eb)][_0x105563(0x11af)]='1';},0xa),setTimeout(()=>{const _0x2e95f4=_0xb026f0;_0x36bdcc[_0x2e95f4(0x14eb)][_0x2e95f4(0x11af)]='0',setTimeout(()=>{const _0x10ce7c=_0x2e95f4;_0x36bdcc[_0x10ce7c(0x148c)]&&_0x36bdcc[_0x10ce7c(0x148c)][_0x10ce7c(0x858)](_0x36bdcc);},0x12c);},0xbb8);}function truncateText(_0x54ed3d,_0x3f7a3a=0x32){const _0x2a29af=_0x211817;let _0x4f9dd1='';if(typeof _0x54ed3d===_0x2a29af(0x11b7))_0x4f9dd1=_0x54ed3d;else return _0x54ed3d&&typeof _0x54ed3d===_0x2a29af(0x28d)?(console[_0x2a29af(0x1f43)]('truncateText\x20函数收到了一个对象，已自动处理:',_0x54ed3d),_0x2a29af(0x1ced)):'';const _0x2a024c=_0x4f9dd1['replace'](/<[^>]*>/g,''),_0x4760b3=_0x2a024c[_0x2a29af(0xe16)](/\s+/g,'\x20')[_0x2a29af(0x19d7)]();if(_0x4760b3[_0x2a29af(0x19ee)]<=_0x3f7a3a)return _0x4760b3;return _0x4760b3['substring'](0x0,_0x3f7a3a)+_0x2a29af(0x1520);}function addMessageWithAnimation(_0xa073dd,_0x439fcf){const _0x4193ae=_0x211817,_0x31e3f4=document[_0x4193ae(0x1262)]('api-chat-messages');if(!_0x31e3f4||!currentChatCharacter||_0x439fcf!==currentChatCharacter['id'])return;_0xa073dd['sender']===_0x4193ae(0xb11)&&!_0xa073dd[_0x4193ae(0x714)]&&SoundManager[_0x4193ae(0xaa5)](SoundManager[_0x4193ae(0xf4e)][_0x4193ae(0x3cb)],_0x439fcf);const _0x5cf23d=getCurrentChatSettings();if(_0xa073dd[_0x4193ae(0x8a1)]===_0x4193ae(0x1744)){if(_0xa073dd[_0x4193ae(0x1144)]){const _0x52e8bd=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x52e8bd[_0x4193ae(0x14eb)]['display']=_0x4193ae(0x1fb7),_0x52e8bd[_0x4193ae(0x14eb)]['justifyContent']='center',_0x52e8bd['style'][_0x4193ae(0xfe0)]=_0x4193ae(0x20a1),_0x52e8bd['dataset'][_0x4193ae(0x21c8)]=_0xa073dd['id'];const _0x8616fc=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x8616fc[_0x4193ae(0x1722)]=_0x4193ae(0x319),_0x8616fc[_0x4193ae(0x13be)]=_0xa073dd[_0x4193ae(0x211c)]||_0x4193ae(0x131b),_0x52e8bd[_0x4193ae(0x497)](_0x8616fc),_0x31e3f4[_0x4193ae(0x497)](_0x52e8bd);return;}let _0x572cf5;if(_0xa073dd[_0x4193ae(0x1b0b)]){const _0x43b2ff=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x43b2ff[_0x4193ae(0x1722)]=_0x4193ae(0x1c28);const _0x7bf5bf=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x7bf5bf[_0x4193ae(0x1722)]='poke-system-message',_0x7bf5bf['textContent']=_0xa073dd[_0x4193ae(0x211c)],_0x43b2ff[_0x4193ae(0x497)](_0x7bf5bf),_0x572cf5=_0x43b2ff;}else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x2c3)){const _0x541ad1=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x541ad1[_0x4193ae(0x14eb)][_0x4193ae(0x4da)]=_0x4193ae(0x1fb7),_0x541ad1[_0x4193ae(0x14eb)]['justifyContent']=_0x4193ae(0xcef),_0x541ad1[_0x4193ae(0x14eb)][_0x4193ae(0xfe0)]=_0x4193ae(0x20a1),_0x541ad1[_0x4193ae(0x1ecd)][_0x4193ae(0x21c8)]=_0xa073dd['id'];const _0x27ce1e=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x27ce1e[_0x4193ae(0x1722)]=_0x4193ae(0x1cc7),_0x27ce1e['style']['cssText']=_0x4193ae(0x7c2),_0x27ce1e[_0x4193ae(0x13be)]=_0xa073dd['content'],_0x541ad1[_0x4193ae(0x497)](_0x27ce1e),_0x572cf5=_0x541ad1;}else{if(_0xa073dd[_0x4193ae(0x1a4b)]==='recalled_message'){const _0x30a61d=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x30a61d[_0x4193ae(0x14eb)]['display']=_0x4193ae(0x1fb7),_0x30a61d[_0x4193ae(0x14eb)]['justifyContent']=_0x4193ae(0xcef),_0x30a61d[_0x4193ae(0x14eb)][_0x4193ae(0xfe0)]=_0x4193ae(0x20a1),_0x30a61d[_0x4193ae(0x1ecd)][_0x4193ae(0x21c8)]=_0xa073dd['id'];const _0x1778c4=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x1778c4[_0x4193ae(0x1722)]=_0x4193ae(0xc37);const _0x4bbbf0=_0xa073dd[_0x4193ae(0x211c)]['split']('\x0a'),_0x316441=_0x4bbbf0[0x0],_0x1cf2f8=_0x4bbbf0[0x1];_0x1778c4['textContent']=_0x316441;if(_0x1cf2f8&&_0x1cf2f8[_0x4193ae(0x1b30)](_0x4193ae(0x2234))){const _0x2a064d=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0x2a064d[_0x4193ae(0x1722)]=_0x4193ae(0x1a35),_0x2a064d[_0x4193ae(0x13be)]=_0x1cf2f8,_0x1778c4[_0x4193ae(0x497)](_0x2a064d);}_0x30a61d['appendChild'](_0x1778c4),_0x572cf5=_0x30a61d,addMessageLongPressListener(_0x30a61d,_0xa073dd['id']);}else{const _0x201099=document['createElement'](_0x4193ae(0xbbc));_0x201099[_0x4193ae(0x14eb)][_0x4193ae(0x4da)]=_0x4193ae(0x1fb7),_0x201099['style'][_0x4193ae(0x1b5f)]=_0x4193ae(0xcef),_0x201099[_0x4193ae(0x14eb)]['margin']=_0x4193ae(0x20a1);const _0x186b75=document[_0x4193ae(0xac6)](_0x4193ae(0xbbc));_0xa073dd[_0x4193ae(0x63b)]?_0x186b75[_0x4193ae(0x1722)]=_0x4193ae(0xb0d):_0x186b75[_0x4193ae(0x1722)]=_0x4193ae(0x319),_0x186b75[_0x4193ae(0x13be)]=_0xa073dd[_0x4193ae(0x211c)],_0x201099['appendChild'](_0x186b75),_0x572cf5=_0x201099;}}}_0x572cf5[_0x4193ae(0x14eb)][_0x4193ae(0x11af)]='0',_0x572cf5[_0x4193ae(0x14eb)][_0x4193ae(0x201e)]=_0x4193ae(0x702),_0x31e3f4[_0x4193ae(0x497)](_0x572cf5),requestAnimationFrame(()=>{const _0x37b540=_0x4193ae;_0x572cf5[_0x37b540(0x1c1b)][_0x37b540(0x21e2)](_0x37b540(0x14ed));});return;}let _0x1cdcd2=document['createElement']('div');const _0x28f70f=_0xa073dd[_0x4193ae(0x8e7)]&&!_0xa073dd[_0x4193ae(0x211c)];_0x1cdcd2[_0x4193ae(0x1722)]=_0x4193ae(0x1f05)+_0xa073dd[_0x4193ae(0x8a1)]+(_0x5cf23d[_0x4193ae(0xdea)]?'\x20no-avatar':'')+(_0x28f70f?_0x4193ae(0x1086):''),_0x1cdcd2[_0x4193ae(0x1ecd)][_0x4193ae(0x21c8)]=_0xa073dd['id'];if(_0xa073dd[_0x4193ae(0x8a1)]===_0x4193ae(0xb11)){let _0x5e341a=characters[_0x4193ae(0xaf4)](_0x10d26e=>_0x10d26e['id']===_0x439fcf),_0x1446d5=![],_0x1bd7b7=null;!_0x5e341a&&(_0x1bd7b7=groupChats[_0x4193ae(0xaf4)](_0xfd0a4f=>_0xfd0a4f['id']===_0x439fcf),_0x1bd7b7&&(_0x1446d5=!![]));let _0x290346='',_0x32fa79='',_0x2d7e9c=_0x4193ae(0x1d8c);if(_0x1446d5&&_0x1bd7b7){let _0x137a6c=null;console[_0x4193ae(0x2187)](_0x4193ae(0x12e3),_0xa073dd[_0x4193ae(0x12c8)],_0x4193ae(0xa77),_0xa073dd[_0x4193ae(0x1a1c)]),console[_0x4193ae(0x2187)](_0x4193ae(0x15b7),_0x1bd7b7['members']),console[_0x4193ae(0x2187)](_0x4193ae(0x1359),_0xa073dd);_0xa073dd['isEmoji']&&console['log'](_0x4193ae(0x20e8),{'senderId':_0xa073dd['senderId'],'name':_0xa073dd[_0x4193ae(0x1a1c)],'image':_0xa073dd[_0x4193ae(0x68e)],'emojiDescription':_0xa073dd[_0x4193ae(0x29d)]});if(_0xa073dd[_0x4193ae(0x12c8)])_0x137a6c=_0x1bd7b7[_0x4193ae(0x12a6)]['find'](_0x2df0ba=>_0x2df0ba['id']===_0xa073dd['senderId']),console[_0x4193ae(0x2187)](_0x4193ae(0xff6),_0x137a6c);else _0xa073dd['name']&&(_0x137a6c=_0x1bd7b7['members'][_0x4193ae(0xaf4)](_0x249824=>_0x249824[_0x4193ae(0x1a1c)]===_0xa073dd['name']),console[_0x4193ae(0x2187)]('🔍\x20[addMessageWithAnimation]\x20通过name找到成员:',_0x137a6c));_0x137a6c?(_0x290346=_0x137a6c['avatarUrl']||'',_0x32fa79=_0x137a6c[_0x4193ae(0x1a1c)],_0x2d7e9c=_0x137a6c[_0x4193ae(0xc3d)]||_0x4193ae(0x1d8c)):(_0x290346='',_0x32fa79=_0xa073dd[_0x4193ae(0x1a1c)]||_0x4193ae(0xaae),_0x2d7e9c=_0x4193ae(0x1d8c),console[_0x4193ae(0x1f43)]('🔍\x20[addMessageWithAnimation]\x20未找到群成员，使用消息name:',_0xa073dd[_0x4193ae(0x1a1c)])),console[_0x4193ae(0x2187)]('🔍\x20[addMessageWithAnimation]\x20最终头像:',_0x290346,'显示名:',_0x32fa79);}else _0x5e341a?(_0x290346=_0x5cf23d[_0x4193ae(0x179f)]||_0x5e341a[_0x4193ae(0x1994)],_0x32fa79=_0x5cf23d[_0x4193ae(0x4e7)]||_0x5e341a['name'],_0x2d7e9c=_0x5e341a[_0x4193ae(0xc3d)]||_0x4193ae(0x1d8c)):(_0x290346='',_0x32fa79='未知',_0x2d7e9c=_0x4193ae(0x1d8c));let _0x28b7c3=_0x5cf23d[_0x4193ae(0xeaf)]||_0x4193ae(0x7ae);if(_0x1446d5&&_0x1bd7b7&&_0xa073dd[_0x4193ae(0x12c8)]&&_0x5cf23d['memberBubbleColors']){const _0x22c78b=_0x5cf23d[_0x4193ae(0x1541)][_0xa073dd[_0x4193ae(0x12c8)]];_0x22c78b&&(_0x28b7c3=_0x22c78b);}const _0x1d0e5d=_0x5cf23d[_0x4193ae(0x2fd)]||'1',_0x5bd306=isLightColor(_0x28b7c3)?_0x4193ae(0x22d0):'#fff',_0x1b3d12=_0x5cf23d[_0x4193ae(0x735)]||'12';let _0x17253b='';if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x13ed))_0x17253b='';else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0xd38)){const _0x3de9de=_0xa073dd[_0x4193ae(0x1b98)]||_0xa073dd[_0x4193ae(0x211c)]||_0x4193ae(0xbe5);_0x17253b=_0x4193ae(0x16f1)+_0x3de9de[_0x4193ae(0xe16)](/'/g,'\x5c\x27')[_0x4193ae(0xe16)](/"/g,_0x4193ae(0xb65))+_0x4193ae(0x1d42)+_0x3de9de+_0x4193ae(0x128f);}else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1a36)){const _0x3f1c6e=_0xa073dd['imageDescription']||_0xa073dd[_0x4193ae(0x211c)]||_0x4193ae(0xbb8);_0x17253b=_0x4193ae(0x16f1)+_0x3f1c6e['replace'](/'/g,'\x5c\x27')['replace'](/"/g,_0x4193ae(0xb65))+_0x4193ae(0x1d42)+_0x3f1c6e+_0x4193ae(0x128f);}else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x2184)){const _0x438a62=_0xa073dd[_0x4193ae(0x1b93)]||_0xa073dd[_0x4193ae(0x1a1c)]||_0x4193ae(0xeea);_0x17253b='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card\x22\x20onclick=\x22showLocationDetail(\x27'+_0x438a62+_0x4193ae(0x166b)+_0x438a62+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-card-map\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-background\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-roads\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2035%;\x20width:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-vertical\x22\x20style=\x22left:\x2040%;\x20height:\x20100%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22road\x20road-horizontal\x22\x20style=\x22top:\x2065%;\x20width:\x2070%;\x20left:\x2030%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-buildings\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2020%;\x20left:\x2010%;\x20width:\x2015px;\x20height:\x2015px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2045%;\x20left:\x2060%;\x20width:\x2012px;\x20height:\x2012px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22building\x22\x20style=\x22top:\x2070%;\x20left:\x2015%;\x20width:\x2018px;\x20height:\x2018px;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22map-marker\x22\x20style=\x22top:\x2050%;\x20left:\x2050%;\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0xa073dd['type']===_0x4193ae(0x78a)){const _0x2934bd=_0xa073dd[_0x4193ae(0x464)]===_0x4193ae(0xa80),_0x2aa553=_0x2934bd?'💕':'💖',_0x5b6f33=_0x2934bd?'你发起的转账':'收到转账';let _0x145b09='',_0x5b1628='',_0x4f6122='';if(_0xa073dd[_0x4193ae(0x12e2)]==='accepted')_0x5b1628='<div\x20class=\x22transfer-status\x22>'+(_0x2934bd?_0x4193ae(0x1c0f):_0x4193ae(0xeb8))+_0x4193ae(0x1844),_0x145b09=_0x4193ae(0xdfc);else{if(_0xa073dd[_0x4193ae(0x12e2)]===_0x4193ae(0xd3b))_0x5b1628='<div\x20class=\x22transfer-status\x22>'+(_0x2934bd?_0x4193ae(0x1c36):'已退回')+_0x4193ae(0x1844),_0x145b09=_0x4193ae(0xd3b);else!_0x2934bd&&(_0x4f6122='onclick=\x22showTransferConfirmDialog('+JSON[_0x4193ae(0x6b8)](_0xa073dd)[_0x4193ae(0xe16)](/"/g,_0x4193ae(0xb65))+')\x22');}_0x17253b=_0x4193ae(0x21b9)+_0x145b09+_0x4193ae(0x1415)+_0xa073dd['timestamp']+'\x22\x20'+_0x4f6122+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-title\x22>'+_0x2aa553+'\x20'+_0x5b6f33+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-amount\x22>¥\x20'+Number(_0xa073dd[_0x4193ae(0x2018)])[_0x4193ae(0x13ad)](0x2)+_0x4193ae(0x1a1a)+(_0xa073dd[_0x4193ae(0x1814)]||'转账')+_0x4193ae(0x13c3)+_0x5b1628+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}else{if(_0xa073dd['type']==='friend_request'){let _0x25d76e;if(_0xa073dd[_0x4193ae(0x1237)]){const _0x5bec54=_0xa073dd[_0x4193ae(0x2ca)]?_0x4193ae(0x1650):'已拒绝',_0x450425=_0xa073dd['friendRequestAccepted']?_0x4193ae(0xdfc):_0x4193ae(0xd3b);_0x25d76e=_0x4193ae(0xcb4)+_0x450425+'\x22>'+_0x5bec54+_0x4193ae(0x1844);}else _0x25d76e=_0x4193ae(0x1bc6)+currentChatCharacter?.['id']+_0x4193ae(0x16d8)+_0xa073dd['id']+_0x4193ae(0x1319)+currentChatCharacter?.['id']+_0x4193ae(0x1d4)+_0xa073dd['id']+_0x4193ae(0x11ee);_0x17253b=_0x4193ae(0x1392)+(_0xa073dd[_0x4193ae(0x1e8e)]||_0x4193ae(0x160b))+_0x4193ae(0xb6a)+_0x25d76e+_0x4193ae(0x207c);}else{if(_0xa073dd['type']===_0x4193ae(0x1871))_0x17253b='<div\x20class=\x22message-bubble\x22>'+(_0xa073dd['content']||'代付请求')+_0x4193ae(0x1844);else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1c97))_0x17253b=generateAIOrderConfirmationContent(_0xa073dd);else{const _0x3be0ec=_0x5cf23d[_0x4193ae(0xd0d)]||'online';let _0x3e9407;if(typeof _0xa073dd[_0x4193ae(0x211c)]==='string')_0x3e9407=_0xa073dd[_0x4193ae(0x211c)];else{if(Array[_0x4193ae(0x1496)](_0xa073dd[_0x4193ae(0x211c)])&&_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x19ee)]>0x0){const _0x1d5b38=_0xa073dd[_0x4193ae(0x211c)][0x0];_0x1d5b38&&_0x1d5b38[_0x4193ae(0x1a4b)]===_0x4193ae(0x1378)&&_0x1d5b38['text']?_0x3e9407=_0x1d5b38['text']:_0x3e9407=_0x4193ae(0x1ced);}else{if(_0xa073dd[_0x4193ae(0x211c)]&&typeof _0xa073dd['content']===_0x4193ae(0x28d)){if(_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1a1c)]&&typeof _0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1a1c)]===_0x4193ae(0x11b7)){if(_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1a4b)]===_0x4193ae(0x16fc))_0x3e9407=_0x4193ae(0x1f42)+_0xa073dd[_0x4193ae(0x211c)]['name'];else _0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1a4b)]===_0x4193ae(0x1fe3)?_0x3e9407=_0x4193ae(0x1f98)+_0xa073dd['content']['name']:_0x3e9407=_0x4193ae(0x65e)+_0xa073dd[_0x4193ae(0x211c)]['name'];}else _0x3e9407=_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1e8e)]||_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0x1378)]||_0x4193ae(0x1ced);}else _0x3e9407=String(_0xa073dd[_0x4193ae(0x211c)]||'');}}_0x3be0ec===_0x4193ae(0x1d8d)&&(_0x3e9407=processOfflineContent(_0x3e9407)),_0x3e9407=processMentions(_0x3e9407),_0xa073dd[_0x4193ae(0x1dbe)]?_0x17253b=generateReplyHTML(_0xa073dd[_0x4193ae(0x1dbe)])+_0x3e9407:_0x17253b=_0x3e9407;}}}}}}}}let _0x5a4258='';!_0x5cf23d[_0x4193ae(0xdea)]&&(_0x5a4258=generateAvatarHtml({'avatarUrl':_0x290346,'backgroundColor':_0x2d7e9c,'displayName':_0x32fa79,'chatSettings':_0x5cf23d,'onClick':_0x5e341a?_0x4193ae(0x1f4c)+_0x5e341a['id']+'\x27)':'','title':_0x5e341a?_0x4193ae(0xfd9):_0x32fa79}));const _0xeb5413=convertColorWithOpacity(_0x28b7c3,_0x1d0e5d);let _0x1a6190='';_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x78a)||_0xa073dd['type']===_0x4193ae(0x1a36)||_0xa073dd['type']===_0x4193ae(0xd38)||_0xa073dd[_0x4193ae(0x1a4b)]==='location'||_0xa073dd[_0x4193ae(0x1a4b)]==='voice_message'||_0xa073dd['type']===_0x4193ae(0x2051)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1871)?_0x1a6190=_0x17253b:_0x1a6190=_0x4193ae(0x2140)+_0xeb5413+_0x4193ae(0xe1f)+_0x5bd306+_0x4193ae(0x3a1)+_0x1b3d12+_0x4193ae(0xadb)+_0x17253b+_0x4193ae(0xb33)+(_0xa073dd['image']&&(!_0xa073dd[_0x4193ae(0x1a4b)]||_0xa073dd['isEmoji'])?_0x4193ae(0xf7c)+_0xa073dd[_0x4193ae(0x68e)]+'\x22\x20class=\x22'+(_0xa073dd[_0x4193ae(0x8e7)]?_0x4193ae(0x1c8a):_0x4193ae(0x1a8a))+_0x4193ae(0x12cb)+_0xa073dd[_0x4193ae(0x68e)]+_0x4193ae(0x13d8):'')+_0x4193ae(0x1516);if(_0x1446d5&&_0x1bd7b7&&_0x32fa79!==_0x4193ae(0xaae)){_0x1cdcd2['classList'][_0x4193ae(0x21e2)]('group-message-item');const _0x574d24='<div\x20class=\x22sender-name\x22>'+_0x32fa79+_0x4193ae(0x1844);_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x13ed)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x78a)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1a36)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0xd38)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x2184)||_0xa073dd[_0x4193ae(0x1a4b)]==='friend_request'||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1c97)||_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1871)?_0x1cdcd2[_0x4193ae(0x33a)]=_0x5a4258+(_0x4193ae(0x14c7)+_0x574d24+_0x1a6190+_0x4193ae(0x1844)):_0x1cdcd2[_0x4193ae(0x33a)]=_0x5a4258+(_0x4193ae(0x14c7)+_0x574d24+_0x1a6190+_0x4193ae(0x1844));}else _0x1cdcd2['innerHTML']=_0x5a4258+_0x1a6190;if(_0xa073dd['type']===_0x4193ae(0x13ed)){const _0x163e7e=_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0xe16)](/\([^)]*\)\s*/g,'')['trim'](),_0x3a80d3=_0xa073dd[_0x4193ae(0x5a4)]||Math['max'](0x1,Math[_0x4193ae(0x708)](_0x163e7e[_0x4193ae(0x19ee)]/0x8)),_0x413cae=_0x3a80d3<0x3c?'0:'+String(_0x3a80d3)[_0x4193ae(0xdfe)](0x2,'0')+'\x27\x27':Math[_0x4193ae(0x2180)](_0x3a80d3/0x3c)+':'+String(_0x3a80d3%0x3c)[_0x4193ae(0xdfe)](0x2,'0')+'\x27\x27',_0x35c812='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message-container\x20received\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0xeb5413+_0x4193ae(0xe1f)+_0x5bd306+_0x4193ae(0x3a1)+_0x1b3d12+_0x4193ae(0x1d10)+_0x163e7e+_0x4193ae(0x129a)+_0x413cae+_0x4193ae(0x174d)+_0x163e7e+_0x4193ae(0x1ac);if(_0x1446d5&&_0x1bd7b7&&_0x32fa79!=='群成员'){const _0x389ee3=_0x4193ae(0x67f)+_0x32fa79+_0x4193ae(0x1844);_0x1cdcd2[_0x4193ae(0x33a)]=_0x5a4258+(_0x4193ae(0x14c7)+_0x389ee3+_0x35c812+'</div>');}else _0x1cdcd2[_0x4193ae(0x33a)]=_0x5a4258+_0x35c812;}}else{let _0x2d3308=_0x5cf23d[_0x4193ae(0x11cd)];if(!_0x2d3308&&_0x5cf23d[_0x4193ae(0x145e)]){const _0x20a881=personas[_0x4193ae(0xaf4)](_0x3475a5=>_0x3475a5['id']===_0x5cf23d[_0x4193ae(0x145e)]);_0x20a881&&_0x20a881[_0x4193ae(0x1994)]&&(_0x2d3308=_0x20a881[_0x4193ae(0x1994)]);}const _0x3dc26b=_0x5cf23d[_0x4193ae(0xbfa)]||'#007AFF',_0x2a616e=_0x5cf23d['myBubbleOpacity']||'1',_0x34fb78=isLightColor(_0x3dc26b)?_0x4193ae(0x22d0):'#fff',_0x4baa69=_0x5cf23d[_0x4193ae(0x735)]||'12',_0x4d0686=convertColorWithOpacity(_0x3dc26b,_0x2a616e);let _0x2d37f6='';if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x561)){const _0x14aed7=_0xa073dd[_0x4193ae(0x5a4)]||Math[_0x4193ae(0x658)](0x1,Math[_0x4193ae(0x708)](_0xa073dd['content'][_0x4193ae(0x19ee)]/0x8));_0x2d37f6='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22message-bubble\x22\x20style=\x22background-color:\x20'+_0x4d0686+_0x4193ae(0xe1f)+_0x34fb78+_0x4193ae(0x3a1)+_0x4baa69+_0x4193ae(0xcd1)+_0xa073dd[_0x4193ae(0x211c)]+_0x4193ae(0x239)+_0x14aed7+_0x4193ae(0x1eb3);}else{if(_0xa073dd[_0x4193ae(0x1a4b)]==='location')_0x2d37f6=_0x4193ae(0xb54)+_0xa073dd[_0x4193ae(0x1b93)]+_0x4193ae(0x1c86)+_0xa073dd[_0x4193ae(0x1b93)]+_0x4193ae(0x194d)+generateRealisticMapHTML()+_0x4193ae(0x209e);else{if(_0xa073dd['type']===_0x4193ae(0x78a)){let _0x364863='',_0x18ba0a='';if(_0xa073dd[_0x4193ae(0x12e2)]===_0x4193ae(0xdfc))_0x18ba0a=_0x4193ae(0x8dc),_0x364863=_0x4193ae(0xdfc);else _0xa073dd[_0x4193ae(0x12e2)]==='rejected'&&(_0x18ba0a=_0x4193ae(0x1ce2),_0x364863=_0x4193ae(0xd3b));_0x2d37f6='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-message-container\x20sent\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22transfer-card\x20'+_0x364863+_0x4193ae(0x1415)+_0xa073dd[_0x4193ae(0x1716)]+_0x4193ae(0x2179)+Number(_0xa073dd[_0x4193ae(0x2018)])[_0x4193ae(0x13ad)](0x2)+_0x4193ae(0x1a1a)+(_0xa073dd[_0x4193ae(0x1814)]||'转账')+_0x4193ae(0x13c3)+_0x18ba0a+_0x4193ae(0x209e);}else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x2051))_0x2d37f6='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-title\x22>好友申请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22friend-request-message\x22>'+(_0xa073dd[_0x4193ae(0x1e8e)]||_0x4193ae(0x160b))+_0x4193ae(0x102d);else{if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x1c97))_0x2d37f6=_0xa073dd[_0x4193ae(0x211c)];else{let _0x3cd015='';if(Array[_0x4193ae(0x1496)](_0xa073dd['content'])){const _0x24c9de=_0xa073dd['content']['find'](_0x8a3bf2=>_0x8a3bf2['type']===_0x4193ae(0x1378)),_0x20f107=_0xa073dd[_0x4193ae(0x211c)][_0x4193ae(0xaf4)](_0x5470ed=>_0x5470ed[_0x4193ae(0x1a4b)]==='image_url');let _0x14ef2a=_0x24c9de?.[_0x4193ae(0x1378)]||'';_0x14ef2a=processMentions(_0x14ef2a),_0xa073dd[_0x4193ae(0x1dbe)]?_0x3cd015=generateReplyHTML(_0xa073dd['replyTo'])+_0x14ef2a:_0x3cd015=_0x14ef2a,_0x20f107?.[_0x4193ae(0x910)]?.[_0x4193ae(0x40f)]&&(_0x3cd015&&(_0x3cd015+='<br>'),_0x3cd015+=_0x4193ae(0xf7c)+_0x20f107[_0x4193ae(0x910)][_0x4193ae(0x40f)]+_0x4193ae(0x794)+(_0xa073dd[_0x4193ae(0x8e7)]?_0x4193ae(0x1c8a):'message-image')+_0x4193ae(0x12cb)+_0x20f107[_0x4193ae(0x910)][_0x4193ae(0x40f)]+'\x27)\x22>');}else{let _0x3f75e5=_0xa073dd[_0x4193ae(0x211c)];_0x3f75e5=processMentions(_0x3f75e5),_0xa073dd['replyTo']?_0x3cd015=generateReplyHTML(_0xa073dd['replyTo'])+_0x3f75e5:_0x3cd015=_0x3f75e5;}_0x2d37f6=_0x4193ae(0x2140)+_0x4d0686+_0x4193ae(0xe1f)+_0x34fb78+';\x20position:\x20relative;\x20padding:\x20'+_0x4baa69+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3cd015+_0x4193ae(0xb33)+(_0xa073dd[_0x4193ae(0x68e)]&&!Array[_0x4193ae(0x1496)](_0xa073dd[_0x4193ae(0x211c)])?_0x4193ae(0xf7c)+_0xa073dd[_0x4193ae(0x68e)]+_0x4193ae(0x794)+(_0xa073dd[_0x4193ae(0x8e7)]?_0x4193ae(0x1c8a):_0x4193ae(0x1a8a))+'\x22\x20onclick=\x22showImage(\x27'+_0xa073dd[_0x4193ae(0x68e)]+_0x4193ae(0x13d8):'')+_0x4193ae(0x14cf);}}}}}let _0x2ce795='';!_0x5cf23d['hideAvatars']&&(_0x2ce795=generateAvatarHtml({'avatarUrl':_0x2d3308,'backgroundColor':_0x4193ae(0xa44),'displayName':'','chatSettings':_0x5cf23d}));_0x1cdcd2[_0x4193ae(0x33a)]=_0x2d37f6+_0x2ce795;if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x561)){const _0x10518e=_0x4193ae(0x195a)+_0x4d0686+_0x4193ae(0xe1f)+_0x34fb78+_0x4193ae(0x3a1)+_0x4baa69+'px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-message\x22\x20onclick=\x22toggleVoiceText(this)\x22\x20data-text=\x22'+_0xa073dd[_0x4193ae(0x211c)]+_0x4193ae(0x129a)+(_0xa073dd[_0x4193ae(0x5a4)]||Math[_0x4193ae(0x658)](0x1,Math[_0x4193ae(0x708)](_0xa073dd[_0x4193ae(0x211c)]['length']/0x8)))+'\x22</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22voice-text-content\x22>'+_0xa073dd[_0x4193ae(0x211c)]+_0x4193ae(0x1ac);_0x1cdcd2[_0x4193ae(0x33a)]=_0x10518e+_0x2ce795;}if(_0xa073dd[_0x4193ae(0x1a4b)]===_0x4193ae(0x2184)){const _0x32908b=_0x4193ae(0xb54)+_0xa073dd[_0x4193ae(0x1b93)]+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22location-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20width=\x2214\x22\x20height=\x2214\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20style=\x22display:\x20inline-block;\x20margin-right:\x206px;\x20vertical-align:\x20middle;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x202C8.13\x202\x205\x205.13\x205\x209c0\x205.25\x207\x2013\x207\x2013s7-7.75\x207-13c0-3.87-3.13-7-7-7zm0\x209.5c-1.38\x200-2.5-1.12-2.5-2.5s1.12-2.5\x202.5-2.5\x202.5\x201.12\x202.5\x202.5-1.12\x202.5-2.5\x202.5z\x22\x20fill=\x22#1890ff\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0xa073dd[_0x4193ae(0x1b93)]+_0x4193ae(0x194d)+generateRealisticMapHTML()+_0x4193ae(0x209e);_0x1cdcd2[_0x4193ae(0x33a)]=_0x32908b+_0x2ce795;}}_0x1cdcd2[_0x4193ae(0x14eb)][_0x4193ae(0x11af)]='0',_0x1cdcd2[_0x4193ae(0x14eb)][_0x4193ae(0x201e)]=_0x4193ae(0x702),_0x31e3f4[_0x4193ae(0x497)](_0x1cdcd2),addBubbleTail(_0x1cdcd2,_0xa073dd),requestAnimationFrame(()=>{const _0xb21a47=_0x4193ae;_0x1cdcd2['classList']['add'](_0xb21a47(0x14ed));}),addBlockedIndicatorToMessage(_0x1cdcd2,_0xa073dd,_0x439fcf),addMessageLongPressListener(_0x1cdcd2,_0xa073dd['id']);const _0x25a66d=_0x1cdcd2['querySelector']('.message-bubble');_0x25a66d&&(_0x25a66d[_0x4193ae(0x21e9)]('contextmenu',_0x4a81aa=>{const _0x4944a9=_0x4193ae;_0x4a81aa[_0x4944a9(0x36f)](),showMessageMenu(_0xa073dd['id'],_0x4a81aa);}),_0x25a66d[_0x4193ae(0x1f36)]=_0xbd805f=>{const _0xc9b4bc=_0x4193ae;_0xbd805f[_0xc9b4bc(0x193d)]['tagName']==='IMG'&&_0xbd805f[_0xc9b4bc(0x193d)][_0xc9b4bc(0x1c1b)]['contains'](_0xc9b4bc(0x1a8a))&&showImage(_0xbd805f[_0xc9b4bc(0x193d)]['src']);}),_0xa073dd[_0x4193ae(0x8a1)]===_0x4193ae(0xb11)&&typeof _0xa073dd[_0x4193ae(0x211c)]==='string'&&adjustHeartrateForMessage(_0xa073dd['content'],![]),setTimeout(()=>{const _0x1f1cb6=_0x4193ae;_0x31e3f4[_0x1f1cb6(0x98c)]=_0x31e3f4[_0x1f1cb6(0xfe3)];},0x64);}function convertColorWithOpacity(_0x3c726b,_0x1dddbe){const _0x587fc4=_0x211817;if(!_0x3c726b||typeof _0x3c726b!==_0x587fc4(0x11b7))return _0x587fc4(0x1200);if(_0x3c726b[_0x587fc4(0x1b30)](_0x587fc4(0x148e)))return _0x3c726b;if(_0x3c726b[_0x587fc4(0x1b30)]('#')){const _0xf4ca78=_0x3c726b[_0x587fc4(0x6d5)](0x1),_0x2666b5=parseInt(_0xf4ca78[_0x587fc4(0x17ca)](0x0,0x2),0x10),_0x1c6fcc=parseInt(_0xf4ca78['substring'](0x2,0x4),0x10),_0x48c4ff=parseInt(_0xf4ca78[_0x587fc4(0x17ca)](0x4,0x6),0x10);return _0x587fc4(0x1f5a)+_0x2666b5+',\x20'+_0x1c6fcc+',\x20'+_0x48c4ff+',\x20'+_0x1dddbe+')';}if(_0x3c726b['startsWith'](_0x587fc4(0xe8c))){const _0x123c91=_0x3c726b[_0x587fc4(0x1b87)](/\d+/g);return _0x587fc4(0x1f5a)+_0x123c91[0x0]+',\x20'+_0x123c91[0x1]+',\x20'+_0x123c91[0x2]+',\x20'+_0x1dddbe+')';}const _0x11e3e6={'red':'255,\x200,\x200','green':_0x587fc4(0x1f24),'blue':_0x587fc4(0x14a8),'white':'255,\x20255,\x20255','black':_0x587fc4(0x1462),'gray':'128,\x20128,\x20128','yellow':'255,\x20255,\x200','cyan':_0x587fc4(0x898),'magenta':_0x587fc4(0xdd1)};if(_0x11e3e6[_0x3c726b[_0x587fc4(0x49e)]()])return _0x587fc4(0x1f5a)+_0x11e3e6[_0x3c726b['toLowerCase']()]+',\x20'+_0x1dddbe+')';return _0x3c726b;}function changeFontSize(_0x4fc32b){const _0x2beaad=_0x211817,_0x4c0c11=parseInt(_0x4fc32b),_0x36aa0e=document[_0x2beaad(0x1262)](_0x2beaad(0x54c)),_0x228234=document[_0x2beaad(0x1262)]('font-size-value');_0x36aa0e&&(_0x36aa0e['style']['fontSize']=_0x4c0c11+'px'),_0x228234&&(_0x228234[_0x2beaad(0x13be)]=_0x4c0c11+'px'),document[_0x2beaad(0x204f)][_0x2beaad(0x14eb)][_0x2beaad(0xcf0)]('--global-font-size',_0x4c0c11+'px'),applyFontSizeToMessages(_0x4c0c11),applyFontSizeToMoments(_0x4c0c11),currentChatCharacter&&typeof renderChatMessages==='function'&&setTimeout(()=>{renderChatMessages(currentChatCharacter['id']);},0x64),localStorage['setItem'](_0x2beaad(0x1928),_0x4c0c11),showToast(_0x2beaad(0x19cf),_0x2beaad(0x11cb));}function changeLetterSpacing(_0x3fb9fc){const _0x4282cf=_0x211817,_0x5c0150=parseFloat(_0x3fb9fc),_0xbd0298=document[_0x4282cf(0x1262)]('font-size-preview'),_0x55a26c=document[_0x4282cf(0x1262)](_0x4282cf(0xc99));_0xbd0298&&(_0xbd0298['style']['letterSpacing']=_0x5c0150+'px');if(_0x55a26c){let _0x512a86;if(_0x5c0150<-0.2)_0x512a86=_0x4282cf(0x30c);else{if(_0x5c0150<0.2)_0x512a86='标准';else{if(_0x5c0150<0.8)_0x512a86='舒适';else _0x5c0150<1.5?_0x512a86='宽松':_0x512a86=_0x4282cf(0x1046);}}_0x55a26c[_0x4282cf(0x13be)]=_0x512a86+'\x20('+_0x5c0150+_0x4282cf(0x4a8);}document[_0x4282cf(0x204f)][_0x4282cf(0x14eb)][_0x4282cf(0xcf0)]('--global-letter-spacing',_0x5c0150+'px'),applyLetterSpacingToMessages(_0x5c0150),applyLetterSpacingToMoments(_0x5c0150),currentChatCharacter&&typeof renderChatMessages==='function'&&setTimeout(()=>{renderChatMessages(currentChatCharacter['id']);},0x64),localStorage['setItem'](_0x4282cf(0x1e1d),_0x5c0150),showToast('字距设置已保存并应用！','success');}function applyFontSizeToMessages(_0x5681bd){const _0x39fb7d=_0x211817,_0x45d41f=document['querySelectorAll'](_0x39fb7d(0xa99));_0x45d41f[_0x39fb7d(0x19fb)](_0x4aab9b=>{const _0x3ebd3c=_0x39fb7d;_0x4aab9b[_0x3ebd3c(0x14eb)][_0x3ebd3c(0xcf0)](_0x3ebd3c(0x24b),_0x5681bd+'px','important');});const _0x1abf3b=document['getElementById'](_0x39fb7d(0x21bd));_0x1abf3b&&(_0x1abf3b[_0x39fb7d(0x14eb)][_0x39fb7d(0x3f4)]=_0x5681bd+'px');}function applyFontSizeToMoments(_0x1418bc){const _0x48421f=_0x211817,_0x3e792d=document[_0x48421f(0x1897)](_0x48421f(0x10b3));_0x3e792d[_0x48421f(0x19fb)](_0x521fd7=>{const _0x191314=_0x48421f;_0x521fd7[_0x191314(0x14eb)][_0x191314(0x3f4)]=_0x1418bc+'px';});const _0x5447cd=document[_0x48421f(0x1262)]('weibo-text');_0x5447cd&&(_0x5447cd[_0x48421f(0x14eb)][_0x48421f(0x3f4)]=_0x1418bc+'px');}function applyLetterSpacingToMessages(_0x1a2f1e){const _0x5c8baf=_0x211817,_0x34625e=document['querySelectorAll'](_0x5c8baf(0xa99));_0x34625e[_0x5c8baf(0x19fb)](_0x5bf7df=>{const _0x41cba7=_0x5c8baf;_0x5bf7df[_0x41cba7(0x14eb)][_0x41cba7(0xcf0)](_0x41cba7(0x983),_0x1a2f1e+'px',_0x41cba7(0xd42));});const _0x5a9782=document[_0x5c8baf(0x1262)](_0x5c8baf(0x21bd));_0x5a9782&&(_0x5a9782[_0x5c8baf(0x14eb)][_0x5c8baf(0x1749)]=_0x1a2f1e+'px');}function applyLetterSpacingToMoments(_0x213459){const _0x1b20e0=_0x211817,_0x29b949=document[_0x1b20e0(0x1897)]('.post-content');_0x29b949['forEach'](_0x5e452d=>{const _0x1b089b=_0x1b20e0;_0x5e452d['style'][_0x1b089b(0x1749)]=_0x213459+'px';});const _0x2bef68=document['getElementById'](_0x1b20e0(0x208d));_0x2bef68&&(_0x2bef68[_0x1b20e0(0x14eb)][_0x1b20e0(0x1749)]=_0x213459+'px');}function toggleAutoScale(){const _0x7af0f=_0x211817,_0x20ba4c=document['getElementById'](_0x7af0f(0x1615)),_0x3e3aea=_0x20ba4c[_0x7af0f(0x14c1)];localStorage[_0x7af0f(0x192)](_0x7af0f(0x1cc5),_0x3e3aea),_0x3e3aea?(autoAdjustFontSize(),showToast('字体自动缩放已开启！','success')):showToast(_0x7af0f(0xd84),_0x7af0f(0x11cb));}function autoAdjustFontSize(){const _0x32de67=_0x211817,_0x547b88=document['getElementById'](_0x32de67(0x1548));if(!_0x547b88)return;const _0x58fb9b=parseInt(_0x547b88['style'][_0x32de67(0x12f1)])||0x15e;let _0x3d8390=0xf;if(_0x58fb9b<=0x140)_0x3d8390=0xd;else{if(_0x58fb9b<=0x15e)_0x3d8390=0xe;else{if(_0x58fb9b<=0x177)_0x3d8390=0xf;else _0x58fb9b<=0x186?_0x3d8390=0x10:_0x3d8390=0x11;}}const _0x1173c8=document[_0x32de67(0x1262)](_0x32de67(0x1a16));_0x1173c8&&(_0x1173c8[_0x32de67(0x1ebc)]=_0x3d8390,changeFontSize(_0x3d8390));}function loadFontSizeSettings(){const _0x359a60=_0x211817,_0x4b6c79=localStorage[_0x359a60(0x15d8)](_0x359a60(0x1928)),_0x24b62e=_0x4b6c79?parseInt(_0x4b6c79):0xf,_0x33a7b2=document[_0x359a60(0x1262)](_0x359a60(0x1a16)),_0x3e02bf=document['getElementById']('font-size-preview'),_0x3e36cb=document['getElementById'](_0x359a60(0x843));_0x33a7b2&&(_0x33a7b2['value']=_0x24b62e);_0x3e02bf&&(_0x3e02bf[_0x359a60(0x14eb)][_0x359a60(0x3f4)]=_0x24b62e+'px');_0x3e36cb&&(_0x3e36cb['textContent']=_0x24b62e+'px');document['documentElement'][_0x359a60(0x14eb)][_0x359a60(0xcf0)]('--global-font-size',_0x24b62e+'px');const _0x4eb752=localStorage['getItem'](_0x359a60(0x1e1d)),_0x49b2e0=_0x4eb752?parseFloat(_0x4eb752):0x0,_0x2d1cb7=document['getElementById'](_0x359a60(0x1755)),_0x517d20=document[_0x359a60(0x1262)](_0x359a60(0xc99));_0x2d1cb7&&(_0x2d1cb7[_0x359a60(0x1ebc)]=_0x49b2e0);_0x3e02bf&&(_0x3e02bf[_0x359a60(0x14eb)]['letterSpacing']=_0x49b2e0+'px');if(_0x517d20){let _0x202128;if(_0x49b2e0<-0.2)_0x202128=_0x359a60(0x30c);else{if(_0x49b2e0<0.2)_0x202128='标准';else{if(_0x49b2e0<0.8)_0x202128='舒适';else _0x49b2e0<1.5?_0x202128='宽松':_0x202128=_0x359a60(0x1046);}}_0x517d20[_0x359a60(0x13be)]=_0x202128+'\x20('+_0x49b2e0+_0x359a60(0x4a8);}document[_0x359a60(0x204f)]['style'][_0x359a60(0xcf0)](_0x359a60(0x662),_0x49b2e0+'px'),setTimeout(()=>{applyFontSizeToMessages(_0x24b62e),applyFontSizeToMoments(_0x24b62e),applyLetterSpacingToMessages(_0x49b2e0),applyLetterSpacingToMoments(_0x49b2e0);},0x1f4);const _0x189f0c=localStorage['getItem'](_0x359a60(0x1cc5)),_0x5383fb=document[_0x359a60(0x1262)](_0x359a60(0x1615));_0x5383fb&&(_0x5383fb[_0x359a60(0x14c1)]=_0x189f0c===_0x359a60(0x1098));}let globalFontSettings={'fontUrl':'','fontName':'','isApplied':![]};function previewGlobalFont(){const _0x617a9b=_0x211817,_0x264f24=document[_0x617a9b(0x1262)](_0x617a9b(0x316))[_0x617a9b(0x1ebc)][_0x617a9b(0x19d7)]();if(!_0x264f24){showFontStatus(_0x617a9b(0xc58),'error');return;}showFontStatus(_0x617a9b(0x5c1),_0x617a9b(0x477));const _0x25c56e=document[_0x617a9b(0x1262)](_0x617a9b(0x8d0));_0x25c56e&&_0x25c56e[_0x617a9b(0x1493)]();if(isCSSFontUrl(_0x264f24))loadCSSFontPreview(_0x264f24);else isFontFileUrl(_0x264f24)?loadFontFilePreview(_0x264f24):showFontStatus('不支持的字体格式，请使用CSS链接或字体文件链接','error');}function applyGlobalFont(){const _0x7f191c=_0x211817,_0x22395e=document[_0x7f191c(0x1262)](_0x7f191c(0x316))[_0x7f191c(0x1ebc)][_0x7f191c(0x19d7)]();if(!_0x22395e){showFontStatus(_0x7f191c(0xc58),'error');return;}const _0x358605=document[_0x7f191c(0x1262)](_0x7f191c(0x6b9));_0x358605&&_0x358605['remove']();showFontStatus('正在应用字体...',_0x7f191c(0x477));if(isCSSFontUrl(_0x22395e))applyCSSFont(_0x22395e);else isFontFileUrl(_0x22395e)?applyFontFile(_0x22395e):showFontStatus(_0x7f191c(0x211e),_0x7f191c(0x174a));}function resetGlobalFont(){const _0x5e836b=_0x211817,_0x2aae4f=document['getElementById'](_0x5e836b(0x6b9));_0x2aae4f&&_0x2aae4f[_0x5e836b(0x1493)]();const _0x55e8a8=document[_0x5e836b(0x1262)]('global-font-preview');_0x55e8a8&&_0x55e8a8[_0x5e836b(0x1493)]();const _0x31b00e=document[_0x5e836b(0x1262)](_0x5e836b(0x1f51));_0x31b00e&&_0x31b00e['remove'](),document[_0x5e836b(0x1da9)][_0x5e836b(0x14eb)]['fontFamily']=_0x5e836b(0x14ab),document[_0x5e836b(0x1262)](_0x5e836b(0x316))[_0x5e836b(0x1ebc)]='',globalFontSettings={'fontUrl':'','fontName':'','isApplied':![]},localStorage[_0x5e836b(0x3b2)](_0x5e836b(0xb4a)),showFontStatus(_0x5e836b(0x1c02),'success');}function isCSSFontUrl(_0x299244){const _0x2413d8=_0x211817;return _0x299244[_0x2413d8(0x1831)]('fonts.googleapis.com')||_0x299244['includes'](_0x2413d8(0x15ab))||_0x299244[_0x2413d8(0x81f)](_0x2413d8(0x501))||_0x299244[_0x2413d8(0x1831)](_0x2413d8(0xd47))||_0x299244[_0x2413d8(0x1831)]('zeoseven.com')||_0x299244[_0x2413d8(0x1831)](_0x2413d8(0x2166));}function isFontFileUrl(_0x2c50d9){const _0x623ff5=_0x211817;return _0x2c50d9[_0x623ff5(0x81f)](_0x623ff5(0x877))||_0x2c50d9['endsWith'](_0x623ff5(0x2bd))||_0x2c50d9[_0x623ff5(0x81f)]('.woff')||_0x2c50d9[_0x623ff5(0x81f)](_0x623ff5(0xb36));}function loadCSSFontPreview(_0x290656){const _0x455465=_0x211817,_0x1dd14c=document[_0x455465(0xac6)]('link');_0x1dd14c['id']=_0x455465(0x8d0),_0x1dd14c['rel']='stylesheet',_0x1dd14c[_0x455465(0x1f9)]=_0x290656,_0x1dd14c[_0x455465(0x98e)]=_0x455465(0xf88),_0x1dd14c['onload']=function(){const _0x13b912=_0x455465;console[_0x13b912(0x2187)]('🎨\x20CSS字体预览加载成功'),setTimeout(()=>{const _0x5401f1=_0x13b912;let _0xde17a0=extractFontNameFromCSS(_0x290656);try{const _0x320c52=document[_0x5401f1(0x25a)];for(let _0x5eb69f=_0x320c52[_0x5401f1(0x19ee)]-0x1;_0x5eb69f>=0x0;_0x5eb69f--){const _0x300cfe=_0x320c52[_0x5eb69f];if(_0x300cfe[_0x5401f1(0x1f9)]===_0x290656){try{const _0x1ba59b=_0x300cfe[_0x5401f1(0x13a4)]||_0x300cfe[_0x5401f1(0x17e4)];for(let _0x2850d7=0x0;_0x2850d7<_0x1ba59b[_0x5401f1(0x19ee)];_0x2850d7++){const _0xe3a8b8=_0x1ba59b[_0x2850d7];if(_0xe3a8b8[_0x5401f1(0x1a4b)]===CSSRule[_0x5401f1(0x639)]&&_0xe3a8b8[_0x5401f1(0x14eb)]['fontFamily']){_0xde17a0=_0xe3a8b8['style']['fontFamily'][_0x5401f1(0xe16)](/['"]/g,''),console[_0x5401f1(0x2187)](_0x5401f1(0x1d1c),_0xde17a0);break;}}}catch(_0x44b41c){console[_0x5401f1(0x2187)](_0x5401f1(0x137e));}break;}}}catch(_0x14d4bb){console[_0x5401f1(0x2187)](_0x5401f1(0x4fe));}const _0x2a92fe=document[_0x5401f1(0x1262)](_0x5401f1(0x54c));_0x2a92fe&&(_0x2a92fe[_0x5401f1(0x14eb)][_0x5401f1(0x1d58)]='\x27'+_0xde17a0+'\x27,\x20sans-serif'),showFontStatus(_0x5401f1(0x1907)+_0xde17a0,_0x5401f1(0x11cb));},0x1f4);},_0x1dd14c[_0x455465(0x21ec)]=function(){const _0x33bcdf=_0x455465;showFontStatus('字体CSS加载失败，请检查链接是否正确',_0x33bcdf(0x174a));},document[_0x455465(0x65a)][_0x455465(0x497)](_0x1dd14c);}function loadFontFilePreview(_0x40ac7b){const _0x58e5ec=_0x211817,_0x5d58f4='GlobalPreviewFont_'+Date[_0x58e5ec(0x2eb)](),_0x458647=document['createElement'](_0x58e5ec(0x14eb));_0x458647['id']=_0x58e5ec(0x8d0);let _0x11bc03=_0x58e5ec(0x6c3);if(_0x40ac7b[_0x58e5ec(0x81f)]('.woff'))_0x11bc03='woff';if(_0x40ac7b[_0x58e5ec(0x81f)](_0x58e5ec(0xb36)))_0x11bc03=_0x58e5ec(0x16df);if(_0x40ac7b[_0x58e5ec(0x81f)](_0x58e5ec(0x2bd)))_0x11bc03=_0x58e5ec(0x91e);_0x458647['textContent']=_0x58e5ec(0x1365)+_0x5d58f4+_0x58e5ec(0x549)+_0x40ac7b+'\x27)\x20format(\x27'+_0x11bc03+_0x58e5ec(0x5eb),document[_0x58e5ec(0x65a)][_0x58e5ec(0x497)](_0x458647),setTimeout(()=>{const _0x4d4a02=_0x58e5ec,_0x2ce31d=document['getElementById'](_0x4d4a02(0x54c));_0x2ce31d&&(_0x2ce31d[_0x4d4a02(0x14eb)][_0x4d4a02(0x1d58)]='\x27'+_0x5d58f4+'\x27,\x20sans-serif'),showFontStatus('字体预览已加载：'+_0x5d58f4,_0x4d4a02(0x11cb));},0x1f4);}function applyCSSFont(_0x45f8d2){const _0x2828cd=_0x211817,_0x5a46dc=document[_0x2828cd(0xac6)](_0x2828cd(0x9d6));_0x5a46dc['id']=_0x2828cd(0x6b9),_0x5a46dc[_0x2828cd(0xfcb)]=_0x2828cd(0x18bd),_0x5a46dc[_0x2828cd(0x1f9)]=_0x45f8d2,_0x5a46dc[_0x2828cd(0x98e)]=_0x2828cd(0xf88),_0x5a46dc[_0x2828cd(0xc55)]=function(){const _0x57c04a=_0x2828cd;console[_0x57c04a(0x2187)](_0x57c04a(0xfcf)),setTimeout(()=>{const _0x36b29a=_0x57c04a;let _0x3758a3=extractFontNameFromCSS(_0x45f8d2);try{const _0x2c2be8=document[_0x36b29a(0x25a)];for(let _0x3410b5=_0x2c2be8['length']-0x1;_0x3410b5>=0x0;_0x3410b5--){const _0x1f65a6=_0x2c2be8[_0x3410b5];if(_0x1f65a6['href']===_0x45f8d2){try{const _0x1d44a3=_0x1f65a6[_0x36b29a(0x13a4)]||_0x1f65a6[_0x36b29a(0x17e4)];for(let _0x51e100=0x0;_0x51e100<_0x1d44a3[_0x36b29a(0x19ee)];_0x51e100++){const _0x738aa6=_0x1d44a3[_0x51e100];if(_0x738aa6[_0x36b29a(0x1a4b)]===CSSRule[_0x36b29a(0x639)]&&_0x738aa6[_0x36b29a(0x14eb)][_0x36b29a(0x1d58)]){_0x3758a3=_0x738aa6[_0x36b29a(0x14eb)][_0x36b29a(0x1d58)][_0x36b29a(0xe16)](/['"]/g,''),console[_0x36b29a(0x2187)]('🎨\x20从CSS中提取到真实字体名称:',_0x3758a3);break;}}}catch(_0x484a46){console[_0x36b29a(0x2187)](_0x36b29a(0x137e));}break;}}}catch(_0x1d79df){console[_0x36b29a(0x2187)](_0x36b29a(0x4fe));}applyFontToElements(_0x3758a3),globalFontSettings={'fontUrl':_0x45f8d2,'fontName':_0x3758a3,'isApplied':!![]},localStorage['setItem']('globalCustomFont',JSON[_0x36b29a(0x6b8)](globalFontSettings)),showFontStatus(_0x36b29a(0x53b)+_0x3758a3,'success');},0x1f4);},_0x5a46dc[_0x2828cd(0x21ec)]=function(){const _0x4d4734=_0x2828cd;showFontStatus('字体CSS加载失败，请检查链接是否正确',_0x4d4734(0x174a));},document[_0x2828cd(0x65a)]['appendChild'](_0x5a46dc);}function applyFontFile(_0x11aa2e){const _0x5df713=_0x211817,_0x422308='GlobalCustomFont_'+Date['now'](),_0x5e3ffa=document[_0x5df713(0xac6)]('style');_0x5e3ffa['id']=_0x5df713(0x6b9);let _0x4ac8bf=_0x5df713(0x6c3);if(_0x11aa2e[_0x5df713(0x81f)](_0x5df713(0x205)))_0x4ac8bf=_0x5df713(0x11da);if(_0x11aa2e[_0x5df713(0x81f)]('.woff2'))_0x4ac8bf='woff2';if(_0x11aa2e['endsWith'](_0x5df713(0x2bd)))_0x4ac8bf=_0x5df713(0x91e);_0x5e3ffa[_0x5df713(0x13be)]=_0x5df713(0x1365)+_0x422308+_0x5df713(0x549)+_0x11aa2e+'\x27)\x20format(\x27'+_0x4ac8bf+_0x5df713(0x5eb),document[_0x5df713(0x65a)][_0x5df713(0x497)](_0x5e3ffa),setTimeout(()=>{const _0x41ed45=_0x5df713;applyFontToElements(_0x422308),globalFontSettings={'fontUrl':_0x11aa2e,'fontName':_0x422308,'isApplied':!![]},localStorage['setItem'](_0x41ed45(0xb4a),JSON[_0x41ed45(0x6b8)](globalFontSettings)),showFontStatus('字体已应用：'+_0x422308,_0x41ed45(0x11cb));},0x1f4);}function extractFontNameFromCSS(_0x250f5e){const _0x7eb088=_0x211817;if(_0x250f5e[_0x7eb088(0x1831)]('fonts.googleapis.com')||_0x250f5e[_0x7eb088(0x1831)]('fonts.google.com')){const _0x4c2392=_0x250f5e[_0x7eb088(0x1b87)](/family=([^&:]+)/);if(_0x4c2392)return decodeURIComponent(_0x4c2392[0x1][_0x7eb088(0xe16)](/\+/g,'\x20'));}if(_0x250f5e[_0x7eb088(0x1831)](_0x7eb088(0xe4a)))return'ChillKai';if(_0x250f5e[_0x7eb088(0x1831)](_0x7eb088(0xd47)))return _0x7eb088(0x1f47);return _0x7eb088(0x1f47);}function applyFontToElements(_0x5aa221){const _0x39e0ac=_0x211817;console[_0x39e0ac(0x2187)](_0x39e0ac(0x172e),_0x5aa221),document['body']['style'][_0x39e0ac(0x1d58)]='\x27'+_0x5aa221+'\x27,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif';const _0x41baf7=document[_0x39e0ac(0x1262)](_0x39e0ac(0x1f51));_0x41baf7&&_0x41baf7[_0x39e0ac(0x1493)]();const _0x49c8dd=document[_0x39e0ac(0xac6)](_0x39e0ac(0x14eb));_0x49c8dd['id']='global-font-override',_0x49c8dd[_0x39e0ac(0x13be)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20/*\x20🔥【修复】只对文字内容应用字体，不影响图标\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+_0x5aa221+_0x39e0ac(0xc47)+_0x5aa221+_0x39e0ac(0xc32),document[_0x39e0ac(0x65a)][_0x39e0ac(0x497)](_0x49c8dd),console[_0x39e0ac(0x2187)]('✅\x20全局字体已应用到所有元素');}function showFontStatus(_0x1da324,_0x470b54){const _0x4cd21a=_0x211817,_0x5722df=document[_0x4cd21a(0x1262)]('global-font-status'),_0x49be1d=_0x5722df[_0x4cd21a(0xb30)](_0x4cd21a(0x1967));_0x5722df[_0x4cd21a(0x1722)]=_0x4cd21a(0x1fee)+_0x470b54,_0x49be1d[_0x4cd21a(0x13be)]=_0x1da324,_0x5722df[_0x4cd21a(0x14eb)][_0x4cd21a(0x4da)]=_0x4cd21a(0x13de),(_0x470b54===_0x4cd21a(0x11cb)||_0x470b54==='info')&&setTimeout(()=>{const _0x354895=_0x4cd21a;_0x5722df[_0x354895(0x14eb)][_0x354895(0x4da)]=_0x354895(0x102b);},0xbb8);}function loadGlobalFontSettings(){const _0x58361c=_0x211817,_0x3fd9ec=localStorage['getItem'](_0x58361c(0xb4a));if(_0x3fd9ec)try{globalFontSettings=JSON[_0x58361c(0x22d3)](_0x3fd9ec);if(globalFontSettings[_0x58361c(0x101c)]){const _0x244eaa=document[_0x58361c(0x1262)]('global-font-url');_0x244eaa&&(_0x244eaa[_0x58361c(0x1ebc)]=globalFontSettings[_0x58361c(0x101c)]);if(globalFontSettings[_0x58361c(0xedb)]){if(isCSSFontUrl(globalFontSettings[_0x58361c(0x101c)]))applyCSSFont(globalFontSettings[_0x58361c(0x101c)]);else isFontFileUrl(globalFontSettings[_0x58361c(0x101c)])&&applyFontFile(globalFontSettings[_0x58361c(0x101c)]);}}}catch(_0x28a148){console[_0x58361c(0x174a)]('加载全局字体设置失败:',_0x28a148);}}function triggerVoiceMessage(){const _0x337cbb=_0x211817;showToast(_0x337cbb(0x1aae),_0x337cbb(0x477));}async function openCamera(){const _0x14cb39=_0x211817;if(!currentChatCharacter){showToast(_0x14cb39(0x1f19),_0x14cb39(0x174a));return;}const _0xb8278e=await showCustomPrompt('发送照片',_0x14cb39(0x14c8));if(_0xb8278e&&_0xb8278e[_0x14cb39(0x19d7)]()){const _0xbcd4a0={'id':Date[_0x14cb39(0x2eb)]()['toString'](),'sender':_0x14cb39(0x1e6d),'type':'user_photo','content':_0xb8278e[_0x14cb39(0x19d7)](),'timestamp':Date[_0x14cb39(0x2eb)](),'photoDescription':_0xb8278e[_0x14cb39(0x19d7)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x14cb39(0x1cd6)](_0xbcd4a0);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console['log'](_0x14cb39(0xab1));}catch(_0xb59198){console['error'](_0x14cb39(0x14e8),_0xb59198),await saveChatMessages();}renderChatMessages(currentChatCharacter['id']),renderMessageList(),showToast('照片已发送','success');}}function openTransfer(){const _0x367ff5=_0x211817;if(!currentChatCharacter){showToast('请先选择聊天对象',_0x367ff5(0x1816));return;}document[_0x367ff5(0x1262)](_0x367ff5(0x1050))[_0x367ff5(0x1c1b)][_0x367ff5(0x21e2)](_0x367ff5(0x85c));}let isInCall=![],callTimer=null,callStartTime=null,callDuration=0x0,isMuted=![],isSpeakerOn=![],currentCallCharacter=null,isInVideoCall=![],videoCallTimer=null,videoCallStartTime=null,videoCallDuration=0x0,isVideoMuted=![],isVideoCameraOff=![],currentVideoCallCharacter=null;function generateMessageId(){const _0x3acb65=_0x211817;return Date[_0x3acb65(0x2eb)]()['toString']()+Math[_0x3acb65(0x2180)](Math['random']()*0x3e8)[_0x3acb65(0x1878)]();}async function addMessageToChat(_0x529974){const _0x3f115f=_0x211817;if(!currentChatCharacter)return;const _0x882391=currentChatCharacter['id'];!chatMessages[_0x882391]&&(chatMessages[_0x882391]=[]);chatMessages[_0x882391]['push'](_0x529974);try{const _0x2da9ba=_0x882391+'_'+_0x529974['id']+'_'+(chatMessages[_0x882391][_0x3f115f(0x19ee)]-0x1);await db[_0x3f115f(0x19a2)][_0x3f115f(0x21e2)]({'id':_0x2da9ba,'characterId':_0x882391,'timestamp':_0x529974['timestamp'],'messageOrder':chatMessages[_0x882391]['length']-0x1,'originalMessageId':_0x529974['id'],'messageData':_0x529974}),console['log'](_0x3f115f(0x444));}catch(_0x2cc7ee){console[_0x3f115f(0x174a)]('通话消息单条保存失败，回退到批量保存:',_0x2cc7ee),saveChatMessages();}renderChatMessages(_0x882391);}function makeCall(){const _0xe1c2c9=_0x211817;if(!currentChatCharacter){showToast(_0xe1c2c9(0x1346),_0xe1c2c9(0x174a));return;}if(currentChatCharacter['isGroup']){showToast(_0xe1c2c9(0x227c),_0xe1c2c9(0x174a));return;}SoundManager[_0xe1c2c9(0xaa5)](SoundManager[_0xe1c2c9(0xf4e)]['OUTGOING_CALL'],currentChatCharacter?.['id']);const _0x5b706d=getCurrentChatSettings();console[_0xe1c2c9(0x2187)](_0xe1c2c9(0xb3f),_0x5b706d[_0xe1c2c9(0x1f45)]),currentCallCharacter=currentChatCharacter;const _0x5a93c8=currentCallCharacter[_0xe1c2c9(0x1f8a)]||currentCallCharacter[_0xe1c2c9(0x1994)]||_0xe1c2c9(0x400);document['getElementById'](_0xe1c2c9(0x13f3))[_0xe1c2c9(0x45c)]=_0x5a93c8,document[_0xe1c2c9(0x1262)](_0xe1c2c9(0x2150))[_0xe1c2c9(0x13be)]=currentCallCharacter[_0xe1c2c9(0x1a1c)],document[_0xe1c2c9(0x1262)]('call-status')[_0xe1c2c9(0x13be)]=_0xe1c2c9(0x308),document[_0xe1c2c9(0x1262)]('call-timer')[_0xe1c2c9(0x13be)]=_0xe1c2c9(0x73f),document[_0xe1c2c9(0x1262)](_0xe1c2c9(0xf02))[_0xe1c2c9(0x33a)]='',showApp(_0xe1c2c9(0x1c1d)),startCallTimer(),isInCall=!![];const _0x5cea60={'id':generateMessageId(),'sender':_0xe1c2c9(0x1744),'content':currentCallCharacter[_0xe1c2c9(0x1a1c)]+'已接通语音电话','timestamp':Date[_0xe1c2c9(0x2eb)](),'type':_0xe1c2c9(0x1e64),'callType':_0xe1c2c9(0x1e40),'callStatus':'started'};addMessageToChat(_0x5cea60),window[_0xe1c2c9(0x2ea)]=!![];}async function initiateAICall(_0x27de6f,_0x6062c6){const _0x40d8f6=_0x211817;if(isInCall)return;currentCallCharacter=_0x27de6f,isInCall=!![];const _0x138ea6={'id':generateMessageId(),'sender':_0x40d8f6(0x1744),'content':_0x27de6f[_0x40d8f6(0x1a1c)]+_0x40d8f6(0x1afb),'timestamp':Date['now'](),'type':_0x40d8f6(0x1e64),'callType':_0x40d8f6(0x186a),'callStatus':_0x40d8f6(0x193f)};addMessageToChat(_0x138ea6),SoundManager[_0x40d8f6(0xaa5)](SoundManager['TYPES']['INCOMING_CALL'],_0x27de6f?.['id']);const _0x56d711=document[_0x40d8f6(0x1897)]('.app-screen');let _0x316eba=null;_0x56d711[_0x40d8f6(0x19fb)](_0xb98b88=>{const _0x3d7527=_0x40d8f6;(_0xb98b88[_0x3d7527(0x14eb)][_0x3d7527(0x4da)]===_0x3d7527(0x1fb7)||_0xb98b88[_0x3d7527(0x14eb)][_0x3d7527(0x4da)]===_0x3d7527(0x13de))&&(_0x316eba=_0xb98b88['id']);});if(!_0x316eba){const _0xdbdb2b=document[_0x40d8f6(0x1262)]('clock-container'),_0x559a48=document[_0x40d8f6(0x1262)](_0x40d8f6(0x224));_0xdbdb2b&&_0xdbdb2b[_0x40d8f6(0x14eb)]['display']!==_0x40d8f6(0x102b)&&_0x559a48&&_0x559a48[_0x40d8f6(0x14eb)]['display']!==_0x40d8f6(0x102b)&&(_0x316eba='home-screen');}window[_0x40d8f6(0x6f9)]=_0x316eba||'api-chat-screen';let _0x497988='';try{const _0x3ad0d1='你是'+_0x27de6f['name']+_0x40d8f6(0x1579),_0x26e79a=await callChatAPI(_0x3ad0d1,_0x27de6f),_0x47cf2e=await parseAiResponse(_0x26e79a);console['log']('🔔\x20开场白AI回复解析结果:',_0x47cf2e);if(Array[_0x40d8f6(0x1496)](_0x47cf2e)&&_0x47cf2e[_0x40d8f6(0x19ee)]>0x0){const _0x755a84=_0x47cf2e['find'](_0x45d156=>typeof _0x45d156===_0x40d8f6(0x11b7));if(_0x755a84)_0x497988=_0x755a84[_0x40d8f6(0x19d7)]();else{const _0x5810c3=_0x47cf2e[0x0];typeof _0x5810c3===_0x40d8f6(0x28d)&&_0x5810c3[_0x40d8f6(0x211c)]&&(_0x497988=_0x5810c3['content']['trim']());}}else typeof _0x26e79a===_0x40d8f6(0x11b7)&&(_0x497988=cleanCallResponse(_0x26e79a)[_0x40d8f6(0x19d7)]());(!_0x497988||_0x497988[_0x40d8f6(0x19ee)]>0x1e)&&(_0x497988=_0x6062c6||_0x40d8f6(0x5e5));}catch(_0x56325a){console[_0x40d8f6(0x174a)](_0x40d8f6(0x175e),_0x56325a),_0x497988=_0x6062c6||_0x40d8f6(0x5e5);}const _0x440eed=_0x27de6f['avatar']||_0x27de6f['avatarUrl']||_0x40d8f6(0x400);document[_0x40d8f6(0x1262)](_0x40d8f6(0xe9d))[_0x40d8f6(0x45c)]=_0x440eed,document[_0x40d8f6(0x1262)](_0x40d8f6(0x1524))[_0x40d8f6(0x13be)]=_0x27de6f[_0x40d8f6(0x1a1c)],document[_0x40d8f6(0x1262)]('incoming-call-text')[_0x40d8f6(0x13be)]=_0x497988,window[_0x40d8f6(0x201)]=_0x497988,document[_0x40d8f6(0x1262)]('incoming-call-avatar')['classList'][_0x40d8f6(0x21e2)](_0x40d8f6(0x22f2)),showApp('incoming-call-screen'),setTimeout(()=>{const _0x14ceac=_0x40d8f6;document[_0x14ceac(0x1262)](_0x14ceac(0x936))[_0x14ceac(0x14eb)][_0x14ceac(0x4da)]!==_0x14ceac(0x102b)&&rejectCall();},0x7530);}async function initiateAIVideoCall(_0x2b6a38,_0x151072){const _0x95e752=_0x211817;if(isInVideoCall)return;currentVideoCallCharacter=_0x2b6a38,isInVideoCall=!![];const _0x183f03={'id':generateMessageId(),'sender':_0x95e752(0x1744),'content':_0x2b6a38['name']+_0x95e752(0x1afb),'timestamp':Date[_0x95e752(0x2eb)](),'type':_0x95e752(0x1e64),'callType':'incoming_video','callStatus':_0x95e752(0x193f)};addMessageToChat(_0x183f03),SoundManager['play'](SoundManager[_0x95e752(0xf4e)][_0x95e752(0xd60)],_0x2b6a38?.['id']);const _0x2c60f7=document[_0x95e752(0x1897)]('.app-screen');let _0x343620=null;_0x2c60f7[_0x95e752(0x19fb)](_0x84f213=>{const _0x530577=_0x95e752;(_0x84f213[_0x530577(0x14eb)][_0x530577(0x4da)]==='flex'||_0x84f213['style']['display']===_0x530577(0x13de))&&(_0x343620=_0x84f213['id']);});if(!_0x343620){const _0x5ae828=document[_0x95e752(0x1262)](_0x95e752(0x1b73)),_0x15ed77=document['getElementById'](_0x95e752(0x224));_0x5ae828&&_0x5ae828['style']['display']!=='none'&&_0x15ed77&&_0x15ed77[_0x95e752(0x14eb)][_0x95e752(0x4da)]!==_0x95e752(0x102b)&&(_0x343620=_0x95e752(0x1e0c));}window['previousScreenBeforeVideoCall']=_0x343620||_0x95e752(0xcf2);let _0x49a622='';try{const _0x2f119f='你是'+_0x2b6a38[_0x95e752(0x1a1c)]+_0x95e752(0x32d),_0xa1c601=await callChatAPI(_0x2f119f,_0x2b6a38),_0x12ae70=await parseAiResponse(_0xa1c601);console[_0x95e752(0x2187)]('🔔\x20视频通话开场白AI回复解析结果:',_0x12ae70);if(Array['isArray'](_0x12ae70)&&_0x12ae70[_0x95e752(0x19ee)]>0x0){const _0xbca75f=_0x12ae70[_0x95e752(0xaf4)](_0x4e10bc=>typeof _0x4e10bc===_0x95e752(0x11b7));if(_0xbca75f)_0x49a622=_0xbca75f[_0x95e752(0x19d7)]();else{const _0x351f92=_0x12ae70[0x0];typeof _0x351f92===_0x95e752(0x28d)&&_0x351f92[_0x95e752(0x211c)]&&(_0x49a622=_0x351f92[_0x95e752(0x211c)]['trim']());}}else typeof _0xa1c601===_0x95e752(0x11b7)&&(_0x49a622=cleanCallResponse(_0xa1c601)[_0x95e752(0x19d7)]());(!_0x49a622||_0x49a622[_0x95e752(0x19ee)]>0x1e)&&(_0x49a622=_0x151072||_0x95e752(0x1ba2));}catch(_0x24160d){console[_0x95e752(0x174a)](_0x95e752(0x1979),_0x24160d),_0x49a622=_0x151072||_0x95e752(0x1ba2);}const _0x4f68ec=_0x2b6a38[_0x95e752(0x1f8a)]||_0x2b6a38['avatarUrl']||_0x95e752(0x400);document['getElementById'](_0x95e752(0x1aa1))['src']=_0x4f68ec,document[_0x95e752(0x1262)](_0x95e752(0x8c8))[_0x95e752(0x13be)]=_0x2b6a38['name'],document[_0x95e752(0x1262)]('incoming-video-call-text')[_0x95e752(0x13be)]=_0x49a622,window['aiVideoCallGreeting']=_0x49a622,document[_0x95e752(0x1262)](_0x95e752(0x1aa1))[_0x95e752(0x1c1b)][_0x95e752(0x21e2)](_0x95e752(0x22f2)),showApp(_0x95e752(0x1858)),setTimeout(()=>{const _0x16428e=_0x95e752;document[_0x16428e(0x1262)](_0x16428e(0x1858))[_0x16428e(0x14eb)]['display']!==_0x16428e(0x102b)&&rejectVideoCall();},0x7530);}function acceptVideoCall(){const _0xd19683=_0x211817;SoundManager[_0xd19683(0x22cc)](SoundManager[_0xd19683(0xf4e)]['INCOMING_CALL']),document[_0xd19683(0x1262)](_0xd19683(0x1aa1))['classList'][_0xd19683(0x1493)](_0xd19683(0x22f2)),hideApp(_0xd19683(0x1858));const _0x3d796d=getVideoAvatarSettings(),_0x4872c8=_0x3d796d['characterAvatar']||currentVideoCallCharacter[_0xd19683(0x1f8a)]||currentVideoCallCharacter[_0xd19683(0x1994)]||'data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightgray\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22gray\x22>头像</text></svg>',_0x414dce=_0x3d796d[_0xd19683(0x865)]||_0xd19683(0x5e7);document['getElementById']('video-call-character-avatar')['src']=_0x4872c8,document[_0xd19683(0x1262)](_0xd19683(0x1218))['src']=_0x414dce,document[_0xd19683(0x1262)](_0xd19683(0x8db))[_0xd19683(0x13be)]=currentVideoCallCharacter['name'],document[_0xd19683(0x1262)](_0xd19683(0x11ef))[_0xd19683(0x13be)]=_0xd19683(0x20e4),document[_0xd19683(0x1262)](_0xd19683(0x1f85))['textContent']=_0xd19683(0x73f);const _0x47668a=document[_0xd19683(0x1262)](_0xd19683(0x387));_0x47668a&&(_0x47668a[_0xd19683(0x33a)]='');showApp(_0xd19683(0x1fca)),startVideoCallTimer(),isInVideoCall=!![],isVideoMuted=![],isVideoCameraOff=![],updateVideoCallButtons();const _0x2fed04={'id':generateMessageId(),'sender':_0xd19683(0x1744),'content':_0xd19683(0x919)+currentVideoCallCharacter[_0xd19683(0x1a1c)]+_0xd19683(0x1b14),'timestamp':Date[_0xd19683(0x2eb)](),'type':'call_record','callType':_0xd19683(0x186a),'callStatus':_0xd19683(0xdfc)};addMessageToChat(_0x2fed04),window[_0xd19683(0x1f01)]&&setTimeout(()=>{const _0x4eafec=_0xd19683;addVideoCallMessage(window[_0x4eafec(0x1f01)],'received'),window[_0x4eafec(0x1f01)]=null;},0x3e8),window[_0xd19683(0x5d4)]=null;}function rejectVideoCall(){const _0x4e4cd8=_0x211817;SoundManager[_0x4e4cd8(0x22cc)](SoundManager[_0x4e4cd8(0xf4e)][_0x4e4cd8(0xd60)]),document[_0x4e4cd8(0x1262)]('incoming-video-call-avatar')[_0x4e4cd8(0x1c1b)]['remove'](_0x4e4cd8(0x22f2)),hideApp('incoming-video-call-screen');const _0x42a7f8=window[_0x4e4cd8(0x5d4)];if(_0x42a7f8&&_0x42a7f8!==_0x4e4cd8(0x1e0c))showApp(_0x42a7f8);else{if(_0x42a7f8===_0x4e4cd8(0x1e0c)){const _0xc1d7b2=document[_0x4e4cd8(0x1262)](_0x4e4cd8(0x1b73)),_0x39e8a5=document['getElementById'](_0x4e4cd8(0x224)),_0x1eef75=document[_0x4e4cd8(0x1262)](_0x4e4cd8(0x1523));if(_0xc1d7b2)_0xc1d7b2[_0x4e4cd8(0x14eb)][_0x4e4cd8(0x4da)]=_0x4e4cd8(0x13de);if(_0x39e8a5)_0x39e8a5['style'][_0x4e4cd8(0x4da)]=_0x4e4cd8(0xc00);if(_0x1eef75)_0x1eef75[_0x4e4cd8(0x14eb)][_0x4e4cd8(0x4da)]=_0x4e4cd8(0x13de);}else showApp('api-chat-screen');}const _0x182fc0={'id':generateMessageId(),'sender':_0x4e4cd8(0x1744),'content':_0x4e4cd8(0x17d8)+currentVideoCallCharacter['name']+_0x4e4cd8(0x5fb),'timestamp':Date[_0x4e4cd8(0x2eb)](),'type':_0x4e4cd8(0x1e64),'callType':'incoming','callStatus':'rejected'};addMessageToChat(_0x182fc0),currentVideoCallCharacter=null,window[_0x4e4cd8(0x1f01)]=null,window[_0x4e4cd8(0x5d4)]=null;}function acceptCall(){const _0x5e0c58=_0x211817;SoundManager[_0x5e0c58(0x22cc)](SoundManager['TYPES'][_0x5e0c58(0xd60)]),document[_0x5e0c58(0x1262)]('incoming-call-avatar')['classList'][_0x5e0c58(0x1493)]('ringing-animation'),hideApp(_0x5e0c58(0x936));const _0x2b63e5=currentCallCharacter[_0x5e0c58(0x1f8a)]||currentCallCharacter['avatarUrl']||_0x5e0c58(0x400);document[_0x5e0c58(0x1262)](_0x5e0c58(0x13f3))[_0x5e0c58(0x45c)]=_0x2b63e5,document[_0x5e0c58(0x1262)](_0x5e0c58(0x2150))[_0x5e0c58(0x13be)]=currentCallCharacter[_0x5e0c58(0x1a1c)],document[_0x5e0c58(0x1262)]('call-status')[_0x5e0c58(0x13be)]=_0x5e0c58(0x308),document['getElementById']('call-timer')[_0x5e0c58(0x13be)]=_0x5e0c58(0x73f),document[_0x5e0c58(0x1262)]('call-message-container')[_0x5e0c58(0x33a)]='',showApp(_0x5e0c58(0x1c1d)),startCallTimer(),isInCall=!![];const _0xd5dc4e={'id':generateMessageId(),'sender':'system','content':_0x5e0c58(0x919)+currentCallCharacter[_0x5e0c58(0x1a1c)]+_0x5e0c58(0x2271),'timestamp':Date[_0x5e0c58(0x2eb)](),'type':_0x5e0c58(0x1e64),'callType':_0x5e0c58(0x186a),'callStatus':_0x5e0c58(0xdfc)};addMessageToChat(_0xd5dc4e),setTimeout(()=>{const _0x3fdb44=_0x5e0c58;let _0x4a2cae=window['aiCallGreeting']||getRandomCallGreeting(currentCallCharacter[_0x3fdb44(0x1a1c)]);addCallMessage(_0x4a2cae,_0x3fdb44(0xb11)),window[_0x3fdb44(0x201)]=null;},0x3e8),window[_0x5e0c58(0x6f9)]=null;}function rejectCall(){const _0x1ed0b6=_0x211817;SoundManager[_0x1ed0b6(0x22cc)](SoundManager[_0x1ed0b6(0xf4e)][_0x1ed0b6(0xd60)]),document[_0x1ed0b6(0x1262)](_0x1ed0b6(0xe9d))['classList'][_0x1ed0b6(0x1493)](_0x1ed0b6(0x22f2)),hideApp(_0x1ed0b6(0x936));const _0x21bfe7=window['previousScreenBeforeCall'];if(_0x21bfe7&&_0x21bfe7!==_0x1ed0b6(0x1e0c))showApp(_0x21bfe7);else{if(_0x21bfe7===_0x1ed0b6(0x1e0c)){const _0xe17907=document[_0x1ed0b6(0x1262)](_0x1ed0b6(0x1b73)),_0x3eb06a=document[_0x1ed0b6(0x1262)]('home-grid'),_0xbf6a90=document[_0x1ed0b6(0x1262)](_0x1ed0b6(0x1523));if(_0xe17907)_0xe17907['style'][_0x1ed0b6(0x4da)]=_0x1ed0b6(0x13de);if(_0x3eb06a)_0x3eb06a[_0x1ed0b6(0x14eb)][_0x1ed0b6(0x4da)]='grid';if(_0xbf6a90)_0xbf6a90[_0x1ed0b6(0x14eb)][_0x1ed0b6(0x4da)]=_0x1ed0b6(0x13de);}else showApp(_0x1ed0b6(0xcf2));}const _0x19749b={'id':generateMessageId(),'sender':'system','content':_0x1ed0b6(0x17d8)+currentCallCharacter['name']+_0x1ed0b6(0x1f13),'timestamp':Date['now'](),'type':_0x1ed0b6(0x1e64),'callType':_0x1ed0b6(0x186a),'callStatus':_0x1ed0b6(0xd3b)};addMessageToChat(_0x19749b),currentCallCharacter=null,window['previousScreenBeforeCall']=null;}function endCall(){const _0x30cee0=_0x211817;if(!isInCall)return;stopCallTimer(),hideApp(_0x30cee0(0x1c1d)),showApp(_0x30cee0(0xcf2));const _0x1ddf36=formatCallDuration(callDuration),_0x30a684={'id':generateMessageId(),'sender':'system','content':_0x30cee0(0xf39)+_0x1ddf36,'timestamp':Date['now'](),'type':'call_record','callType':'ended','callStatus':_0x30cee0(0x1743),'duration':_0x1ddf36};addMessageToChat(_0x30a684),isInCall=![],isMuted=![],isSpeakerOn=![],currentCallCharacter=null;}function toggleMute(){const _0x6bc165=_0x211817;isMuted=!isMuted;const _0x5b5e1c=document[_0x6bc165(0x1262)](_0x6bc165(0x76c));isMuted?(_0x5b5e1c['classList']['add'](_0x6bc165(0x11f5)),_0x5b5e1c['innerHTML']='<i\x20class=\x22fas\x20fa-microphone-slash\x22></i>',showToast(_0x6bc165(0x592),'info')):(_0x5b5e1c[_0x6bc165(0x1c1b)][_0x6bc165(0x1493)](_0x6bc165(0x11f5)),_0x5b5e1c[_0x6bc165(0x33a)]='<i\x20class=\x22fas\x20fa-microphone\x22></i>',showToast(_0x6bc165(0x1abd),_0x6bc165(0x477)));}function toggleSpeaker(){const _0x120b93=_0x211817;isSpeakerOn=!isSpeakerOn;const _0x19e255=document['getElementById'](_0x120b93(0x1c75));isSpeakerOn?(_0x19e255[_0x120b93(0x1c1b)][_0x120b93(0x21e2)]('active'),showToast(_0x120b93(0x124a),'info')):(_0x19e255['classList'][_0x120b93(0x1493)](_0x120b93(0x1a14)),showToast('已关闭扬声器',_0x120b93(0x477)));}function startCallTimer(){callStartTime=new Date(),callDuration=0x0,callTimer=setInterval(()=>{const _0x9dfbb2=_0x167f;callDuration=Math[_0x9dfbb2(0x2180)]((new Date()-callStartTime)/0x3e8),document['getElementById'](_0x9dfbb2(0x57d))['textContent']=formatCallDuration(callDuration);},0x3e8);}function stopCallTimer(){callTimer&&(clearInterval(callTimer),callTimer=null);}function formatCallDuration(_0x5bd710){const _0x54d262=_0x211817,_0x27487e=Math[_0x54d262(0x2180)](_0x5bd710/0x3c),_0x2c164e=_0x5bd710%0x3c;return _0x27487e[_0x54d262(0x1878)]()[_0x54d262(0xdfe)](0x2,'0')+':'+_0x2c164e[_0x54d262(0x1878)]()[_0x54d262(0xdfe)](0x2,'0');}function sendCallMessage(){const _0x3e032a=_0x211817,_0x4e6322=document[_0x3e032a(0x1262)]('call-input');if(!_0x4e6322){console[_0x3e032a(0x174a)](_0x3e032a(0x5e4));return;}const _0x2d16ac=_0x4e6322[_0x3e032a(0x1ebc)]['trim']();if(!_0x2d16ac)return;addCallMessage(_0x2d16ac,_0x3e032a(0x1e6d)),_0x4e6322[_0x3e032a(0x1ebc)]='';const _0x1364c2=showCallTypingIndicator();currentCallCharacter&&setTimeout(async()=>{const _0x3a75f7=_0x3e032a;try{const _0x17e00f='你是'+currentCallCharacter[_0x3a75f7(0x1a1c)]+_0x3a75f7(0x1a19)+_0x2d16ac+'\x22\x0a\x0a请用简短自然的口语方式回复，就像真实的电话对话一样：\x0a-\x20直接说话，不要任何描述性文字\x0a-\x20保持自然的语音对话风格\x0a-\x20回复要简洁，1-2句话即可\x0a-\x20符合你的性格设定\x0a\x0a请只回复对话内容，不要JSON格式，不要其他格式：';try{const _0x3bb75c=await callChatAPI(_0x17e00f,currentCallCharacter);hideCallTypingIndicator(_0x1364c2);const _0x2d3683=await parseAiResponse(_0x3bb75c);console[_0x3a75f7(0x2187)](_0x3a75f7(0x1e45),_0x2d3683);let _0xb20bd2=![];if(Array['isArray'](_0x2d3683)&&_0x2d3683[_0x3a75f7(0x19ee)]>0x0)for(const _0x598bf of _0x2d3683){let _0x56c7f0='';if(typeof _0x598bf===_0x3a75f7(0x11b7))_0x56c7f0=_0x598bf[_0x3a75f7(0x19d7)]();else typeof _0x598bf===_0x3a75f7(0x28d)&&_0x598bf[_0x3a75f7(0x211c)]&&(_0x56c7f0=_0x598bf['content']['trim']());_0x56c7f0&&(addCallMessage(_0x56c7f0,_0x3a75f7(0xb11)),_0xb20bd2=!![],await new Promise(_0x53a3a9=>setTimeout(_0x53a3a9,0x12c)));}if(!_0xb20bd2){if(typeof _0x3bb75c===_0x3a75f7(0x11b7)){const _0x2027d0=cleanCallResponse(_0x3bb75c);_0x2027d0?addCallMessage(_0x2027d0,'received'):addCallMessage(getRandomCallResponse(),'received');}else addCallMessage(getRandomCallResponse(),_0x3a75f7(0xb11));}}catch(_0x396b1b){console['error'](_0x3a75f7(0x897),_0x396b1b),hideCallTypingIndicator(_0x1364c2),addCallMessage(getRandomCallResponse(),_0x3a75f7(0xb11));}}catch(_0x2386df){console[_0x3a75f7(0x174a)]('通话回复错误:',_0x2386df),hideCallTypingIndicator(_0x1364c2),addCallMessage(_0x3a75f7(0x187e),_0x3a75f7(0xb11));}},0x3e8+Math[_0x3e032a(0x11a8)]()*0x3e8);}function addCallMessage(_0xe16dcc,_0x4afbbf){const _0x5c2d61=_0x211817,_0x15eee5=document['getElementById'](_0x5c2d61(0xf02)),_0x34a30d=document['createElement'](_0x5c2d61(0xbbc));_0x34a30d[_0x5c2d61(0x1722)]=_0x5c2d61(0x1fbf)+_0x4afbbf,_0x34a30d['textContent']=_0xe16dcc,_0x15eee5[_0x5c2d61(0x497)](_0x34a30d),_0x15eee5['scrollTop']=_0x15eee5[_0x5c2d61(0xfe3)];if(currentChatCharacter&&currentChatCharacter['id']){const _0x2d4019={'id':generateMessageId(),'sender':_0x4afbbf===_0x5c2d61(0x1e6d)?_0x5c2d61(0x1e6d):'received','content':_0xe16dcc,'timestamp':Date['now'](),'isCallMessage':!![],'type':_0x5c2d61(0x2023)};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]),chatMessages[currentChatCharacter['id']]['push'](_0x2d4019),saveChatMessages();}}function showCallTypingIndicator(){const _0x1ba63d=_0x211817,_0x385421=document[_0x1ba63d(0x1262)](_0x1ba63d(0xf02)),_0x5064ae=document['createElement'](_0x1ba63d(0xbbc));return _0x5064ae[_0x1ba63d(0x1722)]=_0x1ba63d(0x86d),_0x5064ae[_0x1ba63d(0x33a)]=_0x1ba63d(0x3d0),_0x385421[_0x1ba63d(0x497)](_0x5064ae),_0x385421[_0x1ba63d(0x98c)]=_0x385421[_0x1ba63d(0xfe3)],_0x5064ae;}function hideCallTypingIndicator(_0x41b7b0){const _0x11cd97=_0x211817;_0x41b7b0&&_0x41b7b0[_0x11cd97(0x148c)]&&_0x41b7b0[_0x11cd97(0x148c)][_0x11cd97(0x858)](_0x41b7b0);}function showVideoCallTypingIndicator(){const _0x4855e6=_0x211817,_0x168636=document['getElementById'](_0x4855e6(0x387));if(!_0x168636)return console[_0x4855e6(0x174a)](_0x4855e6(0x1bcf)),null;const _0x48d7cc=document[_0x4855e6(0xac6)]('div');return _0x48d7cc[_0x4855e6(0x1722)]='floating-message-bubble\x20received\x20video-typing-indicator',_0x48d7cc['innerHTML']=_0x4855e6(0x873),_0x168636['appendChild'](_0x48d7cc),requestAnimationFrame(()=>{const _0x47b2b5=_0x4855e6;_0x168636['scrollTop']=_0x168636[_0x47b2b5(0xfe3)];}),_0x48d7cc;}function hideVideoCallTypingIndicator(_0x44657c){const _0xc0e11b=_0x211817;_0x44657c&&_0x44657c[_0xc0e11b(0x148c)]&&_0x44657c[_0xc0e11b(0x148c)][_0xc0e11b(0x858)](_0x44657c);}function cleanCallResponse(_0x3d1ff7){const _0x54e589=_0x211817;if(!_0x3d1ff7)return'';console['log'](_0x54e589(0x1ef3),_0x3d1ff7),_0x3d1ff7=_0x3d1ff7[_0x54e589(0xe16)](/\n/g,'\x20')[_0x54e589(0xe16)](/\s+/g,'\x20')['trim'](),_0x3d1ff7=_0x3d1ff7[_0x54e589(0xe16)](/^(角色说|我说|回复|答案|回答)[:：]\s*/i,''),_0x3d1ff7=_0x3d1ff7[_0x54e589(0xe16)](/\([^)]*\)/g,''),_0x3d1ff7=_0x3d1ff7['replace'](/【[^】]*】/g,''),_0x3d1ff7=_0x3d1ff7['replace'](/\[[^\]]*\]/g,''),_0x3d1ff7=_0x3d1ff7['replace'](/^[，。！？；：,.!?;:\s]*/,''),console[_0x54e589(0x2187)](_0x54e589(0x4fd),_0x3d1ff7);if(!_0x3d1ff7||_0x3d1ff7[_0x54e589(0x19ee)]<0x2)return console['log'](_0x54e589(0x269)),getRandomCallResponse();return _0x3d1ff7[_0x54e589(0x19ee)]>0x3c&&(_0x3d1ff7=_0x3d1ff7['substring'](0x0,0x3c)+_0x54e589(0x1520)),_0x3d1ff7;}function getRandomCallGreeting(_0x3a35c7){const _0x3d01df=_0x211817,_0x35ab04=[_0x3d01df(0x1941)+_0x3a35c7+_0x3d01df(0x11ed),'嗨，终于能听到你的声音了！',_0x3d01df(0x216c),_0x3d01df(0xc81),_0x3d01df(0x155d)];return _0x35ab04[Math[_0x3d01df(0x2180)](Math[_0x3d01df(0x11a8)]()*_0x35ab04[_0x3d01df(0x19ee)])];}function getRandomCallResponse(){const _0x3ae64d=_0x211817,_0x46a76c=[_0x3ae64d(0x13c1),_0x3ae64d(0x1c53),_0x3ae64d(0xb77),'我觉得这个想法不错。',_0x3ae64d(0x715),'哦，真的吗？','我明白你的意思了。',_0x3ae64d(0x1cc0),_0x3ae64d(0xfa7),_0x3ae64d(0x13a2)];return _0x46a76c[Math[_0x3ae64d(0x2180)](Math[_0x3ae64d(0x11a8)]()*_0x46a76c[_0x3ae64d(0x19ee)])];}function checkForAICallTrigger(_0x307164,_0x587e83){const _0x2327dd=_0x211817,_0x1e4481=getCurrentChatSettings();if(!_0x1e4481[_0x2327dd(0x1f45)])return console[_0x2327dd(0x2187)](_0x2327dd(0x195e)),![];if(isInCall||isInVideoCall)return console['log'](_0x2327dd(0x311)),![];if(!currentChatCharacter||currentChatCharacter[_0x2327dd(0x1f68)])return console[_0x2327dd(0x2187)](_0x2327dd(0x1c3b)),![];const _0x172ac9=['通话','电话','视频','语音',_0x2327dd(0x184c),'想听','想看','聊天','说话',_0x2327dd(0x6ce),'来电','接电话'],_0x3ac20a=_0x172ac9[_0x2327dd(0x19fa)](_0x4cfd43=>_0x307164[_0x2327dd(0x1831)](_0x4cfd43)),_0x2123a3=_0x172ac9['some'](_0x2e6544=>_0x587e83[_0x2327dd(0x1831)](_0x2e6544));console[_0x2327dd(0x2187)](_0x2327dd(0x179c),{'userMessage':_0x307164[_0x2327dd(0x17ca)](0x0,0x32)+_0x2327dd(0x1520),'aiResponse':_0x587e83[_0x2327dd(0x17ca)](0x0,0x32)+'...','userHasKeyword':_0x3ac20a,'aiHasKeyword':_0x2123a3,'characterName':currentChatCharacter['name']});let _0x570893=0x0;(_0x3ac20a||_0x2123a3)&&(_0x570893=0.15,_0x3ac20a&&_0x2123a3&&(_0x570893=0.35));const _0x466864=(currentChatCharacter['bio']||'')[_0x2327dd(0x49e)]();(_0x466864[_0x2327dd(0x1831)]('主动')||_0x466864[_0x2327dd(0x1831)]('外向')||_0x466864[_0x2327dd(0x1831)]('热情')||_0x466864['includes']('活泼')||_0x466864[_0x2327dd(0x1831)]('开朗')||_0x466864['includes']('积极'))&&(_0x570893+=0.1);const _0x8b392a=['想你',_0x2327dd(0x1d85),'想和你','喜欢你','爱你','想聊','想说','想分享'],_0x126f7b=_0x8b392a[_0x2327dd(0x19fa)](_0x185548=>_0x307164[_0x2327dd(0x1831)](_0x185548)||_0x587e83[_0x2327dd(0x1831)](_0x185548));_0x126f7b&&(_0x570893+=0.1);_0x570893===0x0&&Math[_0x2327dd(0x11a8)]()<0.03&&(_0x570893=0.03,console[_0x2327dd(0x2187)](_0x2327dd(0x1d1)));_0x570893=Math[_0x2327dd(0x21ff)](_0x570893,0.5);if(_0x570893>0x0&&Math[_0x2327dd(0x11a8)]()<_0x570893){console[_0x2327dd(0x2187)](_0x2327dd(0x189e),_0x570893);let _0x2dace0=extractCallReason(_0x587e83);if(!_0x2dace0||_0x2dace0['includes'](_0x2327dd(0xbd2))){const _0x1ca698=[_0x2327dd(0x15cc),'有话想和你说',_0x2327dd(0xbd2),_0x2327dd(0x7fe),_0x2327dd(0x1576)];_0x2dace0=_0x1ca698[Math['floor'](Math[_0x2327dd(0x11a8)]()*_0x1ca698['length'])];}const _0x4ecb23=0x3e8+Math[_0x2327dd(0x11a8)]()*0xbb8;return console[_0x2327dd(0x2187)]('🔔\x20将在'+Math[_0x2327dd(0x13e2)](_0x4ecb23/0x3e8)+'秒后发起来电，理由:\x20'+_0x2dace0),setTimeout(()=>{console['log']('🔔\x20开始发起AI来电'),initiateAICall(currentChatCharacter,_0x2dace0);},_0x4ecb23),!![];}else console[_0x2327dd(0x2187)](_0x2327dd(0x83a),_0x570893);return![];}function extractCallReason(_0x240c36){const _0x5e8848=_0x211817;let _0x22f95d=['想和你聊聊天',_0x5e8848(0x1ac2),_0x5e8848(0x1361),_0x5e8848(0x1cf2)];const _0x35e637=_0x240c36['split'](/[。！？.!?]/),_0x1ee41a=_0x35e637[_0x5e8848(0x1e1f)](_0x15f6e5=>{const _0x545c1d=_0x5e8848,_0x10c0ef=_0x15f6e5[_0x545c1d(0x19d7)]();return _0x10c0ef[_0x545c1d(0x19ee)]>0x5&&_0x10c0ef[_0x545c1d(0x19ee)]<0x14&&!_0x10c0ef['includes']('我');});if(_0x1ee41a[_0x5e8848(0x19ee)]>0x0)return _0x1ee41a[Math[_0x5e8848(0x2180)](Math[_0x5e8848(0x11a8)]()*_0x1ee41a['length'])][_0x5e8848(0x19d7)]();return _0x22f95d[Math[_0x5e8848(0x2180)](Math['random']()*_0x22f95d[_0x5e8848(0x19ee)])];}function openVideoCall(){const _0x30d205=_0x211817;if(!currentChatCharacter){showToast(_0x30d205(0x1346),_0x30d205(0x174a));return;}if(currentChatCharacter[_0x30d205(0x1f68)]){showToast('群聊不支持视频通话',_0x30d205(0x174a));return;}SoundManager['play'](SoundManager[_0x30d205(0xf4e)][_0x30d205(0x1895)],currentChatCharacter?.['id']),currentVideoCallCharacter=currentChatCharacter;const _0x2011d2=getVideoAvatarSettings(),_0x35a0c9=_0x2011d2['characterAvatar']||currentVideoCallCharacter[_0x30d205(0x1f8a)]||currentVideoCallCharacter[_0x30d205(0x1994)]||'data:image/svg+xml;utf8,<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x22100\x22\x20height=\x22100\x22\x20viewBox=\x220\x200\x20100\x20100\x22><circle\x20cx=\x2250\x22\x20cy=\x2250\x22\x20r=\x2250\x22\x20fill=\x22lightgray\x22/><text\x20x=\x2250\x22\x20y=\x2260\x22\x20font-size=\x2230\x22\x20text-anchor=\x22middle\x22\x20fill=\x22gray\x22>头像</text></svg>',_0x2825d1=_0x2011d2[_0x30d205(0x865)]||_0x30d205(0x5e7);document['getElementById'](_0x30d205(0x8af))['src']=_0x35a0c9,document[_0x30d205(0x1262)]('video-call-user-avatar')[_0x30d205(0x45c)]=_0x2825d1,document[_0x30d205(0x1262)](_0x30d205(0x8db))[_0x30d205(0x13be)]=currentVideoCallCharacter[_0x30d205(0x1a1c)],document['getElementById']('video-call-status')[_0x30d205(0x13be)]=_0x30d205(0x20e4),document[_0x30d205(0x1262)]('video-call-timer')[_0x30d205(0x13be)]='00:00';const _0x2b89bb=document[_0x30d205(0x1262)](_0x30d205(0x387));_0x2b89bb&&(_0x2b89bb['innerHTML']='');showApp(_0x30d205(0x1fca)),startVideoCallTimer(),isInVideoCall=!![],isVideoMuted=![],isVideoCameraOff=![],updateVideoCallButtons();const _0x35b86b={'id':generateMessageId(),'sender':_0x30d205(0x1744),'content':currentVideoCallCharacter['name']+_0x30d205(0x2209),'timestamp':Date[_0x30d205(0x2eb)](),'type':_0x30d205(0x1e64),'callType':'outgoing','callStatus':'started'};addMessageToChat(_0x35b86b),window['isUserInitiatedVideoCall']=!![];}function startVideoCallTimer(){videoCallStartTime=new Date(),videoCallDuration=0x0,videoCallTimer=setInterval(()=>{const _0x207956=_0x167f;videoCallDuration=Math[_0x207956(0x2180)]((new Date()-videoCallStartTime)/0x3e8),document[_0x207956(0x1262)](_0x207956(0x1f85))[_0x207956(0x13be)]=formatCallDuration(videoCallDuration);},0x3e8);}function stopVideoCallTimer(){videoCallTimer&&(clearInterval(videoCallTimer),videoCallTimer=null);}function endVideoCall(){const _0x59db6e=_0x211817;if(!isInVideoCall)return;stopVideoCallTimer(),hideApp(_0x59db6e(0x1fca)),showApp(_0x59db6e(0xcf2));const _0x25b19b=formatCallDuration(videoCallDuration),_0x1487aa={'id':generateMessageId(),'sender':'system','content':_0x59db6e(0xc2a)+_0x25b19b,'timestamp':Date[_0x59db6e(0x2eb)](),'type':'call_record','callType':_0x59db6e(0x1d9c),'callStatus':'completed','duration':_0x25b19b};addMessageToChat(_0x1487aa),isInVideoCall=![],isVideoMuted=![],isVideoCameraOff=![],currentVideoCallCharacter=null,window['isUserInitiatedVideoCall']=![];}function toggleVideoMute(){const _0x4dd8b8=_0x211817;isVideoMuted=!isVideoMuted,updateVideoCallButtons();const _0x1ad808=document[_0x4dd8b8(0x1262)](_0x4dd8b8(0x92e));isVideoMuted?showToast(_0x4dd8b8(0x592),_0x4dd8b8(0x477)):showToast(_0x4dd8b8(0x1abd),'info');}function toggleVideoCamera(){const _0x25255d=_0x211817;isVideoCameraOff=!isVideoCameraOff,updateVideoCallButtons();const _0x39620c=document[_0x25255d(0xb30)]('.video-call-user-window');if(isVideoCameraOff)_0x39620c['style'][_0x25255d(0x619)]=_0x25255d(0x22d0),_0x39620c[_0x25255d(0x33a)]=_0x25255d(0x3b1),showToast('摄像头已关闭',_0x25255d(0x477));else{const _0x2472d3=getVideoAvatarSettings(),_0x43aede=_0x2472d3['userAvatar']||_0x25255d(0x5e7);_0x39620c['style'][_0x25255d(0x619)]='',_0x39620c[_0x25255d(0x33a)]=_0x25255d(0xbb6)+_0x43aede+'\x22\x20alt=\x22用户通话形象\x22\x20class=\x22user-video-avatar\x22>',showToast(_0x25255d(0x18a7),'info');}}function updateVideoCallButtons(){const _0x1a00c8=_0x211817,_0x5313cc=document[_0x1a00c8(0x1262)]('video-mute-btn'),_0x381b26=document[_0x1a00c8(0x1262)]('video-camera-btn');_0x5313cc&&(isVideoMuted?(_0x5313cc[_0x1a00c8(0x1c1b)][_0x1a00c8(0x21e2)](_0x1a00c8(0x11f5)),_0x5313cc[_0x1a00c8(0x33a)]=_0x1a00c8(0xe75)):(_0x5313cc[_0x1a00c8(0x1c1b)]['remove']('muted'),_0x5313cc[_0x1a00c8(0x33a)]=_0x1a00c8(0x19e6))),_0x381b26&&(isVideoCameraOff?(_0x381b26[_0x1a00c8(0x1c1b)]['add'](_0x1a00c8(0x89f)),_0x381b26[_0x1a00c8(0x33a)]='<i\x20class=\x22fas\x20fa-video-slash\x22></i>'):(_0x381b26[_0x1a00c8(0x1c1b)][_0x1a00c8(0x1493)](_0x1a00c8(0x89f)),_0x381b26[_0x1a00c8(0x33a)]=_0x1a00c8(0xa3a)));}function sendVideoCallMessage(){const _0xc23f34=_0x211817,_0x56ffa9=document['getElementById']('video-call-input');if(!_0x56ffa9){console[_0xc23f34(0x174a)]('找不到视频通话输入框元素');return;}const _0x287cbd=_0x56ffa9[_0xc23f34(0x1ebc)][_0xc23f34(0x19d7)]();if(!_0x287cbd)return;addVideoCallMessage(_0x287cbd,_0xc23f34(0x1e6d)),_0x56ffa9['value']='';const _0x552cf2=showVideoCallTypingIndicator();currentVideoCallCharacter&&setTimeout(async()=>{const _0x23926b=_0xc23f34;try{const _0x55fc48='你是'+currentVideoCallCharacter['name']+_0x23926b(0x1db1)+_0x287cbd+_0x23926b(0x15be),_0x5c35c3=await callChatAPI(_0x55fc48,currentVideoCallCharacter);if(_0x5c35c3&&_0x5c35c3['trim']()){hideVideoCallTypingIndicator(_0x552cf2);const _0x4e4be6=await parseAiResponse(_0x5c35c3);console[_0x23926b(0x2187)]('🔔\x20视频通话AI回复解析结果:',_0x4e4be6);let _0x557f79=![];if(Array[_0x23926b(0x1496)](_0x4e4be6)&&_0x4e4be6[_0x23926b(0x19ee)]>0x0)for(const _0x4acfa3 of _0x4e4be6){let _0x451d0a='';if(typeof _0x4acfa3==='string')_0x451d0a=_0x4acfa3[_0x23926b(0x19d7)]();else typeof _0x4acfa3===_0x23926b(0x28d)&&_0x4acfa3[_0x23926b(0x211c)]&&(_0x451d0a=_0x4acfa3[_0x23926b(0x211c)]['trim']());_0x451d0a&&(addVideoCallMessage(_0x451d0a,_0x23926b(0xb11)),_0x557f79=!![],await new Promise(_0x330e17=>setTimeout(_0x330e17,0x12c)));}if(!_0x557f79){const _0x549e27=cleanCallResponse(_0x5c35c3);_0x549e27&&_0x549e27[_0x23926b(0x19d7)]()?addVideoCallMessage(_0x549e27[_0x23926b(0x19d7)](),_0x23926b(0xb11)):addVideoCallMessage(getRandomCallResponse(),_0x23926b(0xb11));}}else hideVideoCallTypingIndicator(_0x552cf2),addVideoCallMessage(getRandomCallResponse(),_0x23926b(0xb11));}catch(_0x186544){console[_0x23926b(0x174a)](_0x23926b(0x18e2),_0x186544),hideVideoCallTypingIndicator(_0x552cf2),addVideoCallMessage(_0x23926b(0x187e),'received');}},0x3e8+Math['random']()*0x3e8);}function addVideoCallMessage(_0x15cab3,_0x28fa8c){const _0x195253=_0x211817,_0xd58bf8=document[_0x195253(0x1262)](_0x195253(0x387));if(!_0xd58bf8){console['error']('找不到视频通话消息容器元素');return;}const _0x5296fd=document[_0x195253(0xac6)](_0x195253(0xbbc));_0x5296fd[_0x195253(0x1722)]='floating-message-bubble\x20'+_0x28fa8c,_0x5296fd[_0x195253(0x13be)]=_0x15cab3,_0xd58bf8['appendChild'](_0x5296fd),requestAnimationFrame(()=>{const _0x399c6c=_0x195253;_0xd58bf8[_0x399c6c(0x98c)]=_0xd58bf8[_0x399c6c(0xfe3)];});if(currentVideoCallCharacter&&currentVideoCallCharacter['id']){const _0x408de0={'id':generateMessageId(),'sender':_0x28fa8c===_0x195253(0x1e6d)?_0x195253(0x1e6d):_0x195253(0xb11),'content':_0x15cab3,'timestamp':Date[_0x195253(0x2eb)](),'type':'call_message'};addMessageToChat(_0x408de0);}}function showVideoAvatarModal(){const _0x2869cc=_0x211817,_0x208fd9=getVideoAvatarSettings(),_0x179f02=document['getElementById']('character-video-avatar-preview'),_0xff9c9=document[_0x2869cc(0x1262)](_0x2869cc(0xbf5)),_0x1d1192=document[_0x2869cc(0x1262)]('character-avatar-placeholder'),_0x442a96=document[_0x2869cc(0x1262)]('user-avatar-placeholder');_0x208fd9[_0x2869cc(0x2a1)]?(_0x179f02['src']=_0x208fd9[_0x2869cc(0x2a1)],_0x179f02['style'][_0x2869cc(0x4da)]='block',_0x1d1192[_0x2869cc(0x14eb)][_0x2869cc(0x4da)]=_0x2869cc(0x102b)):(_0x179f02[_0x2869cc(0x14eb)][_0x2869cc(0x4da)]=_0x2869cc(0x102b),_0x1d1192[_0x2869cc(0x14eb)]['display']=_0x2869cc(0x1fb7)),_0x208fd9[_0x2869cc(0x865)]?(_0xff9c9[_0x2869cc(0x45c)]=_0x208fd9[_0x2869cc(0x865)],_0xff9c9[_0x2869cc(0x14eb)][_0x2869cc(0x4da)]='block',_0x442a96['style'][_0x2869cc(0x4da)]=_0x2869cc(0x102b)):(_0xff9c9[_0x2869cc(0x14eb)][_0x2869cc(0x4da)]='none',_0x442a96[_0x2869cc(0x14eb)][_0x2869cc(0x4da)]=_0x2869cc(0x1fb7)),document[_0x2869cc(0x1262)](_0x2869cc(0x115d))['style']['display']=_0x2869cc(0x1fb7);}function hideVideoAvatarModal(_0x10bdb5){const _0x3f2ed8=_0x211817;if(_0x10bdb5&&_0x10bdb5[_0x3f2ed8(0x193d)]!==_0x10bdb5[_0x3f2ed8(0x1fac)])return;document['getElementById'](_0x3f2ed8(0x115d))['style'][_0x3f2ed8(0x4da)]=_0x3f2ed8(0x102b);}function changeCharacterVideoAvatar(){const _0x32052f=_0x211817;document[_0x32052f(0x1262)]('character-video-avatar-input')[_0x32052f(0x1859)]();}function changeUserVideoAvatar(){const _0x4abde3=_0x211817;document[_0x4abde3(0x1262)](_0x4abde3(0x197e))[_0x4abde3(0x1859)]();}function handleCharacterVideoAvatarChange(_0x6ff993){const _0x397b33=_0x211817,_0x349bdb=_0x6ff993[_0x397b33(0x193d)][_0x397b33(0xf26)][0x0];if(_0x349bdb){const _0xf9485f=new FileReader();_0xf9485f[_0x397b33(0xc55)]=function(_0x2ce47c){const _0x317b47=_0x397b33,_0x17fe33=document[_0x317b47(0x1262)](_0x317b47(0x2bb)),_0x38c7ec=document[_0x317b47(0x1262)](_0x317b47(0x9a8));_0x17fe33[_0x317b47(0x45c)]=_0x2ce47c['target'][_0x317b47(0x4ee)],_0x17fe33[_0x317b47(0x14eb)][_0x317b47(0x4da)]='block',_0x38c7ec[_0x317b47(0x14eb)][_0x317b47(0x4da)]='none';},_0xf9485f[_0x397b33(0x127c)](_0x349bdb);}}function handleUserVideoAvatarChange(_0x4af41e){const _0x5790bc=_0x211817,_0x389bd5=_0x4af41e[_0x5790bc(0x193d)][_0x5790bc(0xf26)][0x0];if(_0x389bd5){const _0x44ffd5=new FileReader();_0x44ffd5[_0x5790bc(0xc55)]=function(_0x4ba8a6){const _0x5f3cf0=_0x5790bc,_0xb8cdf5=document[_0x5f3cf0(0x1262)]('user-video-avatar-preview'),_0x17618b=document['getElementById']('user-avatar-placeholder');_0xb8cdf5['src']=_0x4ba8a6[_0x5f3cf0(0x193d)]['result'],_0xb8cdf5[_0x5f3cf0(0x14eb)][_0x5f3cf0(0x4da)]=_0x5f3cf0(0x13de),_0x17618b[_0x5f3cf0(0x14eb)][_0x5f3cf0(0x4da)]=_0x5f3cf0(0x102b);},_0x44ffd5[_0x5790bc(0x127c)](_0x389bd5);}}function saveVideoAvatarSettings(){const _0x4675c8=_0x211817,_0x59dc1e=document[_0x4675c8(0x1262)](_0x4675c8(0x2bb)),_0xad211f=document[_0x4675c8(0x1262)](_0x4675c8(0xbf5)),_0x260ded={'characterAvatar':_0x59dc1e[_0x4675c8(0x14eb)][_0x4675c8(0x4da)]===_0x4675c8(0x13de)?_0x59dc1e[_0x4675c8(0x45c)]:null,'userAvatar':_0xad211f[_0x4675c8(0x14eb)][_0x4675c8(0x4da)]==='block'?_0xad211f[_0x4675c8(0x45c)]:null};if(currentChatCharacter&&currentChatCharacter['id']){const _0x42fb8d=_0x4675c8(0xbc9)+currentChatCharacter['id'];localStorage[_0x4675c8(0x192)](_0x42fb8d,JSON[_0x4675c8(0x6b8)](_0x260ded)),showToast(_0x4675c8(0xed8),_0x4675c8(0x11cb));}hideVideoAvatarModal();}function getVideoAvatarSettings(){const _0x2e6ef3=_0x211817;if(!currentChatCharacter||!currentChatCharacter['id'])return{'characterAvatar':null,'userAvatar':null};const _0x3b501b=_0x2e6ef3(0xbc9)+currentChatCharacter['id'],_0xe64eb4=localStorage[_0x2e6ef3(0x15d8)](_0x3b501b);if(_0xe64eb4)try{return JSON[_0x2e6ef3(0x22d3)](_0xe64eb4);}catch(_0x15b268){console['error'](_0x2e6ef3(0xfb5),_0x15b268);}return{'characterAvatar':null,'userAvatar':null};}function updateVideoAvatarSettingVisibility(){const _0x1d9214=_0x211817,_0x1c54ff=document[_0x1d9214(0x1262)](_0x1d9214(0x11a4));_0x1c54ff&&(currentChatCharacter&&!currentChatCharacter[_0x1d9214(0x1f68)]?_0x1c54ff[_0x1d9214(0x14eb)][_0x1d9214(0x4da)]=_0x1d9214(0x1fb7):_0x1c54ff[_0x1d9214(0x14eb)][_0x1d9214(0x4da)]=_0x1d9214(0x102b));}function shareLocation(){const _0x2be925=_0x211817;if(!currentChatCharacter){alert(_0x2be925(0x1346));return;}document[_0x2be925(0x1262)](_0x2be925(0x9d5))['value']='',document[_0x2be925(0x1262)]('map-location-display')[_0x2be925(0x13be)]=_0x2be925(0x10c3),randomizeMapPosition(),renderLocationHistory(),document[_0x2be925(0x1262)](_0x2be925(0xe85))['style'][_0x2be925(0x4da)]='flex';}function hideChatLocationModal(){const _0x39e5a5=_0x211817;document[_0x39e5a5(0x1262)](_0x39e5a5(0xe85))[_0x39e5a5(0x14eb)][_0x39e5a5(0x4da)]=_0x39e5a5(0x102b);}function setLocationAddress(_0x124a3d){const _0x2f8ac6=_0x211817;document[_0x2f8ac6(0x1262)](_0x2f8ac6(0x9d5))[_0x2f8ac6(0x1ebc)]=_0x124a3d,document[_0x2f8ac6(0x1262)](_0x2f8ac6(0x1cc6))[_0x2f8ac6(0x13be)]=_0x124a3d;const _0x280e59=(39.8+Math[_0x2f8ac6(0x11a8)]()*0.4)[_0x2f8ac6(0x13ad)](0x4),_0x4d634c=(116.2+Math[_0x2f8ac6(0x11a8)]()*0.4)[_0x2f8ac6(0x13ad)](0x4);document[_0x2f8ac6(0xb30)](_0x2f8ac6(0x1b7e))[_0x2f8ac6(0x13be)]=_0x4d634c+_0x2f8ac6(0x1f83)+_0x280e59+'°N';}function randomizeMapPosition(){const _0x1c9c2c=_0x211817,_0x136def=document[_0x1c9c2c(0x1262)]('location-marker'),_0x346940=document[_0x1c9c2c(0x1897)](_0x1c9c2c(0x20af)),_0x29c926=0x14+Math[_0x1c9c2c(0x11a8)]()*0x3c,_0x3e6b50=0x14+Math[_0x1c9c2c(0x11a8)]()*0x3c;_0x136def[_0x1c9c2c(0x14eb)][_0x1c9c2c(0x825)]=_0x29c926+'%',_0x136def[_0x1c9c2c(0x14eb)][_0x1c9c2c(0x15dc)]=_0x3e6b50+'%',_0x346940['forEach'](_0x5395de=>{const _0xb5a59b=_0x1c9c2c,_0x5d7069=Math[_0xb5a59b(0x11a8)]()*0x55,_0x42854a=Math[_0xb5a59b(0x11a8)]()*0x55;_0x5395de['style'][_0xb5a59b(0x825)]=_0x5d7069+'%',_0x5395de[_0xb5a59b(0x14eb)]['left']=_0x42854a+'%';});const _0x269fdd=(39.8+Math['random']()*0.4)[_0x1c9c2c(0x13ad)](0x4),_0x1685a0=(116.2+Math[_0x1c9c2c(0x11a8)]()*0.4)[_0x1c9c2c(0x13ad)](0x4);document[_0x1c9c2c(0xb30)](_0x1c9c2c(0x1b7e))[_0x1c9c2c(0x13be)]=_0x1685a0+_0x1c9c2c(0x1f83)+_0x269fdd+'°N';}function generateRealisticMapHTML(){const _0x2ff809=_0x211817;return _0x2ff809(0x1e37);}let locationHistory=JSON[_0x211817(0x22d3)](localStorage['getItem'](_0x211817(0x19f9))||'[]');function saveLocationHistory(){const _0x9a328c=_0x211817;localStorage[_0x9a328c(0x192)]('locationHistory',JSON['stringify'](locationHistory));}function addToLocationHistory(_0x4b9806){const _0x17f5af=_0x211817;if(!_0x4b9806['trim']())return;locationHistory=locationHistory['filter'](_0x1cb8bb=>_0x1cb8bb!==_0x4b9806),locationHistory[_0x17f5af(0x5ed)](_0x4b9806),locationHistory[_0x17f5af(0x19ee)]>0xa&&(locationHistory=locationHistory[_0x17f5af(0x6d5)](0x0,0xa)),saveLocationHistory(),renderLocationHistory();}function removeFromLocationHistory(_0x2bc7c5){const _0x476a73=_0x211817;locationHistory=locationHistory[_0x476a73(0x1e1f)](_0x41c2ae=>_0x41c2ae!==_0x2bc7c5),saveLocationHistory(),renderLocationHistory();}function renderLocationHistory(){const _0x2448dd=_0x211817,_0x318212=document[_0x2448dd(0x1262)](_0x2448dd(0x1bbd));if(!_0x318212)return;if(locationHistory[_0x2448dd(0x19ee)]===0x0){_0x318212[_0x2448dd(0x33a)]=_0x2448dd(0xe33);return;}_0x318212['innerHTML']=locationHistory['map'](_0x26e329=>'<div\x20class=\x22location-history-item\x22\x20data-location=\x22'+_0x26e329+_0x2448dd(0x8a7)+_0x26e329+_0x2448dd(0x18db)+_0x26e329+'\x22\x20title=\x22删除\x22>×</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>')[_0x2448dd(0x122b)](''),_0x318212[_0x2448dd(0x1f36)]=function(_0xaa0713){const _0x38e8e9=_0x2448dd,_0x290a2c=_0xaa0713[_0x38e8e9(0x193d)][_0x38e8e9(0x216a)]('.location-history-item');if(!_0x290a2c)return;const _0x3efaac=_0x290a2c['dataset']['location'];_0xaa0713[_0x38e8e9(0x193d)][_0x38e8e9(0x1c1b)][_0x38e8e9(0x971)](_0x38e8e9(0xd36))?(_0xaa0713[_0x38e8e9(0x902)](),confirmDeleteLocation(_0x3efaac)):setLocationAddress(_0x3efaac);};}let touchTimer=null,touchedElement=null;function handleLocationTouchStart(_0xd7266a,_0x53ffe6){const _0x3e0943=_0x211817;touchedElement=_0xd7266a[_0x3e0943(0x193d)],touchTimer=setTimeout(()=>{confirmDeleteLocation(_0x53ffe6);},0x320);}function handleLocationTouchEnd(_0x41a138){const _0x144a43=_0x211817;touchTimer&&(clearTimeout(touchTimer),touchTimer=null),touchedElement&&(touchedElement[_0x144a43(0x1c1b)][_0x144a43(0x1493)](_0x144a43(0x4ed)),touchedElement=null);}function confirmDeleteLocation(_0x382e44){const _0x1af462=_0x211817;touchedElement&&touchedElement['classList'][_0x1af462(0x21e2)]('deleting');if(confirm('确定要删除位置\x22'+_0x382e44+'\x22吗？'))removeFromLocationHistory(_0x382e44),showToast(_0x1af462(0x7d4),'success');else touchedElement&&touchedElement[_0x1af462(0x1c1b)][_0x1af462(0x1493)](_0x1af462(0x4ed));}function sendLocationMessage(){const _0x4bf75d=_0x211817,_0x367e9c=document[_0x4bf75d(0x1262)](_0x4bf75d(0x9d5))[_0x4bf75d(0x1ebc)]['trim']();if(!_0x367e9c){alert(_0x4bf75d(0x10c3));return;}addToLocationHistory(_0x367e9c);const _0x158a2d={'id':Date[_0x4bf75d(0x2eb)]()[_0x4bf75d(0x1878)](),'sender':_0x4bf75d(0x1e6d),'type':_0x4bf75d(0x2184),'locationName':_0x367e9c,'coordinates':document[_0x4bf75d(0xb30)]('.map-coordinates')['textContent'],'content':'[用户分享了位置信息：'+_0x367e9c+_0x4bf75d(0x9bc)+document['querySelector'](_0x4bf75d(0x1b7e))[_0x4bf75d(0x13be)]+']','timestamp':Date[_0x4bf75d(0x2eb)]()};console[_0x4bf75d(0x2187)](_0x4bf75d(0x58f),_0x158a2d);if(!_0x158a2d[_0x4bf75d(0x1b93)]||!_0x158a2d['coordinates']){console[_0x4bf75d(0x174a)](_0x4bf75d(0x10a7),{'locationName':_0x158a2d['locationName'],'coordinates':_0x158a2d[_0x4bf75d(0x7cf)]}),alert(_0x4bf75d(0x1991));return;}!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x4bf75d(0x1cd6)](_0x158a2d),saveChatMessages(),addMessageWithAnimation(_0x158a2d,currentChatCharacter['id']),pendingUserMessage=_0x158a2d;const _0x29771c=document[_0x4bf75d(0x1262)](_0x4bf75d(0x1d2b));_0x29771c&&(_0x29771c[_0x4bf75d(0x14eb)][_0x4bf75d(0x2231)]='pulse\x201.5s\x20infinite',_0x29771c['classList'][_0x4bf75d(0x21e2)]('waiting'),_0x29771c[_0x4bf75d(0x378)]=_0x4bf75d(0xd96)),renderMessageList(),hideChatLocationModal(),showToast(_0x4bf75d(0xc82),_0x4bf75d(0x11cb));}function updateExistingLocationMaps(){const _0x31ecfb=_0x211817,_0x209d69=document['querySelectorAll']('.location-card-map');_0x209d69[_0x31ecfb(0x19fb)](_0x118f29=>{const _0x1a9c28=_0x31ecfb;!_0x118f29[_0x1a9c28(0xb30)](_0x1a9c28(0x1cf3))&&(_0x118f29['innerHTML']=generateRealisticMapHTML());});}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x580fc2=_0x211817,_0x2186dd=document[_0x580fc2(0x1262)](_0x580fc2(0x9d5));_0x2186dd&&_0x2186dd['addEventListener'](_0x580fc2(0x1823),function(){const _0x584303=_0x580fc2,_0x3ae603=this[_0x584303(0x1ebc)][_0x584303(0x19d7)]();if(_0x3ae603){document[_0x584303(0x1262)]('map-location-display')['textContent']=_0x3ae603;const _0x43739f=(39.8+Math['random']()*0.4)[_0x584303(0x13ad)](0x4),_0x4d763e=(116.2+Math['random']()*0.4)['toFixed'](0x4);document['querySelector']('.map-coordinates')[_0x584303(0x13be)]=_0x4d763e+_0x584303(0x1f83)+_0x43739f+'°N';}else document[_0x584303(0x1262)](_0x584303(0x1cc6))[_0x584303(0x13be)]=_0x584303(0x10c3);}),document[_0x580fc2(0x1262)](_0x580fc2(0xe85))?.['addEventListener']('click',_0x549163=>{const _0x1b6bbb=_0x580fc2;_0x549163[_0x1b6bbb(0x193d)]===document[_0x1b6bbb(0x1262)]('chat-location-modal')&&hideChatLocationModal();}),setInterval(updateExistingLocationMaps,0x3e8);});function showLocationDetail(_0x4421a9){const _0x1fce33=_0x211817;alert(_0x1fce33(0x1102)+_0x4421a9);}async function calculateStorageUsage(){const _0x27a640=_0x211817;try{let _0x2f895f=0x0,_0x637b1a=0x0,_0x574370=0x0,_0x21b2c2=0x0;const [_0xde9250,_0x2592d2,_0x142647,_0x31e577]=await Promise[_0x27a640(0x1a47)]([db[_0x27a640(0x19a2)]['toArray'](),db[_0x27a640(0x2005)][_0x27a640(0xf13)](),db[_0x27a640(0x1789)][_0x27a640(0xf13)](),db[_0x27a640(0x223)][_0x27a640(0xf13)]()]);_0x2f895f=JSON[_0x27a640(0x6b8)](_0xde9250)[_0x27a640(0x19ee)],_0x637b1a=JSON[_0x27a640(0x6b8)](_0x2592d2)[_0x27a640(0x19ee)],_0x574370=JSON[_0x27a640(0x6b8)](_0x142647)[_0x27a640(0x19ee)],_0x21b2c2=JSON[_0x27a640(0x6b8)](_0x31e577)['length'];const _0x2a7cb4=_0x2f895f+_0x637b1a+_0x574370+_0x21b2c2,_0x3ab527=_0x264f20=>{const _0x3e7fda=_0x27a640;if(_0x264f20===0x0)return _0x3e7fda(0x1e81);const _0x549253=0x400,_0x3ac732=['B','KB','MB','GB'],_0x38b3fd=Math[_0x3e7fda(0x2180)](Math[_0x3e7fda(0x2187)](_0x264f20)/Math[_0x3e7fda(0x2187)](_0x549253));return parseFloat((_0x264f20/Math[_0x3e7fda(0x9af)](_0x549253,_0x38b3fd))['toFixed'](0x2))+'\x20'+_0x3ac732[_0x38b3fd];};document[_0x27a640(0x1262)]('chat-storage-size')&&(document['getElementById']('chat-storage-size')['textContent']=_0x3ab527(_0x2f895f),document[_0x27a640(0x1262)]('character-storage-size')[_0x27a640(0x13be)]=_0x3ab527(_0x637b1a),document[_0x27a640(0x1262)](_0x27a640(0x22a4))['textContent']=_0x3ab527(_0x574370),document[_0x27a640(0x1262)](_0x27a640(0x15ae))['textContent']=_0x3ab527(_0x21b2c2),document['getElementById']('total-storage-size')['textContent']=_0x3ab527(_0x2a7cb4));}catch(_0x3d4b1c){console[_0x27a640(0x174a)](_0x27a640(0x1ee9),_0x3d4b1c);}}function diagnoseBrowserCompatibility(){const _0x552168=_0x211817;console[_0x552168(0x2187)](_0x552168(0xcdb)),console['log'](_0x552168(0xc1b),{'userAgent':navigator[_0x552168(0x214b)],'vendor':navigator['vendor'],'platform':navigator[_0x552168(0x6aa)]}),console['log'](_0x552168(0x5fa),{'charactersCount':characters[_0x552168(0x19ee)],'contactsCount':contacts[_0x552168(0x19ee)],'chatMessagesKeys':Object[_0x552168(0x1c9f)](chatMessages)[_0x552168(0x19ee)],'charactersData':characters['slice'](0x0,0x2),'contactsData':contacts[_0x552168(0x6d5)](0x0,0xa)}),console[_0x552168(0x2187)]('DOM状态:',{'messageListExists':!!document[_0x552168(0x1262)](_0x552168(0x1c45)),'messageItemsCount':document[_0x552168(0x1897)](_0x552168(0x15d6))[_0x552168(0x19ee)]}),console[_0x552168(0x2187)]('IndexedDB状态:',{'dbVersion':db[_0x552168(0xd6c)],'dbTables':db[_0x552168(0x160d)][_0x552168(0x6a4)](_0x3cc80a=>_0x3cc80a[_0x552168(0x1a1c)])});}async function forceFixDataConsistency(){const _0x40d423=_0x211817;try{console['log']('🔧\x20开始强制修复数据一致性...'),showToast('正在修复数据一致性...','info'),await Promise[_0x40d423(0x1a47)]([loadCharacters(),loadChatMessages()]);if(characters['length']>0x0&&contacts[_0x40d423(0x19ee)]===0x0){const _0x2e08ca=Object[_0x40d423(0x1c9f)](chatMessages)[_0x40d423(0x1e1f)](_0x49075a=>characters[_0x40d423(0x19fa)](_0x3ccc6f=>_0x3ccc6f['id']===_0x49075a));_0x2e08ca['length']>0x0?(contacts=_0x2e08ca,await saveContacts(),console[_0x40d423(0x2187)](_0x40d423(0x991)+contacts[_0x40d423(0x19ee)]+_0x40d423(0x164d))):console[_0x40d423(0x2187)](_0x40d423(0x1911));}else console[_0x40d423(0x2187)]('🔧\x20联系人状态正常，无需修复');renderMessageList(),renderContactList(),console[_0x40d423(0x2187)]('✅\x20数据一致性修复完成'),showToast('数据一致性修复完成',_0x40d423(0x11cb));}catch(_0x4738dd){console['error']('❌\x20数据一致性修复失败:',_0x4738dd),showToast(_0x40d423(0x733),_0x40d423(0x174a));}}window['debugTools']={'diagnose':diagnoseBrowserCompatibility,'fix':forceFixDataConsistency,'showData':function(){const _0x480bee=_0x211817;console[_0x480bee(0x2187)](_0x480bee(0x46b)),console[_0x480bee(0x2187)](_0x480bee(0xdc3),characters),console[_0x480bee(0x2187)](_0x480bee(0x104e),contacts),console['log'](_0x480bee(0xbd9),chatMessages),console[_0x480bee(0x2187)](_0x480bee(0xca4),{'messageItems':document[_0x480bee(0x1897)](_0x480bee(0x15d6))[_0x480bee(0x19ee)],'contactItems':document['querySelectorAll'](_0x480bee(0xc4b))[_0x480bee(0x19ee)]});},'rerender':function(){const _0x373110=_0x211817;console[_0x373110(0x2187)](_0x373110(0x182a)),renderMessageList(),renderContactList(),renderCharacterList(),console['log']('✅\x20重新渲染完成');},'reload':async function(){const _0x32ce32=_0x211817;console[_0x32ce32(0x2187)](_0x32ce32(0x1a7f)),await Promise[_0x32ce32(0x1a47)]([loadCharacters(),loadContacts(),loadChatMessages()]),this[_0x32ce32(0xc1c)](),console[_0x32ce32(0x2187)](_0x32ce32(0x517));},'testDeleteConversation':function(){const _0x15c8e7=_0x211817;console[_0x15c8e7(0x2187)](_0x15c8e7(0x218c)),console[_0x15c8e7(0x2187)](_0x15c8e7(0xecf),{'charactersCount':characters['length'],'contactsCount':contacts[_0x15c8e7(0x19ee)],'contacts':[...contacts]});if(contacts['length']>0x0){const _0x14053a=contacts[0x0];console[_0x15c8e7(0x2187)](_0x15c8e7(0xf69)+_0x14053a);const _0x18802d=contacts['indexOf'](_0x14053a);_0x18802d>-0x1&&(contacts[_0x15c8e7(0x19b2)](_0x18802d,0x1),saveContacts(),this[_0x15c8e7(0xc1c)](),console[_0x15c8e7(0x2187)](_0x15c8e7(0xe92),{'contactsCount':contacts[_0x15c8e7(0x19ee)],'contacts':[...contacts]}),console[_0x15c8e7(0x2187)](_0x15c8e7(0xec4)));}else console[_0x15c8e7(0x2187)](_0x15c8e7(0x57a));}},console[_0x211817(0x2187)](_0x211817(0x8d2)),console[_0x211817(0x2187)](_0x211817(0x1b1d)),console['log'](_0x211817(0xb98)),console[_0x211817(0x2187)](_0x211817(0xf52)),console[_0x211817(0x2187)](_0x211817(0x801)),console['log'](_0x211817(0x1879)),console[_0x211817(0x2187)]('debugTools.testDeleteConversation()\x20-\x20测试删除对话功能'),console['log']('💡\x20注意：修复功能只会恢复有聊天记录但缺少联系人的对话，不会恢复用户主动删除的对话');async function exportAllData(){const _0x4411cb=_0x211817;try{const _0x164807=/^((?!chrome|android).)*safari/i[_0x4411cb(0x11b8)](navigator['userAgent']),_0x59b3b3=/iPhone|iPad|iPod|Android/i[_0x4411cb(0x11b8)](navigator[_0x4411cb(0x214b)]);_0x164807&&_0x59b3b3?showToast('检测到Safari移动版，使用优化模式...','info'):showToast(_0x4411cb(0x2001),_0x4411cb(0x477));let _0x27bbcd=null;'memory'in performance&&(_0x27bbcd=performance[_0x4411cb(0x20df)],console[_0x4411cb(0x2187)]('🧠\x20内存信息:',{'used':Math['round'](_0x27bbcd[_0x4411cb(0x2143)]/0x400/0x400)+'MB','total':Math[_0x4411cb(0x13e2)](_0x27bbcd['totalJSHeapSize']/0x400/0x400)+'MB','limit':Math[_0x4411cb(0x13e2)](_0x27bbcd['jsHeapSizeLimit']/0x400/0x400)+'MB'}));console[_0x4411cb(0x2187)]('🔍\x20数据库版本:',db['verno']),console[_0x4411cb(0x2187)](_0x4411cb(0x524),db[_0x4411cb(0x160d)][_0x4411cb(0x6a4)](_0x159129=>_0x159129[_0x4411cb(0x1a1c)])),showToast(_0x4411cb(0x72e),_0x4411cb(0x477));const _0x3c9e00={'version':_0x4411cb(0x1972),'exportTime':new Date()[_0x4411cb(0x1034)]()};try{const _0x262478=await db[_0x4411cb(0x19a2)][_0x4411cb(0xc44)](),_0x52eafc=await db[_0x4411cb(0x6ed)][_0x4411cb(0xc44)](),_0x58e791=_0x262478+_0x52eafc;console[_0x4411cb(0x2187)]('📊\x20消息数量统计:\x20聊天消息\x20'+_0x262478+_0x4411cb(0xde7)+_0x52eafc+'\x20条,\x20总计\x20'+_0x58e791+'\x20条');if(_0x58e791>0x2710){const _0x2c6b14=confirm('检测到大量消息数据\x20('+_0x58e791+_0x4411cb(0xebf)+_0x4411cb(0x954)+_0x4411cb(0xe68)+_0x4411cb(0x247)+'点击\x22确定\x22使用轻量级导出\x0a'+_0x4411cb(0xc12));if(_0x2c6b14){await exportLightweightData();return;}}}catch(_0xc3eb8c){console[_0x4411cb(0x1f43)](_0x4411cb(0x1123),_0xc3eb8c);}const _0x27a475=[{'name':_0x4411cb(0x2005),'label':'角色'},{'name':_0x4411cb(0x1789),'label':'聊天设置'},{'name':_0x4411cb(0x1404),'label':_0x4411cb(0x1e3e)},{'name':_0x4411cb(0x1a86),'label':_0x4411cb(0x1fbb)},{'name':'characterGroups','label':_0x4411cb(0x12eb)},{'name':_0x4411cb(0x1076),'label':'群聊'},{'name':'worldbooks','label':_0x4411cb(0x1177)},{'name':_0x4411cb(0x1f0c),'label':_0x4411cb(0x7d7)},{'name':_0x4411cb(0x181d),'label':_0x4411cb(0x725)},{'name':_0x4411cb(0x13c7),'label':'壁纸'},{'name':_0x4411cb(0x11fd),'label':_0x4411cb(0x106a)},{'name':_0x4411cb(0x1d0c),'label':'纪念日'},{'name':_0x4411cb(0x125e),'label':_0x4411cb(0x419)},{'name':_0x4411cb(0x1a91),'label':_0x4411cb(0x22eb)},{'name':_0x4411cb(0x223),'label':_0x4411cb(0x175d)},{'name':_0x4411cb(0x1651),'label':_0x4411cb(0x11dc)},{'name':'groupChatMembers','label':_0x4411cb(0x1c21)},{'name':_0x4411cb(0x9c7),'label':'动态'},{'name':_0x4411cb(0x40a),'label':'动态点赞'},{'name':_0x4411cb(0x17d5),'label':'动态评论'},{'name':_0x4411cb(0x2077),'label':_0x4411cb(0x17e9)},{'name':_0x4411cb(0x1253),'label':'心声'},{'name':'forums','label':'论坛'},{'name':_0x4411cb(0x14c4),'label':_0x4411cb(0x1bf2)},{'name':_0x4411cb(0x789),'label':_0x4411cb(0x9c5)},{'name':_0x4411cb(0x145c),'label':_0x4411cb(0x1606)},{'name':_0x4411cb(0xa46),'label':'回复点赞'},{'name':_0x4411cb(0x1867),'label':'论坛图片'},{'name':'forumMountedWorldbooks','label':_0x4411cb(0x1705)},{'name':'workingMemory','label':_0x4411cb(0x15d9)},{'name':'episodicMemory','label':_0x4411cb(0x352)},{'name':'episodicMemories','label':_0x4411cb(0x1cdb)},{'name':_0x4411cb(0x203a),'label':_0x4411cb(0x1dec)},{'name':'memoryEvents','label':'记忆事件'},{'name':_0x4411cb(0x1687),'label':_0x4411cb(0x498)},{'name':_0x4411cb(0x127e),'label':_0x4411cb(0x1e70)},{'name':_0x4411cb(0x8ac),'label':_0x4411cb(0xf7a)},{'name':_0x4411cb(0x233),'label':_0x4411cb(0x1627)},{'name':_0x4411cb(0xd7e),'label':'被拉黑角色'},{'name':_0x4411cb(0x123d),'label':'好友申请'},{'name':_0x4411cb(0x793),'label':'角色状态'},{'name':'offlineHistoryRecords','label':_0x4411cb(0x9bb)},{'name':'offlineUISettings','label':'线下界面设置'},{'name':_0x4411cb(0x17ea),'label':'线下预设'},{'name':_0x4411cb(0x128d),'label':_0x4411cb(0x1f92)},{'name':_0x4411cb(0xe05),'label':_0x4411cb(0x1c7f)},{'name':_0x4411cb(0xdaa),'label':_0x4411cb(0x184e)},{'name':_0x4411cb(0x1b6a),'label':'短信消息'},{'name':_0x4411cb(0x19a2),'label':'聊天消息'},{'name':_0x4411cb(0x6ed),'label':_0x4411cb(0x3bd)}];let _0x560a8b=0x0;const _0x5cd559=_0x27a475[_0x4411cb(0x19ee)];for(const _0x231dfb of _0x27a475){try{showToast('正在加载\x20'+_0x231dfb['label']+_0x4411cb(0x35d)+(_0x560a8b+0x1)+'/'+_0x5cd559+')',_0x4411cb(0x477));if(db[_0x231dfb['name']]){const _0x595146=await db[_0x231dfb[_0x4411cb(0x1a1c)]][_0x4411cb(0xf13)]();_0x3c9e00[_0x231dfb[_0x4411cb(0x1a1c)]]=_0x595146,console['log'](_0x4411cb(0x1ba9)+_0x231dfb[_0x4411cb(0x8d3)]+':\x20'+_0x595146[_0x4411cb(0x19ee)]+_0x4411cb(0x834));}else console['warn'](_0x4411cb(0x1983)+_0x231dfb[_0x4411cb(0x1a1c)]+_0x4411cb(0x1a82)),_0x3c9e00[_0x231dfb[_0x4411cb(0x1a1c)]]=[];_0x560a8b++,_0x560a8b%0x5===0x0&&await new Promise(_0x31229f=>setTimeout(_0x31229f,0x64));}catch(_0xc0798f){console[_0x4411cb(0x174a)](_0x4411cb(0x4e1)+_0x231dfb[_0x4411cb(0x8d3)]+_0x4411cb(0xecb),_0xc0798f),_0x3c9e00[_0x231dfb[_0x4411cb(0x1a1c)]]=[];}}showToast('正在生成导出文件...',_0x4411cb(0x477));const _0x4a01e5=[];if(_0x3c9e00[_0x4411cb(0x2005)]?.[_0x4411cb(0x19ee)])_0x4a01e5['push'](_0x4411cb(0x1ac5)+_0x3c9e00[_0x4411cb(0x2005)]['length']+'个');if(_0x3c9e00[_0x4411cb(0x19a2)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)]('消息:\x20'+_0x3c9e00[_0x4411cb(0x19a2)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00['personas']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('面具:\x20'+_0x3c9e00['personas'][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00['contacts']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xa87)+_0x3c9e00[_0x4411cb(0x1404)][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00[_0x4411cb(0x223)]?.[_0x4411cb(0x19ee)])_0x4a01e5['push'](_0x4411cb(0x18ea)+_0x3c9e00['customEmojis'][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00['recentEmojis']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xc06)+_0x3c9e00[_0x4411cb(0x1651)]['length']+'个');if(_0x3c9e00['worldbooks']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('世界书:\x20'+_0x3c9e00['worldbooks'][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00[_0x4411cb(0x1a91)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)]('世界书条目:\x20'+_0x3c9e00[_0x4411cb(0x1a91)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x1076)]?.[_0x4411cb(0x19ee)]){_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x816)+_0x3c9e00['groupChats'][_0x4411cb(0x19ee)]+'个');let _0x4fb740=0x0;if(_0x3c9e00[_0x4411cb(0x19a2)]?.[_0x4411cb(0x19ee)]&&_0x3c9e00['groupChats']?.[_0x4411cb(0x19ee)]){const _0x48d623=_0x3c9e00[_0x4411cb(0x1076)][_0x4411cb(0x6a4)](_0x2b967a=>_0x2b967a['id']);_0x4fb740=_0x3c9e00['chatMessages'][_0x4411cb(0x1e1f)](_0x2cd653=>_0x48d623[_0x4411cb(0x1831)](_0x2cd653['characterId']))[_0x4411cb(0x19ee)];}_0x4fb740>0x0&&_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x22ac)+_0x4fb740+'条');let _0x1c9536=0x0;_0x3c9e00['groupChats']?.['length']&&_0x3c9e00[_0x4411cb(0x1076)]['forEach'](_0x14f871=>{const _0x486ec3=_0x4411cb;_0x14f871[_0x486ec3(0x12a6)]&&Array[_0x486ec3(0x1496)](_0x14f871['members'])&&(_0x1c9536+=_0x14f871[_0x486ec3(0x12a6)][_0x486ec3(0x19ee)]);}),_0x1c9536>0x0&&_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x16f8)+_0x1c9536+'个');}if(_0x3c9e00[_0x4411cb(0x9c7)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('动态:\x20'+_0x3c9e00[_0x4411cb(0x9c7)]['length']+'条');if(_0x3c9e00[_0x4411cb(0x17d5)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xd89)+_0x3c9e00[_0x4411cb(0x17d5)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x112d)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x180a)+_0x3c9e00[_0x4411cb(0x112d)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00['episodicMemory']?.['length'])_0x4a01e5['push']('情节记忆:\x20'+_0x3c9e00[_0x4411cb(0x19c1)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x156f)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('情景记忆:\x20'+_0x3c9e00[_0x4411cb(0x156f)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x203a)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1ce3)+_0x3c9e00[_0x4411cb(0x203a)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0xd61)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1230)+_0x3c9e00['memoryEvents'][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x1687)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x5be)+_0x3c9e00[_0x4411cb(0x1687)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00['coreMemories']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1350)+_0x3c9e00[_0x4411cb(0x127e)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x8ac)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1132)+_0x3c9e00[_0x4411cb(0x8ac)]['length']+'条');if(_0x3c9e00[_0x4411cb(0x233)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xf57)+_0x3c9e00[_0x4411cb(0x233)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0xd7e)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x181e)+_0x3c9e00[_0x4411cb(0xd7e)]['length']+'个');if(_0x3c9e00[_0x4411cb(0x123d)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xb71)+_0x3c9e00[_0x4411cb(0x123d)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x793)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)]('角色状态:\x20'+_0x3c9e00[_0x4411cb(0x793)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x2077)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1cde)+_0x3c9e00['characterDiaries'][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x86e)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xeda)+_0x3c9e00[_0x4411cb(0x86e)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x17ea)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1354)+_0x3c9e00[_0x4411cb(0x17ea)]['length']+'个');if(_0x3c9e00[_0x4411cb(0x128d)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1e41)+_0x3c9e00[_0x4411cb(0x128d)][_0x4411cb(0x19ee)]+'首');if(_0x3c9e00[_0x4411cb(0x1789)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x22e)+_0x3c9e00[_0x4411cb(0x1789)][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00[_0x4411cb(0x13c7)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('壁纸:\x20'+_0x3c9e00[_0x4411cb(0x13c7)][_0x4411cb(0x19ee)]+'个');if(_0x3c9e00[_0x4411cb(0x1d0c)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x9ef)+_0x3c9e00[_0x4411cb(0x1d0c)]['length']+'个');if(_0x3c9e00[_0x4411cb(0x125e)]?.['length'])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xdb3)+_0x3c9e00['diarySettings']['length']+'个');if(_0x3c9e00['innerThoughts']?.[_0x4411cb(0x19ee)])_0x4a01e5['push']('心声:\x20'+_0x3c9e00[_0x4411cb(0x1253)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00['forums']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('论坛:\x20'+_0x3c9e00[_0x4411cb(0x2147)]['length']+'个');if(_0x3c9e00['forumPosts']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xcda)+_0x3c9e00[_0x4411cb(0x14c4)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0x789)]?.[_0x4411cb(0x19ee)])_0x4a01e5['push'](_0x4411cb(0x1a67)+_0x3c9e00[_0x4411cb(0x789)]['length']+'条');if(_0x3c9e00['forumFavorites']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('论坛收藏:\x20'+_0x3c9e00[_0x4411cb(0x145c)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00[_0x4411cb(0xa46)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0x1dfd)+_0x3c9e00[_0x4411cb(0xa46)][_0x4411cb(0x19ee)]+'条');if(_0x3c9e00['forumPostImages']?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)]('论坛图片:\x20'+_0x3c9e00[_0x4411cb(0x1867)]['length']+'张');if(_0x3c9e00[_0x4411cb(0x481)]?.[_0x4411cb(0x19ee)])_0x4a01e5[_0x4411cb(0x1cd6)](_0x4411cb(0xf5a)+_0x3c9e00['forumMountedWorldbooks'][_0x4411cb(0x19ee)]+'个');console[_0x4411cb(0x2187)](_0x4411cb(0xf2c),_0x4a01e5[_0x4411cb(0x122b)](',\x20'));try{showToast(_0x4411cb(0xdae),'info');const _0x36bdda=JSON[_0x4411cb(0x6b8)](_0x3c9e00)[_0x4411cb(0x19ee)];console[_0x4411cb(0x2187)](_0x4411cb(0x2215)+(_0x36bdda/0x400/0x400)[_0x4411cb(0x13ad)](0x2)+_0x4411cb(0x1821));let _0x1ade76;_0x36bdda>0x32*0x400*0x400?(showToast('数据量较大，使用优化序列化...',_0x4411cb(0x477)),_0x1ade76=JSON[_0x4411cb(0x6b8)](_0x3c9e00,null,0x1)):_0x1ade76=JSON[_0x4411cb(0x6b8)](_0x3c9e00,null,0x2);showToast(_0x4411cb(0x1e4),'info');const _0x5747dc=0x400*0x400,_0x5d0eb0=[];for(let _0x58e18b=0x0;_0x58e18b<_0x1ade76[_0x4411cb(0x19ee)];_0x58e18b+=_0x5747dc){_0x5d0eb0[_0x4411cb(0x1cd6)](_0x1ade76[_0x4411cb(0x6d5)](_0x58e18b,_0x58e18b+_0x5747dc)),_0x5d0eb0[_0x4411cb(0x19ee)]%0xa===0x0&&await new Promise(_0xa67a63=>setTimeout(_0xa67a63,0xa));}const _0x2bcd1f=new Blob(_0x5d0eb0,{'type':_0x4411cb(0x1b82)}),_0x375f5d=URL[_0x4411cb(0x556)](_0x2bcd1f),_0x4f7765=document[_0x4411cb(0xac6)]('a');_0x4f7765['href']=_0x375f5d,_0x4f7765[_0x4411cb(0xdcb)]=_0x4411cb(0xb73)+new Date()[_0x4411cb(0x1034)]()[_0x4411cb(0x204b)]('T')[0x0]+_0x4411cb(0x1817),document[_0x4411cb(0x1da9)][_0x4411cb(0x497)](_0x4f7765),_0x4f7765[_0x4411cb(0x1859)](),document['body'][_0x4411cb(0x858)](_0x4f7765),setTimeout(()=>{const _0x3430ea=_0x4411cb;URL[_0x3430ea(0x112a)](_0x375f5d);},0x1388);}catch(_0x298b88){console[_0x4411cb(0x174a)](_0x4411cb(0x1ee8),_0x298b88);throw new Error(_0x4411cb(0xc9b)+_0x298b88[_0x4411cb(0x1e8e)]);}const _0x47e370=_0x4a01e5['length']>0x0?'\x0a'+_0x4a01e5[_0x4411cb(0x122b)]('\x0a'):'';showToast(_0x4411cb(0x1051)+_0x47e370,_0x4411cb(0x11cb));}catch(_0x2ad067){console[_0x4411cb(0x174a)](_0x4411cb(0x21ef),_0x2ad067);const _0x5e97fe=confirm(_0x4411cb(0xba2)+_0x2ad067['message']+'\x0a\x0a'+_0x4411cb(0xd26)+_0x4411cb(0xa3c)+_0x4411cb(0x221f));if(_0x5e97fe)try{await exportLightweightData();}catch(_0x56c3fb){console[_0x4411cb(0x174a)](_0x4411cb(0x1baa),_0x56c3fb),showToast('导出失败，请尝试清理浏览器缓存后重试',_0x4411cb(0x174a));}else showToast(_0x4411cb(0x1a5a),_0x4411cb(0x1816));}}async function exportLightweightData(){const _0x17632b=_0x211817;try{showToast(_0x17632b(0x178d),_0x17632b(0x477));const _0x1b3ed6={'version':'6.1-lite','exportTime':new Date()[_0x17632b(0x1034)](),'exportType':_0x17632b(0x1683),'characters':await db[_0x17632b(0x2005)][_0x17632b(0xf13)](),'chatMessages':await db[_0x17632b(0x19a2)][_0x17632b(0xf13)](),'chatSettings':await db['chatSettings'][_0x17632b(0xf13)](),'personas':await db[_0x17632b(0x1a86)][_0x17632b(0xf13)](),'contacts':await db[_0x17632b(0x1404)][_0x17632b(0xf13)](),'groupChats':await db[_0x17632b(0x1076)][_0x17632b(0xf13)](),'groupChatMessages':await db[_0x17632b(0x6ed)][_0x17632b(0xf13)](),'groupChatMembers':await db[_0x17632b(0x1b02)][_0x17632b(0xf13)](),'smsContacts':await db['smsContacts'][_0x17632b(0xf13)](),'smsMessages':await db['smsMessages']['toArray'](),'worldbooks':await db['worldbooks'][_0x17632b(0xf13)](),'worldbookEntries':await db[_0x17632b(0x1a91)][_0x17632b(0xf13)](),'workingMemory':await db[_0x17632b(0x112d)][_0x17632b(0xf13)](),'episodicMemory':await db[_0x17632b(0x19c1)][_0x17632b(0xf13)](),'episodicMemories':await db[_0x17632b(0x156f)][_0x17632b(0xf13)](),'memorySummaries':await db['memorySummaries'][_0x17632b(0xf13)](),'memoryEvents':await db[_0x17632b(0xd61)][_0x17632b(0xf13)](),'coreMemory':await db[_0x17632b(0x1687)]['toArray'](),'coreMemories':await db[_0x17632b(0x127e)][_0x17632b(0xf13)](),'crossAppTimeline':await db[_0x17632b(0x8ac)][_0x17632b(0xf13)](),'forums':await db['forums'][_0x17632b(0xf13)](),'forumPosts':await db[_0x17632b(0x14c4)][_0x17632b(0xf13)](),'forumReplies':await db[_0x17632b(0x789)][_0x17632b(0xf13)](),'forumFavorites':await db[_0x17632b(0x145c)][_0x17632b(0xf13)](),'characterGroups':await db[_0x17632b(0x12e9)][_0x17632b(0xf13)](),'characterDiaries':await db['characterDiaries']['toArray'](),'innerThoughts':await db[_0x17632b(0x1253)][_0x17632b(0xf13)](),'apiSettings':await db[_0x17632b(0x1f0c)][_0x17632b(0xf13)](),'globalSettings':await db[_0x17632b(0x181d)]['toArray'](),'anniversaries':await db['anniversaries']['toArray'](),'diarySettings':await db[_0x17632b(0x125e)][_0x17632b(0xf13)]()},_0x414fba=JSON['stringify'](_0x1b3ed6,null,0x1),_0x506af1=new Blob([_0x414fba],{'type':_0x17632b(0x1b82)}),_0x132af2=URL[_0x17632b(0x556)](_0x506af1),_0x517b2c=document[_0x17632b(0xac6)]('a');_0x517b2c[_0x17632b(0x1f9)]=_0x132af2,_0x517b2c[_0x17632b(0xdcb)]=_0x17632b(0x2093)+new Date()[_0x17632b(0x1034)]()[_0x17632b(0x204b)]('T')[0x0]+'.json',document[_0x17632b(0x1da9)]['appendChild'](_0x517b2c),_0x517b2c[_0x17632b(0x1859)](),document[_0x17632b(0x1da9)][_0x17632b(0x858)](_0x517b2c),setTimeout(()=>URL['revokeObjectURL'](_0x132af2),0xbb8);const _0x4926c2=[];if(_0x1b3ed6[_0x17632b(0x2005)]?.[_0x17632b(0x19ee)])_0x4926c2['push'](_0x17632b(0x1ac5)+_0x1b3ed6['characters']['length']+'个');if(_0x1b3ed6[_0x17632b(0x19a2)]?.['length'])_0x4926c2[_0x17632b(0x1cd6)](_0x17632b(0x1575)+_0x1b3ed6['chatMessages']['length']+'条');if(_0x1b3ed6['workingMemory']?.['length']||_0x1b3ed6[_0x17632b(0x19c1)]?.[_0x17632b(0x19ee)]||_0x1b3ed6[_0x17632b(0x1687)]?.[_0x17632b(0x19ee)]){const _0x26312b=(_0x1b3ed6[_0x17632b(0x112d)]?.[_0x17632b(0x19ee)]||0x0)+(_0x1b3ed6[_0x17632b(0x19c1)]?.[_0x17632b(0x19ee)]||0x0)+(_0x1b3ed6[_0x17632b(0x1687)]?.['length']||0x0)+(_0x1b3ed6[_0x17632b(0x156f)]?.[_0x17632b(0x19ee)]||0x0)+(_0x1b3ed6[_0x17632b(0x127e)]?.[_0x17632b(0x19ee)]||0x0);_0x4926c2[_0x17632b(0x1cd6)]('记忆:\x20'+_0x26312b+'条');}if(_0x1b3ed6[_0x17632b(0x21f8)]?.[_0x17632b(0x19ee)])_0x4926c2[_0x17632b(0x1cd6)](_0x17632b(0x1440)+_0x1b3ed6['worldbooks']['length']+'个');if(_0x1b3ed6['forums']?.['length'])_0x4926c2[_0x17632b(0x1cd6)]('论坛:\x20'+_0x1b3ed6[_0x17632b(0x2147)][_0x17632b(0x19ee)]+'个');const _0x1f2b63=_0x4926c2[_0x17632b(0x19ee)]>0x0?'\x0a'+_0x4926c2['join'](',\x20'):'';showToast(_0x17632b(0x1d78)+_0x1f2b63,_0x17632b(0x11cb));}catch(_0x1a69b9){console[_0x17632b(0x174a)]('❌\x20轻量级导出失败:',_0x1a69b9);throw _0x1a69b9;}}function showCleanupOptions(){const _0x38774c=_0x211817;let _0x9fe4a8=0x0,_0x1052d0=0x0;Object[_0x38774c(0x1c9f)](localStorage)[_0x38774c(0x19fb)](_0x3b1857=>{const _0x56cb48=_0x38774c,_0x4c8875=(localStorage[_0x56cb48(0x15d8)](_0x3b1857)||'')['length'];if(_0x3b1857[_0x56cb48(0x1b30)]('offlineUISettings_')&&_0x3b1857['includes'](_0x56cb48(0x12af)))_0x9fe4a8+=_0x4c8875;else _0x3b1857==='diary-custom-background'&&(_0x1052d0+=_0x4c8875);});const _0x579c58=_0x50409b=>{const _0x236c80=_0x38774c;if(_0x50409b<0x400)return _0x50409b+'B';if(_0x50409b<0x400*0x400)return(_0x50409b/0x400)[_0x236c80(0x13ad)](0x1)+'KB';return(_0x50409b/(0x400*0x400))[_0x236c80(0x13ad)](0x1)+'MB';},_0xa8be73=[_0x38774c(0x11f1),_0x38774c(0x1180),_0x38774c(0xfa5)+_0x579c58(_0x9fe4a8)+_0x38774c(0x1cab),_0x38774c(0xd04)+_0x579c58(_0x1052d0)+')'],_0x3c9b47=prompt(_0x38774c(0x1e47)+_0xa8be73[_0x38774c(0x122b)]('\x0a')+_0x38774c(0xd1b));if(_0x3c9b47)executeCleanupOptions(_0x3c9b47);}async function executeCleanupOptions(_0x4459e3){const _0x20978b=_0x211817,_0xfe45e3=_0x4459e3[_0x20978b(0x204b)](',')['map'](_0x13151a=>parseInt(_0x13151a[_0x20978b(0x19d7)]()))['filter'](_0x5abf6a=>_0x5abf6a>=0x1&&_0x5abf6a<=0x4);if(!_0xfe45e3[_0x20978b(0x19ee)])return;showToast(_0x20978b(0x5b6),_0x20978b(0x477));let _0x5e49df=0x0,_0x35a35c=0x0;for(const _0x1db795 of _0xfe45e3){switch(_0x1db795){case 0x1:Object[_0x20978b(0x1c9f)](chatMessages)[_0x20978b(0x19fb)](_0x58fead=>{const _0x52e8a9=_0x20978b;!chatMessages[_0x58fead]?.[_0x52e8a9(0x19ee)]&&(delete chatMessages[_0x58fead],_0x5e49df++);});break;case 0x2:const _0x1992ab=await compressAllImagesEnhanced();_0x5e49df+=_0x1992ab[_0x20978b(0xc44)],_0x35a35c+=_0x1992ab[_0x20978b(0xf38)];break;case 0x3:for(let _0x362ac7=localStorage[_0x20978b(0x19ee)]-0x1;_0x362ac7>=0x0;_0x362ac7--){const _0x5ea782=localStorage['key'](_0x362ac7);_0x5ea782?.[_0x20978b(0x1b30)](_0x20978b(0xc39))&&_0x5ea782['includes'](_0x20978b(0x12af))&&(_0x35a35c+=(localStorage[_0x20978b(0x15d8)](_0x5ea782)||'')['length'],localStorage[_0x20978b(0x3b2)](_0x5ea782),_0x5e49df++);}break;case 0x4:const _0x3bd2f4=_0x20978b(0xa51);if(localStorage[_0x20978b(0x15d8)](_0x3bd2f4)){_0x35a35c+=(localStorage[_0x20978b(0x15d8)](_0x3bd2f4)||'')[_0x20978b(0x19ee)],localStorage[_0x20978b(0x3b2)](_0x3bd2f4),_0x5e49df++;for(let _0x39b2fa=localStorage['length']-0x1;_0x39b2fa>=0x0;_0x39b2fa--){const _0xeef242=localStorage['key'](_0x39b2fa);_0xeef242?.['includes'](_0x20978b(0x1769))&&(_0x35a35c+=(localStorage[_0x20978b(0x15d8)](_0xeef242)||'')['length'],localStorage[_0x20978b(0x3b2)](_0xeef242),_0x5e49df++);}}break;}}await saveChatSettings();try{const _0xf2cb10=Object[_0x20978b(0x1c9f)](chatMessages)[_0x20978b(0x1e1f)](_0x5223a4=>chatMessages[_0x5223a4]&&chatMessages[_0x5223a4]['length']>0x0);await saveChatMessagesImmediate(_0xf2cb10),console[_0x20978b(0x2187)](_0x20978b(0xdd6));}catch(_0x10637d){console[_0x20978b(0x174a)](_0x20978b(0x2310),_0x10637d),await saveChatMessages();}calculateStorageUsage();const _0x33a486=_0x7c6b3e=>{if(_0x7c6b3e<0x400)return _0x7c6b3e+'B';if(_0x7c6b3e<0x400*0x400)return(_0x7c6b3e/0x400)['toFixed'](0x1)+'KB';return(_0x7c6b3e/(0x400*0x400))['toFixed'](0x1)+'MB';};showToast(_0x20978b(0x1882)+_0x5e49df+_0x20978b(0xb67)+_0x33a486(_0x35a35c)+'\x20空间',_0x20978b(0x11cb));}async function compressAllImages(){const _0x2db744=_0x211817,_0x3f116d=_0x433afe=>{const _0xc5cc34=_0x167f;if(_0x433afe<0x400)return _0x433afe+'B';if(_0x433afe<0x400*0x400)return(_0x433afe/0x400)[_0xc5cc34(0x13ad)](0x1)+'KB';return(_0x433afe/(0x400*0x400))[_0xc5cc34(0x13ad)](0x1)+'MB';},_0x1fa3d9=await compressAllImagesEnhanced();showToast(_0x2db744(0x15e8)+_0x1fa3d9['count']+_0x2db744(0xe76)+_0x3f116d(_0x1fa3d9[_0x2db744(0xf38)])+'\x20空间',_0x2db744(0x11cb));}async function compressAllImagesEnhanced(){const _0xe9f876=_0x211817;let _0x3b25e4=0x0,_0x229709=0x0;const _0x4783b1=_0x3814f2=>{const _0x4f800d=_0x167f;if(_0x3814f2<0x400)return _0x3814f2+'B';if(_0x3814f2<0x400*0x400)return(_0x3814f2/0x400)[_0x4f800d(0x13ad)](0x1)+'KB';return(_0x3814f2/(0x400*0x400))[_0x4f800d(0x13ad)](0x1)+'MB';};try{for(const _0x37f23 of characters){if(_0x37f23['avatarUrl']?.[_0xe9f876(0x19ee)]>0x7530){const _0x4b6ffb=_0x37f23[_0xe9f876(0x1994)][_0xe9f876(0x19ee)];_0x37f23[_0xe9f876(0x1994)]=await compressImage(_0x37f23['avatarUrl'],0x78,0.7),_0x229709+=_0x4b6ffb-_0x37f23[_0xe9f876(0x1994)][_0xe9f876(0x19ee)],_0x3b25e4++;}}await saveCharacters();for(const _0x5d86ee of Object[_0xe9f876(0x1c9f)](chatSettings)){const _0x3a3c22=chatSettings[_0x5d86ee];if(_0x3a3c22?.[_0xe9f876(0x179f)]?.[_0xe9f876(0x19ee)]>0x7530){const _0x50a9f1=_0x3a3c22[_0xe9f876(0x179f)][_0xe9f876(0x19ee)];_0x3a3c22[_0xe9f876(0x179f)]=await compressImage(_0x3a3c22[_0xe9f876(0x179f)],0x78,0.7),_0x229709+=_0x50a9f1-_0x3a3c22[_0xe9f876(0x179f)][_0xe9f876(0x19ee)],_0x3b25e4++;}if(_0x3a3c22?.[_0xe9f876(0x11cd)]?.['length']>0x7530){const _0x489b60=_0x3a3c22['myChatAvatar'][_0xe9f876(0x19ee)];_0x3a3c22['myChatAvatar']=await compressImage(_0x3a3c22[_0xe9f876(0x11cd)],0x78,0.7),_0x229709+=_0x489b60-_0x3a3c22[_0xe9f876(0x11cd)][_0xe9f876(0x19ee)],_0x3b25e4++;}}await saveChatSettings();for(let _0x379b09=localStorage[_0xe9f876(0x19ee)]-0x1;_0x379b09>=0x0;_0x379b09--){const _0x53f93b=localStorage[_0xe9f876(0x213c)](_0x379b09);if(_0x53f93b?.[_0xe9f876(0x1831)]('-custom-background')||_0x53f93b===_0xe9f876(0xa51)){const _0x44b1e5=localStorage[_0xe9f876(0x15d8)](_0x53f93b);if(_0x44b1e5&&_0x44b1e5[_0xe9f876(0x19ee)]>0xc350){const _0x4e254f=_0x44b1e5[_0xe9f876(0x19ee)],_0x40d237=await compressImage(_0x44b1e5,0x320,0.8);localStorage['setItem'](_0x53f93b,_0x40d237),_0x229709+=_0x4e254f-_0x40d237[_0xe9f876(0x19ee)],_0x3b25e4++;}}}for(const _0x2a00e5 of Object['keys'](chatMessages)){const _0xcaef77=chatMessages[_0x2a00e5]||[];let _0x1b57e7=![];for(const _0x39059a of _0xcaef77){if(_0x39059a['image']&&_0x39059a[_0xe9f876(0x68e)][_0xe9f876(0x19ee)]>0x7530){const _0x5470ad=_0x39059a[_0xe9f876(0x68e)][_0xe9f876(0x19ee)];_0x39059a['image']=await compressImage(_0x39059a[_0xe9f876(0x68e)],0x190,0.8),_0x229709+=_0x5470ad-_0x39059a['image'][_0xe9f876(0x19ee)],_0x3b25e4++,_0x1b57e7=!![];}if(Array['isArray'](_0x39059a[_0xe9f876(0x211c)]))for(const _0x3603c4 of _0x39059a[_0xe9f876(0x211c)]){if(_0x3603c4[_0xe9f876(0x1a4b)]===_0xe9f876(0x910)&&_0x3603c4[_0xe9f876(0x910)]?.['url']?.[_0xe9f876(0x19ee)]>0x7530){const _0x46ce25=_0x3603c4[_0xe9f876(0x910)][_0xe9f876(0x40f)][_0xe9f876(0x19ee)];_0x3603c4[_0xe9f876(0x910)]['url']=await compressImage(_0x3603c4[_0xe9f876(0x910)][_0xe9f876(0x40f)],0x190,0.8),_0x229709+=_0x46ce25-_0x3603c4['image_url']['url']['length'],_0x3b25e4++,_0x1b57e7=!![];}}}_0x1b57e7&&await saveChatMessages(_0x2a00e5);}for(let _0x3a0bb1=localStorage['length']-0x1;_0x3a0bb1>=0x0;_0x3a0bb1--){const _0x2fade7=localStorage['key'](_0x3a0bb1);if(_0x2fade7?.[_0xe9f876(0x1831)]('emoji')||_0x2fade7?.[_0xe9f876(0x1831)](_0xe9f876(0x13a9))){const _0x106b9b=localStorage[_0xe9f876(0x15d8)](_0x2fade7);if(_0x106b9b&&_0x106b9b[_0xe9f876(0x19ee)]>0x4e20)try{const _0x3aa244=_0x106b9b['length'],_0x2e6e3e=await compressImage(_0x106b9b,0xc8,0.8);localStorage[_0xe9f876(0x192)](_0x2fade7,_0x2e6e3e),_0x229709+=_0x3aa244-_0x2e6e3e[_0xe9f876(0x19ee)],_0x3b25e4++;}catch(_0x4fc3dd){continue;}}}return calculateStorageUsage(),{'count':_0x3b25e4,'savedSpace':_0x229709};}catch(_0x16ae6f){return console[_0xe9f876(0x174a)](_0xe9f876(0x19dc),_0x16ae6f),{'count':_0x3b25e4,'savedSpace':_0x229709};}}async function debugListAllCharacters(){const _0x267ccc=_0x211817;try{console[_0x267ccc(0x2187)](_0x267ccc(0x1ddb));const _0x4dc7e3=await db['characters']['toArray']();console[_0x267ccc(0x2187)](_0x267ccc(0x1ba4),_0x4dc7e3[_0x267ccc(0x6a4)](_0x5ceda3=>_0x5ceda3[_0x267ccc(0x1a1c)]+_0x267ccc(0x1d3e)+_0x5ceda3['id']+')'));window[_0x267ccc(0x2005)]&&console[_0x267ccc(0x2187)](_0x267ccc(0x12e4),window['characters'][_0x267ccc(0x6a4)](_0x493869=>_0x493869[_0x267ccc(0x1a1c)]+_0x267ccc(0x1d3e)+_0x493869['id']+')'));window[_0x267ccc(0x1404)]&&console[_0x267ccc(0x2187)](_0x267ccc(0xf96),window[_0x267ccc(0x1404)]);const _0x3108ef=await db[_0x267ccc(0x17d5)]['toArray'](),_0x24c903=[...new Set(_0x3108ef[_0x267ccc(0x6a4)](_0x5a566c=>_0x5a566c[_0x267ccc(0x215c)]+'\x20(ID:\x20'+_0x5a566c['authorId']+')'))];console[_0x267ccc(0x2187)](_0x267ccc(0x13f0),_0x24c903);const _0xe9970d=await db[_0x267ccc(0x40a)][_0x267ccc(0xf13)](),_0x260c11=[...new Set(_0xe9970d['map'](_0x44f03b=>_0x44f03b[_0x267ccc(0x1a1c)]+'\x20(ID:\x20'+_0x44f03b[_0x267ccc(0x22d2)]+')'))];return console[_0x267ccc(0x2187)](_0x267ccc(0xa72),_0x260c11),{'dbChars':_0x4dc7e3,'comments':_0x3108ef,'likes':_0xe9970d};}catch(_0x3c6f04){console[_0x267ccc(0x174a)]('调试失败:',_0x3c6f04);}}async function debugDeleteCharacterById(_0x11b3d7){const _0x3b7412=_0x211817;if(!_0x11b3d7){console[_0x3b7412(0x2187)]('用法:\x20debugDeleteCharacterById(\x22角色ID\x22)');return;}try{console[_0x3b7412(0x2187)](_0x3b7412(0x202c)+_0x11b3d7);let _0x503388=0x0;const _0x2b4465=await db[_0x3b7412(0x17d5)][_0x3b7412(0xa24)]('authorId')[_0x3b7412(0x1694)](_0x11b3d7)[_0x3b7412(0xf13)]();for(const _0x2d5e84 of _0x2b4465){await db['momentComments']['delete'](_0x2d5e84['id']),_0x503388++,console[_0x3b7412(0x2187)](_0x3b7412(0xc01)+_0x2d5e84[_0x3b7412(0x215c)]+_0x3b7412(0x1811)+_0x2d5e84[_0x3b7412(0x1378)]);}const _0x46b004=await db[_0x3b7412(0x40a)]['where']('authorId')['equals'](_0x11b3d7)[_0x3b7412(0xf13)]();for(const _0x336712 of _0x46b004){await db['momentLikes'][_0x3b7412(0x1f4a)]([_0x336712[_0x3b7412(0x9ba)],_0x336712[_0x3b7412(0x22d2)]]),_0x503388++,console['log'](_0x3b7412(0x84a)+_0x336712[_0x3b7412(0x1a1c)]);}const _0x5c3008=await db[_0x3b7412(0x19a2)][_0x3b7412(0xa24)](_0x3b7412(0xaf5))[_0x3b7412(0x1694)](_0x11b3d7)['toArray']();for(const _0x3f1530 of _0x5c3008){await db[_0x3b7412(0x19a2)][_0x3b7412(0x1f4a)](_0x3f1530['id']),_0x503388++;}const _0x47ba52=await db[_0x3b7412(0x1789)]['toArray']();for(const _0x2a16bc of _0x47ba52){_0x2a16bc[_0x3b7412(0xaf5)]===_0x11b3d7&&(await db[_0x3b7412(0x1789)][_0x3b7412(0x1f4a)](_0x2a16bc['id']),_0x503388++);}await db[_0x3b7412(0x2005)][_0x3b7412(0x1f4a)](_0x11b3d7),_0x503388++;window[_0x3b7412(0x1404)]&&(window[_0x3b7412(0x1404)]=window[_0x3b7412(0x1404)][_0x3b7412(0x1e1f)](_0xdb834f=>_0xdb834f!==_0x11b3d7),await saveContacts());window['characters']&&(window[_0x3b7412(0x2005)]=window[_0x3b7412(0x2005)][_0x3b7412(0x1e1f)](_0x3d1c09=>_0x3d1c09['id']!==_0x11b3d7));console[_0x3b7412(0x2187)]('删除完成！共删除\x20'+_0x503388+_0x3b7412(0xb1e));if(window['renderContactList'])window[_0x3b7412(0x1001)]();if(window[_0x3b7412(0xe24)])window[_0x3b7412(0xe24)]();}catch(_0x4f7cbd){console[_0x3b7412(0x174a)](_0x3b7412(0x717),_0x4f7cbd);}}async function forceDeleteCharacter(){const _0xb3db66=_0x211817,_0x15c810=prompt(_0xb3db66(0x11d9));if(!_0x15c810||!_0x15c810[_0xb3db66(0x19d7)]())return;try{showToast(_0xb3db66(0x107a)+_0x15c810+_0xb3db66(0x1de6),_0xb3db66(0x477));let _0x92877c=0x0;const _0x234101=await db[_0xb3db66(0x17d5)][_0xb3db66(0xf13)]();for(const _0x29d7a8 of _0x234101){(_0x29d7a8[_0xb3db66(0x215c)]===_0x15c810||_0x29d7a8[_0xb3db66(0x22d2)]&&_0x29d7a8['authorId'][_0xb3db66(0x1831)](_0x15c810))&&(await db[_0xb3db66(0x17d5)]['delete'](_0x29d7a8['id']),_0x92877c++,console[_0xb3db66(0x2187)](_0xb3db66(0x7c0)+_0x29d7a8[_0xb3db66(0x215c)]+_0xb3db66(0x1811)+_0x29d7a8[_0xb3db66(0x1378)]));}const _0x440982=await db[_0xb3db66(0x40a)][_0xb3db66(0xf13)]();for(const _0x4e1f2e of _0x440982){(_0x4e1f2e[_0xb3db66(0x1a1c)]===_0x15c810||_0x4e1f2e[_0xb3db66(0x22d2)]&&_0x4e1f2e[_0xb3db66(0x22d2)]['includes'](_0x15c810))&&(await db[_0xb3db66(0x40a)][_0xb3db66(0x1f4a)]([_0x4e1f2e[_0xb3db66(0x9ba)],_0x4e1f2e['authorId']]),_0x92877c++,console[_0xb3db66(0x2187)](_0xb3db66(0x16cf)+_0x4e1f2e['name']));}const _0xa80190=await db[_0xb3db66(0x19a2)][_0xb3db66(0xf13)]();for(const _0x596d57 of _0xa80190){_0x596d57[_0xb3db66(0xaf5)]&&_0x596d57['characterId'][_0xb3db66(0x1831)](_0x15c810)&&(await db['chatMessages']['delete'](_0x596d57['id']),_0x92877c++);}const _0x5bd0c1=await db['chatSettings'][_0xb3db66(0xf13)]();for(const _0x242aec of _0x5bd0c1){_0x242aec[_0xb3db66(0xaf5)]&&_0x242aec[_0xb3db66(0xaf5)][_0xb3db66(0x1831)](_0x15c810)&&(await db[_0xb3db66(0x1789)][_0xb3db66(0x1f4a)](_0x242aec['id']),_0x92877c++);}const _0x129f74=await db[_0xb3db66(0x2005)]['toArray']();for(const _0x53c980 of _0x129f74){(_0x53c980[_0xb3db66(0x1a1c)]===_0x15c810||_0x53c980['id'][_0xb3db66(0x1831)](_0x15c810))&&(await db[_0xb3db66(0x2005)][_0xb3db66(0x1f4a)](_0x53c980['id']),_0x92877c++,console[_0xb3db66(0x2187)](_0xb3db66(0x1f22)+_0x53c980['name']+'\x20('+_0x53c980['id']+')'));}window['contacts']&&(window[_0xb3db66(0x1404)]=window['contacts']['filter'](_0x3908d2=>!_0x3908d2['includes'](_0x15c810)),await saveContacts());window[_0xb3db66(0x2005)]&&(window[_0xb3db66(0x2005)]=window[_0xb3db66(0x2005)]['filter'](_0x23df9e=>_0x23df9e[_0xb3db66(0x1a1c)]!==_0x15c810));window[_0xb3db66(0x19a2)]&&Object[_0xb3db66(0x1c9f)](window['chatMessages'])[_0xb3db66(0x19fb)](_0x1397f8=>{const _0x4a8693=_0xb3db66;_0x1397f8[_0x4a8693(0x1831)](_0x15c810)&&delete window['chatMessages'][_0x1397f8];});window[_0xb3db66(0x1789)]&&Object[_0xb3db66(0x1c9f)](window[_0xb3db66(0x1789)])[_0xb3db66(0x19fb)](_0x2a37dc=>{const _0x132e36=_0xb3db66;_0x2a37dc[_0x132e36(0x1831)](_0x15c810)&&delete window['chatSettings'][_0x2a37dc];});if(window[_0xb3db66(0x1001)])window[_0xb3db66(0x1001)]();if(window['renderMessageList'])window[_0xb3db66(0xe24)]();showToast(_0xb3db66(0x1b46)+_0x92877c+_0xb3db66(0xb1e),_0xb3db66(0x11cb)),console[_0xb3db66(0x2187)](_0xb3db66(0xb87)+_0x15c810+'\x22\x20完成，删除了\x20'+_0x92877c+'\x20条记录');}catch(_0x1ee944){console[_0xb3db66(0x174a)]('强制删除失败:',_0x1ee944),showToast(_0xb3db66(0x123c)+_0x1ee944[_0xb3db66(0x1e8e)],'error');}}async function cleanupOrphanedContacts(){const _0x2d35c3=_0x211817;try{showToast('正在清理孤立数据...',_0x2d35c3(0x477));let _0x1e6aad=0x0;const _0x119345=characters[_0x2d35c3(0x6a4)](_0x4103c5=>_0x4103c5['id']),_0x278c28=contacts[_0x2d35c3(0x19ee)];contacts=contacts[_0x2d35c3(0x1e1f)](_0x59ba19=>{const _0x36a967=_0x119345['includes'](_0x59ba19);if(!_0x36a967)_0x1e6aad++;return _0x36a967;});const _0x3e08e1=await db[_0x2d35c3(0x1404)]['toArray']();for(const _0x3882de of _0x3e08e1){!_0x119345[_0x2d35c3(0x1831)](_0x3882de[_0x2d35c3(0xaf5)])&&(await db[_0x2d35c3(0x1404)][_0x2d35c3(0x1f4a)](_0x3882de['id']),_0x1e6aad++);}const _0xa0bc7a=Object['keys'](chatMessages);for(const _0xf39b39 of _0xa0bc7a){!_0x119345[_0x2d35c3(0x1831)](_0xf39b39)&&(delete chatMessages[_0xf39b39],_0x1e6aad++);}const _0x42ecbf=await db['chatMessages']['toArray']();for(const _0x266ac3 of _0x42ecbf){!_0x119345[_0x2d35c3(0x1831)](_0x266ac3[_0x2d35c3(0xaf5)])&&(await db['chatMessages'][_0x2d35c3(0x1f4a)](_0x266ac3['id']),_0x1e6aad++);}const _0x268e26=Object[_0x2d35c3(0x1c9f)](chatSettings);for(const _0x4454ab of _0x268e26){!_0x119345[_0x2d35c3(0x1831)](_0x4454ab)&&(delete chatSettings[_0x4454ab],_0x1e6aad++);}const _0x313ff7=await db[_0x2d35c3(0x1789)]['toArray']();for(const _0x3dbccf of _0x313ff7){!_0x119345[_0x2d35c3(0x1831)](_0x3dbccf['characterId'])&&(await db['chatSettings']['delete'](_0x3dbccf['id']),_0x1e6aad++);}const _0x298164=await db[_0x2d35c3(0x17d5)][_0x2d35c3(0xf13)]();for(const _0x1058bb of _0x298164){_0x1058bb[_0x2d35c3(0x22d2)]!=='user'&&!_0x119345[_0x2d35c3(0x1831)](_0x1058bb[_0x2d35c3(0x22d2)])&&(await db[_0x2d35c3(0x17d5)][_0x2d35c3(0x1f4a)](_0x1058bb['id']),_0x1e6aad++,console[_0x2d35c3(0x2187)](_0x2d35c3(0x15ff)+_0x1058bb['nickname']+'('+_0x1058bb[_0x2d35c3(0x22d2)]+')'));}const _0x1af157=await db['momentLikes'][_0x2d35c3(0xf13)]();for(const _0x552d9b of _0x1af157){_0x552d9b['authorId']!==_0x2d35c3(0xa80)&&!_0x119345[_0x2d35c3(0x1831)](_0x552d9b['authorId'])&&(await db[_0x2d35c3(0x40a)][_0x2d35c3(0x1f4a)]([_0x552d9b[_0x2d35c3(0x9ba)],_0x552d9b[_0x2d35c3(0x22d2)]]),_0x1e6aad++,console[_0x2d35c3(0x2187)](_0x2d35c3(0x174b)+_0x552d9b['name']+'('+_0x552d9b['authorId']+')'));}await Promise[_0x2d35c3(0x1a47)]([saveContacts(),saveChatMessages(),saveChatSettings()]),renderContactList(),renderMessageList(),showToast(_0x2d35c3(0x11f6)+_0x1e6aad+_0x2d35c3(0x22dc),_0x2d35c3(0x11cb)),console[_0x2d35c3(0x2187)](_0x2d35c3(0x14f9),{'有效角色数':_0x119345[_0x2d35c3(0x19ee)],'清理前联系人数':_0x278c28,'清理后联系人数':contacts[_0x2d35c3(0x19ee)],'总清理项目':_0x1e6aad});}catch(_0xd29296){console[_0x2d35c3(0x174a)](_0x2d35c3(0x1681),_0xd29296),showToast(_0x2d35c3(0x1ef8)+_0xd29296[_0x2d35c3(0x1e8e)],_0x2d35c3(0x174a));}}async function clearAllData(){const _0x3ee394=_0x211817,_0x38ecec=prompt(_0x3ee394(0x1f4e));if(_0x38ecec!==_0x3ee394(0x22d9))return;try{showToast(_0x3ee394(0x1129),_0x3ee394(0x477)),await Promise['all']([db['characters']['clear'](),db[_0x3ee394(0x1404)]['clear'](),db[_0x3ee394(0x19a2)]['clear'](),db['personas'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x223)]['clear'](),db[_0x3ee394(0x1651)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x21f8)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1a91)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x12e9)][_0x3ee394(0xa4f)](),db['groupChats'][_0x3ee394(0xa4f)](),db['groupChatMessages']['clear'](),db['groupChatMembers'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x9c7)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x40a)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x17d5)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x367)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x5ea)]['clear'](),db[_0x3ee394(0x230c)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x112d)][_0x3ee394(0xa4f)](),db['episodicMemory'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x156f)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x203a)][_0x3ee394(0xa4f)](),db[_0x3ee394(0xd61)]['clear'](),db[_0x3ee394(0x1687)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x127e)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x8ac)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x233)][_0x3ee394(0xa4f)](),db[_0x3ee394(0xd7e)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x123d)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x793)]['clear'](),db[_0x3ee394(0x2077)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x125e)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x86e)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1486)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x17ea)]['clear'](),db['musicPlaylist'][_0x3ee394(0xa4f)](),db[_0x3ee394(0xe05)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1f0c)][_0x3ee394(0xa4f)](),db['globalSettings'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x13c7)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x11fd)][_0x3ee394(0xa4f)](),db['chatSettings'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1253)]['clear'](),db[_0x3ee394(0x2147)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x14c4)]['clear'](),db[_0x3ee394(0x789)][_0x3ee394(0xa4f)](),db['forumFavorites'][_0x3ee394(0xa4f)](),db[_0x3ee394(0xa46)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1867)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x481)][_0x3ee394(0xa4f)](),db[_0x3ee394(0xdaa)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1b6a)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1d0c)]['clear'](),db['appointments']['clear'](),db['characterFootprints']['clear'](),db[_0x3ee394(0xd0c)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x159e)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x529)][_0x3ee394(0xa4f)](),db['soundSettings'][_0x3ee394(0xa4f)](),db[_0x3ee394(0x178a)]['clear'](),db[_0x3ee394(0x1155)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x19bc)]['clear'](),db[_0x3ee394(0x1dde)][_0x3ee394(0xa4f)](),db[_0x3ee394(0x1742)]['clear']()]),characters=[],chatMessages={},chatSettings={},customEmojis=[],contacts=[],groupChats=[],characterGroups=[],currentChatCharacter=null,currentGroupChat=null;if(typeof personas!==_0x3ee394(0xcba))personas=[];if(typeof worldbooks!==_0x3ee394(0xcba))worldbooks=[];if(typeof musicPlaylist!==_0x3ee394(0xcba))musicPlaylist=[];if(typeof smsMessages!==_0x3ee394(0xcba))smsMessages={};if(typeof anniversaries!==_0x3ee394(0xcba))anniversaries=[];if(typeof appointments!==_0x3ee394(0xcba))appointments=[];for(let _0x5cace4=localStorage['length']-0x1;_0x5cace4>=0x0;_0x5cace4--){const _0x502263=localStorage[_0x3ee394(0x213c)](_0x5cace4);_0x502263&&(_0x502263['startsWith']('chatSettings_')||_0x502263['startsWith'](_0x3ee394(0x1404))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x2005))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x19a2))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1076))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x12e9))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1a86))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x223))||_0x502263[_0x3ee394(0x1b30)]('worldbooks')||_0x502263['startsWith'](_0x3ee394(0x9c7))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x128d))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1b6a))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1d0c))||_0x502263[_0x3ee394(0x1b30)]('appointments')||_0x502263['startsWith'](_0x3ee394(0x2147))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0xcd5))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0xc39))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x17ea))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1d14))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x159e))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x62a))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1ec6))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0xb9e))||_0x502263['startsWith'](_0x3ee394(0x18b9))||_0x502263[_0x3ee394(0x1b30)](_0x3ee394(0x1a6c)))&&localStorage[_0x3ee394(0x3b2)](_0x502263);}renderCharacterList(),renderMessageList(),renderContactList(),calculateStorageUsage();const _0x3ed43c=document['getElementById'](_0x3ee394(0x12b1));if(_0x3ed43c)_0x3ed43c[_0x3ee394(0x33a)]='';const _0x4440ad=document['getElementById'](_0x3ee394(0x1f2f));if(_0x4440ad)_0x4440ad[_0x3ee394(0x33a)]='';const _0x838f90=document[_0x3ee394(0x1262)]('music-list');if(_0x838f90)_0x838f90[_0x3ee394(0x33a)]='';const _0x53ac56=document[_0x3ee394(0x1262)](_0x3ee394(0x1446));if(_0x53ac56)_0x53ac56[_0x3ee394(0x33a)]='';const _0xc12d54=document[_0x3ee394(0x1262)](_0x3ee394(0xf68));if(_0xc12d54)_0xc12d54[_0x3ee394(0x33a)]='';const _0x5c7bea=document[_0x3ee394(0xb30)](_0x3ee394(0xed2));if(_0x5c7bea)_0x5c7bea['textContent']='聊天';showToast(_0x3ee394(0x2198),_0x3ee394(0x11cb)),console[_0x3ee394(0x2187)](_0x3ee394(0xace)),setTimeout(()=>{const _0x36a2c6=_0x3ee394;hideApp('data-management-screen'),hideApp(_0x36a2c6(0x19bd)),showApp('chat-screen');},0x7d0);}catch(_0x33d9e9){console[_0x3ee394(0x174a)](_0x3ee394(0x283),_0x33d9e9),showToast(_0x3ee394(0x1a10)+_0x33d9e9[_0x3ee394(0x1e8e)],'error');}}let currentTransferMsg=null;async function processUserTransfer(_0x511234,_0x520baa,_0x14af40){const _0xb3e6f7=_0x211817;console[_0xb3e6f7(0x2187)]('🚀\x20[转账处理]\x20开始处理AI对转账的回复:',{'userTransferMsg':_0x511234,'aiMessages':_0x520baa,'characterId':_0x14af40});if(!_0x511234||!_0x14af40){console[_0xb3e6f7(0x2187)](_0xb3e6f7(0xa09));return;}let _0x5dd589=null,_0xba03b='';for(const _0x278ac1 of _0x520baa){if(typeof _0x278ac1==='object'&&_0x278ac1[_0xb3e6f7(0x1a4b)]===_0xb3e6f7(0x1f46)){_0x5dd589=_0x278ac1[_0xb3e6f7(0x211f)],console[_0xb3e6f7(0x2187)](_0xb3e6f7(0x1e42),_0x278ac1);break;}if(typeof _0x278ac1==='string')_0xba03b+=_0x278ac1+'\x20';else typeof _0x278ac1===_0xb3e6f7(0x28d)&&_0x278ac1[_0xb3e6f7(0x211c)]&&(_0xba03b+=_0x278ac1[_0xb3e6f7(0x211c)]+'\x20');}_0xba03b=_0xba03b[_0xb3e6f7(0x19d7)]()[_0xb3e6f7(0x49e)](),console[_0xb3e6f7(0x2187)]('🔥\x20[转账处理]\x20AI完整回复内容:',_0xba03b);const _0x5a7525=[_0xb3e6f7(0x874),'收下','收款','接受',_0xb3e6f7(0x176a),_0xb3e6f7(0xeb8),'收到了','收到','收了','要了','拿了','接收了','接收','谢谢','感谢','多谢',_0xb3e6f7(0xc94),'好的','可以','行'],_0x41d78a=['退回','拒绝','不收','不要',_0xb3e6f7(0x18a5),_0xb3e6f7(0x1018),'退给你',_0xb3e6f7(0x1a4c),'算了',_0xb3e6f7(0x1764),_0xb3e6f7(0x1e84),'拿着','留着','不用','不行',_0xb3e6f7(0x17d7)];let _0x5d070d=![],_0xc5c7c0=![],_0x3b68db=[];if(_0x5dd589)_0x5d070d=_0x5dd589===_0xb3e6f7(0x1515),_0xc5c7c0=_0x5dd589===_0xb3e6f7(0x30e),console[_0xb3e6f7(0x2187)]('🔥\x20[转账处理]\x20使用明确指令:',{'transferAction':_0x5dd589,'isAccepted':_0x5d070d,'isRejected':_0xc5c7c0});else{console[_0xb3e6f7(0x2187)](_0xb3e6f7(0x6b6));for(const _0x3bd815 of _0x5a7525){_0xba03b[_0xb3e6f7(0x1831)](_0x3bd815)&&(_0x5d070d=!![],_0x3b68db[_0xb3e6f7(0x1cd6)](_0xb3e6f7(0x1cf4)+_0x3bd815));}for(const _0x3d92ca of _0x41d78a){_0xba03b[_0xb3e6f7(0x1831)](_0x3d92ca)&&(_0xc5c7c0=!![],_0x3b68db[_0xb3e6f7(0x1cd6)]('拒绝:'+_0x3d92ca));}console[_0xb3e6f7(0x2187)]('🔥\x20[转账处理]\x20关键词检测结果:',{'isAccepted':_0x5d070d,'isRejected':_0xc5c7c0,'matchedKeywords':_0x3b68db,'fullAiResponse':_0xba03b[_0xb3e6f7(0x17ca)](0x0,0x64)+_0xb3e6f7(0x1520)});}if(_0x5d070d&&!_0xc5c7c0){_0x511234[_0xb3e6f7(0x12e2)]=_0xb3e6f7(0xdfc),console[_0xb3e6f7(0x2187)](_0xb3e6f7(0x17fe));const _0x3a03ca=chatMessages[_0x14af40]||[],_0x433d55=_0x3a03ca[_0xb3e6f7(0x150c)](_0x2e63df=>_0x2e63df['timestamp']===_0x511234['timestamp']&&_0x2e63df['type']===_0xb3e6f7(0x78a));_0x433d55!==-0x1&&(_0x3a03ca[_0x433d55][_0xb3e6f7(0x12e2)]=_0xb3e6f7(0xdfc)),updateTransferDisplay(_0x511234[_0xb3e6f7(0x1716)],_0xb3e6f7(0xdfc));}else{if(_0xc5c7c0){_0x511234[_0xb3e6f7(0x12e2)]=_0xb3e6f7(0xd3b),console[_0xb3e6f7(0x2187)](_0xb3e6f7(0x9e2));const _0x697b7f=chatMessages[_0x14af40]||[],_0x32a875=_0x697b7f[_0xb3e6f7(0x150c)](_0x590b01=>_0x590b01[_0xb3e6f7(0x1716)]===_0x511234['timestamp']&&_0x590b01[_0xb3e6f7(0x1a4b)]===_0xb3e6f7(0x78a));_0x32a875!==-0x1&&(_0x697b7f[_0x32a875][_0xb3e6f7(0x12e2)]=_0xb3e6f7(0xd3b)),updateTransferDisplay(_0x511234[_0xb3e6f7(0x1716)],_0xb3e6f7(0xd3b));}}if(_0x5d070d||_0xc5c7c0){try{const _0x12f079=chatMessages[_0x14af40]||[],_0x4fb5ce=_0x12f079[_0xb3e6f7(0xaf4)](_0x1a944a=>_0x1a944a['timestamp']===_0x511234['timestamp']&&_0x1a944a[_0xb3e6f7(0x1a4b)]===_0xb3e6f7(0x78a));if(_0x4fb5ce){const _0x472f7c=_0x14af40+'_transfer_'+_0x4fb5ce[_0xb3e6f7(0x1716)]+'_'+Math[_0xb3e6f7(0x11a8)]()[_0xb3e6f7(0x1878)](0x24)[_0xb3e6f7(0x15fb)](0x2,0x9);await db[_0xb3e6f7(0x19a2)][_0xb3e6f7(0x1561)]({'id':_0x472f7c,'characterId':_0x14af40,'messageData':_0x4fb5ce}),console['log'](_0xb3e6f7(0x18a1));}}catch(_0x2031c8){console[_0xb3e6f7(0x174a)]('🔥\x20[转账处理]\x20保存转账状态失败:',_0x2031c8);}const _0x1a13ff=_0x5d070d?'已收款':'已退回',_0xd2c454=currentChatCharacter?.[_0xb3e6f7(0x1a1c)]||'角色',_0xaaa50f={'id':Date[_0xb3e6f7(0x2eb)]()[_0xb3e6f7(0x1878)](),'sender':_0xb3e6f7(0x1744),'content':''+_0xd2c454+_0x1a13ff+'\x20¥'+Number(_0x511234[_0xb3e6f7(0x2018)])[_0xb3e6f7(0x13ad)](0x2),'timestamp':Date[_0xb3e6f7(0x2eb)]()},_0x51c0c4=chatMessages[_0x14af40]||[];_0x51c0c4[_0xb3e6f7(0x1cd6)](_0xaaa50f),chatMessages[_0x14af40]=_0x51c0c4;try{const _0xc4f053=_0x14af40+_0xb3e6f7(0x4a2)+_0xaaa50f[_0xb3e6f7(0x1716)]+'_'+Math[_0xb3e6f7(0x11a8)]()['toString'](0x24)[_0xb3e6f7(0x15fb)](0x2,0x9);await db[_0xb3e6f7(0x19a2)][_0xb3e6f7(0x21e2)]({'id':_0xc4f053,'characterId':_0x14af40,'messageData':_0xaaa50f}),console['log']('🔥\x20[转账处理]\x20系统消息已保存到数据库');}catch(_0x1ca352){console[_0xb3e6f7(0x174a)](_0xb3e6f7(0x1226),_0x1ca352);}renderChatMessages(_0x14af40);}}function updateTransferDisplay(_0x27944c,_0x420774){const _0x2bf42c=_0x211817;console[_0x2bf42c(0x2187)](_0x2bf42c(0x763),{'transferTimestamp':_0x27944c,'status':_0x420774});const _0x41f6d5=document['querySelectorAll']('[data-transfer-id]');console[_0x2bf42c(0x2187)](_0x2bf42c(0x149b),Array[_0x2bf42c(0x13c0)](_0x41f6d5)[_0x2bf42c(0x6a4)](_0xca5667=>({'id':_0xca5667[_0x2bf42c(0x2139)](_0x2bf42c(0x2af)),'element':_0xca5667})));const _0x10bb6a=document['querySelector']('[data-transfer-id=\x22'+_0x27944c+'\x22]');if(!_0x10bb6a){console[_0x2bf42c(0x2187)](_0x2bf42c(0xd93));currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);return;}_0x10bb6a[_0x2bf42c(0x1c1b)][_0x2bf42c(0x1493)](_0x2bf42c(0xdfc),_0x2bf42c(0xd3b)),_0x10bb6a[_0x2bf42c(0x1c1b)]['add'](_0x420774);let _0xa8f409='';if(_0x420774===_0x2bf42c(0xdfc))_0xa8f409=_0x2bf42c(0x881);else _0x420774===_0x2bf42c(0xd3b)&&(_0xa8f409=_0x2bf42c(0x1d6a));const _0x2894f5=_0x10bb6a['querySelector'](_0x2bf42c(0x515));if(_0x2894f5)_0x2894f5[_0x2bf42c(0xc25)]=_0xa8f409;else _0xa8f409&&_0x10bb6a[_0x2bf42c(0x1b7)]('beforeend',_0xa8f409);_0x10bb6a['removeAttribute'](_0x2bf42c(0x1f36)),console['log'](_0x2bf42c(0x1947));}async function sendTransfer(){const _0x573103=_0x211817,_0x25cb7f=parseFloat(document[_0x573103(0x1262)](_0x573103(0x1709))[_0x573103(0x1ebc)]),_0x596f91=document[_0x573103(0x1262)](_0x573103(0x132b))[_0x573103(0x1ebc)][_0x573103(0x19d7)]();if(!_0x25cb7f||_0x25cb7f<=0x0){showToast('请输入有效的转账金额',_0x573103(0x1816));return;}if(_0x25cb7f>0x3b9aca00){showToast(_0x573103(0x1691),_0x573103(0x1816));return;}const _0x15abf8={'id':Date[_0x573103(0x2eb)]()[_0x573103(0x1878)](),'sender':'sent','type':'transfer','amount':_0x25cb7f,'note':_0x596f91||'转账','timestamp':Date[_0x573103(0x2eb)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);const _0x2308ef=chatMessages[currentChatCharacter['id']];_0x2308ef['push'](_0x15abf8);try{const _0xe629bc=currentChatCharacter['id']+'_transfer_'+_0x15abf8[_0x573103(0x1716)]+'_'+Math[_0x573103(0x11a8)]()[_0x573103(0x1878)](0x24)[_0x573103(0x15fb)](0x2,0x9);await db[_0x573103(0x19a2)]['add']({'id':_0xe629bc,'characterId':currentChatCharacter['id'],'messageData':_0x15abf8}),console[_0x573103(0x2187)](_0x573103(0xf9e));}catch(_0xdbbca9){console['error'](_0x573103(0x301),_0xdbbca9),await saveChatMessages();}addMessageWithAnimation(_0x15abf8,currentChatCharacter['id']),pendingUserMessage=_0x15abf8;const _0x17f9e7=document[_0x573103(0x1262)](_0x573103(0x1d2b));_0x17f9e7&&(_0x17f9e7['style'][_0x573103(0x2231)]=_0x573103(0x2241),_0x17f9e7[_0x573103(0x1c1b)][_0x573103(0x21e2)](_0x573103(0x2b1)),_0x17f9e7['title']=_0x573103(0xd96)),renderMessageList(),document['getElementById'](_0x573103(0x1050))[_0x573103(0x1c1b)][_0x573103(0x1493)](_0x573103(0x85c)),document[_0x573103(0x1262)]('transfer-amount')['value']='',document[_0x573103(0x1262)](_0x573103(0x132b))[_0x573103(0x1ebc)]='',showToast('转账已发送','success');}function showTransferConfirmDialog(_0x1c4331){const _0x4e2398=_0x211817;if(!_0x1c4331||_0x1c4331[_0x4e2398(0x12e2)])return;const _0x221c1e=document[_0x4e2398(0x1262)](_0x4e2398(0x2e8)),_0x47a815=_0x221c1e[_0x4e2398(0xb30)]('.transfer-confirm-amount'),_0x4389fe=_0x221c1e['querySelector'](_0x4e2398(0x1904));_0x47a815[_0x4e2398(0x13be)]='¥\x20'+Number(_0x1c4331[_0x4e2398(0x2018)])['toFixed'](0x2),_0x4389fe['textContent']=_0x4e2398(0x1590)+(_0x1c4331[_0x4e2398(0x1814)]||'无'),currentTransferMsg=_0x1c4331,_0x221c1e[_0x4e2398(0x1c1b)]['add'](_0x4e2398(0x85c));}async function acceptTransfer(){const _0x248a28=_0x211817;if(!currentTransferMsg||!currentChatCharacter)return;const _0x21aac9=chatMessages[currentChatCharacter['id']]||[],_0x55d2a7=_0x21aac9['findIndex'](_0x13a3a7=>_0x13a3a7['timestamp']===currentTransferMsg['timestamp']&&_0x13a3a7[_0x248a28(0x1a4b)]===_0x248a28(0x78a));if(_0x55d2a7!==-0x1){_0x21aac9[_0x55d2a7][_0x248a28(0x12e2)]=_0x248a28(0xdfc),updateTransferDisplay(currentTransferMsg[_0x248a28(0x1716)],'accepted');try{const _0x266e9e=currentChatCharacter['id']+_0x248a28(0x1cee)+currentTransferMsg[_0x248a28(0x1716)]+'_'+Math['random']()[_0x248a28(0x1878)](0x24)[_0x248a28(0x15fb)](0x2,0x9);await db[_0x248a28(0x19a2)][_0x248a28(0x1561)]({'id':_0x266e9e,'characterId':currentChatCharacter['id'],'messageData':_0x21aac9[_0x55d2a7]}),console[_0x248a28(0x2187)](_0x248a28(0x1b8a));}catch(_0x30643b){console[_0x248a28(0x174a)](_0x248a28(0x11ab),_0x30643b);}const _0x249444={'id':Date[_0x248a28(0x2eb)]()[_0x248a28(0x1878)](),'sender':_0x248a28(0x1744),'content':_0x248a28(0x214a)+Number(currentTransferMsg[_0x248a28(0x2018)])['toFixed'](0x2),'timestamp':Date[_0x248a28(0x2eb)]()};_0x21aac9[_0x248a28(0x1cd6)](_0x249444);try{const _0x4b293e=currentChatCharacter['id']+_0x248a28(0x4a2)+_0x249444['timestamp']+'_'+Math[_0x248a28(0x11a8)]()[_0x248a28(0x1878)](0x24)['substr'](0x2,0x9);await db[_0x248a28(0x19a2)][_0x248a28(0x21e2)]({'id':_0x4b293e,'characterId':currentChatCharacter['id'],'messageData':_0x249444}),console['log']('✅\x20[手动确认收款]\x20系统消息已保存到数据库');}catch(_0x42b6e2){console[_0x248a28(0x174a)](_0x248a28(0x978),_0x42b6e2);}renderChatMessages(currentChatCharacter['id']);}document[_0x248a28(0x1262)]('transfer-confirm-modal')[_0x248a28(0x1c1b)]['remove'](_0x248a28(0x85c)),currentTransferMsg=null,showToast('已确认收款',_0x248a28(0x11cb));}async function rejectTransfer(){const _0x5eb8b3=_0x211817;if(!currentTransferMsg||!currentChatCharacter)return;const _0x41b18b=chatMessages[currentChatCharacter['id']]||[],_0x46b0fc=_0x41b18b['findIndex'](_0x3edcd2=>_0x3edcd2[_0x5eb8b3(0x1716)]===currentTransferMsg[_0x5eb8b3(0x1716)]&&_0x3edcd2[_0x5eb8b3(0x1a4b)]===_0x5eb8b3(0x78a));if(_0x46b0fc!==-0x1){_0x41b18b[_0x46b0fc][_0x5eb8b3(0x12e2)]=_0x5eb8b3(0xd3b),updateTransferDisplay(currentTransferMsg['timestamp'],_0x5eb8b3(0xd3b));try{const _0x5e21ce=currentChatCharacter['id']+_0x5eb8b3(0x1cee)+currentTransferMsg[_0x5eb8b3(0x1716)]+'_'+Math[_0x5eb8b3(0x11a8)]()['toString'](0x24)['substr'](0x2,0x9);await db[_0x5eb8b3(0x19a2)][_0x5eb8b3(0x1561)]({'id':_0x5e21ce,'characterId':currentChatCharacter['id'],'messageData':_0x41b18b[_0x46b0fc]}),console[_0x5eb8b3(0x2187)](_0x5eb8b3(0x59e));}catch(_0x4a2917){console[_0x5eb8b3(0x174a)](_0x5eb8b3(0xa6f),_0x4a2917);}const _0x251482={'id':Date['now']()['toString'](),'sender':'system','content':'你已退回\x20¥'+Number(currentTransferMsg[_0x5eb8b3(0x2018)])[_0x5eb8b3(0x13ad)](0x2),'timestamp':Date[_0x5eb8b3(0x2eb)]()};_0x41b18b['push'](_0x251482);try{const _0x4c3896=currentChatCharacter['id']+_0x5eb8b3(0x4a2)+_0x251482[_0x5eb8b3(0x1716)]+'_'+Math[_0x5eb8b3(0x11a8)]()[_0x5eb8b3(0x1878)](0x24)['substr'](0x2,0x9);await db[_0x5eb8b3(0x19a2)][_0x5eb8b3(0x21e2)]({'id':_0x4c3896,'characterId':currentChatCharacter['id'],'messageData':_0x251482}),console[_0x5eb8b3(0x2187)](_0x5eb8b3(0x1279));}catch(_0x2755b0){console[_0x5eb8b3(0x174a)](_0x5eb8b3(0x11eb),_0x2755b0);}renderChatMessages(currentChatCharacter['id']);}document[_0x5eb8b3(0x1262)]('transfer-confirm-modal')[_0x5eb8b3(0x1c1b)][_0x5eb8b3(0x1493)](_0x5eb8b3(0x85c)),currentTransferMsg=null,showToast(_0x5eb8b3(0x50a),_0x5eb8b3(0x11cb));}const originalShowApp=window[_0x211817(0x1390)];originalShowApp&&(window[_0x211817(0x1390)]=function(_0x3d513a){const _0x3a7b54=_0x211817;originalShowApp(_0x3d513a);if(_0x3d513a===_0x3a7b54(0x1842))calculateStorageUsage();});function showScheduleTimesModal(){const _0x13f692=_0x211817;if(!currentChatCharacter)return;const _0x5bae78=getCurrentChatSettings(),_0x56a72a=_0x5bae78[_0x13f692(0xb66)]||[],_0x2a12e5=document[_0x13f692(0x1262)](_0x13f692(0x8b1));_0x2a12e5[_0x13f692(0x33a)]='',_0x56a72a['forEach']((_0x53c572,_0x3ce6f7)=>{const _0x31be7d=_0x13f692,_0x174850=document[_0x31be7d(0xac6)](_0x31be7d(0xbbc));_0x174850[_0x31be7d(0x1722)]=_0x31be7d(0x1b86),_0x174850[_0x31be7d(0x14eb)][_0x31be7d(0x1f87)]=_0x31be7d(0x68d),_0x174850['innerHTML']=_0x31be7d(0x1189)+_0x53c572+_0x31be7d(0xf0d)+_0x3ce6f7+_0x31be7d(0x13ee)+_0x3ce6f7+_0x31be7d(0x1070),_0x2a12e5[_0x31be7d(0x497)](_0x174850);}),showModal(_0x13f692(0xb84));}function addScheduleTime(){const _0x22808b=_0x211817;if(!currentChatCharacter)return;const _0x53253a=getCurrentChatSettings();!_0x53253a['scheduledMomentsTimes']&&(_0x53253a[_0x22808b(0xb66)]=[]);if(_0x53253a[_0x22808b(0xb66)][_0x22808b(0x19ee)]>=0xa){alert(_0x22808b(0x1917));return;}_0x53253a['scheduledMomentsTimes'][_0x22808b(0x1cd6)](_0x22808b(0xbed)),saveCurrentChatSettings(_0x53253a),showScheduleTimesModal();}function updateScheduleTime(_0xd59a26,_0x4eb252){const _0x465d1c=_0x211817;if(!currentChatCharacter)return;const _0x5cfcb5=getCurrentChatSettings();_0x5cfcb5[_0x465d1c(0xb66)]&&_0x5cfcb5[_0x465d1c(0xb66)][_0xd59a26]!==undefined&&(_0x5cfcb5[_0x465d1c(0xb66)][_0xd59a26]=_0x4eb252,saveCurrentChatSettings(_0x5cfcb5));}function removeScheduleTime(_0x2abf14){const _0x507e49=_0x211817;if(!currentChatCharacter)return;const _0x5adb2d=getCurrentChatSettings();_0x5adb2d[_0x507e49(0xb66)]&&_0x5adb2d[_0x507e49(0xb66)][_0x2abf14]!==undefined&&(_0x5adb2d[_0x507e49(0xb66)]['splice'](_0x2abf14,0x1),saveCurrentChatSettings(_0x5adb2d),showScheduleTimesModal());}function saveScheduleTimes(){const _0x4d6e1f=_0x211817;if(!currentChatCharacter)return;const _0x4df059=document[_0x4d6e1f(0x1262)]('schedule-times-modal-container'),_0x1b180f=_0x4df059[_0x4d6e1f(0x1897)]('input[type=\x22time\x22]'),_0x4ac6ac=Array[_0x4d6e1f(0x13c0)](_0x1b180f)['map'](_0x21a1ff=>_0x21a1ff['value'])['filter'](_0x368d04=>_0x368d04),_0x22bf73=getCurrentChatSettings();_0x22bf73[_0x4d6e1f(0xb66)]=_0x4ac6ac,saveCurrentChatSettings(_0x22bf73),updateScheduleTimesDisplay(),hideModal(_0x4d6e1f(0xb84)),setTimeout(async()=>{const _0x3f8b3d=_0x4d6e1f;try{await initGlobalMomentsSystem(),console[_0x3f8b3d(0x2187)]('✅\x20定时发布设置已更新');}catch(_0xad41fc){console[_0x3f8b3d(0x174a)]('❌\x20更新定时发布设置失败:',_0xad41fc);}},0x1f4),showToast(_0x4d6e1f(0x1ae6)+_0x4ac6ac[_0x4d6e1f(0x19ee)]+_0x4d6e1f(0x1c34),'success');}function updateScheduleTimesDisplay(){const _0x3fba1=_0x211817;if(!currentChatCharacter)return;const _0x5a471c=getCurrentChatSettings(),_0x42e2a1=_0x5a471c[_0x3fba1(0xb66)]||[],_0x58fa9c=document[_0x3fba1(0x1262)](_0x3fba1(0x3d7));if(_0x42e2a1['length']===0x0)_0x58fa9c[_0x3fba1(0x13be)]=_0x3fba1(0xd5b);else _0x42e2a1[_0x3fba1(0x19ee)]===0x1?_0x58fa9c[_0x3fba1(0x13be)]=_0x3fba1(0x28f)+_0x42e2a1[0x0]+')':_0x58fa9c[_0x3fba1(0x13be)]=_0x42e2a1[_0x3fba1(0x19ee)]+_0x3fba1(0x1792);}async function testPublishMoment(){const _0x45354c=_0x211817;if(!currentChatCharacter){alert('请先选择一个角色');return;}const _0x547aa2=document[_0x45354c(0xb30)](_0x45354c(0x15fd)),_0xfec75d=_0x547aa2[_0x45354c(0x13be)];_0x547aa2[_0x45354c(0x13be)]=_0x45354c(0x13cb),_0x547aa2[_0x45354c(0x559)]=!![];try{await triggerBackgroundMomentsTest(currentChatCharacter['id']),showToast(_0x45354c(0x1f9f),_0x45354c(0x11cb));}catch(_0x3a994f){console[_0x45354c(0x174a)]('测试发布失败:',_0x3a994f),showToast(_0x45354c(0x1723),_0x45354c(0x174a));}finally{_0x547aa2[_0x45354c(0x13be)]=_0xfec75d,_0x547aa2[_0x45354c(0x559)]=![];}}function initScheduledMomentsSystem(){const _0x5e55a2=_0x211817;if(!currentChatCharacter)return;const _0x50a555=getCurrentChatSettings();if(!_0x50a555[_0x5e55a2(0x1d5f)]||!_0x50a555['scheduledMomentsTimes']?.[_0x5e55a2(0x19ee)])return;_0x50a555['scheduledMomentsTimes']['forEach'](_0x2274b5=>{const _0x45808b=_0x5e55a2;if(!_0x2274b5)return;const [_0x236b7f,_0x1b7720]=_0x2274b5['split'](':')[_0x45808b(0x6a4)](Number),_0x3433d6=new Date(),_0x1112f2=new Date();_0x1112f2['setHours'](_0x236b7f,_0x1b7720,0x0,0x0);_0x1112f2<=_0x3433d6&&_0x1112f2['setDate'](_0x1112f2[_0x45808b(0x520)]()+0x1);const _0x397730=_0x1112f2[_0x45808b(0x704)]()-_0x3433d6['getTime']();setTimeout(()=>{triggerBackgroundMoments(currentChatCharacter['id']),setInterval(()=>{triggerBackgroundMoments(currentChatCharacter['id']);},0x18*0x3c*0x3c*0x3e8);},_0x397730);});}let notificationQueue=[],currentNotification=null,isProcessingQueue=![];function createPushNotification(_0x1173ad,_0x3d002f,_0x185b80=0x0){const _0xebfd98=_0x211817;setTimeout(()=>{const _0x5d7af0=_0x167f;SoundManager['play'](SoundManager[_0x5d7af0(0xf4e)]['NOTIFICATION'],_0x1173ad?.['id']);},_0x185b80);const _0x1acd21=document[_0xebfd98(0x1262)]('phone-screen'),_0x2285f2=_0x1acd21&&window[_0xebfd98(0x18b1)](_0x1acd21)[_0xebfd98(0x4da)]!==_0xebfd98(0x102b),_0x17dcce=document['getElementById']('api-chat-screen'),_0x7e9e9b=_0x17dcce&&window[_0xebfd98(0x18b1)](_0x17dcce)['display']!==_0xebfd98(0x102b),_0x3fb548=_0x7e9e9b&&currentChatCharacter&&currentChatCharacter['id']===_0x1173ad['id'];console['log'](_0xebfd98(0x1e30),{'mainScreenVisible':_0x2285f2,'chatScreenVisible':_0x7e9e9b,'currentChatCharacter':currentChatCharacter?.[_0xebfd98(0x1a1c)],'messageFromCharacter':_0x1173ad[_0xebfd98(0x1a1c)],'isChattingWithThisCharacter':_0x3fb548,'shouldShowNotification':_0x2285f2&&!_0x3fb548});const _0xa64cd3=typeof _0x3d002f===_0xebfd98(0x11b7)&&(_0x3d002f['includes'](_0xebfd98(0x8bf))||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0x209d))||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0x12cd))||_0x3d002f[_0xebfd98(0x1831)]('记录了生日')||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0x756))||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0xf2a))||_0x3d002f[_0xebfd98(0x1831)]('许下承诺')||_0x3d002f[_0xebfd98(0x1831)]('约定和你见面')||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0xbf1))||_0x3d002f['includes']('约定了约会')||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0x12cc))||_0x3d002f[_0xebfd98(0x1831)](_0xebfd98(0x2a4))||_0x3d002f[_0xebfd98(0x1831)]('🎉')||_0x3d002f['includes']('📝')||_0x3d002f[_0xebfd98(0x1831)]('📅')||_0x3d002f[_0xebfd98(0x1831)]('⏰'));if(_0xa64cd3)console[_0xebfd98(0x2187)](_0xebfd98(0xea5));else{if(!_0x2285f2||_0x3fb548){console[_0xebfd98(0x2187)](_0xebfd98(0x22ca));return;}}notificationQueue[_0xebfd98(0x1cd6)]({'character':_0x1173ad,'messageData':_0x3d002f,'delay':_0x185b80}),console['log'](_0xebfd98(0x10be),notificationQueue['length']),processNotificationQueue();}function processNotificationQueue(){const _0x10fc36=_0x211817;if(isProcessingQueue||notificationQueue[_0x10fc36(0x19ee)]===0x0)return;isProcessingQueue=!![],console[_0x10fc36(0x2187)](_0x10fc36(0x108f),notificationQueue[_0x10fc36(0x19ee)]);const _0x4ae4e0=()=>{const _0x2f8c32=_0x10fc36;if(notificationQueue['length']===0x0){isProcessingQueue=![],console[_0x2f8c32(0x2187)](_0x2f8c32(0x177a));return;}const {character:_0x411c14,messageData:_0x3c9a04,delay:_0x8d8753}=notificationQueue['shift']();setTimeout(()=>{showSingleNotification(_0x411c14,_0x3c9a04),setTimeout(()=>{_0x4ae4e0();},0xa28);},_0x8d8753);};_0x4ae4e0();}function showSingleNotification(_0x5d186e,_0x1d637d){const _0x3ea4a6=_0x211817;console[_0x3ea4a6(0x2187)]('🔔\x20[推送通知]\x20显示单个通知，角色:',_0x5d186e[_0x3ea4a6(0x1a1c)]);const _0x56d9b6=document['getElementById'](_0x3ea4a6(0x17df));if(!_0x56d9b6){console[_0x3ea4a6(0x174a)](_0x3ea4a6(0x160a));return;}currentNotification&&hideNotification(currentNotification,!![]);const _0x47ed3a=document[_0x3ea4a6(0xac6)](_0x3ea4a6(0xbbc));_0x47ed3a['className']=_0x3ea4a6(0xdf7),currentNotification=_0x47ed3a;let _0x161cdf='',_0xe118a8=_0x3ea4a6(0x1e8e),_0x3d5c06=_0x5d186e[_0x3ea4a6(0x1a1c)],_0x282249=![],_0x416dc1='';if(typeof _0x1d637d===_0x3ea4a6(0x11b7))_0x161cdf=_0x1d637d;else{if(typeof _0x1d637d===_0x3ea4a6(0x28d)){if(_0x1d637d[_0x3ea4a6(0x1a1c)]&&_0x1d637d[_0x3ea4a6(0x1e8e)]){_0x282249=!![],_0x416dc1=_0x1d637d[_0x3ea4a6(0x1a1c)],_0x3d5c06=_0x3ea4a6(0x2148)+_0x5d186e[_0x3ea4a6(0x1a1c)];if(typeof _0x1d637d[_0x3ea4a6(0x1e8e)]===_0x3ea4a6(0x11b7))_0x161cdf=_0x416dc1+'：'+_0x1d637d[_0x3ea4a6(0x1e8e)];else{if(typeof _0x1d637d[_0x3ea4a6(0x1e8e)]===_0x3ea4a6(0x28d)&&_0x1d637d[_0x3ea4a6(0x1e8e)][_0x3ea4a6(0x1a4b)])switch(_0x1d637d[_0x3ea4a6(0x1e8e)]['type']){case _0x3ea4a6(0x78a):_0x161cdf=_0x416dc1+_0x3ea4a6(0x1c6f)+_0x1d637d[_0x3ea4a6(0x1e8e)][_0x3ea4a6(0x2018)],_0xe118a8=_0x3ea4a6(0x78a);break;case _0x3ea4a6(0x13ed):_0x161cdf=_0x416dc1+_0x3ea4a6(0x5c0),_0xe118a8=_0x3ea4a6(0x561);break;default:_0x161cdf=_0x416dc1+'：'+(_0x1d637d[_0x3ea4a6(0x1e8e)][_0x3ea4a6(0x211c)]||_0x3ea4a6(0x1bad));}else _0x161cdf=_0x416dc1+'：'+String(_0x1d637d[_0x3ea4a6(0x1e8e)]);}}else{if(_0x1d637d[_0x3ea4a6(0x1a4b)])switch(_0x1d637d[_0x3ea4a6(0x1a4b)]){case _0x3ea4a6(0x78a):_0x161cdf=_0x3ea4a6(0x102f)+_0x1d637d[_0x3ea4a6(0x2018)],_0xe118a8=_0x3ea4a6(0x78a);break;case _0x3ea4a6(0x13ed):_0x161cdf=_0x3ea4a6(0x462),_0xe118a8=_0x3ea4a6(0x561);break;case _0x3ea4a6(0x1a36):_0x161cdf=_0x3ea4a6(0x1bb6),_0xe118a8=_0x3ea4a6(0x68e);break;case _0x3ea4a6(0x172b):_0x161cdf=_0x3ea4a6(0x1e1c)+_0x1d637d[_0x3ea4a6(0x7c9)],_0xe118a8=_0x3ea4a6(0x172b);break;default:_0x161cdf=_0x1d637d[_0x3ea4a6(0x211c)]||_0x3ea4a6(0x1bad);}else _0x161cdf=_0x1d637d[_0x3ea4a6(0x211c)]||_0x1d637d[_0x3ea4a6(0x1e8e)]||_0x3ea4a6(0x1bad);}}}_0x161cdf[_0x3ea4a6(0x19ee)]>0x19&&(_0x161cdf=_0x161cdf['substring'](0x0,0x19)+_0x3ea4a6(0x1520));const _0x1fea9e=new Date(),_0x3db4cb=_0x1fea9e[_0x3ea4a6(0x314)]('zh-CN',{'hour':_0x3ea4a6(0xc79),'minute':_0x3ea4a6(0xc79)});_0x47ed3a['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22notification-avatar\x22\x20src=\x22'+(_0x5d186e[_0x3ea4a6(0x1994)]||_0x5d186e[_0x3ea4a6(0x1f8a)]||createDefaultAvatar(_0x5d186e[_0x3ea4a6(0x1a1c)]))+_0x3ea4a6(0x222c)+_0x3d5c06+_0x3ea4a6(0x12ae)+_0x3d5c06+_0x3ea4a6(0x7f4)+_0x161cdf+_0x3ea4a6(0x959)+_0x3db4cb+_0x3ea4a6(0xee4),_0x47ed3a[_0x3ea4a6(0x1f36)]=()=>{const _0x187db0=_0x3ea4a6;console[_0x187db0(0x2187)](_0x187db0(0x1266));const _0x2b0860=_0x161cdf['startsWith']('[短信]'),_0x28019e=_0x161cdf['startsWith'](_0x187db0(0xa13));if(_0x5d186e&&_0x5d186e['id']){console[_0x187db0(0x2187)](_0x187db0(0x13a7),_0x5d186e[_0x187db0(0x1a1c)],_0x5d186e['id'],_0x187db0(0xa10),_0x2b0860,_0x187db0(0xec7),_0x28019e);if(_0x2b0860)window[_0x187db0(0xb69)]=_0x5d186e,updateSMSChatHeader(_0x5d186e),renderSMSMessages(_0x5d186e['id']),showApp(_0x187db0(0x659)),console['log'](_0x187db0(0x98d));else{if(_0x28019e)currentChatCharacter=_0x5d186e,showApp(_0x187db0(0xcf2)),setTimeout(()=>{showDiary();},0x64),console[_0x187db0(0x2187)]('🔔\x20[日记推送通知]\x20跳转到日记界面完成');else{currentChatCharacter=_0x5d186e;const _0x9aed84=document[_0x187db0(0x1262)](_0x187db0(0x2053));if(_0x9aed84){let _0x4810df=_0x5d186e[_0x187db0(0x1a1c)];if(_0x5d186e[_0x187db0(0x1f68)]&&_0x5d186e[_0x187db0(0x12a6)]){const _0x3da18d=_0x5d186e[_0x187db0(0x12a6)][_0x187db0(0x19ee)]+0x1;_0x4810df=_0x5d186e[_0x187db0(0x1a1c)]+'（'+_0x3da18d+'）';}_0x9aed84['textContent']=_0x4810df,_0x9aed84[_0x187db0(0x1c1b)][_0x187db0(0x1493)](_0x187db0(0x10f8)),_0x9aed84[_0x187db0(0x1ecd)][_0x187db0(0x417)]=_0x4810df;}renderChatMessages(_0x5d186e['id']),showApp(_0x187db0(0xcf2)),console['log']('🔔\x20[推送通知]\x20跳转到聊天界面完成');}}}hideNotification(_0x47ed3a);},_0x56d9b6[_0x3ea4a6(0x497)](_0x47ed3a),setTimeout(()=>{const _0x2fc38d=_0x3ea4a6;_0x47ed3a[_0x2fc38d(0x1c1b)]['add']('show');},0x32),setTimeout(()=>{currentNotification===_0x47ed3a&&hideNotification(_0x47ed3a);},0x8fc);}function hideNotification(_0xd5445d,_0x586507=![]){const _0x4c5889=_0x211817;if(_0xd5445d&&_0xd5445d['parentNode']){_0xd5445d[_0x4c5889(0x1c1b)][_0x4c5889(0x1493)](_0x4c5889(0x1c09)),_0xd5445d[_0x4c5889(0x1c1b)]['add'](_0x4c5889(0xdcc));currentNotification===_0xd5445d&&(currentNotification=null);const _0x2ad793=_0x586507?0x0:0xfa;setTimeout(()=>{const _0x48acee=_0x4c5889;_0xd5445d[_0x48acee(0x148c)]&&_0xd5445d['parentNode']['removeChild'](_0xd5445d);},_0x2ad793);}}function createMomentInteractionNotification(_0x25344e,_0xc0957,_0x3da66c){const _0x3d4a35=_0x211817;let _0x4747ce='';switch(_0xc0957){case _0x3d4a35(0x7e3):_0x4747ce='赞了你的动态';break;case _0x3d4a35(0x945):_0x4747ce='评论了你的动态';break;default:_0x4747ce='与你的动态互动了';}createPushNotification(_0x25344e,_0x4747ce);}function createSMSPushNotification(_0x5c5d4f,_0x2eae5c,_0x468b6d=0x0){const _0x36c56a=_0x211817;setTimeout(()=>{const _0x5a3d2d=_0x167f;SoundManager[_0x5a3d2d(0xaa5)](SoundManager['TYPES'][_0x5a3d2d(0x1b06)],_0x5c5d4f?.['id']);},_0x468b6d);const _0x3b9ff1=document[_0x36c56a(0x1262)](_0x36c56a(0x1548)),_0x2d301a=_0x3b9ff1&&window[_0x36c56a(0x18b1)](_0x3b9ff1)[_0x36c56a(0x4da)]!==_0x36c56a(0x102b),_0xf203f8=document['getElementById'](_0x36c56a(0x659)),_0x5f3fce=_0xf203f8&&window[_0x36c56a(0x18b1)](_0xf203f8)['display']!=='none',_0x29daf9=_0x5f3fce&&window['currentSMSCharacter']&&window[_0x36c56a(0xb69)]['id']===_0x5c5d4f['id'];console[_0x36c56a(0x2187)](_0x36c56a(0x405),{'mainScreenVisible':_0x2d301a,'smsScreenVisible':_0x5f3fce,'currentSMSCharacter':window[_0x36c56a(0xb69)]?.[_0x36c56a(0x1a1c)],'messageFromCharacter':_0x5c5d4f[_0x36c56a(0x1a1c)],'isChattingWithThisCharacter':_0x29daf9,'shouldShowNotification':_0x2d301a&&!_0x29daf9});if(!_0x2d301a||_0x29daf9){console[_0x36c56a(0x2187)](_0x36c56a(0x143c));return;}const _0x34ff3b='[短信]\x20'+_0x2eae5c;createPushNotification(_0x5c5d4f,_0x34ff3b,_0x468b6d);}window[_0x211817(0x21e9)]('beforeunload',function(){const _0xfd02fb=_0x211817;if(currentChatCharacter)markAsRead(currentChatCharacter['id']),console[_0xfd02fb(0x2187)]('🔥\x20[页面卸载]\x20标记当前聊天为已读:',currentChatCharacter[_0xfd02fb(0x1a1c)]);else{const _0x136418=sessionStorage[_0xfd02fb(0x15d8)](_0xfd02fb(0x888));_0x136418&&(markAsRead(_0x136418),console[_0xfd02fb(0x2187)]('🔥\x20[页面卸载]\x20从sessionStorage恢复并标记聊天为已读:',_0x136418));}sessionStorage['removeItem'](_0xfd02fb(0x888));}),document[_0x211817(0x21e9)]('visibilitychange',function(){const _0x365b7a=_0x211817;document[_0x365b7a(0xa52)]&&currentChatCharacter&&(markAsRead(currentChatCharacter['id']),console[_0x365b7a(0x2187)](_0x365b7a(0x4c0),currentChatCharacter[_0x365b7a(0x1a1c)]));}),window[_0x211817(0x21e9)](_0x211817(0xc53),function(){const _0x4f7486=_0x211817;currentChatCharacter&&(markAsRead(currentChatCharacter['id']),console[_0x4f7486(0x2187)](_0x4f7486(0x1c5),currentChatCharacter[_0x4f7486(0x1a1c)]));}),document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x10ff43=_0x211817;document[_0x10ff43(0x1262)](_0x10ff43(0x1ecc))?.[_0x10ff43(0x21e9)](_0x10ff43(0x1859),()=>{const _0xbc7b34=_0x10ff43;document['getElementById'](_0xbc7b34(0x1050))[_0xbc7b34(0x1c1b)][_0xbc7b34(0x1493)]('visible');}),document[_0x10ff43(0x1262)](_0x10ff43(0xc7d))?.['addEventListener'](_0x10ff43(0x1859),sendTransfer),document['getElementById'](_0x10ff43(0x1e50))?.[_0x10ff43(0x21e9)](_0x10ff43(0x1859),acceptTransfer),document[_0x10ff43(0x1262)](_0x10ff43(0x256))?.[_0x10ff43(0x21e9)](_0x10ff43(0x1859),rejectTransfer),document[_0x10ff43(0x1262)](_0x10ff43(0x1050))?.[_0x10ff43(0x21e9)](_0x10ff43(0x1859),_0x36afed=>{const _0x1f51db=_0x10ff43;_0x36afed[_0x1f51db(0x193d)]===document[_0x1f51db(0x1262)]('transfer-modal')&&document[_0x1f51db(0x1262)](_0x1f51db(0x1050))[_0x1f51db(0x1c1b)][_0x1f51db(0x1493)]('visible');}),document[_0x10ff43(0x1262)](_0x10ff43(0x2e8))?.[_0x10ff43(0x21e9)](_0x10ff43(0x1859),_0xaaf8d3=>{const _0x4fc779=_0x10ff43;_0xaaf8d3[_0x4fc779(0x193d)]===document['getElementById']('transfer-confirm-modal')&&(document[_0x4fc779(0x1262)]('transfer-confirm-modal')['classList'][_0x4fc779(0x1493)]('visible'),currentTransferMsg=null);});});function updateGroupChatInfo(){const _0x36d44e=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x36d44e(0x1f68)])return;const _0x47cbe6=document[_0x36d44e(0x1262)](_0x36d44e(0x20ff));if(_0x47cbe6){if(currentChatCharacter['avatarUrl'])_0x47cbe6[_0x36d44e(0x45c)]=currentChatCharacter[_0x36d44e(0x1994)];else{const _0x35d8cc=document[_0x36d44e(0xac6)](_0x36d44e(0x144b));_0x35d8cc[_0x36d44e(0x12f1)]=0x28,_0x35d8cc[_0x36d44e(0xe6b)]=0x28;const _0xae348d=_0x35d8cc['getContext']('2d');_0xae348d[_0x36d44e(0x7f8)](),_0xae348d['arc'](0x14,0x14,0x14,0x0,0x2*Math['PI']),_0xae348d[_0x36d44e(0x27d)]=_0x36d44e(0x1ff3),_0xae348d['fill'](),_0xae348d[_0x36d44e(0x27d)]=_0x36d44e(0x2167),_0xae348d['font']=_0x36d44e(0x220),_0xae348d[_0x36d44e(0x22b)]=_0x36d44e(0xcef),_0xae348d[_0x36d44e(0x6c2)]=_0x36d44e(0x1a3d),_0xae348d['fillText']('群',0x14,0x14),_0x47cbe6['src']=_0x35d8cc[_0x36d44e(0x7f5)]();}}const _0x29298d=document[_0x36d44e(0x1262)](_0x36d44e(0x118a));_0x29298d&&(_0x29298d[_0x36d44e(0x13be)]=currentChatCharacter[_0x36d44e(0x1a1c)]||_0x36d44e(0x22a8));const _0x4929ed=document[_0x36d44e(0x1262)](_0x36d44e(0xbd3));if(_0x4929ed){const _0x100042=currentChatCharacter[_0x36d44e(0x12a6)]?currentChatCharacter['members'][_0x36d44e(0x19ee)]:0x0,_0x1a21a8=_0x100042+0x1;_0x4929ed['textContent']=_0x1a21a8+_0x36d44e(0x1332);}const _0x4b9d52=document[_0x36d44e(0x1262)](_0x36d44e(0x1e62));_0x4b9d52&&(_0x4b9d52[_0x36d44e(0x13be)]=currentChatCharacter[_0x36d44e(0x7c9)]||_0x36d44e(0x140e));const _0x16c29b=document['getElementById'](_0x36d44e(0x1cfe));if(_0x16c29b){let _0x59d0f1='未选择';const _0x1f6f2d=getCurrentChatSettings(),_0x159b93=personas[_0x36d44e(0xaf4)](_0xdc1a3c=>_0xdc1a3c['id']===_0x1f6f2d[_0x36d44e(0x145e)]);_0x159b93&&_0x159b93[_0x36d44e(0x1a1c)]&&(_0x59d0f1=_0x159b93[_0x36d44e(0x1a1c)]),_0x16c29b[_0x36d44e(0x13be)]=_0x1f6f2d['myChatNickname']||_0x59d0f1;}renderGroupMembersGrid();}function changeGroupAvatar(){const _0xfe5d73=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0xfe5d73(0x1f68)])return;const _0x14e6f1=document[_0xfe5d73(0xac6)]('input');_0x14e6f1[_0xfe5d73(0x1a4b)]='file',_0x14e6f1[_0xfe5d73(0x1515)]=_0xfe5d73(0x2ae),_0x14e6f1[_0xfe5d73(0x14eb)][_0xfe5d73(0x4da)]=_0xfe5d73(0x102b),document[_0xfe5d73(0x1da9)][_0xfe5d73(0x497)](_0x14e6f1),_0x14e6f1[_0xfe5d73(0x1980)]=function(_0x1162cf){const _0x282966=_0xfe5d73;if(_0x1162cf[_0x282966(0x193d)][_0x282966(0xf26)]&&_0x1162cf[_0x282966(0x193d)][_0x282966(0xf26)][0x0]){const _0x274db1=new FileReader();_0x274db1['onload']=async function(_0xf4341d){const _0x5d991f=_0x282966;currentChatCharacter['avatarUrl']=_0xf4341d['target'][_0x5d991f(0x4ee)];if(groupChats){const _0x434630=groupChats['findIndex'](_0x1b1d00=>_0x1b1d00['id']===currentChatCharacter['id']);_0x434630!==-0x1&&(groupChats[_0x434630][_0x5d991f(0x1994)]=_0xf4341d[_0x5d991f(0x193d)]['result'],await saveGroupChats(groupChats));}updateGroupChatInfo();let _0x332cb8=currentChatCharacter[_0x5d991f(0x1a1c)];if(currentChatCharacter[_0x5d991f(0x12a6)]){const _0x1f783f=currentChatCharacter['members'][_0x5d991f(0x19ee)]+0x1;_0x332cb8=currentChatCharacter[_0x5d991f(0x1a1c)]+'（'+_0x1f783f+'）';}const _0x32437f=document[_0x5d991f(0x1262)](_0x5d991f(0x2053));_0x32437f&&(_0x32437f['textContent']=_0x332cb8,_0x32437f[_0x5d991f(0x1c1b)][_0x5d991f(0x1493)](_0x5d991f(0x10f8)),_0x32437f['dataset']['originalTitle']=_0x332cb8);const _0x5b12ae=document[_0x5d991f(0xb30)]('#api-chat-screen\x20.message-avatar\x20img');_0x5b12ae&&(_0x5b12ae['src']=_0xf4341d[_0x5d991f(0x193d)][_0x5d991f(0x4ee)]),renderContactList(),renderMessageList(),document['body'][_0x5d991f(0x858)](_0x14e6f1);},_0x274db1[_0x282966(0x127c)](_0x1162cf[_0x282966(0x193d)][_0x282966(0xf26)][0x0]);}else document['body'][_0x282966(0x858)](_0x14e6f1);},_0x14e6f1[_0xfe5d73(0x1859)]();}function changeGroupName(){const _0x57122f=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x57122f(0x1f68)])return;const _0x13ebcf=prompt(_0x57122f(0xcaa),currentChatCharacter[_0x57122f(0x1a1c)]);if(_0x13ebcf&&_0x13ebcf[_0x57122f(0x19d7)]()!==''){const _0x2cb387=_0x13ebcf['trim']();currentChatCharacter['name']=_0x2cb387;if(groupChats){const _0x35519b=groupChats[_0x57122f(0x150c)](_0x13d880=>_0x13d880['id']===currentChatCharacter['id']);_0x35519b!==-0x1&&(groupChats[_0x35519b][_0x57122f(0x1a1c)]=_0x2cb387,saveGroupChats(groupChats));}updateGroupChatInfo();let _0x25a05e=_0x2cb387;if(currentChatCharacter['members']){const _0x14da9f=currentChatCharacter[_0x57122f(0x12a6)]['length']+0x1;_0x25a05e=_0x2cb387+'（'+_0x14da9f+'）';}const _0x414199=document[_0x57122f(0x1262)](_0x57122f(0x2053));_0x414199&&(_0x414199[_0x57122f(0x13be)]=_0x25a05e,_0x414199['classList'][_0x57122f(0x1493)](_0x57122f(0x10f8)),_0x414199[_0x57122f(0x1ecd)][_0x57122f(0x417)]=_0x25a05e),renderContactList(),renderMessageList();}}function showGroupChatMemberSelection(_0x8f0ae6){const _0x20207b=_0x211817;console['log'](_0x20207b(0x82a),_0x8f0ae6),window[_0x20207b(0x1c49)]=_0x8f0ae6,document[_0x20207b(0x1262)](_0x20207b(0x1c90))['value']='',selectedGroupMembers=[];const _0x51ad61=document['getElementById'](_0x20207b(0x5da));_0x51ad61[_0x20207b(0x33a)]='';characters[_0x20207b(0x19ee)]<0x2?_0x51ad61[_0x20207b(0x33a)]='<p\x20class=\x22empty-mount-chats\x22>至少需要2个角色才能创建群聊</p>':characters[_0x20207b(0x19fb)](_0x56ded7=>{const _0x147c17=_0x20207b,_0x2ee32f=document[_0x147c17(0xac6)](_0x147c17(0xbbc));_0x2ee32f[_0x147c17(0x1722)]=_0x147c17(0xef1),_0x2ee32f[_0x147c17(0x1f36)]=()=>toggleGroupMemberSelection(_0x56ded7['id']),_0x2ee32f[_0x147c17(0x33a)]=_0x147c17(0x461)+_0x56ded7['id']+_0x147c17(0x5cb)+_0x56ded7['color']+';\x20'+(_0x56ded7[_0x147c17(0x1994)]?_0x147c17(0x5e0)+_0x56ded7['avatarUrl']+_0x147c17(0x767):'')+_0x147c17(0x9ed)+(_0x56ded7['avatarUrl']?'':_0x56ded7[_0x147c17(0x1a1c)]['charAt'](0x0))+_0x147c17(0x4d5)+_0x56ded7['name']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22chat-option-desc\x22>'+truncateText(_0x56ded7[_0x147c17(0x1f0b)]||_0x147c17(0x1569),0x50)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>',_0x51ad61[_0x147c17(0x497)](_0x2ee32f);});console[_0x20207b(0x2187)](_0x20207b(0x9cd),_0x8f0ae6);const _0x5832fe=document['getElementById'](_0x20207b(0x1ce6))[_0x20207b(0xb30)](_0x20207b(0x1d93));_0x5832fe[_0x20207b(0x1f36)]=()=>{const _0x57a58b=_0x20207b;console[_0x57a58b(0x2187)](_0x57a58b(0x42c),_0x8f0ae6),createGroupChat(_0x8f0ae6);},showModal(_0x20207b(0x1ce6));}function renderGroupMembersGrid(){const _0x5250c4=_0x211817,_0xd481a9=document['getElementById']('group-members-grid');if(!_0xd481a9||!currentChatCharacter||!currentChatCharacter[_0x5250c4(0x1f68)])return;_0xd481a9[_0x5250c4(0x33a)]='';const _0x267041=getCurrentChatSettings(),_0x3b5974=personas['find'](_0x182221=>_0x182221['id']===_0x267041['selectedIdentityId']);let _0x50494a='用户',_0x3e8aba='';_0x3b5974&&(_0x50494a=_0x267041[_0x5250c4(0x567)]||_0x3b5974[_0x5250c4(0x1a1c)],_0x3e8aba=_0x267041[_0x5250c4(0x11cd)]||_0x3b5974[_0x5250c4(0x1994)]);const _0x110053=document[_0x5250c4(0xac6)](_0x5250c4(0xbbc));_0x110053[_0x5250c4(0x1722)]=_0x5250c4(0x178b),_0x110053[_0x5250c4(0x1f36)]=()=>changeMyGroupAvatar(),_0x110053[_0x5250c4(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22member-avatar\x22\x20src=\x22'+(_0x3e8aba||createDefaultAvatar(_0x50494a))+_0x5250c4(0x222c)+_0x50494a+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>'+_0x50494a+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xd481a9[_0x5250c4(0x497)](_0x110053);currentChatCharacter['members']&&currentChatCharacter[_0x5250c4(0x12a6)]['length']>0x0&&currentChatCharacter[_0x5250c4(0x12a6)][_0x5250c4(0x19fb)](_0x24e22c=>{const _0x3b448b=_0x5250c4,_0x2aa8f4=document[_0x3b448b(0xac6)](_0x3b448b(0xbbc));_0x2aa8f4['className']=_0x3b448b(0x13da),_0x2aa8f4[_0x3b448b(0x33a)]=_0x3b448b(0x20fc)+(_0x24e22c[_0x3b448b(0x1994)]||createDefaultAvatar(_0x24e22c[_0x3b448b(0x1a1c)]))+_0x3b448b(0x1193)+_0x24e22c['name']+_0x3b448b(0x10ba)+_0x24e22c['id']+'\x27,\x20event)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22点击更换'+_0x24e22c['name']+_0x3b448b(0x1afe)+_0x24e22c['name']+_0x3b448b(0x19f3),_0xd481a9['appendChild'](_0x2aa8f4);});const _0x4121fa=document[_0x5250c4(0xac6)](_0x5250c4(0xbbc));_0x4121fa[_0x5250c4(0x1722)]='member-item\x20add-member',_0x4121fa[_0x5250c4(0x1f36)]=()=>addGroupMember(),_0x4121fa[_0x5250c4(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-avatar\x20add-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22member-name\x22>邀请</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xd481a9['appendChild'](_0x4121fa);if(currentChatCharacter['members']&&currentChatCharacter['members']['length']>0x0){const _0x414595=document[_0x5250c4(0xac6)](_0x5250c4(0xbbc));_0x414595[_0x5250c4(0x1722)]='member-item\x20remove-member',_0x414595[_0x5250c4(0x1f36)]=()=>removeGroupMember(),_0x414595[_0x5250c4(0x33a)]=_0x5250c4(0x1b45),_0xd481a9[_0x5250c4(0x497)](_0x414595);}}function showMemberProfile(_0x2ef200){const _0x3ae891=_0x211817;alert(_0x3ae891(0xfc7)+_0x2ef200[_0x3ae891(0x1a1c)]+_0x3ae891(0x86b)+_0x2ef200['id']+_0x3ae891(0x739));}function showUserProfile(){const _0x173c7e=_0x211817;let _0x18e26d='用户',_0x16b6e7='群聊成员';currentChatCharacter[_0x173c7e(0x42a)]&&(_0x18e26d=currentChatCharacter[_0x173c7e(0x42a)],_0x16b6e7=_0x173c7e(0x19c)+currentChatCharacter[_0x173c7e(0x42a)]),alert('👤\x20我的信息\x0a\x0a昵称：'+_0x18e26d+'\x0a身份：'+_0x16b6e7+_0x173c7e(0xf7d));}function createDefaultAvatar(_0x4d1d81){const _0x357e8f=_0x211817,_0xc425f2=document[_0x357e8f(0xac6)]('canvas');_0xc425f2[_0x357e8f(0x12f1)]=0x32,_0xc425f2[_0x357e8f(0xe6b)]=0x32;const _0x521fec=_0xc425f2[_0x357e8f(0x21c7)]('2d'),_0xe63fd6=[_0x357e8f(0x320),'#4ECDC4',_0x357e8f(0x998),'#96CEB4','#FECA57','#FF9FF3',_0x357e8f(0x667)],_0x5e1593=_0xe63fd6[_0x4d1d81[_0x357e8f(0x1833)](0x0)%_0xe63fd6[_0x357e8f(0x19ee)]];return _0x521fec[_0x357e8f(0x7f8)](),_0x521fec[_0x357e8f(0x152d)](0x19,0x19,0x19,0x0,0x2*Math['PI']),_0x521fec[_0x357e8f(0x27d)]=_0x5e1593,_0x521fec[_0x357e8f(0xa2d)](),_0x521fec[_0x357e8f(0x27d)]=_0x357e8f(0x2167),_0x521fec['font']=_0x357e8f(0x2200),_0x521fec[_0x357e8f(0x22b)]=_0x357e8f(0xcef),_0x521fec[_0x357e8f(0x6c2)]=_0x357e8f(0x1a3d),_0x521fec[_0x357e8f(0x1d5e)](_0x4d1d81[_0x357e8f(0xcc3)](0x0),0x19,0x19),_0xc425f2[_0x357e8f(0x7f5)]();}function showGroupMembers(){const _0x51c831=_0x211817;alert(_0x51c831(0xde6));}async function changeMyGroupNickname(){const _0x581f15=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x581f15(0x1f68)])return;const _0x5ea6d0=getCurrentChatSettings(),_0x556611=personas[_0x581f15(0xaf4)](_0x36eb57=>_0x36eb57['id']===_0x5ea6d0[_0x581f15(0x145e)]),_0x278fe6=_0x5ea6d0[_0x581f15(0x567)]||(_0x556611?_0x556611[_0x581f15(0x1a1c)]:'用户'),_0x2fe50e=prompt(_0x581f15(0x1e0b),_0x278fe6);if(_0x2fe50e&&_0x2fe50e[_0x581f15(0x19d7)]()!==''&&_0x2fe50e[_0x581f15(0x19d7)]()!==_0x278fe6){const _0x1eb828=_0x2fe50e[_0x581f15(0x19d7)]();_0x5ea6d0[_0x581f15(0x567)]=_0x1eb828,await saveCurrentChatSettings(_0x5ea6d0);const _0x2c4838={'id':_0x581f15(0xb7e)+Date[_0x581f15(0x2eb)](),'sender':_0x581f15(0x1744),'content':_0x581f15(0x22b0)+_0x1eb828+'\x22','timestamp':Date[_0x581f15(0x2eb)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']]['push'](_0x2c4838);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console[_0x581f15(0x2187)](_0x581f15(0x191c));}catch(_0x40ea5a){console['error'](_0x581f15(0x1e05),_0x40ea5a),await saveChatMessages();}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']),showToast(_0x581f15(0xefc),_0x581f15(0x11cb));}}async function changeMyGroupAvatar(){const _0x4b1293=_0x211817;if(!currentChatCharacter)return;const _0x4377b1=document[_0x4b1293(0xac6)](_0x4b1293(0x1823));_0x4377b1[_0x4b1293(0x1a4b)]=_0x4b1293(0x1b7a),_0x4377b1[_0x4b1293(0x1515)]=_0x4b1293(0x2ae),_0x4377b1[_0x4b1293(0x14eb)]['display']=_0x4b1293(0x102b),_0x4377b1[_0x4b1293(0x1980)]=async _0x174c8c=>{const _0x122892=_0x4b1293;if(!_0x174c8c[_0x122892(0x193d)][_0x122892(0xf26)]||!_0x174c8c[_0x122892(0x193d)][_0x122892(0xf26)][0x0])return;const _0x10eae0=_0x174c8c[_0x122892(0x193d)][_0x122892(0xf26)][0x0],_0x593b36=new FileReader();_0x593b36['onload']=async _0x5ce36f=>{const _0x26f0be=_0x122892,_0x10d11f=_0x5ce36f['target'][_0x26f0be(0x4ee)],_0xf8b9a2=getCurrentChatSettings();_0xf8b9a2[_0x26f0be(0x11cd)]=_0x10d11f,await saveCurrentChatSettings(_0xf8b9a2);const _0x2e3cc9={'id':'system_'+Date[_0x26f0be(0x2eb)](),'sender':_0x26f0be(0x1744),'content':_0x26f0be(0x1498),'timestamp':Date[_0x26f0be(0x2eb)]()};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']]['push'](_0x2e3cc9);try{await saveChatMessagesImmediate([currentChatCharacter['id']]),console[_0x26f0be(0x2187)](_0x26f0be(0x226));}catch(_0x5f5bb0){console[_0x26f0be(0x174a)](_0x26f0be(0xcee),_0x5f5bb0),await saveChatMessages();}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']),showToast('群头像更换成功！',_0x26f0be(0x11cb));},_0x593b36[_0x122892(0x127c)](_0x10eae0),document[_0x122892(0x1da9)]['removeChild'](_0x4377b1);},document[_0x4b1293(0x1da9)]['appendChild'](_0x4377b1),_0x4377b1[_0x4b1293(0x1859)]();}function editGroupDescription(){const _0x4783e4=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x4783e4(0x1f68)])return;showGroupNoticeModal();}function showGroupNoticeModal(){const _0x1018a2=_0x211817,_0x39e1b1=document[_0x1018a2(0x1262)](_0x1018a2(0x120b)),_0x11a2e0=document[_0x1018a2(0x1262)](_0x1018a2(0x1c9a)),_0x495a9e=document[_0x1018a2(0x1262)](_0x1018a2(0x1921)),_0xac4891=currentChatCharacter?.[_0x1018a2(0x7c9)]||'';_0x11a2e0['value']=_0xac4891,_0x495a9e[_0x1018a2(0x13be)]=_0xac4891[_0x1018a2(0x19ee)],_0x11a2e0[_0x1018a2(0x21e9)](_0x1018a2(0x1823),updateNoticeCharCount),_0x39e1b1[_0x1018a2(0x14eb)][_0x1018a2(0x4da)]=_0x1018a2(0x1fb7),setTimeout(()=>_0x11a2e0['focus'](),0x64);}function hideGroupNoticeModal(){const _0x303b84=_0x211817,_0x842faa=document['getElementById']('group-notice-modal'),_0xb1a529=document[_0x303b84(0x1262)](_0x303b84(0x1c9a));_0xb1a529[_0x303b84(0xa21)]('input',updateNoticeCharCount),_0x842faa[_0x303b84(0x14eb)][_0x303b84(0x4da)]='none';}function updateNoticeCharCount(){const _0x5475ae=_0x211817,_0x589eab=document[_0x5475ae(0x1262)]('group-notice-content'),_0x4c9739=document[_0x5475ae(0x1262)](_0x5475ae(0x1921));_0x4c9739[_0x5475ae(0x13be)]=_0x589eab[_0x5475ae(0x1ebc)][_0x5475ae(0x19ee)];if(_0x589eab[_0x5475ae(0x1ebc)]['length']>0x1f4)_0x4c9739[_0x5475ae(0x14eb)][_0x5475ae(0xc3d)]=_0x5475ae(0x31e);else _0x589eab[_0x5475ae(0x1ebc)][_0x5475ae(0x19ee)]>0x1c2?_0x4c9739['style'][_0x5475ae(0xc3d)]=_0x5475ae(0x202e):_0x4c9739[_0x5475ae(0x14eb)][_0x5475ae(0xc3d)]=_0x5475ae(0xa44);}function saveGroupNotice(){const _0x168ac3=_0x211817,_0x44161d=document[_0x168ac3(0x1262)](_0x168ac3(0x1c9a)),_0x4d23d4=_0x44161d['value']['trim']();if(_0x4d23d4[_0x168ac3(0x19ee)]>0x1f4){alert('群公告内容不能超过500字');return;}currentChatCharacter[_0x168ac3(0x7c9)]=_0x4d23d4;if(groupChats){const _0x24bc0d=groupChats['findIndex'](_0x5a7676=>_0x5a7676['id']===currentChatCharacter['id']);_0x24bc0d!==-0x1&&(groupChats[_0x24bc0d]['description']=_0x4d23d4,saveGroupChats(groupChats));}updateGroupChatInfo(),hideGroupNoticeModal(),showToast(_0x168ac3(0x1fed),'success');}function addGroupMember(){const _0x931359=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x931359(0x1f68)])return;if(!characters||characters[_0x931359(0x19ee)]===0x0){alert(_0x931359(0x2f4));return;}const _0x529aea=currentChatCharacter[_0x931359(0x12a6)]?currentChatCharacter[_0x931359(0x12a6)][_0x931359(0x6a4)](_0x594ed7=>_0x594ed7['id']):[],_0x58851a=characters[_0x931359(0x1e1f)](_0xb84351=>!_0x529aea[_0x931359(0x1831)](_0xb84351['id']));if(_0x58851a[_0x931359(0x19ee)]===0x0){alert(_0x931359(0x1169));return;}showCharacterSelectionModal(_0x58851a,_0x931359(0x1182),_0x931359(0x1389),_0x5a7947=>{const _0x3153ba=_0x931359;!currentChatCharacter[_0x3153ba(0x12a6)]&&(currentChatCharacter[_0x3153ba(0x12a6)]=[]);currentChatCharacter[_0x3153ba(0x12a6)][_0x3153ba(0x1cd6)]({'id':_0x5a7947['id'],'name':_0x5a7947[_0x3153ba(0x1a1c)],'avatarUrl':_0x5a7947['avatarUrl']});if(groupChats){const _0x55580e=groupChats[_0x3153ba(0x150c)](_0x20a19e=>_0x20a19e['id']===currentChatCharacter['id']);_0x55580e!==-0x1&&(groupChats[_0x55580e][_0x3153ba(0x12a6)]=currentChatCharacter['members'],saveGroupChats(groupChats));}const _0x1375f9={'id':Date[_0x3153ba(0x2eb)]()[_0x3153ba(0x1878)](),'content':_0x5a7947['name']+'\x20加入了群聊','timestamp':Date[_0x3153ba(0x2eb)](),'sender':_0x3153ba(0x1744),'type':_0x3153ba(0x2c3)};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x3153ba(0x1cd6)](_0x1375f9),saveChatMessages(),updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']);const _0x26c315=document[_0x3153ba(0x1262)](_0x3153ba(0x2053));if(_0x26c315){let _0x8687b7=currentChatCharacter['name'];const _0x46a425=currentChatCharacter['members'][_0x3153ba(0x19ee)]+0x1;_0x8687b7=_0x8687b7+'（'+_0x46a425+'）',_0x26c315['textContent']=_0x8687b7,_0x26c315[_0x3153ba(0x1c1b)][_0x3153ba(0x1493)](_0x3153ba(0x10f8)),_0x26c315[_0x3153ba(0x1ecd)][_0x3153ba(0x417)]=_0x8687b7;}showToast('✅\x20'+_0x5a7947['name']+_0x3153ba(0xa78),_0x3153ba(0x11cb));});}function removeGroupMember(){const _0x4aeb2d=_0x211817;if(!currentChatCharacter||!currentChatCharacter[_0x4aeb2d(0x1f68)]||!currentChatCharacter[_0x4aeb2d(0x12a6)])return;if(currentChatCharacter[_0x4aeb2d(0x12a6)][_0x4aeb2d(0x19ee)]<=0x1){alert('群聊至少需要保留一个角色成员（不包括用户自己）');return;}showCharacterSelectionModal(currentChatCharacter[_0x4aeb2d(0x12a6)],_0x4aeb2d(0x7a0),'请选择要移出群聊的成员：',_0x57debe=>{const _0x350a72=_0x4aeb2d;if(confirm(_0x350a72(0x20f7)+_0x57debe['name']+'\x20移出群聊吗？')){const _0x3ef728=currentChatCharacter[_0x350a72(0x12a6)][_0x350a72(0x150c)](_0x309e3c=>_0x309e3c['id']===_0x57debe['id']);if(_0x3ef728!==-0x1){currentChatCharacter['members'][_0x350a72(0x19b2)](_0x3ef728,0x1);const _0x134fa4={'id':Date[_0x350a72(0x2eb)]()[_0x350a72(0x1878)](),'content':_0x57debe['name']+'\x20退出了群聊','timestamp':Date[_0x350a72(0x2eb)](),'sender':'system','type':_0x350a72(0x2c3)};!chatMessages[currentChatCharacter['id']]&&(chatMessages[currentChatCharacter['id']]=[]);chatMessages[currentChatCharacter['id']][_0x350a72(0x1cd6)](_0x134fa4),saveChatMessages();if(groupChats){const _0x152f3c=groupChats[_0x350a72(0x150c)](_0x40ca40=>_0x40ca40['id']===currentChatCharacter['id']);_0x152f3c!==-0x1&&(groupChats[_0x152f3c]['members']=currentChatCharacter['members'],saveGroupChats(groupChats));}updateGroupChatInfo(),renderChatMessages(currentChatCharacter['id']);const _0x93a17a=document['getElementById']('api-chat-title');if(_0x93a17a){let _0x1aa8a7=currentChatCharacter[_0x350a72(0x1a1c)];const _0x547a4e=currentChatCharacter[_0x350a72(0x12a6)][_0x350a72(0x19ee)]+0x1;_0x1aa8a7=_0x1aa8a7+'（'+_0x547a4e+'）',_0x93a17a[_0x350a72(0x13be)]=_0x1aa8a7,_0x93a17a[_0x350a72(0x1c1b)][_0x350a72(0x1493)](_0x350a72(0x10f8)),_0x93a17a['dataset'][_0x350a72(0x417)]=_0x1aa8a7;}showToast('✅\x20'+_0x57debe[_0x350a72(0x1a1c)]+_0x350a72(0xdf1),'success');}}});}function showGroupNotice(){const _0x214ea8=_0x211817,_0x25dbf0=currentChatCharacter?.['description']||_0x214ea8(0x1863);alert(_0x214ea8(0x12f0)+_0x25dbf0+_0x214ea8(0x13eb));}function showCharacterSelectionModal(_0x51f718,_0x26fb4a,_0x20a1af,_0x2181eb){const _0x549dfa=_0x211817,_0x129c4a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x20character-selection-modal\x22\x20id=\x22character-selection-modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>'+_0x26fb4a+_0x549dfa(0x1afa)+_0x20a1af+_0x549dfa(0x970)+_0x51f718[_0x549dfa(0x6a4)](_0xb4ee07=>_0x549dfa(0xb29)+_0xb4ee07['id']+_0x549dfa(0xf6e)+(_0xb4ee07[_0x549dfa(0x1994)]||createDefaultAvatar(_0xb4ee07[_0x549dfa(0x1a1c)]))+'\x22\x20alt=\x22'+_0xb4ee07[_0x549dfa(0x1a1c)]+_0x549dfa(0x1de7)+_0xb4ee07[_0x549dfa(0x1a1c)]+_0x549dfa(0x1b89)+(_0xb4ee07[_0x549dfa(0x7c9)]||_0xb4ee07[_0x549dfa(0x1f0b)]||_0x549dfa(0x1569))[_0x549dfa(0x17ca)](0x0,0x1e)+((_0xb4ee07[_0x549dfa(0x7c9)]||_0xb4ee07[_0x549dfa(0x1f0b)]||'')[_0x549dfa(0x19ee)]>0x1e?_0x549dfa(0x1520):'')+_0x549dfa(0x1870))['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-secondary\x22\x20onclick=\x22hideCharacterSelectionModal()\x22>取消</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-primary\x22\x20id=\x22confirm-selection-btn\x22\x20onclick=\x22confirmCharacterSelection()\x22\x20disabled>确定</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x3849fd=document[_0x549dfa(0x1262)]('character-selection-modal');_0x3849fd&&_0x3849fd['remove'](),document[_0x549dfa(0x1da9)]['insertAdjacentHTML'](_0x549dfa(0x42e),_0x129c4a),window['characterSelectionCallback']=_0x2181eb,window['selectedCharacterId']=null,document[_0x549dfa(0x1897)](_0x549dfa(0x21d))[_0x549dfa(0x19fb)](_0x2ccd7f=>{const _0xf415=_0x549dfa;_0x2ccd7f[_0xf415(0x21e9)]('click',function(){const _0x5732bc=_0xf415;document['querySelectorAll'](_0x5732bc(0x21d))[_0x5732bc(0x19fb)](_0x3a2655=>_0x3a2655[_0x5732bc(0x1c1b)][_0x5732bc(0x1493)]('selected')),this[_0x5732bc(0x1c1b)]['add'](_0x5732bc(0x176b)),window[_0x5732bc(0x6d1)]=this['dataset']['characterId'],document[_0x5732bc(0x1262)](_0x5732bc(0x1918))[_0x5732bc(0x559)]=![];});});}function hideCharacterSelectionModal(){const _0x2f9dc7=_0x211817,_0x3f8832=document[_0x2f9dc7(0x1262)](_0x2f9dc7(0x14fc));_0x3f8832&&_0x3f8832[_0x2f9dc7(0x1493)](),window[_0x2f9dc7(0x10c2)]=null,window[_0x2f9dc7(0x6d1)]=null;}function confirmCharacterSelection(){const _0x4ba7ab=_0x211817;if(!window[_0x4ba7ab(0x6d1)]||!window[_0x4ba7ab(0x10c2)])return;const _0x4dd41f=[...characters,...currentChatCharacter[_0x4ba7ab(0x12a6)]||[]],_0x5b0bbc=_0x4dd41f[_0x4ba7ab(0xaf4)](_0x441ae6=>_0x441ae6['id']===window[_0x4ba7ab(0x6d1)]);_0x5b0bbc&&(window[_0x4ba7ab(0x10c2)](_0x5b0bbc),hideCharacterSelectionModal());}function changeMemberAvatar(_0x51f5b1,_0x4b2659){const _0x41b4ce=_0x211817;_0x4b2659[_0x41b4ce(0x902)]();const _0x47dc9e=currentChatCharacter[_0x41b4ce(0x12a6)]['find'](_0x2720d7=>_0x2720d7['id']===_0x51f5b1);if(!_0x47dc9e)return;showMemberAvatarModal(_0x47dc9e);}function showMemberAvatarModal(_0x28f0a1){const _0x5ef639=_0x211817,_0x462eed=document[_0x5ef639(0x1262)]('member-avatar-modal'),_0x34abba=document[_0x5ef639(0x1262)](_0x5ef639(0x8f2)),_0x1b97fe=document[_0x5ef639(0x1262)]('member-avatar-name'),_0x3a7534=document[_0x5ef639(0x1262)](_0x5ef639(0x63e));window['currentEditingMember']=_0x28f0a1,_0x1b97fe['textContent']=_0x28f0a1[_0x5ef639(0x1a1c)],_0x34abba['src']=_0x28f0a1[_0x5ef639(0x1994)]||createDefaultAvatar(_0x28f0a1[_0x5ef639(0x1a1c)]),_0x3a7534[_0x5ef639(0x1ebc)]='',_0x462eed[_0x5ef639(0x14eb)][_0x5ef639(0x4da)]=_0x5ef639(0x1fb7);}function hideMemberAvatarModal(){const _0x27ef2f=_0x211817,_0x3a66ba=document['getElementById'](_0x27ef2f(0x1797));_0x3a66ba[_0x27ef2f(0x14eb)]['display']=_0x27ef2f(0x102b),window['currentEditingMember']=null;}function handleMemberAvatarUpload(){const _0xd61fb7=_0x211817,_0x158798=document[_0xd61fb7(0x1262)](_0xd61fb7(0x63e));_0x158798[_0xd61fb7(0x1859)]();}function saveMemberAvatar(){const _0x29ddd0=_0x211817;if(!window['currentEditingMember'])return;const _0x2a0412=document[_0x29ddd0(0x1262)](_0x29ddd0(0x8f2)),_0x21aba9=_0x2a0412['src'],_0x30d393=currentChatCharacter[_0x29ddd0(0x12a6)][_0x29ddd0(0x150c)](_0x337251=>_0x337251['id']===window[_0x29ddd0(0x1383)]['id']);if(_0x30d393!==-0x1){currentChatCharacter[_0x29ddd0(0x12a6)][_0x30d393][_0x29ddd0(0x1994)]=_0x21aba9;const _0x4a2261=characters[_0x29ddd0(0x150c)](_0x5ef976=>_0x5ef976['id']===window[_0x29ddd0(0x1383)]['id']);_0x4a2261!==-0x1&&(characters[_0x4a2261][_0x29ddd0(0x1994)]=_0x21aba9,saveCharacters(characters));if(groupChats){const _0x337289=groupChats[_0x29ddd0(0x150c)](_0x5d0fee=>_0x5d0fee['id']===currentChatCharacter['id']);_0x337289!==-0x1&&(groupChats[_0x337289][_0x29ddd0(0x12a6)]=currentChatCharacter[_0x29ddd0(0x12a6)],saveGroupChats(groupChats));}addAvatarChangeMessage(window[_0x29ddd0(0x1383)][_0x29ddd0(0x1a1c)]),updateGroupChatInfo(),renderGroupMembersGrid(),refreshChatMessages(),showToast('✅\x20'+window[_0x29ddd0(0x1383)]['name']+'\x20的头像已更新','success');}hideMemberAvatarModal();}function addAvatarChangeMessage(_0x26a2d0){const _0xec36e3=_0x211817;(!currentChatCharacter||!chatMessages[currentChatCharacter['id']])&&(chatMessages[currentChatCharacter['id']]=[]);const _0x2cb757={'id':'system_'+Date['now'](),'sender':_0xec36e3(0x1744),'content':_0x26a2d0+'\x20更换了头像','timestamp':Date['now'](),'isSystem':!![]};chatMessages[currentChatCharacter['id']][_0xec36e3(0x1cd6)](_0x2cb757),saveChatMessages(),currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);}function refreshChatMessages(){currentChatCharacter&&renderChatMessages(currentChatCharacter['id']);}function resetMemberAvatar(){const _0x5764f8=_0x211817;if(!window[_0x5764f8(0x1383)])return;const _0x523396=document['getElementById']('member-avatar-preview'),_0x285249=createDefaultAvatar(window[_0x5764f8(0x1383)]['name']);_0x523396[_0x5764f8(0x45c)]=_0x285249;}async function checkAndFixChatHistory(){const _0x5df94b=_0x211817;try{console[_0x5df94b(0x2187)](_0x5df94b(0xe7a));const _0x712bd8=await db[_0x5df94b(0x19a2)][_0x5df94b(0xf13)](),_0xcbb49a=chatMessages;console[_0x5df94b(0x2187)](_0x5df94b(0xde4),_0x712bd8['length']),console[_0x5df94b(0x2187)](_0x5df94b(0x1598),Object['keys'](_0xcbb49a)['length']);const _0x2b377b=localStorage[_0x5df94b(0x15d8)](_0x5df94b(0x19a2));if(_0x2b377b)try{const _0x49b3b7=JSON['parse'](_0x2b377b);console['log'](_0x5df94b(0x1295));let _0x1b1a23=![],_0x160c12=0x0;for(const [_0x386d9f,_0x2b8df6]of Object[_0x5df94b(0x2bc)](_0x49b3b7)){if(_0x2b8df6&&_0x2b8df6[_0x5df94b(0x19ee)]>0x0){const _0x776ac5=Math[_0x5df94b(0x658)](..._0x2b8df6[_0x5df94b(0x6a4)](_0x49bc1e=>_0x49bc1e[_0x5df94b(0x1716)]||0x0)),_0xa8f985=_0xcbb49a[_0x386d9f]||[],_0x309173=_0xa8f985['length']>0x0?Math[_0x5df94b(0x658)](..._0xa8f985[_0x5df94b(0x6a4)](_0x2fadd7=>_0x2fadd7[_0x5df94b(0x1716)]||0x0)):0x0;_0x776ac5>_0x309173&&(console[_0x5df94b(0x2187)](_0x5df94b(0x150a)+_0x386d9f+_0x5df94b(0x1d27)+new Date(_0x776ac5)+_0x5df94b(0x4ca)+new Date(_0x309173)+')'),_0x1b1a23=!![],_0x160c12+=_0x2b8df6[_0x5df94b(0x19ee)]-_0xa8f985['length']);}}if(_0x1b1a23){const _0x476f90=confirm('检测到localStorage中有更新的聊天记录！\x0a\x0a发现\x20'+_0x160c12+_0x5df94b(0x259));if(_0x476f90){Object[_0x5df94b(0x72c)](chatMessages,_0x49b3b7);try{const _0xb48c27=Object[_0x5df94b(0x1c9f)](_0x49b3b7);await saveChatMessagesImmediate(_0xb48c27),console[_0x5df94b(0x2187)](_0x5df94b(0xba0));}catch(_0x17cc1f){console[_0x5df94b(0x174a)]('数据恢复保存失败，回退到全量保存:',_0x17cc1f),await saveChatMessages();}return currentChatCharacter&&renderChatMessages(currentChatCharacter['id']),showToast(_0x5df94b(0x39b)+_0x160c12+_0x5df94b(0x613),_0x5df94b(0x11cb)),!![];}}}catch(_0xe9fc9b){console['error'](_0x5df94b(0x2188),_0xe9fc9b);}let _0x18e328=0x0;const _0x3b56b2=Date['now'](),_0x5a1276=_0x3b56b2-0x7*0x18*0x3c*0x3c*0x3e8;for(const [_0x10fce4,_0xf635ce]of Object['entries'](chatMessages)){if(_0xf635ce&&Array['isArray'](_0xf635ce)){for(let _0x1ed86f=0x0;_0x1ed86f<_0xf635ce[_0x5df94b(0x19ee)];_0x1ed86f++){const _0x1e9f96=_0xf635ce[_0x1ed86f];if(!_0x1e9f96['timestamp']||_0x1e9f96[_0x5df94b(0x1716)]>_0x3b56b2||_0x1e9f96[_0x5df94b(0x1716)]<_0x5a1276){const _0x2fa78a=_0x3b56b2-(_0xf635ce['length']-_0x1ed86f)*0xea60;console[_0x5df94b(0x2187)](_0x5df94b(0x21fe)+_0x1e9f96[_0x5df94b(0x1716)]+'\x20->\x20'+_0x2fa78a),_0x1e9f96['timestamp']=_0x2fa78a,_0x18e328++;}}_0xf635ce[_0x5df94b(0x1104)]((_0x392d89,_0x460ef0)=>_0x392d89['timestamp']-_0x460ef0['timestamp']);}}if(_0x18e328>0x0){try{const _0x1e3b48=Object[_0x5df94b(0x1c9f)](chatMessages)[_0x5df94b(0x1e1f)](_0x1e1834=>chatMessages[_0x1e1834]&&chatMessages[_0x1e1834][_0x5df94b(0x19ee)]>0x0);await saveChatMessagesImmediate(_0x1e3b48),console[_0x5df94b(0x2187)](_0x5df94b(0x1938));}catch(_0x2f5f47){console['error'](_0x5df94b(0x1b83),_0x2f5f47),await saveChatMessages();}showToast(_0x5df94b(0x3df)+_0x18e328+_0x5df94b(0x170e),_0x5df94b(0x477));}return![];}catch(_0x502d22){return console['error'](_0x5df94b(0xdd7),_0x502d22),![];}}function showToast(_0x330447,_0x1bcb07=_0x211817(0x477)){const _0x391660=_0x211817,_0x184905=document['createElement'](_0x391660(0xbbc));_0x184905[_0x391660(0x1722)]=_0x391660(0x8da)+_0x1bcb07,_0x184905['textContent']=_0x330447,_0x184905[_0x391660(0x14eb)]['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x2050%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20'+(_0x1bcb07==='success'?_0x391660(0x1d8c):_0x1bcb07==='error'?_0x391660(0x1412):_0x391660(0xb2d))+_0x391660(0x211d),document[_0x391660(0x1da9)]['appendChild'](_0x184905),setTimeout(()=>{const _0x4288bc=_0x391660;_0x184905[_0x4288bc(0x14eb)][_0x4288bc(0x11af)]='1',_0x184905['style'][_0x4288bc(0x201e)]=_0x4288bc(0x20c9);},0x64),setTimeout(()=>{const _0x33e122=_0x391660;_0x184905['style']['opacity']='0',_0x184905[_0x33e122(0x14eb)][_0x33e122(0x201e)]=_0x33e122(0xe26),setTimeout(()=>{const _0x1d7263=_0x33e122;_0x184905['parentNode']&&_0x184905[_0x1d7263(0x148c)][_0x1d7263(0x858)](_0x184905);},0x12c);},0xbb8);}function truncateText(_0x39a32f,_0x33d8da=0x50){const _0x4eadfc=_0x211817;if(_0x39a32f===null||_0x39a32f===undefined)return'';typeof _0x39a32f!=='string'&&(_0x39a32f=String(_0x39a32f));if(!_0x39a32f||_0x39a32f[_0x4eadfc(0x19ee)]<=_0x33d8da)return _0x39a32f;const _0x5877a3=_0x39a32f[_0x4eadfc(0x204b)]('\x0a');let _0x1bd03a='',_0x26a880=0x0;for(const _0x56d376 of _0x5877a3){if(_0x26a880>=0x3)break;if(_0x1bd03a[_0x4eadfc(0x19ee)]+_0x56d376[_0x4eadfc(0x19ee)]+0x1<=_0x33d8da)_0x1bd03a+=(_0x1bd03a?'\x0a':'')+_0x56d376,_0x26a880++;else{const _0x402b78=_0x33d8da-_0x1bd03a[_0x4eadfc(0x19ee)]-0x1;if(_0x402b78>0xa)_0x1bd03a+=(_0x1bd03a?'\x0a':'')+_0x56d376['substring'](0x0,_0x402b78-0x3)+_0x4eadfc(0x1520);else!_0x1bd03a?_0x1bd03a=_0x56d376[_0x4eadfc(0x17ca)](0x0,_0x33d8da-0x3)+'...':_0x1bd03a+=_0x4eadfc(0x1520);break;}}return _0x1bd03a;}function enterMessageListMultiSelectMode(_0x572ebf){const _0x468ab7=_0x211817;console[_0x468ab7(0x2187)](_0x468ab7(0x1dd2),_0x572ebf),isMessageListMultiSelectMode=!![],selectedConversations=[_0x572ebf],renderMessageList(),showToast(_0x468ab7(0xa8c),'info');}function exitMessageListMultiSelectMode(){isMessageListMultiSelectMode=![],selectedConversations=[],renderMessageList();}function toggleConversationSelection(_0x486150){const _0x24e7d0=_0x211817,_0x41a591=selectedConversations[_0x24e7d0(0x13c5)](_0x486150);_0x41a591>-0x1?selectedConversations[_0x24e7d0(0x19b2)](_0x41a591,0x1):selectedConversations[_0x24e7d0(0x1cd6)](_0x486150),renderMessageList();}async function deleteSelectedConversations(){const _0x2ae08c=_0x211817;if(selectedConversations['length']===0x0){showToast(_0x2ae08c(0x2b6),_0x2ae08c(0x174a));return;}const _0x34d4d6=selectedConversations[_0x2ae08c(0x19ee)],_0x42b214='确定要删除选中的\x20'+_0x34d4d6+'\x20个对话吗？\x0a\x0a删除后将清空对话的所有聊天记录和专属设置，此操作不可恢复。';if(confirm(_0x42b214))try{for(const _0x31d14b of selectedConversations){chatMessages[_0x31d14b]&&delete chatMessages[_0x31d14b];await db[_0x2ae08c(0x1789)]['delete'](_0x31d14b);chatSettings[_0x31d14b]&&delete chatSettings[_0x31d14b];localStorage[_0x2ae08c(0x3b2)](_0x2ae08c(0xa25)+_0x31d14b);const _0x2da5ef=characters[_0x2ae08c(0xaf4)](_0x1ef21d=>_0x1ef21d['id']===_0x31d14b);_0x2da5ef&&(_0x2da5ef[_0x2ae08c(0x619)]=null);const _0x196fc6=groupChats['findIndex'](_0x598d16=>_0x598d16['id']===_0x31d14b);if(_0x196fc6>-0x1)groupChats[_0x2ae08c(0x19b2)](_0x196fc6,0x1);else{const _0x4f815f=contacts[_0x2ae08c(0x13c5)](_0x31d14b);_0x4f815f>-0x1&&contacts[_0x2ae08c(0x19b2)](_0x4f815f,0x1);}}await Promise[_0x2ae08c(0x1a47)]([saveChatMessages(),saveGroupChats(),saveContacts()]),exitMessageListMultiSelectMode(),showToast(_0x2ae08c(0x1af)+_0x34d4d6+_0x2ae08c(0x1803),_0x2ae08c(0x11cb));}catch(_0x451d3e){console[_0x2ae08c(0x174a)](_0x2ae08c(0x7ee),_0x451d3e),showToast(_0x2ae08c(0x1934),_0x2ae08c(0x174a));}}let currentForumId=null,worldEvent=null;async function handlePollVote(_0x425ab1,_0x4cbed5){const _0x366f78=_0x211817,_0x5a5e02=_0x425ab1['closest'](_0x366f78(0x49b));if(!_0x5a5e02)return;const _0x2286b3=_0x5a5e02['dataset']['pollType']||_0x366f78(0xdf3),_0x459cf0=window['currentPostId'];if(_0x2286b3==='single'){const _0x3dd283=localStorage['getItem']('poll_voted_'+_0x459cf0);if(_0x5a5e02[_0x366f78(0x1c1b)]['contains'](_0x366f78(0x1fd4))||_0x3dd283&&_0x3dd283!==_0x366f78(0x188d)){showToast(_0x366f78(0x18dd),_0x366f78(0x477));return;}if(!_0x459cf0)return;_0x425ab1[_0x366f78(0x1c1b)][_0x366f78(0x21e2)](_0x366f78(0x1b80)),_0x5a5e02[_0x366f78(0x1c1b)][_0x366f78(0x21e2)]('voted');try{const _0x1e3233=await db[_0x366f78(0x14c4)][_0x366f78(0xb78)](_0x459cf0);if(!_0x1e3233)return;let _0x1595a6=_0x4cbed5;if(!_0x1595a6){const _0x52aa62=_0x425ab1[_0x366f78(0xb30)](_0x366f78(0x1391))?.[_0x366f78(0x13be)]||'';_0x1595a6=_0x52aa62[_0x366f78(0xe16)](/\s+/g,'_')[_0x366f78(0x49e)]();}!_0x1e3233[_0x366f78(0x2009)]&&(_0x1e3233[_0x366f78(0x2009)]={'totalVotes':0x0,'options':{}});!_0x1e3233[_0x366f78(0x2009)][_0x366f78(0x4cd)][_0x1595a6]&&(_0x1e3233[_0x366f78(0x2009)][_0x366f78(0x4cd)][_0x1595a6]=0x0);_0x1e3233['pollData'][_0x366f78(0x4cd)][_0x1595a6]++,_0x1e3233['pollData'][_0x366f78(0x1491)]++,await db['forumPosts'][_0x366f78(0x1561)](_0x1e3233),updatePollUI(_0x459cf0,_0x1e3233[_0x366f78(0x2009)]);const _0x23edf0=_0x425ab1[_0x366f78(0xb30)](_0x366f78(0x1391))?.[_0x366f78(0x13be)]||'';saveVoteRecord(_0x459cf0,_0x1595a6,_0x23edf0,_0x1e3233[_0x366f78(0x378)]),showToast('投票成功！',_0x366f78(0x11cb));}catch(_0x1bd5e1){console[_0x366f78(0x174a)]('单选投票失败:',_0x1bd5e1),showToast(_0x366f78(0x1bd),'error');}}else{if(_0x2286b3==='multiple'){const _0x15ed13=_0x425ab1[_0x366f78(0x1ecd)]['selected']===_0x366f78(0x1098);_0x425ab1['dataset']['selected']=!_0x15ed13,!_0x15ed13?_0x425ab1[_0x366f78(0x1c1b)][_0x366f78(0x21e2)](_0x366f78(0x1b80)):_0x425ab1[_0x366f78(0x1c1b)]['remove'](_0x366f78(0x1b80));}}}async function submitMultipleChoiceVote(_0xa68702){const _0x498b8f=_0x211817,_0x3fb704=_0xa68702[_0x498b8f(0x216a)]('.forum-poll'),_0x31f7f7=window[_0x498b8f(0x6b7)],_0x3c54e7=_0x3fb704[_0x498b8f(0x1897)](_0x498b8f(0x385));if(_0x3c54e7['length']===0x0){showToast(_0x498b8f(0x2214),_0x498b8f(0x477));return;}const _0x28633a=localStorage[_0x498b8f(0x15d8)](_0x498b8f(0x409)+_0x31f7f7);if(_0x3fb704[_0x498b8f(0x1c1b)]['contains']('voted')||_0x28633a&&_0x28633a!=='null'){showToast('您已经投过票了',_0x498b8f(0x477));return;}_0xa68702['disabled']=!![],_0xa68702[_0x498b8f(0x13be)]=_0x498b8f(0x628);try{const _0x2d046c=await db['forumPosts'][_0x498b8f(0xb78)](_0x31f7f7);if(!_0x2d046c)return;!_0x2d046c[_0x498b8f(0x2009)]&&(_0x2d046c[_0x498b8f(0x2009)]={'totalVotes':0x0,'options':{}});let _0x2176af=[];_0x3c54e7[_0x498b8f(0x19fb)](_0xa5efce=>{const _0x4ea85b=_0x498b8f,_0xe30afa=_0xa5efce['getAttribute'](_0x4ea85b(0x1f36));let _0x400fca='';const _0x4740c5=[/'([^']+)'/,/"([^"]+)"/,/handlePollVote\([^,]+,\s*['"]([^'"]+)['"]\)/];for(const _0x31f420 of _0x4740c5){const _0x59cc86=_0xe30afa[_0x4ea85b(0x1b87)](_0x31f420);if(_0x59cc86&&_0x59cc86[0x1]){_0x400fca=_0x59cc86[0x1];break;}}_0x400fca&&(_0x2176af['push'](_0x400fca),!_0x2d046c['pollData']['options'][_0x400fca]&&(_0x2d046c['pollData']['options'][_0x400fca]=0x0),_0x2d046c[_0x4ea85b(0x2009)][_0x4ea85b(0x4cd)][_0x400fca]++,_0x2d046c['pollData']['totalVotes']++);}),await db[_0x498b8f(0x14c4)][_0x498b8f(0x1561)](_0x2d046c),saveVoteRecord(_0x31f7f7,JSON[_0x498b8f(0x6b8)](_0x2176af),_0x2176af[_0x498b8f(0x19ee)]+_0x498b8f(0x1c81),_0x2d046c[_0x498b8f(0x378)]),_0x3fb704['classList']['add'](_0x498b8f(0x1fd4)),updatePollUI(_0x31f7f7,_0x2d046c[_0x498b8f(0x2009)]),showToast('投票成功！',_0x498b8f(0x11cb));}catch(_0x2a55ad){console[_0x498b8f(0x174a)]('多选投票失败:',_0x2a55ad),showToast(_0x498b8f(0x1bd),'error'),_0xa68702[_0x498b8f(0x559)]=![],_0xa68702[_0x498b8f(0x13be)]='投票';}}function updatePollUI(_0x19ff21,_0x5e3e88){const _0x501c13=_0x211817,_0x3e0306=document['querySelector']('.post-full-body\x20.forum-poll');if(!_0x3e0306)return;const _0x5c83a1=_0x5e3e88[_0x501c13(0x1491)]||0x0,_0x29309e=_0x3e0306[_0x501c13(0x1897)](_0x501c13(0xece)),_0x477221=localStorage[_0x501c13(0x15d8)](_0x501c13(0x409)+_0x19ff21);_0x477221&&_0x477221!==_0x501c13(0x188d)&&_0x3e0306[_0x501c13(0x1c1b)][_0x501c13(0x21e2)](_0x501c13(0x1fd4)),_0x29309e['forEach']((_0x3dd9d7,_0x246fdf)=>{const _0x286a75=_0x501c13,_0x4066c1=_0x3dd9d7[_0x286a75(0x2139)](_0x286a75(0x1f36));let _0x10c450='';if(_0x4066c1){const _0x323ef1=[/'([^']+)'/,/"([^"]+)"/,/handlePollVote\([^,]+,\s*['"]([^'"]+)['"]\)/];for(const _0x2408bb of _0x323ef1){const _0x5836a7=_0x4066c1['match'](_0x2408bb);if(_0x5836a7&&_0x5836a7[0x1]){_0x10c450=_0x5836a7[0x1];break;}}}if(!_0x10c450){const _0x2f5add=_0x3dd9d7[_0x286a75(0xb30)](_0x286a75(0x1391))?.[_0x286a75(0x13be)]||'';_0x10c450=_0x2f5add[_0x286a75(0xe16)](/\s+/g,'_')[_0x286a75(0x49e)](),!_0x4066c1&&_0x3dd9d7[_0x286a75(0x1058)](_0x286a75(0x1f36),'handlePollVote(this,\x20\x27'+_0x10c450+'\x27)');}if(!_0x3dd9d7[_0x286a75(0xb30)](_0x286a75(0x2212))){_0x3dd9d7[_0x286a75(0x14eb)][_0x286a75(0xbc7)]=_0x286a75(0x18dc);const _0x1e2254=document[_0x286a75(0xac6)](_0x286a75(0xbbc));_0x1e2254[_0x286a75(0x1722)]=_0x286a75(0xde9);const _0xf798d1=document[_0x286a75(0xac6)](_0x286a75(0xbbc));_0xf798d1['className']=_0x286a75(0xa00),_0x1e2254[_0x286a75(0x497)](_0xf798d1),_0x3dd9d7[_0x286a75(0x1f04)](_0x1e2254,_0x3dd9d7[_0x286a75(0xb60)]);}let _0xf5ec89=_0x5e3e88[_0x286a75(0x4cd)][_0x10c450]||0x0;if(_0xf5ec89===0x0&&Object[_0x286a75(0x1c9f)](_0x5e3e88['options'])[_0x286a75(0x19ee)]>0x0){const _0x345c52=_0x3dd9d7[_0x286a75(0xb30)](_0x286a75(0x1391))?.[_0x286a75(0x13be)]||'';for(const [_0x5de56b,_0x186617]of Object['entries'](_0x5e3e88[_0x286a75(0x4cd)])){if(_0x5de56b[_0x286a75(0x1831)](_0x345c52[_0x286a75(0x49e)]())||_0x345c52[_0x286a75(0x49e)]()[_0x286a75(0x1831)](_0x5de56b)){_0xf5ec89=_0x186617,_0x10c450=_0x5de56b;break;}}}const _0x3ac787=_0x5c83a1>0x0?(_0xf5ec89/_0x5c83a1*0x64)[_0x286a75(0x13ad)](0x1):0x0;if(_0x477221&&_0x477221!==_0x286a75(0x188d))try{const _0x2f61a3=JSON[_0x286a75(0x22d3)](_0x477221);Array[_0x286a75(0x1496)](_0x2f61a3)&&_0x2f61a3[_0x286a75(0x1831)](_0x10c450)?_0x3dd9d7['classList'][_0x286a75(0x21e2)](_0x286a75(0x1b80)):_0x3dd9d7['classList'][_0x286a75(0x1493)]('user-voted');}catch(_0x15c196){_0x10c450===_0x477221||_0x477221[_0x286a75(0x1831)](_0x10c450)||_0x10c450[_0x286a75(0x1831)](_0x477221)?_0x3dd9d7[_0x286a75(0x1c1b)]['add']('user-voted'):_0x3dd9d7['classList'][_0x286a75(0x1493)](_0x286a75(0x1b80));}else _0x3dd9d7[_0x286a75(0x1c1b)][_0x286a75(0x1493)](_0x286a75(0x1b80));const _0x26d884=_0x3dd9d7['querySelector'](_0x286a75(0x16fb)),_0xb3b30d=_0x3dd9d7['querySelector'](_0x286a75(0x22fc));_0x26d884&&(_0x26d884[_0x286a75(0x13be)]=_0xf5ec89+_0x286a75(0x27c)+_0x3ac787+'%)'),_0xb3b30d&&setTimeout(()=>{_0xb3b30d['style']['width']=_0x3ac787+'%';},0x64+_0x246fdf*0x32);});}async function generateSmartPollData(_0x122135,_0x3a9720){const _0x2d0cc2=_0x211817;if(_0x3a9720['pollData']&&_0x3a9720[_0x2d0cc2(0x2009)][_0x2d0cc2(0x1491)]>0x0){updatePollUI(_0x122135,_0x3a9720[_0x2d0cc2(0x2009)]);return;}const _0x5f85b9=document[_0x2d0cc2(0xb30)](_0x2d0cc2(0x1d50));if(!_0x5f85b9)return;const _0x259eb6=_0x5f85b9[_0x2d0cc2(0x1897)](_0x2d0cc2(0xece));if(_0x259eb6[_0x2d0cc2(0x19ee)]===0x0)return;const _0x5ccb72={'totalVotes':0x0,'options':{}},_0x3f99ea=Math[_0x2d0cc2(0x2180)](Math[_0x2d0cc2(0x11a8)]()*0x28)+0xf,_0x3dc434=_0x3a9720[_0x2d0cc2(0x378)][_0x2d0cc2(0x1831)]('颜值')||_0x3a9720['title'][_0x2d0cc2(0x1831)]('人气')||_0x3a9720['title'][_0x2d0cc2(0x1831)]('最'),_0x1e4a51=_0x3dc434?_0x3f99ea+Math[_0x2d0cc2(0x2180)](Math[_0x2d0cc2(0x11a8)]()*0x3c):_0x3f99ea,_0x12ce53=[];let _0x4272b9=_0x1e4a51;_0x259eb6[_0x2d0cc2(0x19fb)]((_0x34fecd,_0x215170)=>{const _0x5667d8=_0x2d0cc2,_0x5e2a9f=_0x215170===_0x259eb6[_0x5667d8(0x19ee)]-0x1;if(_0x5e2a9f)_0x12ce53[_0x5667d8(0x1cd6)](_0x4272b9);else{const _0x12e9b4=Math[_0x5667d8(0x2180)](_0x4272b9*0.6),_0x23861a=Math[_0x5667d8(0x2180)](_0x4272b9*0.1),_0x3f00c7=Math[_0x5667d8(0x2180)](Math[_0x5667d8(0x11a8)]()*(_0x12e9b4-_0x23861a+0x1))+_0x23861a;_0x12ce53['push'](_0x3f00c7),_0x4272b9-=_0x3f00c7;}}),_0x259eb6[_0x2d0cc2(0x19fb)]((_0x9ea2c2,_0x30fbcc)=>{const _0x5800ed=_0x2d0cc2,_0x457af2=_0x9ea2c2[_0x5800ed(0x2139)]('onclick');let _0x220a9a='';if(_0x457af2){const _0x4923ed=_0x457af2[_0x5800ed(0x1b87)](/'([^']+)'/);_0x4923ed&&_0x4923ed[0x1]&&(_0x220a9a=_0x4923ed[0x1]);}if(!_0x220a9a){const _0x46f8be=_0x9ea2c2[_0x5800ed(0xb30)](_0x5800ed(0x1391))?.['textContent']||'';_0x220a9a=_0x46f8be['replace'](/\s+/g,'_')[_0x5800ed(0x49e)]();}_0x5ccb72['options'][_0x220a9a]=_0x12ce53[_0x30fbcc],_0x5ccb72[_0x5800ed(0x1491)]+=_0x12ce53[_0x30fbcc];}),_0x3a9720[_0x2d0cc2(0x2009)]=_0x5ccb72,await db[_0x2d0cc2(0x14c4)][_0x2d0cc2(0x1561)](_0x3a9720),updatePollUI(_0x122135,_0x5ccb72);}async function generateSmartPollData(_0x2ff086,_0x1acc85){const _0x12e3a5=_0x211817;if(_0x1acc85[_0x12e3a5(0x2009)]&&_0x1acc85[_0x12e3a5(0x2009)]['totalVotes']>0x0){updatePollUI(_0x2ff086,_0x1acc85['pollData']);return;}const _0x13432c=document[_0x12e3a5(0xb30)](_0x12e3a5(0x1d50));if(!_0x13432c)return;const _0x34d8ed=_0x13432c[_0x12e3a5(0x1897)]('.poll-option');if(_0x34d8ed['length']===0x0)return;const _0x5a9814=await db[_0x12e3a5(0x2147)]['get'](parseInt(currentForumId)),_0xf50739=characters[_0x12e3a5(0x1e1f)](_0x2b5b3d=>_0x5a9814[_0x12e3a5(0x1bd6)]['includes'](_0x2b5b3d['id'])),_0xac818e={'totalVotes':0x0,'options':{}},_0xa5e99b=Math[_0x12e3a5(0x2180)](Math[_0x12e3a5(0x11a8)]()*0x32)+0x14,_0x4d05ca=_0x1acc85[_0x12e3a5(0x378)]['includes'](_0x12e3a5(0x1fd0))||_0x1acc85[_0x12e3a5(0x378)][_0x12e3a5(0x1831)]('人气')||_0x1acc85[_0x12e3a5(0x378)][_0x12e3a5(0x1831)]('最'),_0x427764=_0x4d05ca?_0xa5e99b+Math[_0x12e3a5(0x2180)](Math['random']()*0x50):_0xa5e99b,_0x19731f=[];let _0x5ceeb2=_0x427764;_0x34d8ed['forEach']((_0x416f20,_0x29e677)=>{const _0x1fca23=_0x12e3a5,_0x24d011=_0x416f20[_0x1fca23(0xb30)](_0x1fca23(0x1391))?.[_0x1fca23(0x13be)]||'';let _0x4b1912=0x1;_0x5a9814[_0x1fca23(0x9e9)]&&_0x5a9814[_0x1fca23(0x9e9)]['includes']('娱乐')&&(_0xf50739['some'](_0x35b01d=>_0x24d011[_0x1fca23(0x1831)](_0x35b01d[_0x1fca23(0x1a1c)]))&&(_0x4b1912=1.5));_0x5a9814[_0x1fca23(0x9e9)]&&_0x5a9814[_0x1fca23(0x9e9)][_0x1fca23(0x1831)]('校园')&&((_0x24d011[_0x1fca23(0x1831)]('食堂')||_0x24d011[_0x1fca23(0x1831)](_0x1fca23(0xa9b))||_0x24d011[_0x1fca23(0x1831)]('宿舍'))&&(_0x4b1912=1.3));const _0x5539bc=Math[_0x1fca23(0x2180)](_0x5ceeb2/(_0x34d8ed[_0x1fca23(0x19ee)]-_0x29e677)*_0x4b1912),_0x1617f5=Math[_0x1fca23(0x2180)](Math[_0x1fca23(0x11a8)]()*0xa)-0x5,_0x13ab56=Math['max'](0x0,Math[_0x1fca23(0x21ff)](_0x5ceeb2,_0x5539bc+_0x1617f5));_0x19731f[_0x1fca23(0x1cd6)](_0x13ab56),_0x5ceeb2-=_0x13ab56;});while(_0x5ceeb2>0x0){const _0x397060=Math['floor'](Math[_0x12e3a5(0x11a8)]()*_0x34d8ed[_0x12e3a5(0x19ee)]);_0x19731f[_0x397060]++,_0x5ceeb2--;}_0x34d8ed[_0x12e3a5(0x19fb)]((_0x11627b,_0x2f0a40)=>{const _0x197510=_0x12e3a5,_0x1bc08b=_0x11627b[_0x197510(0x2139)]('onclick');let _0x5eeae5='';if(_0x1bc08b){const _0x42b5cc=_0x1bc08b['match'](/'([^']+)'/);if(_0x42b5cc&&_0x42b5cc[0x1])_0x5eeae5=_0x42b5cc[0x1];else{const _0x477886=_0x11627b[_0x197510(0xb30)](_0x197510(0x1391))?.[_0x197510(0x13be)]||'';_0x5eeae5=_0x477886['replace'](/\s+/g,'_')[_0x197510(0x49e)]();}}_0xac818e['options'][_0x5eeae5]=_0x19731f[_0x2f0a40],_0xac818e[_0x197510(0x1491)]+=_0x19731f[_0x2f0a40];}),_0x1acc85[_0x12e3a5(0x2009)]=_0xac818e,await db[_0x12e3a5(0x14c4)][_0x12e3a5(0x1561)](_0x1acc85),updatePollUI(_0x2ff086,_0xac818e);}function cleanOldVoteRecords(_0x57c3b4=0x64){const _0x1e7974=_0x211817;try{const _0x16b7e5=Object[_0x1e7974(0x1c9f)](localStorage)[_0x1e7974(0x1e1f)](_0x342700=>_0x342700[_0x1e7974(0x1b30)](_0x1e7974(0x409)))[_0x1e7974(0x6a4)](_0x3c2e6a=>{const _0x448145=_0x1e7974,_0xe827dd=_0x3c2e6a[_0x448145(0xe16)](_0x448145(0x409),'');return{'key':_0x3c2e6a,'postId':parseInt(_0xe827dd),'timestamp':Date[_0x448145(0x2eb)]()};})[_0x1e7974(0x1104)]((_0x599195,_0x1b8456)=>_0x1b8456[_0x1e7974(0x9fc)]-_0x599195[_0x1e7974(0x9fc)]);if(_0x16b7e5[_0x1e7974(0x19ee)]>_0x57c3b4){const _0x4531d1=_0x16b7e5[_0x1e7974(0x6d5)](_0x57c3b4);_0x4531d1[_0x1e7974(0x19fb)](_0x27f237=>{const _0x1327ea=_0x1e7974;localStorage[_0x1327ea(0x3b2)](_0x27f237['key']);}),console[_0x1e7974(0x2187)](_0x1e7974(0x1993)+_0x4531d1[_0x1e7974(0x19ee)]+_0x1e7974(0x1385)+_0x57c3b4+'\x20条');}}catch(_0x2b6189){console['error'](_0x1e7974(0xc33),_0x2b6189);}}function saveVoteRecord(_0x5a4670,_0x146695,_0x139a5f,_0x2209a7){const _0x59bf79=_0x211817;try{localStorage[_0x59bf79(0x192)]('poll_voted_'+_0x5a4670,_0x146695);const _0x37ce1e={'postId':_0x5a4670,'postTitle':_0x2209a7||_0x59bf79(0x13ef),'optionId':_0x146695,'optionText':_0x139a5f||_0x59bf79(0x1fa5),'timestamp':Date[_0x59bf79(0x2eb)](),'date':new Date()['toLocaleString']()};localStorage[_0x59bf79(0x192)](_0x59bf79(0x545)+_0x5a4670,JSON[_0x59bf79(0x6b8)](_0x37ce1e)),cleanOldVoteRecords(0x64);}catch(_0x59515b){console[_0x59bf79(0x174a)]('保存投票记录失败:',_0x59515b),cleanOldVoteRecords(0x32);try{localStorage['setItem'](_0x59bf79(0x409)+_0x5a4670,_0x146695);}catch(_0x444180){console['error'](_0x59bf79(0x1df5),_0x444180);}}}function getUserVoteHistory(_0x2ee93d=0x14){const _0x7b951f=_0x211817;try{const _0x4ebfd5=Object[_0x7b951f(0x1c9f)](localStorage)[_0x7b951f(0x1e1f)](_0x3b2191=>_0x3b2191[_0x7b951f(0x1b30)](_0x7b951f(0x545)))[_0x7b951f(0x6a4)](_0x569a47=>{const _0x18be2d=_0x7b951f;try{return JSON[_0x18be2d(0x22d3)](localStorage[_0x18be2d(0x15d8)](_0x569a47));}catch{return null;}})[_0x7b951f(0x1e1f)](_0x1ae7a8=>_0x1ae7a8!==null)[_0x7b951f(0x1104)]((_0xeb633d,_0x1aa445)=>_0x1aa445[_0x7b951f(0x1716)]-_0xeb633d['timestamp'])[_0x7b951f(0x6d5)](0x0,_0x2ee93d);return _0x4ebfd5;}catch(_0x4b0940){return console['error'](_0x7b951f(0x647),_0x4b0940),[];}}function showVoteHistory(){const _0x3e8ac5=_0x211817,_0x388c5e=getUserVoteHistory(0x32);if(_0x388c5e[_0x3e8ac5(0x19ee)]===0x0){showToast('您还没有投票记录','info');return;}const _0x318a6e=_0x388c5e[_0x3e8ac5(0x6a4)](_0x6816de=>_0x3e8ac5(0x1e08)+_0x6816de[_0x3e8ac5(0x6ac)]+_0x3e8ac5(0x2274)+_0x6816de[_0x3e8ac5(0x1bf3)]+_0x3e8ac5(0x22c8)+_0x6816de[_0x3e8ac5(0x20d4)]+_0x3e8ac5(0x1f2b))[_0x3e8ac5(0x122b)](''),_0x30ad09=_0x3e8ac5(0x225a)+_0x318a6e+_0x3e8ac5(0xc67);document['body'][_0x3e8ac5(0x1b7)](_0x3e8ac5(0x42e),_0x30ad09);}async function showCreateForumScreen(){const _0x3e8bcb=_0x211817;hideApp('forum-screen');const _0x4de628=document[_0x3e8bcb(0x1262)](_0x3e8bcb(0xd3a)),_0x496b20=document[_0x3e8bcb(0x1262)](_0x3e8bcb(0x211b)),_0x4d4817=document[_0x3e8bcb(0x1262)]('forum-worldbook-selection');document['getElementById']('forum-form-id')[_0x3e8bcb(0x1ebc)]='',document[_0x3e8bcb(0x1262)]('forum-name-input')[_0x3e8bcb(0x1ebc)]='',document[_0x3e8bcb(0x1262)](_0x3e8bcb(0x1807))['value']='',document[_0x3e8bcb(0x1262)](_0x3e8bcb(0x1945))['textContent']=_0x3e8bcb(0xbc6),document[_0x3e8bcb(0x1262)]('forum-form-submit-btn')[_0x3e8bcb(0x13be)]=_0x3e8bcb(0x129b),_0x4de628[_0x3e8bcb(0x33a)]=characters[_0x3e8bcb(0x6a4)](_0x83057=>_0x3e8bcb(0x1623)+_0x83057['id']+_0x3e8bcb(0x1217)+(_0x83057[_0x3e8bcb(0x1994)]||createDefaultAvatar(_0x83057[_0x3e8bcb(0x1a1c)]))+_0x3e8bcb(0x222c)+_0x83057[_0x3e8bcb(0x1a1c)]+_0x3e8bcb(0x19b6)+_0x83057[_0x3e8bcb(0x1a1c)]+_0x3e8bcb(0x1f2b))[_0x3e8bcb(0x122b)](''),_0x496b20['innerHTML']=personas[_0x3e8bcb(0x6a4)](_0xccfb48=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22selection-item\x22\x20data-id=\x22'+_0xccfb48['id']+_0x3e8bcb(0x199)+(_0xccfb48['avatarUrl']||createDefaultAvatar(_0xccfb48[_0x3e8bcb(0x1a1c)]))+'\x22\x20alt=\x22'+_0xccfb48[_0x3e8bcb(0x1a1c)]+_0x3e8bcb(0x19b6)+_0xccfb48[_0x3e8bcb(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x3e8bcb(0x122b)]('');const _0x1af268=worldbooks[_0x3e8bcb(0x1e1f)](_0x3f6f43=>!_0x3f6f43[_0x3e8bcb(0xd92)]);_0x1af268[_0x3e8bcb(0x19ee)]>0x0?_0x4d4817['innerHTML']=_0x1af268['map'](_0x3b995d=>_0x3e8bcb(0x13ce)+_0x3b995d['id']+_0x3e8bcb(0x581)+(_0x3b995d[_0x3e8bcb(0x378)]||_0x3b995d['name'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x3e8bcb(0x122b)](''):_0x4d4817['innerHTML']='<p\x20style=\x22color:\x20#999;\x20font-size:\x2012px;\x20text-align:\x20center;\x22>暂无局部世界书</p>',showApp(_0x3e8bcb(0x183f));}function toggleSelection(_0x5742da,_0x283890=![]){const _0x2f72ea=_0x211817,_0x3d552d=_0x5742da['parentElement'];if(_0x283890){const _0x553c4e=_0x3d552d[_0x2f72ea(0xb30)](_0x2f72ea(0x132e));_0x553c4e&&_0x553c4e[_0x2f72ea(0x1c1b)][_0x2f72ea(0x1493)](_0x2f72ea(0x176b));}_0x5742da[_0x2f72ea(0x1c1b)][_0x2f72ea(0x1e3f)](_0x2f72ea(0x176b));}async function deleteForum(_0x3fc6c2,_0xe93f86){const _0xf01f2d=_0x211817;_0xe93f86['stopPropagation']();const _0xa4764b=await db[_0xf01f2d(0x2147)][_0xf01f2d(0xb78)](parseInt(_0x3fc6c2));if(!_0xa4764b){alert(_0xf01f2d(0x1a65));return;}if(confirm(_0xf01f2d(0x929)+_0xa4764b[_0xf01f2d(0x1a1c)]+_0xf01f2d(0x1c16)))try{const _0x510d25=await db[_0xf01f2d(0x14c4)][_0xf01f2d(0xa24)](_0xf01f2d(0x1cdc))[_0xf01f2d(0x1694)](parseInt(_0x3fc6c2))[_0xf01f2d(0xf13)](),_0x2cce10=_0x510d25[_0xf01f2d(0x6a4)](_0x170827=>_0x170827['id']);await db['forums'][_0xf01f2d(0x1f4a)](parseInt(_0x3fc6c2)),await db[_0xf01f2d(0x14c4)]['where'](_0xf01f2d(0x1cdc))[_0xf01f2d(0x1694)](parseInt(_0x3fc6c2))[_0xf01f2d(0x1f4a)](),await db[_0xf01f2d(0x481)][_0xf01f2d(0xa24)](_0xf01f2d(0x1cdc))['equals'](parseInt(_0x3fc6c2))[_0xf01f2d(0x1f4a)]();if(_0x2cce10[_0xf01f2d(0x19ee)]>0x0){const _0x31e5d3=[];for(const _0x2f5d44 of _0x2cce10){const _0x245a53=await db[_0xf01f2d(0x789)][_0xf01f2d(0xa24)]('postId')[_0xf01f2d(0x1694)](_0x2f5d44)[_0xf01f2d(0xf13)]();_0x31e5d3['push'](..._0x245a53);}const _0x2b8c8c=_0x31e5d3[_0xf01f2d(0x6a4)](_0x2b633e=>_0x2b633e['id']);await Promise['all']([..._0x2cce10[_0xf01f2d(0x6a4)](_0x3390c3=>db['forumReplies'][_0xf01f2d(0xa24)](_0xf01f2d(0x9fc))['equals'](_0x3390c3)[_0xf01f2d(0x1f4a)]()),..._0x2cce10[_0xf01f2d(0x6a4)](_0x172589=>db[_0xf01f2d(0x1867)][_0xf01f2d(0xa24)](_0xf01f2d(0x9fc))[_0xf01f2d(0x1694)](_0x172589)['delete']())]);for(const _0xa4eb5d of _0x2cce10){await db['forumFavorites'][_0xf01f2d(0xa24)](_0xf01f2d(0x9fc))[_0xf01f2d(0x1694)](_0xa4eb5d)[_0xf01f2d(0x1f4a)]();}_0x2b8c8c[_0xf01f2d(0x19ee)]>0x0&&await Promise[_0xf01f2d(0x1a47)](_0x2b8c8c[_0xf01f2d(0x6a4)](_0x121b28=>db['replyLikes'][_0xf01f2d(0xa24)](_0xf01f2d(0x1452))[_0xf01f2d(0x1694)](_0x121b28)['delete']()));}showToast(_0xf01f2d(0x3b8)+_0xa4764b[_0xf01f2d(0x1a1c)]+_0xf01f2d(0x1d01),'success'),await renderForumArchives();}catch(_0xe68ac2){console['error'](_0xf01f2d(0x18d9),_0xe68ac2),showToast('删除失败:\x20'+_0xe68ac2['message'],_0xf01f2d(0x174a));}}async function showEditForumScreen(_0x2fa2ca,_0x5e3b94){const _0x47bbfe=_0x211817;_0x5e3b94[_0x47bbfe(0x902)](),hideApp(_0x47bbfe(0x149f));const _0x2e7b35=await db['forums'][_0x47bbfe(0xb78)](parseInt(_0x2fa2ca));if(!_0x2e7b35){alert(_0x47bbfe(0x27b));return;}await showCreateForumScreen(),document[_0x47bbfe(0x1262)]('forum-form-id')[_0x47bbfe(0x1ebc)]=_0x2e7b35['id'],document[_0x47bbfe(0x1262)](_0x47bbfe(0x1656))[_0x47bbfe(0x1ebc)]=_0x2e7b35[_0x47bbfe(0x1a1c)],document['getElementById'](_0x47bbfe(0x1807))[_0x47bbfe(0x1ebc)]=_0x2e7b35[_0x47bbfe(0x9e9)],document['getElementById'](_0x47bbfe(0x1945))[_0x47bbfe(0x13be)]=_0x47bbfe(0x603),document[_0x47bbfe(0x1262)](_0x47bbfe(0x1c9e))[_0x47bbfe(0x13be)]=_0x47bbfe(0x6dd),_0x2e7b35[_0x47bbfe(0x1bd6)][_0x47bbfe(0x19fb)](_0x26f4d3=>{const _0x4d2c55=_0x47bbfe,_0x223896=document[_0x4d2c55(0xb30)](_0x4d2c55(0x1545)+_0x26f4d3+'\x27]');if(_0x223896)_0x223896[_0x4d2c55(0x1c1b)][_0x4d2c55(0x21e2)](_0x4d2c55(0x176b));});const _0x1fc239=document[_0x47bbfe(0xb30)](_0x47bbfe(0xbcb)+_0x2e7b35[_0x47bbfe(0x131c)]+'\x27]');if(_0x1fc239)_0x1fc239[_0x47bbfe(0x1c1b)][_0x47bbfe(0x21e2)]('selected');(_0x2e7b35[_0x47bbfe(0x156a)]||[])['forEach'](_0x581f3a=>{const _0x505187=_0x47bbfe,_0x47b37f=document['querySelector'](_0x505187(0x274)+_0x581f3a+'\x27]');if(_0x47b37f)_0x47b37f['classList']['add'](_0x505187(0x176b));});}async function handleForumFormSubmit(){const _0x42fc29=_0x211817,_0x3514d4=document['getElementById'](_0x42fc29(0x22c7))['value'],_0x5bd1b0=document['getElementById']('forum-name-input')[_0x42fc29(0x1ebc)][_0x42fc29(0x19d7)](),_0x392ed0=document['getElementById']('forum-worldview-input')[_0x42fc29(0x1ebc)]['trim'](),_0x298b4f=document[_0x42fc29(0x1897)](_0x42fc29(0xe74)),_0x2e576a=document[_0x42fc29(0xb30)](_0x42fc29(0xcf5)),_0x52ade9=document[_0x42fc29(0x1897)]('#forum-worldbook-selection\x20.selected');if(!_0x5bd1b0)return alert(_0x42fc29(0x753));if(_0x298b4f['length']===0x0)return alert('请至少选择一个角色');if(!_0x2e576a)return alert(_0x42fc29(0x21ca));const _0x241043=Array[_0x42fc29(0x13c0)](_0x298b4f)[_0x42fc29(0x6a4)](_0x312547=>_0x312547[_0x42fc29(0x1ecd)]['id']),_0x13e143=_0x2e576a['dataset']['id'],_0x49df83=Array[_0x42fc29(0x13c0)](_0x52ade9)['map'](_0x3ff890=>_0x3ff890[_0x42fc29(0x1ecd)]['id']),_0x502591={'name':_0x5bd1b0,'characterIds':_0x241043,'personaId':_0x13e143,'worldview':_0x392ed0,'mountedWorldbookIds':_0x49df83,'createdAt':_0x3514d4?undefined:Date[_0x42fc29(0x2eb)]()};try{if(_0x3514d4)await db[_0x42fc29(0x2147)]['update'](parseInt(_0x3514d4),{'name':_0x5bd1b0,'characterIds':_0x241043,'worldview':_0x392ed0,'mountedWorldbookIds':_0x49df83}),showToast('论坛\x20\x22'+_0x5bd1b0+_0x42fc29(0x11d4),_0x42fc29(0x11cb)),hideApp(_0x42fc29(0x183f)),await renderForumArchives(),showApp(_0x42fc29(0x149f));else{const _0x1cd1a1=await db[_0x42fc29(0x2147)]['add'](_0x502591);showToast(_0x42fc29(0x3b8)+_0x5bd1b0+_0x42fc29(0x4b6),'success'),hideApp(_0x42fc29(0x183f)),await loadAndDisplayForum(_0x1cd1a1,!![]);}}catch(_0x3be999){console[_0x42fc29(0x174a)](_0x42fc29(0x15bb),_0x3be999),alert(_0x42fc29(0x2170));}}async function renderForumArchives(){const _0x54847b=_0x211817,_0x5df3a6=await db[_0x54847b(0x2147)][_0x54847b(0xf13)](),_0x29b11a=document[_0x54847b(0x1262)]('forum-archive-list');if(_0x5df3a6['length']===0x0){_0x29b11a[_0x54847b(0x33a)]=_0x54847b(0x2101);return;}_0x29b11a[_0x54847b(0x33a)]=_0x5df3a6[_0x54847b(0x1104)]((_0x554f84,_0x1a23ff)=>_0x1a23ff[_0x54847b(0x1e99)]-_0x554f84[_0x54847b(0x1e99)])[_0x54847b(0x6a4)](_0x513750=>_0x54847b(0x7c6)+_0x513750['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-title\x22>'+_0x513750[_0x54847b(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22forum-archive-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22forum-delete-btn\x22\x20onclick=\x22deleteForum(\x27'+_0x513750['id']+_0x54847b(0x1946)+_0x513750['id']+_0x54847b(0x840)+_0x513750[_0x54847b(0x1bd6)][_0x54847b(0x19ee)]+_0x54847b(0x84d)+new Date(_0x513750['createdAt'])[_0x54847b(0xbf7)]()+_0x54847b(0x19fe))[_0x54847b(0x122b)]('');}async function loadAndDisplayForum(_0x459f71,_0x436f38=![]){const _0x315d65=_0x211817;currentForumId=_0x459f71;const _0x2ddbfd=await db[_0x315d65(0x2147)][_0x315d65(0xb78)](parseInt(_0x459f71));if(!_0x2ddbfd){alert(_0x315d65(0x17ab));return;}document[_0x315d65(0x1262)]('forum-view-title')[_0x315d65(0x863)]=_0x2ddbfd[_0x315d65(0x1a1c)],hideApp(_0x315d65(0x149f)),showApp(_0x315d65(0x14aa)),_0x436f38&&await generateForumPosts(_0x459f71),await renderForumPosts(_0x459f71);}async function backToForumArchives(){const _0x23075b=_0x211817;await renderForumArchives(),showApp(_0x23075b(0x149f)),hideApp(_0x23075b(0x14aa));}async function generateForumPosts(_0x8463f){const _0x2310d2=_0x211817,_0x4bf3a4=await db['forums'][_0x2310d2(0xb78)](parseInt(_0x8463f));if(!_0x4bf3a4)return;const _0x2ad7a7=characters[_0x2310d2(0x1e1f)](_0xef58cf=>_0x4bf3a4['characterIds']['includes'](_0xef58cf['id'])),_0x70f2aa=personas[_0x2310d2(0xaf4)](_0x5dd6cd=>_0x5dd6cd['id']===_0x4bf3a4[_0x2310d2(0x131c)]),_0xa9f4e=0x1f40;let _0x3d9217=0x0,_0x4d76eb='';const _0x276797=(_0xe04b1b,_0x38de2c)=>{const _0x9bc649=_0x2310d2;if(!_0x38de2c||_0x38de2c['trim']()===''||_0x3d9217>=_0xa9f4e)return;const _0x1677ff=_0x9bc649(0x375)+_0xe04b1b+':\x0a'+_0x38de2c+'\x0a';if(_0x3d9217+_0x1677ff['length']<_0xa9f4e)_0x4d76eb+=_0x1677ff,_0x3d9217+=_0x1677ff[_0x9bc649(0x19ee)];else{const _0x2cb8f3=_0xa9f4e-_0x3d9217-_0xe04b1b[_0x9bc649(0x19ee)]-0x14;_0x2cb8f3>0x64&&(_0x4d76eb+=_0x9bc649(0x375)+_0xe04b1b+':\x0a'+_0x38de2c[_0x9bc649(0x17ca)](0x0,_0x2cb8f3)+_0x9bc649(0xafc)),_0x3d9217=_0xa9f4e;}},_0x3ecae5=new Date(),_0x55be2b=_0x3ecae5['getHours'](),_0x250b35=_0x3ecae5['getDay'](),_0x449821=_0x250b35===0x0||_0x250b35===0x6;let _0x26c2df,_0x2b6797;if(_0x55be2b>=0x5&&_0x55be2b<0x9)_0x26c2df='清晨',_0x2b6797=_0x2310d2(0x205a);else{if(_0x55be2b>=0x9&&_0x55be2b<0xc)_0x26c2df='上午',_0x2b6797=_0x449821?'周末上午，大家比较悠闲，可能在讨论娱乐活动、购物计划等':_0x2310d2(0x2e3);else{if(_0x55be2b>=0xc&&_0x55be2b<0xe)_0x26c2df='午休',_0x2b6797=_0x2310d2(0x2155);else{if(_0x55be2b>=0xe&&_0x55be2b<0x12)_0x26c2df='下午',_0x2b6797=_0x449821?_0x2310d2(0x1a77):_0x2310d2(0x138d);else{if(_0x55be2b>=0x12&&_0x55be2b<0x16)_0x26c2df='晚上',_0x2b6797=_0x2310d2(0x1c57);else _0x55be2b>=0x16&&_0x55be2b<0x18?(_0x26c2df='深夜',_0x2b6797='夜深人静，适合更私人、深度的话题，情感分享、人生感悟等'):(_0x26c2df='凌晨',_0x2b6797='夜猫子时间，可能有失眠的人在聊天、分享深夜想法、或者早起的人开始新的一天');}}}}const _0x41789a=_0x2310d2(0xff1)+_0x26c2df+'（'+_0x3ecae5['toLocaleTimeString'](_0x2310d2(0x156c),{'hour':'2-digit','minute':_0x2310d2(0xc79)})+'），'+(_0x449821?'周末':_0x2310d2(0xc8d))+'。'+_0x2b6797;_0x276797(_0x2310d2(0xab5),_0x41789a);let _0xcc9cbe='';worldEvent&&worldEvent[_0x2310d2(0x200f)]>Date['now']()&&(_0xcc9cbe=_0x2310d2(0x114d)+worldEvent['content']);_0x276797(_0x2310d2(0x4eb),_0xcc9cbe);let _0x17151c='';const _0x1921e0=_0x2ad7a7[_0x2310d2(0x1104)](()=>0.5-Math[_0x2310d2(0x11a8)]())[_0x2310d2(0x6d5)](0x0,0x3);for(const _0x36bd3c of _0x1921e0){const _0x4a2478=await db[_0x2310d2(0x127e)]['where'](_0x2310d2(0xaf5))[_0x2310d2(0x1694)](_0x36bd3c['id'])['limit'](0x2)[_0x2310d2(0xf13)](),_0x51e433=await db[_0x2310d2(0x156f)][_0x2310d2(0xa24)](_0x2310d2(0xaf5))[_0x2310d2(0x1694)](_0x36bd3c['id'])['reverse']()[_0x2310d2(0x163e)](0x3)[_0x2310d2(0xf13)]();(_0x4a2478[_0x2310d2(0x19ee)]>0x0||_0x51e433[_0x2310d2(0x19ee)]>0x0)&&(_0x17151c+=_0x2310d2(0x1ed0)+_0x36bd3c['name']+_0x2310d2(0xcb9),_0x4a2478[_0x2310d2(0x19fb)](_0x267342=>{const _0x2b69fb=_0x2310d2;_0x17151c+=_0x2b69fb(0x452)+_0x267342[_0x2b69fb(0x13e5)]+'\x0a';}),_0x51e433[_0x2310d2(0x19fb)](_0x171be2=>{const _0xefaa2a=_0x2310d2;_0x17151c+=_0xefaa2a(0x616)+_0x171be2[_0xefaa2a(0x13e5)]+'\x0a';}));}_0x276797(_0x2310d2(0x867),_0x17151c);const _0x36b07c=await db['worldbooks'][_0x2310d2(0xf13)]();let _0xd0663d='';const _0x2c0989=_0x36b07c[_0x2310d2(0x1e1f)](_0x446c0b=>_0x446c0b[_0x2310d2(0xd92)]&&(window[_0x2310d2(0x1a4e)]||[])[_0x2310d2(0x1831)](_0x446c0b['id'])),_0x168cb2=_0x36b07c[_0x2310d2(0x1e1f)](_0xf319b5=>(_0x4bf3a4[_0x2310d2(0x156a)]||[])['includes'](_0xf319b5['id'])),_0x58a5fe=[...new Set([..._0x2c0989,..._0x168cb2])];_0x58a5fe[_0x2310d2(0x19ee)]>0x0&&(_0xd0663d=_0x58a5fe[_0x2310d2(0x6a4)](_0x5496a9=>_0x2310d2(0x22b9)+_0x5496a9['title']+'\x0a'+_0x5496a9[_0x2310d2(0x211c)])[_0x2310d2(0x122b)]('\x0a\x0a'),_0x276797(_0x2310d2(0x306),_0xd0663d));let _0x1d6684='\x0a#\x20角色：论坛内容生成AI\x0a你的任务是为一个名为\x20\x22'+_0x4bf3a4[_0x2310d2(0x1a1c)]+'\x22\x20的虚拟论坛生成10个新的帖子。\x0a\x0a##\x20论坛背景设定:\x0a**核心世界观**:\x20'+(_0x4bf3a4['worldview']||_0x2310d2(0x1fce))+'\x0a'+_0x4d76eb+'\x0a\x0a##\x20论坛成员:\x0a'+_0x2ad7a7[_0x2310d2(0x6a4)](_0xde2b79=>'-\x20'+_0xde2b79[_0x2310d2(0x1a1c)]+'\x20(人设:\x20'+_0xde2b79[_0x2310d2(0x1f0b)]+')')['join']('\x0a')+_0x2310d2(0x300)+_0x70f2aa['name']+_0x2310d2(0x1cc4)+_0x70f2aa[_0x2310d2(0x7c9)]+')\x0a\x0a##\x20帖子生成指令:\x0a请严格遵循以下要求，生成**完整的10个帖子**的JSON对象。\x0a**【重要】**:\x20必须生成完整的10个帖子，不能少于10个。\x0a\x0a###\x20【新增功能】投票帖子\x20(单选/多选):\x0a-\x20你可以选择性地将1-2个帖子创建为\x20**单选**\x20或\x20**多选**\x20投票帖。\x0a-\x20**【极其重要】**:\x20当帖子的\x20\x22content\x22\x20字段包含HTML时，该HTML代码\x20**必须满足以下两个条件**:\x0a\x20\x20\x20\x201.\x20\x20**必须是单行文本**，绝对不能包含任何换行符\x20(\x5cn)。\x0a\x20\x20\x20\x202.\x20\x20HTML代码中的所有\x20**双引号\x20(\x22)**\x20都\x20**必须用反斜杠转义成\x20(\x5c\x22)**。\x0a\x0a-\x20**单选投票\x20(正确格式示例)**:\x0a\x20\x20```json\x0a\x20\x20\x22content\x22:\x20\x22<div\x20class=\x5c\x22forum-poll\x5c\x22\x20data-poll-type=\x5c\x22single\x5c\x22><h4>【投票】单选标题</h4><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_1\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项一</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_2\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项二</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div></div>\x22\x0a\x20\x20```\x0a-\x20**多选投票\x20(正确格式示例)**:\x0a\x20\x20```json\x0a\x20\x20\x22content\x22:\x20\x22<div\x20class=\x5c\x22forum-poll\x5c\x22\x20data-poll-type=\x5c\x22multiple\x5c\x22><h4>【投票】多选标题</h4><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_A\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项A</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><div\x20class=\x5c\x22poll-option\x5c\x22\x20onclick=\x5c\x22handlePollVote(this,\x20\x27option_B\x27)\x5c\x22><span\x20class=\x5c\x22option-text\x5c\x22>选项B</span><span\x20class=\x5c\x22vote-count\x5c\x22>0票</span></div><button\x20class=\x5c\x22vote-submit-btn\x5c\x22\x20onclick=\x5c\x22submitMultipleChoiceVote(this)\x5c\x22>投票</button></div>\x22\x0a\x20\x20```\x0a-\x20投票的标题和选项内容必须与论坛的世界观和角色相关。\x0a-\x20每个投票选项的onclick中的option_id必须是唯一的（如option_1,\x20option_2等）。\x0a-\x20多选投票必须包含投票按钮，单选投票不需要。\x0a\x0a###\x20【重要】发帖人分配规则:\x0a-\x20**8-9个帖子**:\x20必须由普通NPC路人发布，使用符合世界观的普通网名（如\x22学霸小王\x22、\x22夜猫子\x22、\x22篮球少年\x22等）\x0a-\x20**最多1-2个帖子**:\x20可以由论坛成员角色发布，格式为\x22网名(真实姓名)\x22\x0a-\x20**【严格禁止】**:\x20绝对不得冒充用户\x20'+_0x70f2aa[_0x2310d2(0x1a1c)]+_0x2310d2(0x8f8)+_0x26c2df+_0x2310d2(0x217f);console[_0x2310d2(0x2187)](_0x2310d2(0x36a)),console[_0x2310d2(0x2187)]('='[_0x2310d2(0xcc7)](0x50)),console['log'](_0x1d6684),console[_0x2310d2(0x2187)]('='[_0x2310d2(0xcc7)](0x50)),showToast(_0x2310d2(0x8b7),_0x2310d2(0x477));try{console[_0x2310d2(0x2187)]('🔥\x20[论坛帖子生成]\x20Prompt长度:',_0x1d6684[_0x2310d2(0x19ee)],'字符');const _0x96aabf=await callForumAPI(_0x1d6684);console[_0x2310d2(0x2187)](_0x2310d2(0x1b00),_0x96aabf[_0x2310d2(0x19ee)],'字符'),console[_0x2310d2(0x2187)]('🔥\x20[论坛帖子生成]\x20AI原始响应:',_0x96aabf);let _0x286e8d;try{_0x286e8d=JSON[_0x2310d2(0x22d3)](_0x96aabf);}catch(_0x1d10e7){console[_0x2310d2(0x2187)](_0x2310d2(0xae5));const _0x27b4ff=_0x96aabf[_0x2310d2(0x1b87)](/```json\s*([\s\S]*?)\s*```/);if(_0x27b4ff&&_0x27b4ff[0x1]){console[_0x2310d2(0x2187)](_0x2310d2(0x1532));try{_0x286e8d=JSON[_0x2310d2(0x22d3)](_0x27b4ff[0x1]),console[_0x2310d2(0x2187)](_0x2310d2(0xb83),_0x286e8d[_0x2310d2(0x19ee)],_0x2310d2(0x1db3));}catch(_0x3e641a){console[_0x2310d2(0x174a)]('🔥\x20[论坛帖子生成]\x20JSON代码块解析失败:',_0x3e641a);throw new Error('AI返回的JSON代码块格式错误。');}}else{console[_0x2310d2(0x2187)](_0x2310d2(0x202));const _0x583a82=_0x96aabf[_0x2310d2(0x1b87)](/```json\s*([\s\S]*)/);if(_0x583a82&&_0x583a82[0x1]){let _0x229a7e=_0x583a82[0x1][_0x2310d2(0x19d7)]();console[_0x2310d2(0x2187)](_0x2310d2(0x219b),_0x229a7e[_0x2310d2(0x19ee)]);if(!_0x229a7e['endsWith'](']')&&!_0x229a7e[_0x2310d2(0x81f)]('}]')){console['log'](_0x2310d2(0x1c8f));const _0x55fd4c=_0x229a7e[_0x2310d2(0x1e78)]('},');_0x55fd4c>0x0&&(_0x229a7e=_0x229a7e[_0x2310d2(0x17ca)](0x0,_0x55fd4c+0x1)+'\x0a]',console[_0x2310d2(0x2187)](_0x2310d2(0x673)));}try{_0x286e8d=JSON[_0x2310d2(0x22d3)](_0x229a7e),console[_0x2310d2(0x2187)](_0x2310d2(0x5e3),_0x286e8d['length'],_0x2310d2(0x1db3));}catch(_0x3a9bf5){console[_0x2310d2(0x174a)](_0x2310d2(0x9fa),_0x3a9bf5);throw new Error(_0x2310d2(0x1ba));}}else{console['error']('🔥\x20[论坛帖子生成]\x20无法解析的响应:',_0x96aabf[_0x2310d2(0x17ca)](0x0,0x1f4)+_0x2310d2(0x1520));throw new Error(_0x2310d2(0x8cd));}}}if(!Array[_0x2310d2(0x1496)](_0x286e8d))throw new Error(_0x2310d2(0xaaa));for(const _0x4cc7d1 of _0x286e8d){const _0x322a98=_0x4cc7d1['authorName']||_0x4cc7d1[_0x2310d2(0x18cc)]||_0x4cc7d1[_0x2310d2(0x989)];if(_0x4cc7d1&&typeof _0x322a98===_0x2310d2(0x11b7)&&_0x4cc7d1['title']&&_0x4cc7d1[_0x2310d2(0x211c)]){let _0x38a33f=null,_0x3cb3f1=null;const _0x50093d=_0x322a98[_0x2310d2(0x1b87)](/^(.+)\((.+)\)$/);if(_0x50093d){const _0x1855f7=_0x50093d[0x2];_0x38a33f=characters[_0x2310d2(0xaf4)](_0x18cf84=>_0x18cf84['name']===_0x1855f7)||personas[_0x2310d2(0xaf4)](_0x20235b=>_0x20235b[_0x2310d2(0x1a1c)]===_0x1855f7);if(_0x38a33f)_0x3cb3f1=_0x38a33f[_0x2310d2(0x1994)];}if(!_0x38a33f)_0x3cb3f1=createDefaultAvatar(_0x322a98);await db['forumPosts'][_0x2310d2(0x21e2)]({'forumId':parseInt(_0x8463f),'title':_0x4cc7d1['title'],'content':_0x4cc7d1['content'],'authorId':_0x38a33f?_0x38a33f['id']:null,'authorName':_0x322a98,'authorAvatar':_0x3cb3f1,'timestamp':Date['now']()-Math[_0x2310d2(0x2180)](Math[_0x2310d2(0x11a8)]()*0x2710),'replies':0x0,'likes':0x0});}else console[_0x2310d2(0x1f43)](_0x2310d2(0x133d),_0x4cc7d1);}}catch(_0x4e9c37){console[_0x2310d2(0x174a)](_0x2310d2(0x1e03),_0x4e9c37),alert('AI生成帖子失败，请检查API设置或刷新重试。\x0a错误详情:\x20'+_0x4e9c37[_0x2310d2(0x1e8e)]);}}async function renderForumPosts(_0x433738){const _0x44d551=_0x211817,_0xf1ecb7=await db[_0x44d551(0x14c4)][_0x44d551(0xa24)]('forumId')[_0x44d551(0x1694)](parseInt(_0x433738))[_0x44d551(0xf13)](),_0x127a53=document[_0x44d551(0x1262)](_0x44d551(0x10af));if(_0xf1ecb7['length']===0x0){_0x127a53[_0x44d551(0x33a)]='<div\x20class=\x22forum-empty-state\x22><p>这个论坛还没有帖子</p></div>';return;}const _0x3d768b=Date['now']();for(const _0x4246ad of _0xf1ecb7){const _0xe88eb3=await db['forumReplies']['where'](_0x44d551(0x9fc))[_0x44d551(0x1694)](_0x4246ad['id'])[_0x44d551(0xc44)](),_0x1e204d=(_0x3d768b-_0x4246ad[_0x44d551(0x1716)])/(0x3e8*0x3c*0x3c),_0x4b029d=Math[_0x44d551(0x658)](0.1,0x1/(0x1+_0x1e204d/0x18)),_0x17dd5d=await db[_0x44d551(0x789)][_0x44d551(0xa24)](_0x44d551(0x9fc))[_0x44d551(0x1694)](_0x4246ad['id'])['and'](_0x1c40bc=>_0x1c40bc[_0x44d551(0x1716)]>_0x3d768b-0x18*0x3c*0x3c*0x3e8)[_0x44d551(0xc44)](),_0x22fe07=_0xe88eb3*0x2+(_0x4246ad[_0x44d551(0x97d)]||0x0),_0x17248e=_0x17dd5d*0x5;_0x4246ad[_0x44d551(0x1197)]=(_0x22fe07+_0x17248e)*_0x4b029d,console[_0x44d551(0x2187)]('帖子\x22'+_0x4246ad[_0x44d551(0x378)]+'\x22:\x20回复'+_0xe88eb3+',\x20近期回复'+_0x17dd5d+',\x20年龄'+_0x1e204d[_0x44d551(0x13ad)](0x1)+_0x44d551(0x2013)+_0x4246ad['hotness'][_0x44d551(0x13ad)](0x2));}_0xf1ecb7[_0x44d551(0x1104)]((_0x5de916,_0xcec6b4)=>_0xcec6b4[_0x44d551(0x1197)]-_0x5de916['hotness']);const _0x32db53=Math[_0x44d551(0x21ff)](0x3,_0xf1ecb7[_0x44d551(0x19ee)]),_0x371a7d=_0xf1ecb7[_0x44d551(0x6d5)](0x0,_0x32db53),_0x49db13=_0xf1ecb7[_0x44d551(0x6d5)](_0x32db53)[_0x44d551(0x1104)]((_0x490672,_0x2c6f93)=>_0x2c6f93[_0x44d551(0x1716)]-_0x490672[_0x44d551(0x1716)]);let _0x4136ce='';_0x371a7d[_0x44d551(0x19ee)]>0x0&&(_0x4136ce+=_0x44d551(0x1509),_0x4136ce+=await Promise[_0x44d551(0x1a47)](_0x371a7d[_0x44d551(0x6a4)](async _0x36a066=>{const _0x1eabcc=_0x44d551,_0x4ab5ec=await db['forumPostImages'][_0x1eabcc(0xa24)](_0x1eabcc(0x9fc))[_0x1eabcc(0x1694)](_0x36a066['id'])[_0x1eabcc(0xc44)]()>0x0;return _0x1eabcc(0x1e90)+_0x36a066['id']+')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x36a066[_0x1eabcc(0x378)]+_0x1eabcc(0xbe0)+(_0x4ab5ec?_0x1eabcc(0x7fa):'')+_0x1eabcc(0x214e)+(_0x36a066[_0x1eabcc(0x680)]?_0x1eabcc(0x3d3):'')+_0x1eabcc(0x2311)+_0x36a066[_0x1eabcc(0xa42)]+_0x1eabcc(0x1212)+formatTime(_0x36a066[_0x1eabcc(0x1716)])+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}))['then'](_0x29894d=>_0x29894d[_0x44d551(0x122b)](''))),_0x49db13[_0x44d551(0x19ee)]>0x0&&(_0x4136ce+='<div\x20class=\x22forum-section-header\x22>最新帖子</div>',_0x4136ce+=await Promise['all'](_0x49db13[_0x44d551(0x6a4)](async _0x2a281c=>{const _0x5189a9=_0x44d551,_0x286412=await db[_0x5189a9(0x1867)][_0x5189a9(0xa24)]('postId')[_0x5189a9(0x1694)](_0x2a281c['id'])[_0x5189a9(0xc44)]()>0x0;return _0x5189a9(0x12b5)+_0x2a281c['id']+_0x5189a9(0x1e9b)+_0x2a281c[_0x5189a9(0x378)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x286412?_0x5189a9(0x7fa):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x2a281c[_0x5189a9(0x680)]?'<span\x20class=\x22user-post-badge\x22>我</span>':'')+_0x5189a9(0x2311)+_0x2a281c[_0x5189a9(0xa42)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+formatTime(_0x2a281c[_0x5189a9(0x1716)])+_0x5189a9(0x177e);}))['then'](_0x3d6272=>_0x3d6272['join'](''))),_0x127a53['innerHTML']=_0x4136ce;}async function refreshPosts(){const _0x1ed6fb=_0x211817;if(!currentForumId)return;const _0x119597=document[_0x1ed6fb(0x1262)](_0x1ed6fb(0x1697)),_0x5b9c21=_0x119597[_0x1ed6fb(0x13be)];_0x119597['innerHTML']=_0x5b9c21+_0x1ed6fb(0x21e1),showToast(_0x1ed6fb(0x17f7),'info');try{await generateForumPosts(currentForumId);const _0x3274d8=await db['forumPosts'][_0x1ed6fb(0xa24)](_0x1ed6fb(0x1cdc))[_0x1ed6fb(0x1694)](parseInt(currentForumId))[_0x1ed6fb(0xf13)](),_0x25974a=new Set(_0x3274d8[_0x1ed6fb(0x6a4)](_0x92322d=>_0x92322d['id'])),_0x3c8c41=await db[_0x1ed6fb(0x145c)][_0x1ed6fb(0xa24)]({'userId':_0x1ed6fb(0xa80)})[_0x1ed6fb(0xf13)](),_0x13372b=new Set(_0x3c8c41[_0x1ed6fb(0x6a4)](_0x309c3e=>_0x309c3e[_0x1ed6fb(0x9fc)])),_0xd32b0f=_0x3274d8['filter'](_0x3bc93f=>_0x3bc93f[_0x1ed6fb(0x680)]===!![]),_0x142645=new Set(_0xd32b0f[_0x1ed6fb(0x6a4)](_0x3831ec=>_0x3831ec['id'])),_0x2af311=new Set();_0x3274d8[_0x1ed6fb(0x1104)]((_0x25a895,_0x249dfc)=>_0x249dfc[_0x1ed6fb(0x1716)]-_0x25a895[_0x1ed6fb(0x1716)])[_0x1ed6fb(0x6d5)](0x0,0x1e)[_0x1ed6fb(0x19fb)](_0x3ef741=>_0x2af311['add'](_0x3ef741['id'])),_0x13372b[_0x1ed6fb(0x19fb)](_0x3aeecd=>_0x2af311[_0x1ed6fb(0x21e2)](_0x3aeecd)),_0x142645['forEach'](_0x40b342=>_0x2af311['add'](_0x40b342));const _0x347dd1=[];_0x25974a[_0x1ed6fb(0x19fb)](_0x2d6e5d=>{const _0x212806=_0x1ed6fb;!_0x2af311[_0x212806(0x975)](_0x2d6e5d)&&_0x347dd1[_0x212806(0x1cd6)](_0x2d6e5d);}),_0x347dd1[_0x1ed6fb(0x19ee)]>0x0&&(console[_0x1ed6fb(0x2187)](_0x1ed6fb(0x189a)+_0x347dd1[_0x1ed6fb(0x19ee)]+_0x1ed6fb(0xc11)),await db['forumPosts'][_0x1ed6fb(0x1aaa)](_0x347dd1),await db[_0x1ed6fb(0x789)][_0x1ed6fb(0xa24)](_0x1ed6fb(0x9fc))[_0x1ed6fb(0x1fa1)](_0x347dd1)[_0x1ed6fb(0x1f4a)](),console[_0x1ed6fb(0x2187)](_0x1ed6fb(0x11bd))),await renderForumPosts(currentForumId),showToast(_0x1ed6fb(0xfc4),_0x1ed6fb(0x11cb));}catch(_0x33475c){console[_0x1ed6fb(0x174a)](_0x1ed6fb(0xb55),_0x33475c),showToast(_0x1ed6fb(0x20bf)+_0x33475c[_0x1ed6fb(0x1e8e)],_0x1ed6fb(0x174a)),await renderForumPosts(currentForumId);}finally{_0x119597['innerHTML']=_0x5b9c21;}}function backToForum(){const _0x237d48=_0x211817,_0x4c4185=window[_0x237d48(0x2070)]||_0x237d48(0x7d8);_0x4c4185===_0x237d48(0x1a70)?showApp(_0x237d48(0xcf2)):currentForumId?loadAndDisplayForum(currentForumId):showApp('forum-screen'),hideApp(_0x237d48(0xdf5));}async function showPostView(_0x56fb3a,_0x49e903=_0x211817(0x7d8)){const _0xf00e07=_0x211817,_0x28ad88=await db[_0xf00e07(0x14c4)][_0xf00e07(0xb78)](_0x56fb3a);if(!_0x28ad88)return;window[_0xf00e07(0x6b7)]=_0x56fb3a,currentForumId=_0x28ad88[_0xf00e07(0x1cdc)],window[_0xf00e07(0x2070)]=_0x49e903;const _0x228159=document[_0xf00e07(0x1262)](_0xf00e07(0x1199)),_0xc497ff=await db[_0xf00e07(0x1867)][_0xf00e07(0xa24)]('postId')['equals'](_0x56fb3a)[_0xf00e07(0x1a7b)](),_0x50d713=_0xc497ff?_0xc497ff['imageUrl']:null,_0x3eca91=(_0x28ad88[_0xf00e07(0x211c)]||'')[_0xf00e07(0xe16)](/\n/g,_0xf00e07(0xa71));_0x228159[_0xf00e07(0x33a)]=_0xf00e07(0x19ec)+_0x28ad88[_0xf00e07(0x378)]+(_0x50d713?_0xf00e07(0x7fa):'')+_0xf00e07(0x1d04)+(_0x28ad88[_0xf00e07(0x680)]?_0xf00e07(0x3d3):'')+_0xf00e07(0x45b)+_0x28ad88[_0xf00e07(0xa42)]+_0xf00e07(0x1910)+new Date(_0x28ad88[_0xf00e07(0x1716)])[_0xf00e07(0xecc)]()+_0xf00e07(0x1cc1)+_0x3eca91+(_0x50d713?_0xf00e07(0xf7c)+_0x50d713+_0xf00e07(0x1517):'')+_0xf00e07(0xfa3);const _0x3b9e4a=await db[_0xf00e07(0x145c)][_0xf00e07(0xa24)](_0xf00e07(0x2074))[_0xf00e07(0x1694)](['user',_0x56fb3a])[_0xf00e07(0x1a7b)](),_0x44a5c2=document[_0xf00e07(0xb30)](_0xf00e07(0x5ab));_0x44a5c2['className']=_0x3b9e4a?_0xf00e07(0x22e4):_0xf00e07(0x1273),showApp(_0xf00e07(0xdf5)),setTimeout(async()=>{const _0x2c1691=_0xf00e07,_0xfe6548=document[_0x2c1691(0xb30)](_0x2c1691(0x1d50));_0xfe6548&&await generateSmartPollData(_0x56fb3a,_0x28ad88);const _0x31a281=await db[_0x2c1691(0x789)]['where'](_0x2c1691(0x9fc))['equals'](_0x56fb3a)[_0x2c1691(0xc44)]();_0x31a281===0x0&&await generateRepliesForUserPost(_0x56fb3a,_0x50d713),await renderReplies(_0x56fb3a);},0x64);}async function generateRepliesForPost(_0x2aec68){const _0x53c7b1=_0x211817,_0x5d48c4=await db[_0x53c7b1(0x14c4)]['get'](_0x2aec68);if(!_0x5d48c4)return;const _0x174f25=await db['forums']['get'](_0x5d48c4[_0x53c7b1(0x1cdc)]),_0x5a7a21=characters[_0x53c7b1(0x1e1f)](_0x47cc49=>_0x174f25[_0x53c7b1(0x1bd6)][_0x53c7b1(0x1831)](_0x47cc49['id'])),_0x55c18d=personas['find'](_0x4ac543=>_0x4ac543['id']===_0x174f25[_0x53c7b1(0x131c)]),_0x3c9f08=document[_0x53c7b1(0x1262)]('replies-list');_0x3c9f08[_0x53c7b1(0x33a)]=_0x53c7b1(0x9ec);const _0xdcf7d8=_0x53c7b1(0x1d0f)+_0x5d48c4[_0x53c7b1(0x378)]+_0x53c7b1(0x914)+_0x5d48c4['content']+'\x0a作者:\x20'+_0x5d48c4[_0x53c7b1(0xa42)]+'\x0a\x0a##\x20论坛背景:\x0a世界观:\x20'+(_0x174f25['worldview']||'现代都市生活分享社区')+_0x53c7b1(0xaf7)+_0x5a7a21[_0x53c7b1(0x6a4)](_0x41aedc=>'-\x20'+_0x41aedc['name']+':\x20'+_0x41aedc[_0x53c7b1(0x1f0b)])[_0x53c7b1(0x122b)]('\x0a')+_0x53c7b1(0x6cf)+_0x55c18d[_0x53c7b1(0x1a1c)]+_0x53c7b1(0x1d8e);console[_0x53c7b1(0x2187)]('🔥\x20[论坛评论生成]\x20完整Prompt:'),console[_0x53c7b1(0x2187)]('='[_0x53c7b1(0xcc7)](0x50)),console[_0x53c7b1(0x2187)](_0xdcf7d8),console[_0x53c7b1(0x2187)]('='['repeat'](0x50));try{const _0x1db473=await callForumAPI(_0xdcf7d8);let _0x5692a2;try{_0x5692a2=JSON[_0x53c7b1(0x22d3)](_0x1db473);}catch(_0x3a2470){const _0x4ac49e=_0x1db473['match'](/```json\s*([\s\S]*?)\s*```/);if(_0x4ac49e&&_0x4ac49e[0x1])_0x5692a2=JSON[_0x53c7b1(0x22d3)](_0x4ac49e[0x1]);else throw new Error(_0x53c7b1(0x1cce));}if(!Array[_0x53c7b1(0x1496)](_0x5692a2))throw new Error(_0x53c7b1(0xaaa));for(let _0x9936e2=0x0;_0x9936e2<_0x5692a2[_0x53c7b1(0x19ee)];_0x9936e2++){const _0x140933=_0x5692a2[_0x9936e2];if(_0x140933[_0x53c7b1(0xa42)]&&_0x140933[_0x53c7b1(0x211c)]){let _0x34a007=null,_0x45f74c='';const _0x2e005=_0x140933['authorName'][_0x53c7b1(0x1b87)](/^(.+)\((.+)\)$/);_0x2e005?(_0x45f74c=_0x2e005[0x2],_0x34a007=characters['find'](_0x4eca66=>_0x4eca66[_0x53c7b1(0x1a1c)]===_0x45f74c)||personas[_0x53c7b1(0xaf4)](_0x5c650f=>_0x5c650f[_0x53c7b1(0x1a1c)]===_0x45f74c)):_0x34a007=characters[_0x53c7b1(0xaf4)](_0x419dc2=>_0x419dc2[_0x53c7b1(0x1a1c)]===_0x140933[_0x53c7b1(0xa42)])||personas[_0x53c7b1(0xaf4)](_0x754996=>_0x754996['name']===_0x140933[_0x53c7b1(0xa42)]),await db['forumReplies'][_0x53c7b1(0x21e2)]({'postId':_0x2aec68,'content':_0x140933[_0x53c7b1(0x211c)],'authorName':_0x140933[_0x53c7b1(0xa42)],'authorAvatar':_0x34a007?_0x34a007['avatarUrl']:createDefaultAvatar(_0x140933[_0x53c7b1(0xa42)]),'timestamp':Date['now']()+_0x9936e2*0x3e8,'likes':Math[_0x53c7b1(0x2180)](Math[_0x53c7b1(0x11a8)]()*0x64)});}}}catch(_0x17d5d5){console[_0x53c7b1(0x174a)](_0x53c7b1(0x1992),_0x17d5d5),showToast(_0x53c7b1(0xbfe)+_0x17d5d5[_0x53c7b1(0x1e8e)],_0x53c7b1(0x174a));}}async function renderReplies(_0x52877d){const _0x407cce=_0x211817,_0xc981d=await db['forumReplies']['where'](_0x407cce(0x9fc))[_0x407cce(0x1694)](_0x52877d)[_0x407cce(0xd90)](_0x407cce(0x1716)),_0x58cc64=document[_0x407cce(0x1262)]('replies-list'),_0x31a320=await db[_0x407cce(0xa46)][_0x407cce(0xa24)](_0x407cce(0x3c3))[_0x407cce(0x1694)]('user')[_0x407cce(0xf13)](),_0x40b628=new Set(_0x31a320[_0x407cce(0x6a4)](_0x48689c=>_0x48689c[_0x407cce(0x1452)])),_0x37f976=_0x407cce(0x4f1),_0x4b57a8=_0x407cce(0xa5e),_0x45160e=_0xc981d[_0x407cce(0x6a4)]((_0x33e201,_0x16e400)=>{const _0x5d23d5=_0x407cce,_0x522ba7=_0x40b628[_0x5d23d5(0x975)](_0x33e201['id']),_0x7d3c22=_0x522ba7?_0x5d23d5(0x342):'',_0x5966f2=_0x522ba7?_0x4b57a8:_0x37f976,_0x231494=new Date(_0x33e201[_0x5d23d5(0x1716)])[_0x5d23d5(0xecc)](_0x5d23d5(0x156c),{'year':'numeric','month':_0x5d23d5(0xc79),'day':'2-digit','hour':_0x5d23d5(0xc79),'minute':_0x5d23d5(0xc79)});return _0x5d23d5(0x1356)+_0x33e201['id']+_0x5d23d5(0x1065)+(_0x33e201[_0x5d23d5(0x1bfa)]||createDefaultAvatar(_0x33e201[_0x5d23d5(0xa42)]))+_0x5d23d5(0x222c)+_0x33e201[_0x5d23d5(0xa42)]+_0x5d23d5(0x799)+_0x33e201[_0x5d23d5(0xa42)]+_0x5d23d5(0x2264)+(_0x16e400+0x1)+_0x5d23d5(0x1212)+_0x231494+_0x5d23d5(0x1480)+_0x33e201[_0x5d23d5(0x211c)]['replace'](/\n/g,_0x5d23d5(0xa71))+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22reply-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22reply-action-btn\x20like-btn\x20'+_0x7d3c22+'\x22\x20onclick=\x22likeReply('+_0x33e201['id']+_0x5d23d5(0x42d)+_0x5966f2+_0x5d23d5(0x2132)+(_0x33e201[_0x5d23d5(0x97d)]||0x0)+_0x5d23d5(0x15b9)+_0x33e201['id']+_0x5d23d5(0x1513)+_0x33e201[_0x5d23d5(0xa42)]+_0x5d23d5(0x1dc0);})[_0x407cce(0x122b)](''),_0x53725f=_0xc981d['length']>0x0?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22load-more-comments-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22load-more-comments-btn\x22\x20onclick=\x22loadMoreComments('+_0x52877d+_0x407cce(0x1c5c):'';_0x58cc64[_0x407cce(0x33a)]=_0x45160e+_0x53725f;}async function loadMoreComments(_0xe1d9b){const _0xce3385=_0x211817;try{const _0x4e5b53=await db['forumPosts'][_0xce3385(0xb78)](_0xe1d9b);if(!_0x4e5b53)return;const _0x560ea2=await db[_0xce3385(0x2147)]['get'](_0x4e5b53[_0xce3385(0x1cdc)]),_0x553452=characters[_0xce3385(0x1e1f)](_0x522e2c=>_0x560ea2['characterIds'][_0xce3385(0x1831)](_0x522e2c['id'])),_0x32ea3f=personas[_0xce3385(0xaf4)](_0x682cea=>_0x682cea['id']===_0x560ea2[_0xce3385(0x131c)]),_0x1520f8=await db[_0xce3385(0x789)][_0xce3385(0xa24)](_0xce3385(0x9fc))[_0xce3385(0x1694)](_0xe1d9b)[_0xce3385(0xd90)](_0xce3385(0x1716)),_0x3fdf0a=document[_0xce3385(0xb30)]('.load-more-comments-btn'),_0x5c8eb6=_0x3fdf0a[_0xce3385(0x13be)];_0x3fdf0a[_0xce3385(0x13be)]=_0xce3385(0x1141),_0x3fdf0a[_0xce3385(0x559)]=!![];const _0x29a555=_0x1520f8[_0xce3385(0x6d5)](-0x5)[_0xce3385(0x6a4)](_0x530f5f=>_0x530f5f[_0xce3385(0xa42)]+':\x20'+_0x530f5f['content'])['join']('\x0a'),_0x3979e5='\x0a#\x20角色：论坛评论生成AI\x0a请为以下帖子生成10条真实的评论回复，这些评论需要与之前的讨论有一定的上下文关联。\x0a\x0a##\x20帖子信息:\x0a标题:\x20'+_0x4e5b53['title']+_0xce3385(0x914)+_0x4e5b53[_0xce3385(0x211c)]+_0xce3385(0x19b7)+_0x4e5b53['authorName']+'\x0a\x0a##\x20论坛背景:\x0a世界观:\x20'+(_0x560ea2[_0xce3385(0x9e9)]||_0xce3385(0xc1a))+_0xce3385(0xe22)+(_0x29a555||_0xce3385(0x1d5b))+_0xce3385(0xaf7)+_0x553452['map'](_0x4bc79b=>'-\x20'+_0x4bc79b['name']+':\x20'+_0x4bc79b['bio'])[_0xce3385(0x122b)]('\x0a')+_0xce3385(0x6cf)+_0x32ea3f[_0xce3385(0x1a1c)]+_0xce3385(0x141b),_0x2db4b5=await callForumAPI(_0x3979e5);let _0x1b2c9c=[];try{_0x1b2c9c=JSON[_0xce3385(0x22d3)](_0x2db4b5);}catch(_0x811040){console[_0xce3385(0x2187)]('🔥\x20[loadMoreComments]\x20直接解析JSON失败，尝试提取代码块');const _0x1f0dc4=_0x2db4b5[_0xce3385(0x1b87)](/```json\s*([\s\S]*?)\s*```/);if(_0x1f0dc4&&_0x1f0dc4[0x1]){console[_0xce3385(0x2187)](_0xce3385(0x1225),_0x1f0dc4[0x1]);try{_0x1b2c9c=JSON[_0xce3385(0x22d3)](_0x1f0dc4[0x1]);}catch(_0x5b7e17){console[_0xce3385(0x174a)](_0xce3385(0x1a59),_0x5b7e17);throw new Error(_0xce3385(0x1406)+_0x5b7e17[_0xce3385(0x1e8e)]);}}else{const _0x37ea3b=_0x2db4b5[_0xce3385(0x1b87)](/```\s*([\s\S]*?)\s*```/);if(_0x37ea3b&&_0x37ea3b[0x1]){console[_0xce3385(0x2187)]('🔥\x20[loadMoreComments]\x20找到普通代码块:',_0x37ea3b[0x1]);try{_0x1b2c9c=JSON['parse'](_0x37ea3b[0x1]);}catch(_0x4890a5){console[_0xce3385(0x174a)](_0xce3385(0x719),_0x4890a5);throw new Error(_0xce3385(0x21c6)+_0x4890a5[_0xce3385(0x1e8e)]);}}else{const _0x315954=_0x2db4b5[_0xce3385(0x1b87)](/\[[\s\S]*\]/);if(_0x315954){console[_0xce3385(0x2187)]('🔥\x20[loadMoreComments]\x20找到数组格式:',_0x315954[0x0]);try{_0x1b2c9c=JSON[_0xce3385(0x22d3)](_0x315954[0x0]);}catch(_0x225fce){console['error'](_0xce3385(0x92a),_0x225fce);throw new Error('AI返回的数组格式错误:\x20'+_0x225fce[_0xce3385(0x1e8e)]);}}else{console[_0xce3385(0x174a)](_0xce3385(0xfd5));throw new Error('AI返回的不是有效的JSON格式。原始响应:\x20'+_0x2db4b5['substring'](0x0,0xc8)+_0xce3385(0x1520));}}}}const _0x53ac13=Date[_0xce3385(0x2eb)]();let _0x32b683=0x0;for(let _0xca7c96=0x0;_0xca7c96<_0x1b2c9c[_0xce3385(0x19ee)];_0xca7c96++){const _0x22bbea=_0x1b2c9c[_0xca7c96];if(!_0x22bbea[_0xce3385(0x211c)]||!_0x22bbea[_0xce3385(0xa42)])continue;let _0x30e1c0=null,_0x23d850='';const _0x4f0898=_0x22bbea[_0xce3385(0xa42)]['match'](/^(.+?)\((.+?)\)$/);if(_0x4f0898){const _0x59c3d3=_0x4f0898[0x1][_0xce3385(0x19d7)]();_0x23d850=_0x4f0898[0x2][_0xce3385(0x19d7)](),_0x30e1c0=characters[_0xce3385(0xaf4)](_0x1aac7b=>_0x1aac7b[_0xce3385(0x1a1c)]===_0x23d850),_0x30e1c0&&(_0x22bbea[_0xce3385(0xa42)]=_0x59c3d3);}else _0x30e1c0=characters[_0xce3385(0xaf4)](_0x175099=>_0x175099[_0xce3385(0x1a1c)]===_0x22bbea[_0xce3385(0xa42)]);const _0x441e46={'postId':_0xe1d9b,'authorName':_0x22bbea[_0xce3385(0xa42)],'authorAvatar':_0x30e1c0?_0x30e1c0[_0xce3385(0x1994)]:createDefaultAvatar(_0x22bbea[_0xce3385(0xa42)]),'content':_0x22bbea[_0xce3385(0x211c)],'timestamp':_0x53ac13+_0xca7c96*0x3e8,'likes':Math[_0xce3385(0x2180)](Math[_0xce3385(0x11a8)]()*0x5),'characterId':_0x30e1c0?_0x30e1c0['id']:null};await db[_0xce3385(0x789)]['add'](_0x441e46),_0x32b683++;}await renderReplies(_0xe1d9b),showToast(_0xce3385(0x1192)+_0x32b683+'\x20条新评论',_0xce3385(0x11cb));}catch(_0x5d78a8){console['error']('加载更多评论失败:',_0x5d78a8),showToast('加载评论失败:\x20'+_0x5d78a8[_0xce3385(0x1e8e)],'error');const _0x1a081d=document['querySelector'](_0xce3385(0xbb4));_0x1a081d&&(_0x1a081d[_0xce3385(0x13be)]=_0xce3385(0x1363),_0x1a081d[_0xce3385(0x559)]=![]);}}function showCreatePostModal(){const _0x4396e3=_0x211817,_0x3e09ea=document['getElementById']('create-post-modal');_0x3e09ea['style']['display']=_0x4396e3(0x1fb7),document['getElementById'](_0x4396e3(0xd37))[_0x4396e3(0x1ebc)]='',document[_0x4396e3(0x1262)](_0x4396e3(0x151a))[_0x4396e3(0x1ebc)]='',document[_0x4396e3(0x1262)]('anonymous-post-checkbox')['checked']=![],document[_0x4396e3(0x1262)](_0x4396e3(0xad1))[_0x4396e3(0x1ebc)]='',document[_0x4396e3(0x1262)]('post-image-preview-container')[_0x4396e3(0x14eb)][_0x4396e3(0x4da)]=_0x4396e3(0x102b),document[_0x4396e3(0x1262)](_0x4396e3(0x22da))[_0x4396e3(0x45c)]='',updateCharCount();const _0x4f6fab=document[_0x4396e3(0x1262)]('post-title-input'),_0x130368=document['getElementById'](_0x4396e3(0x151a));_0x4f6fab['oninput']=updateCharCount,_0x130368['oninput']=updateCharCount;const _0x3cd4ea=document[_0x4396e3(0x1262)](_0x4396e3(0x1024)),_0x2feb7a=document[_0x4396e3(0x1262)](_0x4396e3(0xad1)),_0x12ae4e=document[_0x4396e3(0x1262)](_0x4396e3(0x1312)),_0x4ed19b=document[_0x4396e3(0x1262)](_0x4396e3(0xa57)),_0x2c2708=document[_0x4396e3(0x1262)]('post-image-preview');_0x3cd4ea[_0x4396e3(0x1f36)]=()=>_0x2feb7a[_0x4396e3(0x1859)](),_0x2feb7a[_0x4396e3(0x1980)]=_0x23712b=>{const _0x208526=_0x4396e3,_0x50db73=_0x23712b[_0x208526(0x193d)][_0x208526(0xf26)][0x0];if(_0x50db73){const _0x1451cd=new FileReader();_0x1451cd[_0x208526(0xc55)]=_0x2a6768=>{const _0x547920=_0x208526;_0x2c2708['src']=_0x2a6768[_0x547920(0x193d)][_0x547920(0x4ee)],_0x4ed19b[_0x547920(0x14eb)][_0x547920(0x4da)]='block';},_0x1451cd[_0x208526(0x127c)](_0x50db73);}},_0x12ae4e[_0x4396e3(0x1f36)]=()=>{const _0xf3919c=_0x4396e3;_0x2feb7a['value']='',_0x2c2708['src']='',_0x4ed19b[_0xf3919c(0x14eb)][_0xf3919c(0x4da)]=_0xf3919c(0x102b);};}function hideCreatePostModal(_0x2f6c52){const _0x5d1fd4=_0x211817;if(_0x2f6c52&&_0x2f6c52[_0x5d1fd4(0x193d)]!==_0x2f6c52['currentTarget'])return;const _0x3ac0bf=document[_0x5d1fd4(0x1262)](_0x5d1fd4(0x41b));_0x3ac0bf[_0x5d1fd4(0x14eb)]['display']=_0x5d1fd4(0x102b);}function updateCharCount(){const _0x2c3c9d=_0x211817,_0x545045=document['getElementById']('post-title-input'),_0x5a0b5b=document[_0x2c3c9d(0x1262)](_0x2c3c9d(0x151a)),_0x6391a0=document[_0x2c3c9d(0x1262)](_0x2c3c9d(0x4d9)),_0x47dc57=document[_0x2c3c9d(0x1262)]('content-count');_0x6391a0['textContent']=_0x545045[_0x2c3c9d(0x1ebc)][_0x2c3c9d(0x19ee)]+'/100',_0x47dc57[_0x2c3c9d(0x13be)]=_0x5a0b5b[_0x2c3c9d(0x1ebc)]['length']+_0x2c3c9d(0x114e),_0x6391a0[_0x2c3c9d(0x14eb)][_0x2c3c9d(0xc3d)]=_0x545045[_0x2c3c9d(0x1ebc)]['length']>0x64?'#ff3b30':_0x2c3c9d(0x46d),_0x47dc57['style']['color']=_0x5a0b5b[_0x2c3c9d(0x1ebc)][_0x2c3c9d(0x19ee)]>0x7d0?_0x2c3c9d(0x31e):_0x2c3c9d(0x46d);}async function submitUserPost(){const _0x4d1841=_0x211817,_0x5b590c=document[_0x4d1841(0x1262)]('post-title-input')[_0x4d1841(0x1ebc)][_0x4d1841(0x19d7)](),_0x4dac52=document['getElementById'](_0x4d1841(0x151a))['value'][_0x4d1841(0x19d7)](),_0xd0a0a1=document['getElementById'](_0x4d1841(0x1617))[_0x4d1841(0x14c1)],_0x4e5bb9=document['getElementById'](_0x4d1841(0xad1)),_0x15f049=_0x4e5bb9[_0x4d1841(0xf26)][0x0];if(!_0x5b590c&&!_0x15f049){showToast(_0x4d1841(0x1981),_0x4d1841(0x174a));return;}if(!_0x4dac52&&!_0x15f049){showToast('请输入内容或上传图片',_0x4d1841(0x174a));return;}if(_0x5b590c[_0x4d1841(0x19ee)]>0x64||_0x4dac52[_0x4d1841(0x19ee)]>0x7d0){showToast(_0x4d1841(0x2004),_0x4d1841(0x174a));return;}showToast(_0x4d1841(0x20be),_0x4d1841(0x477));try{const _0x18da3b=await db[_0x4d1841(0x2147)][_0x4d1841(0xb78)](parseInt(currentForumId)),_0x2ba859=personas[_0x4d1841(0xaf4)](_0x36ff61=>_0x36ff61['id']===_0x18da3b[_0x4d1841(0x131c)]);let _0x452f55,_0x43bddd,_0x890123;if(_0xd0a0a1){const _0x3028d0=[_0x4d1841(0x1b11),_0x4d1841(0xd27),'路过的人'];_0x452f55=_0x3028d0[Math[_0x4d1841(0x2180)](Math[_0x4d1841(0x11a8)]()*_0x3028d0[_0x4d1841(0x19ee)])],_0x43bddd='anonymous_'+Date['now'](),_0x890123=null;}else _0x452f55=_0x2ba859[_0x4d1841(0x1a1c)],_0x43bddd=_0x2ba859['id'],_0x890123=_0x2ba859['avatarUrl'];const _0x4a9ac9={'forumId':parseInt(currentForumId),'title':_0x5b590c||'分享图片','content':_0x4dac52,'authorId':_0x43bddd,'authorName':_0x452f55,'authorAvatar':_0x890123,'timestamp':Date[_0x4d1841(0x2eb)](),'isUserPost':!![],'isAnonymous':_0xd0a0a1};let _0x4b08eb=null;_0x15f049&&(_0x4b08eb=await new Promise(_0x46eba4=>{const _0x49d49e=_0x4d1841,_0x4a25da=new FileReader();_0x4a25da['onload']=_0x4cff4b=>_0x46eba4(_0x4cff4b['target'][_0x49d49e(0x4ee)]),_0x4a25da[_0x49d49e(0x127c)](_0x15f049);}));const _0x49b160=await db[_0x4d1841(0x14c4)][_0x4d1841(0x21e2)](_0x4a9ac9);_0x4b08eb&&await db['forumPostImages'][_0x4d1841(0x21e2)]({'postId':_0x49b160,'imageUrl':_0x4b08eb}),hideCreatePostModal(),await renderForumPosts(currentForumId),showToast(_0x4d1841(0x587),_0x4d1841(0x11cb));}catch(_0x3ed42e){console[_0x4d1841(0x174a)]('发帖失败:',_0x3ed42e),showToast(_0x4d1841(0x1752)+_0x3ed42e[_0x4d1841(0x1e8e)],_0x4d1841(0x174a));}}async function generateRepliesForUserPost(_0x4d2d4c,_0x144a0f=null){const _0x3a700a=_0x211817,_0x204b6e=await db[_0x3a700a(0x14c4)][_0x3a700a(0xb78)](_0x4d2d4c);if(!_0x204b6e)return;const _0x5b5d2c=await db[_0x3a700a(0x2147)][_0x3a700a(0xb78)](_0x204b6e[_0x3a700a(0x1cdc)]),_0x2a2062=characters['filter'](_0x40dc81=>_0x5b5d2c[_0x3a700a(0x1bd6)][_0x3a700a(0x1831)](_0x40dc81['id'])),_0x48c44c=personas['find'](_0x4b25fa=>_0x4b25fa['id']===_0x5b5d2c[_0x3a700a(0x131c)]);let _0x2040df='';_0x144a0f&&(_0x2040df=_0x3a700a(0x158b));const _0x552889=_0x3a700a(0x21dc)+_0x204b6e[_0x3a700a(0x378)]+'\x0a内容:\x20'+_0x204b6e['content']+_0x3a700a(0x19b7)+_0x204b6e[_0x3a700a(0xa42)]+(_0x204b6e['isAnonymous']?_0x3a700a(0x205c):'')+'\x0a'+_0x2040df+'\x0a\x0a##\x20论坛背景:\x0a世界观:\x20'+(_0x5b5d2c[_0x3a700a(0x9e9)]||_0x3a700a(0xc1a))+_0x3a700a(0xfca)+_0x2a2062[_0x3a700a(0x6a4)](_0x3937fa=>'-\x20'+_0x3937fa[_0x3a700a(0x1a1c)]+':\x20'+_0x3937fa[_0x3a700a(0x1f0b)])[_0x3a700a(0x122b)]('\x0a')+_0x3a700a(0x6cf)+_0x48c44c[_0x3a700a(0x1a1c)]+_0x3a700a(0x371)+(_0x204b6e[_0x3a700a(0x15a6)]?_0x3a700a(0x1510):'')+_0x3a700a(0x1426)+(_0x204b6e[_0x3a700a(0x15a6)]?_0x3a700a(0x1b08):_0x3a700a(0x1bd3))+'\x0a\x0a###\x20输出格式:\x0a**重要：只输出JSON数组，不要任何其他文字、解释或代码块标记！**\x0a\x0a[\x0a\x20\x20{\x0a\x20\x20\x20\x20\x22authorName\x22:\x20\x22回复者网名或网名(真实身份)\x22,\x0a\x20\x20\x20\x20\x22content\x22:\x20\x22回复内容\x22\x0a\x20\x20}\x0a]\x0a\x0a**再次强调：直接输出JSON数组，不要包装在代码块中！**\x0a';try{let _0x56ff16;_0x144a0f?(console['log'](_0x3a700a(0x1ab1)),_0x56ff16=await callForumAPIWithImage(_0x552889,_0x144a0f)):(console['log'](_0x3a700a(0xce2)),_0x56ff16=await callForumAPI(_0x552889));let _0x553e6e;console[_0x3a700a(0x2187)](_0x3a700a(0x134e),_0x56ff16);try{_0x553e6e=JSON['parse'](_0x56ff16);}catch(_0x1cd08e){console['log'](_0x3a700a(0x10f4));const _0x14d2bd=_0x56ff16[_0x3a700a(0x1b87)](/```json\s*([\s\S]*?)\s*```/);if(_0x14d2bd&&_0x14d2bd[0x1]){console[_0x3a700a(0x2187)](_0x3a700a(0x142a),_0x14d2bd[0x1]);try{_0x553e6e=JSON[_0x3a700a(0x22d3)](_0x14d2bd[0x1]);}catch(_0x80164){console['error'](_0x3a700a(0x7f2),_0x80164);throw new Error(_0x3a700a(0x1406)+_0x80164[_0x3a700a(0x1e8e)]);}}else{const _0x49e668=_0x56ff16[_0x3a700a(0x1b87)](/```\s*([\s\S]*?)\s*```/);if(_0x49e668&&_0x49e668[0x1]){console['log']('🔥\x20[generateRepliesForUserPost]\x20找到普通代码块:',_0x49e668[0x1]);try{_0x553e6e=JSON[_0x3a700a(0x22d3)](_0x49e668[0x1]);}catch(_0x31b6c1){console['error']('🔥\x20[generateRepliesForUserPost]\x20普通代码块解析失败:',_0x31b6c1);throw new Error(_0x3a700a(0x21c6)+_0x31b6c1[_0x3a700a(0x1e8e)]);}}else{const _0x3973cc=_0x56ff16[_0x3a700a(0x1b87)](/\[[\s\S]*\]/);if(_0x3973cc){console[_0x3a700a(0x2187)](_0x3a700a(0x2134),_0x3973cc[0x0]);try{_0x553e6e=JSON[_0x3a700a(0x22d3)](_0x3973cc[0x0]);}catch(_0x38e33b){console['error']('🔥\x20[generateRepliesForUserPost]\x20数组格式解析失败:',_0x38e33b);throw new Error(_0x3a700a(0x10d2)+_0x38e33b[_0x3a700a(0x1e8e)]);}}else{console['error'](_0x3a700a(0x900));throw new Error(_0x3a700a(0x34b)+_0x56ff16[_0x3a700a(0x17ca)](0x0,0xc8)+'...');}}}}if(Array[_0x3a700a(0x1496)](_0x553e6e)){for(let _0x365c84=0x0;_0x365c84<_0x553e6e[_0x3a700a(0x19ee)];_0x365c84++){const _0x29386c=_0x553e6e[_0x365c84];if(_0x29386c[_0x3a700a(0xa42)]&&_0x29386c[_0x3a700a(0x211c)]){let _0x46cef8=null,_0x2e3c6d='';const _0x3af1e5=_0x29386c['authorName'][_0x3a700a(0x1b87)](/^(.+)\((.+)\)$/);_0x3af1e5?(_0x2e3c6d=_0x3af1e5[0x2],_0x46cef8=characters[_0x3a700a(0xaf4)](_0x27025b=>_0x27025b[_0x3a700a(0x1a1c)]===_0x2e3c6d)||personas[_0x3a700a(0xaf4)](_0x266e0e=>_0x266e0e[_0x3a700a(0x1a1c)]===_0x2e3c6d)):_0x46cef8=characters[_0x3a700a(0xaf4)](_0x17b07d=>_0x17b07d[_0x3a700a(0x1a1c)]===_0x29386c[_0x3a700a(0xa42)])||personas[_0x3a700a(0xaf4)](_0x17fda5=>_0x17fda5[_0x3a700a(0x1a1c)]===_0x29386c[_0x3a700a(0xa42)]),await db['forumReplies'][_0x3a700a(0x21e2)]({'postId':_0x4d2d4c,'content':_0x29386c[_0x3a700a(0x211c)],'authorName':_0x29386c['authorName'],'authorAvatar':_0x46cef8?_0x46cef8['avatarUrl']:createDefaultAvatar(_0x29386c[_0x3a700a(0xa42)]),'timestamp':Date['now']()+_0x365c84*0x7d0});}}showToast(_0x3a700a(0x126d)+_0x553e6e[_0x3a700a(0x19ee)]+_0x3a700a(0xc23),'success');}}catch(_0x12eb45){console['error']('生成用户帖子回复失败:',_0x12eb45),showToast('生成回复失败:\x20'+_0x12eb45[_0x3a700a(0x1e8e)],_0x3a700a(0x174a));}}async function likeReply(_0x4d0a11){const _0x451e0c=_0x211817;try{const _0x180ea4=await db[_0x451e0c(0x789)][_0x451e0c(0xb78)](_0x4d0a11);if(!_0x180ea4)return;const _0x343977=document[_0x451e0c(0xb30)]('[data-reply-id=\x22'+_0x4d0a11+_0x451e0c(0x633)),_0x525391=_0x343977[_0x451e0c(0xb30)](_0x451e0c(0xeb2)),_0x50c486=_0x451e0c(0x4f1),_0xa4d2ab=_0x451e0c(0xa5e),_0x575a2d=await db[_0x451e0c(0xa46)][_0x451e0c(0xa24)]('[userId+replyId]')[_0x451e0c(0x1694)]([_0x451e0c(0xa80),_0x4d0a11])['first']();_0x575a2d?(await db['replyLikes'][_0x451e0c(0x1f4a)](_0x575a2d['id']),_0x180ea4['likes']=Math[_0x451e0c(0x658)](0x0,(_0x180ea4[_0x451e0c(0x97d)]||0x0)-0x1),_0x343977[_0x451e0c(0x1c1b)]['remove'](_0x451e0c(0x342)),_0x343977['innerHTML']=_0x50c486+(_0x451e0c(0x11d1)+(_0x180ea4['likes']||0x0)+_0x451e0c(0x1f2))):(await db[_0x451e0c(0xa46)][_0x451e0c(0x21e2)]({'userId':'user','replyId':_0x4d0a11,'timestamp':Date[_0x451e0c(0x2eb)]()}),_0x180ea4['likes']=(_0x180ea4[_0x451e0c(0x97d)]||0x0)+0x1,_0x343977[_0x451e0c(0x1c1b)][_0x451e0c(0x21e2)]('liked'),_0x343977[_0x451e0c(0x33a)]=_0xa4d2ab+(_0x451e0c(0x11d1)+(_0x180ea4[_0x451e0c(0x97d)]||0x0)+'</span>')),await db['forumReplies'][_0x451e0c(0x96d)](_0x4d0a11,{'likes':_0x180ea4[_0x451e0c(0x97d)]});}catch(_0x455063){console[_0x451e0c(0x174a)](_0x451e0c(0xa6b),_0x455063),showToast(_0x451e0c(0x77b),'error');}}async function replyToComment(_0x18b12f,_0x4f439a){const _0x2a5458=_0x211817,_0x104411=document[_0x2a5458(0x1262)]('reply-input');_0x104411&&(_0x104411[_0x2a5458(0x1ebc)]='@'+_0x4f439a+'\x20',_0x104411[_0x2a5458(0x13cf)](),_0x104411[_0x2a5458(0x207)](_0x104411[_0x2a5458(0x1ebc)][_0x2a5458(0x19ee)],_0x104411[_0x2a5458(0x1ebc)]['length']));}async function callSimpleTextAPI(_0x51bf11){const _0x272c9f=_0x211817;if(!apiSettings[_0x272c9f(0x213c)])throw new Error(_0x272c9f(0x19f7));const _0x5400a8={'model':apiSettings['model'],'messages':[{'role':_0x272c9f(0xa80),'content':_0x51bf11}],'temperature':0.85},_0x40c116=apiSettings[_0x272c9f(0x1208)][_0x272c9f(0x1831)](_0x272c9f(0x1d80));let _0x303510,_0x37d3a4,_0xa9e246;_0x40c116?(_0x303510=apiSettings['base']+_0x272c9f(0x1107)+apiSettings[_0x272c9f(0x1976)]+_0x272c9f(0x40c)+apiSettings[_0x272c9f(0x213c)],_0x37d3a4={'Content-Type':_0x272c9f(0x1b82)},_0xa9e246=JSON[_0x272c9f(0x6b8)]({'contents':[{'parts':[{'text':_0x51bf11}]}]})):(_0x303510=apiSettings['base'][_0x272c9f(0x81f)](_0x272c9f(0x1439))?apiSettings[_0x272c9f(0x1208)]+_0x272c9f(0x1bea):apiSettings[_0x272c9f(0x1208)]+_0x272c9f(0x666),_0x37d3a4={'Content-Type':_0x272c9f(0x1b82),'Authorization':'Bearer\x20'+apiSettings[_0x272c9f(0x213c)]},_0xa9e246=JSON[_0x272c9f(0x6b8)](_0x5400a8));const _0x1a6888=await fetch(_0x303510,{'method':'POST','headers':_0x37d3a4,'body':_0xa9e246});if(!_0x1a6888['ok']){const _0xd055dd=await _0x1a6888[_0x272c9f(0x1378)]();throw new Error(_0x272c9f(0x61b)+_0x1a6888[_0x272c9f(0x12e2)]+_0x272c9f(0x1811)+_0xd055dd);}const _0x226579=await _0x1a6888[_0x272c9f(0xe52)]();return _0x40c116?_0x226579[_0x272c9f(0x1153)]?.[0x0]?.[_0x272c9f(0x211c)]?.[_0x272c9f(0x2308)]?.[0x0]?.[_0x272c9f(0x1378)]:_0x226579[_0x272c9f(0x1090)]?.[0x0]?.[_0x272c9f(0x1e8e)]?.[_0x272c9f(0x211c)];}let isAnonymousMode=![];function toggleAnonymousMode(){const _0x3c36ee=_0x211817;isAnonymousMode=!isAnonymousMode;const _0x2574cf=document[_0x3c36ee(0x1262)](_0x3c36ee(0x206b)),_0x54a032=document[_0x3c36ee(0x1262)]('reply-input');isAnonymousMode?(_0x2574cf['classList'][_0x3c36ee(0x21e2)]('active'),_0x2574cf[_0x3c36ee(0x378)]=_0x3c36ee(0x35b),_0x54a032[_0x3c36ee(0x1aa7)]=_0x3c36ee(0x9cb)):(_0x2574cf[_0x3c36ee(0x1c1b)][_0x3c36ee(0x1493)](_0x3c36ee(0x1a14)),_0x2574cf[_0x3c36ee(0x378)]='匿名回复',_0x54a032[_0x3c36ee(0x1aa7)]=_0x3c36ee(0x836));}function generateAnonymousName(){const _0x4b9f1c=_0x211817,_0x206d42=[_0x4b9f1c(0x229d),'路过网友','匿名用户','神秘的',_0x4b9f1c(0x4fb),_0x4b9f1c(0x1416),_0x4b9f1c(0x2242),'围观网友',_0x4b9f1c(0x15b2),_0x4b9f1c(0x1a32),'佛系的',_0x4b9f1c(0x317),_0x4b9f1c(0x1c74),_0x4b9f1c(0x1459),_0x4b9f1c(0x204d)],_0x1a1b48=['小白','小黑','小红','小蓝','小绿','小紫',_0x4b9f1c(0x16d2),'小黄','阿强','阿明','小狗','小猫',_0x4b9f1c(0xfbd),_0x4b9f1c(0x94f),'同学','一只猹','小A','小B','小C','小D','小E','小F','小G','小H'],_0x4565ef=_0x206d42[Math[_0x4b9f1c(0x2180)](Math[_0x4b9f1c(0x11a8)]()*_0x206d42['length'])],_0x54d56c=_0x1a1b48[Math[_0x4b9f1c(0x2180)](Math[_0x4b9f1c(0x11a8)]()*_0x1a1b48[_0x4b9f1c(0x19ee)])];return''+_0x4565ef+_0x54d56c+_0x4b9f1c(0xf70);}async function sendReply(){const _0x2f5d2f=_0x211817,_0x556e3a=document['getElementById']('reply-input'),_0x3552df=_0x556e3a['value'][_0x2f5d2f(0x19d7)]();if(!_0x3552df||!window[_0x2f5d2f(0x6b7)])return;if(!currentForumId){const _0xbef32e=await db[_0x2f5d2f(0x14c4)][_0x2f5d2f(0xb78)](window[_0x2f5d2f(0x6b7)]);if(_0xbef32e)currentForumId=_0xbef32e[_0x2f5d2f(0x1cdc)];else{showToast(_0x2f5d2f(0x1400),_0x2f5d2f(0x174a));return;}}const _0x4a8d90=await db['forums'][_0x2f5d2f(0xb78)](parseInt(currentForumId));if(!_0x4a8d90){showToast('找不到当前论坛信息','error');return;}let _0x487c08=null;if(!isAnonymousMode){_0x487c08=personas['find'](_0x34a67c=>_0x34a67c['id']===_0x4a8d90[_0x2f5d2f(0x131c)]);if(!_0x487c08){showToast(_0x2f5d2f(0x20e0),'error');return;}}let _0x1d2222;isAnonymousMode?_0x1d2222={'postId':window[_0x2f5d2f(0x6b7)],'authorId':_0x2f5d2f(0xf88),'authorName':generateAnonymousName(),'authorAvatar':createDefaultAvatar('匿名'),'content':_0x3552df,'timestamp':Date['now'](),'isAnonymous':!![]}:_0x1d2222={'postId':window[_0x2f5d2f(0x6b7)],'authorId':_0x2f5d2f(0xa80),'authorName':_0x487c08[_0x2f5d2f(0x1a1c)],'authorAvatar':_0x487c08['avatarUrl'],'content':_0x3552df,'timestamp':Date[_0x2f5d2f(0x2eb)](),'isAnonymous':![]},await db[_0x2f5d2f(0x789)][_0x2f5d2f(0x21e2)](_0x1d2222),_0x556e3a[_0x2f5d2f(0x1ebc)]='',await renderReplies(window['currentPostId']),handleForumAIReply(_0x3552df,window['currentPostId']);}async function handleForumAIReply(_0x356a54,_0x16d80d){const _0x760f39=_0x211817;try{const _0x49074a=await db[_0x760f39(0x14c4)][_0x760f39(0xb78)](_0x16d80d),_0xe9c074=await db['forums'][_0x760f39(0xb78)](_0x49074a['forumId']),_0x2cfd2d=characters[_0x760f39(0x1e1f)](_0x22781f=>_0xe9c074['characterIds']['includes'](_0x22781f['id'])),_0x2df376=_0x356a54[_0x760f39(0x1b87)](/@(\S+)/);let _0x4d7d4d=null,_0x147949=![];if(_0x2df376){const _0x8b837f=_0x2df376[0x1],_0x2e8f93=_0x2cfd2d['find'](_0x211915=>_0x211915[_0x760f39(0x1a1c)]===_0x8b837f);_0x2e8f93?(_0x147949=Math[_0x760f39(0x11a8)]()<0.6,_0x4d7d4d=_0x2e8f93):(_0x147949=Math['random']()<0.7,_0x4d7d4d={'name':_0x8b837f,'bio':_0x760f39(0x1455)});}else _0x147949=Math[_0x760f39(0x11a8)]()<0.7,_0x147949&&_0x2cfd2d[_0x760f39(0x19ee)]>0x0&&(_0x4d7d4d=_0x2cfd2d[Math[_0x760f39(0x2180)](Math['random']()*_0x2cfd2d['length'])]);if(_0x147949&&_0x4d7d4d){console['log'](_0x760f39(0x1124)+_0x4d7d4d[_0x760f39(0x1a1c)]+'\x22\x20进行回复。');const _0x4f0ea8=await buildForumReplyPrompt(_0x4d7d4d,_0x49074a,_0x356a54);console[_0x760f39(0x2187)](_0x760f39(0x2255)+_0x4d7d4d['name']+_0x760f39(0xa89)),console['log']('='[_0x760f39(0xcc7)](0x50)),console[_0x760f39(0x2187)](_0x4f0ea8),console[_0x760f39(0x2187)]('='['repeat'](0x50));const _0x4436a5=await callSimpleTextAPI(_0x4f0ea8);if(_0x4436a5&&_0x4436a5[_0x760f39(0x19d7)]()){const _0x24fe65={'postId':_0x16d80d,'authorId':_0x4d7d4d['id']||'npc','authorName':_0x4d7d4d[_0x760f39(0x1a1c)],'authorAvatar':_0x4d7d4d[_0x760f39(0x1994)]||createDefaultAvatar(_0x4d7d4d[_0x760f39(0x1a1c)]),'content':_0x4436a5[_0x760f39(0x19d7)](),'timestamp':Date[_0x760f39(0x2eb)]()+0x3e8};await db[_0x760f39(0x789)][_0x760f39(0x21e2)](_0x24fe65),setTimeout(()=>renderReplies(_0x16d80d),0x5dc);}}else console[_0x760f39(0x2187)](_0x760f39(0x8e3));}catch(_0x5e7ca1){console[_0x760f39(0x174a)](_0x760f39(0x16c0),_0x5e7ca1);}}async function buildForumReplyPrompt(_0x22d3e4,_0x50dfac,_0x44e476){const _0x22e25f=_0x211817,_0x17eafb=await db['forumReplies'][_0x22e25f(0xa24)](_0x22e25f(0x9fc))['equals'](_0x50dfac['id'])[_0x22e25f(0xd90)](_0x22e25f(0x1716)),_0x263bff=_0x17eafb[_0x22e25f(0x6d5)](-0x5);return _0x22e25f(0x1639)+_0x22d3e4[_0x22e25f(0x1a1c)]+'，你的人设是:\x20'+(_0x22d3e4[_0x22e25f(0x1f0b)]||_0x22e25f(0x1d59))+'\x0a\x0a当前场景:\x0a在一个名为\x20\x22'+_0x50dfac['title']+_0x22e25f(0x221c)+_0x50dfac[_0x22e25f(0x211c)]+_0x22e25f(0x12c3)+_0x263bff[_0x22e25f(0x6a4)](_0x3ca111=>_0x3ca111['authorName']+':\x20'+_0x3ca111[_0x22e25f(0x211c)])[_0x22e25f(0x122b)]('\x0a')+_0x22e25f(0x19c8)+_0x44e476+_0x22e25f(0x18a3)+_0x22d3e4[_0x22e25f(0x1a1c)]+_0x22e25f(0x3d1);}async function toggleFavoritePost(){const _0x12774c=_0x211817;console['log'](_0x12774c(0x21be));if(!window['currentPostId']){console['error'](_0x12774c(0x17b6)),showToast(_0x12774c(0x1b8),_0x12774c(0x174a));return;}const _0x44a0bb=parseInt(window[_0x12774c(0x6b7)]),_0x1200a0=document[_0x12774c(0xb30)](_0x12774c(0x5ab));console[_0x12774c(0x2187)](_0x12774c(0x1dc7)+_0x44a0bb+_0x12774c(0x1dc8)+typeof _0x44a0bb+')\x20切换收藏状态');if(!_0x1200a0){console['error'](_0x12774c(0x871));return;}try{console[_0x12774c(0x2187)]('[论坛收藏]\x20正在查询数据库，检查是否已收藏...');const _0x529e4b=await db['forumFavorites'][_0x12774c(0xa24)](_0x12774c(0x2074))[_0x12774c(0x1694)](['user',_0x44a0bb])['first']();if(_0x529e4b)console[_0x12774c(0x2187)]('[论坛收藏]\x20帖子已收藏，准备取消。记录:',_0x529e4b),await db['forumFavorites'][_0x12774c(0x1f4a)](_0x529e4b['id']),console[_0x12774c(0x2187)]('[论坛收藏]\x20数据库删除操作成功。'),_0x1200a0['className']=_0x12774c(0x1273),showToast(_0x12774c(0x50e),_0x12774c(0x477)),console[_0x12774c(0x2187)](_0x12774c(0x1d71));else{const _0x113f55={'userId':'user','postId':_0x44a0bb,'timestamp':Date[_0x12774c(0x2eb)]()};console[_0x12774c(0x2187)](_0x12774c(0x1aa0),_0x113f55),await db[_0x12774c(0x145c)][_0x12774c(0x21e2)](_0x113f55),console[_0x12774c(0x2187)](_0x12774c(0x1fa6)),_0x1200a0[_0x12774c(0x1722)]=_0x12774c(0x22e4),showToast('收藏成功！',_0x12774c(0x11cb)),console['log'](_0x12774c(0x369));}}catch(_0x1a960f){console[_0x12774c(0x174a)](_0x12774c(0x4e0),_0x1a960f),showToast(_0x12774c(0x1dd7),_0x12774c(0x174a));}console['log']('---\x20[论坛收藏]\x20功能执行完毕\x20---');}async function showForumProfile(){const _0xf5f5ee=_0x211817;showApp('forum-profile-screen'),hideApp(_0xf5f5ee(0x14aa)),switchProfileTab(_0xf5f5ee(0x1900));const _0x159a02=document[_0xf5f5ee(0x1262)](_0xf5f5ee(0xffb)),_0x1f4c1f=await db[_0xf5f5ee(0x14c4)]['toArray'](),_0x3d81d0=_0x1f4c1f[_0xf5f5ee(0x1e1f)](_0x154e4f=>_0x154e4f[_0xf5f5ee(0x680)]===!![])[_0xf5f5ee(0x1104)]((_0x427afd,_0x41d6ca)=>_0x41d6ca[_0xf5f5ee(0x1716)]-_0x427afd[_0xf5f5ee(0x1716)]);if(_0x3d81d0[_0xf5f5ee(0x19ee)]===0x0)_0x159a02[_0xf5f5ee(0x33a)]=_0xf5f5ee(0xcae);else{const _0x577f80=await Promise[_0xf5f5ee(0x1a47)](_0x3d81d0[_0xf5f5ee(0x6a4)](async _0x985be8=>{const _0x46f0bc=_0xf5f5ee,_0x5bf1da=await db[_0x46f0bc(0x1867)][_0x46f0bc(0xa24)](_0x46f0bc(0x9fc))[_0x46f0bc(0x1694)](_0x985be8['id'])[_0x46f0bc(0xc44)]()>0x0;return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-item\x22\x20onclick=\x22showPostView('+_0x985be8['id']+_0x46f0bc(0x1e9b)+_0x985be8[_0x46f0bc(0x378)]+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x5bf1da?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0x46f0bc(0x12b6)+_0x985be8[_0x46f0bc(0xa42)]+_0x46f0bc(0x1212)+formatTime(_0x985be8['timestamp'])+_0x46f0bc(0x177e);}));_0x159a02[_0xf5f5ee(0x33a)]=_0x577f80[_0xf5f5ee(0x122b)]('');}const _0x1c26a3=document[_0xf5f5ee(0x1262)](_0xf5f5ee(0x1e92)),_0x10ff80=await db[_0xf5f5ee(0x145c)][_0xf5f5ee(0xa24)](_0xf5f5ee(0x3c3))['equals'](_0xf5f5ee(0xa80))[_0xf5f5ee(0xf13)](),_0x11bf18=_0x10ff80[_0xf5f5ee(0x6a4)](_0xceaf84=>_0xceaf84['postId']);if(_0x11bf18[_0xf5f5ee(0x19ee)]===0x0)_0x1c26a3[_0xf5f5ee(0x33a)]=_0xf5f5ee(0x766);else{const _0x878f3=await db[_0xf5f5ee(0x14c4)][_0xf5f5ee(0xa24)]('id')[_0xf5f5ee(0x1fa1)](_0x11bf18)[_0xf5f5ee(0xf13)](),_0x3765fa=await Promise[_0xf5f5ee(0x1a47)](_0x878f3[_0xf5f5ee(0x1104)]((_0x563461,_0x368257)=>_0x368257[_0xf5f5ee(0x1716)]-_0x563461[_0xf5f5ee(0x1716)])['map'](async _0x4690f5=>{const _0x459417=_0xf5f5ee,_0x3e44dd=await db[_0x459417(0x1867)][_0x459417(0xa24)]('postId')['equals'](_0x4690f5['id'])['count']()>0x0;return _0x459417(0x12b5)+_0x4690f5['id']+_0x459417(0x1e9b)+_0x4690f5['title']+_0x459417(0xbe0)+(_0x3e44dd?'<svg\x20class=\x22image-post-badge\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M21\x2019V5c0-1.1-.9-2-2-2H5c-1.1\x200-2\x20.9-2\x202v14c0\x201.1.9\x202\x202\x202h14c1.1\x200\x202-.9\x202-2zM8.5\x2013.5l2.5\x203.01L14.5\x2012l4.5\x206H5l3.5-4.5z\x22/></svg>':'')+_0x459417(0x214e)+(_0x4690f5['isUserPost']?_0x459417(0x3d3):'')+_0x459417(0x2311)+_0x4690f5[_0x459417(0xa42)]+_0x459417(0x1212)+formatTime(_0x4690f5[_0x459417(0x1716)])+_0x459417(0x177e);}));_0x1c26a3[_0xf5f5ee(0x33a)]=_0x3765fa[_0xf5f5ee(0x122b)]('');}}async function backToCurrentForum(){const _0x1ff4d8=_0x211817;if(!currentForumId){hideApp(_0x1ff4d8(0x1002)),await renderForumArchives(),showApp('forum-screen');return;}const _0x1900a2=await db[_0x1ff4d8(0x2147)]['get'](parseInt(currentForumId));_0x1900a2?(document[_0x1ff4d8(0x1262)](_0x1ff4d8(0x1697))['innerText']=_0x1900a2[_0x1ff4d8(0x1a1c)],await renderForumPosts(currentForumId),showApp(_0x1ff4d8(0x14aa)),hideApp(_0x1ff4d8(0x1002))):(hideApp(_0x1ff4d8(0x1002)),await renderForumArchives(),showApp('forum-screen'));}function initializeForumApp(){const _0x38a826=_0x211817,_0x269a98=document['querySelector']('.mini-app[onclick*=\x22forum-screen\x22]');_0x269a98&&_0x269a98[_0x38a826(0x21e9)](_0x38a826(0x1859),async _0x3c524c=>{const _0x32e786=_0x38a826;_0x3c524c[_0x32e786(0x36f)](),_0x3c524c[_0x32e786(0x902)](),await renderForumArchives(),showApp(_0x32e786(0x149f));}),console[_0x38a826(0x2187)](_0x38a826(0x1b8e));}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x891d94=_0x211817,_0x2ce41f=document[_0x891d94(0x1262)](_0x891d94(0x63e));_0x2ce41f&&_0x2ce41f[_0x891d94(0x21e9)](_0x891d94(0x5af),function(_0x14a56e){const _0xa2d873=_0x891d94;if(_0x14a56e[_0xa2d873(0x193d)][_0xa2d873(0xf26)]&&_0x14a56e[_0xa2d873(0x193d)][_0xa2d873(0xf26)][0x0]){const _0x2390eb=_0x14a56e['target'][_0xa2d873(0xf26)][0x0],_0x5d51e4=new FileReader();_0x5d51e4[_0xa2d873(0xc55)]=function(_0x39066e){const _0x2eb78d=_0xa2d873,_0x7883e5=document[_0x2eb78d(0x1262)](_0x2eb78d(0x8f2));_0x7883e5&&(_0x7883e5[_0x2eb78d(0x45c)]=_0x39066e[_0x2eb78d(0x193d)][_0x2eb78d(0x4ee)]);},_0x5d51e4[_0xa2d873(0x127c)](_0x2390eb);}});}),document[_0x211817(0x21e9)]('DOMContentLoaded',function(){const _0x40dbaf=_0x211817;console['log'](_0x40dbaf(0x1456));if(typeof showPersonaSelectionForSingleChat==='function'){const _0x306c4=showPersonaSelectionForSingleChat;showPersonaSelectionForSingleChat=function(){_0x306c4(),setTimeout(()=>{const _0x25f27a=_0x167f,_0x1c2e95=document[_0x25f27a(0x1897)]('#persona-selection-modal\x20.persona-selection-item');console[_0x25f27a(0x2187)](_0x25f27a(0xdc6),_0x1c2e95[_0x25f27a(0x19ee)]),_0x1c2e95['forEach'](_0x5501d6=>{const _0x2e662d=_0x25f27a;_0x5501d6[_0x2e662d(0x1f36)]=null,_0x5501d6['addEventListener']('click',function(){const _0x44c77a=_0x2e662d;console['log'](_0x44c77a(0x218),this['dataset']['personaId']),document[_0x44c77a(0x1897)](_0x44c77a(0xc4a))[_0x44c77a(0x19fb)](_0x45d17c=>{const _0x4687e8=_0x44c77a;_0x45d17c[_0x4687e8(0x1c1b)]['remove'](_0x4687e8(0x176b));}),this[_0x44c77a(0x1c1b)][_0x44c77a(0x21e2)](_0x44c77a(0x176b)),window[_0x44c77a(0x22ff)]=this[_0x44c77a(0x1ecd)][_0x44c77a(0x131c)],console[_0x44c77a(0x2187)](_0x44c77a(0x14fa),window[_0x44c77a(0x22ff)]);const _0x2efcfc=document[_0x44c77a(0x1262)]('confirm-persona-btn');_0x2efcfc&&(_0x2efcfc[_0x44c77a(0x559)]=![]);});});},0x64);};}typeof confirmPersonaAndShowCharacters==='function'&&(confirmPersonaAndShowCharacters=function(){const _0x1ac9c5=_0x40dbaf;console['log'](_0x1ac9c5(0x9b0),window[_0x1ac9c5(0x22ff)]);if(!window['selectedPersonaForChat']){console['error']('身份ID为空！');return;}const _0x462467=window[_0x1ac9c5(0x22ff)],_0x42bdd6=document[_0x1ac9c5(0x1262)](_0x1ac9c5(0x861));_0x42bdd6&&_0x42bdd6[_0x1ac9c5(0x1493)](),window[_0x1ac9c5(0x22ff)]=_0x462467,console[_0x1ac9c5(0x2187)](_0x1ac9c5(0x1b4f),window[_0x1ac9c5(0x22ff)]),showCharacterSelectionForSingleChat();});if(typeof buildCharacterPrompt===_0x40dbaf(0xe59)){const _0x3d78e9=buildCharacterPrompt;buildCharacterPrompt=async function(_0x4eba8c,_0x245b70=![]){const _0x5a4d61=_0x40dbaf;let _0xe70307=await _0x3d78e9(_0x4eba8c,_0x245b70);const _0x1b1db5=getCurrentChatSettings();if(_0x1b1db5[_0x5a4d61(0x145e)]){const _0xc9ec8e=personas[_0x5a4d61(0xaf4)](_0x541c03=>_0x541c03['id']===_0x1b1db5[_0x5a4d61(0x145e)]);if(_0xc9ec8e){console[_0x5a4d61(0x2187)]('🔧\x20为角色',_0x4eba8c['name'],_0x5a4d61(0x1a0f),_0xc9ec8e['name']);const _0x4843d7=/\n\n# 对话者的角色设定：[\s\S]*?请根据用户的这个面具身份来进行对话。/;_0xe70307=_0xe70307['replace'](_0x4843d7,'');const _0x380dad=_0x5a4d61(0xfc5)+_0xc9ec8e[_0x5a4d61(0x1a1c)]+'\x22'+(_0xc9ec8e[_0x5a4d61(0x7c9)]?'：'+_0xc9ec8e[_0x5a4d61(0x7c9)]:'')+'\x0a请根据用户的这个面具身份来进行对话。',_0x4d9d14=_0xe70307[_0x5a4d61(0x13c5)](_0x5a4d61(0xb10));_0x4d9d14!==-0x1?_0xe70307=_0xe70307[_0x5a4d61(0x6d5)](0x0,_0x4d9d14)+_0x380dad+_0xe70307[_0x5a4d61(0x6d5)](_0x4d9d14):_0xe70307+=_0x380dad;}}return _0xe70307;};}console[_0x40dbaf(0x2187)](_0x40dbaf(0x1195));}),document['addEventListener'](_0x211817(0x20dc),function(){const _0x3b50b6=_0x211817;console[_0x3b50b6(0x2187)](_0x3b50b6(0x21e7));if(typeof window[_0x3b50b6(0x822)]===_0x3b50b6(0xe59)){const _0x3f5c5=window['createGroupChat'];window[_0x3b50b6(0x822)]=async function(_0x5378fc){const _0x4a18ea=_0x3b50b6;console['log'](_0x4a18ea(0xc2d),_0x5378fc),await _0x3f5c5[_0x4a18ea(0x18d1)](this,_0x5378fc);if(_0x5378fc&&groupChats&&groupChats[_0x4a18ea(0x19ee)]>0x0){const _0x29c888=groupChats[groupChats['length']-0x1],_0x2db8b7=localStorage[_0x4a18ea(0x15d8)](_0x4a18ea(0xa25)+_0x29c888['id']);if(_0x2db8b7)try{const _0x32abae=JSON[_0x4a18ea(0x22d3)](_0x2db8b7);window[_0x4a18ea(0x1789)][_0x29c888['id']]=_0x32abae,console[_0x4a18ea(0x2187)](_0x4a18ea(0x166e),_0x32abae);}catch(_0x300df5){console[_0x4a18ea(0x174a)](_0x4a18ea(0x178c),_0x300df5);}}};}console[_0x3b50b6(0x2187)](_0x3b50b6(0x1cb));}),(function(){'use strict';const _0x72e18d=_0x211817;console['log'](_0x72e18d(0x685));let _0x26e658=/iPad|iPhone|iPod/[_0x72e18d(0x11b8)](navigator[_0x72e18d(0x214b)]),_0x36887a=/Android/[_0x72e18d(0x11b8)](navigator[_0x72e18d(0x214b)]),_0x26de3a=_0x26e658||_0x36887a;if(!_0x26de3a){console[_0x72e18d(0x2187)](_0x72e18d(0x125c));return;}function _0x44429b(){const _0x158241=_0x72e18d;return document[_0x158241(0x1897)](_0x158241(0x20ef));}function _0x3c6c2d(){const _0x55e5b8=_0x72e18d,_0x3667f8=document[_0x55e5b8(0xb30)]('meta[name=\x22viewport\x22]');_0x3667f8&&_0x3667f8[_0x55e5b8(0x1058)](_0x55e5b8(0x211c),_0x55e5b8(0x52a));}function _0x4d3880(){const _0x45ccf0=_0x72e18d,_0x598761=document[_0x45ccf0(0xb30)](_0x45ccf0(0x14ea));_0x598761&&_0x598761[_0x45ccf0(0x1058)](_0x45ccf0(0x211c),_0x45ccf0(0x16e6));}function _0x55f261(_0x31556e){const _0x26028e=_0x72e18d;console[_0x26028e(0x2187)](_0x26028e(0x2d9)),_0x26e658&&_0x3c6c2d(),setTimeout(()=>{const _0x2103d2=_0x26028e;_0x31556e[_0x2103d2(0x193d)]['scrollIntoView']({'behavior':_0x2103d2(0x23b),'block':_0x2103d2(0xcef)});},0x12c);}function _0x4f2fd7(_0x2b9f56){const _0x5b7723=_0x72e18d;console[_0x5b7723(0x2187)](_0x5b7723(0x1d2a)),_0x26e658&&setTimeout(()=>{_0x4d3880();},0x64),setTimeout(()=>{const _0x37cbac=_0x5b7723;window[_0x37cbac(0x491)](0x0,0x0),document[_0x37cbac(0x1da9)][_0x37cbac(0x98c)]=0x0,document[_0x37cbac(0x204f)][_0x37cbac(0x98c)]=0x0;const _0x26d0ed=document[_0x37cbac(0x1262)]('phone-screen');_0x26d0ed&&(_0x26d0ed[_0x37cbac(0x14eb)][_0x37cbac(0x201e)]=_0x37cbac(0xed9),setTimeout(()=>{const _0xef4ba6=_0x37cbac;_0x26d0ed['style'][_0xef4ba6(0x201e)]='';},0xa)),document[_0x37cbac(0x1da9)][_0x37cbac(0x14eb)][_0x37cbac(0x4da)]=_0x37cbac(0x1fb7),document[_0x37cbac(0x1da9)][_0x37cbac(0x14eb)][_0x37cbac(0x1b5f)]=_0x37cbac(0xcef),document['body'][_0x37cbac(0x14eb)][_0x37cbac(0x19d2)]=_0x37cbac(0xcef);},0x12c);}function _0x31ac61(){const _0x1742ad=_0x72e18d,_0x2bd351=_0x44429b();console['log'](_0x1742ad(0x100d)+_0x2bd351[_0x1742ad(0x19ee)]+_0x1742ad(0x9a6)),_0x2bd351[_0x1742ad(0x19fb)](_0x1f90b6=>{const _0x13b0e7=_0x1742ad;_0x1f90b6[_0x13b0e7(0xa21)](_0x13b0e7(0x13cf),_0x55f261),_0x1f90b6[_0x13b0e7(0xa21)](_0x13b0e7(0xc53),_0x4f2fd7),_0x1f90b6[_0x13b0e7(0x21e9)]('focus',_0x55f261,{'passive':!![]}),_0x1f90b6[_0x13b0e7(0x21e9)]('blur',_0x4f2fd7,{'passive':!![]});const _0x23d6eb=window['getComputedStyle'](_0x1f90b6),_0x1199b1=parseInt(_0x23d6eb['fontSize']);_0x1199b1<0x10&&(_0x1f90b6['style'][_0x13b0e7(0x3f4)]='16px',console[_0x13b0e7(0x2187)](_0x13b0e7(0x10c5)));});}const _0x479e60=new MutationObserver(function(_0x3214b8){const _0x3abc26=_0x72e18d;let _0x33e782=![];_0x3214b8[_0x3abc26(0x19fb)](function(_0x2d89aa){const _0x5299fe=_0x3abc26;_0x2d89aa[_0x5299fe(0x1a4b)]===_0x5299fe(0x1ac7)&&_0x2d89aa['addedNodes']['forEach'](function(_0x12af47){const _0x113624=_0x5299fe;if(_0x12af47[_0x113624(0x5c2)]===0x1){if(_0x12af47[_0x113624(0x15ca)]&&(_0x12af47['matches']('textarea')||_0x12af47[_0x113624(0x15ca)](_0x113624(0x1823))))_0x33e782=!![];else{if(_0x12af47[_0x113624(0xb30)]){const _0x2dedba=_0x12af47[_0x113624(0x1897)](_0x113624(0x18b5));_0x2dedba[_0x113624(0x19ee)]>0x0&&(_0x33e782=!![]);}}}});}),_0x33e782&&(console[_0x3abc26(0x2187)]('📱\x20检测到新的输入框，重新绑定事件...'),setTimeout(_0x31ac61,0x64));});_0x479e60[_0x72e18d(0x8dd)](document[_0x72e18d(0x1da9)],{'childList':!![],'subtree':!![]});document[_0x72e18d(0x1269)]===_0x72e18d(0x1686)?document['addEventListener'](_0x72e18d(0x20dc),_0x31ac61):_0x31ac61();document[_0x72e18d(0x21e9)](_0x72e18d(0x20f0),function(){const _0xbdd08a=_0x72e18d;!document[_0xbdd08a(0xa52)]&&setTimeout(_0x31ac61,0x64);});let _0x2a9bf0=window[_0x72e18d(0x128a)],_0x88b8b4=![];function _0x116906(){const _0x836863=_0x72e18d,_0x4b707c=window['innerHeight'],_0x393dd6=_0x2a9bf0-_0x4b707c,_0x56ac73=_0x88b8b4;_0x88b8b4=_0x393dd6>0x96,console[_0x836863(0x2187)]('📱\x20Viewport变化:\x20'+_0x4b707c+_0x836863(0x165b)+_0x2a9bf0+_0x836863(0x1ac6)+_0x393dd6+_0x836863(0x1c23)+_0x88b8b4+')'),_0x56ac73&&!_0x88b8b4&&(console['log'](_0x836863(0x45d)),setTimeout(()=>{const _0x38df2b=_0x836863;window[_0x38df2b(0x491)](0x0,0x0),document['body'][_0x38df2b(0x98c)]=0x0,document[_0x38df2b(0x204f)][_0x38df2b(0x98c)]=0x0;const _0x3323b2=document[_0x38df2b(0x1262)]('phone-screen');_0x3323b2&&(_0x3323b2[_0x38df2b(0x14eb)][_0x38df2b(0x201e)]=_0x38df2b(0xed9),requestAnimationFrame(()=>{const _0x5d0b5a=_0x38df2b;_0x3323b2[_0x5d0b5a(0x14eb)][_0x5d0b5a(0x201e)]='';})),document['body'][_0x38df2b(0x14eb)]['height']=_0x38df2b(0x18a9),document[_0x38df2b(0x1da9)]['style'][_0x38df2b(0x4da)]=_0x38df2b(0x1fb7),document[_0x38df2b(0x1da9)][_0x38df2b(0x14eb)][_0x38df2b(0x1b5f)]=_0x38df2b(0xcef),document[_0x38df2b(0x1da9)][_0x38df2b(0x14eb)]['alignItems']='center';},0x64));}window[_0x72e18d(0x21e9)](_0x72e18d(0x1b7b),_0x116906,{'passive':!![]}),window[_0x72e18d(0x21e9)](_0x72e18d(0x1a5d),()=>{setTimeout(()=>{const _0xe52be2=_0x167f;_0x2a9bf0=window[_0xe52be2(0x128a)],_0x116906();},0x1f4);},{'passive':!![]}),console[_0x72e18d(0x2187)]('📱\x20[移动端优化]\x20输入框viewport行为修复已启动');}()),(function(){'use strict';const _0x4ab83a=_0x211817;console[_0x4ab83a(0x2187)](_0x4ab83a(0x179a)),console['log'](_0x4ab83a(0xf97));}());if(typeof blacklistData==='undefined')var blacklistData=[],friendRequestsData=[],characterStatusData=[];async function loadBlacklistData(){const _0x12326d=_0x211817;try{blacklistData=await db[_0x12326d(0x233)][_0x12326d(0xe30)]('timestamp')[_0x12326d(0x16b0)]()['toArray'](),console['log'](_0x12326d(0xfb6),blacklistData);}catch(_0xa52dd9){console[_0x12326d(0x174a)]('加载拉黑数据失败:',_0xa52dd9),blacklistData=[];}}function isBlocked(_0x144684,_0x1613ab){const _0x14c283=_0x211817;return blacklistData[_0x14c283(0x19fa)](_0x5c99c2=>_0x5c99c2[_0x14c283(0xbd7)]===_0x144684&&_0x5c99c2['blockedId']===_0x1613ab&&!_0x5c99c2[_0x14c283(0xf55)]);}async function blockCharacter(_0x2b6228,_0x1768a2=''){const _0x1c060f=_0x211817;try{const _0x1cdaa2=new Date();if(isBlocked(_0x1c060f(0xa80),_0x2b6228)){showToast(_0x1c060f(0x16b8),_0x1c060f(0x1816));return;}const _0x564a57={'id':_0x1c060f(0x21e3)+Date[_0x1c060f(0x2eb)]()+'_'+Math['random']()[_0x1c060f(0x1878)](0x24)[_0x1c060f(0x15fb)](0x2,0x9),'blockerId':_0x1c060f(0xa80),'blockedId':_0x2b6228,'timestamp':_0x1cdaa2[_0x1c060f(0x1034)](),'reason':_0x1768a2,'unblocked':![]};blacklistData[_0x1c060f(0x5ed)](_0x564a57),await db[_0x1c060f(0x233)][_0x1c060f(0x21e2)](_0x564a57);const _0x362076=characters[_0x1c060f(0xaf4)](_0x5c9234=>_0x5c9234['id']===_0x2b6228);showToast(_0x1c060f(0x11bb)+(_0x362076?.[_0x1c060f(0x1a1c)]||'角色'),_0x1c060f(0x11cb)),await notifyCharacterBlocked(_0x2b6228,_0x1768a2),currentChatCharacter&&currentChatCharacter['id']===_0x2b6228&&updateChatBlockedStatus(),renderContactList(),renderMessageList();}catch(_0x1caf1b){console[_0x1c060f(0x174a)](_0x1c060f(0x20e7),_0x1caf1b),showToast(_0x1c060f(0x8e8),_0x1c060f(0x174a));}}async function unblockCharacter(_0x2383fa){const _0x56261b=_0x211817;try{const _0x316e0b=blacklistData[_0x56261b(0xaf4)](_0x270b09=>_0x270b09['blockerId']===_0x56261b(0xa80)&&_0x270b09[_0x56261b(0x17d0)]===_0x2383fa&&!_0x270b09[_0x56261b(0xf55)]);if(!_0x316e0b){showToast('该角色未被拉黑',_0x56261b(0x1816));return;}_0x316e0b['unblocked']=!![],_0x316e0b['unblockTimestamp']=new Date()[_0x56261b(0x1034)](),await db[_0x56261b(0x233)][_0x56261b(0x1561)](_0x316e0b);const _0xb3a1b3=characters[_0x56261b(0xaf4)](_0x42b962=>_0x42b962['id']===_0x2383fa);showToast(_0x56261b(0x676)+(_0xb3a1b3?.[_0x56261b(0x1a1c)]||'角色')+'\x20的拉黑','success'),await notifyCharacterUnblocked(_0x2383fa),currentChatCharacter&&currentChatCharacter['id']===_0x2383fa&&(renderChatMessages(currentChatCharacter['id']),updateChatBlockedStatus()),renderContactList(),renderMessageList();}catch(_0x24ef52){console[_0x56261b(0x174a)](_0x56261b(0x1fb8),_0x24ef52),showToast(_0x56261b(0x1e4b),_0x56261b(0x174a));}}async function updateCharacterStatus(_0xda40d0,_0x3a954e,_0x10e623='',_0x4236d7=''){const _0x202cf3=_0x211817;try{let _0x3d798e=characterStatusData[_0x202cf3(0xaf4)](_0x4a46e0=>_0x4a46e0[_0x202cf3(0xaf5)]===_0xda40d0);if(!_0x3d798e)_0x3d798e={'id':_0x202cf3(0xc0a)+_0xda40d0,'characterId':_0xda40d0,'status':_0x3a954e,'activity':_0x10e623,'location':_0x4236d7,'lastUpdate':new Date()[_0x202cf3(0x1034)](),'lastChatTime':null},characterStatusData[_0x202cf3(0x1cd6)](_0x3d798e);else{const _0x4ff7c9=_0x3d798e[_0x202cf3(0x13af)];_0x3d798e['status']=_0x3a954e,_0x3d798e[_0x202cf3(0x16f6)]=_0x10e623,_0x3d798e[_0x202cf3(0x2184)]=_0x4236d7,_0x3d798e['lastUpdate']=new Date()[_0x202cf3(0x1034)](),_0x3d798e['lastChatTime']=_0x4ff7c9;}await db[_0x202cf3(0x793)][_0x202cf3(0x1561)](_0x3d798e);}catch(_0xec64bb){console[_0x202cf3(0x174a)](_0x202cf3(0x15f1),_0xec64bb);}}function getCharacterStatus(_0x31b321){const _0x1afb10=_0x211817;return characterStatusData['find'](_0x189084=>_0x189084[_0x1afb10(0xaf5)]===_0x31b321)||{'status':_0x1afb10(0x38b),'activity':'在线','location':'','lastUpdate':new Date()['toISOString'](),'lastChatTime':null};}async function aiBlockUser(_0x32f465,_0x335a08=''){const _0x3911c7=_0x211817;try{const _0x519d21=new Date();if(isBlocked(_0x32f465,_0x3911c7(0xa80)))return;const _0x3b4e7f={'id':_0x3911c7(0x21e3)+Date[_0x3911c7(0x2eb)]()+'_'+Math[_0x3911c7(0x11a8)]()[_0x3911c7(0x1878)](0x24)['substr'](0x2,0x9),'blockerId':_0x32f465,'blockedId':_0x3911c7(0xa80),'timestamp':_0x519d21[_0x3911c7(0x1034)](),'reason':_0x335a08,'unblocked':![]};blacklistData[_0x3911c7(0x5ed)](_0x3b4e7f),await db[_0x3911c7(0x233)][_0x3911c7(0x21e2)](_0x3b4e7f);currentChatCharacter&&currentChatCharacter['id']===_0x32f465&&updateChatBlockedStatus();const _0x578888=characters['find'](_0x39c8a3=>_0x39c8a3['id']===_0x32f465);showToast((_0x578888?.[_0x3911c7(0x1a1c)]||'角色')+_0x3911c7(0x275),_0x3911c7(0x1816));}catch(_0x2ef1f6){console['error']('角色拉黑用户失败:',_0x2ef1f6);}}async function sendFriendRequest(_0x429288,_0x33ca5e=''){const _0x12c09b=_0x211817;try{const _0xf3804e={'id':'request_'+Date[_0x12c09b(0x2eb)]()+'_'+Math[_0x12c09b(0x11a8)]()[_0x12c09b(0x1878)](0x24)['substr'](0x2,0x9),'fromId':_0x12c09b(0xa80),'toId':_0x429288,'timestamp':new Date()[_0x12c09b(0x1034)](),'status':_0x12c09b(0x37b),'type':_0x12c09b(0x1986),'message':_0x33ca5e};friendRequestsData[_0x12c09b(0x5ed)](_0xf3804e),await db[_0x12c09b(0x123d)][_0x12c09b(0x21e2)](_0xf3804e),showToast(_0x12c09b(0x136f),_0x12c09b(0x11cb));}catch(_0x5dc294){console[_0x12c09b(0x174a)](_0x12c09b(0x152a),_0x5dc294),showToast(_0x12c09b(0xa1d),_0x12c09b(0x174a));}}function updateChatBlockedStatus(){const _0x364541=_0x211817;if(!currentChatCharacter)return;const _0x1d11fe=currentChatCharacter['id'],_0x533e9b=currentChatCharacter[_0x364541(0x1f68)],_0x338429=document[_0x364541(0xb30)]('.blocked-input-notice');_0x338429&&_0x338429[_0x364541(0x1493)]();const _0x53da63=document[_0x364541(0xb30)](_0x364541(0xab6));_0x53da63&&_0x53da63[_0x364541(0x1493)]();if(!_0x533e9b){const _0x105085=isBlocked(_0x364541(0xa80),_0x1d11fe),_0x1dc59e=isBlocked(_0x1d11fe,_0x364541(0xa80));if(_0x1dc59e){const _0x5d1d06=document[_0x364541(0xb30)](_0x364541(0x2f5));if(_0x5d1d06){const _0x3e9c9e=document['createElement'](_0x364541(0xbbc));_0x3e9c9e[_0x364541(0x1722)]=_0x364541(0x16ec),_0x3e9c9e[_0x364541(0x33a)]=_0x364541(0xbe1)+currentChatCharacter[_0x364541(0x1a1c)]+_0x364541(0x4c7),_0x5d1d06['appendChild'](_0x3e9c9e);}addCharacterBlockedHint(_0x1d11fe);}renderChatMessages(_0x1d11fe);}}function addCharacterBlockedHint(_0x32fdbe){const _0x23e2ce=_0x211817,_0x3cea1c=document[_0x23e2ce(0x1262)]('chat-messages');if(!_0x3cea1c)return;const _0x27eb56=_0x3cea1c['querySelector'](_0x23e2ce(0xab6));_0x27eb56&&_0x27eb56[_0x23e2ce(0x1493)]();const _0x247cd7=document[_0x23e2ce(0xac6)](_0x23e2ce(0xbbc));_0x247cd7[_0x23e2ce(0x1722)]='character-blocked-hint',_0x247cd7[_0x23e2ce(0x14eb)][_0x23e2ce(0x1f87)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2020px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2015px\x2020px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(255,\x20193,\x207,\x200.1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20rgba(255,\x20193,\x207,\x200.3);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20320px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#856404;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2013px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201.4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x247cd7[_0x23e2ce(0x33a)]=_0x23e2ce(0x370)+currentChatCharacter[_0x23e2ce(0x1a1c)]+_0x23e2ce(0x17f9),_0x3cea1c['insertBefore'](_0x247cd7,_0x3cea1c[_0x23e2ce(0xb60)]);}function checkAndCreateBlockedSystemMessage(_0x4e5873,_0x5b32a2){const _0x54bcd8=_0x211817;if(!currentChatCharacter||currentChatCharacter[_0x54bcd8(0x1f68)])return;const _0x3d9222=isBlocked(_0x5b32a2,_0x54bcd8(0xa80));if(_0x3d9222){const _0x2ed6f3=document[_0x54bcd8(0x1262)]('api-chat-messages'),_0x2c5794=document[_0x54bcd8(0xac6)](_0x54bcd8(0xbbc));_0x2c5794[_0x54bcd8(0x1722)]=_0x54bcd8(0xb7a),_0x2c5794[_0x54bcd8(0x14eb)][_0x54bcd8(0x1f87)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x204px\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x202px\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20transparent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20fit-content;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-left:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-right:\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2c5794[_0x54bcd8(0x13be)]=_0x54bcd8(0x131b),_0x2ed6f3[_0x54bcd8(0x497)](_0x2c5794),setTimeout(()=>{const _0x37e498=_0x54bcd8;_0x2ed6f3[_0x37e498(0x98c)]=_0x2ed6f3[_0x37e498(0xfe3)];},0x64);}}function cleanupBlockedSystemMessages(){const _0x547fc6=_0x211817;let _0x386058=![];Object[_0x547fc6(0x1c9f)](chatMessages)[_0x547fc6(0x19fb)](_0x1d72fb=>{const _0x5ad48d=_0x547fc6,_0x5d5ba8=chatMessages[_0x1d72fb],_0x22a1cb=_0x5d5ba8[_0x5ad48d(0x19ee)];chatMessages[_0x1d72fb]=_0x5d5ba8['filter'](_0x66e827=>!(_0x66e827[_0x5ad48d(0x8a1)]==='system'&&_0x66e827[_0x5ad48d(0x1144)])),chatMessages[_0x1d72fb][_0x5ad48d(0x19ee)]!==_0x22a1cb&&(_0x386058=!![],console[_0x5ad48d(0x2187)]('🧹\x20[清理]\x20从角色\x20'+_0x1d72fb+'\x20的聊天记录中移除了\x20'+(_0x22a1cb-chatMessages[_0x1d72fb][_0x5ad48d(0x19ee)])+_0x5ad48d(0x1029)));}),_0x386058&&(saveChatMessages(),console[_0x547fc6(0x2187)]('🧹\x20[清理]\x20拉黑系统消息清理完成，已保存到数据库'));}function addBlockedIndicatorToMessage(_0x5b57fe,_0x372949,_0x328444){const _0x1c05ef=_0x211817;if(!currentChatCharacter)return;if(_0x372949['type']===_0x1c05ef(0x2051))return;const _0x32b31a=_0x372949[_0x1c05ef(0x1716)];let _0x52fa28=![],_0x4fe019=null;if(_0x372949[_0x1c05ef(0x8a1)]===_0x1c05ef(0x1e6d)){const _0xc15598=blacklistData[_0x1c05ef(0xaf4)](_0x203d79=>_0x203d79['blockerId']===_0x328444&&_0x203d79[_0x1c05ef(0x17d0)]===_0x1c05ef(0xa80));if(_0xc15598){_0x4fe019=new Date(_0xc15598[_0x1c05ef(0x1716)])[_0x1c05ef(0x704)]();const _0x47a3da=_0xc15598['unblocked']&&_0xc15598[_0x1c05ef(0x10d5)]?new Date(_0xc15598[_0x1c05ef(0x10d5)])[_0x1c05ef(0x704)]():Date[_0x1c05ef(0x2eb)]();_0x52fa28=_0x32b31a>=_0x4fe019&&(_0x32b31a<=_0x47a3da||!_0xc15598[_0x1c05ef(0xf55)]);}}else{if(_0x372949[_0x1c05ef(0x8a1)]===_0x1c05ef(0xb11)){const _0x2ed3d2=blacklistData[_0x1c05ef(0xaf4)](_0x74206b=>_0x74206b[_0x1c05ef(0xbd7)]===_0x1c05ef(0xa80)&&_0x74206b[_0x1c05ef(0x17d0)]===_0x328444);if(_0x2ed3d2){_0x4fe019=new Date(_0x2ed3d2['timestamp'])[_0x1c05ef(0x704)]();const _0x25cec5=_0x2ed3d2['unblocked']&&_0x2ed3d2[_0x1c05ef(0x10d5)]?new Date(_0x2ed3d2[_0x1c05ef(0x10d5)])['getTime']():Date['now']();_0x52fa28=_0x32b31a>=_0x4fe019&&(_0x32b31a<=_0x25cec5||!_0x2ed3d2[_0x1c05ef(0xf55)]);}}}if(_0x52fa28){const _0xc33722=_0x5b57fe['querySelector'](_0x1c05ef(0x1afc)),_0x1e4068=_0x5b57fe['nextElementSibling']?.['classList'][_0x1c05ef(0x971)](_0x1c05ef(0x19ef));if(_0xc33722&&_0x1e4068)return;if(!_0xc33722){const _0x31cc57=document[_0x1c05ef(0xac6)](_0x1c05ef(0xbbc));_0x31cc57[_0x1c05ef(0x1722)]=_0x1c05ef(0x1106),_0x31cc57['innerHTML']='!',_0x31cc57[_0x1c05ef(0x378)]=_0x1c05ef(0x131b),_0x5b57fe[_0x1c05ef(0x14eb)][_0x1c05ef(0xbc7)]=_0x1c05ef(0x18dc),_0x5b57fe['appendChild'](_0x31cc57),setTimeout(()=>{const _0x4e9d8b=_0x1c05ef,_0x396d85=_0x5b57fe[_0x4e9d8b(0xb30)](_0x4e9d8b(0xa99));if(_0x396d85){const _0x52ab95=_0x5b57fe['getBoundingClientRect'](),_0x3a4aec=_0x396d85[_0x4e9d8b(0x1fc0)]();if(_0x372949[_0x4e9d8b(0x8a1)]==='sent'){const _0x3adf15=_0x3a4aec['left']-_0x52ab95[_0x4e9d8b(0x15dc)];_0x31cc57[_0x4e9d8b(0x14eb)][_0x4e9d8b(0x15dc)]=_0x3adf15-0x14+'px',_0x31cc57['style'][_0x4e9d8b(0x117c)]=_0x4e9d8b(0x1033);}else{if(_0x372949[_0x4e9d8b(0x8a1)]===_0x4e9d8b(0xb11)){const _0x2e6ffd=_0x3a4aec['right']-_0x52ab95[_0x4e9d8b(0x15dc)];_0x31cc57['style']['left']=_0x2e6ffd+0x3+'px',_0x31cc57['style'][_0x4e9d8b(0x117c)]=_0x4e9d8b(0x1033);}}}},0xa);}if(!_0x1e4068){const _0x371912=document[_0x1c05ef(0xac6)](_0x1c05ef(0xbbc));_0x371912[_0x1c05ef(0x1722)]='blocked-message-hint-inline',_0x371912[_0x1c05ef(0x14eb)]['cssText']=_0x1c05ef(0x1db6),_0x371912[_0x1c05ef(0x13be)]=_0x1c05ef(0x131b),_0x5b57fe[_0x1c05ef(0x148c)][_0x1c05ef(0x1f04)](_0x371912,_0x5b57fe[_0x1c05ef(0x1b0a)]);}}}function showBlacklistSettings(){const _0x3fb55a=_0x211817;if(!currentChatCharacter){showToast('请先选择一个角色',_0x3fb55a(0x1816));return;}const _0x57abea=currentChatCharacter['id'],_0x11931d=currentChatCharacter['isGroup'];if(_0x11931d)showGroupMuteSettings(_0x57abea);else{const _0x4c51e5=isBlocked(_0x3fb55a(0xa80),_0x57abea),_0x1ad333=document['getElementById'](_0x3fb55a(0x1483)),_0x52edb4=document[_0x3fb55a(0x1262)](_0x3fb55a(0xf25)),_0x4caaa4=document[_0x3fb55a(0x1262)](_0x3fb55a(0x1603));_0x4c51e5?(_0x1ad333[_0x3fb55a(0x13be)]=_0x3fb55a(0x96f),_0x52edb4[_0x3fb55a(0x13be)]=_0x3fb55a(0x1915),_0x4caaa4['textContent']=_0x3fb55a(0x1730)):(_0x1ad333[_0x3fb55a(0x13be)]=_0x3fb55a(0x1cea),_0x52edb4[_0x3fb55a(0x13be)]=_0x3fb55a(0xa30),_0x4caaa4['textContent']=_0x3fb55a(0x172a)),document[_0x3fb55a(0x1262)](_0x3fb55a(0x1f84))['style']['display']=_0x3fb55a(0x1fb7);}}function updateBlockManageLabel(_0x11c155){const _0x338528=_0x211817,_0x444e0b=document[_0x338528(0x1262)]('block-manage-label'),_0x3f6b03=document['getElementById'](_0x338528(0x2252));_0x444e0b&&_0x3f6b03&&(_0x11c155?(_0x444e0b['textContent']=_0x338528(0x1aba),_0x3f6b03['textContent']=_0x338528(0xf47)):(_0x444e0b[_0x338528(0x13be)]=_0x338528(0x14a5),_0x3f6b03[_0x338528(0x13be)]=_0x338528(0xfaa)));}function showGroupMuteSettings(_0x32cce7){const _0x4ad683=_0x211817,_0x57b178=isGroupMuted(_0x32cce7),_0x3afec2=document['getElementById'](_0x4ad683(0x1483)),_0x4a3b87=document[_0x4ad683(0x1262)]('block-action-label'),_0x1dc05d=document['getElementById']('block-action-desc');_0x57b178?(_0x3afec2[_0x4ad683(0x13be)]=_0x4ad683(0x2ff),_0x4a3b87[_0x4ad683(0x13be)]=_0x4ad683(0x17af),_0x1dc05d[_0x4ad683(0x13be)]=_0x4ad683(0x583)):(_0x3afec2[_0x4ad683(0x13be)]=_0x4ad683(0x1f00),_0x4a3b87['textContent']=_0x4ad683(0x1d2d),_0x1dc05d[_0x4ad683(0x13be)]=_0x4ad683(0x1b18)),document['getElementById'](_0x4ad683(0x1f84))['style'][_0x4ad683(0x4da)]='flex';}function isGroupMuted(_0x3511ef){const _0x2dc640=_0x211817,_0x13d380=JSON[_0x2dc640(0x22d3)](localStorage[_0x2dc640(0x15d8)](_0x2dc640(0x1ed5))||'[]');return _0x13d380[_0x2dc640(0x1831)](_0x3511ef);}function toggleGroupMute(_0x2c21cc){const _0x50033a=_0x211817,_0x3b2930=JSON[_0x50033a(0x22d3)](localStorage[_0x50033a(0x15d8)](_0x50033a(0x1ed5))||'[]'),_0x3b275e=_0x3b2930[_0x50033a(0x1831)](_0x2c21cc);if(_0x3b275e){const _0x289e43=_0x3b2930['indexOf'](_0x2c21cc);_0x289e43>-0x1&&_0x3b2930['splice'](_0x289e43,0x1),showToast(_0x50033a(0x258)+currentChatCharacter?.[_0x50033a(0x1a1c)],_0x50033a(0x11cb));}else _0x3b2930[_0x50033a(0x1cd6)](_0x2c21cc),showToast('已屏蔽\x20'+currentChatCharacter?.[_0x50033a(0x1a1c)],_0x50033a(0x477));localStorage[_0x50033a(0x192)](_0x50033a(0x1ed5),JSON['stringify'](_0x3b2930)),renderContactList(),hideBlacklistSettings();}function hideBlacklistSettings(){const _0x192210=_0x211817;document[_0x192210(0x1262)](_0x192210(0x1f84))[_0x192210(0x14eb)][_0x192210(0x4da)]=_0x192210(0x102b);}function showFriendRequestModal(){const _0x40a3e0=_0x211817;if(!currentChatCharacter)return;document[_0x40a3e0(0x1262)](_0x40a3e0(0x174c))[_0x40a3e0(0x1ebc)]='',document[_0x40a3e0(0x1262)](_0x40a3e0(0xb76))[_0x40a3e0(0x14eb)][_0x40a3e0(0x4da)]=_0x40a3e0(0x1fb7);}function hideFriendRequestModal(){const _0x29b205=_0x211817;document[_0x29b205(0x1262)](_0x29b205(0xb76))[_0x29b205(0x14eb)][_0x29b205(0x4da)]=_0x29b205(0x102b);}async function sendFriendRequestConfirm(){const _0x20bb8a=_0x211817;if(!currentChatCharacter)return;const _0x32cb0d=document['getElementById'](_0x20bb8a(0x174c))[_0x20bb8a(0x1ebc)][_0x20bb8a(0x19d7)](),_0x19e35e=currentChatCharacter['id'];await sendFriendRequest(_0x19e35e,_0x32cb0d),hideFriendRequestModal(),showToast('申请已发送，等待对方回应...',_0x20bb8a(0x477)),await processAIFriendRequestResponse(_0x19e35e,_0x32cb0d);}function isRecentFriendRequestSpam(_0x3cd45d){const _0xf3c70a=_0x211817;if(!_0x3cd45d||!chatMessages[_0x3cd45d])return![];const _0x5ddc83=chatMessages[_0x3cd45d],_0x288b39=Date[_0xf3c70a(0x2eb)](),_0x2983dd=0x5*0x3c*0x3e8;for(let _0x113d85=_0x5ddc83['length']-0x1;_0x113d85>=0x0;_0x113d85--){const _0x442e77=_0x5ddc83[_0x113d85];if(_0x442e77['type']===_0xf3c70a(0x2051)&&_0x442e77[_0xf3c70a(0x8a1)]===_0xf3c70a(0xb11)){const _0x2d5e2f=_0x288b39-_0x442e77[_0xf3c70a(0x1716)];if(_0x2d5e2f<_0x2983dd&&!_0x442e77[_0xf3c70a(0x1237)])return console[_0xf3c70a(0x2187)](_0xf3c70a(0xcb2)),!![];break;}}return![];}async function handleAIFriendRequest(_0x548aa4,_0x118a43,_0x3c2094){const _0x46b9cc=_0x211817;if(!currentChatCharacter||currentChatCharacter['id']!==_0x548aa4)return;try{const _0x2138e7=document[_0x46b9cc(0xb30)]('[data-message-id=\x22'+_0x3c2094+'\x22]\x20.friend-request-card');if(_0x2138e7){const _0x18a3bf=_0x2138e7[_0x46b9cc(0xb30)](_0x46b9cc(0x1d7b));if(_0x18a3bf){const _0x3993db=_0x118a43?_0x46b9cc(0x1650):_0x46b9cc(0x17d8),_0x2be567=_0x118a43?_0x46b9cc(0xdfc):'rejected';_0x18a3bf[_0x46b9cc(0x33a)]=_0x46b9cc(0xcb4)+_0x2be567+'\x22>'+_0x3993db+_0x46b9cc(0x1844);}}if(_0x118a43){await unblockCharacter(_0x548aa4);!chatMessages[_0x548aa4]&&(chatMessages[_0x548aa4]=[]);const _0x4635b4=chatMessages[_0x548aa4][_0x46b9cc(0x150c)](_0x403700=>_0x403700['id']===_0x3c2094);_0x4635b4!==-0x1?(chatMessages[_0x548aa4][_0x4635b4][_0x46b9cc(0x1237)]=!![],chatMessages[_0x548aa4][_0x4635b4][_0x46b9cc(0x2ca)]=!![],console[_0x46b9cc(0x2187)]('✅\x20标记好友申请消息为已同意:',_0x3c2094)):console[_0x46b9cc(0x174a)](_0x46b9cc(0x12c1),_0x3c2094);const _0x5dce8c={'id':Date['now']()[_0x46b9cc(0x1878)](),'sender':_0x46b9cc(0x1744),'content':_0x46b9cc(0x2219),'timestamp':Date[_0x46b9cc(0x2eb)](),'role':_0x46b9cc(0x1744)};chatMessages[_0x548aa4][_0x46b9cc(0x1cd6)](_0x5dce8c);try{await saveChatMessagesImmediate([_0x548aa4]),console[_0x46b9cc(0x2187)]('✅\x20[高效好友申请接受]\x20消息已保存到数据库');}catch(_0x17eff3){console[_0x46b9cc(0x174a)](_0x46b9cc(0xc62),_0x17eff3),await saveChatMessages();}renderChatMessages(_0x548aa4),updateChatBlockedStatus();}else{!chatMessages[_0x548aa4]&&(chatMessages[_0x548aa4]=[]);const _0x1074ed=chatMessages[_0x548aa4][_0x46b9cc(0x150c)](_0x1c63b6=>_0x1c63b6['id']===_0x3c2094);_0x1074ed!==-0x1?(chatMessages[_0x548aa4][_0x1074ed]['friendRequestProcessed']=!![],chatMessages[_0x548aa4][_0x1074ed][_0x46b9cc(0x2ca)]=![],console['log']('✅\x20标记好友申请消息为已拒绝:',_0x3c2094)):console[_0x46b9cc(0x174a)](_0x46b9cc(0x12c1),_0x3c2094);const _0x25bf35={'id':Date['now']()[_0x46b9cc(0x1878)](),'sender':_0x46b9cc(0x1744),'content':_0x46b9cc(0x12d1),'timestamp':Date['now'](),'role':_0x46b9cc(0x1744)};chatMessages[_0x548aa4][_0x46b9cc(0x1cd6)](_0x25bf35);try{await saveChatMessagesImmediate([_0x548aa4]),console[_0x46b9cc(0x2187)](_0x46b9cc(0x18bb));}catch(_0x432408){console['error'](_0x46b9cc(0xcbe),_0x432408),await saveChatMessages();}renderChatMessages(_0x548aa4),window[_0x46b9cc(0x93a)]&&window[_0x46b9cc(0x93a)](_0x548aa4);}}catch(_0x150f52){console[_0x46b9cc(0x174a)](_0x46b9cc(0x8c4),_0x150f52),showToast(_0x46b9cc(0x1250),'error');}}function performBlockAction(){const _0x2d3758=_0x211817;if(!currentChatCharacter)return;const _0x2beeac=currentChatCharacter['id'],_0x55242f=currentChatCharacter['isGroup'];if(_0x55242f){const _0x365d3c=isGroupMuted(_0x2beeac);_0x365d3c?confirm(_0x2d3758(0x115c)+currentChatCharacter['name']+_0x2d3758(0xe60))&&toggleGroupMute(_0x2beeac):confirm(_0x2d3758(0x1c1f)+currentChatCharacter[_0x2d3758(0x1a1c)]+_0x2d3758(0x200d))&&toggleGroupMute(_0x2beeac);}else{const _0x5313b7=isBlocked('user',_0x2beeac);_0x5313b7?confirm(_0x2d3758(0xc85)+currentChatCharacter[_0x2d3758(0x1a1c)]+_0x2d3758(0xc42))&&(unblockCharacter(_0x2beeac),hideBlacklistSettings()):confirm('确定要拉黑\x20'+currentChatCharacter[_0x2d3758(0x1a1c)]+'\x20吗？')&&(blockCharacter(_0x2beeac,''),hideBlacklistSettings());}}document['addEventListener'](_0x211817(0x20dc),async function(){setTimeout(async()=>{const _0x218e00=_0x167f;try{await Promise[_0x218e00(0x1a47)]([loadBlacklistData(),loadFriendRequestsData(),loadCharacterStatusData()]),console[_0x218e00(0x2187)](_0x218e00(0x17d9));}catch(_0x3c1e5c){console['error']('拉黑系统数据加载失败:',_0x3c1e5c);}},0x3e8);});async function loadFriendRequestsData(){const _0x19dbc8=_0x211817;try{friendRequestsData=await db['friendRequests']['orderBy'](_0x19dbc8(0x1716))[_0x19dbc8(0x16b0)]()[_0x19dbc8(0xf13)](),console[_0x19dbc8(0x2187)](_0x19dbc8(0xb03),friendRequestsData);}catch(_0x2f4abc){console[_0x19dbc8(0x174a)](_0x19dbc8(0xd1a),_0x2f4abc),friendRequestsData=[];}}async function loadCharacterStatusData(){const _0x36fd5b=_0x211817;try{characterStatusData=await db[_0x36fd5b(0x793)][_0x36fd5b(0xf13)](),console[_0x36fd5b(0x2187)](_0x36fd5b(0x802),characterStatusData);}catch(_0xa4c8ea){console[_0x36fd5b(0x174a)](_0x36fd5b(0x969),_0xa4c8ea),characterStatusData=[];}}function renderCharacterStatus(_0x546ba8,_0x3bb13f){const _0x124d05=_0x211817,_0x7459d0=getCurrentChatSettings();if(!_0x7459d0[_0x124d05(0x22aa)]){if(_0x3bb13f){const _0x375a62=_0x3bb13f[_0x124d05(0xb30)](_0x124d05(0x12c2));_0x375a62&&_0x375a62[_0x124d05(0x1493)]();}return;}const _0x5ca014=getCharacterStatus(_0x546ba8),_0x13f757=isBlocked(_0x124d05(0xa80),_0x546ba8),_0x517252=isBlocked(_0x546ba8,_0x124d05(0xa80));let _0x467414=_0x124d05(0x38b),_0x34da17=_0x5ca014[_0x124d05(0x16f6)]||'在线';if(_0x13f757||_0x517252)_0x467414='blocked',_0x34da17=_0x124d05(0xb92);else _0x5ca014[_0x124d05(0x12e2)]===_0x124d05(0x1c5b)&&(_0x467414=_0x124d05(0x1c5b));const _0x38af5f=_0x124d05(0x957)+_0x467414+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22status-text\x22>'+_0x34da17+_0x124d05(0x7ea);if(_0x3bb13f){const _0x1a8577=_0x3bb13f[_0x124d05(0xb30)](_0x124d05(0x12c2));_0x1a8577&&_0x1a8577['remove']();if(_0x3bb13f[_0x124d05(0x1c1b)][_0x124d05(0x971)](_0x124d05(0xf28)))_0x3bb13f[_0x124d05(0x1b7)](_0x124d05(0x42e),_0x38af5f);else{if(_0x3bb13f[_0x124d05(0x1c1b)][_0x124d05(0x971)](_0x124d05(0x47b))){const _0x3c60d6=_0x3bb13f['querySelector'](_0x124d05(0xed2));_0x3c60d6?_0x3c60d6[_0x124d05(0x1b7)](_0x124d05(0x1a1b),_0x38af5f):_0x3bb13f[_0x124d05(0x1b7)](_0x124d05(0x42e),_0x38af5f);}else _0x3bb13f[_0x124d05(0x1b7)]('beforeend',_0x38af5f);}}}async function generateCharacterStatus(_0x870c28){const _0x5d34a6=_0x211817;try{const _0x1cc0a0=characters['find'](_0x1978c3=>_0x1978c3['id']===_0x870c28);if(!_0x1cc0a0)return;const _0x3ec2cd=await getAsyncChatSettings(_0x870c28),_0x10091e=chatMessages[_0x870c28]||[],_0x982653=_0x10091e[_0x5d34a6(0x6d5)](-0x5);let _0x395e64='';if(_0x982653['length']>0x0){const _0x2bcda2=getCurrentPersonaName();_0x395e64=_0x5d34a6(0x8df)+_0x982653['map'](_0x317627=>{const _0x41d7f3=_0x5d34a6;if(_0x317627[_0x41d7f3(0x8a1)]===_0x41d7f3(0x1e6d))return _0x2bcda2+'：'+_0x317627[_0x41d7f3(0x211c)];if(_0x317627[_0x41d7f3(0x8a1)]===_0x41d7f3(0xb11))return _0x1cc0a0[_0x41d7f3(0x1a1c)]+'：'+_0x317627[_0x41d7f3(0x211c)];return'';})[_0x5d34a6(0x1e1f)](Boolean)[_0x5d34a6(0x122b)]('\x0a')+'\x0a\x0a';}let _0x173485='';if(_0x3ec2cd?.['linkedWorldBookIds']&&_0x3ec2cd[_0x5d34a6(0xe99)][_0x5d34a6(0x19ee)]>0x0)try{const _0x490645=await Promise[_0x5d34a6(0x1a47)](_0x3ec2cd[_0x5d34a6(0xe99)][_0x5d34a6(0x6a4)](_0x293ace=>db[_0x5d34a6(0x21f8)]['get'](_0x293ace))),_0x40a614=_0x490645[_0x5d34a6(0x1e1f)](_0x291bd1=>_0x291bd1&&_0x291bd1[_0x5d34a6(0x211c)]);_0x40a614[_0x5d34a6(0x19ee)]>0x0&&(_0x173485='背景设定：\x0a'+_0x40a614[_0x5d34a6(0x6a4)](_0x24c718=>_0x24c718[_0x5d34a6(0x1a1c)]+'：'+_0x24c718[_0x5d34a6(0x211c)])[_0x5d34a6(0x122b)]('\x0a\x0a')+'\x0a\x0a');}catch(_0x4421fa){console[_0x5d34a6(0x174a)](_0x5d34a6(0x144e),_0x4421fa);}const _0x7ba116=Math[_0x5d34a6(0x11a8)]()<0.5?_0x5d34a6(0x16f6):'mood';let _0x519546;_0x7ba116===_0x5d34a6(0x16f6)?_0x519546='你是'+_0x1cc0a0[_0x5d34a6(0x1a1c)]+_0x5d34a6(0x1032)+_0x1cc0a0[_0x5d34a6(0x1f0b)]+'\x0a\x0a'+_0x173485+_0x395e64+'请根据你的人设、当前剧情和聊天记录，生成一个符合你当前状况的活动状态。要求：\x0a1.\x2010-20字内，简洁明了\x0a2.\x20符合你的性格和身份设定\x0a3.\x20基于最近的聊天内容或剧情发展\x0a4.\x20格式：在[地点][做什么]\x0a5.\x20要真实反映角色当下可能在做的事情\x0a6.\x20如果没有具体聊天记录，则根据人设推测合理的日常活动\x0a\x0a示例格式：在图书馆整理资料、在训练场练习剑术、在房间里沉思、在花园中散步等\x0a\x0a请生成一个活动状态：':_0x519546='你是'+_0x1cc0a0[_0x5d34a6(0x1a1c)]+_0x5d34a6(0x1032)+_0x1cc0a0[_0x5d34a6(0x1f0b)]+'\x0a\x0a'+_0x173485+_0x395e64+_0x5d34a6(0x1e63);const _0x4c2a19=await generateAIResponse(_0x519546,_0x1cc0a0);if(_0x4c2a19&&_0x4c2a19[_0x5d34a6(0x19d7)]()){const _0x57fe95=_0x4c2a19['trim']()[_0x5d34a6(0xe16)](/^["""''「」『』【】]|["""''「」『』【】]$/g,'');await updateCharacterStatus(_0x870c28,'online',_0x57fe95),console[_0x5d34a6(0x2187)]('为'+_0x1cc0a0[_0x5d34a6(0x1a1c)]+'生成'+(_0x7ba116==='activity'?'活动':'心情')+_0x5d34a6(0x563)+_0x57fe95);}else{const _0x57eba6=generateFallbackStatus(_0x1cc0a0,_0x7ba116);await updateCharacterStatus(_0x870c28,_0x5d34a6(0x38b),_0x57eba6),console[_0x5d34a6(0x2187)]('为'+_0x1cc0a0[_0x5d34a6(0x1a1c)]+_0x5d34a6(0xf92)+(_0x7ba116===_0x5d34a6(0x16f6)?'活动':'心情')+'状态:\x20'+_0x57eba6);}}catch(_0x6d554b){console[_0x5d34a6(0x174a)](_0x5d34a6(0x17a6),_0x6d554b);const _0x48f5d4=generateFallbackStatus(character,_0x5d34a6(0x16f6));await updateCharacterStatus(_0x870c28,_0x5d34a6(0x38b),_0x48f5d4);}}function generateFallbackStatus(_0x577de5,_0x16f2be){const _0x581f3c=_0x211817,_0x17319c=(_0x577de5[_0x581f3c(0x1f0b)]||'')[_0x581f3c(0x49e)]();if(_0x16f2be===_0x581f3c(0x16f6)){if(_0x17319c[_0x581f3c(0x1831)]('学者')||_0x17319c[_0x581f3c(0x1831)]('研究')||_0x17319c[_0x581f3c(0x1831)]('书'))return _0x581f3c(0xbbe);else{if(_0x17319c[_0x581f3c(0x1831)]('战士')||_0x17319c[_0x581f3c(0x1831)]('剑')||_0x17319c[_0x581f3c(0x1831)]('战斗'))return _0x581f3c(0x1d92);else{if(_0x17319c[_0x581f3c(0x1831)]('医生')||_0x17319c[_0x581f3c(0x1831)]('治疗'))return _0x581f3c(0x1519);else{if(_0x17319c[_0x581f3c(0x1831)]('商人')||_0x17319c[_0x581f3c(0x1831)]('买卖'))return _0x581f3c(0x174e);else{if(_0x17319c[_0x581f3c(0x1831)]('艺术')||_0x17319c[_0x581f3c(0x1831)]('画')||_0x17319c[_0x581f3c(0x1831)]('音乐'))return _0x581f3c(0x15ba);else return _0x17319c[_0x581f3c(0x1831)]('厨')||_0x17319c['includes']('料理')?_0x581f3c(0x2f9):_0x581f3c(0xaab);}}}}}else{if(_0x17319c['includes']('开朗')||_0x17319c[_0x581f3c(0x1831)]('活泼')||_0x17319c[_0x581f3c(0x1831)]('乐观'))return'心情愉悦';else{if(_0x17319c[_0x581f3c(0x1831)]('冷静')||_0x17319c[_0x581f3c(0x1831)]('理性')||_0x17319c['includes']('沉着'))return _0x581f3c(0x1a62);else{if(_0x17319c['includes']('严肃')||_0x17319c['includes']('认真'))return _0x581f3c(0x607);else{if(_0x17319c[_0x581f3c(0x1831)]('温柔')||_0x17319c[_0x581f3c(0x1831)]('善良'))return _0x581f3c(0x1add);else return _0x17319c[_0x581f3c(0x1831)]('神秘')||_0x17319c['includes']('深沉')?_0x581f3c(0x4ac):_0x581f3c(0x27a);}}}}}let characterStatusTimer=null;function getStatusUpdateInterval(){const _0x4e49df=_0x211817;let _0x432e0d=_0x4e49df(0x950);try{const _0x56174c=localStorage['getItem']('globalStatusUpdateFrequency');if(_0x56174c)_0x432e0d=_0x56174c;else{if(currentChatCharacter){const _0x2180ed=getCurrentChatSettings();_0x432e0d=_0x2180ed[_0x4e49df(0x1899)]||'medium',localStorage[_0x4e49df(0x192)](_0x4e49df(0xf17),_0x432e0d);}}}catch(_0x5aed8f){console[_0x4e49df(0x1f43)]('获取状态更新频率设置失败，使用默认值:',_0x5aed8f);}const _0x71612b={'high':0x7530,'medium-high':0xea60,'medium':0x2bf20,'medium-low':0x493e0,'low':0x927c0};return _0x71612b[_0x432e0d]||_0x71612b[_0x4e49df(0x950)];}function clearCharacterStatusTimer(){const _0x31de64=_0x211817;characterStatusTimer&&(clearInterval(characterStatusTimer),characterStatusTimer=null,console[_0x31de64(0x2187)](_0x31de64(0x1450)));}async function startCharacterStatusTimer(){const _0xd91691=_0x211817;clearCharacterStatusTimer();let _0x20f774=![];for(const _0x42f971 of characters){if(contacts['includes'](_0x42f971['id'])){const _0x7b29a0=await getAsyncChatSettings(_0x42f971['id']);if(_0x7b29a0['characterStatusEnabled']){_0x20f774=!![];break;}}}if(!_0x20f774){console[_0xd91691(0x2187)](_0xd91691(0xf42));return;}const _0x406001=getStatusUpdateInterval();console['log'](_0xd91691(0xb9d),_0x406001/0x3e8,'秒'),characterStatusTimer=setInterval(async()=>{const _0x153a11=_0xd91691;let _0x283bb5=![];for(const _0x29d79 of characters){if(contacts[_0x153a11(0x1831)](_0x29d79['id'])){const _0x3cb758=await getAsyncChatSettings(_0x29d79['id']);if(_0x3cb758[_0x153a11(0x22aa)]){_0x283bb5=!![];const _0xadccb5=await shouldUpdateCharacterStatus(_0x29d79['id']);_0xadccb5&&await generateCharacterStatus(_0x29d79['id']);}}}if(!_0x283bb5){console[_0x153a11(0x2187)]('没有角色启用状态显示，停止状态更新定时器'),clearCharacterStatusTimer();return;}if(currentChatCharacter){const _0x24cfa4=getCurrentChatSettings();if(_0x24cfa4[_0x153a11(0x22aa)]){const _0x985ca8=document[_0x153a11(0xb30)](_0x153a11(0xb15));_0x985ca8&&renderCharacterStatus(currentChatCharacter['id'],_0x985ca8);}}},_0x406001);}function restartCharacterStatusTimer(){const _0x561ac8=_0x211817;console[_0x561ac8(0x2187)](_0x561ac8(0x1df0)),startCharacterStatusTimer();}function startStatusUpdateTimer(){startCharacterStatusTimer();}let globalMemoryDB=null;async function initGlobalMemoryDB(){const _0x1c9f69=_0x211817;try{!db[_0x1c9f69(0x203a)]&&(db[_0x1c9f69(0x203a)]=db['table'](_0x1c9f69(0x203a),'++id,\x20characterId,\x20date,\x20summary,\x20context,\x20importance,\x20timestamp')),!db[_0x1c9f69(0x127e)]&&(db[_0x1c9f69(0x127e)]=db[_0x1c9f69(0x33d)](_0x1c9f69(0x127e),_0x1c9f69(0x1529))),!db[_0x1c9f69(0xd61)]&&(db['memoryEvents']=db['table'](_0x1c9f69(0xd61),_0x1c9f69(0x1d4d))),console['log'](_0x1c9f69(0x1e22));}catch(_0x528cb4){console['error'](_0x1c9f69(0x6af),_0x528cb4);}}async function recordMemoryEvent(_0x1a4e08,_0x5eb086,_0x4ce8cb,_0x5695a2,_0x331da7=0.5){const _0x4ffbaf=_0x211817;try{if(!_0x1a4e08||!_0x4ce8cb||!_0x5695a2){console[_0x4ffbaf(0x1f43)]('❌\x20recordMemoryEvent:\x20缺少必需参数',{'characterIds':_0x1a4e08,'eventType':_0x4ce8cb,'eventData':_0x5695a2});return;}const _0x3f1a1f={'id':_0x4ffbaf(0x1e4f)+Date[_0x4ffbaf(0x2eb)]()+'_'+Math[_0x4ffbaf(0x11a8)]()[_0x4ffbaf(0x1878)](0x24)[_0x4ffbaf(0x15fb)](0x2,0x9),'timestamp':Date[_0x4ffbaf(0x2eb)](),'characterIds':Array[_0x4ffbaf(0x1496)](_0x1a4e08)?_0x1a4e08:[_0x1a4e08],'context':_0x5eb086||{'type':'unknown','id':_0x4ffbaf(0x1482)},'eventType':_0x4ce8cb,'eventData':_0x5695a2,'importance':_0x331da7||0.5};if(typeof _0x3f1a1f[_0x4ffbaf(0x229c)]===_0x4ffbaf(0x28d)&&_0x3f1a1f[_0x4ffbaf(0x229c)]!==null)try{JSON[_0x4ffbaf(0x6b8)](_0x3f1a1f[_0x4ffbaf(0x229c)]);}catch(_0x1ebca0){console[_0x4ffbaf(0x1f43)](_0x4ffbaf(0x18fc),_0x3f1a1f[_0x4ffbaf(0x229c)]),_0x3f1a1f[_0x4ffbaf(0x229c)]=String(_0x3f1a1f['eventData']);}await db[_0x4ffbaf(0xd61)][_0x4ffbaf(0x21e2)](_0x3f1a1f),console[_0x4ffbaf(0x2187)](_0x4ffbaf(0x19c3),_0x4ce8cb,_0x1a4e08);}catch(_0x442859){console[_0x4ffbaf(0x174a)](_0x4ffbaf(0x426),_0x442859),console[_0x4ffbaf(0x174a)]('❌\x20事件数据:',{'characterIds':_0x1a4e08,'context':_0x5eb086,'eventType':_0x4ce8cb,'eventData':_0x5695a2,'importance':_0x331da7});}}async function addCoreMemory(_0x1e6c63,_0x193395,_0x4ad70c=_0x211817(0x21e0),_0x11e161=0.8){const _0x389e71=_0x211817;try{const _0x2fe561={'characterId':_0x1e6c63,'fact':_0x193395,'category':_0x4ad70c,'importance':_0x11e161,'timestamp':Date['now'](),'lastAccessed':Date[_0x389e71(0x2eb)]()};await db[_0x389e71(0x127e)][_0x389e71(0x21e2)](_0x2fe561),console['log']('🧠\x20添加核心记忆:',_0x193395);}catch(_0x2f97dc){console['error']('❌\x20添加核心记忆失败:',_0x2f97dc);}}async function generateMemorySummary(_0x9ecab0,_0x3b830f,_0x347caa,_0x24219e){const _0x571c03=_0x211817;try{const _0x56cf77=characters[_0x571c03(0xaf4)](_0x308cf2=>_0x308cf2['id']===_0x9ecab0);if(!_0x56cf77)return console['error'](_0x571c03(0xa39),_0x9ecab0),null;const _0x1adef2=await db[_0x571c03(0x8ac)]['where']('characterId')[_0x571c03(0x1694)](_0x9ecab0)['and'](_0x52fc7f=>_0x52fc7f[_0x571c03(0x1716)]>=_0x3b830f&&_0x52fc7f[_0x571c03(0x1716)]<_0x347caa)['toArray'](),_0x128001=chatMessages[_0x9ecab0]||[],_0x35afe6=_0x128001[_0x571c03(0x1e1f)](_0x474a68=>_0x474a68[_0x571c03(0x1716)]>=_0x3b830f&&_0x474a68[_0x571c03(0x1716)]<_0x347caa);if(_0x1adef2[_0x571c03(0x19ee)]===0x0&&_0x35afe6[_0x571c03(0x19ee)]===0x0)return console[_0x571c03(0x2187)]('今天暂无活动记录'),null;let _0x578526='';_0x35afe6[_0x571c03(0x19ee)]>0x0&&(_0x578526+='聊天记录：\x0a',_0x35afe6['forEach'](_0x45435c=>{const _0x363092=_0x571c03,_0xfeb9d8=new Date(_0x45435c[_0x363092(0x1716)])[_0x363092(0x314)](),_0x2ebd6e=_0x45435c['role']===_0x363092(0xa80)?'用户':_0x56cf77[_0x363092(0x1a1c)];_0x578526+='['+_0xfeb9d8+']\x20'+_0x2ebd6e+':\x20'+_0x45435c[_0x363092(0x211c)]+'\x0a';}));_0x1adef2[_0x571c03(0x19ee)]>0x0&&(_0x578526+=_0x571c03(0x3e1),_0x1adef2['forEach'](_0x449d0f=>{const _0x30fce6=_0x571c03,_0x47fb42=new Date(_0x449d0f[_0x30fce6(0x1716)])[_0x30fce6(0x314)](),_0xedfe78=getActionDescription(_0x449d0f[_0x30fce6(0x211f)],_0x449d0f[_0x30fce6(0x1da2)]);_0x578526+='['+_0x47fb42+']\x20'+_0xedfe78+'\x0a';}));const _0x4bd952=_0x571c03(0xcb3)+_0x56cf77['name']+_0x571c03(0x1884)+new Date(_0x3b830f)[_0x571c03(0xecc)]()+'\x20-\x20'+new Date(_0x347caa)['toLocaleString']()+_0x571c03(0x1eea)+_0x578526+_0x571c03(0x539)+_0x56cf77[_0x571c03(0x1a1c)]+'\x22指代角色\x0a3.\x20重点记录重要事件和情感变化\x0a4.\x20不要使用\x22我\x22、\x22你\x22等第一、第二人称\x0a5.\x20直接输出摘要文本，不要JSON格式，不要聊天回复格式\x0a\x0a摘要：',_0x1c9e6a=await callSummaryAPI(_0x4bd952);if(_0x1c9e6a&&_0x1c9e6a['trim']()){const _0x9b7b37=new Date(),_0x278947=_0x9b7b37[_0x571c03(0x16a0)]()+'-'+String(_0x9b7b37[_0x571c03(0x1da)]()+0x1)[_0x571c03(0xdfe)](0x2,'0')+'-'+String(_0x9b7b37[_0x571c03(0x520)]())[_0x571c03(0xdfe)](0x2,'0'),_0x25ee26={'id':_0x571c03(0xab2)+_0x9ecab0+'_'+Date[_0x571c03(0x2eb)]()+'_'+Math['random']()[_0x571c03(0x1878)](0x24)[_0x571c03(0x15fb)](0x2,0x9),'characterId':_0x9ecab0,'date':_0x278947,'summary':_0x1c9e6a[_0x571c03(0x19d7)](),'context':_0x24219e,'importance':calculateSummaryImportance(_0x1adef2[_0x571c03(0x458)](_0x35afe6)),'timestamp':Date[_0x571c03(0x2eb)]()};return await db[_0x571c03(0x203a)]['add'](_0x25ee26),console[_0x571c03(0x2187)](_0x571c03(0x1037),_0x25ee26['summary']),_0x25ee26;}}catch(_0x371c2c){console['error']('❌\x20生成记忆摘要失败:',_0x371c2c);}return null;}function getActionDescription(_0x34f828,_0x195d6c){const _0x146788=_0x211817,_0x421fde={'user_message':_0x146788(0x357),'ai_reply':'回复了消息','moment_publish':_0x146788(0x5e9),'moment_comment':_0x146788(0x1f6),'game_start':_0x146788(0x199b),'game_end':_0x146788(0xb5f)},_0x1762eb=_0x421fde[_0x34f828]||_0x34f828;if(_0x195d6c&&_0x195d6c[_0x146788(0x211c)])return _0x1762eb+':\x20'+_0x195d6c['content']['substring'](0x0,0x1e)+_0x146788(0x1520);return _0x1762eb;}async function callSummaryAPI(_0x520ea4){const _0x56b4dc=_0x211817;if(!apiSettings[_0x56b4dc(0x213c)])throw new Error(_0x56b4dc(0x1e69));const _0x125352=apiSettings[_0x56b4dc(0x1208)][_0x56b4dc(0x1831)](_0x56b4dc(0x1d80));let _0x3f3cc2,_0x1e30ce,_0x3092ef;if(_0x125352)_0x1e30ce=apiSettings[_0x56b4dc(0x1208)]+_0x56b4dc(0x1107)+apiSettings[_0x56b4dc(0x1976)]+_0x56b4dc(0x40c)+apiSettings['key'],_0x3092ef={'Content-Type':_0x56b4dc(0x1b82)},_0x3f3cc2={'contents':[{'role':'user','parts':[{'text':_0x520ea4}]}],'generationConfig':{'temperature':0.3}};else{if(apiSettings['base']['endsWith'](_0x56b4dc(0x1439)))_0x1e30ce=apiSettings[_0x56b4dc(0x1208)]+_0x56b4dc(0x1bea);else apiSettings[_0x56b4dc(0x1208)]['includes'](_0x56b4dc(0x1dac))?_0x1e30ce=apiSettings['base']+_0x56b4dc(0x1bea):_0x1e30ce=apiSettings[_0x56b4dc(0x1208)]+_0x56b4dc(0x666);_0x3092ef={'Content-Type':'application/json','Authorization':_0x56b4dc(0x1e3c)+apiSettings[_0x56b4dc(0x213c)]},_0x3f3cc2={'model':apiSettings[_0x56b4dc(0x1976)],'messages':[{'role':_0x56b4dc(0x1744),'content':_0x56b4dc(0x1d7f)},{'role':_0x56b4dc(0xa80),'content':_0x520ea4}],'temperature':0.3};}const _0x5603ec=await fetch(_0x1e30ce,{'method':_0x56b4dc(0x1dd5),'headers':_0x3092ef,'body':JSON[_0x56b4dc(0x6b8)](_0x3f3cc2)});if(!_0x5603ec['ok']){const _0x4b4fc1=await _0x5603ec['json']();throw new Error(_0x56b4dc(0xc08)+_0x5603ec[_0x56b4dc(0x12e2)]+'\x20-\x20'+(_0x4b4fc1[_0x56b4dc(0x174a)]?.[_0x56b4dc(0x1e8e)]||_0x56b4dc(0x2e7)));}const _0x18cc59=await _0x5603ec['json']();return _0x125352?_0x18cc59[_0x56b4dc(0x1153)]?.[0x0]?.[_0x56b4dc(0x211c)]?.[_0x56b4dc(0x2308)]?.[0x0]?.[_0x56b4dc(0x1378)]:_0x18cc59['choices']?.[0x0]?.['message']?.[_0x56b4dc(0x211c)];}function calculateSummaryImportance(_0x558e79){const _0xea2348=_0x211817;if(!_0x558e79||_0x558e79[_0xea2348(0x19ee)]===0x0)return 0.3;let _0x33a123=0x0,_0x48cebf=0x0;_0x558e79['forEach'](_0x3d154c=>{const _0x24477e=_0xea2348;_0x3d154c[_0x24477e(0x146c)]!==undefined?(_0x33a123+=_0x3d154c[_0x24477e(0x146c)],_0x48cebf++):(_0x33a123+=0.6,_0x48cebf++);});const _0x4bd0d7=_0x48cebf>0x0?_0x33a123/_0x48cebf:0.5,_0x27c33a=_0x558e79[_0xea2348(0x19ee)];return Math['min'](0.9,_0x4bd0d7+_0x27c33a*0.02);}async function buildGlobalMemoryContext(_0x11b6a1,_0x39a19b,_0x15ecf5=0x7){const _0x5dafef=_0x211817;try{_0x11b6a1=safeCharacterId(_0x11b6a1);if(!_0x39a19b||!_0x39a19b['id'])return console[_0x5dafef(0x174a)](_0x5dafef(0x1f7e),_0x39a19b),'';let _0x52d4d9='',_0x45bf1f=[],_0x324e7e=[String(_0x39a19b['id'])];try{const _0x4205d2=await db[_0x5dafef(0x8ac)][_0x5dafef(0xa24)]('characterId')['equals'](_0x11b6a1)[_0x5dafef(0x82f)](_0x3b8780=>_0x3b8780['timestamp']>Date['now']()-0x7*0x18*0x3c*0x3c*0x3e8)[_0x5dafef(0xf13)](),_0x11734d=_0x4205d2[_0x5dafef(0x19ee)]>0x0;console[_0x5dafef(0x2187)](_0x5dafef(0xe11)+_0x11b6a1+_0x5dafef(0x2220)+_0x4205d2[_0x5dafef(0x19ee)]+'条');if(_0x39a19b[_0x5dafef(0x1a4b)]===_0x5dafef(0x764)){const _0x52916e=await getAsyncChatSettings(_0x11b6a1);_0x45bf1f=_0x52916e['memorySharedGroupIds']||[],console[_0x5dafef(0x2187)](_0x5dafef(0xfa6)+_0x11b6a1),console[_0x5dafef(0x2187)](_0x5dafef(0x6a2)+_0x39a19b['id']),console[_0x5dafef(0x2187)]('🔍\x20角色私聊设置的共享群聊IDs:\x20'+_0x45bf1f);if(_0x45bf1f[_0x5dafef(0x1831)](_0x39a19b['id']))_0x324e7e=[_0x11b6a1,String(_0x39a19b['id'])],console['log'](_0x5dafef(0x1a07));else _0x11734d?(_0x324e7e[_0x5dafef(0x1cd6)](_0x11b6a1),console[_0x5dafef(0x2187)]('🔗\x20检测到跨应用活动\x20-\x20包含私聊记忆')):console[_0x5dafef(0x2187)](_0x5dafef(0x1437));}else{if(_0x39a19b['type']===_0x5dafef(0x219)){const _0x356674=getCurrentChatSettings();_0x45bf1f=_0x356674[_0x5dafef(0x1ec5)]||[];if(_0x45bf1f[_0x5dafef(0x19ee)]>0x0)_0x324e7e['push'](..._0x45bf1f['map'](_0x4cd24e=>String(_0x4cd24e))),console['log'](_0x5dafef(0x711),_0x45bf1f);else{if(_0x11734d){const _0x42a393=_0x4205d2[_0x5dafef(0x1e1f)](_0x4c633b=>_0x4c633b[_0x5dafef(0x1da2)]?.[_0x5dafef(0x1a4b)]===_0x5dafef(0x764)&&_0x4c633b['context']?.['groupId'])[_0x5dafef(0x6a4)](_0x344532=>_0x344532[_0x5dafef(0x1da2)][_0x5dafef(0x22be)])[_0x5dafef(0x1e1f)]((_0x22c7a9,_0x1cbfb2,_0x459c2c)=>_0x459c2c[_0x5dafef(0x13c5)](_0x22c7a9)===_0x1cbfb2);_0x42a393[_0x5dafef(0x19ee)]>0x0&&(_0x324e7e[_0x5dafef(0x1cd6)](..._0x42a393['map'](_0x3014be=>String(_0x3014be))),console[_0x5dafef(0x2187)](_0x5dafef(0x1f59),_0x42a393));}}}}}catch(_0x1a06e3){console[_0x5dafef(0x1f43)](_0x5dafef(0x1c4d),_0x1a06e3);}let _0x25dfff=[];for(const _0x1c442a of _0x324e7e){try{const _0x3c1915=await db[_0x5dafef(0x127e)]['where'](_0x5dafef(0xaf5))['equals'](String(_0x11b6a1))[_0x5dafef(0x82f)](_0x374950=>{const _0x467f6a=_0x5dafef;if(!_0x374950['contextId'])return!![];return String(_0x374950[_0x467f6a(0xae4)])===String(_0x1c442a);})[_0x5dafef(0xf13)]();_0x25dfff=_0x25dfff[_0x5dafef(0x458)](_0x3c1915);}catch(_0xa03baa){console[_0x5dafef(0x174a)](_0x5dafef(0x668)+_0x11b6a1+',\x20contextId:\x20'+_0x1c442a+':',_0xa03baa);}}_0x25dfff['sort']((_0x3c0e2f,_0x4fb9f2)=>{const _0x557699=_0x5dafef,_0x56f21c=String(_0x3c0e2f[_0x557699(0xae4)])===String(_0x11b6a1),_0x29b75e=String(_0x4fb9f2[_0x557699(0xae4)])===String(_0x11b6a1);if(_0x56f21c&&!_0x29b75e)return-0x1;if(!_0x56f21c&&_0x29b75e)return 0x1;return(_0x4fb9f2[_0x557699(0x146c)]||0x0)-(_0x3c0e2f[_0x557699(0x146c)]||0x0);});const _0x4f280d=_0x25dfff[_0x5dafef(0x6d5)](0x0,0xa);_0x4f280d[_0x5dafef(0x19ee)]>0x0&&(_0x52d4d9+=_0x5dafef(0x1cba),_0x4f280d[_0x5dafef(0x19fb)](_0x38dfbf=>{_0x52d4d9+='-\x20'+_0x38dfbf['fact']+'\x0a';}));const _0x5bed10=new Date();_0x5bed10[_0x5dafef(0x20ae)](_0x5bed10[_0x5dafef(0x520)]()-_0x15ecf5);const _0x31e01d=_0x5bed10[_0x5dafef(0x704)]();let _0x5b4690=[];for(const _0x44d451 of _0x324e7e){const _0xf06b10=await db['episodicMemories']['where'](_0x5dafef(0xaf5))[_0x5dafef(0x1694)](_0x11b6a1)[_0x5dafef(0x82f)](_0x2fc920=>{const _0x45de46=_0x5dafef;if(_0x2fc920[_0x45de46(0x1716)]<_0x31e01d)return![];if(!_0x2fc920['contextId'])return!![];return _0x2fc920[_0x45de46(0xae4)]===_0x44d451;})[_0x5dafef(0xf13)]();_0x5b4690=_0x5b4690[_0x5dafef(0x458)](_0xf06b10);}_0x5b4690[_0x5dafef(0x1104)]((_0x63c27b,_0x15ee34)=>{const _0x29d44e=_0x5dafef,_0x2012e2=String(_0x63c27b[_0x29d44e(0xae4)])===String(_0x11b6a1),_0x92b31a=String(_0x15ee34['contextId'])===String(_0x11b6a1);if(_0x2012e2&&!_0x92b31a)return-0x1;if(!_0x2012e2&&_0x92b31a)return 0x1;return _0x15ee34[_0x29d44e(0x1716)]-_0x63c27b[_0x29d44e(0x1716)];});const _0x28006a=_0x5b4690[_0x5dafef(0x6d5)](0x0,0xf);_0x28006a[_0x5dafef(0x19ee)]>0x0&&(_0x52d4d9+=_0x5dafef(0xcf3),_0x28006a['forEach'](_0x4c63ca=>{const _0x33303a=_0x5dafef,_0x35eaf4=new Date(_0x4c63ca[_0x33303a(0x1716)]||Date[_0x33303a(0x2eb)]()),_0x3a30db=isNaN(_0x35eaf4[_0x33303a(0x704)]())?_0x33303a(0x42b):_0x35eaf4['toLocaleDateString']();_0x52d4d9+='['+_0x3a30db+']\x20'+_0x4c63ca[_0x33303a(0x13e5)]+'\x0a';}));const _0x290062=Date['now']()-_0x15ecf5*0x18*0x3c*0x3c*0x3e8;let _0x7d3c6=[];for(const _0x295a94 of _0x324e7e){const _0x592831=await db[_0x5dafef(0x8ac)]['where']('characterId')[_0x5dafef(0x1694)](_0x11b6a1)[_0x5dafef(0x82f)](_0x2566c7=>{const _0x2f87e6=_0x5dafef;if(_0x2566c7['timestamp']<_0x290062)return![];if(!_0x2566c7[_0x2f87e6(0x1da2)])return![];if(_0x2566c7['appType']===_0x2f87e6(0x13dd)&&_0x2566c7['action']===_0x2f87e6(0x1323))return!![];if(_0x2566c7[_0x2f87e6(0x741)]===_0x2f87e6(0x322))return _0x2566c7[_0x2f87e6(0x1da2)]['id']===_0x295a94||_0x2566c7['context']['chatId']===_0x295a94||_0x295a94===_0x11b6a1;return _0x2566c7[_0x2f87e6(0x1da2)]['id']===_0x295a94||_0x2566c7[_0x2f87e6(0x1da2)][_0x2f87e6(0x20e1)]===_0x295a94||_0x2566c7[_0x2f87e6(0x1da2)][_0x2f87e6(0x22be)]===_0x295a94;})[_0x5dafef(0xf13)]();_0x7d3c6=_0x7d3c6['concat'](_0x592831);}const _0x3bb38a=_0x7d3c6['filter']((_0x11677e,_0x581fdd,_0x5314c7)=>_0x581fdd===_0x5314c7['findIndex'](_0x2e78c8=>_0x2e78c8['id']===_0x11677e['id']));_0x3bb38a['sort']((_0x1ded84,_0x33d5c3)=>_0x33d5c3[_0x5dafef(0x1716)]-_0x1ded84['timestamp']);const _0x34c374=_0x3bb38a[_0x5dafef(0x6d5)](0x0,0x1e);_0x34c374[_0x5dafef(0x19ee)]>0x0&&(_0x52d4d9+=_0x5dafef(0xdc0),_0x34c374[_0x5dafef(0x19fb)]((_0x5785a3,_0x32472b)=>{const _0x14ce7d=_0x5dafef,_0x5bd969=new Date(_0x5785a3[_0x14ce7d(0x1716)])['toLocaleString']();let _0x1f600d='私聊',_0x20ad13='💬';if(_0x5785a3[_0x14ce7d(0x1da2)]?.[_0x14ce7d(0x1a4b)]===_0x14ce7d(0x764))_0x1f600d=_0x5785a3['context']?.['groupName']?_0x14ce7d(0x1ff4)+_0x5785a3[_0x14ce7d(0x1da2)][_0x14ce7d(0x1301)]+')':'群聊',_0x20ad13='👥';else{if(_0x5785a3[_0x14ce7d(0x741)]===_0x14ce7d(0x13dd))_0x1f600d=_0x14ce7d(0x864),_0x20ad13='🎭';else _0x5785a3['appType']===_0x14ce7d(0x322)&&(_0x1f600d='短信',_0x20ad13='📱');}let _0x11d274='',_0x20f4d4=![];if(_0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x20fe))_0x5785a3['context']?.[_0x14ce7d(0x211c)]?_0x11d274=_0x14ce7d(0x22f5)+_0x5785a3['context'][_0x14ce7d(0x211c)]['substring'](0x0,0x3c)+(_0x5785a3[_0x14ce7d(0x1da2)][_0x14ce7d(0x211c)][_0x14ce7d(0x19ee)]>0x3c?_0x14ce7d(0x250):'\x22'):_0x11d274=_0x14ce7d(0x1aa3);else{if(_0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x271)||_0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x120e))_0x5785a3['context']?.[_0x14ce7d(0x211c)]?_0x11d274=_0x14ce7d(0xccb)+_0x5785a3['context'][_0x14ce7d(0x211c)][_0x14ce7d(0x17ca)](0x0,0x3c)+(_0x5785a3['context'][_0x14ce7d(0x211c)][_0x14ce7d(0x19ee)]>0x3c?_0x14ce7d(0x250):'\x22'):_0x11d274=_0x14ce7d(0x1540);else{if(_0x5785a3[_0x14ce7d(0x741)]===_0x14ce7d(0x322)){if(_0x5785a3[_0x14ce7d(0x211f)]==='user_message')_0x11d274=_0x14ce7d(0x154b)+(_0x5785a3['context']?.[_0x14ce7d(0x211c)]?.[_0x14ce7d(0x17ca)](0x0,0x3c)||'')+((_0x5785a3['context']?.['content']?.['length']||0x0)>0x3c?'...\x22':'\x22'),_0x20f4d4=!![];else{if(_0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x120e))_0x11d274=_0x14ce7d(0xc1d)+(_0x5785a3['context']?.[_0x14ce7d(0x211c)]?.['substring'](0x0,0x3c)||'')+((_0x5785a3[_0x14ce7d(0x1da2)]?.[_0x14ce7d(0x211c)]?.[_0x14ce7d(0x19ee)]||0x0)>0x3c?'...\x22':'\x22'),_0x20f4d4=!![];else _0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x11d3)?(_0x11d274=_0x14ce7d(0xea8)+(_0x5785a3[_0x14ce7d(0x1da2)]?.[_0x14ce7d(0x211c)]?.[_0x14ce7d(0x17ca)](0x0,0x3c)||'')+((_0x5785a3[_0x14ce7d(0x1da2)]?.[_0x14ce7d(0x211c)]?.[_0x14ce7d(0x19ee)]||0x0)>0x3c?_0x14ce7d(0x250):'\x22'),_0x20f4d4=!![]):_0x11d274=_0x14ce7d(0x1b9d);}}else _0x5785a3[_0x14ce7d(0x211f)]===_0x14ce7d(0x1323)&&_0x5785a3[_0x14ce7d(0x741)]===_0x14ce7d(0x13dd)?_0x5785a3['context']?.[_0x14ce7d(0x211c)]?(_0x11d274=_0x14ce7d(0x1316)+_0x5785a3[_0x14ce7d(0x1da2)][_0x14ce7d(0x211c)][_0x14ce7d(0x17ca)](0x0,0x50)+(_0x5785a3['context'][_0x14ce7d(0x211c)][_0x14ce7d(0x19ee)]>0x50?_0x14ce7d(0x1520):''),_0x20f4d4=!![]):_0x11d274=_0x14ce7d(0x4bd):_0x11d274=_0x5785a3[_0x14ce7d(0x211f)]||_0x5785a3[_0x14ce7d(0x1eb2)]||_0x14ce7d(0x1cef);}}const _0x492e0f=_0x5785a3['context']?.['id']!==_0x39a19b['id'],_0x37b503=_0x492e0f?'\x20⭐':'',_0x28cb21=_0x20f4d4?'\x20🔥':'';_0x52d4d9+='['+_0x5bd969+']\x20'+_0x20ad13+_0x1f600d+':\x20'+_0x11d274+_0x37b503+_0x28cb21+'\x0a';}));const _0x53e41f=_0x5bed10[_0x5dafef(0x1034)]()[_0x5dafef(0x204b)]('T')[0x0],_0x48497d=await db[_0x5dafef(0x203a)][_0x5dafef(0xa24)](_0x5dafef(0xaf5))[_0x5dafef(0x1694)](_0x11b6a1)[_0x5dafef(0x82f)](_0x51cadc=>_0x51cadc[_0x5dafef(0x20d4)]>=_0x53e41f)[_0x5dafef(0xf13)]();_0x48497d[_0x5dafef(0x1104)]((_0x2fdf3f,_0x87f105)=>_0x87f105[_0x5dafef(0x1716)]-_0x2fdf3f[_0x5dafef(0x1716)]);const _0x4265fb=_0x48497d[_0x5dafef(0x6d5)](0x0,0xa);_0x4265fb['length']>0x0&&(_0x52d4d9+='\x0a#\x20对话摘要\x0a',_0x4265fb[_0x5dafef(0x19fb)](_0x3f56ee=>{const _0x2d4385=_0x5dafef,_0x2edc1d=new Date(_0x3f56ee[_0x2d4385(0x1716)]||Date[_0x2d4385(0x2eb)]()),_0x1db820=isNaN(_0x2edc1d['getTime']())?'未知日期':_0x2edc1d[_0x2d4385(0xbf7)]();_0x52d4d9+='['+_0x1db820+']\x20'+_0x3f56ee['summary']+'\x0a';}));const _0x7b3d7c=await db[_0x5dafef(0xd61)]['where'](_0x5dafef(0x1716))[_0x5dafef(0x1676)](Date['now']()-0x18*0x3c*0x3c*0x3e8)['and'](_0x707d19=>{const _0x19edc5=_0x5dafef;return _0x707d19[_0x19edc5(0x1bd6)][_0x19edc5(0x1831)](_0x11b6a1)&&_0x324e7e[_0x19edc5(0x1831)](_0x707d19['context']['id']);})[_0x5dafef(0xf13)]();_0x7b3d7c[_0x5dafef(0x1104)]((_0x566376,_0x4cb093)=>_0x4cb093[_0x5dafef(0x1716)]-_0x566376[_0x5dafef(0x1716)]);const _0xe89124=_0x7b3d7c[_0x5dafef(0x6d5)](0x0,0xf);_0xe89124[_0x5dafef(0x19ee)]>0x0&&(_0x52d4d9+=_0x5dafef(0x1b29),_0xe89124[_0x5dafef(0x19fb)](_0x38a527=>{const _0x191fce=_0x5dafef,_0xfff948=new Date(_0x38a527[_0x191fce(0x1716)])[_0x191fce(0x314)](),_0x50cc27=_0x38a527[_0x191fce(0x1da2)][_0x191fce(0x1a4b)]===_0x191fce(0x219)?'私聊':_0x38a527[_0x191fce(0x1da2)][_0x191fce(0x1a4b)]===_0x191fce(0x764)?'群聊':_0x38a527['context'][_0x191fce(0x1a4b)]===_0x191fce(0xa36)?'音乐':'其他',_0xffbeee=_0x38a527['context']['id']!==_0x39a19b['id']?_0x191fce(0x19e7)+_0x50cc27+')':'';_0x52d4d9+='['+_0xfff948+_0x191fce(0x2011)+_0x50cc27+'中'+_0xffbeee+':\x20'+_0x38a527[_0x191fce(0x1eb2)]+'\x0a';}));if(_0x52d4d9[_0x5dafef(0x19d7)]()){const _0x5f080c=(_0x52d4d9[_0x5dafef(0x1b87)](/⭐/g)||[])[_0x5dafef(0x19ee)],_0x21bedc=(_0x52d4d9['match'](/📱/g)||[])[_0x5dafef(0x19ee)],_0x2c7b83=(_0x52d4d9[_0x5dafef(0x1b87)](/🎭/g)||[])[_0x5dafef(0x19ee)];_0x52d4d9+=_0x5dafef(0x6f6),_0x39a19b[_0x5dafef(0x1a4b)]===_0x5dafef(0x764)&&_0x324e7e['includes'](_0x11b6a1)&&(_0x52d4d9+=_0x5dafef(0x896),_0x52d4d9+=_0x5dafef(0x1631),_0x52d4d9+=_0x5dafef(0x244)),_0x5f080c>0x0&&(_0x52d4d9+=_0x5dafef(0xea4)+_0x5f080c+_0x5dafef(0x1b3)),_0x21bedc>0x0&&(_0x52d4d9+=_0x5dafef(0xea4)+_0x21bedc+_0x5dafef(0x1699)),_0x2c7b83>0x0&&(_0x52d4d9+=_0x5dafef(0xea4)+_0x2c7b83+_0x5dafef(0x2a7)),_0x52d4d9+='•\x20🔥标记的是重要记忆，优先考虑在回复中体现这些内容的连续性\x0a',_0x52d4d9+=_0x5dafef(0xbc1),_0x52d4d9+='•\x20让每次对话都感觉像是同一个角色的连续体验，而不是割裂的独立对话\x0a',_0x52d4d9+='•\x20特别重要：即使用户没有主动提及，你也可以根据当前话题自然地联想到相关的跨场景记忆\x0a';}return _0x52d4d9;}catch(_0x1e20ff){return console[_0x5dafef(0x174a)](_0x5dafef(0xa0d),_0x1e20ff),'';}}function showGlobalMemorySettings(){const _0x57e0e8=_0x211817;if(!currentChatCharacter){showToast(_0x57e0e8(0x1346),_0x57e0e8(0x174a));return;}const _0x27810a=_0x57e0e8(0x774);document[_0x57e0e8(0x1da9)][_0x57e0e8(0x1b7)]('beforeend',_0x27810a);const _0x23dd01=getGlobalMemorySettings(),_0x124427=document[_0x57e0e8(0xb30)](_0x57e0e8(0x22d)+_0x23dd01[_0x57e0e8(0x1715)]+'\x22]');if(_0x124427)_0x124427[_0x57e0e8(0x14c1)]=!![];}function getGlobalMemorySettings(){const _0x79d0be=_0x211817,_0x3b2efb=localStorage['getItem'](_0x79d0be(0x16c6));return _0x3b2efb?JSON[_0x79d0be(0x22d3)](_0x3b2efb):{'memoryDays':0x7,'autoSummary':!![],'coreMemoryEnabled':!![]};}function updateGlobalMemoryStatusDisplay(){const _0x29728f=_0x211817,_0x4d3883=getGlobalMemorySettings(),_0x8c7a9c=document[_0x29728f(0x1262)](_0x29728f(0x1055));console[_0x29728f(0x2187)](_0x29728f(0x1fd2),_0x4d3883['memoryDays']);if(_0x8c7a9c){let _0xcc0440;switch(_0x4d3883['memoryDays']){case 0x3:_0xcc0440='3天记忆';break;case 0x7:_0xcc0440=_0x29728f(0xfbf);break;case 0xf:_0xcc0440=_0x29728f(0x216d);break;case 0x1e:_0xcc0440=_0x29728f(0xd5a);break;case-0x1:_0xcc0440=_0x29728f(0x1c2e);break;default:_0xcc0440=_0x29728f(0xfbf);}_0x8c7a9c[_0x29728f(0x13be)]=_0xcc0440,console['log'](_0x29728f(0x135f),_0xcc0440);}else console[_0x29728f(0x1f43)]('🔥\x20找不到global-memory-status元素');}function saveGlobalMemorySettings(){const _0x2e5370=_0x211817,_0x432aa8=document[_0x2e5370(0xb30)]('input[name=\x22memoryDays\x22]:checked');if(!_0x432aa8){showToast(_0x2e5370(0x12d3),'error');return;}const _0x5d97fc=parseInt(_0x432aa8[_0x2e5370(0x1ebc)]);console[_0x2e5370(0x2187)](_0x2e5370(0x1c72),_0x5d97fc);const _0x5a5f7c={'memoryDays':_0x5d97fc,'autoSummary':!![],'coreMemoryEnabled':!![]};localStorage['setItem'](_0x2e5370(0x16c6),JSON[_0x2e5370(0x6b8)](_0x5a5f7c)),console[_0x2e5370(0x2187)](_0x2e5370(0x206a),_0x5a5f7c),hideGlobalMemorySettings(),updateGlobalMemoryStatusDisplay(),showToast(_0x2e5370(0x186e),_0x2e5370(0x11cb));}function hideGlobalMemorySettings(){const _0x5ecf77=_0x211817,_0x5e8769=document['getElementById'](_0x5ecf77(0xb2e));if(_0x5e8769)_0x5e8769[_0x5ecf77(0x1493)]();}function showMemoryModal(_0xfecefc,_0x46abb7,_0x69804e){const _0x350d70=_0x211817,_0x4bbec4=document[_0x350d70(0x1262)](_0x350d70(0x4e8));if(_0x4bbec4)_0x4bbec4[_0x350d70(0x1493)]();let _0x2ebd15='';_0x46abb7[_0x350d70(0x19ee)]===0x0?_0x2ebd15=_0x350d70(0x43f)+_0xfecefc+'</div>':_0x2ebd15=_0x46abb7[_0x350d70(0x6a4)]((_0x574560,_0x407e05)=>{const _0x1fc050=_0x350d70;let _0xf19b49='',_0x140020='',_0x50bfbf='';if(_0x69804e===_0x1fc050(0x228e)){_0xf19b49=_0x574560['fact']||_0x1fc050(0xf2f);const _0x657f5d='★'[_0x1fc050(0xcc7)](Math[_0x1fc050(0x2180)]((_0x574560[_0x1fc050(0x146c)]||0x0)*0x5));_0x140020=_0x1fc050(0x2073)+_0x657f5d+_0x1fc050(0x1844);const _0x547861=new Date(_0x574560[_0x1fc050(0x1716)]||Date[_0x1fc050(0x2eb)]());_0x50bfbf=isNaN(_0x547861[_0x1fc050(0x704)]())?_0x1fc050(0x42b):_0x547861[_0x1fc050(0xbf7)]();}else{if(_0x69804e===_0x1fc050(0x1490)){_0xf19b49=_0x574560['summary']||_0x1fc050(0xf2f);if(_0x574560['timestamp']){const _0x2c51ce=new Date(_0x574560[_0x1fc050(0x1716)]);_0x50bfbf=_0x2c51ce['getFullYear']()+'-'+String(_0x2c51ce[_0x1fc050(0x1da)]()+0x1)[_0x1fc050(0xdfe)](0x2,'0')+'-'+String(_0x2c51ce[_0x1fc050(0x520)]())[_0x1fc050(0xdfe)](0x2,'0');}else _0x50bfbf=_0x574560[_0x1fc050(0x20d4)]||_0x1fc050(0x42b);}}return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-item\x22\x20data-memory-id=\x22'+_0x574560['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-modal-index\x22>'+(_0x407e05+0x1)+_0x1fc050(0x188c)+_0x50bfbf+_0x1fc050(0x11b6)+_0x574560['id']+_0x1fc050(0xda7)+_0x69804e+_0x1fc050(0x9f3)+_0x574560['id']+'\x27,\x20\x27'+_0x69804e+_0x1fc050(0x547)+_0x574560['id']+_0x1fc050(0xda7)+_0x69804e+_0x1fc050(0x11db)+_0x574560['id']+_0x1fc050(0xda7)+_0x69804e+_0x1fc050(0x161d)+_0xf19b49[_0x1fc050(0xe16)](/"/g,_0x1fc050(0xb65))+'\x22>'+_0xf19b49+_0x1fc050(0x664)+_0x140020+_0x1fc050(0x1085);})['join']('');const _0x4849ef=_0x350d70(0x1a8b)+currentChatCharacter['name']+'\x20的'+_0xfecefc+'</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22hideMemoryModal()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22max-height:\x2060vh;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2ebd15+_0x350d70(0x122e);document[_0x350d70(0x1da9)][_0x350d70(0x1b7)](_0x350d70(0x42e),_0x4849ef);}function hideMemoryModal(){const _0x385b8b=_0x211817,_0xbdb9e=document[_0x385b8b(0x1262)]('memory-view-modal');if(_0xbdb9e)_0xbdb9e['remove']();}function toggleEditMode(_0x893f07,_0x3ff1bf){const _0x3ed9b7=_0x211817,_0x4d0b6b=document[_0x3ed9b7(0xb30)]('[data-memory-id=\x22'+_0x893f07+'\x22]');if(!_0x4d0b6b)return;const _0x1cfeee=_0x4d0b6b[_0x3ed9b7(0xb30)](_0x3ed9b7(0x1a66)),_0x23a4a7=_0x4d0b6b[_0x3ed9b7(0xb30)](_0x3ed9b7(0x1c4b)),_0x4c78df=_0x4d0b6b[_0x3ed9b7(0xb30)](_0x3ed9b7(0xee3)),_0x2f1ef6=_0x4d0b6b[_0x3ed9b7(0xb30)](_0x3ed9b7(0x19a5)),_0x1a2ccd=_0x4d0b6b[_0x3ed9b7(0xb30)](_0x3ed9b7(0x1f69)),_0xbca4fe=_0x1cfeee[_0x3ed9b7(0x2139)](_0x3ed9b7(0xad6));_0x1cfeee[_0x3ed9b7(0x33a)]=_0x3ed9b7(0x1ee1)+_0xbca4fe+_0x3ed9b7(0xd46),_0x23a4a7[_0x3ed9b7(0x14eb)][_0x3ed9b7(0x4da)]=_0x3ed9b7(0x102b),_0x4c78df['style'][_0x3ed9b7(0x4da)]=_0x3ed9b7(0xae7),_0x2f1ef6['style'][_0x3ed9b7(0x4da)]=_0x3ed9b7(0xae7),_0x1a2ccd[_0x3ed9b7(0x14eb)][_0x3ed9b7(0x4da)]=_0x3ed9b7(0x102b);const _0x5edb15=_0x1cfeee['querySelector'](_0x3ed9b7(0x368));_0x5edb15[_0x3ed9b7(0x13cf)](),_0x5edb15[_0x3ed9b7(0x207)](_0x5edb15['value'][_0x3ed9b7(0x19ee)],_0x5edb15[_0x3ed9b7(0x1ebc)][_0x3ed9b7(0x19ee)]);}async function saveMemoryEdit(_0x444237,_0xea1509){const _0x27b1dc=_0x211817,_0x26f8d2=document['querySelector']('[data-memory-id=\x22'+_0x444237+'\x22]');if(!_0x26f8d2)return;const _0x421d5d=_0x26f8d2[_0x27b1dc(0xb30)](_0x27b1dc(0x1a66)),_0x128dda=_0x421d5d['querySelector'](_0x27b1dc(0x368)),_0x1e54f7=_0x128dda[_0x27b1dc(0x1ebc)][_0x27b1dc(0x19d7)]();if(!_0x1e54f7){showToast(_0x27b1dc(0x570),'error');return;}try{let _0x48bf61,_0x298bc7;if(_0xea1509===_0x27b1dc(0x228e))_0x48bf61=await db[_0x27b1dc(0x127e)][_0x27b1dc(0xb78)](_0x444237),_0x298bc7=_0x27b1dc(0x13e5);else _0xea1509===_0x27b1dc(0x1490)&&(_0x48bf61=await db['memorySummaries'][_0x27b1dc(0xb78)](_0x444237),_0x298bc7=_0x27b1dc(0x1490));if(!_0x48bf61){showToast(_0x27b1dc(0x359),'error');return;}_0x48bf61[_0x298bc7]=_0x1e54f7;if(_0xea1509===_0x27b1dc(0x228e))await db[_0x27b1dc(0x127e)][_0x27b1dc(0x1561)](_0x48bf61),showToast(_0x27b1dc(0x5f8),'success');else _0xea1509===_0x27b1dc(0x1490)&&(await db[_0x27b1dc(0x203a)][_0x27b1dc(0x1561)](_0x48bf61),showToast(_0x27b1dc(0x3ed),'success'));exitEditMode(_0x444237,_0x1e54f7);}catch(_0x5567ad){console[_0x27b1dc(0x174a)]('保存记忆失败:',_0x5567ad),showToast('保存记忆失败',_0x27b1dc(0x174a));}}function cancelMemoryEdit(_0x445d8a,_0x14290c){const _0x3ee715=_0x211817,_0x4e1776=document[_0x3ee715(0xb30)](_0x3ee715(0x292)+_0x445d8a+'\x22]');if(!_0x4e1776)return;const _0x2f76b0=_0x4e1776[_0x3ee715(0xb30)](_0x3ee715(0x1a66)),_0x120046=_0x2f76b0[_0x3ee715(0x2139)]('data-original-content');exitEditMode(_0x445d8a,_0x120046);}function exitEditMode(_0x5b67b2,_0x4fe5b8){const _0x2da6eb=_0x211817,_0x2abb4e=document[_0x2da6eb(0xb30)](_0x2da6eb(0x292)+_0x5b67b2+'\x22]');if(!_0x2abb4e)return;const _0x41e761=_0x2abb4e[_0x2da6eb(0xb30)](_0x2da6eb(0x1a66)),_0x5c5684=_0x2abb4e[_0x2da6eb(0xb30)](_0x2da6eb(0x1c4b)),_0x3247f6=_0x2abb4e[_0x2da6eb(0xb30)](_0x2da6eb(0xee3)),_0x34940e=_0x2abb4e[_0x2da6eb(0xb30)](_0x2da6eb(0x19a5)),_0x21504b=_0x2abb4e[_0x2da6eb(0xb30)](_0x2da6eb(0x1f69));_0x41e761[_0x2da6eb(0x33a)]=_0x4fe5b8,_0x41e761[_0x2da6eb(0x1058)]('data-original-content',_0x4fe5b8),_0x5c5684[_0x2da6eb(0x14eb)][_0x2da6eb(0x4da)]=_0x2da6eb(0xae7),_0x3247f6[_0x2da6eb(0x14eb)][_0x2da6eb(0x4da)]='none',_0x34940e[_0x2da6eb(0x14eb)][_0x2da6eb(0x4da)]=_0x2da6eb(0x102b),_0x21504b['style'][_0x2da6eb(0x4da)]='inline-block';}async function deleteMemoryItem(_0x52a9d3,_0x3bb910){const _0x4f6596=_0x211817;if(!confirm(_0x4f6596(0x118d)))return;try{if(_0x3bb910===_0x4f6596(0x228e))await db['coreMemories'][_0x4f6596(0x1f4a)](_0x52a9d3),showToast('核心记忆已删除','success');else _0x3bb910===_0x4f6596(0x1490)&&(await db[_0x4f6596(0x203a)][_0x4f6596(0x1f4a)](_0x52a9d3),showToast(_0x4f6596(0x3af),_0x4f6596(0x11cb)));if(_0x3bb910==='core')viewCoreMemories();else _0x3bb910==='summary'&&viewMemorySummaries();}catch(_0x5b9590){console[_0x4f6596(0x174a)]('删除记忆失败:',_0x5b9590),showToast(_0x4f6596(0x1fb4),_0x4f6596(0x174a));}}async function viewCoreMemories(){const _0x3df36e=_0x211817;if(!currentChatCharacter){showToast(_0x3df36e(0x1346),_0x3df36e(0x174a));return;}hideGlobalMemorySettings();const _0x31e7ba=showLoadingModal(_0x3df36e(0xa7e),'读取重要信息中');try{const _0x111722=await db[_0x3df36e(0x127e)]['where'](_0x3df36e(0xaf5))['equals'](currentChatCharacter['id'])[_0x3df36e(0xf13)]();_0x111722[_0x3df36e(0x1104)]((_0x23a63e,_0x11784f)=>(_0x11784f[_0x3df36e(0x146c)]||0x0)-(_0x23a63e[_0x3df36e(0x146c)]||0x0));const _0xf1ec40=_0x111722[_0x3df36e(0x6d5)](0x0,0xa);hideLoadingModal(_0x31e7ba),showMemoryModal(_0x3df36e(0x498),_0xf1ec40,'core');}catch(_0x114cf4){hideLoadingModal(_0x31e7ba),console[_0x3df36e(0x174a)](_0x3df36e(0x8ed),_0x114cf4),showToast(_0x3df36e(0xd09),_0x3df36e(0x174a));}}async function viewMemorySummaries(){const _0x66968e=_0x211817;if(!currentChatCharacter){showToast(_0x66968e(0x1346),_0x66968e(0x174a));return;}hideGlobalMemorySettings();const _0x2d3c54=showLoadingModal('正在加载记忆摘要...',_0x66968e(0x1420));try{const _0x1fa6f8=await db[_0x66968e(0x203a)][_0x66968e(0xa24)](_0x66968e(0xaf5))[_0x66968e(0x1694)](currentChatCharacter['id'])[_0x66968e(0xf13)]();_0x1fa6f8[_0x66968e(0x1104)]((_0x2d7056,_0x19b02a)=>_0x19b02a['timestamp']-_0x2d7056[_0x66968e(0x1716)]);const _0x3dd28f=_0x1fa6f8[_0x66968e(0x6d5)](0x0,0xa);hideLoadingModal(_0x2d3c54),showMemoryModal(_0x66968e(0x599),_0x3dd28f,_0x66968e(0x1490));}catch(_0x5017d6){hideLoadingModal(_0x2d3c54),console['error'](_0x66968e(0x109c),_0x5017d6),showToast('查看记忆摘要失败',_0x66968e(0x174a));}}async function generateDailySummary(){const _0x479108=_0x211817;if(!currentChatCharacter){showToast(_0x479108(0x1346),_0x479108(0x174a));return;}const _0x3d0a34=showLoadingModal('正在生成今日摘要...','这可能需要几秒钟时间');try{const _0x5d5140=new Date(),_0x39587c=new Date(_0x5d5140[_0x479108(0x16a0)](),_0x5d5140[_0x479108(0x1da)](),_0x5d5140[_0x479108(0x520)]())[_0x479108(0x704)](),_0x132b82=_0x39587c+0x18*0x3c*0x3c*0x3e8,_0x1cd807=await generateMemorySummary(currentChatCharacter['id'],_0x39587c,_0x132b82,{'type':currentChatCharacter[_0x479108(0x1f68)]?_0x479108(0x764):_0x479108(0x219),'id':currentChatCharacter['id']});hideLoadingModal(_0x3d0a34),_0x1cd807?(showToast(_0x479108(0x1158),_0x479108(0x11cb)),alert(_0x479108(0x22cd)+_0x1cd807[_0x479108(0x1490)])):showToast(_0x479108(0x19b1),_0x479108(0x1816));}catch(_0x59013f){hideLoadingModal(_0x3d0a34),console[_0x479108(0x174a)](_0x479108(0xc8a),_0x59013f),showToast('生成今日摘要失败',_0x479108(0x174a));}}function showMemoryShareSettings(){const _0x1b5332=_0x211817;if(!currentChatCharacter||currentChatCharacter[_0x1b5332(0x1f68)]){showToast('此功能仅适用于单聊','error');return;}const _0x3cf478=groupChats['filter'](_0x40ccec=>_0x40ccec[_0x1b5332(0x12a6)]&&_0x40ccec['members']['some'](_0x49cf5f=>_0x49cf5f['id']===currentChatCharacter['id']));if(_0x3cf478[_0x1b5332(0x19ee)]===0x0){showToast(_0x1b5332(0x3ae),_0x1b5332(0x1816));return;}const _0x5a96c2=getCurrentChatSettings(),_0x566a7f=_0x5a96c2[_0x1b5332(0x1ec5)]||[],_0xcc697a=_0x1b5332(0x1ee5)+_0x3cf478[_0x1b5332(0x6a4)](_0x3e95b0=>_0x1b5332(0x114f)+_0x3e95b0['id']+'\x22\x20'+(_0x566a7f[_0x1b5332(0x1831)](_0x3e95b0['id'])?_0x1b5332(0x14c1):'')+_0x1b5332(0x19f2)+_0x3e95b0[_0x1b5332(0x1a1c)]+_0x1b5332(0x1062))['join']('')+_0x1b5332(0x8e4);document[_0x1b5332(0x1da9)][_0x1b5332(0x1b7)](_0x1b5332(0x42e),_0xcc697a);}async function saveMemoryShareSettings(){const _0x1aa68b=_0x211817,_0x241cec=Array[_0x1aa68b(0x13c0)](document[_0x1aa68b(0x1897)](_0x1aa68b(0x37f)))['map'](_0x3ba776=>_0x3ba776[_0x1aa68b(0x1ebc)]),_0x20d02a=getCurrentChatSettings();_0x20d02a['memorySharedGroupIds']=_0x241cec,_0x20d02a[_0x1aa68b(0x1336)]=_0x241cec[_0x1aa68b(0x19ee)]>0x0?_0x241cec[0x0]:'',await saveChatSettings(),updateMemoryShareStatus(),hideMemoryShareSettings();if(_0x241cec[_0x1aa68b(0x19ee)]>0x0){const _0x59b26c=_0x241cec[_0x1aa68b(0x6a4)](_0x5c5ff6=>{const _0x156626=_0x1aa68b,_0x4192f3=groupChats[_0x156626(0xaf4)](_0x4dac78=>_0x4dac78['id']===_0x5c5ff6);return _0x4192f3?_0x4192f3[_0x156626(0x1a1c)]:_0x156626(0x696);})[_0x1aa68b(0x122b)]('、');showToast(_0x1aa68b(0x1449)+_0x59b26c+_0x1aa68b(0x1c6b),_0x1aa68b(0x11cb));}else showToast('已关闭记忆共享','success');}function hideMemoryShareSettings(){const _0x1c8cd1=_0x211817,_0xf07da3=document['getElementById']('memory-share-modal');if(_0xf07da3)_0xf07da3[_0x1c8cd1(0x1493)]();}function updateMemoryShareStatus(){const _0x5c2cc1=_0x211817,_0x3f1686=document[_0x5c2cc1(0x1262)](_0x5c2cc1(0x1717));if(!_0x3f1686)return;const _0x1f8827=getCurrentChatSettings(),_0x24c60d=_0x1f8827[_0x5c2cc1(0x1ec5)]||[];if(_0x24c60d[_0x5c2cc1(0x19ee)]>0x0){if(_0x24c60d['length']===0x1){const _0x45da0c=groupChats['find'](_0x22486c=>_0x22486c['id']===_0x24c60d[0x0]);_0x3f1686[_0x5c2cc1(0x13be)]=_0x45da0c?'与\x22'+_0x45da0c['name']+_0x5c2cc1(0x1549):_0x5c2cc1(0x10a0);}else _0x3f1686[_0x5c2cc1(0x13be)]='与'+_0x24c60d['length']+_0x5c2cc1(0x28a);}else _0x3f1686[_0x5c2cc1(0x13be)]=_0x5c2cc1(0x1c47);}function backFromDiary(){const _0x456f47=_0x211817,_0x640727=document[_0x456f47(0x1262)](_0x456f47(0x154e));if(_0x640727&&_0x640727[_0x456f47(0x1c1b)]['contains'](_0x456f47(0x1a14))){backFromSingleDiary();return;}const _0xbe0f1e=window[_0x456f47(0x6d8)]||_0x456f47(0xcf2);hideApp('diary-screen'),showApp(_0xbe0f1e),window[_0x456f47(0x6d8)]=null;}function showDiaryMenu(){const _0x390d26=_0x211817;if(!currentChatCharacter){showToast(_0x390d26(0x1346),'error');return;}if(currentChatCharacter[_0x390d26(0x1f68)]){showToast(_0x390d26(0x1d74),'error');return;}window['diarySourceScreen']=_0x390d26(0xcf2),showApp(_0x390d26(0x1d1a)),initDiaryPaper(),switchDiaryTab(_0x390d26(0x11a5)),loadTodayDiary();}function switchDiaryTab(_0x52adb9){const _0x195000=_0x211817;document['querySelectorAll']('.diary-view')[_0x195000(0x19fb)](_0x112a79=>{const _0x4f5fa7=_0x195000;_0x112a79[_0x4f5fa7(0x1c1b)]['remove'](_0x4f5fa7(0x1a14));});const _0x5e3edf=document[_0x195000(0x1262)]('diary-mode-title'),_0x12322d=document['getElementById'](_0x195000(0x118c));if(_0x52adb9==='today'){document[_0x195000(0x1262)](_0x195000(0x17b4))[_0x195000(0x1c1b)][_0x195000(0x21e2)](_0x195000(0x1a14));if(_0x5e3edf)_0x5e3edf['textContent']=_0x195000(0x6f5);loadTodayDiary();}else{if(_0x52adb9==='past'){document['getElementById'](_0x195000(0xfd2))[_0x195000(0x1c1b)][_0x195000(0x21e2)]('active');if(_0x5e3edf)_0x5e3edf[_0x195000(0x13be)]=_0x195000(0x127a);if(_0x12322d)_0x12322d[_0x195000(0x14eb)][_0x195000(0x4da)]=_0x195000(0x102b);loadPastDiaries();}}}let gomokuGameState={'board':null,'currentPlayer':_0x211817(0xa80),'gameActive':![],'gameStartTime':null,'gameSession':null,'chatHistory':[],'moveHistory':[],'gameTimer':null};function showGameMenu(){const _0x4ff651=_0x211817;if(!currentChatCharacter){showToast(_0x4ff651(0x1346),_0x4ff651(0x174a));return;}generateGameButtons(),showModal(_0x4ff651(0x231));}function generateGameButtons(){const _0x3776d4=_0x211817,_0x3c59ca=document[_0x3776d4(0x1262)]('game-buttons-container'),_0x415e94=currentChatCharacter&&currentChatCharacter[_0x3776d4(0x1f68)],_0x469f6d={'gomoku':{'name':_0x3776d4(0xae1),'desc':_0x3776d4(0xa08),'icon':_0x3776d4(0x383),'class':'gomoku','badge':null,'badgeText':'','singleChat':!![],'groupChat':![],'available':!![]},'turtle-soup':{'name':_0x3776d4(0x80e),'desc':_0x3776d4(0xa5f),'icon':_0x3776d4(0x1fa7),'class':_0x3776d4(0x1fff),'badge':null,'badgeText':'','singleChat':!![],'groupChat':!![],'available':!![]},'werewolf':{'name':_0x3776d4(0x389),'desc':'多人推理游戏，适合群聊','icon':_0x3776d4(0xee1),'class':'werewolf','badge':_0x3776d4(0x1536),'badgeText':'开发中','singleChat':![],'groupChat':!![],'available':![]},'monopoly':{'name':_0x3776d4(0x1b55),'desc':_0x3776d4(0x4dc),'icon':'fas\x20fa-building','class':'monopoly','badge':_0x3776d4(0x1536),'badgeText':_0x3776d4(0x11ba),'singleChat':![],'groupChat':!![],'available':![]}},_0x4e1ab5=Object[_0x3776d4(0x2bc)](_0x469f6d)[_0x3776d4(0x1e1f)](([_0x5c2625,_0x55ac2f])=>{const _0x13f2b7=_0x3776d4;return _0x415e94?_0x55ac2f[_0x13f2b7(0x103b)]:_0x55ac2f[_0x13f2b7(0x1a13)];});_0x3c59ca[_0x3776d4(0x33a)]=_0x4e1ab5[_0x3776d4(0x6a4)](([_0x1795d7,_0x35ea9c])=>{const _0x4686b5=_0x3776d4,_0x3de139=_0x35ea9c[_0x4686b5(0xa66)]?'':_0x4686b5(0x1ccc),_0x46601f=_0x35ea9c[_0x4686b5(0x1f27)]?_0x4686b5(0x9e6)+_0x35ea9c['badge']+'\x22>'+_0x35ea9c[_0x4686b5(0xacb)]+_0x4686b5(0x1844):'';return _0x4686b5(0x1b95)+_0x35ea9c['class']+_0x3de139+_0x4686b5(0xbcf)+_0x1795d7+_0x4686b5(0x397)+(!_0x35ea9c[_0x4686b5(0xa66)]?_0x4686b5(0x559):'')+'>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22'+_0x35ea9c[_0x4686b5(0x40d)]+_0x4686b5(0x212c)+_0x35ea9c[_0x4686b5(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-button-desc\x22>'+_0x35ea9c['desc']+_0x4686b5(0x1e16)+_0x46601f+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';})[_0x3776d4(0x122b)]('');}function hideGameMenu(){const _0x983a7c=_0x211817;hideModal(_0x983a7c(0x231));}function selectGame(_0x7ce97f){const _0x5cd883=_0x211817;if(!currentChatCharacter){showToast(_0x5cd883(0x1346),_0x5cd883(0x174a));return;}if(_0x7ce97f===_0x5cd883(0x1bcc)||_0x7ce97f===_0x5cd883(0x1988)){showToast('该游戏正在开发中，敬请期待！',_0x5cd883(0x477));return;}hideGameMenu(),showWaitingModal(),requestGameWithAI(_0x7ce97f);}function showWaitingModal(){const _0x2f78a2=_0x211817,_0x42ee9a=document[_0x2f78a2(0xac6)](_0x2f78a2(0xbbc));_0x42ee9a[_0x2f78a2(0x1722)]=_0x2f78a2(0x67a),_0x42ee9a['id']=_0x2f78a2(0x37a),_0x42ee9a[_0x2f78a2(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22waiting-text\x22>正在等待对方接受...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document['body'][_0x2f78a2(0x497)](_0x42ee9a);}function hideWaitingModal(){const _0x355e65=_0x211817,_0x316139=document[_0x355e65(0x1262)](_0x355e65(0x37a));_0x316139&&_0x316139['remove']();}function requestGameWithAI(_0x1cb717){const _0x489f64=_0x211817,_0x50ef93={'gomoku':'五子棋','turtle-soup':_0x489f64(0xbea),'werewolf':_0x489f64(0x389),'monopoly':_0x489f64(0x1b55)},_0xf0b877=_0x50ef93[_0x1cb717]||_0x1cb717;setTimeout(()=>{const _0x2b9a0e=_0x489f64,_0x5e40cc=Math[_0x2b9a0e(0x11a8)]()>0.2;hideWaitingModal(),_0x5e40cc?startGameSession(_0x1cb717,_0xf0b877):showToast(currentChatCharacter['name']+_0x2b9a0e(0x1f6c)+_0xf0b877+_0x2b9a0e(0x5cd),_0x2b9a0e(0x477));},0x7d0+Math[_0x489f64(0x11a8)]()*0x7d0);}function startGameSession(_0x46c925,_0x2f79dd){const _0x5a4ebc=_0x211817;showToast(_0x5a4ebc(0x53a)+_0x2f79dd+'...',_0x5a4ebc(0x477)),setTimeout(async()=>{const _0x45eaf1=_0x5a4ebc;if(_0x46c925==='gomoku')await startGomokuGame();else _0x46c925===_0x45eaf1(0x1fff)?await startTurtleSoupGame():alert(_0x45eaf1(0x803)+_0x2f79dd+_0x45eaf1(0x471));},0x1f4);}function startGomokuGame(){const _0x59f19f=localStorage['getItem']('gomoku_saved_game');_0x59f19f?showContinueGameModal():startNewGomokuGame();}function showContinueGameModal(){const _0x54370d=_0x211817,_0x409d53=document['createElement'](_0x54370d(0xbbc));_0x409d53[_0x54370d(0x1722)]=_0x54370d(0x782),_0x409d53[_0x54370d(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-overlay\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>发现保存的游戏</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22game-exit-desc\x22>检测到有未完成的五子棋游戏，请选择：</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22game-exit-options\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20pause-btn\x22\x20onclick=\x22continueGomokuGame()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-play-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>继续上一局游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22game-exit-btn\x20save-btn\x22\x20onclick=\x22startNewGomokuGameFromModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-plus-circle\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-title\x22>开始新游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22btn-desc\x22>将清除保存的游戏</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x4cdc4a=document[_0x54370d(0x1262)](_0x54370d(0x1548));_0x4cdc4a?_0x4cdc4a[_0x54370d(0x497)](_0x409d53):document['body'][_0x54370d(0x497)](_0x409d53);}function continueGomokuGame(){const _0x405079=_0x211817,_0x4e6f56=JSON['parse'](localStorage[_0x405079(0x15d8)](_0x405079(0x25e)));document[_0x405079(0xb30)](_0x405079(0x20ee))['remove'](),hideApp(_0x405079(0x1c2a)),showApp(_0x405079(0xba9)),gomokuGameState={'board':_0x4e6f56['board'],'currentPlayer':_0x4e6f56[_0x405079(0x6b2)],'gameActive':!![],'gameStartTime':_0x4e6f56[_0x405079(0x1ca9)],'userIsBlack':_0x4e6f56[_0x405079(0x10ee)]||!![],'gameSession':_0x4e6f56[_0x405079(0x19e0)],'chatHistory':_0x4e6f56[_0x405079(0x10e5)]||[],'moveHistory':_0x4e6f56[_0x405079(0x1abe)],'gameTimer':null},gomokuGameState['gameSession'][_0x405079(0x260)][_0x405079(0x1cd6)]({'type':_0x405079(0xb88),'timestamp':Date[_0x405079(0x2eb)](),'player':_0x405079(0x1744),'data':{'reason':_0x405079(0x210)}}),createGomokuBoard(),updateBoardUI(),updateGomokuUI(),updatePlayerPieceDisplay(),startGameTimer(),setupAIPlayerInfo(),updatePlayerPieceDisplay();const _0x592b58=document[_0x405079(0x1262)]('gomoku-chat-messages');_0x592b58[_0x405079(0x33a)]='',_0x4e6f56['chatHistory']&&_0x4e6f56[_0x405079(0x10e5)][_0x405079(0x19fb)](_0x45e53f=>{const _0x39bb9a=_0x405079;addGameChatMessage(_0x45e53f[_0x39bb9a(0x8a1)],_0x45e53f['content'],![]);}),addGameChatMessage(_0x405079(0x1744),_0x405079(0x180f)),addGameChatMessage('ai',_0x405079(0x161c),!![]);}function startNewGomokuGameFromModal(){const _0x16977b=_0x211817;localStorage['removeItem']('gomoku_saved_game'),document[_0x16977b(0xb30)]('.game-exit-modal')[_0x16977b(0x1493)](),startNewGomokuGame();}function startNewGomokuGame(){const _0x233511=_0x211817;hideApp(_0x233511(0x1c2a)),showApp(_0x233511(0xba9)),initGomokuGame(),recordGameStart();}async function initGomokuGame(){const _0x21ca12=_0x211817,_0x2d8b32=Math[_0x21ca12(0x11a8)]()<0.5,_0x435ca2=_0x2d8b32?_0x21ca12(0xa80):'ai';gomokuGameState={'board':Array(0xf)[_0x21ca12(0xa2d)]()[_0x21ca12(0x6a4)](()=>Array(0xf)['fill'](null)),'currentPlayer':_0x435ca2,'gameActive':!![],'gameStartTime':Date[_0x21ca12(0x2eb)](),'userIsBlack':_0x2d8b32,'gameSession':{'gameId':_0x21ca12(0x2029)+Date[_0x21ca12(0x2eb)](),'players':[_0x21ca12(0xa80),currentChatCharacter['id']],'boardState':[],'chatHistory':[],'gameEvents':[{'type':_0x21ca12(0x18bc),'timestamp':Date[_0x21ca12(0x2eb)](),'player':_0x21ca12(0x1744),'data':{'gameName':_0x21ca12(0xae1),'userIsBlack':_0x2d8b32,'firstPlayer':_0x435ca2}}]},'chatHistory':[],'moveHistory':[],'gameTimer':null},createGomokuBoard(),updateGomokuUI(),updatePlayerPieceDisplay(),startGameTimer(),setupAIPlayerInfo(),updatePlayerPieceDisplay();const _0x316bd5=_0x2d8b32?'黑子':'白子',_0x458e49=_0x2d8b32?'白子':'黑子',_0x52c3c0=_0x435ca2==='user'?_0x21ca12(0xe44):_0x21ca12(0x18fa);addGameChatMessage(_0x21ca12(0x1744),_0x21ca12(0x16ba)+_0x316bd5+'，'+_0x52c3c0+'。'),currentChatCharacter&&await recordGameEvent(currentChatCharacter['id'],_0x21ca12(0x18bc),{'gameName':'五子棋','result':null,'score':null,'chatContent':_0x21ca12(0xa94)+_0x458e49+_0x21ca12(0xdca)+_0x316bd5+'，'+(_0x435ca2==='user'?_0x21ca12(0x2e4):'你先行')}),_0x435ca2==='ai'&&setTimeout(()=>{makeAIMove();},0x7d0);}function createGomokuBoard(){const _0x3aeb83=_0x211817,_0x1a3632=document['getElementById'](_0x3aeb83(0x1d9));_0x1a3632[_0x3aeb83(0x33a)]='';for(let _0x532eb5=0x0;_0x532eb5<0xe;_0x532eb5++){for(let _0x27bafb=0x0;_0x27bafb<0xe;_0x27bafb++){const _0x2870f2=document['createElement'](_0x3aeb83(0xbbc));_0x2870f2[_0x3aeb83(0x1722)]=_0x3aeb83(0x1080),_0x1a3632[_0x3aeb83(0x497)](_0x2870f2);}}for(let _0x4d2d51=0x0;_0x4d2d51<0xf;_0x4d2d51++){for(let _0x5ccbd4=0x0;_0x5ccbd4<0xf;_0x5ccbd4++){const _0x2cab86=document[_0x3aeb83(0xac6)]('div');_0x2cab86['className']=_0x3aeb83(0x12d0),_0x2cab86[_0x3aeb83(0x1ecd)]['row']=_0x4d2d51,_0x2cab86[_0x3aeb83(0x1ecd)][_0x3aeb83(0x10ce)]=_0x5ccbd4,_0x2cab86['onclick']=()=>handleCellClick(_0x4d2d51,_0x5ccbd4);const _0x18f1c7=0x12c/0xe,_0x1455c7=0x10;_0x2cab86[_0x3aeb83(0x14eb)][_0x3aeb83(0xbc7)]='absolute',_0x2cab86['style'][_0x3aeb83(0x15dc)]=_0x5ccbd4*_0x18f1c7-_0x1455c7/0x2+'px',_0x2cab86[_0x3aeb83(0x14eb)][_0x3aeb83(0x825)]=_0x4d2d51*_0x18f1c7-_0x1455c7/0x2+'px',_0x2cab86[_0x3aeb83(0x14eb)][_0x3aeb83(0x12f1)]=_0x1455c7+'px',_0x2cab86['style'][_0x3aeb83(0xe6b)]=_0x1455c7+'px',_0x2cab86['style']['cursor']=_0x3aeb83(0x1b16),_0x2cab86[_0x3aeb83(0x14eb)][_0x3aeb83(0x1cf9)]=_0x3aeb83(0x1304),_0x2cab86[_0x3aeb83(0x14eb)]['transition']=_0x3aeb83(0xa32),_0x2cab86[_0x3aeb83(0x14eb)]['display']=_0x3aeb83(0x1fb7),_0x2cab86['style']['alignItems']=_0x3aeb83(0xcef),_0x2cab86['style']['justifyContent']=_0x3aeb83(0xcef),_0x2cab86[_0x3aeb83(0x14eb)][_0x3aeb83(0x1b76)]='10',_0x1a3632[_0x3aeb83(0x497)](_0x2cab86);}}}async function handleCellClick(_0x5b3854,_0x33a71d){const _0x3f2173=_0x211817;if(!gomokuGameState['gameActive']||gomokuGameState[_0x3f2173(0x6b2)]!==_0x3f2173(0xa80)||gomokuGameState['board'][_0x5b3854][_0x33a71d]!==null)return;await makeMove(_0x5b3854,_0x33a71d,_0x3f2173(0xa80));}async function makeMove(_0x413582,_0x3cdf4d,_0x447ba9){const _0x4f5de8=_0x211817;gomokuGameState['board'][_0x413582][_0x3cdf4d]=_0x447ba9;const _0x1099d0={'row':_0x413582,'col':_0x3cdf4d,'player':_0x447ba9,'timestamp':Date[_0x4f5de8(0x2eb)](),'moveNumber':gomokuGameState[_0x4f5de8(0x1abe)][_0x4f5de8(0x19ee)]+0x1};gomokuGameState[_0x4f5de8(0x1abe)][_0x4f5de8(0x1cd6)](_0x1099d0),gomokuGameState[_0x4f5de8(0x19e0)][_0x4f5de8(0x260)][_0x4f5de8(0x1cd6)]({'type':_0x4f5de8(0x1874),'timestamp':Date[_0x4f5de8(0x2eb)](),'player':_0x447ba9,'data':{'row':_0x413582,'col':_0x3cdf4d,'moveNumber':_0x1099d0['moveNumber']}}),updateBoardUI(),gomokuGameState[_0x4f5de8(0x6b2)]=_0x447ba9==='user'?'ai':'user',updateGomokuUI();const _0x31c703=checkWinner(_0x413582,_0x3cdf4d);if(_0x31c703){endGame(_0x31c703);return;}if(gomokuGameState[_0x4f5de8(0x1abe)][_0x4f5de8(0x19ee)]>=0xe1){endGame(_0x4f5de8(0x1168));return;}gomokuGameState[_0x4f5de8(0x6b2)]==='ai'&&(setTimeout(()=>{const _0x260793=_0x4f5de8,_0x5bb0d8=document[_0x260793(0x1262)](_0x260793(0xff2));_0x5bb0d8[_0x260793(0x13be)]='对方思考中…',_0x5bb0d8[_0x260793(0x14eb)][_0x260793(0xc3d)]=_0x260793(0x157b);},0x1f4),setTimeout(()=>{makeAIMove();},0x3e8+Math['random']()*0x7d0));}async function makeAIMove(){const _0x12260b=_0x211817;if(!gomokuGameState[_0x12260b(0x230f)]||gomokuGameState[_0x12260b(0x6b2)]!=='ai')return;if(!currentChatCharacter){makeBackupMove();return;}try{const _0x522cc2=document[_0x12260b(0x1262)](_0x12260b(0xff2));_0x522cc2[_0x12260b(0x13be)]=currentChatCharacter[_0x12260b(0x1a1c)]+_0x12260b(0xae3),_0x522cc2[_0x12260b(0x14eb)]['color']=_0x12260b(0x157b);const _0x1f602a=await getAIMoveFromAPI();_0x1f602a&&_0x1f602a[_0x12260b(0x206f)]!==undefined&&_0x1f602a['col']!==undefined?isValidMove(_0x1f602a[_0x12260b(0x206f)],_0x1f602a[_0x12260b(0x10ce)])?setTimeout(async()=>{const _0x266727=_0x12260b;await makeMove(_0x1f602a['row'],_0x1f602a['col'],'ai'),_0x1f602a[_0x266727(0x716)]&&setTimeout(()=>{const _0x3d699d=_0x266727;addGameChatMessage('ai',_0x1f602a[_0x3d699d(0x716)],!![]);},0x1f4);},0x320+Math[_0x12260b(0x11a8)]()*0x4b0):(console[_0x12260b(0x1f43)](_0x12260b(0x120a)),makeBackupMove()):(console[_0x12260b(0x1f43)](_0x12260b(0x12ed)),makeBackupMove());}catch(_0x204c38){console[_0x12260b(0x174a)](_0x12260b(0x486),_0x204c38),makeBackupMove();}}function makeRandomMove(){const _0x4ee119=_0x211817,_0x2e557a=[];for(let _0x13fd91=0x0;_0x13fd91<0xf;_0x13fd91++){for(let _0x4b3cca=0x0;_0x4b3cca<0xf;_0x4b3cca++){gomokuGameState[_0x4ee119(0x17d2)][_0x13fd91][_0x4b3cca]===null&&_0x2e557a['push']({'row':_0x13fd91,'col':_0x4b3cca});}}if(_0x2e557a['length']>0x0){const _0x2b30fb=Math[_0x4ee119(0x2180)](Math[_0x4ee119(0x11a8)]()*_0x2e557a[_0x4ee119(0x19ee)]),{row:_0x4fdd67,col:_0x561c33}=_0x2e557a[_0x2b30fb];setTimeout(async()=>{await makeMove(_0x4fdd67,_0x561c33,'ai');},0x1f4);}}function findBestMove(_0xdc9df4){const _0x194adc=_0x211817,_0x68794a=gomokuGameState[_0x194adc(0x17d2)],_0x467d61=findWinningMove('ai');if(_0x467d61)return _0x467d61;const _0x47755c=findWinningMove(_0x194adc(0xa80));if(_0x47755c)return _0x47755c;if(_0xdc9df4>=0x2){const _0x19b15b=findStrategicMove(_0xdc9df4);if(_0x19b15b)return _0x19b15b;}const _0x3cd08a=findCenterMove();if(_0x3cd08a)return _0x3cd08a;return null;}function findWinningMove(_0x1bf952){const _0x360077=_0x211817;for(let _0x226675=0x0;_0x226675<0xf;_0x226675++){for(let _0x45a236=0x0;_0x45a236<0xf;_0x45a236++){if(gomokuGameState[_0x360077(0x17d2)][_0x226675][_0x45a236]===null){gomokuGameState[_0x360077(0x17d2)][_0x226675][_0x45a236]=_0x1bf952;if(checkWinner(_0x226675,_0x45a236))return gomokuGameState['board'][_0x226675][_0x45a236]=null,{'row':_0x226675,'col':_0x45a236};gomokuGameState[_0x360077(0x17d2)][_0x226675][_0x45a236]=null;}}}return null;}function findStrategicMove(_0x39e4ee){const _0x1cc13e=_0x211817;let _0x26d080=-0x1,_0x2efae8=null;for(let _0x14d5d2=0x0;_0x14d5d2<0xf;_0x14d5d2++){for(let _0x424d8d=0x0;_0x424d8d<0xf;_0x424d8d++){if(gomokuGameState[_0x1cc13e(0x17d2)][_0x14d5d2][_0x424d8d]===null){const _0x14ac0d=evaluatePosition(_0x14d5d2,_0x424d8d,'ai');_0x14ac0d>_0x26d080&&(_0x26d080=_0x14ac0d,_0x2efae8={'row':_0x14d5d2,'col':_0x424d8d});}}}return _0x2efae8;}function findCenterMove(){const _0x25eff2=_0x211817,_0x29b5de=0x7,_0x38544d=[];for(let _0x108f3a=0x0;_0x108f3a<=0x3;_0x108f3a++){for(let _0x268617=_0x29b5de-_0x108f3a;_0x268617<=_0x29b5de+_0x108f3a;_0x268617++){for(let _0x4f39fc=_0x29b5de-_0x108f3a;_0x4f39fc<=_0x29b5de+_0x108f3a;_0x4f39fc++){_0x268617>=0x0&&_0x268617<0xf&&_0x4f39fc>=0x0&&_0x4f39fc<0xf&&gomokuGameState[_0x25eff2(0x17d2)][_0x268617][_0x4f39fc]===null&&_0x38544d[_0x25eff2(0x1cd6)]({'row':_0x268617,'col':_0x4f39fc});}}if(_0x38544d['length']>0x0)break;}return _0x38544d[_0x25eff2(0x19ee)]>0x0?_0x38544d[Math[_0x25eff2(0x2180)](Math[_0x25eff2(0x11a8)]()*_0x38544d[_0x25eff2(0x19ee)])]:null;}function evaluatePosition(_0x1df9b7,_0x23220c,_0x2d04d7){let _0xea8694=0x0;const _0x2cdbbb=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0x316483,_0x22e079]of _0x2cdbbb){_0xea8694+=evaluateDirection(_0x1df9b7,_0x23220c,_0x316483,_0x22e079,_0x2d04d7);}return _0xea8694;}function evaluateDirection(_0x504bc4,_0x247d18,_0x57a8d5,_0x18a94d,_0xddc6b7){const _0x352ffd=_0x211817;let _0x4f225=0x1,_0x29be5e=0x0,_0x3282a7=_0x504bc4+_0x57a8d5,_0x477653=_0x247d18+_0x18a94d;while(_0x3282a7>=0x0&&_0x3282a7<0xf&&_0x477653>=0x0&&_0x477653<0xf&&gomokuGameState[_0x352ffd(0x17d2)][_0x3282a7][_0x477653]===_0xddc6b7){_0x4f225++,_0x3282a7+=_0x57a8d5,_0x477653+=_0x18a94d;}_0x3282a7>=0x0&&_0x3282a7<0xf&&_0x477653>=0x0&&_0x477653<0xf&&gomokuGameState[_0x352ffd(0x17d2)][_0x3282a7][_0x477653]===null&&_0x29be5e++;_0x3282a7=_0x504bc4-_0x57a8d5,_0x477653=_0x247d18-_0x18a94d;while(_0x3282a7>=0x0&&_0x3282a7<0xf&&_0x477653>=0x0&&_0x477653<0xf&&gomokuGameState['board'][_0x3282a7][_0x477653]===_0xddc6b7){_0x4f225++,_0x3282a7-=_0x57a8d5,_0x477653-=_0x18a94d;}_0x3282a7>=0x0&&_0x3282a7<0xf&&_0x477653>=0x0&&_0x477653<0xf&&gomokuGameState[_0x352ffd(0x17d2)][_0x3282a7][_0x477653]===null&&_0x29be5e++;if(_0x4f225>=0x5)return 0x2710;if(_0x4f225===0x4&&_0x29be5e>0x0)return 0x3e8;if(_0x4f225===0x3&&_0x29be5e===0x2)return 0x64;if(_0x4f225===0x3&&_0x29be5e===0x1)return 0xa;if(_0x4f225===0x2&&_0x29be5e===0x2)return 0x5;return _0x4f225*_0x29be5e;}async function getAIMoveFromAPI(){const _0x26e811=_0x211817;if(!currentChatCharacter)return null;const _0xdf22f1=getBoardDescription(),_0x29dd9b=getMoveHistoryDescription(),_0x337bec=getGameAnalysis(),_0x561e4d='你是'+currentChatCharacter[_0x26e811(0x1a1c)]+'，'+currentChatCharacter[_0x26e811(0x7a1)]+_0x26e811(0x1adb)+(gomokuGameState[_0x26e811(0x10ee)]?_0x26e811(0xba7):'黑子(●)')+_0x26e811(0xdca)+(gomokuGameState[_0x26e811(0x10ee)]?_0x26e811(0x1a27):_0x26e811(0xba7))+_0x26e811(0x1a49)+_0xdf22f1+'\x0a\x0a'+_0x29dd9b+'\x0a\x0a'+_0x337bec+_0x26e811(0x1df);try{const _0x1fa176=await callChatAPI(_0x561e4d,currentChatCharacter);return parseAIMoveResponse(_0x1fa176);}catch(_0x3e0275){return console['error']('AI下棋API调用失败:',_0x3e0275),null;}}function analyzeThreats(_0x1f7676,_0x332ad6,_0x19f1b){const _0xb34f3c=_0x211817,_0x4a6406=[],_0x43def2=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0x60b86f,_0x1c090e]of _0x43def2){const _0x2704f4=countDirection(_0x1f7676,_0x332ad6,_0x60b86f,_0x1c090e,_0x19f1b);_0x2704f4>=0x3&&_0x4a6406[_0xb34f3c(0x1cd6)]({'type':_0x2704f4===0x3?_0xb34f3c(0xe91):'four','direction':[_0x60b86f,_0x1c090e]});}return _0x4a6406;}function countDirection(_0xf90efd,_0x5d3578,_0x491f23,_0xbb4925,_0xea003c){let _0x508ef5=0x1,_0x222e8e=_0xf90efd+_0x491f23,_0x2daf2f=_0x5d3578+_0xbb4925;while(_0x222e8e>=0x0&&_0x222e8e<0xf&&_0x2daf2f>=0x0&&_0x2daf2f<0xf&&gomokuGameState['board'][_0x222e8e][_0x2daf2f]===_0xea003c){_0x508ef5++,_0x222e8e+=_0x491f23,_0x2daf2f+=_0xbb4925;}_0x222e8e=_0xf90efd-_0x491f23,_0x2daf2f=_0x5d3578-_0xbb4925;while(_0x222e8e>=0x0&&_0x222e8e<0xf&&_0x2daf2f>=0x0&&_0x2daf2f<0xf&&gomokuGameState['board'][_0x222e8e][_0x2daf2f]===_0xea003c){_0x508ef5++,_0x222e8e-=_0x491f23,_0x2daf2f-=_0xbb4925;}return _0x508ef5;}function isBlockingUserThreat(_0x595d4a,_0x5c5a7f){const _0x48836c=_0x211817;gomokuGameState[_0x48836c(0x17d2)][_0x595d4a][_0x5c5a7f]='user';const _0x1c8313=analyzeThreats(_0x595d4a,_0x5c5a7f,_0x48836c(0xa80));return gomokuGameState['board'][_0x595d4a][_0x5c5a7f]='ai',_0x1c8313[_0x48836c(0x19ee)]>0x0;}function getBoardDescription(){const _0x270521=_0x211817;let _0x4ca0d2='当前棋盘状态（15x15，坐标从0开始，●=黑子，O=白子，·=空位）：\x0a';_0x4ca0d2+=_0x270521(0x1137);for(let _0x1dc43b=0x0;_0x1dc43b<0xf;_0x1dc43b++){_0x4ca0d2+=_0x1dc43b[_0x270521(0x1878)]()['padStart'](0x2,'\x20');}_0x4ca0d2+='\x0a';for(let _0xb6edde=0x0;_0xb6edde<0xf;_0xb6edde++){let _0x14fb2a=_0xb6edde['toString']()[_0x270521(0xdfe)](0x2,'\x20')+'\x20';for(let _0x17e3c4=0x0;_0x17e3c4<0xf;_0x17e3c4++){const _0x58e21a=gomokuGameState[_0x270521(0x17d2)][_0xb6edde][_0x17e3c4];if(_0x58e21a==='user')_0x14fb2a+=gomokuGameState[_0x270521(0x10ee)]?'●':'O';else _0x58e21a==='ai'?_0x14fb2a+=gomokuGameState[_0x270521(0x10ee)]?'O':'●':_0x14fb2a+='·';if(_0x17e3c4<0xe)_0x14fb2a+='\x20';}_0x4ca0d2+=_0x14fb2a+'\x0a';}const _0x474669=[];for(let _0x588fcc=0x0;_0x588fcc<0xf;_0x588fcc++){for(let _0x516edc=0x0;_0x516edc<0xf;_0x516edc++){gomokuGameState[_0x270521(0x17d2)][_0x588fcc][_0x516edc]===null&&_0x474669[_0x270521(0x1cd6)]('('+_0x588fcc+','+_0x516edc+')');}}return _0x474669[_0x270521(0x19ee)]>0x0&&(_0x4ca0d2+=_0x270521(0xd70)+_0x474669[_0x270521(0x6d5)](0x0,0x14)[_0x270521(0x122b)](',\x20'),_0x474669['length']>0x14&&(_0x4ca0d2+='\x20等'+_0x474669[_0x270521(0x19ee)]+_0x270521(0xc35))),_0x4ca0d2;}function getMoveHistoryDescription(){const _0x4f291e=_0x211817;if(gomokuGameState[_0x4f291e(0x1abe)][_0x4f291e(0x19ee)]===0x0)return _0x4f291e(0x1e83);let _0x24d8d2=_0x4f291e(0x14a0)+gomokuGameState[_0x4f291e(0x1abe)][_0x4f291e(0x19ee)]+_0x4f291e(0x1af7);const _0x296409=gomokuGameState[_0x4f291e(0x1abe)][_0x4f291e(0x6d5)](-0x6);return _0x296409[_0x4f291e(0x19fb)]((_0x3769b2,_0x11ff92)=>{const _0x5e360d=_0x4f291e,_0x34504a=gomokuGameState['moveHistory'][_0x5e360d(0x19ee)]-_0x296409['length']+_0x11ff92+0x1,_0x42e2ce=_0x3769b2[_0x5e360d(0x19ea)]===_0x5e360d(0xa80)?'用户':'你';_0x24d8d2+='第'+_0x34504a+_0x5e360d(0x1901)+_0x42e2ce+'在('+_0x3769b2[_0x5e360d(0x206f)]+','+_0x3769b2[_0x5e360d(0x10ce)]+')下了'+(_0x3769b2[_0x5e360d(0x19ea)]===_0x5e360d(0xa80)?gomokuGameState[_0x5e360d(0x10ee)]?'黑子●':_0x5e360d(0x1374):gomokuGameState[_0x5e360d(0x10ee)]?_0x5e360d(0x1374):_0x5e360d(0x866))+'\x0a';}),_0x24d8d2;}function getGameAnalysis(){const _0x2ce007=_0x211817,_0x59b78f=gomokuGameState[_0x2ce007(0x1abe)][_0x2ce007(0x19ee)];let _0x6a3e6c=_0x2ce007(0x3c6)+_0x59b78f+'步。';if(_0x59b78f<0x6)_0x6a3e6c+='\x20现在还是开局阶段，需要抢占有利位置。';else _0x59b78f<0xf?_0x6a3e6c+=_0x2ce007(0x1feb):_0x6a3e6c+='\x20现在是残局，每一步都很关键。';return _0x6a3e6c;}function parseAIMoveResponse(_0x34e56d){const _0x123f01=_0x211817;try{let _0x4c2bfe='';Array['isArray'](_0x34e56d)?_0x4c2bfe=_0x34e56d[0x0]:_0x4c2bfe=_0x34e56d;console['log'](_0x123f01(0x5a3),_0x4c2bfe);const _0x3c3325=_0x4c2bfe[_0x123f01(0x1b87)](/\{[\s\S]*\}/);if(_0x3c3325){const _0x594e78=JSON[_0x123f01(0x22d3)](_0x3c3325[0x0]);console[_0x123f01(0x2187)]('🎯\x20解析出的走法数据:',_0x594e78);if(typeof _0x594e78[_0x123f01(0x206f)]==='number'&&typeof _0x594e78[_0x123f01(0x10ce)]===_0x123f01(0x1782)&&_0x594e78[_0x123f01(0x206f)]>=0x0&&_0x594e78['row']<=0xe&&_0x594e78[_0x123f01(0x10ce)]>=0x0&&_0x594e78['col']<=0xe){if(gomokuGameState[_0x123f01(0x17d2)][_0x594e78[_0x123f01(0x206f)]][_0x594e78['col']]!==null)return console[_0x123f01(0x1f43)](_0x123f01(0x1ff2)+_0x594e78[_0x123f01(0x206f)]+','+_0x594e78[_0x123f01(0x10ce)]+_0x123f01(0x11d0),gomokuGameState[_0x123f01(0x17d2)][_0x594e78['row']][_0x594e78[_0x123f01(0x10ce)]]),null;return console[_0x123f01(0x2187)](_0x123f01(0x2058)+_0x594e78[_0x123f01(0x206f)]+','+_0x594e78[_0x123f01(0x10ce)]+')'),_0x594e78;}else console['warn']('❌\x20AI回复的坐标格式或范围不正确:',_0x594e78);}else console[_0x123f01(0x1f43)]('❌\x20无法从AI回复中提取JSON:',_0x4c2bfe);return null;}catch(_0x503ccf){return console[_0x123f01(0x174a)](_0x123f01(0xf44),_0x503ccf,_0x34e56d),null;}}function isValidMove(_0x60021e,_0x20421e){const _0x277554=_0x211817;return _0x60021e>=0x0&&_0x60021e<0xf&&_0x20421e>=0x0&&_0x20421e<0xf&&gomokuGameState[_0x277554(0x17d2)][_0x60021e][_0x20421e]===null;}function makeBackupMove(){const _0x4e5afc=_0x211817,_0x216d28=findBestMove(0x2);_0x216d28?setTimeout(async()=>{await makeMove(_0x216d28['row'],_0x216d28['col'],'ai');},0x1f4+Math[_0x4e5afc(0x11a8)]()*0x3e8):makeRandomMove();}function checkWinner(_0x3f70f7,_0x5119d7){const _0x3fbcc0=_0x211817,_0x4f2eba=gomokuGameState[_0x3fbcc0(0x17d2)][_0x3f70f7][_0x5119d7],_0x1b20d5=[[0x0,0x1],[0x1,0x0],[0x1,0x1],[0x1,-0x1]];for(const [_0x5e9a16,_0x5e6d0d]of _0x1b20d5){let _0x507b6a=0x1;const _0x5cb755=[{'row':_0x3f70f7,'col':_0x5119d7}];for(let _0x83204a=0x1;_0x83204a<0x5;_0x83204a++){const _0x2bf727=_0x3f70f7+_0x5e9a16*_0x83204a,_0x5e288e=_0x5119d7+_0x5e6d0d*_0x83204a;if(_0x2bf727>=0x0&&_0x2bf727<0xf&&_0x5e288e>=0x0&&_0x5e288e<0xf&&gomokuGameState[_0x3fbcc0(0x17d2)][_0x2bf727][_0x5e288e]===_0x4f2eba)_0x507b6a++,_0x5cb755[_0x3fbcc0(0x1cd6)]({'row':_0x2bf727,'col':_0x5e288e});else break;}for(let _0x5605a8=0x1;_0x5605a8<0x5;_0x5605a8++){const _0x1ef9a3=_0x3f70f7-_0x5e9a16*_0x5605a8,_0x1ed3d3=_0x5119d7-_0x5e6d0d*_0x5605a8;if(_0x1ef9a3>=0x0&&_0x1ef9a3<0xf&&_0x1ed3d3>=0x0&&_0x1ed3d3<0xf&&gomokuGameState[_0x3fbcc0(0x17d2)][_0x1ef9a3][_0x1ed3d3]===_0x4f2eba)_0x507b6a++,_0x5cb755['unshift']({'row':_0x1ef9a3,'col':_0x1ed3d3});else break;}if(_0x507b6a>=0x5)return _0x5cb755[_0x3fbcc0(0x19fb)](({row:_0x2fb03a,col:_0x83848})=>{const _0x1156e7=_0x3fbcc0,_0x408143=document[_0x1156e7(0xb30)]('[data-row=\x22'+_0x2fb03a+_0x1156e7(0x1d9a)+_0x83848+_0x1156e7(0x16c7));_0x408143&&_0x408143['classList'][_0x1156e7(0x21e2)](_0x1156e7(0x1b68));}),_0x4f2eba;}return null;}async function endGame(_0xc70417){const _0x111e94=_0x211817;gomokuGameState['gameActive']=![],clearInterval(gomokuGameState['gameTimer']);const _0x513987={'type':_0x111e94(0xfb8),'timestamp':Date[_0x111e94(0x2eb)](),'player':_0x111e94(0x1744),'data':{'winner':_0xc70417,'totalMoves':gomokuGameState[_0x111e94(0x1abe)][_0x111e94(0x19ee)],'gameDuration':Date[_0x111e94(0x2eb)]()-gomokuGameState[_0x111e94(0x192a)]}};gomokuGameState[_0x111e94(0x19e0)][_0x111e94(0x260)][_0x111e94(0x1cd6)](_0x513987);let _0x3253b3;if(_0xc70417===_0x111e94(0xa80))_0x3253b3=_0x111e94(0x14da);else _0xc70417==='ai'?_0x3253b3=_0x111e94(0xe06):_0x3253b3=_0x111e94(0x1105);addGameChatMessage(_0x111e94(0x1744),_0x3253b3);if(currentChatCharacter){const _0x26f5e1=Math['round']((Date[_0x111e94(0x2eb)]()-gomokuGameState[_0x111e94(0x192a)])/0x3e8/0x3c),_0x45d10c=gomokuGameState[_0x111e94(0x1abe)][_0x111e94(0x19ee)];await recordGameEvent(currentChatCharacter['id'],'game_end',{'gameName':_0x111e94(0xae1),'result':_0xc70417,'score':_0x45d10c,'chatContent':_0x111e94(0x22af)+_0xc70417+_0x111e94(0x189b)+_0x45d10c+'步，用时'+_0x26f5e1+'分钟'});}updateGomokuUI(),setTimeout(()=>{summarizeGameSession();},0xbb8);}function updateBoardUI(){const _0x16b107=_0x211817;for(let _0xa89542=0x0;_0xa89542<0xf;_0xa89542++){for(let _0xaabebc=0x0;_0xaabebc<0xf;_0xaabebc++){const _0x2d40d3=document['querySelector']('[data-row=\x22'+_0xa89542+_0x16b107(0x1d9a)+_0xaabebc+'\x22]'),_0x1937ff=gomokuGameState['board'][_0xa89542][_0xaabebc];_0x2d40d3[_0x16b107(0x33a)]='';if(_0x1937ff){const _0x18b1bc=document[_0x16b107(0xac6)](_0x16b107(0xbbc));let _0x104cfb;_0x1937ff==='user'?_0x104cfb=gomokuGameState[_0x16b107(0x10ee)]?_0x16b107(0xd15):_0x16b107(0x2167):_0x104cfb=gomokuGameState['userIsBlack']?_0x16b107(0x2167):'black',_0x18b1bc['className']=_0x16b107(0xeec)+_0x104cfb,_0x2d40d3[_0x16b107(0x497)](_0x18b1bc);}}}}function updateGomokuUI(){const _0x1e4b13=_0x211817,_0x813069=document['getElementById'](_0x1e4b13(0xff2));gomokuGameState[_0x1e4b13(0x230f)]?gomokuGameState[_0x1e4b13(0x6b2)]===_0x1e4b13(0xa80)?(_0x813069[_0x1e4b13(0x13be)]=_0x1e4b13(0x1244),_0x813069[_0x1e4b13(0x14eb)]['color']=_0x1e4b13(0x1964)):(_0x813069[_0x1e4b13(0x13be)]='对方回合',_0x813069[_0x1e4b13(0x14eb)]['color']=_0x1e4b13(0x157b)):(_0x813069['textContent']=_0x1e4b13(0x16f9),_0x813069[_0x1e4b13(0x14eb)][_0x1e4b13(0xc3d)]=_0x1e4b13(0x1f37));}function updatePlayerPieceDisplay(){const _0x1c3395=_0x211817,_0x1f6d46=document[_0x1c3395(0x1897)](_0x1c3395(0x17e8)),_0x546ac3=document[_0x1c3395(0x1897)](_0x1c3395(0xb8b));console[_0x1c3395(0x2187)](_0x1c3395(0xaa0),{'userCount':_0x1f6d46['length'],'aiCount':_0x546ac3[_0x1c3395(0x19ee)]}),_0x1f6d46['forEach'](_0x49e068=>{const _0x5be1b3=_0x1c3395;_0x49e068['classList'][_0x5be1b3(0x1493)](_0x5be1b3(0xd15),_0x5be1b3(0x2167)),gomokuGameState['userIsBlack']?_0x49e068[_0x5be1b3(0x1c1b)][_0x5be1b3(0x21e2)](_0x5be1b3(0xd15)):_0x49e068[_0x5be1b3(0x1c1b)][_0x5be1b3(0x21e2)](_0x5be1b3(0x2167)),_0x49e068['textContent']='',_0x49e068[_0x5be1b3(0x14eb)]['display']='block',_0x49e068[_0x5be1b3(0x14eb)][_0x5be1b3(0xea3)]=_0x5be1b3(0x85c);}),_0x546ac3[_0x1c3395(0x19fb)](_0x1a4269=>{const _0x5170fd=_0x1c3395;_0x1a4269[_0x5170fd(0x1c1b)]['remove']('black',_0x5170fd(0x2167)),gomokuGameState['userIsBlack']?_0x1a4269['classList'][_0x5170fd(0x21e2)](_0x5170fd(0x2167)):_0x1a4269[_0x5170fd(0x1c1b)]['add']('black'),_0x1a4269[_0x5170fd(0x13be)]='',_0x1a4269[_0x5170fd(0x14eb)]['display']=_0x5170fd(0x13de),_0x1a4269[_0x5170fd(0x14eb)]['visibility']=_0x5170fd(0x85c);}),console[_0x1c3395(0x2187)](_0x1c3395(0x2263),gomokuGameState['userIsBlack']?'黑子':'白子');}function startGameTimer(){const _0x17e374=_0x211817,_0x5d8b66=document[_0x17e374(0x1262)](_0x17e374(0x8cb));gomokuGameState[_0x17e374(0x212d)]=setInterval(()=>{const _0x2ca2ff=_0x17e374,_0x7276ec=Date['now']()-gomokuGameState['gameStartTime'],_0x41970f=Math[_0x2ca2ff(0x2180)](_0x7276ec/0xea60),_0x35b8ee=Math['floor'](_0x7276ec%0xea60/0x3e8);_0x5d8b66[_0x2ca2ff(0x13be)]=_0x41970f[_0x2ca2ff(0x1878)]()['padStart'](0x2,'0')+':'+_0x35b8ee[_0x2ca2ff(0x1878)]()[_0x2ca2ff(0xdfe)](0x2,'0');},0x3e8);}function setupAIPlayerInfo(){const _0x5f5cf0=_0x211817,_0x1d9aa8=document['getElementById'](_0x5f5cf0(0x1ab0)),_0x1b3311=document['getElementById'](_0x5f5cf0(0x2128)),_0x55ef42=document['getElementById'](_0x5f5cf0(0x1069)),_0x362e66=document['getElementById'](_0x5f5cf0(0x104f)),_0x660d5c=document[_0x5f5cf0(0x1262)](_0x5f5cf0(0x1713));if(currentChatCharacter){_0x1d9aa8&&(_0x1d9aa8[_0x5f5cf0(0x13be)]=currentChatCharacter[_0x5f5cf0(0x1a1c)]);const _0x5826c2=getCurrentChatSettings(),_0x271230=_0x5826c2[_0x5f5cf0(0x179f)]||currentChatCharacter['avatarUrl']||currentChatCharacter[_0x5f5cf0(0x1f8a)];if(_0x271230&&_0x1b3311){const _0x3dde54=_0x1b3311['querySelector'](_0x5f5cf0(0x148b));_0x1b3311[_0x5f5cf0(0x33a)]=_0x5f5cf0(0xf7c)+_0x271230+_0x5f5cf0(0x222c)+currentChatCharacter['name']+_0x5f5cf0(0x999),_0x3dde54&&_0x1b3311[_0x5f5cf0(0x497)](_0x3dde54);}if(_0x271230&&_0x55ef42){const _0x949b7c=_0x55ef42[_0x5f5cf0(0xb30)](_0x5f5cf0(0x148b));_0x55ef42['innerHTML']=_0x5f5cf0(0xf7c)+_0x271230+_0x5f5cf0(0x222c)+currentChatCharacter[_0x5f5cf0(0x1a1c)]+_0x5f5cf0(0x999),_0x949b7c&&_0x55ef42[_0x5f5cf0(0x497)](_0x949b7c);}}const _0x3fad1e=getCurrentChatSettings();let _0xd41ae2=null;_0x3fad1e[_0x5f5cf0(0x11cd)]&&(_0xd41ae2=_0x3fad1e['myChatAvatar']);if(!_0xd41ae2&&_0x3fad1e[_0x5f5cf0(0x145e)]){const _0x38a776=personas[_0x5f5cf0(0xaf4)](_0x5928ff=>_0x5928ff['id']===_0x3fad1e[_0x5f5cf0(0x145e)]);_0x38a776&&_0x38a776[_0x5f5cf0(0x1994)]&&(_0xd41ae2=_0x38a776[_0x5f5cf0(0x1994)]);}!_0xd41ae2&&window[_0x5f5cf0(0x865)]&&(_0xd41ae2=window[_0x5f5cf0(0x865)]);if(_0xd41ae2&&_0x362e66){const _0x509d34=_0x362e66['querySelector'](_0x5f5cf0(0x148b));_0x362e66['innerHTML']='<img\x20src=\x22'+_0xd41ae2+'\x22\x20alt=\x22你\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;\x20border-radius:\x2050%;\x20object-fit:\x20cover;\x22>',_0x509d34&&_0x362e66[_0x5f5cf0(0x497)](_0x509d34);}if(_0xd41ae2&&_0x660d5c){const _0x5e1f64=_0x660d5c[_0x5f5cf0(0xb30)](_0x5f5cf0(0x148b));_0x660d5c[_0x5f5cf0(0x33a)]=_0x5f5cf0(0xf7c)+_0xd41ae2+_0x5f5cf0(0xf9d),_0x5e1f64&&_0x660d5c[_0x5f5cf0(0x497)](_0x5e1f64);}}function showGameChatLoading(){const _0x2c08a4=_0x211817,_0x3896ef=document[_0x2c08a4(0x1262)]('gomoku-chat-messages'),_0x78b8bd=document['createElement']('div');_0x78b8bd[_0x2c08a4(0x1722)]='game-chat-message\x20ai',_0x78b8bd['id']='game-chat-loading';const _0x327534=document[_0x2c08a4(0xac6)](_0x2c08a4(0xbbc));_0x327534[_0x2c08a4(0x1722)]='game-chat-bubble\x20loading',_0x327534['innerHTML']=_0x2c08a4(0x15fe),_0x78b8bd[_0x2c08a4(0x497)](_0x327534),_0x3896ef['appendChild'](_0x78b8bd),_0x3896ef[_0x2c08a4(0x98c)]=_0x3896ef[_0x2c08a4(0xfe3)];}function hideGameChatLoading(){const _0x54cff1=_0x211817,_0x9d0958=document[_0x54cff1(0x1262)]('game-chat-loading');_0x9d0958&&_0x9d0958[_0x54cff1(0x1493)]();}function addGameChatMessage(_0x29a7a6,_0x57ef1a,_0x176ba3=![]){const _0xfe9653=_0x211817,_0x1f867c=document[_0xfe9653(0x1262)](_0xfe9653(0x97b)),_0x5a81bd=document['createElement'](_0xfe9653(0xbbc));_0x5a81bd[_0xfe9653(0x1722)]=_0xfe9653(0x1209)+_0x29a7a6;const _0x3b31c1=document[_0xfe9653(0xac6)](_0xfe9653(0xbbc));_0x3b31c1[_0xfe9653(0x1722)]=_0xfe9653(0x1f4b),_0x3b31c1[_0xfe9653(0x13be)]=_0x57ef1a,_0x5a81bd[_0xfe9653(0x497)](_0x3b31c1),_0x1f867c[_0xfe9653(0x497)](_0x5a81bd),_0x1f867c[_0xfe9653(0x98c)]=_0x1f867c['scrollHeight'];const _0xa815b8={'sender':_0x29a7a6,'content':_0x57ef1a,'timestamp':Date[_0xfe9653(0x2eb)]()};gomokuGameState[_0xfe9653(0x19e0)][_0xfe9653(0x10e5)][_0xfe9653(0x1cd6)](_0xa815b8),_0x176ba3&&currentChatCharacter&&recordGameChat(currentChatCharacter['id'],_0x29a7a6,_0x57ef1a,{'gameName':_0xfe9653(0xae1),'gameState':_0xfe9653(0x238)});}async function sendGameChatMessage(){const _0x3e8e7d=_0x211817,_0x2a8cc1=document[_0x3e8e7d(0x1262)](_0x3e8e7d(0x1937)),_0xfc5cbc=_0x2a8cc1[_0x3e8e7d(0x1ebc)][_0x3e8e7d(0x19d7)]();if(!_0xfc5cbc)return;if(!currentChatCharacter)return;addGameChatMessage(_0x3e8e7d(0xa80),_0xfc5cbc,!![]),_0x2a8cc1[_0x3e8e7d(0x1ebc)]='';try{showGameChatLoading();const _0x4e466e=_0x3e8e7d(0x1a28)+_0xfc5cbc,_0x41afbb={'id':Date['now'](),'characterId':currentChatCharacter['id'],'content':_0x4e466e,'sender':_0x3e8e7d(0xa80),'timestamp':Date[_0x3e8e7d(0x2eb)](),'isGameContext':!![]};await db['chatMessages'][_0x3e8e7d(0x21e2)](_0x41afbb);const _0xfe18aa=gomokuGameState[_0x3e8e7d(0x230f)]?_0x3e8e7d(0xa7a):_0x3e8e7d(0x541),_0x1c1961=gomokuGameState['moveHistory'][_0x3e8e7d(0x19ee)],_0x49f154=gomokuGameState[_0x3e8e7d(0x10ee)]?'黑子':'白子',_0x39d2a6=gomokuGameState[_0x3e8e7d(0x10ee)]?'白子':'黑子',_0x21cfa4=_0x3e8e7d(0x1fcb)+_0xfe18aa+_0x3e8e7d(0xabf)+_0x1c1961+_0x3e8e7d(0x8d6)+_0x39d2a6+'，用户执'+_0x49f154+_0x3e8e7d(0xddf)+_0xfc5cbc+'\x22\x0a\x0a请自然地回应用户，就像平时聊天一样。你可以：\x0a1.\x20回应用户的话题\x0a2.\x20评论当前的棋局\x0a3.\x20聊其他任何话题\x0a4.\x20保持你的性格特点\x0a\x0a回复要自然，不要刻意提醒这是在游戏中。',_0x3bd0cc=await callChatAPI(_0x21cfa4,currentChatCharacter),_0x5d7274=await parseAiResponse(_0x3bd0cc);hideGameChatLoading();if(Array[_0x3e8e7d(0x1496)](_0x5d7274)&&_0x5d7274[_0x3e8e7d(0x19ee)]>0x0)for(let _0x400996=0x0;_0x400996<_0x5d7274[_0x3e8e7d(0x19ee)];_0x400996++){const _0x2d5a23=_0x5d7274[_0x400996];let _0x32d44d='';if(typeof _0x2d5a23===_0x3e8e7d(0x11b7))_0x32d44d=_0x2d5a23['trim']();else typeof _0x2d5a23===_0x3e8e7d(0x28d)&&_0x2d5a23['content']&&(_0x32d44d=_0x2d5a23['content'][_0x3e8e7d(0x19d7)]());_0x32d44d&&setTimeout(async()=>{const _0x53758c=_0x3e8e7d;addGameChatMessage('ai',_0x32d44d,!![]);const _0x27494a={'id':Date['now']()+_0x400996,'characterId':currentChatCharacter['id'],'content':_0x53758c(0x1a28)+_0x32d44d,'sender':'ai','timestamp':Date[_0x53758c(0x2eb)]()+_0x400996,'isGameContext':!![]};await db[_0x53758c(0x19a2)][_0x53758c(0x21e2)](_0x27494a);},0x12c+_0x400996*0x320);}await recordGameEvent(currentChatCharacter['id'],_0x3e8e7d(0x14f7),{'gameName':_0x3e8e7d(0xae1),'result':null,'score':_0x1c1961,'chatContent':'用户说：'+_0xfc5cbc});}catch(_0x398438){console['error'](_0x3e8e7d(0x1fd9),_0x398438),hideGameChatLoading(),setTimeout(()=>{const _0x407621=_0x3e8e7d,_0x19801b=[_0x407621(0x4f9),_0x407621(0x1adf),'我也这么想！',_0x407621(0x466),_0x407621(0x1773),_0x407621(0x216b),'嗯嗯，我在听着呢','好的好的！'],_0x60672a=_0x19801b[Math['floor'](Math['random']()*_0x19801b[_0x407621(0x19ee)])];addGameChatMessage('ai',_0x60672a,!![]);},0x3e8+Math['random']()*0x7d0);}}function clearGameChat(){const _0x261822=_0x211817;confirm(_0x261822(0x1387))&&(document[_0x261822(0x1262)](_0x261822(0x97b))['innerHTML']='',gomokuGameState[_0x261822(0x19e0)][_0x261822(0x10e5)]=[],showToast('聊天记录已清空',_0x261822(0x11cb)));}function recordGameStart(){const _0x309af2=_0x211817;currentChatCharacter&&recordGameEvent(currentChatCharacter['id'],_0x309af2(0x18bc),{'gameName':_0x309af2(0xae1),'result':null,'score':null,'chatContent':null});}async function clearGameTimelineMemories(_0x4ed0fc,_0x4c6b82){const _0x2236ce=_0x211817;try{const _0x1c46fb=await db[_0x2236ce(0x8ac)][_0x2236ce(0xa24)](_0x2236ce(0xaf5))['equals'](_0x4ed0fc)['toArray'](),_0x39ce08=_0x1c46fb[_0x2236ce(0x1e1f)](_0x1f154f=>{const _0x207bb7=_0x2236ce;if(_0x1f154f['appType']!==_0x207bb7(0x8eb))return![];const _0x39e85a=_0x1f154f['data']||{};return _0x39e85a[_0x207bb7(0x103a)]===_0x4c6b82||_0x39e85a['id']&&_0x39e85a['id'][_0x207bb7(0x1831)](_0x4c6b82)||_0x1f154f[_0x207bb7(0x1716)]>=gomokuGameState[_0x207bb7(0x192a)];});if(_0x39ce08[_0x2236ce(0x19ee)]>0x0){const _0x5a8874=_0x39ce08['map'](_0x21d2fb=>_0x21d2fb['id']);await db['crossAppTimeline'][_0x2236ce(0x1aaa)](_0x5a8874),console[_0x2236ce(0x2187)](_0x2236ce(0x1191)+_0x39ce08[_0x2236ce(0x19ee)]+_0x2236ce(0x16d5));}}catch(_0x22cb8d){console[_0x2236ce(0x174a)](_0x2236ce(0xbad),_0x22cb8d);throw _0x22cb8d;}}function exitGomokuGame(){const _0x30f469=_0x211817;gomokuGameState[_0x30f469(0x230f)]?showExitGameModal():(hideApp('gomoku-game-screen'),showApp(_0x30f469(0xcf2)));}function showExitGameModal(){const _0x524cfd=_0x211817,_0x4e758b=document[_0x524cfd(0xac6)]('div');_0x4e758b['className']='game-exit-modal',_0x4e758b[_0x524cfd(0x33a)]=_0x524cfd(0x2fe);const _0x14a7dc=document[_0x524cfd(0x1262)](_0x524cfd(0x1548));_0x14a7dc?_0x14a7dc['appendChild'](_0x4e758b):document[_0x524cfd(0x1da9)][_0x524cfd(0x497)](_0x4e758b);}function closeExitGameModal(){const _0x2c93ac=_0x211817,_0x599b80=document[_0x2c93ac(0xb30)](_0x2c93ac(0x20ee));_0x599b80&&_0x599b80[_0x2c93ac(0x1493)]();}function exitGameWithSave(){const _0x23a734=_0x211817;gomokuGameState[_0x23a734(0x19e0)][_0x23a734(0x260)][_0x23a734(0x1cd6)]({'type':'game_exit_save','timestamp':Date[_0x23a734(0x2eb)](),'player':_0x23a734(0xa80),'data':{'reason':_0x23a734(0x1d32)}}),gomokuGameState['gameActive']=![],clearInterval(gomokuGameState['gameTimer']),summarizeGameSession(),closeExitGameModal(),hideApp(_0x23a734(0xba9)),showApp(_0x23a734(0xcf2)),showToast(_0x23a734(0x120f),_0x23a734(0x11cb));}async function exitGameWithClear(){const _0x24fc3c=_0x211817,_0x1603ee=gomokuGameState['gameSession']?.[_0x24fc3c(0x103a)];gomokuGameState[_0x24fc3c(0x19e0)]={'gameId':null,'players':[],'boardState':[],'chatHistory':[],'gameEvents':[]},document['getElementById'](_0x24fc3c(0x97b))[_0x24fc3c(0x33a)]='',gomokuGameState[_0x24fc3c(0x230f)]=![],clearInterval(gomokuGameState[_0x24fc3c(0x212d)]);if(_0x1603ee&&currentChatCharacter)try{await clearGameTimelineMemories(currentChatCharacter['id'],_0x1603ee),console['log'](_0x24fc3c(0x20de));}catch(_0x283261){console['error'](_0x24fc3c(0xbad),_0x283261);}closeExitGameModal(),hideApp('gomoku-game-screen'),showApp('api-chat-screen'),showToast('游戏记录已清空',_0x24fc3c(0x11cb));}function exitGameTemporary(){const _0x27e8ec=_0x211817,_0x1178bd={'board':gomokuGameState[_0x27e8ec(0x17d2)],'currentPlayer':gomokuGameState[_0x27e8ec(0x6b2)],'userIsBlack':gomokuGameState['userIsBlack'],'moveHistory':gomokuGameState['moveHistory'],'gameSession':gomokuGameState['gameSession'],'startTime':gomokuGameState['startTime'],'chatHistory':Array[_0x27e8ec(0x13c0)](document[_0x27e8ec(0x1262)](_0x27e8ec(0x97b))[_0x27e8ec(0xe48)])[_0x27e8ec(0x6a4)](_0xba4c1=>({'sender':_0xba4c1[_0x27e8ec(0x1c1b)][_0x27e8ec(0x971)](_0x27e8ec(0xa80))?_0x27e8ec(0xa80):_0xba4c1[_0x27e8ec(0x1c1b)][_0x27e8ec(0x971)]('ai')?'ai':_0x27e8ec(0x1744),'content':_0xba4c1[_0x27e8ec(0x13be)],'timestamp':Date[_0x27e8ec(0x2eb)]()}))};localStorage[_0x27e8ec(0x192)](_0x27e8ec(0x25e),JSON[_0x27e8ec(0x6b8)](_0x1178bd)),gomokuGameState[_0x27e8ec(0x19e0)]['gameEvents'][_0x27e8ec(0x1cd6)]({'type':'game_pause','timestamp':Date[_0x27e8ec(0x2eb)](),'player':_0x27e8ec(0xa80),'data':{'reason':'用户选择暂时离开'}}),gomokuGameState['gameActive']=![],clearInterval(gomokuGameState[_0x27e8ec(0x212d)]),closeExitGameModal(),hideApp('gomoku-game-screen'),showApp(_0x27e8ec(0xcf2)),showToast(_0x27e8ec(0xad9),_0x27e8ec(0x11cb));}async function restartGomokuGame(){const _0x108980=_0x211817;confirm(_0x108980(0x1677))&&(localStorage[_0x108980(0x3b2)](_0x108980(0x25e)),await initGomokuGame(),showToast(_0x108980(0x1cd5),'success'));}async function undoGomokuMove(){const _0x5db400=_0x211817;if(!gomokuGameState[_0x5db400(0x230f)]){showToast(_0x5db400(0x1bef),'warning');return;}if(gomokuGameState['moveHistory'][_0x5db400(0x19ee)]>=0x2){for(let _0x4b4cac=0x0;_0x4b4cac<0x2;_0x4b4cac++){const _0x79ea33=gomokuGameState[_0x5db400(0x1abe)][_0x5db400(0xa1a)]();_0x79ea33&&(gomokuGameState[_0x5db400(0x17d2)][_0x79ea33['row']][_0x79ea33['col']]=null);}gomokuGameState[_0x5db400(0x6b2)]=_0x5db400(0xa80),updateBoardUI(),updateGomokuUI(),addGameChatMessage(_0x5db400(0x1744),'已悔棋两步'),currentChatCharacter&&(await recordCrossAppEvent(currentChatCharacter['id'],_0x5db400(0x8eb),_0x5db400(0x785),{'id':_0x5db400(0x436)+Date[_0x5db400(0x2eb)](),'type':_0x5db400(0x1009),'gameName':_0x5db400(0xae1),'content':_0x5db400(0x20d8)+currentChatCharacter[_0x5db400(0x1a1c)]+'同意了','moveCount':gomokuGameState[_0x5db400(0x1abe)]['length'],'timestamp':Date['now']()}),addGameChatMessage('ai','好吧，给你一次机会~',!![]));}else showToast(_0x5db400(0xf18),_0x5db400(0x1816));}async function surrenderGomokuGame(){const _0x17df01=_0x211817;if(!gomokuGameState[_0x17df01(0x230f)]){showToast(_0x17df01(0xbdd),_0x17df01(0x1816));return;}confirm(_0x17df01(0x2291))&&(addGameChatMessage('system','你选择了认输'),currentChatCharacter&&(await recordCrossAppEvent(currentChatCharacter['id'],'game','surrender',{'id':_0x17df01(0x2026)+Date[_0x17df01(0x2eb)](),'type':'game_surrender','gameName':_0x17df01(0xae1),'content':'用户在五子棋游戏中主动认输，'+currentChatCharacter[_0x17df01(0x1a1c)]+'获胜','result':_0x17df01(0x872),'moveCount':gomokuGameState[_0x17df01(0x1abe)][_0x17df01(0x19ee)],'timestamp':Date[_0x17df01(0x2eb)]()}),addGameChatMessage('ai','好的，这局我赢了！下次再来挑战我吧~',!![])),setTimeout(()=>{endGame('ai');},0x5dc));}async function startNextGomokuGame(){const _0xd0c613=_0x211817;if(gomokuGameState[_0xd0c613(0x230f)]){if(!confirm(_0xd0c613(0x272)))return;}localStorage['removeItem'](_0xd0c613(0x25e)),await initGomokuGame(),showToast('新的一局开始了！',_0xd0c613(0x11cb));}async function summarizeGameSession(){const _0x4e9c39=_0x211817;if(!currentChatCharacter||!gomokuGameState['gameSession'])return;try{const _0x55919c=gomokuGameState[_0x4e9c39(0x19e0)][_0x4e9c39(0x260)],_0x4ad6e5=gomokuGameState[_0x4e9c39(0x19e0)][_0x4e9c39(0x10e5)],_0x18b92b=_0x55919c[_0x55919c[_0x4e9c39(0x19ee)]-0x1];let _0x1cc630=_0x4e9c39(0x1482),_0x3715ad=_0x4e9c39(0xdda);if(_0x18b92b&&_0x18b92b['type']==='game_end'){_0x1cc630=_0x18b92b[_0x4e9c39(0x22c0)][_0x4e9c39(0xa9e)];if(_0x1cc630===_0x4e9c39(0xa80))_0x3715ad=_0x4e9c39(0xe2c);else _0x1cc630==='ai'?_0x3715ad=currentChatCharacter[_0x4e9c39(0x1a1c)]+'获胜':_0x3715ad='平局';}try{const _0x5cb791=Math['round']((Date[_0x4e9c39(0x2eb)]()-gomokuGameState[_0x4e9c39(0x192a)])/0x3e8/0x3c),_0x3be08d=_0x4ad6e5[_0x4e9c39(0x19ee)]>0x0?'游戏期间我们聊了'+_0x4ad6e5['length']+'条消息，'+(_0x4ad6e5[_0x4e9c39(0x19ee)]>0x5?'聊得很开心':_0x4e9c39(0x13e0)):_0x4e9c39(0x20a7),_0x2e89e2='你是'+currentChatCharacter[_0x4e9c39(0x1a1c)]+_0x4e9c39(0x17cc)+_0x3715ad+_0x4e9c39(0x327)+_0x5cb791+'分钟\x0a-\x20总步数：'+gomokuGameState[_0x4e9c39(0x1abe)]['length']+_0x4e9c39(0x2237)+_0x3be08d+_0x4e9c39(0x12e1)+currentChatCharacter['name']+_0x4e9c39(0xf48),_0x49b4c3=await callChatAPI(_0x2e89e2,currentChatCharacter);let _0xa96252='';if(Array[_0x4e9c39(0x1496)](_0x49b4c3)&&_0x49b4c3[_0x4e9c39(0x19ee)]>0x0)_0xa96252=_0x49b4c3[0x0][_0x4e9c39(0x19d7)]();else typeof _0x49b4c3===_0x4e9c39(0x11b7)&&(_0xa96252=_0x49b4c3['trim']());!_0xa96252&&(_0xa96252=_0x1cc630==='user'?_0x4e9c39(0x4b5)+currentChatCharacter['name']+'，'+(_0x4ad6e5[_0x4e9c39(0x19ee)]>0x0?_0x4e9c39(0x6fb):'专心对弈'):_0x1cc630==='ai'?currentChatCharacter['name']+'在五子棋中获胜了，'+(_0x4ad6e5[_0x4e9c39(0x19ee)]>0x0?_0x4e9c39(0x629):'下得很专注'):currentChatCharacter[_0x4e9c39(0x1a1c)]+_0x4e9c39(0x781)+(_0x4ad6e5[_0x4e9c39(0x19ee)]>0x0?_0x4e9c39(0x2154):_0x4e9c39(0x1573))),console['log'](_0x4e9c39(0xf0f),_0xa96252),await recordCrossAppEvent(currentChatCharacter['id'],_0x4e9c39(0x8eb),_0x4e9c39(0xc4c),{'id':_0x4e9c39(0x14ac)+Date[_0x4e9c39(0x2eb)](),'type':'game_session_summary','gameName':'五子棋','summary':_0xa96252,'result':_0x3715ad,'totalMoves':gomokuGameState[_0x4e9c39(0x1abe)][_0x4e9c39(0x19ee)],'chatMessages':_0x4ad6e5[_0x4e9c39(0x19ee)],'gameDuration':_0x5cb791,'timestamp':Date[_0x4e9c39(0x2eb)]()}),await db['episodicMemories'][_0x4e9c39(0x21e2)]({'id':_0x4e9c39(0x234)+Date['now'](),'characterId':currentChatCharacter['id'],'fact':_0xa96252,'importance':0.7,'timestamp':Date[_0x4e9c39(0x2eb)](),'category':_0x4e9c39(0x18fb),'contextId':currentChatCharacter['id']});}catch(_0x49e89c){console[_0x4e9c39(0x174a)](_0x4e9c39(0x19af),_0x49e89c);const _0x3b9740=_0x1cc630==='user'?_0x4e9c39(0x11c1):_0x1cc630==='ai'?currentChatCharacter[_0x4e9c39(0x1a1c)]+_0x4e9c39(0x2137):_0x4e9c39(0x1282);await db[_0x4e9c39(0x156f)]['add']({'id':_0x4e9c39(0x234)+Date['now'](),'characterId':currentChatCharacter['id'],'fact':_0x3b9740,'importance':0.7,'timestamp':Date[_0x4e9c39(0x2eb)](),'category':_0x4e9c39(0x18fb),'contextId':currentChatCharacter['id']});}console[_0x4e9c39(0x2187)]('🎮\x20游戏记忆已保存到全局记忆系统'),showToast(_0x4e9c39(0x1a11),_0x4e9c39(0x11cb));}catch(_0x38908d){console[_0x4e9c39(0x174a)]('保存游戏记忆失败:',_0x38908d);}}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x2626c9=_0x211817,_0x4323a6=document[_0x2626c9(0x1262)]('gomoku-chat-input');_0x4323a6&&_0x4323a6[_0x2626c9(0x21e9)](_0x2626c9(0xf20),function(_0x4bac0d){_0x4bac0d['key']==='Enter'&&sendGameChatMessage();});});let turtleSoupGameState={'gameActive':![],'gameStartTime':null,'currentStory':null,'currentAnswer':null,'questionCount':0x0,'gameTimer':null,'gameSession':null,'dmPersonality':_0x211817(0x14b5),'gameMode':_0x211817(0xdf3)};const turtleSoupStories=[{'id':0x1,'title':_0x211817(0x5bb),'story':_0x211817(0x1654),'answer':_0x211817(0xe45),'difficulty':_0x211817(0x950),'tags':[_0x211817(0x1def),'心理','医疗','误解']},{'id':0x2,'title':'推门而入','story':_0x211817(0xd48),'answer':_0x211817(0xd1c),'difficulty':_0x211817(0x20a3),'tags':[_0x211817(0x1def),'日常','发现','死亡']},{'id':0x3,'title':_0x211817(0xea2),'story':_0x211817(0x24e),'answer':_0x211817(0x219d),'difficulty':'hard','tags':[_0x211817(0xc3f),'夫妻','盲人','死亡']},{'id':0x4,'title':_0x211817(0x1896),'story':_0x211817(0x10ef),'answer':_0x211817(0xdc2),'difficulty':'easy','tags':[_0x211817(0xfa2),'幽默','心理','比喻']},{'id':0x5,'title':'爱情的证明','story':_0x211817(0x10fd),'answer':_0x211817(0xce7),'difficulty':'medium','tags':[_0x211817(0xf64),'爱情','关心','细节']},{'id':0x6,'title':'神秘的礼物','story':_0x211817(0x5b4),'answer':_0x211817(0x538),'difficulty':_0x211817(0x950),'tags':[_0x211817(0xf64),'爱情','失忆','温暖']}];async function startTurtleSoupGame(){const _0x1eca1a=_0x211817;document[_0x1eca1a(0x1262)](_0x1eca1a(0xcf2))['style'][_0x1eca1a(0x4da)]!==_0x1eca1a(0x102b)&&hideApp(_0x1eca1a(0xcf2)),document[_0x1eca1a(0x1262)](_0x1eca1a(0x1c2a))[_0x1eca1a(0x14eb)]['display']!==_0x1eca1a(0x102b)&&hideApp(_0x1eca1a(0x1c2a)),showApp(_0x1eca1a(0xd32)),await initTurtleSoupGame();}async function initTurtleSoupGame(){const _0x3e62b5=_0x211817,_0x245f70=currentChatCharacter&&currentChatCharacter['isGroup']?_0x3e62b5(0x1257):_0x3e62b5(0xdf3);let _0x10ee4e={'preferredType':_0x3e62b5(0x11a8),'dmPersonality':'friendly'};try{const _0xe2691e=await db[_0x3e62b5(0x181d)][_0x3e62b5(0xb78)]('turtleSoupSettings');_0xe2691e&&_0xe2691e['value']&&(_0x10ee4e=_0xe2691e[_0x3e62b5(0x1ebc)]);}catch(_0x39618f){console[_0x3e62b5(0x174a)]('加载海龟汤设置失败:',_0x39618f);}let _0x5f265f;try{console['log'](_0x3e62b5(0x1d7c)),_0x5f265f=await generateTurtleSoupStoryByDM(_0x10ee4e['preferredType']);}catch(_0x14b536){console[_0x3e62b5(0x174a)](_0x3e62b5(0x1eff),_0x14b536);let _0x379062=turtleSoupStories;_0x10ee4e['preferredType']!==_0x3e62b5(0x11a8)&&(_0x379062=turtleSoupStories[_0x3e62b5(0x1e1f)](_0x33b54f=>_0x33b54f[_0x3e62b5(0x10e7)]&&_0x33b54f[_0x3e62b5(0x10e7)][_0x3e62b5(0x1831)](_0x10ee4e[_0x3e62b5(0x1f4f)])),_0x379062['length']===0x0&&(_0x379062=turtleSoupStories)),_0x5f265f=_0x379062[Math[_0x3e62b5(0x2180)](Math[_0x3e62b5(0x11a8)]()*_0x379062[_0x3e62b5(0x19ee)])];}turtleSoupGameState={'gameActive':!![],'gameStartTime':Date[_0x3e62b5(0x2eb)](),'currentStory':_0x5f265f,'currentAnswer':_0x5f265f[_0x3e62b5(0x5df)],'questionCount':0x0,'gameTimer':null,'gameMode':_0x245f70,'dmPersonality':_0x10ee4e['dmPersonality'],'gameSession':{'gameId':_0x3e62b5(0x9f9)+Date[_0x3e62b5(0x2eb)](),'players':_0x245f70===_0x3e62b5(0x1257)?[_0x3e62b5(0xa80),...Object[_0x3e62b5(0x1c9f)](currentChatCharacter['members']||{})]:[_0x3e62b5(0xa80),currentChatCharacter['id']],'storyId':_0x5f265f['id'],'chatHistory':[],'gameEvents':[{'type':_0x3e62b5(0x18bc),'timestamp':Date['now'](),'player':'system','data':{'gameName':_0x3e62b5(0xbea),'storyTitle':_0x5f265f['title'],'gameMode':_0x245f70}}]}},updateTurtleSoupUI(),startTurtleSoupTimer();const _0x263905=document['getElementById'](_0x3e62b5(0x72b));_0x263905[_0x3e62b5(0x33a)]='',setTimeout(()=>{showDMMessage('欢迎来到海龟汤推理游戏！我是你们的游戏主持人。');},0x1f4),setTimeout(()=>{const _0x1b8199=_0x3e62b5;showDMMessage(_0x1b8199(0xb43));},0x5dc),setTimeout(()=>{const _0x322219=_0x3e62b5;showDMMessage(_0x322219(0x43a));},0x9c4),setTimeout(()=>{const _0x4aaa01=_0x3e62b5;showDMMessage(_0x4aaa01(0x13d1));},0xdac),setTimeout(()=>{presentStory(_0x5f265f);},0x1194);}function presentStory(_0x3b95c1){const _0x1a5d15=_0x211817,_0x41ad75=document[_0x1a5d15(0x1262)](_0x1a5d15(0x227));_0x41ad75[_0x1a5d15(0x13be)]=_0x3b95c1[_0x1a5d15(0x1593)],setTimeout(()=>{const _0x26e2b4=_0x1a5d15;showDMMessage(_0x26e2b4(0x18ed)+_0x3b95c1[_0x26e2b4(0x378)]+'\x22');},0x1f4),setTimeout(()=>{const _0x389f36=_0x1a5d15;showDMMessage(_0x389f36(0xb57));},0x5dc);}function showDMMessage(_0x3d65f6,_0x17e819=!![]){const _0x220ee0=_0x211817,_0x5ea549=document['getElementById']('turtle-soup-dm-message');_0x5ea549['textContent']=_0x3d65f6;if(_0x17e819&&turtleSoupGameState[_0x220ee0(0x230f)]){const _0x23fa79={'id':'dm_'+Date[_0x220ee0(0x2eb)]()+'_'+Math['random']()['toString'](0x24)[_0x220ee0(0x15fb)](0x2,0x9),'sender':'dm','content':_0x3d65f6,'timestamp':Date[_0x220ee0(0x2eb)](),'isGameMessage':!![],'gameName':_0x220ee0(0xbea)};turtleSoupGameState[_0x220ee0(0x19e0)][_0x220ee0(0x10e5)][_0x220ee0(0x1cd6)](_0x23fa79);}}function addTurtleSoupChatMessage(_0x26185c,_0x323ffc,_0x27401c=![]){const _0x53e35e=_0x211817,_0x350c33=document[_0x53e35e(0x1262)](_0x53e35e(0x72b)),_0x19713d=document[_0x53e35e(0xac6)](_0x53e35e(0xbbc));_0x19713d[_0x53e35e(0x1722)]=_0x53e35e(0x1209)+_0x26185c;const _0x45c4b3=document['createElement'](_0x53e35e(0xbbc));_0x45c4b3[_0x53e35e(0x1722)]='game-chat-bubble',_0x45c4b3['textContent']=_0x323ffc,_0x19713d[_0x53e35e(0x497)](_0x45c4b3),_0x350c33[_0x53e35e(0x497)](_0x19713d),_0x350c33[_0x53e35e(0x98c)]=_0x350c33['scrollHeight'];const _0x299b54={'id':_0x53e35e(0x121f)+Date[_0x53e35e(0x2eb)]()+'_'+Math[_0x53e35e(0x11a8)]()[_0x53e35e(0x1878)](0x24)['substr'](0x2,0x9),'sender':_0x26185c,'content':_0x323ffc,'timestamp':Date[_0x53e35e(0x2eb)](),'isGameMessage':!![],'gameName':'海龟汤'};turtleSoupGameState[_0x53e35e(0x19e0)][_0x53e35e(0x10e5)][_0x53e35e(0x1cd6)](_0x299b54),_0x27401c&&currentChatCharacter&&recordGameChat(currentChatCharacter['id'],_0x26185c,_0x323ffc,{'gameName':_0x53e35e(0xbea),'gameState':'playing'});}async function sendTurtleSoupQuestion(){const _0x2ac203=_0x211817,_0x350c19=document['getElementById'](_0x2ac203(0x1558)),_0x29e039=_0x350c19[_0x2ac203(0x1ebc)]['trim']();if(!_0x29e039)return;if(!turtleSoupGameState['gameActive']){showToast('游戏已结束','warning');return;}addTurtleSoupChatMessage(_0x2ac203(0xa80),_0x29e039,!![]),_0x350c19[_0x2ac203(0x1ebc)]='',setTimeout(async()=>{const _0x4b4ce0=_0x2ac203;try{await generateCharacterTurtleSoupResponse(_0x29e039);}catch(_0x2fc48d){console[_0x4b4ce0(0x174a)](_0x4b4ce0(0x8e1),_0x2fc48d);const _0x174a12=[_0x4b4ce0(0x20a),_0x4b4ce0(0x11b9),_0x4b4ce0(0x2cd),'我觉得这个方向值得探索'],_0x477c21=_0x174a12[Math[_0x4b4ce0(0x2180)](Math[_0x4b4ce0(0x11a8)]()*_0x174a12[_0x4b4ce0(0x19ee)])];addTurtleSoupChatMessage(currentChatCharacter['id'],_0x477c21,!![]);}},0x320+Math[_0x2ac203(0x11a8)]()*0x4b0);}async function finishSpeakingAndTriggerDM(){const _0x3ae8ce=_0x211817;if(!turtleSoupGameState[_0x3ae8ce(0x230f)]){showToast(_0x3ae8ce(0xbdd),_0x3ae8ce(0x1816));return;}const _0x186b59=turtleSoupGameState[_0x3ae8ce(0x19e0)][_0x3ae8ce(0x10e5)][_0x3ae8ce(0x6d5)](-0xa)[_0x3ae8ce(0x1e1f)](_0x5b32e3=>_0x5b32e3[_0x3ae8ce(0x8a1)]==='user'||_0x5b32e3[_0x3ae8ce(0x8a1)]!=='dm'&&_0x5b32e3['sender']!==_0x3ae8ce(0x1744))[_0x3ae8ce(0x6a4)](_0x405316=>_0x405316[_0x3ae8ce(0x8a1)]+':\x20'+_0x405316[_0x3ae8ce(0x211c)])[_0x3ae8ce(0x122b)]('\x0a');if(!_0x186b59['trim']()){showToast('请先提出问题或进行讨论',_0x3ae8ce(0x1816));return;}showDMMessage(_0x3ae8ce(0xd8f)),setTimeout(async()=>{const _0x20b9e4=_0x3ae8ce;try{const _0x219888=await generateDMResponseToDiscussion(_0x186b59);showDMMessage(_0x219888);const _0x5c0e5f=_0x186b59[_0x20b9e4(0x1831)]('?')||_0x186b59[_0x20b9e4(0x1831)]('？')||_0x186b59[_0x20b9e4(0x1831)]('是否')||_0x186b59['includes'](_0x20b9e4(0x251))||_0x186b59[_0x20b9e4(0x1831)](_0x20b9e4(0x1bc5))||_0x186b59[_0x20b9e4(0x1831)](_0x20b9e4(0x813));_0x5c0e5f&&(turtleSoupGameState[_0x20b9e4(0x8bb)]++,updateTurtleSoupUI());}catch(_0x2ced42){console['error'](_0x20b9e4(0x18d7),_0x2ced42);const _0x1bd589=['这个问题很有趣，让我想想...','你们的推理很有道理',_0x20b9e4(0x180c),'还需要更多线索',_0x20b9e4(0x1016)],_0x33fc50=_0x1bd589[Math[_0x20b9e4(0x2180)](Math[_0x20b9e4(0x11a8)]()*_0x1bd589[_0x20b9e4(0x19ee)])];showDMMessage(_0x33fc50);}},0x1f4+Math[_0x3ae8ce(0x11a8)]()*0x3e8);}async function generateDMResponseToDiscussion(_0x4ea843){const _0x4b595b=_0x211817,_0xd26bd3=turtleSoupGameState['currentStory'],_0x51afdc=turtleSoupGameState[_0x4b595b(0xbde)],_0x179377=turtleSoupGameState[_0x4b595b(0x8bb)],_0x1a681c=turtleSoupGameState[_0x4b595b(0x19e0)]['chatHistory'][_0x4b595b(0x6d5)](-0xf)[_0x4b595b(0x6a4)](_0x51059f=>_0x51059f[_0x4b595b(0x8a1)]+':\x20'+_0x51059f['content'])['join']('\x0a'),_0x30e0ad=turtleSoupGameState[_0x4b595b(0xe0a)]||_0x4b595b(0x14b5);let _0x329296='';switch(_0x30e0ad){case _0x4b595b(0x14b5):_0x329296=_0x4b595b(0x1013);break;case _0x4b595b(0x1010):_0x329296=_0x4b595b(0x15b1);break;case _0x4b595b(0x1566):_0x329296=_0x4b595b(0x9b9);break;default:_0x329296='你是一个专业的DM，保持中性的态度。';}const _0x4ce578=_0x4b595b(0x16e9)+_0x329296+_0x4b595b(0x18e4)+_0xd26bd3[_0x4b595b(0x1593)]+'\x0a【汤底真相】：'+_0x51afdc+_0x4b595b(0x14ff)+_0x179377+_0x4b595b(0x19aa)+_0x1a681c+_0x4b595b(0x1235)+_0x4ea843+_0x4b595b(0x211);try{const _0x3e1bd6=await callTurtleSoupDMAPI(_0x4ce578);let _0x4c193d='';if(Array[_0x4b595b(0x1496)](_0x3e1bd6)&&_0x3e1bd6[_0x4b595b(0x19ee)]>0x0)_0x4c193d=_0x3e1bd6[0x0][_0x4b595b(0x19d7)]();else typeof _0x3e1bd6===_0x4b595b(0x11b7)&&(_0x4c193d=_0x3e1bd6[_0x4b595b(0x19d7)]());(_0x4c193d[_0x4b595b(0x1b30)]('```json')||_0x4c193d[_0x4b595b(0x1b30)](_0x4b595b(0x1265)))&&(_0x4c193d=_0x4c193d[_0x4b595b(0xe16)](/```json\s*|\s*```/g,'')[_0x4b595b(0x19d7)]());if(_0x4c193d[_0x4b595b(0x1b30)]('[')&&_0x4c193d[_0x4b595b(0x81f)](']'))try{const _0x49774c=JSON[_0x4b595b(0x22d3)](_0x4c193d);Array['isArray'](_0x49774c)&&_0x49774c[_0x4b595b(0x19ee)]>0x0&&(_0x4c193d=_0x49774c[0x0][_0x4b595b(0x1878)]()[_0x4b595b(0x19d7)]());}catch(_0x1393e2){_0x4c193d=_0x4c193d['replace'](/^\[|\]$/g,'')['trim'](),_0x4c193d['startsWith']('\x22')&&_0x4c193d[_0x4b595b(0x81f)]('\x22')&&(_0x4c193d=_0x4c193d['slice'](0x1,-0x1));}if(!_0x4c193d||_0x4c193d[_0x4b595b(0x19ee)]>0x64)throw new Error(_0x4b595b(0x321));return _0x4c193d;}catch(_0x4d16f2){console[_0x4b595b(0x174a)](_0x4b595b(0x18d7),_0x4d16f2);throw _0x4d16f2;}}async function generateAIDMAnswer(_0x2a3a3d){const _0x1e89b6=_0x211817,_0x525dda=turtleSoupGameState[_0x1e89b6(0x20a6)],_0x231f28=turtleSoupGameState[_0x1e89b6(0xbde)],_0x3efb11=turtleSoupGameState[_0x1e89b6(0x8bb)],_0x2381bd=turtleSoupGameState['gameSession']['chatHistory'][_0x1e89b6(0x6d5)](-0xa)[_0x1e89b6(0x6a4)](_0xeade12=>_0xeade12[_0x1e89b6(0x8a1)]+':\x20'+_0xeade12[_0x1e89b6(0x211c)])[_0x1e89b6(0x122b)]('\x0a'),_0x3c9a4d=turtleSoupGameState[_0x1e89b6(0xe0a)]||_0x1e89b6(0x14b5);let _0xa4875c='';switch(_0x3c9a4d){case'friendly':_0xa4875c=_0x1e89b6(0x1013);break;case _0x1e89b6(0x1010):_0xa4875c=_0x1e89b6(0x15b1);break;case _0x1e89b6(0x1566):_0xa4875c=_0x1e89b6(0x9b9);break;default:_0xa4875c='你是一个专业的DM，保持中性的态度。';}const _0x5cefe2=_0x1e89b6(0x16e9)+_0xa4875c+'\x0a\x0a【当前汤面】：'+_0x525dda[_0x1e89b6(0x1593)]+_0x1e89b6(0x2084)+_0x231f28+_0x1e89b6(0x204a)+_0x3efb11+_0x1e89b6(0xcf8)+_0x2381bd+_0x1e89b6(0xbaa)+_0x2a3a3d+'\x0a\x0a请根据你的性格特点，作为专业的海龟汤DM给出简洁明确的回答（不超过20字）。如果问题很接近真相，可以给予适当的提示和鼓励。\x0a\x0a重要：请直接输出纯文本回答，不要使用JSON格式或数组格式。';try{const _0x3ab0ab=await callTurtleSoupDMAPI(_0x5cefe2);let _0x163c55='';if(Array[_0x1e89b6(0x1496)](_0x3ab0ab)&&_0x3ab0ab[_0x1e89b6(0x19ee)]>0x0)_0x163c55=_0x3ab0ab[0x0][_0x1e89b6(0x19d7)]();else typeof _0x3ab0ab==='string'&&(_0x163c55=_0x3ab0ab['trim']());(_0x163c55[_0x1e89b6(0x1b30)](_0x1e89b6(0xd0f))||_0x163c55[_0x1e89b6(0x1b30)](_0x1e89b6(0x1265)))&&(_0x163c55=_0x163c55[_0x1e89b6(0xe16)](/```json\s*|\s*```/g,'')[_0x1e89b6(0x19d7)]());if(_0x163c55['startsWith']('[')&&_0x163c55[_0x1e89b6(0x81f)](']'))try{const _0x5cb153=JSON[_0x1e89b6(0x22d3)](_0x163c55);Array[_0x1e89b6(0x1496)](_0x5cb153)&&_0x5cb153[_0x1e89b6(0x19ee)]>0x0&&(_0x163c55=_0x5cb153[0x0]['toString']()[_0x1e89b6(0x19d7)]());}catch(_0xc8cee2){_0x163c55=_0x163c55[_0x1e89b6(0xe16)](/^\[|\]$/g,'')[_0x1e89b6(0x19d7)](),_0x163c55[_0x1e89b6(0x1b30)]('\x22')&&_0x163c55[_0x1e89b6(0x81f)]('\x22')&&(_0x163c55=_0x163c55[_0x1e89b6(0x6d5)](0x1,-0x1));}if(!_0x163c55||_0x163c55['length']>0x32)throw new Error(_0x1e89b6(0x12a4));return _0x163c55;}catch(_0x4b3b3a){console[_0x1e89b6(0x174a)](_0x1e89b6(0x2025),_0x4b3b3a);throw _0x4b3b3a;}}async function callTurtleSoupDMAPI(_0x24dfb3){const _0x240172=_0x211817;console[_0x240172(0x2187)]('🎭\x20DM\x20API调用开始，检查API设置:',apiSettings);if(!apiSettings[_0x240172(0x213c)]||!apiSettings[_0x240172(0x1208)])throw new Error('API设置不完整，请先配置API');const _0x263404={'id':_0x240172(0x100b),'name':_0x240172(0x8ad),'description':_0x240172(0x2066),'personality':_0x240172(0x2019),'scenario':_0x240172(0x1edd),'firstMessage':_0x240172(0x1824),'avatar':'🎭'};console['log']('🎭\x20调用callChatAPI，prompt长度:',_0x24dfb3[_0x240172(0x19ee)]);const _0x3d9572=await callChatAPI(_0x24dfb3,_0x263404);return console[_0x240172(0x2187)](_0x240172(0xfd3),_0x3d9572),_0x3d9572;}async function generateTurtleSoupStoryByDM(_0x2d9361='random'){const _0x19c6a1=_0x211817;let _0x3c475f='';switch(_0x2d9361){case _0x19c6a1(0x1def):_0x3c475f=_0x19c6a1(0x820);break;case _0x19c6a1(0xc3f):_0x3c475f='恐怖悬疑类型，带有恐怖元素但不过分血腥';break;case _0x19c6a1(0xfa2):_0x3c475f='轻松搞笑类型，幽默有趣的推理故事';break;case _0x19c6a1(0xf64):_0x3c475f=_0x19c6a1(0x1f67);break;default:_0x3c475f=_0x19c6a1(0xb62);}const _0x1b37a0=_0x19c6a1(0x9ce)+_0x3c475f+_0x19c6a1(0x284);try{const _0x48e368=await callTurtleSoupDMAPI(_0x1b37a0);let _0x51395d='';if(Array[_0x19c6a1(0x1496)](_0x48e368)&&_0x48e368[_0x19c6a1(0x19ee)]>0x0)_0x51395d=_0x48e368[0x0][_0x19c6a1(0x19d7)]();else typeof _0x48e368===_0x19c6a1(0x11b7)&&(_0x51395d=_0x48e368[_0x19c6a1(0x19d7)]());console[_0x19c6a1(0x2187)](_0x19c6a1(0x571),_0x51395d);let _0xd36201;try{_0x51395d=_0x51395d[_0x19c6a1(0xe16)](/```json\n?/g,'')[_0x19c6a1(0xe16)](/```\n?/g,''),console['log'](_0x19c6a1(0x1fc8),_0x51395d);const _0x4cfa1d=JSON[_0x19c6a1(0x22d3)](_0x51395d);console[_0x19c6a1(0x2187)](_0x19c6a1(0x835),_0x4cfa1d);if(Array[_0x19c6a1(0x1496)](_0x4cfa1d)&&_0x4cfa1d[_0x19c6a1(0x19ee)]>0x0)_0xd36201=_0x4cfa1d[0x0],console[_0x19c6a1(0x2187)](_0x19c6a1(0x50c),_0xd36201);else{if(typeof _0x4cfa1d===_0x19c6a1(0x28d)&&_0x4cfa1d!==null)_0xd36201=_0x4cfa1d;else throw new Error(_0x19c6a1(0x295));}}catch(_0x43c6b3){console[_0x19c6a1(0x174a)](_0x19c6a1(0x1a64),_0x43c6b3),console['error']('原始文本:',_0x51395d);throw new Error(_0x19c6a1(0x7aa));}console[_0x19c6a1(0x2187)](_0x19c6a1(0x1cc8),{'title':_0xd36201[_0x19c6a1(0x378)],'story':_0xd36201['story'],'answer':_0xd36201['answer']});if(!_0xd36201['title']||!_0xd36201['story']||!_0xd36201[_0x19c6a1(0x5df)]){console['error'](_0x19c6a1(0xc93),_0xd36201);throw new Error('故事数据不完整');}return _0xd36201['id']=_0x19c6a1(0xb74)+Date[_0x19c6a1(0x2eb)](),_0xd36201[_0x19c6a1(0x10d7)]=_0xd36201[_0x19c6a1(0x10d7)]||_0x19c6a1(0x950),_0xd36201[_0x19c6a1(0x10e7)]=_0xd36201[_0x19c6a1(0x10e7)]||[_0x2d9361],console[_0x19c6a1(0x2187)]('🎭\x20DM成功生成新故事:',_0xd36201['title']),_0xd36201;}catch(_0x4f4dbf){console[_0x19c6a1(0x174a)](_0x19c6a1(0x18c9),_0x4f4dbf),console[_0x19c6a1(0x2187)](_0x19c6a1(0x177b));const _0x12d9bf=generateBackupTurtleSoupStory(_0x2d9361);return _0x12d9bf;}}function generateBackupTurtleSoupStory(_0x1d3370='random'){const _0x3906b3=_0x211817,_0x22483e={'classic':{'title':'深夜的电话','story':_0x3906b3(0x1a53),'answer':_0x3906b3(0xb44),'difficulty':_0x3906b3(0x950),'tags':[_0x3906b3(0x1def)]},'horror':{'title':'镜子里的女人','story':_0x3906b3(0x1ed),'answer':'她是双胞胎姐妹，镜子对面就是她的双胞胎妹妹的房间。','difficulty':_0x3906b3(0x20a3),'tags':[_0x3906b3(0xc3f)]},'funny':{'title':'不吃饭的顾客','story':'餐厅里有个顾客点了很多菜但一口都不吃，老板却很高兴。','answer':_0x3906b3(0xa9d),'difficulty':_0x3906b3(0x20a3),'tags':[_0x3906b3(0xfa2)]},'romantic':{'title':_0x3906b3(0x15c5),'story':'一个男人每天都给同一个女人送花，但她从来不收。','answer':'女人已经去世了，男人每天给她的墓碑送花。','difficulty':_0x3906b3(0x950),'tags':['romantic']}};let _0x12bb1a;if(_0x1d3370!=='random'&&_0x22483e[_0x1d3370])_0x12bb1a=_0x22483e[_0x1d3370];else{const _0x754170=Object['keys'](_0x22483e),_0x5546d8=_0x754170[Math['floor'](Math[_0x3906b3(0x11a8)]()*_0x754170[_0x3906b3(0x19ee)])];_0x12bb1a=_0x22483e[_0x5546d8];}return _0x12bb1a['id']=_0x3906b3(0x7dc)+Date['now'](),console[_0x3906b3(0x2187)](_0x3906b3(0x2249),_0x12bb1a['title']),_0x12bb1a;}async function generateCharacterTurtleSoupResponse(_0x523018){const _0x45734a=_0x211817;if(!turtleSoupGameState[_0x45734a(0x230f)])return;const _0x2e9eaa=currentChatCharacter;if(!_0x2e9eaa)return;const _0x470dad=turtleSoupGameState[_0x45734a(0x20a6)],_0x13c066=turtleSoupGameState['questionCount'],_0x2d2579=turtleSoupGameState[_0x45734a(0x19e0)]['chatHistory'][_0x45734a(0x6d5)](-0xa)[_0x45734a(0x6a4)](_0x3539ae=>_0x3539ae[_0x45734a(0x8a1)]+':\x20'+_0x3539ae[_0x45734a(0x211c)])[_0x45734a(0x122b)]('\x0a'),_0x385c33='你是'+_0x2e9eaa[_0x45734a(0x1a1c)]+'，'+_0x2e9eaa['prompt']+_0x45734a(0x1827)+_0x470dad[_0x45734a(0x1593)]+_0x45734a(0x212f)+_0x13c066+_0x45734a(0x7a9)+_0x2d2579+_0x45734a(0x1419)+_0x523018+_0x45734a(0x6f4)+_0x2e9eaa[_0x45734a(0x1a1c)]+_0x45734a(0x1750);try{const _0x37bcbb=await callChatAPI(_0x385c33,_0x2e9eaa);let _0x4daf8b='';if(Array[_0x45734a(0x1496)](_0x37bcbb)&&_0x37bcbb['length']>0x0)_0x4daf8b=_0x37bcbb[0x0][_0x45734a(0x19d7)]();else typeof _0x37bcbb===_0x45734a(0x11b7)&&(_0x4daf8b=_0x37bcbb['trim']());if(_0x4daf8b&&_0x4daf8b['length']>0x0)_0x4daf8b[_0x45734a(0x19ee)]>0x64&&(_0x4daf8b=_0x4daf8b[_0x45734a(0x17ca)](0x0,0x61)+_0x45734a(0x1520)),addTurtleSoupChatMessage(_0x2e9eaa['id'],_0x4daf8b,!![]);else throw new Error('AI回应为空');}catch(_0xc38751){console[_0x45734a(0x174a)](_0x45734a(0x8e1),_0xc38751);const _0x3be835=getPersonalizedBackupResponses(_0x2e9eaa,_0x523018),_0x5abcfc=_0x3be835[Math[_0x45734a(0x2180)](Math[_0x45734a(0x11a8)]()*_0x3be835[_0x45734a(0x19ee)])];addTurtleSoupChatMessage(_0x2e9eaa['id'],_0x5abcfc,!![]);}}function getPersonalizedBackupResponses(_0x1c9ac2,_0x2bf886){const _0x1bc257=_0x211817,_0x14e589=[_0x1bc257(0x1ac4),_0x1bc257(0x2ed),_0x1bc257(0x1efa),'这个方向值得探索'],_0x39956d=(_0x1c9ac2[_0x1bc257(0x7a1)]||_0x1c9ac2[_0x1bc257(0x7c9)]||'')[_0x1bc257(0x49e)]();if(_0x39956d[_0x1bc257(0x1831)]('可爱')||_0x39956d[_0x1bc257(0x1831)]('萌')||_0x39956d[_0x1bc257(0x1831)]('天真'))return[_0x1bc257(0x1d67),_0x1bc257(0xe5a),_0x1bc257(0x1cad),_0x1bc257(0xb48)];else{if(_0x39956d[_0x1bc257(0x1831)]('冷静')||_0x39956d[_0x1bc257(0x1831)]('理性')||_0x39956d[_0x1bc257(0x1831)]('聪明'))return[_0x1bc257(0x531),_0x1bc257(0x1d8),_0x1bc257(0x22b5),_0x1bc257(0x207f)];else{if(_0x39956d[_0x1bc257(0x1831)]('活泼')||_0x39956d[_0x1bc257(0x1831)]('开朗')||_0x39956d['includes']('热情'))return[_0x1bc257(0x1c14),_0x1bc257(0x12da),'还有什么线索呢？','好有趣的推理！'];}}return _0x14e589;}function generateDMAnswer(_0x5f263c){const _0x12deb3=_0x211817,_0x52c593=_0x5f263c[_0x12deb3(0x49e)](),_0x8de213=turtleSoupGameState['currentStory'],_0x528e20=turtleSoupGameState[_0x12deb3(0xbde)];if(_0x52c593[_0x12deb3(0x1831)]('死')||_0x52c593[_0x12deb3(0x1831)]('自杀')){if(_0x8de213['id']===0x1)return _0x12deb3(0x1df3);return'不是。';}if(_0x52c593[_0x12deb3(0x1831)]('盲')||_0x52c593['includes'](_0x12deb3(0x7e6))){if(_0x8de213['id']===0x1||_0x8de213['id']===0x3)return _0x12deb3(0x1df3);return _0x12deb3(0x19e9);}if(_0x52c593[_0x12deb3(0x1831)]('电话')||_0x52c593['includes']('通话')){if(_0x8de213['id']===0x1)return _0x12deb3(0x1cfc);return _0x12deb3(0x1d8a);}if(_0x52c593['includes']('医院')||_0x52c593[_0x12deb3(0x1831)]('医生')){if(_0x8de213['id']===0x1)return'是的！';return _0x12deb3(0x19e9);}if(_0x52c593[_0x12deb3(0x1831)](_0x12deb3(0x197c))||_0x52c593[_0x12deb3(0x1831)]('送信')){if(_0x8de213['id']===0x2)return'是的！';return _0x12deb3(0x19e9);}if(_0x52c593[_0x12deb3(0x1831)]('尸体')||_0x52c593[_0x12deb3(0x1831)]('死人')){if(_0x8de213['id']===0x2||_0x8de213['id']===0x3)return _0x12deb3(0x1df3);return _0x12deb3(0x19e9);}const _0x359859=['是的。',_0x12deb3(0x19e9),_0x12deb3(0x1d8a),_0x12deb3(0x237),_0x12deb3(0x1427)];return _0x359859[Math['floor'](Math['random']()*_0x359859[_0x12deb3(0x19ee)])];}function getDMComment(_0x4cf45c,_0x9ed60a){const _0x416fa7=_0x211817;if(_0x9ed60a[_0x416fa7(0x1831)]('是的！')||_0x9ed60a[_0x416fa7(0x1831)](_0x416fa7(0x19fd)))return'很好的问题！你们离真相越来越近了！';else{if(_0x9ed60a===_0x416fa7(0x1df3))return'回答正确，继续这个方向思考。';else return _0x9ed60a===_0x416fa7(0x19e9)?_0x416fa7(0x1f1a):'这个问题与案件无关，问点别的吧。';}}function updateTurtleSoupUI(){const _0x1c8141=_0x211817,_0x545e5d=document[_0x1c8141(0x1262)](_0x1c8141(0x156b));_0x545e5d[_0x1c8141(0x13be)]=_0x1c8141(0x6c6)+turtleSoupGameState[_0x1c8141(0x8bb)];}function startTurtleSoupTimer(){const _0x3439da=_0x211817,_0x1d0b0c=document[_0x3439da(0x1262)](_0x3439da(0xc8c));turtleSoupGameState['gameTimer']=setInterval(()=>{const _0x57ee0f=_0x3439da,_0x4c3d53=Date[_0x57ee0f(0x2eb)]()-turtleSoupGameState['gameStartTime'],_0x1c0506=Math[_0x57ee0f(0x2180)](_0x4c3d53/0xea60),_0x5cbfe5=Math[_0x57ee0f(0x2180)](_0x4c3d53%0xea60/0x3e8);_0x1d0b0c[_0x57ee0f(0x13be)]=_0x1c0506[_0x57ee0f(0x1878)]()[_0x57ee0f(0xdfe)](0x2,'0')+':'+_0x5cbfe5[_0x57ee0f(0x1878)]()[_0x57ee0f(0xdfe)](0x2,'0');},0x3e8);}function requestTurtleSoupHint(){const _0x4c0919=_0x211817;if(!turtleSoupGameState['gameActive']){showToast(_0x4c0919(0xbdd),_0x4c0919(0x1816));return;}const _0x3c296d=turtleSoupGameState[_0x4c0919(0x20a6)],_0x4a4882=['想想故事中的关键人物...','注意时间和地点的细节...',_0x4c0919(0x173c),'思考一下感官方面的问题...'],_0x5c2fcd=_0x4a4882[Math['floor'](Math[_0x4c0919(0x11a8)]()*_0x4a4882[_0x4c0919(0x19ee)])];showDMMessage(_0x4c0919(0x105c)+_0x5c2fcd);}function giveTurtleSoupAnswer(){const _0x30bef0=_0x211817;if(!turtleSoupGameState[_0x30bef0(0x230f)]){showToast('游戏已结束','warning');return;}confirm(_0x30bef0(0xfe1))&&endTurtleSoupGame(_0x30bef0(0x1b85));}function endTurtleSoupGame(_0x51418b){const _0x605151=_0x211817;turtleSoupGameState[_0x605151(0x230f)]=![],clearInterval(turtleSoupGameState[_0x605151(0x212d)]);const _0x2338a8=turtleSoupGameState[_0x605151(0xbde)];showDMMessage(_0x605151(0x1341)),setTimeout(()=>{showDMMessage('🎯\x20汤底揭晓：'+_0x2338a8);},0x3e8),setTimeout(()=>{const _0x2c2e94=_0x605151;_0x51418b===_0x2c2e94(0x1b85)?showDMMessage(_0x2c2e94(0x179b)):showDMMessage(_0x2c2e94(0xa15));},0x7d0),turtleSoupGameState['gameSession']['gameEvents'][_0x605151(0x1cd6)]({'type':'game_end','timestamp':Date[_0x605151(0x2eb)](),'player':_0x605151(0x1744),'data':{'reason':_0x51418b,'questionCount':turtleSoupGameState[_0x605151(0x8bb)],'gameDuration':Date[_0x605151(0x2eb)]()-turtleSoupGameState[_0x605151(0x192a)]}});}async function startNewTurtleSoupGame(){const _0x47687e=_0x211817;if(turtleSoupGameState[_0x47687e(0x230f)]){if(!confirm(_0x47687e(0x194e)))return;}await initTurtleSoupGame(),showToast(_0x47687e(0x1c13),'success');}function exitTurtleSoupGame(){const _0x2cd271=_0x211817;turtleSoupGameState[_0x2cd271(0x230f)]?confirm('游戏还在进行中，确定要退出吗？')&&(turtleSoupGameState['gameActive']=![],clearInterval(turtleSoupGameState[_0x2cd271(0x212d)]),hideApp(_0x2cd271(0xd32)),showApp(_0x2cd271(0xcf2))):(hideApp(_0x2cd271(0xd32)),showApp(_0x2cd271(0xcf2)));}function showTurtleSoupSettings(){const _0x4f376e=_0x211817,_0x3a6ff5=document[_0x4f376e(0xac6)](_0x4f376e(0xbbc));_0x3a6ff5[_0x4f376e(0x1722)]='modal-overlay',_0x3a6ff5[_0x4f376e(0x33a)]=_0x4f376e(0x21d1),document[_0x4f376e(0x1da9)][_0x4f376e(0x497)](_0x3a6ff5),loadTurtleSoupSettings();}async function saveTurtleSoupSettings(){const _0xb3bd72=_0x211817,_0x4cc0cf=document[_0xb3bd72(0xb30)](_0xb3bd72(0x18c4)),_0x57829a=document[_0xb3bd72(0xb30)]('input[name=\x22dmPersonality\x22]:checked');if(!_0x4cc0cf||!_0x57829a){showToast(_0xb3bd72(0x1f6f),_0xb3bd72(0x1816));return;}const _0x3776f9={'preferredType':_0x4cc0cf[_0xb3bd72(0x1ebc)],'dmPersonality':_0x57829a[_0xb3bd72(0x1ebc)]};try{await db[_0xb3bd72(0x181d)][_0xb3bd72(0x1561)]({'key':'turtleSoupSettings','value':_0x3776f9}),turtleSoupGameState[_0xb3bd72(0x230f)]&&(turtleSoupGameState[_0xb3bd72(0xe0a)]=_0x3776f9[_0xb3bd72(0xe0a)]),showToast(_0xb3bd72(0x961),'success'),document['querySelector'](_0xb3bd72(0x119f))[_0xb3bd72(0x1493)]();}catch(_0x3fc618){console[_0xb3bd72(0x174a)]('保存海龟汤设置失败:',_0x3fc618),showToast('保存设置失败','error');}}async function loadTurtleSoupSettings(){const _0x1ec453=_0x211817;try{const _0x4c6e67=await db[_0x1ec453(0x181d)][_0x1ec453(0xb78)](_0x1ec453(0x21f2));if(_0x4c6e67&&_0x4c6e67[_0x1ec453(0x1ebc)]){const {preferredType:_0x4be270,dmPersonality:_0x57a24f}=_0x4c6e67[_0x1ec453(0x1ebc)],_0x591847=document['querySelector'](_0x1ec453(0x19a6)+_0x4be270+'\x22]');if(_0x591847)_0x591847[_0x1ec453(0x14c1)]=!![];const _0x4877d1=document[_0x1ec453(0xb30)]('input[name=\x22dmPersonality\x22][value=\x22'+_0x57a24f+'\x22]');if(_0x4877d1)_0x4877d1[_0x1ec453(0x14c1)]=!![];}}catch(_0x45a41d){console[_0x1ec453(0x174a)](_0x1ec453(0x1632),_0x45a41d);}}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x955ca1=_0x211817,_0x4e8afe=document[_0x955ca1(0x1262)](_0x955ca1(0x1558));_0x4e8afe&&_0x4e8afe[_0x955ca1(0x21e9)](_0x955ca1(0xf20),function(_0x406b3a){_0x406b3a['key']==='Enter'&&sendTurtleSoupQuestion();});});async function loadTodayDiary(){const _0x57a2a0=_0x211817;if(!currentChatCharacter)return;const _0xd30e84=new Date()['toISOString']()['split']('T')[0x0],_0x3d8111=currentChatCharacter['id']+'_'+_0xd30e84;let _0x34ad35=null;try{_0x34ad35=await db[_0x57a2a0(0x2077)][_0x57a2a0(0xb78)](_0x3d8111);if(!_0x34ad35){const _0x2a9508=_0x57a2a0(0x6f1)+currentChatCharacter['id']+'_'+_0xd30e84,_0x2604cc=localStorage[_0x57a2a0(0x15d8)](_0x2a9508);if(_0x2604cc){const _0x55c42d=cleanDiaryContent(_0x2604cc);await db[_0x57a2a0(0x2077)][_0x57a2a0(0x21e2)]({'id':_0x3d8111,'characterId':currentChatCharacter['id'],'date':_0xd30e84,'content':_0x55c42d,'timestamp':new Date()[_0x57a2a0(0x704)](),'weather':'☀️'}),_0x34ad35={'content':_0x55c42d},localStorage[_0x57a2a0(0x3b2)](_0x2a9508),console[_0x57a2a0(0x2187)](_0x57a2a0(0x1af2));}}}catch(_0x53e1cf){console[_0x57a2a0(0x174a)]('获取今日日记失败:',_0x53e1cf),showToast('获取日记失败',_0x57a2a0(0x174a));return;}const _0x3a3a3f=document[_0x57a2a0(0x1262)]('today-diary-content'),_0x20b62d=document[_0x57a2a0(0x1262)](_0x57a2a0(0x5c5)),_0x57260a=document[_0x57a2a0(0x1262)]('edit-diary-btn');_0x20b62d&&(_0x20b62d[_0x57a2a0(0x559)]=![],_0x20b62d['innerHTML']='<i\x20class=\x22fas\x20fa-sync-alt\x22></i>',_0x20b62d[_0x57a2a0(0x378)]=_0x57a2a0(0xb28));if(_0x34ad35&&_0x34ad35[_0x57a2a0(0x211c)]){const _0x131578=createDiaryWithHeader(_0x34ad35[_0x57a2a0(0x211c)],_0xd30e84);_0x3a3a3f[_0x57a2a0(0x33a)]=_0x131578,_0x3a3a3f[_0x57a2a0(0x1c1b)][_0x57a2a0(0x1493)](_0x57a2a0(0x1e85));_0x20b62d&&(_0x20b62d[_0x57a2a0(0x14eb)][_0x57a2a0(0x4da)]='block',_0x20b62d[_0x57a2a0(0x378)]='重新生成日记');if(_0x57260a)_0x57260a[_0x57a2a0(0x14eb)][_0x57a2a0(0x4da)]=_0x57a2a0(0x13de);}else{_0x3a3a3f['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-diary-message\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-diary-text\x22>今天还没有写日记呢...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22generate-diary-link\x22\x20onclick=\x22generateTodayDiary()\x22>🔘\x20喊他来写日记吧</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x3a3a3f[_0x57a2a0(0x1c1b)][_0x57a2a0(0x21e2)](_0x57a2a0(0x1e85));_0x20b62d&&(_0x20b62d['style'][_0x57a2a0(0x4da)]=_0x57a2a0(0x13de),_0x20b62d['title']=_0x57a2a0(0xb28));if(_0x57260a)_0x57260a[_0x57a2a0(0x14eb)]['display']=_0x57a2a0(0x102b);}}async function showTodayDiary(){showDiaryMenu();}async function generateTodayDiary(){const _0x523adf=_0x211817;if(!currentChatCharacter){showToast(_0x523adf(0x1346),_0x523adf(0x174a));return;}if(currentChatCharacter['isGroup']){showToast('群聊中不支持日记功能，请在单聊中使用','error');return;}const _0x3c4fdb=document[_0x523adf(0x1262)](_0x523adf(0x5c5)),_0x111de3=document['getElementById']('today-diary-content'),_0x339418=new Date()[_0x523adf(0x1034)]()[_0x523adf(0x204b)]('T')[0x0],_0x1f3dd1=currentChatCharacter['id']+'_'+_0x339418;let _0x4afe8d=null;try{_0x4afe8d=await db[_0x523adf(0x2077)][_0x523adf(0xb78)](_0x1f3dd1);}catch(_0x11bfd1){console[_0x523adf(0x174a)](_0x523adf(0xc4e),_0x11bfd1);}if(_0x4afe8d&&_0x4afe8d[_0x523adf(0x211c)]){const _0x5552b3=confirm(_0x523adf(0x1ffa));if(!_0x5552b3)return;}_0x3c4fdb&&(_0x3c4fdb['disabled']=!![],_0x3c4fdb[_0x523adf(0x33a)]=_0x523adf(0x1b42),_0x3c4fdb[_0x523adf(0x378)]='TA在写呢...');_0x111de3[_0x523adf(0x33a)]=_0x523adf(0x1924),_0x111de3[_0x523adf(0x1c1b)][_0x523adf(0x1493)](_0x523adf(0x1e85));try{const _0x52d3b7=currentChatCharacter,_0xcb036d=_0x52d3b7['id'],_0x5366ba=await getAsyncChatSettings(_0xcb036d),_0xd53854=chatMessages[_0xcb036d]||[],_0x3f142c=_0x5366ba[_0x523adf(0x2062)]||0x5,_0x4165cc=_0xd53854[_0x523adf(0x6d5)](-_0x3f142c),_0x1af953=_0x5366ba['crossWindowMemory']||0x3,_0x1cdece=await getVisibleMomentsForCharacter(_0x52d3b7['id'],_0x1af953);let _0x136e4b='';_0x4165cc[_0x523adf(0x19ee)]>0x0&&(_0x136e4b='\x0a\x0a最近的聊天记录：\x0a'+_0x4165cc[_0x523adf(0x6a4)](_0x588415=>{const _0x6b3090=_0x523adf;if(_0x588415[_0x6b3090(0x8a1)]===_0x6b3090(0x1e6d))return _0x6b3090(0x4ec)+_0x588415[_0x6b3090(0x211c)];if(_0x588415[_0x6b3090(0x8a1)]===_0x6b3090(0xb11))return _0x52d3b7[_0x6b3090(0x1a1c)]+'：'+_0x588415[_0x6b3090(0x211c)];return'';})[_0x523adf(0x1e1f)](Boolean)[_0x523adf(0x122b)]('\x0a'));let _0x270110='';_0x1cdece[_0x523adf(0x19ee)]>0x0&&(_0x270110=_0x523adf(0x1d2c),_0x1cdece['forEach']((_0x4718d4,_0x859662)=>{const _0x645857=_0x523adf,_0x499665=_0x4718d4['authorId']===_0x645857(0xa80)?'用户':_0x4718d4[_0x645857(0x215c)];let _0x29b5cf='';if(_0x4718d4[_0x645857(0x1716)]){const _0x13f09f=Date[_0x645857(0x2eb)](),_0x15066c=_0x13f09f-_0x4718d4[_0x645857(0x1716)],_0x977a72=Math[_0x645857(0x2180)](_0x15066c/(0x3e8*0x3c)),_0x157aa7=Math[_0x645857(0x2180)](_0x15066c/(0x3e8*0x3c*0x3c)),_0x5f5b0b=Math[_0x645857(0x2180)](_0x15066c/(0x3e8*0x3c*0x3c*0x18));if(_0x5f5b0b>0x0)_0x29b5cf='（'+_0x5f5b0b+_0x645857(0x91c);else{if(_0x157aa7>0x0)_0x29b5cf='（'+_0x157aa7+_0x645857(0x2281);else _0x977a72>0x0?_0x29b5cf='（'+_0x977a72+_0x645857(0x9ae):_0x29b5cf='（刚刚发布）';}}let _0x3b0920=_0x499665+':\x20'+_0x4718d4[_0x645857(0x1378)]+_0x29b5cf;if(_0x4718d4[_0x645857(0xb09)]&&_0x4718d4[_0x645857(0xb09)]['length']>0x0){const _0x13614a=_0x4718d4[_0x645857(0xb09)]['map'](_0x3f0c40=>'\x20\x20'+_0x3f0c40[_0x645857(0x215c)]+':\x20'+_0x3f0c40[_0x645857(0x1378)])[_0x645857(0x122b)]('\x0a');_0x3b0920+='\x0a评论：\x0a'+_0x13614a;}_0x270110+=_0x3b0920+'\x0a\x0a';}));let _0x33cf5b='';_0x52d3b7[_0x523adf(0x15e3)]&&_0x52d3b7[_0x523adf(0x15e3)][_0x523adf(0x19ee)]>0x0&&(_0x33cf5b=_0x523adf(0x59c)+_0x52d3b7[_0x523adf(0x15e3)]['map'](_0x1b9a68=>_0x1b9a68[_0x523adf(0x213c)]+':\x20'+_0x1b9a68[_0x523adf(0x1ebc)])[_0x523adf(0x122b)]('\x0a'));const _0x1bf757=new Date()[_0x523adf(0xbf7)](_0x523adf(0x156c),{'year':_0x523adf(0x94d),'month':_0x523adf(0x14a2),'day':_0x523adf(0x94d),'weekday':'long'}),_0x1ccbc1='你是'+_0x52d3b7['name']+'，你的人设如下：'+_0x52d3b7[_0x523adf(0x1f0b)]+_0x33cf5b+_0x523adf(0x2e1)+_0x1bf757+_0x523adf(0x12c5)+_0x136e4b+_0x270110+_0x523adf(0x13b4)+_0x52d3b7[_0x523adf(0x1a1c)]+_0x523adf(0x14bc),_0x5e1517=await generateAIResponse(_0x1ccbc1,_0x52d3b7);if(_0x5e1517&&_0x5e1517[_0x523adf(0x19d7)]()){let _0x1ed205=_0x5e1517[_0x523adf(0x19d7)]();_0x1ed205=cleanDiaryContent(_0x1ed205);try{await db['characterDiaries'][_0x523adf(0x1561)]({'id':_0x1f3dd1,'characterId':_0xcb036d,'date':_0x339418,'content':_0x1ed205,'timestamp':Date[_0x523adf(0x2eb)](),'weather':'☀️'}),console[_0x523adf(0x2187)](_0x523adf(0x422));}catch(_0x65dc2d){console[_0x523adf(0x174a)](_0x523adf(0x35c),_0x65dc2d);throw new Error(_0x523adf(0x111e));}const _0x38864a=createDiaryWithHeader(_0x1ed205);_0x111de3[_0x523adf(0x33a)]=_0x38864a,_0x111de3[_0x523adf(0x1c1b)][_0x523adf(0x1493)](_0x523adf(0x1e85));_0x3c4fdb&&(_0x3c4fdb['disabled']=![],_0x3c4fdb[_0x523adf(0x33a)]=_0x523adf(0x1da4),_0x3c4fdb[_0x523adf(0x378)]='重新生成日记');const _0x3fcdd2=document[_0x523adf(0x1262)](_0x523adf(0x118c));if(_0x3fcdd2)_0x3fcdd2[_0x523adf(0x14eb)][_0x523adf(0x4da)]=_0x523adf(0x13de);showToast(_0x4afe8d?'日记重新生成完成':_0x523adf(0x134b),_0x523adf(0x11cb));}else throw new Error(_0x523adf(0xc75));}catch(_0x32d154){console[_0x523adf(0x174a)](_0x523adf(0x163d),_0x32d154),_0x111de3[_0x523adf(0x33a)]=_0x523adf(0x2146),_0x111de3['classList'][_0x523adf(0x21e2)](_0x523adf(0x1e85)),_0x3c4fdb&&(_0x3c4fdb[_0x523adf(0x559)]=![],_0x3c4fdb[_0x523adf(0x33a)]='<i\x20class=\x22fas\x20fa-sync-alt\x22></i>',_0x3c4fdb[_0x523adf(0x378)]=_0x4afe8d?_0x523adf(0x16da):'生成日记'),showToast(_0x523adf(0xc75),_0x523adf(0x174a));}}async function loadPastDiaries(){const _0xeae0f9=_0x211817;if(!currentChatCharacter)return;const _0x1e1db3=currentChatCharacter['id'];let _0x2ed4d4=[];try{_0x2ed4d4=await db[_0xeae0f9(0x2077)][_0xeae0f9(0xa24)]('characterId')[_0xeae0f9(0x1694)](_0x1e1db3)[_0xeae0f9(0x16b0)]()['sortBy']('timestamp'),console[_0xeae0f9(0x2187)](_0xeae0f9(0x1326)+_0x2ed4d4['length']+'\x20条日记记录');}catch(_0x5b76fe){console['error'](_0xeae0f9(0x1527),_0x5b76fe),showToast('获取日记失败','error');return;}const _0x20733e=document[_0xeae0f9(0x1262)]('past-diaries-list');_0x2ed4d4['length']===0x0?_0x20733e['innerHTML']=_0xeae0f9(0x101a):_0x20733e[_0xeae0f9(0x33a)]=_0x2ed4d4[_0xeae0f9(0x6a4)]((_0x5e8a38,_0x5e40cf)=>{const _0x17440f=_0xeae0f9,_0x5b5d15=new Date(_0x5e8a38[_0x17440f(0x20d4)])['toLocaleDateString'](_0x17440f(0x156c),{'year':'numeric','month':_0x17440f(0x14a2),'day':_0x17440f(0x94d),'weekday':'long'}),_0x682436=_0x5e8a38[_0x17440f(0x211c)]['replace'](/<[^>]*>/g,''),_0x97b5dd=_0x682436['length']>0x64?_0x682436[_0x17440f(0x17ca)](0x0,0x64)+_0x17440f(0x1520):_0x682436;return _0x17440f(0x203e)+_0x5e40cf+')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>'+_0x5b5d15+_0x17440f(0x22c9)+_0x97b5dd+_0x17440f(0x205b);})[_0xeae0f9(0x122b)]('');}async function showPastDiaries(){const _0x535c39=_0x211817;showDiaryMenu(),switchDiaryTab(_0x535c39(0x21fd));}async function toggleDiaryEntry(_0x1b2b3d){const _0x279458=_0x211817;if(!currentChatCharacter)return;try{const _0x14ca4c=currentChatCharacter['id'],_0x229384=await db[_0x279458(0x2077)][_0x279458(0xa24)]('characterId')[_0x279458(0x1694)](_0x14ca4c)[_0x279458(0x16b0)]()['sortBy']('date');if(_0x1b2b3d>=0x0&&_0x1b2b3d<_0x229384[_0x279458(0x19ee)]){const _0x317b11=_0x229384[_0x1b2b3d];await showSingleDiaryView(_0x317b11);}}catch(_0xc7cf1a){console[_0x279458(0x174a)]('打开日记失败:',_0xc7cf1a),showToast(_0x279458(0xeca),_0x279458(0x174a));}}async function showSingleDiaryView(_0x31684f){const _0x30fa48=_0x211817;document[_0x30fa48(0x1262)]('past-diaries-view')[_0x30fa48(0x1c1b)]['remove']('active');const _0x513df3=document['getElementById'](_0x30fa48(0x154e));_0x513df3['classList'][_0x30fa48(0x21e2)](_0x30fa48(0x1a14));const _0x3715e4=document[_0x30fa48(0x1262)]('diary-mode-title'),_0x2b1ef9=new Date(_0x31684f[_0x30fa48(0x20d4)])[_0x30fa48(0xbf7)](_0x30fa48(0x156c),{'year':_0x30fa48(0x94d),'month':_0x30fa48(0x14a2),'day':_0x30fa48(0x94d),'weekday':'long'});_0x3715e4[_0x30fa48(0x13be)]=_0x2b1ef9;const _0x8bafe2=document[_0x30fa48(0x1262)](_0x30fa48(0xff4)),_0x262d13=createDiaryWithHeader(_0x31684f['content'],_0x31684f[_0x30fa48(0x20d4)]);_0x8bafe2[_0x30fa48(0x33a)]=_0x262d13,await applyDiarySettingsToSingleView();}function backFromSingleDiary(){const _0xd54331=_0x211817;document[_0xd54331(0x1262)](_0xd54331(0x154e))[_0xd54331(0x1c1b)]['remove'](_0xd54331(0x1a14)),document[_0xd54331(0x1262)](_0xd54331(0xfd2))[_0xd54331(0x1c1b)][_0xd54331(0x21e2)](_0xd54331(0x1a14)),document[_0xd54331(0x1262)]('diary-mode-title')[_0xd54331(0x13be)]='过往日记';}function createDiaryWithHeader(_0x5ab6b7,_0x2c0f3e=null){const _0x30543d=processDiaryStyles(_0x5ab6b7);return _0x30543d;}function cleanDiaryContent(_0x3c6a17){const _0xf6ac53=_0x211817;_0x3c6a17[_0xf6ac53(0x1b30)](_0xf6ac53(0xd0f))&&_0x3c6a17[_0xf6ac53(0x81f)](_0xf6ac53(0x1265))&&(_0x3c6a17=_0x3c6a17[_0xf6ac53(0x6d5)](0x7,-0x3)['trim']());_0x3c6a17[_0xf6ac53(0x1b30)]('```')&&_0x3c6a17['endsWith'](_0xf6ac53(0x1265))&&(_0x3c6a17=_0x3c6a17[_0xf6ac53(0x6d5)](0x3,-0x3)['trim']());try{const _0x1739cd=JSON[_0xf6ac53(0x22d3)](_0x3c6a17);if(typeof _0x1739cd===_0xf6ac53(0x11b7))_0x3c6a17=_0x1739cd;else{if(_0x1739cd[_0xf6ac53(0x211c)])_0x3c6a17=_0x1739cd[_0xf6ac53(0x211c)];else{if(_0x1739cd[_0xf6ac53(0x1626)])_0x3c6a17=_0x1739cd['diary'];else _0x1739cd['text']&&(_0x3c6a17=_0x1739cd[_0xf6ac53(0x1378)]);}}}catch(_0x5601ef){}return(_0x3c6a17['startsWith']('\x22')&&_0x3c6a17[_0xf6ac53(0x81f)]('\x22')||_0x3c6a17[_0xf6ac53(0x1b30)]('\x27')&&_0x3c6a17[_0xf6ac53(0x81f)]('\x27'))&&(_0x3c6a17=_0x3c6a17[_0xf6ac53(0x6d5)](0x1,-0x1)),_0x3c6a17=processDiaryStyles(_0x3c6a17),_0x3c6a17;}function processDiaryStyles(_0x4acc4c){const _0x3aa287=_0x211817;let _0x412671=0x0,_0x34a33f=0x0;return _0x4acc4c=_0x4acc4c[_0x3aa287(0xe16)](/<strike>(.*?)<\/strike>/gi,(_0x1fb11e,_0x1e1d6c)=>{const _0x355858=_0x3aa287;if(_0x412671<0x2)return _0x412671++,_0x355858(0x9f8)+_0x1e1d6c+_0x355858(0x1f2);return _0x1e1d6c;}),_0x4acc4c=_0x4acc4c[_0x3aa287(0xe16)](/<mark>(.*?)<\/mark>/gi,(_0x5bc38c,_0x141ea4)=>{const _0x2b4b33=_0x3aa287;if(_0x34a33f<0x2)return _0x34a33f++,_0x2b4b33(0x1b64)+_0x141ea4+_0x2b4b33(0x1f2);return _0x141ea4;}),_0x4acc4c;}function migratePastDiariesFormat(_0x35634a,_0x354237,_0x226e45,_0xf837e1){const _0x289cb3=_0x211817,_0x217939=_0x289cb3(0x1a58)+_0x35634a;if(localStorage['getItem'](_0x217939))return;const _0x2ab5af=_0x289cb3(0x608)+_0x35634a;let _0x476d83=JSON['parse'](localStorage[_0x289cb3(0x15d8)](_0x2ab5af)||'[]');const _0x2149f4=_0x476d83[_0x289cb3(0x150c)](_0x3ca611=>_0x3ca611['date']===_0x226e45);if(_0x2149f4===-0x1){const _0x4196c0=_0x476d83[_0x289cb3(0x150c)](_0x5a545f=>_0x5a545f[_0x289cb3(0x20d4)]===_0x354237);_0x4196c0!==-0x1?(_0x476d83[_0x4196c0][_0x289cb3(0x20d4)]=_0x226e45,_0x476d83[_0x4196c0][_0x289cb3(0x211c)]=_0xf837e1,_0x476d83[_0x4196c0][_0x289cb3(0x1716)]=Date[_0x289cb3(0x2eb)]()):_0x476d83[_0x289cb3(0x5ed)]({'date':_0x226e45,'content':_0xf837e1,'timestamp':Date[_0x289cb3(0x2eb)]()}),localStorage['setItem'](_0x2ab5af,JSON[_0x289cb3(0x6b8)](_0x476d83));}localStorage[_0x289cb3(0x192)](_0x217939,_0x289cb3(0x1743));}async function editTodayDiary(){const _0x343680=_0x211817;if(!currentChatCharacter){showToast(_0x343680(0x85d),_0x343680(0x174a));return;}if(currentChatCharacter[_0x343680(0x1f68)]){showToast(_0x343680(0x1d74),_0x343680(0x174a));return;}const _0x19c670=currentChatCharacter['id'],_0x330597=new Date()[_0x343680(0x1034)]()[_0x343680(0x204b)]('T')[0x0],_0x371533=_0x19c670+'_'+_0x330597;let _0x3aa810=null;try{_0x3aa810=await db[_0x343680(0x2077)][_0x343680(0xb78)](_0x371533);}catch(_0x5d4310){console[_0x343680(0x174a)](_0x343680(0xc4e),_0x5d4310),showToast(_0x343680(0x19d),_0x343680(0x174a));return;}if(!_0x3aa810||!_0x3aa810['content']){showToast(_0x343680(0x2253),_0x343680(0x174a));return;}const _0x273d37=convertHtmlToMarkup(_0x3aa810[_0x343680(0x211c)]),_0x229c6d=document[_0x343680(0xac6)](_0x343680(0xbbc));_0x229c6d[_0x343680(0x1722)]='modal',_0x229c6d[_0x343680(0x14eb)][_0x343680(0x4da)]=_0x343680(0x1fb7),_0x229c6d[_0x343680(0x33a)]=_0x343680(0x1661)+_0x273d37+_0x343680(0xd91),document[_0x343680(0x1da9)][_0x343680(0x497)](_0x229c6d);const _0x35d240=_0x229c6d[_0x343680(0xb30)](_0x343680(0x1f7d));_0x35d240[_0x343680(0x13cf)](),_0x35d240[_0x343680(0x207)](_0x35d240[_0x343680(0x1ebc)][_0x343680(0x19ee)],_0x35d240[_0x343680(0x1ebc)][_0x343680(0x19ee)]);}function convertHtmlToMarkup(_0x440e27){const _0x3d06b1=_0x211817;return _0x440e27[_0x3d06b1(0xe16)](/<span class="diary-strikethrough">(.*?)<\/span>/gi,_0x3d06b1(0x474))[_0x3d06b1(0xe16)](/<span class="diary-highlight">(.*?)<\/span>/gi,'<mark>$1</mark>');}async function saveDiaryEdit(){const _0x57e2f5=_0x211817;if(!currentChatCharacter){showToast(_0x57e2f5(0x85d),'error');return;}if(currentChatCharacter['isGroup']){showToast(_0x57e2f5(0x1d74),'error');return;}const _0x273152=currentChatCharacter['id'],_0x2bdcde=new Date()[_0x57e2f5(0x1034)]()[_0x57e2f5(0x204b)]('T')[0x0],_0x57fc99=_0x273152+'_'+_0x2bdcde,_0x4e3f08=document['getElementById'](_0x57e2f5(0x1804)),_0x5c642a=_0x4e3f08[_0x57e2f5(0x1ebc)]['trim']();if(!_0x5c642a){showToast(_0x57e2f5(0xe0f),_0x57e2f5(0x174a));return;}const _0x26aaf0=processDiaryStyles(_0x5c642a);try{await db[_0x57e2f5(0x2077)][_0x57e2f5(0x1561)]({'id':_0x57fc99,'characterId':_0x273152,'date':_0x2bdcde,'content':_0x26aaf0,'timestamp':Date['now'](),'weather':'☀️'});const _0xa02fce=document[_0x57e2f5(0x1262)]('today-diary-content'),_0x36b0b4=createDiaryWithHeader(_0x26aaf0,_0x2bdcde);_0xa02fce[_0x57e2f5(0x33a)]=_0x36b0b4,_0xa02fce['classList']['remove'](_0x57e2f5(0x1e85)),document[_0x57e2f5(0xb30)](_0x57e2f5(0x823))[_0x57e2f5(0x1493)](),showToast(_0x57e2f5(0x173f),_0x57e2f5(0x11cb));}catch(_0x278aee){console[_0x57e2f5(0x174a)]('保存日记失败:',_0x278aee),showToast(_0x57e2f5(0x111e),_0x57e2f5(0x174a));}}async function openDiarySettings(){const _0x172fb9=_0x211817;window[_0x172fb9(0xfa4)]=_0x172fb9(0x1d1a),showApp(_0x172fb9(0x1ff9)),await initDiarySettingsScreen();}async function backFromDiarySettings(){const _0x32d2a6=_0x211817,_0x2d9fad=window[_0x32d2a6(0xfa4)]||_0x32d2a6(0x1d1a);hideApp('diary-settings-screen'),showApp(_0x2d9fad),window['diarySettingsSourceScreen']=null,await applyDiarySettingsToContent();}async function initDiarySettingsScreen(){const _0x54d5c8=_0x211817;try{await loadDiarySettings(),await updateDiaryPreview();}catch(_0x57327c){console[_0x54d5c8(0x174a)]('初始化日记设置界面失败:',_0x57327c);}}function getDiarySettingId(_0x1354f2){const _0x118880=_0x211817;if(!currentChatCharacter)return _0x118880(0x1df2)+_0x1354f2;return currentChatCharacter['id']+'_'+_0x1354f2;}async function getDiarySetting(_0x34b313,_0x573523){const _0x2cbdfa=_0x211817;try{const _0x5ca729=getDiarySettingId(_0x34b313),_0x3caf18=await db[_0x2cbdfa(0x125e)][_0x2cbdfa(0xb78)](_0x5ca729);return _0x3caf18?_0x3caf18[_0x2cbdfa(0x245)]:_0x573523;}catch(_0x1e7fb7){return console['error'](_0x2cbdfa(0x22ce),_0x1e7fb7),_0x573523;}}async function setDiarySetting(_0x1b098b,_0x2f52e7){const _0xcf382a=_0x211817;try{const _0x534ada=getDiarySettingId(_0x1b098b),_0x482cd9=currentChatCharacter?currentChatCharacter['id']:null;await db[_0xcf382a(0x125e)][_0xcf382a(0x1561)]({'id':_0x534ada,'characterId':_0x482cd9,'settingName':_0x1b098b,'settingValue':_0x2f52e7,'timestamp':Date[_0xcf382a(0x2eb)]()});}catch(_0x24426e){console[_0xcf382a(0x174a)](_0xcf382a(0xebc),_0x24426e);}}async function loadDiarySettings(){const _0x3a9ed1=_0x211817;try{const _0x159371=await getDiarySetting(_0x3a9ed1(0x24b),'16'),_0xdedb5=await getDiarySetting('font-weight',_0x3a9ed1(0x1526)),_0x127274=await getDiarySetting(_0x3a9ed1(0xd57),'1.6'),_0x3f3ba7=await getDiarySetting('paragraph-spacing','15'),_0x3d05a2=await getDiarySetting('text-align',_0x3a9ed1(0x15dc)),_0x4a50be=await getDiarySetting(_0x3a9ed1(0x1fb5),_0x3a9ed1(0x11cf)),_0x5258f6=await getDiarySetting(_0x3a9ed1(0x1ccf),'40'),_0x37cb2f=await getDiarySetting(_0x3a9ed1(0x67c),'20'),_0x3b6847=await getDiarySetting(_0x3a9ed1(0x671),_0x3a9ed1(0x186f));document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x1a16))[_0x3a9ed1(0x1ebc)]=_0x159371,document['getElementById']('font-size-value')['textContent']=_0x159371+'px',document[_0x3a9ed1(0x1262)](_0x3a9ed1(0xde2))['value']=_0x127274,document[_0x3a9ed1(0x1262)]('line-height-value')[_0x3a9ed1(0x13be)]=_0x127274,document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x1c79))[_0x3a9ed1(0x1ebc)]=_0x3f3ba7,document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x1f8e))[_0x3a9ed1(0x13be)]=_0x3f3ba7+'px',document[_0x3a9ed1(0x1262)](_0x3a9ed1(0xe58))[_0x3a9ed1(0x1ebc)]=_0x4a50be,document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x12dd))[_0x3a9ed1(0x13be)]=_0x4a50be+'%',document[_0x3a9ed1(0x1262)](_0x3a9ed1(0xe79))[_0x3a9ed1(0x1ebc)]=_0x5258f6,document['getElementById']('content-padding-value')['textContent']=_0x5258f6+'px',document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x204))[_0x3a9ed1(0x1ebc)]=_0x37cb2f,document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x694))[_0x3a9ed1(0x13be)]=_0x37cb2f+'px';const _0x3c22e9=document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x123f));_0x3c22e9&&(_0x3c22e9[_0x3a9ed1(0x1ebc)]=_0xdedb5);const _0x26b51a=document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x1987));_0x26b51a&&(_0x26b51a['value']=_0x3d05a2);const _0xf928bf=await getDiarySetting(_0x3a9ed1(0x1a81),_0x3a9ed1(0x102b)),_0x35113b=document[_0x3a9ed1(0x1262)](_0x3a9ed1(0x1b36));_0x35113b&&(_0x35113b['value']=_0xf928bf),document[_0x3a9ed1(0x1897)](_0x3a9ed1(0x3fe))[_0x3a9ed1(0x19fb)](_0x27fbe2=>{const _0x158502=_0x3a9ed1;_0x27fbe2[_0x158502(0x1c1b)]['remove'](_0x158502(0x1a14)),_0x27fbe2[_0x158502(0x1ecd)]['paper']===_0x3b6847&&_0x27fbe2[_0x158502(0x1c1b)][_0x158502(0x21e2)](_0x158502(0x1a14));});}catch(_0x5bc101){console[_0x3a9ed1(0x174a)](_0x3a9ed1(0xd63),_0x5bc101);}}async function updateDiarySettings(){const _0xe4b347=_0x211817;try{const _0x5a5ea0=document[_0xe4b347(0x1262)](_0xe4b347(0x1a16))[_0xe4b347(0x1ebc)],_0x5d5807=document[_0xe4b347(0x1262)]('line-height-slider')[_0xe4b347(0x1ebc)],_0x2e7388=document['getElementById'](_0xe4b347(0x1c79))['value'],_0x1ffc68=document[_0xe4b347(0x1262)]('content-width-slider')['value'],_0x542f50=document[_0xe4b347(0x1262)](_0xe4b347(0xe79))['value'],_0x37ece3=document[_0xe4b347(0x1262)]('content-top-margin-slider')[_0xe4b347(0x1ebc)];document[_0xe4b347(0x1262)]('font-size-value')[_0xe4b347(0x13be)]=_0x5a5ea0+'px',document[_0xe4b347(0x1262)]('line-height-value')[_0xe4b347(0x13be)]=_0x5d5807,document[_0xe4b347(0x1262)](_0xe4b347(0x1f8e))[_0xe4b347(0x13be)]=_0x2e7388+'px',document[_0xe4b347(0x1262)](_0xe4b347(0x12dd))['textContent']=_0x1ffc68+'%',document[_0xe4b347(0x1262)](_0xe4b347(0x18b7))[_0xe4b347(0x13be)]=_0x542f50+'px',document[_0xe4b347(0x1262)](_0xe4b347(0x694))[_0xe4b347(0x13be)]=_0x37ece3+'px',await setDiarySetting(_0xe4b347(0x24b),_0x5a5ea0),await setDiarySetting(_0xe4b347(0xd57),_0x5d5807),await setDiarySetting(_0xe4b347(0x1b57),_0x2e7388),await setDiarySetting(_0xe4b347(0x1fb5),_0x1ffc68),await setDiarySetting(_0xe4b347(0x1ccf),_0x542f50),await setDiarySetting(_0xe4b347(0x67c),_0x37ece3),await updateDiaryPreview();}catch(_0x3157b0){console[_0xe4b347(0x174a)]('更新日记设置失败:',_0x3157b0);}}async function setFontWeight(_0x2a9f1e){const _0x398838=_0x211817,_0x9d8740=document[_0x398838(0x1262)]('fontWeightSelect');_0x9d8740&&(_0x9d8740[_0x398838(0x1ebc)]=_0x2a9f1e),await setDiarySetting('font-weight',_0x2a9f1e),await updateDiaryPreview();}async function setTextAlign(_0xca3b41){const _0x3bf44a=_0x211817,_0x3c292f=document[_0x3bf44a(0x1262)](_0x3bf44a(0x1987));_0x3c292f&&(_0x3c292f[_0x3bf44a(0x1ebc)]=_0xca3b41),await setDiarySetting(_0x3bf44a(0x206e),_0xca3b41),await updateDiaryPreview();}async function setTextDecoration(_0x386fd7){const _0x29cdf0=_0x211817,_0x50d34d=document[_0x29cdf0(0x1262)]('textDecorationSelect');_0x50d34d&&(_0x50d34d[_0x29cdf0(0x1ebc)]=_0x386fd7),await setDiarySetting(_0x29cdf0(0x1a81),_0x386fd7),applyTextDecoration(_0x386fd7),await updateDiaryPreview();}function applyTextDecoration(_0x94973c){const _0x537374=_0x211817,_0x33797e=document[_0x537374(0x1262)](_0x537374(0xa61));_0x33797e&&(_0x33797e['classList'][_0x537374(0x1493)]('decoration-none',_0x537374(0xb5a)),_0x94973c&&_0x94973c!==_0x537374(0x102b)&&_0x33797e['classList'][_0x537374(0x21e2)](_0x537374(0x1339)+_0x94973c));}async function updateDiaryPreview(){const _0x254ed2=_0x211817,_0x48c519=document['getElementById'](_0x254ed2(0x2b9));if(!_0x48c519)return;try{const _0x40f396=await getDiarySetting(_0x254ed2(0x24b),'16'),_0xa4936d=await getDiarySetting('font-weight',_0x254ed2(0x1526)),_0x120e37=await getDiarySetting(_0x254ed2(0xd57),'1.6'),_0x59546=await getDiarySetting(_0x254ed2(0x1b57),'15'),_0x50257d=await getDiarySetting('text-align','left'),_0x2c6a09=await getDiarySetting(_0x254ed2(0x1fb5),'100'),_0x14b59b=await getDiarySetting(_0x254ed2(0x1ccf),'40'),_0x4822a6=await getDiarySetting(_0x254ed2(0x67c),'20'),_0xb665d1=await getDiarySetting(_0x254ed2(0x671),_0x254ed2(0x186f)),_0x2869e8=await getDiarySetting(_0x254ed2(0x1a81),_0x254ed2(0x102b));_0x48c519[_0x254ed2(0x14eb)]['fontSize']=_0x40f396+'px',_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0x1d19)]=_0xa4936d,_0x48c519['style'][_0x254ed2(0x6eb)]=_0x120e37,_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0x22b)]=_0x50257d,_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0x12f1)]=_0x2c6a09+'%',_0x48c519['style'][_0x254ed2(0xf07)]=_0x14b59b+'px',_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0xbc3)]=_0x14b59b+'px',_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0x1761)]=_0x4822a6+'px';const _0x2ce03b=_0x48c519[_0x254ed2(0xb30)](_0x254ed2(0xbf8));_0x2ce03b&&(_0x2ce03b[_0x254ed2(0x14eb)][_0x254ed2(0x164c)]=_0x59546+'px');_0x48c519['className']=_0x254ed2(0x1668);_0xb665d1&&_0xb665d1!==_0x254ed2(0x186f)&&_0x48c519[_0x254ed2(0x1c1b)][_0x254ed2(0x21e2)](_0xb665d1+_0x254ed2(0xe1c));_0x2869e8&&_0x2869e8!==_0x254ed2(0x102b)&&_0x48c519['classList'][_0x254ed2(0x21e2)](_0x254ed2(0x1339)+_0x2869e8);if(_0xb665d1===_0x254ed2(0x2b0)){const _0x386b8c=await getDiarySetting('custom-background','');_0x386b8c?_0x48c519['style'][_0x254ed2(0x159c)]=_0x254ed2(0x9f1)+_0x386b8c+')':_0x48c519[_0x254ed2(0x14eb)][_0x254ed2(0x159c)]='';}else _0x48c519['style'][_0x254ed2(0x159c)]='';}catch(_0x422c85){console[_0x254ed2(0x174a)](_0x254ed2(0x152b),_0x422c85);}}async function resetDiarySettings(){const _0x5d8b61=_0x211817;if(!confirm('确定要重置所有日记设置吗？这将恢复默认设置。'))return;try{const _0x5817a5=[_0x5d8b61(0x4c5),_0x5d8b61(0x24b),_0x5d8b61(0x18c7),_0x5d8b61(0xd57),_0x5d8b61(0x1b57),'text-align',_0x5d8b61(0x1fb5),_0x5d8b61(0x1ccf),_0x5d8b61(0x67c),_0x5d8b61(0x671),'custom-background',_0x5d8b61(0x1a81)];for(const _0x120a30 of _0x5817a5){const _0x3c0a4a=getDiarySettingId(_0x120a30);await db[_0x5d8b61(0x125e)][_0x5d8b61(0x1f4a)](_0x3c0a4a);}await loadDiarySettings(),await updateDiaryPreview(),showToast(_0x5d8b61(0x713),_0x5d8b61(0x11cb));}catch(_0x119cec){console[_0x5d8b61(0x174a)]('重置日记设置失败:',_0x119cec),showToast(_0x5d8b61(0x44c),'error');}}async function applyDiarySettingsToContent(){const _0x5da93a=_0x211817,_0x3127ef=document['getElementById'](_0x5da93a(0xa61));if(!_0x3127ef)return;try{const _0x252e81=await getDiarySetting(_0x5da93a(0x24b),'16'),_0x408c36=await getDiarySetting(_0x5da93a(0x18c7),'500'),_0x2651a4=await getDiarySetting(_0x5da93a(0xd57),_0x5da93a(0x2314)),_0x10d8f3=await getDiarySetting(_0x5da93a(0x206e),_0x5da93a(0x15dc)),_0x490b9b=await getDiarySetting('content-width','100'),_0x4acede=await getDiarySetting(_0x5da93a(0x1ccf),'40'),_0x52ece0=await getDiarySetting(_0x5da93a(0x67c),'20'),_0x17a305=await getDiarySetting(_0x5da93a(0x1a81),_0x5da93a(0x102b));_0x3127ef[_0x5da93a(0x14eb)]['fontSize']=_0x252e81+'px',_0x3127ef[_0x5da93a(0x14eb)][_0x5da93a(0x1d19)]=_0x408c36,_0x3127ef[_0x5da93a(0x14eb)]['lineHeight']=_0x2651a4,_0x3127ef[_0x5da93a(0x14eb)][_0x5da93a(0x22b)]=_0x10d8f3,_0x3127ef[_0x5da93a(0x14eb)][_0x5da93a(0x12f1)]=_0x490b9b+'%',_0x3127ef[_0x5da93a(0x14eb)][_0x5da93a(0xf07)]=_0x4acede+'px',_0x3127ef[_0x5da93a(0x14eb)]['paddingRight']=_0x4acede+'px',_0x3127ef[_0x5da93a(0x14eb)][_0x5da93a(0x1761)]=_0x52ece0+'px',applyTextDecoration(_0x17a305);}catch(_0x522442){console[_0x5da93a(0x174a)](_0x5da93a(0x3d2),_0x522442);}}async function applyDiarySettingsToSingleView(){const _0x137872=_0x211817,_0x145503=document[_0x137872(0x1262)](_0x137872(0xff4));if(!_0x145503)return;try{const _0x104ffe=await getDiarySetting(_0x137872(0x24b),'16'),_0x43b9e6=await getDiarySetting('font-weight',_0x137872(0x1526)),_0x525b37=await getDiarySetting(_0x137872(0xd57),_0x137872(0x2314)),_0x5e324c=await getDiarySetting(_0x137872(0x206e),_0x137872(0x15dc)),_0x44e840=await getDiarySetting(_0x137872(0x1fb5),'100'),_0x579539=await getDiarySetting(_0x137872(0x1ccf),'40'),_0x572ab4=await getDiarySetting(_0x137872(0x67c),'20'),_0x4c9ffa=await getDiarySetting(_0x137872(0x1a81),'none'),_0x5f4260=await getDiarySetting(_0x137872(0x671),_0x137872(0x17ad));_0x145503[_0x137872(0x14eb)]['fontSize']=_0x104ffe+'px',_0x145503[_0x137872(0x14eb)]['fontWeight']=_0x43b9e6,_0x145503[_0x137872(0x14eb)]['lineHeight']=_0x525b37,_0x145503[_0x137872(0x14eb)][_0x137872(0x22b)]=_0x5e324c,_0x145503[_0x137872(0x14eb)][_0x137872(0x12f1)]=_0x44e840+'%',_0x145503[_0x137872(0x14eb)][_0x137872(0xf07)]=_0x579539+'px',_0x145503['style'][_0x137872(0xbc3)]=_0x579539+'px',_0x145503[_0x137872(0x14eb)][_0x137872(0x1761)]=_0x572ab4+'px',_0x145503[_0x137872(0x1c1b)][_0x137872(0x1493)](_0x137872(0x1888),_0x137872(0x1fd1),_0x137872(0xabd),'vintage-paper',_0x137872(0x2046));_0x5f4260&&_0x5f4260!==_0x137872(0x186f)&&_0x145503[_0x137872(0x1c1b)][_0x137872(0x21e2)](_0x5f4260+_0x137872(0xe1c));if(_0x5f4260===_0x137872(0x2b0)){const _0x3bb470=await getDiarySetting(_0x137872(0xb91),'');_0x3bb470&&(_0x145503[_0x137872(0x14eb)][_0x137872(0x159c)]='url('+_0x3bb470+')');}_0x145503[_0x137872(0x1c1b)]['remove']('decoration-none','decoration-underline'),_0x4c9ffa&&_0x4c9ffa!==_0x137872(0x102b)&&_0x145503[_0x137872(0x1c1b)][_0x137872(0x21e2)](_0x137872(0x1339)+_0x4c9ffa);}catch(_0x136690){console['error'](_0x137872(0x111c),_0x136690);}}async function setDiaryPaper(_0x1a0308){const _0x1df088=_0x211817;document['querySelectorAll']('.paper-option')[_0x1df088(0x19fb)](_0x29ac51=>{const _0x1911be=_0x1df088;_0x29ac51['classList'][_0x1911be(0x1493)](_0x1911be(0x1a14)),_0x29ac51['dataset']['paper']===_0x1a0308&&_0x29ac51[_0x1911be(0x1c1b)]['add'](_0x1911be(0x1a14));}),await setDiarySetting(_0x1df088(0x671),_0x1a0308),await applyDiaryPaper(_0x1a0308),document['getElementById']('diary-preview-content')&&await updateDiaryPreview();}async function applyDiaryPaper(_0x5accac){const _0x34b94c=_0x211817,_0x5c6bda=document['getElementById']('today-diary-content');if(_0x5c6bda)try{_0x5c6bda[_0x34b94c(0x1c1b)][_0x34b94c(0x1493)](_0x34b94c(0x1888),'grid-paper',_0x34b94c(0xabd),_0x34b94c(0x838),_0x34b94c(0x2046));_0x5accac&&_0x5accac!==_0x34b94c(0x186f)&&_0x5c6bda['classList'][_0x34b94c(0x21e2)](_0x5accac+_0x34b94c(0xe1c));if(_0x5accac===_0x34b94c(0x2b0)){const _0x347e99=await getDiarySetting(_0x34b94c(0xb91),'');_0x347e99&&(_0x5c6bda['style'][_0x34b94c(0x159c)]=_0x34b94c(0x9f1)+_0x347e99+')');}else _0x5c6bda[_0x34b94c(0x14eb)][_0x34b94c(0x159c)]='';}catch(_0x5ee2fb){console[_0x34b94c(0x174a)](_0x34b94c(0x158f),_0x5ee2fb);}}function uploadCustomPaper(){const _0x1efdb3=_0x211817,_0xf8403c=document[_0x1efdb3(0x1262)]('paperImageInput');_0xf8403c?_0xf8403c[_0x1efdb3(0x1859)]():console[_0x1efdb3(0x174a)](_0x1efdb3(0x1f3e));}function handlePaperUpload(_0x20707e){const _0x35bd0d=_0x211817,_0x105f58=_0x20707e[_0x35bd0d(0x193d)][_0x35bd0d(0xf26)][0x0];if(!_0x105f58)return;if(!_0x105f58[_0x35bd0d(0x1a4b)][_0x35bd0d(0x1b30)](_0x35bd0d(0x1d60))){showToast(_0x35bd0d(0x118e),'error');return;}const _0x263adf=new FileReader();_0x263adf['onload']=async function(_0x366057){const _0x91c0e0=_0x35bd0d;try{const _0x18dd81=_0x366057['target']['result'];await setDiarySetting(_0x91c0e0(0xb91),_0x18dd81),await setDiaryPaper(_0x91c0e0(0x2b0));const _0x14250a=document[_0x91c0e0(0x1262)]('today-diary-content');_0x14250a&&(_0x14250a['style']['backgroundImage']=_0x91c0e0(0x9f1)+_0x18dd81+')'),document[_0x91c0e0(0x1262)](_0x91c0e0(0x2b9))&&await updateDiaryPreview(),showToast('自定义背景设置成功',_0x91c0e0(0x11cb));}catch(_0x2dbd38){console[_0x91c0e0(0x174a)](_0x91c0e0(0x770),_0x2dbd38),showToast(_0x91c0e0(0x1c92),_0x91c0e0(0x174a));}},_0x263adf[_0x35bd0d(0x127c)](_0x105f58);}async function initDiaryPaper(){const _0x3fa4e6=_0x211817;try{const _0x4721ed=await getDiarySetting(_0x3fa4e6(0x671),_0x3fa4e6(0x186f));await applyDiaryPaper(_0x4721ed),await applyDiarySettingsToContent();}catch(_0x337047){console[_0x3fa4e6(0x174a)](_0x3fa4e6(0x170f),_0x337047);}}async function shouldUpdateCharacterStatus(_0xe664df){const _0x17c232=_0x211817;try{const _0x4bd2c9=getCharacterStatus(_0xe664df),_0x645644=new Date(_0x4bd2c9[_0x17c232(0x13ea)]),_0x44c5aa=new Date(),_0x533af2=_0x44c5aa-_0x645644,_0x212d60=getStatusUpdateInterval();if(_0x533af2<_0x212d60)return![];if(_0x533af2>_0x212d60*0x2)return!![];if(_0x4bd2c9[_0x17c232(0x13af)]){const _0x2ae7c7=new Date(_0x4bd2c9[_0x17c232(0x13af)]),_0x9cf85c=_0x44c5aa-_0x2ae7c7;if(_0x9cf85c<_0x212d60&&_0x533af2>=_0x212d60)return Math[_0x17c232(0x11a8)]()<0.7;}return Math[_0x17c232(0x11a8)]()<0.3;}catch(_0x12e0c3){return console[_0x17c232(0x174a)]('判断角色状态更新失败:',_0x12e0c3),Math[_0x17c232(0x11a8)]()<0.1;}}async function updateCharacterLastChatTime(_0x3d3939){const _0x4c90d0=_0x211817;try{let _0x46f4aa=characterStatusData[_0x4c90d0(0xaf4)](_0x455395=>_0x455395[_0x4c90d0(0xaf5)]===_0x3d3939);!_0x46f4aa?(_0x46f4aa={'id':'status_'+_0x3d3939,'characterId':_0x3d3939,'status':_0x4c90d0(0x38b),'activity':'在线','location':'','lastUpdate':new Date()[_0x4c90d0(0x1034)](),'lastChatTime':Date['now']()},characterStatusData['push'](_0x46f4aa)):_0x46f4aa['lastChatTime']=Date[_0x4c90d0(0x2eb)](),await db[_0x4c90d0(0x793)][_0x4c90d0(0x1561)](_0x46f4aa);}catch(_0x5e8e08){console[_0x4c90d0(0x174a)](_0x4c90d0(0x1a09),_0x5e8e08);}}async function triggerStatusUpdateAfterMessage(_0x331fae){const _0x4bd57b=_0x211817,_0x1f8576=await getAsyncChatSettings(_0x331fae);if(!_0x1f8576[_0x4bd57b(0x22aa)]){console['log'](_0x4bd57b(0x150a)+_0x331fae+'\x20未启用状态显示，跳过状态更新');return;}await updateCharacterLastChatTime(_0x331fae),console['log']('角色\x20'+_0x331fae+_0x4bd57b(0x986));}document[_0x211817(0x21e9)]('DOMContentLoaded',function(){setTimeout(()=>{startStatusUpdateTimer();},0x1388);}),console[_0x211817(0x2187)](_0x211817(0x18bf)),document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x431e60=_0x211817,_0x1f6a6d=document['getElementById'](_0x431e60(0x1453)),_0x1bc504=document[_0x431e60(0x1262)](_0x431e60(0x1913));_0x1f6a6d&&_0x1f6a6d[_0x431e60(0x21e9)](_0x431e60(0x1823),updateThresholdDisplay),_0x1bc504&&_0x1bc504[_0x431e60(0x21e9)]('input',updateThresholdDisplay);});function calculateTextSimilarity(_0x55dc35,_0xebd3d6){const _0x5b55ba=_0x211817;if(!_0x55dc35||!_0xebd3d6)return 0x0;const _0x17f73d=new Set(_0x55dc35[_0x5b55ba(0x49e)]()[_0x5b55ba(0x1b87)](/[\u4e00-\u9fa5\w]+/g)||[]),_0x36baf6=new Set(_0xebd3d6[_0x5b55ba(0x49e)]()['match'](/[\u4e00-\u9fa5\w]+/g)||[]),_0x537f91=new Set([..._0x17f73d]['filter'](_0x17e0df=>_0x36baf6[_0x5b55ba(0x975)](_0x17e0df))),_0x55565d=new Set([..._0x17f73d,..._0x36baf6]);return _0x55565d['size']===0x0?0x0:_0x537f91['size']/_0x55565d[_0x5b55ba(0x2d8)];}let MEMORY_CONFIG={'AI_EXTRACT_INTERVAL':0x3c,'CORE_MEMORY_IMPORTANCE_THRESHOLD':0.9,'MAX_CORE_MEMORIES_PER_CHARACTER':0x32,'EPISODIC_MEMORY_IMPORTANCE_THRESHOLD':0.6,'MAX_EPISODIC_MEMORIES_PER_CHARACTER':0x64,'CROSS_APP_TIMELINE_LIMIT':0x14};async function loadMemoryConfig(){const _0x207ced=_0x211817;try{const _0x551903=await db[_0x207ced(0x181d)][_0x207ced(0xb78)](_0x207ced(0x185e));_0x551903&&_0x551903[_0x207ced(0x1ebc)]&&(MEMORY_CONFIG={...MEMORY_CONFIG,..._0x551903['value']});}catch(_0x3cfca3){console[_0x207ced(0x174a)](_0x207ced(0x1fdf),_0x3cfca3);}}async function saveMemoryConfig(){const _0x460de9=_0x211817;try{await db[_0x460de9(0x181d)][_0x460de9(0x1561)]({'id':_0x460de9(0x185e),'value':MEMORY_CONFIG});}catch(_0x445db6){console[_0x460de9(0x174a)](_0x460de9(0x9eb),_0x445db6);}}async function generateConversationSummary(_0x3a9636,_0x168df4){const _0x119c0e=_0x211817;if(!_0x168df4||_0x168df4[_0x119c0e(0x19ee)]===0x0)return null;try{const _0x1f150b=characters['find'](_0x37c4b9=>_0x37c4b9['id']===_0x3a9636);if(!_0x1f150b)return null;const _0x4afd90=_0x119c0e(0x12e8)+_0x1f150b['name']+'\x0a-\x20角色设定:\x20'+(_0x1f150b[_0x119c0e(0x1f0b)]||_0x119c0e(0x22e8))+_0x119c0e(0x20ba)+_0x168df4[_0x119c0e(0x6a4)](_0xdcbc52=>{const _0x25a65e=_0x119c0e,_0x41fd7c=_0xdcbc52[_0x25a65e(0x8a1)]==='sent'?'用户':_0x1f150b[_0x25a65e(0x1a1c)],_0x35a1b2=typeof _0xdcbc52[_0x25a65e(0x211c)]===_0x25a65e(0x11b7)?_0xdcbc52['content']:_0x25a65e(0x2052);return _0x41fd7c+':\x20'+_0x35a1b2;})[_0x119c0e(0x122b)]('\x0a')+_0x119c0e(0x1702)+_0x1f150b[_0x119c0e(0x1a1c)]+_0x119c0e(0x203d)+_0x1f150b[_0x119c0e(0x1a1c)]+_0x119c0e(0x139d),_0x5a967c=await callChatAPI(extractPrompt,_0x1f150b),_0x347e06=Array['isArray'](_0x5a967c)?_0x5a967c[0x0]:_0x5a967c;if(_0x347e06&&typeof _0x347e06===_0x119c0e(0x11b7))try{const _0x5f2070=_0x347e06[_0x119c0e(0x1b87)](/\{[\s\S]*\}/);if(_0x5f2070){const _0x22ddf1=JSON[_0x119c0e(0x22d3)](_0x5f2070[0x0]),_0x2af905=await db['coreMemories'][_0x119c0e(0xa24)](_0x119c0e(0xaf5))[_0x119c0e(0x1694)](_0x3a9636)[_0x119c0e(0xf13)]();for(const _0x1dff59 of _0x22ddf1[_0x119c0e(0x4c3)]||[]){if(_0x1dff59[_0x119c0e(0x146c)]>=MEMORY_CONFIG[_0x119c0e(0x213)]){const _0x1c371e=_0x2af905['some'](_0x381983=>{const _0x839743=calculateTextSimilarity(_0x381983['fact'],_0x1dff59['fact']);return _0x839743>0.8;});if(!_0x1c371e){const _0x18a702={'id':_0x119c0e(0x77f)+_0x3a9636+'_'+Date[_0x119c0e(0x2eb)]()+'_'+Math['random']()['toString'](0x24)['substr'](0x2,0x9),'characterId':_0x3a9636,'fact':_0x1dff59[_0x119c0e(0x13e5)],'importance':_0x1dff59[_0x119c0e(0x146c)],'category':_0x1dff59['category']||_0x119c0e(0xe56),'timestamp':Date[_0x119c0e(0x2eb)](),'type':_0x119c0e(0x228e),'source':_0x119c0e(0x1920),'contextId':_0x3a9636};await db[_0x119c0e(0x127e)][_0x119c0e(0x21e2)](_0x18a702),console[_0x119c0e(0x2187)](_0x119c0e(0x20e5)+_0x1f150b[_0x119c0e(0x1a1c)]+_0x119c0e(0x1d8b)+_0x1dff59[_0x119c0e(0x13e5)]);}}}for(const _0x289b42 of _0x22ddf1[_0x119c0e(0xf43)]||[]){if(_0x289b42['importance']>=MEMORY_CONFIG[_0x119c0e(0x1820)]){const _0x5b127e={'id':_0x119c0e(0x1f10)+_0x3a9636+'_'+Date['now']()+'_'+Math[_0x119c0e(0x11a8)]()[_0x119c0e(0x1878)](0x24)[_0x119c0e(0x15fb)](0x2,0x9),'characterId':_0x3a9636,'fact':_0x289b42[_0x119c0e(0x13e5)],'importance':_0x289b42[_0x119c0e(0x146c)],'category':_0x289b42[_0x119c0e(0x14cb)]||_0x119c0e(0xe56),'timestamp':Date['now'](),'source':_0x119c0e(0x1920),'contextId':_0x3a9636};await db[_0x119c0e(0x156f)][_0x119c0e(0x21e2)](_0x5b127e),console[_0x119c0e(0x2187)](_0x119c0e(0x20e5)+_0x1f150b[_0x119c0e(0x1a1c)]+_0x119c0e(0x39c)+_0x289b42[_0x119c0e(0x13e5)]);}}}}catch(_0x398174){console[_0x119c0e(0x1f43)](_0x119c0e(0x1b6f),_0x398174);}}catch(_0x3194ae){console[_0x119c0e(0x174a)]('AI记忆提取失败:',_0x3194ae);}}async function checkAndGenerateSummary(_0x1f04c4){const _0x380aba=_0x211817;try{const _0x5232ff=chatMessages[_0x1f04c4]||[];if(_0x5232ff[_0x380aba(0x19ee)]===0x0)return;const _0x1d62d3=await db['memorySummaries']['where'](_0x380aba(0xaf5))[_0x380aba(0x1694)](_0x1f04c4)[_0x380aba(0xf13)](),_0x28ceab=_0x1d62d3[_0x380aba(0x19ee)]>0x0?_0x1d62d3[_0x380aba(0x1104)]((_0x10899b,_0x25d105)=>_0x25d105[_0x380aba(0x1716)]-_0x10899b[_0x380aba(0x1716)])[0x0]:null;let _0x578e69=![],_0x18d1de=[];if(!_0x28ceab)_0x5232ff[_0x380aba(0x19ee)]>=MEMORY_CONFIG['SUMMARY_TRIGGER_MESSAGE_COUNT']&&(_0x18d1de=_0x5232ff['slice'](-MEMORY_CONFIG[_0x380aba(0xcd6)]),_0x578e69=!![]);else{const _0x469922=_0x28ceab[_0x380aba(0x1da2)]?.[_0x380aba(0x540)]||_0x28ceab['timestamp'],_0x9c9923=_0x5232ff[_0x380aba(0x1e1f)](_0x530547=>_0x530547[_0x380aba(0x1716)]>_0x469922),_0x312c68=Date['now']()-_0x28ceab[_0x380aba(0x1716)],_0xb9aedc=_0x312c68/(0x3e8*0x3c*0x3c);(_0x9c9923[_0x380aba(0x19ee)]>=MEMORY_CONFIG[_0x380aba(0xcd6)]||_0xb9aedc>=MEMORY_CONFIG[_0x380aba(0x2c0)])&&(_0x18d1de=_0x9c9923[_0x380aba(0x6d5)](-MEMORY_CONFIG['SUMMARY_TRIGGER_MESSAGE_COUNT']),_0x578e69=!![]);}_0x578e69&&_0x18d1de[_0x380aba(0x19ee)]>0x0&&await generateConversationSummary(_0x1f04c4,_0x18d1de);}catch(_0x46af9d){console[_0x380aba(0x174a)](_0x380aba(0x650),_0x46af9d);}}async function extractMemoriesWithAI(_0x3ea8b4,_0x1ce893,_0xfa609e=null){const _0x11a8ca=_0x211817;if(!_0x1ce893||_0x1ce893[_0x11a8ca(0x19ee)]===0x0)return;try{const _0x44dc59=characters[_0x11a8ca(0xaf4)](_0x449af2=>_0x449af2['id']===_0x3ea8b4);if(!_0x44dc59)return;!_0xfa609e&&(_0xfa609e=_0x3ea8b4);const _0x3503e3=_0x11a8ca(0x310)+_0x44dc59['name']+_0x11a8ca(0x13c4)+(_0x44dc59['bio']||_0x11a8ca(0x22e8))+'\x0a\x0a##\x20对话内容\x0a'+_0x1ce893[_0x11a8ca(0x6a4)](_0x2037e8=>{const _0x702704=_0x11a8ca,_0x40f4c4=_0x2037e8[_0x702704(0x8a1)]===_0x702704(0x1e6d)?'用户':_0x44dc59[_0x702704(0x1a1c)],_0x4059aa=typeof _0x2037e8[_0x702704(0x211c)]===_0x702704(0x11b7)?_0x2037e8['content']:_0x702704(0x2052);return _0x40f4c4+':\x20'+_0x4059aa;})[_0x11a8ca(0x122b)]('\x0a')+_0x11a8ca(0x1f7)+_0x44dc59[_0x11a8ca(0x1a1c)]+_0x11a8ca(0x1c83)+_0x44dc59[_0x11a8ca(0x1a1c)]+_0x11a8ca(0x151e),_0x617a15=await callChatAPI(_0x3503e3,_0x44dc59);let _0x703c3=[],_0x1fde05=null;try{_0x1fde05=Array[_0x11a8ca(0x1496)](_0x617a15)?_0x617a15[0x0]:_0x617a15;if(_0x1fde05&&typeof _0x1fde05===_0x11a8ca(0x11b7)){console['log'](_0x11a8ca(0xc1f),_0x1fde05);let _0x47f869=null;const _0x9b624b=_0x1fde05[_0x11a8ca(0x1b87)](/\{[\s\S]*\}/);if(_0x9b624b)_0x47f869=_0x9b624b[0x0];else{const _0x155e8d=_0x1fde05[_0x11a8ca(0x1b87)](/\[[\s\S]*\]/);_0x155e8d&&(_0x47f869=_0x155e8d[0x0]);}if(_0x47f869)console[_0x11a8ca(0x2187)](_0x11a8ca(0x1fae),_0x47f869),_0x703c3=JSON['parse'](_0x47f869);else{console[_0x11a8ca(0x1f43)](_0x11a8ca(0x242));return;}}}catch(_0x422a51){console[_0x11a8ca(0x1f43)](_0x11a8ca(0x1670),_0x422a51),console[_0x11a8ca(0x1f43)](_0x11a8ca(0xba6),_0x1fde05);return;}const [_0x7a9677,_0x6c3855]=await Promise[_0x11a8ca(0x1a47)]([db[_0x11a8ca(0x127e)]['where'](_0x11a8ca(0xaf5))['equals'](_0x3ea8b4)[_0x11a8ca(0xf13)](),db[_0x11a8ca(0x156f)][_0x11a8ca(0xa24)](_0x11a8ca(0xaf5))[_0x11a8ca(0x1694)](_0x3ea8b4)[_0x11a8ca(0xf13)]()]);if(_0x703c3[_0x11a8ca(0x4c3)]&&Array['isArray'](_0x703c3[_0x11a8ca(0x4c3)]))for(const _0x3d22c9 of _0x703c3[_0x11a8ca(0x4c3)]){if(_0x3d22c9[_0x11a8ca(0x146c)]>=MEMORY_CONFIG['CORE_MEMORY_IMPORTANCE_THRESHOLD']){const _0x4fea64=_0x7a9677[_0x11a8ca(0x19fa)](_0x4be3b0=>{const _0x1fc4fb=_0x11a8ca,_0x3a769d=calculateTextSimilarity(_0x4be3b0[_0x1fc4fb(0x13e5)],_0x3d22c9[_0x1fc4fb(0x13e5)]);return _0x3a769d>0.8;});if(!_0x4fea64){const _0x178309={'id':_0x11a8ca(0x77f)+_0x3ea8b4+'_'+Date[_0x11a8ca(0x2eb)]()+'_'+Math[_0x11a8ca(0x11a8)]()['toString'](0x24)['substr'](0x2,0x9),'characterId':_0x3ea8b4,'fact':_0x3d22c9['fact'],'importance':_0x3d22c9[_0x11a8ca(0x146c)],'category':_0x3d22c9['category']||_0x11a8ca(0xe56),'timestamp':Date[_0x11a8ca(0x2eb)](),'type':'core','contextId':_0xfa609e};await db[_0x11a8ca(0x127e)]['add'](_0x178309),console['log']('✅\x20为角色\x20'+_0x44dc59[_0x11a8ca(0x1a1c)]+_0x11a8ca(0x951)+_0x3d22c9['fact']);}else console[_0x11a8ca(0x2187)](_0x11a8ca(0x1260)+_0x3d22c9['fact']);}}if(_0x703c3[_0x11a8ca(0xf43)]&&Array[_0x11a8ca(0x1496)](_0x703c3[_0x11a8ca(0xf43)]))for(const _0x37f7a8 of _0x703c3['episodic_memories']){if(_0x37f7a8[_0x11a8ca(0x146c)]>=MEMORY_CONFIG[_0x11a8ca(0x1820)]){const _0x366cc2=_0x6c3855[_0x11a8ca(0x19fa)](_0x2742ed=>{const _0x4aaca7=calculateTextSimilarity(_0x2742ed['fact'],_0x37f7a8['fact']);return _0x4aaca7>0.8;});if(!_0x366cc2){const _0x1138f8={'id':_0x11a8ca(0x1f10)+_0x3ea8b4+'_'+Date['now']()+'_'+Math[_0x11a8ca(0x11a8)]()[_0x11a8ca(0x1878)](0x24)[_0x11a8ca(0x15fb)](0x2,0x9),'characterId':_0x3ea8b4,'fact':_0x37f7a8[_0x11a8ca(0x13e5)],'importance':_0x37f7a8['importance'],'category':_0x37f7a8[_0x11a8ca(0x14cb)]||'other','timestamp':Date[_0x11a8ca(0x2eb)](),'contextId':_0xfa609e};await db[_0x11a8ca(0x156f)][_0x11a8ca(0x21e2)](_0x1138f8),console['log'](_0x11a8ca(0x1df9)+_0x44dc59[_0x11a8ca(0x1a1c)]+_0x11a8ca(0xca0)+_0x37f7a8[_0x11a8ca(0x13e5)]);}else console[_0x11a8ca(0x2187)]('⚠️\x20跳过重复情景记忆:\x20'+_0x37f7a8['fact']);}}await cleanupCoreMemories(_0x3ea8b4),await cleanupEpisodicMemories(_0x3ea8b4);}catch(_0x1713a8){console[_0x11a8ca(0x174a)](_0x11a8ca(0x88d),_0x1713a8);}}async function cleanupCoreMemories(_0x5e47a6){const _0x351254=_0x211817;try{const _0xd901be=await db[_0x351254(0x127e)][_0x351254(0xa24)](_0x351254(0xaf5))[_0x351254(0x1694)](_0x5e47a6)['toArray'](),_0x240d3e=_0xd901be[_0x351254(0x1104)]((_0x8ab7f0,_0x2e70f6)=>_0x2e70f6[_0x351254(0x146c)]-_0x8ab7f0['importance']),_0x49a1e1=MEMORY_CONFIG[_0x351254(0xc40)]||0x32;if(_0x240d3e['length']>_0x49a1e1){const _0x1f3a91=_0x240d3e[_0x351254(0x6d5)](_0x49a1e1);for(const _0x9843d of _0x1f3a91){await db['coreMemories'][_0x351254(0x1f4a)](_0x9843d['id']);}console['log'](_0x351254(0x19fc)+_0x1f3a91[_0x351254(0x19ee)]+'\x20个低重要性的核心记忆');}}catch(_0x265d9d){console[_0x351254(0x174a)](_0x351254(0xec5),_0x265d9d);}}async function cleanupEpisodicMemories(_0x442162){const _0x1251ca=_0x211817;try{const _0x85cf9a=await db[_0x1251ca(0x156f)][_0x1251ca(0xa24)]('characterId')['equals'](_0x442162)[_0x1251ca(0xf13)](),_0x562f7d=_0x85cf9a[_0x1251ca(0x1104)]((_0x618427,_0x53bb8c)=>{const _0x434bef=_0x1251ca;if(Math[_0x434bef(0x1b24)](_0x618427[_0x434bef(0x146c)]-_0x53bb8c[_0x434bef(0x146c)])>0.1)return _0x53bb8c['importance']-_0x618427[_0x434bef(0x146c)];return _0x53bb8c['timestamp']-_0x618427[_0x434bef(0x1716)];}),_0x4d7407=MEMORY_CONFIG[_0x1251ca(0x209)]||0x64;if(_0x562f7d[_0x1251ca(0x19ee)]>_0x4d7407){const _0x3d4903=_0x562f7d[_0x1251ca(0x6d5)](_0x4d7407);for(const _0x209334 of _0x3d4903){await db[_0x1251ca(0x156f)][_0x1251ca(0x1f4a)](_0x209334['id']);}console[_0x1251ca(0x2187)](_0x1251ca(0x19fc)+_0x3d4903[_0x1251ca(0x19ee)]+_0x1251ca(0x522));}}catch(_0x1b713a){console[_0x1251ca(0x174a)]('清理情景记忆失败:',_0x1b713a);}}async function cleanupExpiredMemories(){const _0x4503c4=_0x211817;try{const _0x4d39c0=getGlobalMemorySettings();if(_0x4d39c0[_0x4503c4(0x1715)]===-0x1){console[_0x4503c4(0x2187)](_0x4503c4(0x6ba));return;}const _0x5624e5=Date[_0x4503c4(0x2eb)]()-_0x4d39c0[_0x4503c4(0x1715)]*0x18*0x3c*0x3c*0x3e8,_0x5a5e62=new Date(_0x5624e5)[_0x4503c4(0x1034)]()[_0x4503c4(0x204b)]('T')[0x0],_0x2c6633=await db['crossAppTimeline'][_0x4503c4(0xa24)](_0x4503c4(0x1716))[_0x4503c4(0x154d)](_0x5624e5)[_0x4503c4(0xf13)]();_0x2c6633['length']>0x0&&(await db['crossAppTimeline']['where'](_0x4503c4(0x1716))['below'](_0x5624e5)[_0x4503c4(0x1f4a)](),console[_0x4503c4(0x2187)](_0x4503c4(0x19fc)+_0x2c6633[_0x4503c4(0x19ee)]+'\x20条过期的时间线记忆'));const _0x3a4e54=await db[_0x4503c4(0x203a)][_0x4503c4(0xa24)]('timestamp')[_0x4503c4(0x154d)](_0x5624e5)[_0x4503c4(0xf13)]();_0x3a4e54['length']>0x0&&(await db['memorySummaries'][_0x4503c4(0xa24)](_0x4503c4(0x1716))['below'](_0x5624e5)[_0x4503c4(0x1f4a)](),console['log'](_0x4503c4(0x19fc)+_0x3a4e54[_0x4503c4(0x19ee)]+_0x4503c4(0x13ae)));const _0x3f7aa3=await db[_0x4503c4(0x156f)]['where']('timestamp')[_0x4503c4(0x154d)](_0x5624e5)[_0x4503c4(0xf13)]();_0x3f7aa3[_0x4503c4(0x19ee)]>0x0&&(await db[_0x4503c4(0x156f)][_0x4503c4(0xa24)](_0x4503c4(0x1716))['below'](_0x5624e5)['delete'](),console[_0x4503c4(0x2187)](_0x4503c4(0x19fc)+_0x3f7aa3[_0x4503c4(0x19ee)]+'\x20条过期的情景记忆'));}catch(_0x28b22b){console[_0x4503c4(0x174a)]('清理过期记忆失败:',_0x28b22b);}}setInterval(cleanupExpiredMemories,0x3c*0x3c*0x3e8),document[_0x211817(0x21e9)]('DOMContentLoaded',()=>{setTimeout(cleanupExpiredMemories,0x1388);});async function getCoreMemoriesForChat(_0x4fc9cb,_0x44a797=0xa){const _0x47919a=_0x211817;try{const _0xbf7394=await db[_0x47919a(0x127e)][_0x47919a(0xa24)](_0x47919a(0xaf5))[_0x47919a(0x1694)](_0x4fc9cb)['toArray'](),_0x92f6d8=_0xbf7394[_0x47919a(0x1104)]((_0x2aca31,_0x3b6229)=>_0x3b6229[_0x47919a(0x146c)]-_0x2aca31['importance'])[_0x47919a(0x6d5)](0x0,_0x44a797);return _0x92f6d8['map'](_0x4c0b9f=>_0x4c0b9f[_0x47919a(0x13e5)])[_0x47919a(0x122b)]('\x0a');}catch(_0x2b021f){return console[_0x47919a(0x174a)](_0x47919a(0x1fe1),_0x2b021f),'';}}async function shouldRecordGroupMemoryForCharacter(_0x542523,_0x5122d4){const _0x5e6f76=_0x211817;try{const _0x4655c3=await getAsyncChatSettings(_0x542523),_0x36694b=_0x4655c3['memorySharedGroupIds']||[],_0x1fcae3=_0x36694b[_0x5e6f76(0x1831)](_0x5122d4);return console['log'](_0x5e6f76(0x182)+_0x542523+_0x5e6f76(0xafb)+_0x5122d4+_0x5e6f76(0x1b8b)+_0x1fcae3),console[_0x5e6f76(0x2187)](_0x5e6f76(0x1890),_0x36694b),_0x1fcae3;}catch(_0x5e949d){return console['warn'](_0x5e6f76(0x13f2),_0x5e949d),![];}}async function recordCrossAppEvent(_0x1431a3,_0x334eb8,_0x109485,_0x425e3a,_0x4d23c8=null){const _0x552d7b=_0x211817;try{if(!_0x1431a3||!_0x334eb8||!_0x109485){console[_0x552d7b(0x174a)](_0x552d7b(0x4e4),{'characterId':_0x1431a3,'appType':_0x334eb8,'action':_0x109485});return;}const _0x212f7a=_0x425e3a&&typeof _0x425e3a==='object'?_0x425e3a:{},_0x16e366=Date[_0x552d7b(0x2eb)](),_0x320b6d=Math[_0x552d7b(0x11a8)]()['toString'](0x24)[_0x552d7b(0x17ca)](0x2,0x8),_0x189553=_0x1431a3+'_'+_0x334eb8+'_'+_0x109485+'_'+_0x16e366+'_'+_0x320b6d,_0x37a539={'id':_0x189553,'characterId':String(_0x1431a3),'appType':String(_0x334eb8),'action':String(_0x109485),'timestamp':_0x16e366,'context':_0x212f7a,'messageId':_0x4d23c8?String(_0x4d23c8):null};if(!_0x37a539['id']||!_0x37a539[_0x552d7b(0xaf5)]||!_0x37a539[_0x552d7b(0x741)]||!_0x37a539[_0x552d7b(0x211f)]){console['error'](_0x552d7b(0x1960),_0x37a539);return;}if(!db||!db[_0x552d7b(0x8ac)]){console['error'](_0x552d7b(0x1695));return;}await db[_0x552d7b(0x8ac)]['add'](_0x37a539),console['log'](_0x552d7b(0xe50)+_0x334eb8+'.'+_0x109485,{'characterId':_0x37a539['characterId'],'contextId':_0x212f7a['id'],'contextType':_0x212f7a[_0x552d7b(0x1a4b)],'groupId':_0x212f7a[_0x552d7b(0x22be)]||'无','content':_0x212f7a[_0x552d7b(0x211c)]?.[_0x552d7b(0x17ca)](0x0,0x1e)+_0x552d7b(0x1520)});}catch(_0x2f0330){console[_0x552d7b(0x174a)](_0x552d7b(0x426),_0x2f0330),console['error'](_0x552d7b(0x13e3),{'characterId':_0x1431a3,'appType':_0x334eb8,'action':_0x109485,'context':_0x425e3a,'messageId':_0x4d23c8});if(_0x2f0330[_0x552d7b(0x1a1c)]===_0x552d7b(0x17b1))console['error']('数据库键值错误，可能是ID字段问题');else _0x2f0330['name']===_0x552d7b(0x9a9)&&console[_0x552d7b(0x174a)]('数据库约束错误，可能是重复键值');}}async function getCrossAppTimeline(_0x2ed859,_0x1e4f46=0x1e){const _0x32e7d7=_0x211817;try{const _0x411d55=await db['crossAppTimeline']['where'](_0x32e7d7(0xaf5))[_0x32e7d7(0x1694)](_0x2ed859)['toArray']();return _0x411d55[_0x32e7d7(0x1104)]((_0x3a3349,_0x5c06d0)=>_0x5c06d0[_0x32e7d7(0x1716)]-_0x3a3349[_0x32e7d7(0x1716)])[_0x32e7d7(0x6d5)](0x0,_0x1e4f46);}catch(_0x248251){return console[_0x32e7d7(0x174a)](_0x32e7d7(0x1e26),_0x248251),[];}}function calculateMessagesByRounds(_0x2a5a6e,_0x4c8ab0){const _0xac48a7=_0x211817;if(!_0x2a5a6e||_0x2a5a6e[_0xac48a7(0x19ee)]===0x0)return[];const _0x55d1ba=[];let _0x9e0095=[],_0x2901d6=null;for(let _0x4445fe=_0x2a5a6e['length']-0x1;_0x4445fe>=0x0;_0x4445fe--){const _0x22c93b=_0x2a5a6e[_0x4445fe],_0x1649ab=_0x22c93b['sender'];(_0x1649ab!==_0x2901d6||_0x1649ab===_0xac48a7(0x1744))&&(_0x9e0095['length']>0x0&&(_0x55d1ba[_0xac48a7(0x5ed)](_0x9e0095),_0x9e0095=[]));_0x9e0095[_0xac48a7(0x5ed)](_0x22c93b),_0x2901d6=_0x1649ab;if(_0x55d1ba[_0xac48a7(0x19ee)]>=_0x4c8ab0)break;}_0x9e0095[_0xac48a7(0x19ee)]>0x0&&_0x55d1ba[_0xac48a7(0x19ee)]<_0x4c8ab0&&_0x55d1ba['unshift'](_0x9e0095);const _0x3b4818=_0x55d1ba['slice'](-_0x4c8ab0);return _0x3b4818['flat']();}function countActualRounds(_0x51ab32){const _0x4b7283=_0x211817;if(!_0x51ab32||_0x51ab32['length']===0x0)return 0x0;let _0x1d1542=0x0,_0x2f1724=null;for(const _0x5dff96 of _0x51ab32){const _0x3bea29=_0x5dff96[_0x4b7283(0x8a1)];(_0x3bea29!==_0x2f1724||_0x3bea29===_0x4b7283(0x1744))&&_0x1d1542++,_0x2f1724=_0x3bea29;}return _0x1d1542;}async function viewStorylineSummary(_0x2f5bf0){const _0xc7492e=_0x211817;try{const _0x47efba=await db[_0xc7492e(0x8ac)][_0xc7492e(0xb78)](_0x2f5bf0);if(!_0x47efba||_0x47efba[_0xc7492e(0x211f)]!==_0xc7492e(0x1323)){showToast(_0xc7492e(0x1770),_0xc7492e(0x174a));return;}const _0x19c206=_0x47efba['context']?.[_0xc7492e(0x211c)]||_0x47efba['fullContent']||_0xc7492e(0xf2f),_0x1d9e8e=_0x47efba[_0xc7492e(0x1da2)]?.[_0xc7492e(0x20d4)]||_0xc7492e(0x42b),_0x32c485=_0x47efba[_0xc7492e(0x1da2)]?.[_0xc7492e(0x356)]||0x0,_0x3783d0=document[_0xc7492e(0xac6)]('div');_0x3783d0[_0xc7492e(0x1722)]=_0xc7492e(0x56e),_0x3783d0[_0xc7492e(0x33a)]=_0xc7492e(0x1112)+_0x1d9e8e+_0xc7492e(0x16b9)+_0x32c485+_0xc7492e(0x1935)+_0x19c206+_0xc7492e(0x126e)+_0x2f5bf0+_0xc7492e(0x438),document['body']['appendChild'](_0x3783d0);}catch(_0x5dd8bf){console[_0xc7492e(0x174a)](_0xc7492e(0xa14),_0x5dd8bf),showToast(_0xc7492e(0x1772),_0xc7492e(0x174a));}}async function editStorylineSummary(_0x11dfd1){const _0x36db50=_0x211817;try{const _0x4c31da=await db[_0x36db50(0x8ac)]['get'](_0x11dfd1);if(!_0x4c31da||_0x4c31da['action']!==_0x36db50(0x1323)){showToast('找不到该剧情总结',_0x36db50(0x174a));return;}const _0x4e96ef=_0x4c31da[_0x36db50(0x1da2)]?.[_0x36db50(0x211c)]||_0x4c31da['fullContent']||'',_0x113535=_0x4c31da[_0x36db50(0x1da2)]?.[_0x36db50(0x20d4)]||_0x36db50(0x42b),_0xd6b486=_0x4c31da[_0x36db50(0x1da2)]?.[_0x36db50(0x356)]||0x0,_0x364f23=document[_0x36db50(0xac6)](_0x36db50(0xbbc));_0x364f23[_0x36db50(0x1722)]='modal-overlay',_0x364f23[_0x36db50(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20700px;\x20max-height:\x2080vh;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>编辑线下剧情总结</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal-overlay\x27).remove()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-bottom:\x2015px;\x20color:\x20#666;\x20font-size:\x2014px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>日期:\x20'+_0x113535+_0x36db50(0x16b9)+_0xd6b486+_0x36db50(0xe51)+_0x4e96ef+_0x36db50(0x214)+_0x11dfd1+_0x36db50(0x230e),document[_0x36db50(0x1da9)]['appendChild'](_0x364f23),setTimeout(()=>{const _0x332bb8=_0x36db50,_0x32a228=document['getElementById'](_0x332bb8(0xf5d));_0x32a228&&(_0x32a228[_0x332bb8(0x13cf)](),_0x32a228[_0x332bb8(0x207)](_0x32a228[_0x332bb8(0x1ebc)][_0x332bb8(0x19ee)],_0x32a228[_0x332bb8(0x1ebc)][_0x332bb8(0x19ee)]));},0x64);}catch(_0x24996e){console[_0x36db50(0x174a)](_0x36db50(0x225b),_0x24996e),showToast(_0x36db50(0x9ff),_0x36db50(0x174a));}}async function saveStorylineSummary(_0x89ded){const _0x3208a2=_0x211817;try{const _0x4d4e79=document[_0x3208a2(0x1262)](_0x3208a2(0xf5d));if(!_0x4d4e79){showToast(_0x3208a2(0x1522),'error');return;}const _0x155c28=_0x4d4e79['value'][_0x3208a2(0x19d7)]();if(!_0x155c28){showToast(_0x3208a2(0x12d6),_0x3208a2(0x1816));return;}const _0x427990=await db[_0x3208a2(0x8ac)]['get'](_0x89ded);if(!_0x427990){showToast(_0x3208a2(0x1770),_0x3208a2(0x174a));return;}_0x427990[_0x3208a2(0x1da2)][_0x3208a2(0x211c)]=_0x155c28,_0x427990[_0x3208a2(0x1716)]=Date[_0x3208a2(0x2eb)](),await db[_0x3208a2(0x8ac)][_0x3208a2(0x1561)](_0x427990);const _0x55c5a3=_0x4d4e79[_0x3208a2(0x216a)](_0x3208a2(0x119f));_0x55c5a3&&_0x55c5a3[_0x3208a2(0x1493)](),currentMemoryCharacter&&await loadCharacterMemories(),showToast(_0x3208a2(0x205f),_0x3208a2(0x11cb)),console['log'](_0x3208a2(0x7b3),_0x427990);}catch(_0xb04f3e){console['error']('保存剧情总结失败:',_0xb04f3e),showToast(_0x3208a2(0xdad),_0x3208a2(0x174a));}}async function buildContinuousWorkingMemory(_0x58d191,_0x150931,_0x4a3d44=0x32){const _0x453ffe=_0x211817;try{_0x58d191=safeCharacterId(_0x58d191);!Array[_0x453ffe(0x1496)](_0x150931)&&(console[_0x453ffe(0x1f43)](_0x453ffe(0x1614)),_0x150931=[]);const _0x5cf6dd=_0x150931[_0x453ffe(0x6a4)](_0x48dbdf=>({'type':_0x453ffe(0x1a70),'timestamp':_0x48dbdf[_0x453ffe(0x1716)],'content':_0x48dbdf,'appType':_0x453ffe(0x1a70),'characterId':String(_0x58d191)}));let _0x879597=[];try{_0x879597=await db['crossAppTimeline']['where'](_0x453ffe(0xaf5))['equals'](String(_0x58d191))['toArray']();}catch(_0x2ef310){console[_0x453ffe(0x174a)](_0x453ffe(0x19ce)+_0x58d191+':',_0x2ef310),_0x879597=[];}const _0x5ab148=_0x879597[_0x453ffe(0x1e1f)](_0x45fa15=>_0x45fa15[_0x453ffe(0x741)]!==_0x453ffe(0x1a70))[_0x453ffe(0x6a4)](_0x2d2c41=>({'type':_0x453ffe(0x614),'timestamp':_0x2d2c41[_0x453ffe(0x1716)],'content':_0x2d2c41,'appType':_0x2d2c41['appType'],'characterId':_0x58d191})),_0x25c4e7=[..._0x5cf6dd,..._0x5ab148][_0x453ffe(0x1104)]((_0x491140,_0x52ee9b)=>_0x491140[_0x453ffe(0x1716)]-_0x52ee9b['timestamp']),_0x2b25b1=_0x25c4e7['filter'](_0x11987b=>_0x11987b[_0x453ffe(0x1a4b)]===_0x453ffe(0x1a70)),_0x43ab4b=_0x2b25b1[_0x453ffe(0x6a4)](_0x1c4e71=>_0x1c4e71[_0x453ffe(0x211c)]),_0x48d938=calculateMessagesByRounds(_0x43ab4b,_0x4a3d44),_0x256d94=_0x48d938['map'](_0x34bca1=>({'type':'chat','timestamp':_0x34bca1[_0x453ffe(0x1716)],'content':_0x34bca1,'appType':_0x453ffe(0x1a70),'characterId':_0x58d191})),_0x47876d=_0x256d94['length']>0x0?_0x256d94[0x0][_0x453ffe(0x1716)]:0x0,_0x2c9d2d=_0x5ab148[_0x453ffe(0x1e1f)](_0x3f44df=>_0x3f44df['timestamp']>=_0x47876d),_0x2071ce=[..._0x256d94,..._0x2c9d2d][_0x453ffe(0x1104)]((_0x336979,_0x249d91)=>_0x336979['timestamp']-_0x249d91[_0x453ffe(0x1716)]);return _0x2071ce;}catch(_0x2880e0){return console[_0x453ffe(0x174a)](_0x453ffe(0xb63),_0x2880e0),_0x150931[_0x453ffe(0x6a4)](_0x1fd087=>({'type':_0x453ffe(0x1a70),'timestamp':_0x1fd087['timestamp'],'content':_0x1fd087,'appType':_0x453ffe(0x1a70),'characterId':_0x58d191}));}}async function generateCrossAppMemoryDescription(_0x2c5e94,_0x462479){const _0x4f87a7=_0x211817;try{const _0x40e142=characters[_0x4f87a7(0xaf4)](_0x3487fc=>_0x3487fc['id']===_0x2c5e94);if(!_0x40e142)return;let _0x1af8b5='';const _0x4386fb=_0x462479[_0x4f87a7(0x1da2)];switch(_0x462479[_0x4f87a7(0x1eb2)]){case _0x4f87a7(0x1662):if(_0x4386fb[_0x4f87a7(0x211f)]==='listen_together')_0x1af8b5=_0x4f87a7(0x1df6)+_0x4386fb[_0x4f87a7(0x1ce9)]+'》，'+(_0x4386fb[_0x4f87a7(0x5a4)]||'');else _0x4386fb['action']==='song_comment'&&(_0x1af8b5=_0x4f87a7(0x20f8)+_0x4386fb['songTitle']+'》发表了看法：'+_0x4386fb[_0x4f87a7(0x945)]);break;case _0x4f87a7(0x18fb):if(_0x4386fb['action']==='play_together')_0x1af8b5=_0x4f87a7(0x127b)+_0x4386fb[_0x4f87a7(0x58e)]+'，'+(_0x4386fb[_0x4f87a7(0x4ee)]||'');else _0x4386fb['action']===_0x4f87a7(0x10eb)&&(_0x1af8b5='对游戏'+_0x4386fb[_0x4f87a7(0x58e)]+_0x4f87a7(0xa4b)+_0x4386fb[_0x4f87a7(0x945)]);break;case _0x4f87a7(0xf8e):if(_0x4386fb[_0x4f87a7(0x211f)]===_0x4f87a7(0xfe6))_0x1af8b5=_0x4f87a7(0x1259)+_0x4386fb[_0x4f87a7(0x945)];else _0x4386fb[_0x4f87a7(0x211f)]==='topic_discussion'&&(_0x1af8b5=_0x4f87a7(0xbe9)+_0x4386fb[_0x4f87a7(0x1666)]+_0x4f87a7(0xf7e));break;}if(_0x1af8b5){const _0x221440={'id':_0x4f87a7(0xf29)+_0x2c5e94+'_'+Date[_0x4f87a7(0x2eb)]()+'_'+Math['random']()[_0x4f87a7(0x1878)](0x24)[_0x4f87a7(0x15fb)](0x2,0x9),'characterId':_0x2c5e94,'fact':_0x1af8b5,'importance':0.6,'category':_0x4f87a7(0x614),'timestamp':Date[_0x4f87a7(0x2eb)](),'sourceEvent':_0x462479['id']};await db[_0x4f87a7(0x127e)][_0x4f87a7(0x21e2)](_0x221440),console[_0x4f87a7(0x2187)](_0x4f87a7(0x1df9)+_0x40e142[_0x4f87a7(0x1a1c)]+_0x4f87a7(0x7db)+_0x1af8b5);}}catch(_0x2b1208){console[_0x4f87a7(0x174a)](_0x4f87a7(0xa64),_0x2b1208);}}async function getCrossAppMemories(_0x36b994,_0x4b7092=0x5){const _0x35b287=_0x211817;try{const _0x405bfa=await db[_0x35b287(0x127e)][_0x35b287(0xa24)](_0x35b287(0xaf5))['equals'](_0x36b994)['toArray'](),_0xd3e89f=_0x405bfa[_0x35b287(0x1e1f)](_0xcb44fd=>_0xcb44fd[_0x35b287(0x14cb)]===_0x35b287(0x614))[_0x35b287(0x1104)]((_0x334034,_0x58ae64)=>_0x58ae64[_0x35b287(0x1716)]-_0x334034['timestamp'])[_0x35b287(0x6d5)](0x0,_0x4b7092);return _0xd3e89f['map'](_0x371e66=>_0x371e66[_0x35b287(0x13e5)]);}catch(_0x3c186c){return console[_0x35b287(0x174a)]('获取跨应用记忆失败:',_0x3c186c),[];}}async function cleanupDuplicateMemories(_0x69aa43){const _0x3e5579=_0x211817;try{const _0x4df7a8=await db[_0x3e5579(0x127e)][_0x3e5579(0xa24)]('characterId')[_0x3e5579(0x1694)](_0x69aa43)['toArray'](),_0x560846=[];for(let _0x3abacc=0x0;_0x3abacc<_0x4df7a8[_0x3e5579(0x19ee)];_0x3abacc++){for(let _0x294ae2=_0x3abacc+0x1;_0x294ae2<_0x4df7a8[_0x3e5579(0x19ee)];_0x294ae2++){const _0x2f2bf5=calculateTextSimilarity(_0x4df7a8[_0x3abacc][_0x3e5579(0x13e5)],_0x4df7a8[_0x294ae2][_0x3e5579(0x13e5)]);if(_0x2f2bf5>0.8){const _0x4e57f2=_0x4df7a8[_0x3abacc][_0x3e5579(0x146c)]>=_0x4df7a8[_0x294ae2][_0x3e5579(0x146c)]?_0x4df7a8[_0x294ae2]:_0x4df7a8[_0x3abacc];!_0x560846[_0x3e5579(0xaf4)](_0x50d2c0=>_0x50d2c0['id']===_0x4e57f2['id'])&&_0x560846['push'](_0x4e57f2);}}}for(const _0x32b655 of _0x560846){await db[_0x3e5579(0x127e)][_0x3e5579(0x1f4a)](_0x32b655['id']),console[_0x3e5579(0x2187)](_0x3e5579(0x1a74)+_0x32b655[_0x3e5579(0x13e5)]);}_0x560846[_0x3e5579(0x19ee)]>0x0&&console[_0x3e5579(0x2187)](_0x3e5579(0xcbb)+_0x560846['length']+'\x20条重复记忆');}catch(_0x3d268d){console['error'](_0x3e5579(0xf9c),_0x3d268d);}}async function cleanupIncorrectTimelineRecords(){const _0x3f87a4=_0x211817;try{console[_0x3f87a4(0x2187)](_0x3f87a4(0x57b));const _0x2f453d=await db[_0x3f87a4(0x8ac)][_0x3f87a4(0xa24)](_0x3f87a4(0x741))[_0x3f87a4(0x1694)](_0x3f87a4(0x1a70))[_0x3f87a4(0xf13)]();for(const _0x5de3ea of _0x2f453d){await db[_0x3f87a4(0x8ac)][_0x3f87a4(0x1f4a)](_0x5de3ea['id']);}return console[_0x3f87a4(0x2187)](_0x3f87a4(0x1424)+_0x2f453d[_0x3f87a4(0x19ee)]+_0x3f87a4(0x225e)),_0x2f453d['length'];}catch(_0x22490a){return console[_0x3f87a4(0x174a)](_0x3f87a4(0x1d2f),_0x22490a),0x0;}}async function logMemoryUsageStats(_0x1114a1,_0x168e1d){const _0x5f3108=_0x211817;try{const _0x5584dd=_0x1114a1['isGroup']?'group':_0x1114a1['id'],_0x2b1efd=getGlobalMemorySettings();console['log'](_0x5f3108(0x14f2)+_0x168e1d+_0x5f3108(0x10ad)),console[_0x5f3108(0x2187)](_0x5f3108(0x1a84)+_0x1114a1[_0x5f3108(0x1a1c)]+'\x20('+(_0x1114a1[_0x5f3108(0x1f68)]?'群聊':'单聊')+')'),console[_0x5f3108(0x2187)](_0x5f3108(0x22c6)+_0x2b1efd[_0x5f3108(0x1715)]+'天');if(_0x1114a1[_0x5f3108(0x1f68)])for(const _0x52ad60 of _0x1114a1[_0x5f3108(0x12a6)]){await logSingleCharacterMemoryStats(_0x52ad60['id'],_0x52ad60[_0x5f3108(0x1a1c)],_0x2b1efd['memoryDays']);}else await logSingleCharacterMemoryStats(_0x1114a1['id'],_0x1114a1[_0x5f3108(0x1a1c)],_0x2b1efd['memoryDays']);console[_0x5f3108(0x2187)](_0x5f3108(0x5bc));}catch(_0x2e2b9c){console[_0x5f3108(0x174a)](_0x5f3108(0x161a),_0x2e2b9c);}}async function logSingleCharacterMemoryStats(_0x1072ca,_0x49a72e,_0x17b4b4){const _0x5e8685=_0x211817;try{const _0x4f59c9=await db[_0x5e8685(0x127e)][_0x5e8685(0xa24)](_0x5e8685(0xaf5))[_0x5e8685(0x1694)](_0x1072ca)[_0x5e8685(0xf13)](),_0x99115b=_0x4f59c9[_0x5e8685(0x6d5)](0x0,0xa),_0x5a866c=Date[_0x5e8685(0x2eb)]()-_0x17b4b4*0x18*0x3c*0x3c*0x3e8,_0x44a10a=await db['episodicMemories']['where'](_0x5e8685(0xaf5))[_0x5e8685(0x1694)](_0x1072ca)[_0x5e8685(0x82f)](_0x1beb2c=>_0x1beb2c[_0x5e8685(0x1716)]>=_0x5a866c)[_0x5e8685(0xf13)](),_0x2ebf9d=_0x44a10a[_0x5e8685(0x6d5)](0x0,0xf),_0x37f586=await db[_0x5e8685(0x8ac)]['where'](_0x5e8685(0xaf5))['equals'](_0x1072ca)[_0x5e8685(0x82f)](_0x1fb29e=>_0x1fb29e[_0x5e8685(0x1716)]>=_0x5a866c)[_0x5e8685(0xf13)](),_0x2f7b77=_0x37f586['slice'](0x0,0x14),_0x27df95=new Date(_0x5a866c)[_0x5e8685(0x1034)]()[_0x5e8685(0x204b)]('T')[0x0],_0x8d3dbb=await db[_0x5e8685(0x203a)]['where']('characterId')[_0x5e8685(0x1694)](_0x1072ca)['and'](_0x92f8d0=>_0x92f8d0[_0x5e8685(0x20d4)]>=_0x27df95)[_0x5e8685(0xf13)](),_0x17e3bd=_0x8d3dbb[_0x5e8685(0x6d5)](0x0,0xa),_0x1b6f8d=_0x99115b[_0x5e8685(0x1122)]((_0x21d099,_0x3df428)=>_0x21d099+(_0x3df428[_0x5e8685(0x13e5)]?.[_0x5e8685(0x19ee)]||0x0),0x0)*1.5,_0x518442=_0x2ebf9d[_0x5e8685(0x1122)]((_0x296e85,_0x1df6b9)=>_0x296e85+(_0x1df6b9[_0x5e8685(0x13e5)]?.['length']||0x0),0x0)*1.5,_0x20e90f=_0x2f7b77[_0x5e8685(0x1122)]((_0x15b3a7,_0x34bec2)=>_0x15b3a7+(_0x34bec2[_0x5e8685(0x1da2)]?.['content']?.[_0x5e8685(0x19ee)]||0x0),0x0)*1.5,_0x51e91=_0x17e3bd[_0x5e8685(0x1122)]((_0x101d10,_0x37dbe4)=>_0x101d10+(_0x37dbe4[_0x5e8685(0x1490)]?.[_0x5e8685(0x19ee)]||0x0),0x0)*1.5,_0x4fed2b=_0x1b6f8d+_0x518442+_0x20e90f+_0x51e91;console[_0x5e8685(0x2187)]('\x0a👤\x20'+_0x49a72e+'\x20(ID:\x20'+_0x1072ca+'):'),console[_0x5e8685(0x2187)](_0x5e8685(0x413)+_0x99115b['length']+'条\x20(总库存:\x20'+_0x4f59c9['length']+_0x5e8685(0x1b32)+Math['round'](_0x1b6f8d)+_0x5e8685(0x1a87)),console[_0x5e8685(0x2187)]('\x20\x20🟠\x20情景记忆:\x20'+_0x2ebf9d[_0x5e8685(0x19ee)]+'条\x20(总库存:\x20'+_0x44a10a[_0x5e8685(0x19ee)]+'条)\x20~'+Math[_0x5e8685(0x13e2)](_0x518442)+_0x5e8685(0x1a87)),console[_0x5e8685(0x2187)](_0x5e8685(0x36c)+_0x2f7b77[_0x5e8685(0x19ee)]+_0x5e8685(0x1d68)+_0x37f586['length']+_0x5e8685(0x1b32)+Math[_0x5e8685(0x13e2)](_0x20e90f)+_0x5e8685(0x1a87)),console[_0x5e8685(0x2187)](_0x5e8685(0x1457)+_0x17e3bd[_0x5e8685(0x19ee)]+'条\x20(总库存:\x20'+_0x8d3dbb[_0x5e8685(0x19ee)]+_0x5e8685(0x1b32)+Math[_0x5e8685(0x13e2)](_0x51e91)+'tokens'),console[_0x5e8685(0x2187)](_0x5e8685(0x2258)+Math[_0x5e8685(0x13e2)](_0x4fed2b)+'tokens');const _0x407a4f=getCurrentChatSettings()['historyCount']||0x5,_0x4fc07d=Math[_0x5e8685(0x2180)](_0x407a4f*0.3),_0x50d36b=_0x407a4f-_0x4fc07d;console['log']('\x20\x20⚠️\x20\x20注意:\x20这些记忆是额外添加的，不占用用户设置的\x22附带历史消息数\x22配额'),console['log'](_0x5e8685(0x1e21)),console['log'](_0x5e8685(0x1f70)+_0x50d36b+'条\x20(用户设置:\x20'+_0x407a4f+'条)'),console[_0x5e8685(0x2187)](_0x5e8685(0x1931)+_0x4fc07d+_0x5e8685(0x16db)),console[_0x5e8685(0x2187)](_0x5e8685(0x528)+_0x407a4f+'条\x20(按时间顺序滚动)');}catch(_0x293f02){console['error'](_0x5e8685(0x2a6)+_0x49a72e+_0x5e8685(0x21b5),_0x293f02);}}async function deleteRelatedTimelineEvents(_0x87dfc2){const _0x2491a6=_0x211817;try{const _0x41804d=currentChatCharacter['id'],_0x878e99=_0x87dfc2['content'],_0x375815=_0x87dfc2[_0x2491a6(0x1716)],_0x59c564=await db['crossAppTimeline'][_0x2491a6(0xa24)](_0x2491a6(0xaf5))[_0x2491a6(0x1694)](_0x41804d)[_0x2491a6(0x82f)](_0x21ceb8=>{const _0x5a49ef=_0x2491a6,_0x235dc6=Math[_0x5a49ef(0x1b24)](_0x21ceb8['timestamp']-_0x375815),_0x519b2e=_0x235dc6<0x5*0x3c*0x3e8,_0x3f9fe2=_0x21ceb8[_0x5a49ef(0x1da2)]&&_0x21ceb8[_0x5a49ef(0x1da2)][_0x5a49ef(0x211c)]&&typeof _0x21ceb8['context'][_0x5a49ef(0x211c)]==='string'&&_0x878e99&&typeof _0x878e99==='string'&&_0x21ceb8[_0x5a49ef(0x1da2)][_0x5a49ef(0x211c)][_0x5a49ef(0x1831)](_0x878e99[_0x5a49ef(0x17ca)](0x0,0x1e));return _0x519b2e&&_0x3f9fe2;})[_0x2491a6(0xf13)]();for(const _0x1f539f of _0x59c564){await db['crossAppTimeline']['delete'](_0x1f539f['id']);const _0x1a463e=_0x1f539f[_0x2491a6(0x1da2)]?.[_0x2491a6(0x211c)]&&typeof _0x1f539f['context']['content']==='string'?_0x1f539f[_0x2491a6(0x1da2)]['content']['substring'](0x0,0x32):'无内容';console[_0x2491a6(0x2187)](_0x2491a6(0xec2)+_0x1f539f[_0x2491a6(0x211f)]+_0x2491a6(0x1811)+_0x1a463e+_0x2491a6(0x1520));}console['log'](_0x2491a6(0x1638)+_0x59c564['length']+_0x2491a6(0x1642));}catch(_0x304943){console['error']('删除相关时间线记录失败:',_0x304943);}}async function deleteSMSRelatedTimelineEvents(_0x7e508d,_0x26c72b){const _0x515d4c=_0x211817;try{const _0x3d4f68=_0x7e508d[_0x515d4c(0x211c)],_0x53e2eb=_0x7e508d[_0x515d4c(0x1716)],_0x22e7e7=await db[_0x515d4c(0x8ac)][_0x515d4c(0xa24)](_0x515d4c(0xaf5))[_0x515d4c(0x1694)](_0x26c72b)[_0x515d4c(0x82f)](_0x5bdfe8=>{const _0x471c8a=_0x515d4c;if(_0x5bdfe8[_0x471c8a(0x741)]!==_0x471c8a(0x322))return![];if(_0x5bdfe8[_0x471c8a(0x21c8)]===_0x7e508d['id'])return!![];const _0x52a10=Math[_0x471c8a(0x1b24)](_0x5bdfe8[_0x471c8a(0x1716)]-_0x53e2eb),_0x3c1f12=_0x52a10<0x5*0x3c*0x3e8,_0xeb2921=_0x5bdfe8[_0x471c8a(0x1da2)]&&_0x5bdfe8[_0x471c8a(0x1da2)][_0x471c8a(0x211c)]&&typeof _0x5bdfe8[_0x471c8a(0x1da2)][_0x471c8a(0x211c)]===_0x471c8a(0x11b7)&&_0x3d4f68&&typeof _0x3d4f68===_0x471c8a(0x11b7)&&_0x5bdfe8['context']['content'][_0x471c8a(0x1831)](_0x3d4f68[_0x471c8a(0x17ca)](0x0,0x1e));return _0x3c1f12&&_0xeb2921;})[_0x515d4c(0xf13)]();for(const _0x505e62 of _0x22e7e7){await db[_0x515d4c(0x8ac)][_0x515d4c(0x1f4a)](_0x505e62['id']);const _0x165dcf=_0x505e62[_0x515d4c(0x1da2)]?.['content']&&typeof _0x505e62[_0x515d4c(0x1da2)]['content']===_0x515d4c(0x11b7)?_0x505e62['context'][_0x515d4c(0x211c)][_0x515d4c(0x17ca)](0x0,0x32):'无内容';console[_0x515d4c(0x2187)](_0x515d4c(0xb52)+_0x505e62[_0x515d4c(0x211f)]+'\x20-\x20'+_0x165dcf+_0x515d4c(0x1520));}console[_0x515d4c(0x2187)]('✅\x20删除了\x20'+_0x22e7e7['length']+_0x515d4c(0x351));}catch(_0x10e14f){console[_0x515d4c(0x174a)](_0x515d4c(0x1d54),_0x10e14f);}}async function cleanupLowQualityMemories(_0x227f73){const _0x15ead6=_0x211817;try{console[_0x15ead6(0x2187)](_0x15ead6(0x171d)+_0x227f73+_0x15ead6(0xcc2));const _0x179263=MEMORY_CONFIG[_0x15ead6(0x213)],_0x5720f2=await db[_0x15ead6(0x127e)][_0x15ead6(0xa24)](_0x15ead6(0xaf5))[_0x15ead6(0x1694)](_0x227f73)[_0x15ead6(0x82f)](_0x15ba37=>(_0x15ba37[_0x15ead6(0x146c)]||0x0)<_0x179263)[_0x15ead6(0xf13)]();for(const _0x19b7b3 of _0x5720f2){await db[_0x15ead6(0x127e)][_0x15ead6(0x1f4a)](_0x19b7b3['id']),console[_0x15ead6(0x2187)]('🗑️\x20删除低质量核心记忆\x20(重要性:\x20'+_0x19b7b3[_0x15ead6(0x146c)]+'):\x20'+_0x19b7b3[_0x15ead6(0x13e5)]);}return console['log']('✅\x20清理完成，删除了\x20'+_0x5720f2['length']+_0x15ead6(0x18ec)),_0x5720f2[_0x15ead6(0x19ee)];}catch(_0x178ac2){return console[_0x15ead6(0x174a)]('清理低质量记忆失败:',_0x178ac2),0x0;}}let currentMemoryFilter='all',currentMemoryCharacter=null,allMemories=[];async function initMemoryViewer(){await loadCharacterSelectOptions();}async function loadCharacterSelectOptions(){const _0x1925bc=_0x211817,_0x450ee5=document[_0x1925bc(0x1262)](_0x1925bc(0x191));if(!_0x450ee5)return;_0x450ee5[_0x1925bc(0x33a)]=_0x1925bc(0x148d),characters[_0x1925bc(0x19fb)](_0x353a02=>{const _0x5bfb70=_0x1925bc,_0x21bfa4=document[_0x5bfb70(0xac6)]('option');_0x21bfa4['value']=_0x353a02['id'],_0x21bfa4[_0x5bfb70(0x13be)]=_0x353a02[_0x5bfb70(0x1a1c)],_0x450ee5[_0x5bfb70(0x497)](_0x21bfa4);});}async function loadCharacterMemories(){const _0x3fd454=_0x211817,_0x32ccc0=document[_0x3fd454(0x1262)](_0x3fd454(0x191)),_0x3e597a=_0x32ccc0[_0x3fd454(0x1ebc)];if(!_0x3e597a){currentMemoryCharacter=null,allMemories=[],renderMemoryList();return;}currentMemoryCharacter=_0x3e597a;try{const [_0x599427,_0x33efd0,_0x5c9098]=await Promise[_0x3fd454(0x1a47)]([db[_0x3fd454(0x127e)][_0x3fd454(0xa24)]('characterId')[_0x3fd454(0x1694)](_0x3e597a)[_0x3fd454(0xf13)](),db['episodicMemories'][_0x3fd454(0xa24)](_0x3fd454(0xaf5))[_0x3fd454(0x1694)](_0x3e597a)[_0x3fd454(0xf13)](),db[_0x3fd454(0x8ac)]['where'](_0x3fd454(0xaf5))[_0x3fd454(0x1694)](_0x3e597a)[_0x3fd454(0xf13)]()]);console[_0x3fd454(0x2187)](_0x3fd454(0x11c2)+_0x3e597a+_0x3fd454(0xd01),_0x5c9098['length'],'条'),_0x5c9098[_0x3fd454(0x19fb)]((_0x57950c,_0x521fbc)=>{const _0x57be71=_0x3fd454;_0x521fbc<0x5&&console[_0x57be71(0x2187)]('\x20\x20'+(_0x521fbc+0x1)+'.\x20'+_0x57950c['appType']+'.'+_0x57950c[_0x57be71(0x211f)]+_0x57be71(0x188e)+_0x57950c[_0x57be71(0x1da2)]?.['id']+_0x57be71(0x339)+_0x57950c[_0x57be71(0x1da2)]?.['type']+_0x57be71(0x1ea4)+(_0x57950c[_0x57be71(0x1da2)]?.['groupId']||'无'));});const _0x104a8d=await db[_0x3fd454(0x8ac)][_0x3fd454(0xa24)](_0x3fd454(0xaf5))[_0x3fd454(0x1694)](_0x3e597a)[_0x3fd454(0x82f)](_0x141785=>_0x141785[_0x3fd454(0x211f)]==='storyline_summary'&&_0x141785[_0x3fd454(0x741)]===_0x3fd454(0x13dd))[_0x3fd454(0xf13)]();console[_0x3fd454(0x2187)]('📖\x20线下剧情总结:\x20'+_0x104a8d[_0x3fd454(0x19ee)]+'条'),allMemories=[..._0x599427['filter'](_0x110b38=>_0x110b38['type']===_0x3fd454(0x228e))[_0x3fd454(0x6a4)](_0x2eb53f=>({..._0x2eb53f,'memoryType':'core'})),..._0x33efd0[_0x3fd454(0x6a4)](_0x3ea2c3=>({..._0x3ea2c3,'memoryType':'episodic'})),..._0x5c9098[_0x3fd454(0x6a4)](_0x46b4ad=>({..._0x46b4ad,'memoryType':_0x3fd454(0x13ac),'fact':formatTimelineEvent(_0x46b4ad)})),..._0x104a8d[_0x3fd454(0x6a4)](_0x4cb1ac=>{const _0x33b4e6=_0x3fd454,_0x133ed2=_0x4cb1ac['context']?.[_0x33b4e6(0x211c)]||_0x33b4e6(0x1b2f),_0x5d6f20=_0x133ed2['split']('\x0a'),_0x41c901=_0x5d6f20[_0x33b4e6(0x6d5)](0x0,0x3)[_0x33b4e6(0x122b)]('\x0a')+(_0x5d6f20['length']>0x3?_0x33b4e6(0x8ab):'');return{..._0x4cb1ac,'memoryType':_0x33b4e6(0x190b),'fact':_0x41c901,'summary':_0x41c901,'fullContent':_0x133ed2};})],allMemories[_0x3fd454(0x1104)]((_0x5f4b5b,_0x1bb3c8)=>_0x1bb3c8['timestamp']-_0x5f4b5b[_0x3fd454(0x1716)]),renderMemoryList();}catch(_0x23df4b){console['error'](_0x3fd454(0x173a),_0x23df4b),showToast(_0x3fd454(0xa06),_0x3fd454(0x174a));}}function switchMemoryFilter(_0x1f2d09){const _0x358886=_0x211817;currentMemoryFilter=_0x1f2d09,document[_0x358886(0x1897)](_0x358886(0x5ad))[_0x358886(0x19fb)](_0x284786=>{const _0x2cbc8f=_0x358886;_0x284786[_0x2cbc8f(0x1c1b)]['remove'](_0x2cbc8f(0x1a14));}),document['querySelector']('[data-type=\x22'+_0x1f2d09+'\x22]')[_0x358886(0x1c1b)][_0x358886(0x21e2)](_0x358886(0x1a14)),renderMemoryList();}function filterMemories(){renderMemoryList();}function renderMemoryList(){const _0x2e5093=_0x211817,_0x27dc0d=document['getElementById'](_0x2e5093(0x185d));if(!_0x27dc0d)return;if(!currentMemoryCharacter||allMemories['length']===0x0){_0x27dc0d[_0x2e5093(0x33a)]=_0x2e5093(0x9e4)+(currentMemoryCharacter?'该角色暂无记忆数据':_0x2e5093(0xb0f))+_0x2e5093(0xe3a);return;}const _0x4b1120=document[_0x2e5093(0x1262)](_0x2e5093(0x1130))[_0x2e5093(0x1ebc)][_0x2e5093(0x49e)]();let _0x3518d5=allMemories;currentMemoryFilter!==_0x2e5093(0x1a47)&&(_0x3518d5=_0x3518d5['filter'](_0x2e2250=>_0x2e2250[_0x2e5093(0x1b71)]===currentMemoryFilter));_0x4b1120&&(_0x3518d5=_0x3518d5[_0x2e5093(0x1e1f)](_0x1311f=>{const _0x539153=_0x2e5093,_0x1473cf=_0x1311f['fact']||_0x1311f[_0x539153(0x1490)]||'';return _0x1473cf[_0x539153(0x49e)]()[_0x539153(0x1831)](_0x4b1120);}));if(_0x3518d5[_0x2e5093(0x19ee)]===0x0){_0x27dc0d[_0x2e5093(0x33a)]=_0x2e5093(0x194f);return;}const _0x4b573c=_0x3518d5[_0x2e5093(0x6a4)](_0x77995c=>renderMemoryItem(_0x77995c))[_0x2e5093(0x122b)]('');_0x27dc0d[_0x2e5093(0x33a)]=_0x4b573c;}function renderMemoryItem(_0x416165){const _0x56d6b2=_0x211817,_0x293afb=new Date(_0x416165[_0x56d6b2(0x1716)]||Date[_0x56d6b2(0x2eb)]()),_0x11d02f=isNaN(_0x293afb[_0x56d6b2(0x704)]())?_0x56d6b2(0x42b):_0x293afb[_0x56d6b2(0xbf7)](_0x56d6b2(0x156c)),_0x3ab32f=_0x416165[_0x56d6b2(0x13e5)]||_0x416165['summary']||'',_0x3c243e=_0x416165['importance']||0x0,_0x5d6b69='★'[_0x56d6b2(0xcc7)](Math[_0x56d6b2(0x13e2)](_0x3c243e*0x5)),_0x419b8b={'core':_0x56d6b2(0x498),'episodic':'情景记忆','storyline':_0x56d6b2(0x1c30),'timeline':_0x56d6b2(0xf7a)};return _0x56d6b2(0x1b7c)+_0x416165['id']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22memory-item-type\x20'+_0x416165['memoryType']+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-'+getMemoryTypeIcon(_0x416165[_0x56d6b2(0x1b71)])+_0x56d6b2(0x1835)+_0x419b8b[_0x416165[_0x56d6b2(0x1b71)]]+_0x56d6b2(0x1652)+_0x11d02f+_0x56d6b2(0x4bf)+_0x3ab32f+_0x56d6b2(0x19f3)+(_0x416165['memoryType']===_0x56d6b2(0x228e)||_0x416165[_0x56d6b2(0x1b71)]===_0x56d6b2(0x1fc5)?_0x56d6b2(0x1d9e)+_0x5d6b69+_0x56d6b2(0x19f)+(_0x3c243e*0x64)[_0x56d6b2(0x13ad)](0x0)+_0x56d6b2(0x228f):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22memory-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x416165[_0x56d6b2(0x1b71)]==='storyline'?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x20view-btn\x22\x20onclick=\x22viewStorylineSummary(\x27'+_0x416165['id']+_0x56d6b2(0x4d0)+_0x416165['id']+'\x27)\x22\x20title=\x22编辑剧情总结\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-edit\x22></i>\x20编辑\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22memory-action-btn\x22\x20onclick=\x22editMemory(\x27'+_0x416165['id']+_0x56d6b2(0xda7)+_0x416165[_0x56d6b2(0x1b71)]+_0x56d6b2(0xe7d))+_0x56d6b2(0xa7d)+_0x416165['id']+'\x27,\x20\x27'+_0x416165[_0x56d6b2(0x1b71)]+_0x56d6b2(0xd95);}function getMemoryTypeIcon(_0x4b82df){const _0x4f2501=_0x211817,_0x13430b={'core':'star','episodic':_0x4f2501(0x1539),'storyline':_0x4f2501(0x1a4a),'timeline':'clock'};return _0x13430b[_0x4b82df]||_0x4f2501(0x22e0);}function formatTimelineEvent(_0x23d1b3){const _0x335634=_0x211817,_0x5d5565={'chat':'聊天','music':'音乐','moments':'动态','diary':'日记'},_0x3359c8=_0x5d5565[_0x23d1b3[_0x335634(0x741)]]||_0x23d1b3[_0x335634(0x741)];let _0x5b13c3='';try{const _0x37b260=typeof _0x23d1b3[_0x335634(0x1da2)]===_0x335634(0x11b7)?JSON[_0x335634(0x22d3)](_0x23d1b3[_0x335634(0x1da2)]):_0x23d1b3[_0x335634(0x1da2)];switch(_0x23d1b3['appType']){case _0x335634(0x1a70):const _0x7f2baa=_0x37b260?.[_0x335634(0x1a4b)]==='group_chat'?'群聊':'单聊',_0x2672f8=_0x37b260?.[_0x335634(0x1301)]?'('+_0x37b260[_0x335634(0x1301)]+')':'';if(_0x23d1b3[_0x335634(0x211f)]===_0x335634(0x120e))_0x5b13c3='在'+_0x7f2baa+_0x2672f8+_0x335634(0x1e5a);else _0x23d1b3[_0x335634(0x211f)]===_0x335634(0x20fe)?_0x5b13c3='在'+_0x7f2baa+_0x2672f8+'中收到用户消息':_0x5b13c3='在'+_0x7f2baa+_0x2672f8+'中进行了聊天互动';break;case _0x335634(0x210c):if(_0x37b260[_0x335634(0x211f)]===_0x335634(0xf4a))_0x5b13c3='与用户一起听歌：'+(_0x37b260[_0x335634(0x1ce9)]||_0x37b260[_0x335634(0x1280)]||'');else _0x37b260[_0x335634(0x211f)]==='song_comment'?_0x5b13c3=_0x335634(0x1514):_0x5b13c3=_0x335634(0xc4d);break;case _0x335634(0x9c7):if(_0x23d1b3['action']===_0x335634(0x75f))_0x5b13c3='在动态中回复了其他角色';else _0x23d1b3[_0x335634(0x211f)]===_0x335634(0xd7b)?_0x5b13c3=_0x335634(0x773):_0x5b13c3=_0x335634(0x1232);break;case _0x335634(0x1626):_0x5b13c3='写了日记';break;default:_0x5b13c3='进行了'+(_0x23d1b3[_0x335634(0x211f)]||'未知')+'活动';}}catch(_0x4103da){_0x5b13c3='进行了'+(_0x23d1b3['action']||'未知')+'活动';}return'【'+_0x3359c8+'】'+_0x5b13c3;}async function refreshMemoryData(){const _0x4ff84d=_0x211817;currentMemoryCharacter&&(await loadCharacterMemories(),showToast(_0x4ff84d(0xd4d),_0x4ff84d(0x11cb)));}async function cleanupIncorrectRecords(){const _0x10e1f4=_0x211817;if(!confirm(_0x10e1f4(0xa20)))return;try{const _0x41f331=await cleanupIncorrectTimelineRecords();await loadCharacterMemories(),showToast(_0x10e1f4(0x990)+_0x41f331+'条错误记录',_0x10e1f4(0x11cb));}catch(_0x1f79dc){console[_0x10e1f4(0x174a)]('清理错误记录失败:',_0x1f79dc),showToast(_0x10e1f4(0x1e66),_0x10e1f4(0x174a));}}async function testCrossAppMemorySharing(_0x176d86){const _0x5b0c38=_0x211817;console[_0x5b0c38(0x2187)](_0x5b0c38(0x1d00));try{console['log'](_0x5b0c38(0xbc4)),await recordCrossAppEvent(_0x176d86,'sms',_0x5b0c38(0x20fe),{'id':_0x176d86,'type':'sms_message','content':'测试短信内容：我刚刚吃了冰淇淋','chatId':_0x176d86,'sender':'user'},'test_sms_'+Date['now']()),await new Promise(_0x21eb4f=>setTimeout(_0x21eb4f,0x3e8)),console[_0x5b0c38(0x2187)](_0x5b0c38(0x1ee6));const _0x4e8004=await getCrossAppTimeline(_0x176d86,0xa);console[_0x5b0c38(0x2187)](_0x5b0c38(0xec3),_0x4e8004[_0x5b0c38(0x19ee)]);const _0x1b62e1=_0x4e8004[_0x5b0c38(0x1e1f)](_0xdfe277=>_0xdfe277[_0x5b0c38(0x741)]===_0x5b0c38(0x322));console[_0x5b0c38(0x2187)](_0x5b0c38(0x410),_0x1b62e1[_0x5b0c38(0x19ee)]);_0x1b62e1['length']>0x0?(console[_0x5b0c38(0x2187)](_0x5b0c38(0x456)),_0x1b62e1['forEach']((_0x3ea1fe,_0x39636c)=>{const _0x5a5756=_0x5b0c38;console[_0x5a5756(0x2187)](_0x5a5756(0x29f)+(_0x39636c+0x1)+':',{'action':_0x3ea1fe[_0x5a5756(0x211f)],'content':_0x3ea1fe[_0x5a5756(0x1da2)]?.[_0x5a5756(0x211c)]?.[_0x5a5756(0x17ca)](0x0,0x32),'timestamp':new Date(_0x3ea1fe[_0x5a5756(0x1716)])[_0x5a5756(0xecc)]()});})):console[_0x5b0c38(0x2187)](_0x5b0c38(0x643));console[_0x5b0c38(0x2187)](_0x5b0c38(0x22c2));const _0x3d8fc7=await buildGlobalMemoryContext(_0x176d86,{'id':_0x176d86,'type':'private_chat'},0x7);_0x3d8fc7['includes']('短信')||_0x3d8fc7[_0x5b0c38(0x1831)]('冰淇淋')?(console[_0x5b0c38(0x2187)](_0x5b0c38(0xb07)),console[_0x5b0c38(0x2187)](_0x5b0c38(0x7ac),_0x3d8fc7[_0x5b0c38(0x17ca)](0x0,0x1f4)+_0x5b0c38(0x1520))):(console['log'](_0x5b0c38(0xa4e)),console['log'](_0x5b0c38(0x1478),_0x3d8fc7));}catch(_0x2bea94){console['error'](_0x5b0c38(0x1cc),_0x2bea94);}}async function cleanupDuplicateTimelineEvents(_0x3cdb16){const _0xbee386=_0x211817;try{console['log'](_0xbee386(0x171d)+_0x3cdb16+'\x20的重复时间线记录...');const _0x11442b=await db[_0xbee386(0x8ac)][_0xbee386(0xa24)](_0xbee386(0xaf5))['equals'](_0x3cdb16)[_0xbee386(0xf13)](),_0x550955=[],_0x8339f6=new Map();for(const _0x221b76 of _0x11442b){const _0x3ebbe6=_0x221b76[_0xbee386(0x1da2)]?.['content'];if(_0x3ebbe6){const _0x19cef0=_0x3ebbe6[_0xbee386(0x49e)]()['trim']();if(_0x8339f6['has'](_0x19cef0)){const _0x5b6452=_0x8339f6[_0xbee386(0xb78)](_0x19cef0);_0x221b76[_0xbee386(0x1716)]>_0x5b6452['timestamp']?_0x550955[_0xbee386(0x1cd6)](_0x221b76):(_0x550955[_0xbee386(0x1cd6)](_0x5b6452),_0x8339f6[_0xbee386(0x83c)](_0x19cef0,_0x221b76));}else _0x8339f6[_0xbee386(0x83c)](_0x19cef0,_0x221b76);}}for(const _0xfa0ccb of _0x550955){await db[_0xbee386(0x8ac)]['delete'](_0xfa0ccb['id']),console[_0xbee386(0x2187)](_0xbee386(0x360)+_0xfa0ccb[_0xbee386(0x211f)]+'\x20-\x20'+_0xfa0ccb[_0xbee386(0x1da2)]?.[_0xbee386(0x211c)]?.[_0xbee386(0x17ca)](0x0,0x32)+_0xbee386(0x1520));}return console[_0xbee386(0x2187)](_0xbee386(0x1424)+_0x550955['length']+_0xbee386(0x17b3)),_0x550955[_0xbee386(0x19ee)];}catch(_0xe63987){return console[_0xbee386(0x174a)]('清理重复时间线记录失败:',_0xe63987),0x0;}}function showMemorySettings(){const _0x5c75f2=_0x211817;document[_0x5c75f2(0x1262)]('aiExtractInterval')[_0x5c75f2(0x1ebc)]=MEMORY_CONFIG[_0x5c75f2(0x2aa)]/0x2,document[_0x5c75f2(0x1262)](_0x5c75f2(0x1453))['value']=MEMORY_CONFIG[_0x5c75f2(0x213)],document[_0x5c75f2(0x1262)](_0x5c75f2(0x1913))[_0x5c75f2(0x1ebc)]=MEMORY_CONFIG[_0x5c75f2(0x1820)],updateThresholdDisplay(),document['getElementById'](_0x5c75f2(0x935))[_0x5c75f2(0x14eb)]['display']='flex';}function closeMemorySettings(){const _0x4cf1b6=_0x211817;document[_0x4cf1b6(0x1262)]('memorySettingsModal')[_0x4cf1b6(0x14eb)][_0x4cf1b6(0x4da)]='none';}function updateThresholdDisplay(){const _0x10e335=_0x211817,_0x12feef=document[_0x10e335(0x1262)]('coreMemoryThreshold')['value'],_0x4182ef=document[_0x10e335(0x1262)](_0x10e335(0x1913))['value'];document['getElementById'](_0x10e335(0x4e2))[_0x10e335(0x13be)]=Math[_0x10e335(0x13e2)](_0x12feef*0x64)+'%',document[_0x10e335(0x1262)](_0x10e335(0x14c0))[_0x10e335(0x13be)]=Math['round'](_0x4182ef*0x64)+'%';}async function saveMemorySettings(){const _0x4a9da1=_0x211817;try{const _0x48efe9=parseInt(document[_0x4a9da1(0x1262)](_0x4a9da1(0x1850))[_0x4a9da1(0x1ebc)]),_0x6508e4=parseFloat(document[_0x4a9da1(0x1262)](_0x4a9da1(0x1453))[_0x4a9da1(0x1ebc)]),_0x242dd3=parseFloat(document[_0x4a9da1(0x1262)]('episodicMemoryThreshold')[_0x4a9da1(0x1ebc)]);MEMORY_CONFIG[_0x4a9da1(0x2aa)]=_0x48efe9*0x2,MEMORY_CONFIG[_0x4a9da1(0x213)]=_0x6508e4,MEMORY_CONFIG['EPISODIC_MEMORY_IMPORTANCE_THRESHOLD']=_0x242dd3,await saveMemoryConfig(),closeMemorySettings(),showToast(_0x4a9da1(0x12f9),'success');}catch(_0x187970){console[_0x4a9da1(0x174a)](_0x4a9da1(0x13bc),_0x187970),showToast(_0x4a9da1(0x1103),_0x4a9da1(0x174a));}}async function editMemory(_0x4fb76d,_0x34f2d6){const _0x47f00b=_0x211817;try{if(_0x34f2d6===_0x47f00b(0x13ac)){showToast(_0x47f00b(0x3b5),_0x47f00b(0x1816));return;}let _0x5e8012;if(_0x34f2d6===_0x47f00b(0x1490))_0x5e8012=await db[_0x47f00b(0x203a)][_0x47f00b(0xb78)](_0x4fb76d);else{if(_0x34f2d6===_0x47f00b(0x228e))_0x5e8012=await db[_0x47f00b(0x127e)]['get'](_0x4fb76d);else{showToast(_0x47f00b(0x1fe),_0x47f00b(0x174a));return;}}if(!_0x5e8012){showToast(_0x47f00b(0x359),_0x47f00b(0x174a));return;}const _0xb2361a=_0x5e8012[_0x47f00b(0x13e5)]||_0x5e8012[_0x47f00b(0x1490)]||'',_0x3ac93a=await showCustomPrompt(_0x47f00b(0x17c5),_0x47f00b(0x2c2),_0xb2361a);_0x3ac93a&&_0x3ac93a[_0x47f00b(0x19d7)]()&&_0x3ac93a!==_0xb2361a&&(_0x34f2d6===_0x47f00b(0x1490)?(_0x5e8012['summary']=_0x3ac93a['trim'](),await db[_0x47f00b(0x203a)][_0x47f00b(0x1561)](_0x5e8012)):(_0x5e8012[_0x47f00b(0x13e5)]=_0x3ac93a[_0x47f00b(0x19d7)](),await db[_0x47f00b(0x127e)]['put'](_0x5e8012)),await loadCharacterMemories(),showToast(_0x47f00b(0xb5c),'success'));}catch(_0x2b8a36){console[_0x47f00b(0x174a)]('编辑记忆失败:',_0x2b8a36),showToast(_0x47f00b(0x1ff5),_0x47f00b(0x174a));}}async function deleteMemory(_0x3d8458,_0x2e2ed6){const _0x5cb65f=_0x211817;let _0xd9b4a3=_0x5cb65f(0x17ac);_0x2e2ed6==='timeline'&&(_0xd9b4a3=_0x5cb65f(0x1751));if(!confirm(_0xd9b4a3))return;try{if(_0x2e2ed6===_0x5cb65f(0x1490))await db[_0x5cb65f(0x203a)]['delete'](_0x3d8458);else{if(_0x2e2ed6==='core')await db[_0x5cb65f(0x127e)][_0x5cb65f(0x1f4a)](_0x3d8458);else{if(_0x2e2ed6===_0x5cb65f(0x1fc5))await db[_0x5cb65f(0x156f)][_0x5cb65f(0x1f4a)](_0x3d8458);else{if(_0x2e2ed6===_0x5cb65f(0x13ac))await db[_0x5cb65f(0x8ac)]['delete'](_0x3d8458);else{showToast(_0x5cb65f(0x1fe),_0x5cb65f(0x174a));return;}}}}await loadCharacterMemories(),showToast(_0x5cb65f(0xf2d),_0x5cb65f(0x11cb));}catch(_0x14c6ba){console['error'](_0x5cb65f(0x333),_0x14c6ba),showToast(_0x5cb65f(0x1fb4),_0x5cb65f(0x174a));}}let heartrateInterval=null,currentHeartrate=0x48;function updateAiHeartrate(){const _0x38babd=_0x211817,_0x3bbdd8=document[_0x38babd(0x1262)](_0x38babd(0x977));if(!_0x3bbdd8)return;const _0x4b2eef=getCurrentChatSettings();if(!_0x4b2eef[_0x38babd(0x626)]||currentChatCharacter&&currentChatCharacter[_0x38babd(0x1f68)]){hideAiHeartrate();return;}_0x3bbdd8[_0x38babd(0x14eb)]['display']=_0x38babd(0x13de);const _0x4bea0e=(currentChatCharacter[_0x38babd(0x1f0b)]||'')[_0x38babd(0x49e)](),_0x19b288=(currentChatCharacter[_0x38babd(0x1a1c)]||'')[_0x38babd(0x49e)]();let _0x4e3828=0x48;if(_0x4bea0e[_0x38babd(0x1831)]('紧张')||_0x4bea0e[_0x38babd(0x1831)]('害羞')||_0x4bea0e[_0x38babd(0x1831)]('敏感')||_0x4bea0e[_0x38babd(0x1831)]('羞涩')||_0x4bea0e[_0x38babd(0x1831)](_0x38babd(0x4fc))||_0x4bea0e[_0x38babd(0x1831)]('内向'))_0x4e3828=0x55;else{if(_0x4bea0e['includes']('冷静')||_0x4bea0e[_0x38babd(0x1831)]('理性')||_0x4bea0e[_0x38babd(0x1831)]('成熟')||_0x4bea0e[_0x38babd(0x1831)]('沉稳')||_0x4bea0e[_0x38babd(0x1831)]('内敛')||_0x4bea0e[_0x38babd(0x1831)]('严肃'))_0x4e3828=0x41;else{if(_0x4bea0e[_0x38babd(0x1831)]('活泼')||_0x4bea0e['includes']('兴奋')||_0x4bea0e[_0x38babd(0x1831)]('热情')||_0x4bea0e[_0x38babd(0x1831)]('开朗')||_0x4bea0e['includes']('外向')||_0x4bea0e[_0x38babd(0x1831)]('爱笑'))_0x4e3828=0x52;else{if(_0x4bea0e[_0x38babd(0x1831)]('运动')||_0x4bea0e['includes']('健身')||_0x4bea0e[_0x38babd(0x1831)]('体育')||_0x4bea0e[_0x38babd(0x1831)](_0x38babd(0x1647))||_0x4bea0e[_0x38babd(0x1831)]('活跃'))_0x4e3828=0x3a;else{if(_0x4bea0e[_0x38babd(0x1831)]('温柔')||_0x4bea0e[_0x38babd(0x1831)]('甜美')||_0x4bea0e[_0x38babd(0x1831)]('可爱')||_0x4bea0e[_0x38babd(0x1831)]('软萌')||_0x4bea0e[_0x38babd(0x1831)]('小鸟依人')||_0x4bea0e[_0x38babd(0x1831)]('乖巧'))_0x4e3828=0x4b;else{if(_0x4bea0e['includes']('冷酷')||_0x4bea0e[_0x38babd(0x1831)]('高冷')||_0x4bea0e[_0x38babd(0x1831)]('傲娇')||_0x4bea0e[_0x38babd(0x1831)]('女王')||_0x4bea0e[_0x38babd(0x1831)]('强势')||_0x4bea0e[_0x38babd(0x1831)]('霸道'))_0x4e3828=0x44;else{if(_0x4bea0e[_0x38babd(0x1831)]('热血')||_0x4bea0e[_0x38babd(0x1831)]('冲动')||_0x4bea0e[_0x38babd(0x1831)](_0x38babd(0x21ce))||_0x4bea0e[_0x38babd(0x1831)]('火爆')||_0x4bea0e[_0x38babd(0x1831)]('暴躁')||_0x4bea0e['includes']('易怒'))_0x4e3828=0x58;else(_0x4bea0e[_0x38babd(0x1831)]('神秘')||_0x4bea0e[_0x38babd(0x1831)]('深沉')||_0x4bea0e[_0x38babd(0x1831)]('安静')||_0x4bea0e[_0x38babd(0x1831)]('文静')||_0x4bea0e[_0x38babd(0x1831)]('内向'))&&(_0x4e3828=0x46);}}}}}}if(_0x19b288['includes']('小')||_0x19b288[_0x38babd(0x1831)]('萌')||_0x19b288[_0x38babd(0x1831)]('可爱'))_0x4e3828+=0x3;else{if(_0x19b288[_0x38babd(0x1831)]('冰')||_0x19b288[_0x38babd(0x1831)]('雪')||_0x19b288['includes']('静')||_0x19b288['includes']('冷')||_0x19b288[_0x38babd(0x1831)]('凉'))_0x4e3828-=0x5;else(_0x19b288[_0x38babd(0x1831)]('火')||_0x19b288[_0x38babd(0x1831)]('热')||_0x19b288[_0x38babd(0x1831)]('烈'))&&(_0x4e3828+=0x5);}const _0x46ad53=(chatMessages[currentChatCharacter['id']]||[])[_0x38babd(0x6d5)](-0x8);let _0x286ca9=0x0;_0x46ad53[_0x38babd(0x19fb)](_0x1ba38c=>{const _0x101137=_0x38babd;let _0x375079='';if(typeof _0x1ba38c[_0x101137(0x211c)]===_0x101137(0x11b7))_0x375079=_0x1ba38c['content']['toLowerCase']();else Array[_0x101137(0x1496)](_0x1ba38c[_0x101137(0x211c)])?_0x375079='':_0x375079='';(_0x375079['includes']('爱你')||_0x375079['includes'](_0x101137(0x1a1f))||_0x375079[_0x101137(0x1831)](_0x101137(0x16ac))||_0x375079[_0x101137(0x1831)](_0x101137(0xd9a))||_0x375079[_0x101137(0x1831)]('想你')||_0x375079['includes']('想抱你')||_0x375079[_0x101137(0x1831)]('想吻你')||_0x375079[_0x101137(0x1831)]('亲亲')||_0x375079[_0x101137(0x1831)]('抱抱')||_0x375079[_0x101137(0x1831)]('宝贝')||_0x375079[_0x101137(0x1831)]('darling')||_0x375079[_0x101137(0x1831)]('honey')||_0x375079['includes']('亲爱的')||_0x375079[_0x101137(0x1831)](_0x101137(0x9fd))||_0x375079['includes']('需要你')||_0x375079['includes'](_0x101137(0x1506))||_0x375079[_0x101137(0x1831)](_0x101137(0x18e8))||_0x375079[_0x101137(0x1831)](_0x101137(0x1d85)))&&(_0x286ca9+=0xf),(_0x375079[_0x101137(0x1831)]('表白')||_0x375079[_0x101137(0x1831)]('喜欢')||_0x375079[_0x101137(0x1831)]('心动')||_0x375079[_0x101137(0x1831)]('心跳')||_0x375079['includes']('脸红')||_0x375079[_0x101137(0x1831)]('害羞')||_0x375079[_0x101137(0x1831)]('可爱')||_0x375079[_0x101137(0x1831)]('甜')||_0x375079['includes']('温柔')||_0x375079[_0x101137(0x1831)]('美丽')||_0x375079['includes']('漂亮')||_0x375079[_0x101137(0x1831)]('迷人')||_0x375079[_0x101137(0x1831)]('魅力')||_0x375079[_0x101137(0x1831)]('吸引')||_0x375079[_0x101137(0x1831)]('心仪'))&&(_0x286ca9+=0xa),(_0x375079[_0x101137(0x1831)]('撒娇')||_0x375079[_0x101137(0x1831)]('嘤嘤')||_0x375079[_0x101137(0x1831)]('哼')||_0x375079['includes']('人家')||_0x375079['includes']('讨厌')||_0x375079['includes']('不要')||_0x375079[_0x101137(0x1831)]('好不好')||_0x375079[_0x101137(0x1831)]('求你')||_0x375079[_0x101137(0x1831)]('拜托')||_0x375079[_0x101137(0x1831)]('陪我')||_0x375079['includes']('陪陪')||_0x375079[_0x101137(0x1831)]('一起'))&&(_0x286ca9+=0x8),(_0x375079[_0x101137(0x1831)]('开心')||_0x375079['includes']('高兴')||_0x375079['includes']('快乐')||_0x375079[_0x101137(0x1831)]('兴奋')||_0x375079[_0x101137(0x1831)]('激动')||_0x375079[_0x101137(0x1831)]('好棒')||_0x375079[_0x101137(0x1831)]('厉害')||_0x375079[_0x101137(0x1831)]('哇')||_0x375079[_0x101137(0x1831)]('太好了')||_0x375079['includes'](_0x101137(0x1dce))||_0x375079[_0x101137(0x1831)]('wonderful')||_0x375079[_0x101137(0x1831)](_0x101137(0x120d)))&&(_0x286ca9+=0x6),(_0x375079[_0x101137(0x1831)]('难过')||_0x375079[_0x101137(0x1831)]('生气')||_0x375079[_0x101137(0x1831)]('担心')||_0x375079[_0x101137(0x1831)]('害怕')||_0x375079[_0x101137(0x1831)]('紧张')||_0x375079[_0x101137(0x1831)]('焦虑')||_0x375079[_0x101137(0x1831)](_0x101137(0x2039))||_0x375079['includes']('郁闷')||_0x375079[_0x101137(0x1831)]('烦')||_0x375079[_0x101137(0x1831)]('压力')||_0x375079[_0x101137(0x1831)]('累')||_0x375079['includes']('疲惫'))&&(_0x286ca9+=0x8);}),currentHeartrate=Math[_0x38babd(0x658)](0x32,Math[_0x38babd(0x21ff)](0x8c,_0x4e3828+_0x286ca9));if(heartrateInterval)clearInterval(heartrateInterval);heartrateInterval=setInterval(()=>{const _0xb28bd3=_0x38babd,_0x4d3b6b=Math[_0xb28bd3(0x2180)](Math['random']()*0x9)-0x4,_0x13048d=Math[_0xb28bd3(0x658)](0x32,Math['min'](0x8c,currentHeartrate+_0x4d3b6b));_0x3bbdd8[_0xb28bd3(0x1722)]='';if(_0x13048d>=0x6e)_0x3bbdd8[_0xb28bd3(0x1c1b)][_0xb28bd3(0x21e2)](_0xb28bd3(0x15a8));else _0x13048d>=0x5f&&_0x3bbdd8[_0xb28bd3(0x1c1b)][_0xb28bd3(0x21e2)](_0xb28bd3(0x117e));_0x3bbdd8[_0xb28bd3(0x33a)]=_0xb28bd3(0x332)+_0x13048d+_0xb28bd3(0x119e);},0x5dc+Math[_0x38babd(0x11a8)]()*0x3e8),_0x3bbdd8[_0x38babd(0x33a)]=_0x38babd(0x332)+currentHeartrate+_0x38babd(0x119e);}function hideAiHeartrate(){const _0x2971b6=_0x211817,_0x302b6e=document[_0x2971b6(0x1262)]('ai-heartrate-display');_0x302b6e&&(_0x302b6e[_0x2971b6(0x14eb)][_0x2971b6(0x4da)]=_0x2971b6(0x102b)),heartrateInterval&&(clearInterval(heartrateInterval),heartrateInterval=null);}function adjustHeartrateForMessage(_0x6c7402,_0x3e5d47=![]){const _0x16253e=_0x211817;if(!heartrateInterval)return;let _0x22639d=0x0,_0x2729a='',_0x28ca26=0xbb8;if(typeof _0x6c7402===_0x16253e(0x11b7))_0x2729a=_0x6c7402[_0x16253e(0x49e)]();else Array[_0x16253e(0x1496)](_0x6c7402)?_0x2729a='':_0x2729a='';if(_0x3e5d47){if(_0x2729a[_0x16253e(0x1831)]('爱你')||_0x2729a['includes'](_0x16253e(0x1a1f))||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x16ac))||_0x2729a[_0x16253e(0x1831)](_0x16253e(0xd9a))||_0x2729a[_0x16253e(0x1831)]('想你')||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x1a0b))||_0x2729a[_0x16253e(0x1831)]('想吻你')||_0x2729a[_0x16253e(0x1831)]('亲亲')||_0x2729a['includes']('抱抱')||_0x2729a['includes']('宝贝')||_0x2729a[_0x16253e(0x1831)]('darling')||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x22bf))||_0x2729a['includes']('亲爱的')||_0x2729a['includes']('想要你')||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x192b))||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x1506))||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x18e8))||_0x2729a['includes'](_0x16253e(0x1d85)))_0x22639d=0x14,_0x28ca26=0x1f40;else{if(_0x2729a[_0x16253e(0x1831)]('表白')||_0x2729a[_0x16253e(0x1831)]('喜欢')||_0x2729a['includes']('心动')||_0x2729a['includes']('心跳')||_0x2729a[_0x16253e(0x1831)]('脸红')||_0x2729a[_0x16253e(0x1831)]('害羞')||_0x2729a['includes']('可爱')||_0x2729a['includes']('甜')||_0x2729a[_0x16253e(0x1831)]('温柔')||_0x2729a[_0x16253e(0x1831)]('美丽')||_0x2729a[_0x16253e(0x1831)]('漂亮')||_0x2729a[_0x16253e(0x1831)]('迷人')||_0x2729a[_0x16253e(0x1831)]('魅力')||_0x2729a[_0x16253e(0x1831)]('吸引')||_0x2729a[_0x16253e(0x1831)]('心仪'))_0x22639d=0xf,_0x28ca26=0x1770;else{if(_0x2729a[_0x16253e(0x1831)]('撒娇')||_0x2729a[_0x16253e(0x1831)]('嘤嘤')||_0x2729a[_0x16253e(0x1831)]('哼')||_0x2729a['includes']('人家')||_0x2729a[_0x16253e(0x1831)]('讨厌')||_0x2729a[_0x16253e(0x1831)]('不要')||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x879))||_0x2729a[_0x16253e(0x1831)]('求你')||_0x2729a[_0x16253e(0x1831)]('拜托')||_0x2729a[_0x16253e(0x1831)]('陪我')||_0x2729a[_0x16253e(0x1831)]('陪陪')||_0x2729a['includes']('一起'))_0x22639d=0xc,_0x28ca26=0x1388;else{if(_0x2729a[_0x16253e(0x1831)]('开心')||_0x2729a[_0x16253e(0x1831)]('高兴')||_0x2729a[_0x16253e(0x1831)]('快乐')||_0x2729a[_0x16253e(0x1831)]('兴奋')||_0x2729a[_0x16253e(0x1831)]('激动')||_0x2729a[_0x16253e(0x1831)]('好棒')||_0x2729a[_0x16253e(0x1831)]('厉害')||_0x2729a['includes']('哇')||_0x2729a['includes'](_0x16253e(0xc94)))_0x22639d=0x8,_0x28ca26=0xfa0;else{if(_0x2729a[_0x16253e(0x1831)]('生气')||_0x2729a[_0x16253e(0x1831)](_0x16253e(0x2039))||_0x2729a[_0x16253e(0x1831)]('难过')||_0x2729a['includes']('担心')||_0x2729a['includes']('害怕')||_0x2729a['includes']('紧张')||_0x2729a[_0x16253e(0x1831)]('焦虑')||_0x2729a[_0x16253e(0x1831)]('郁闷')||_0x2729a['includes']('烦'))_0x22639d=0xa,_0x28ca26=0x1770;else(_0x2729a[_0x16253e(0x1831)]('你好')||_0x2729a[_0x16253e(0x1831)]('hi')||_0x2729a[_0x16253e(0x1831)]('hello')||_0x2729a['includes'](_0x16253e(0x1299))||_0x2729a['includes']('晚安'))&&(_0x22639d=0x5,_0x28ca26=0xbb8);}}}}}else{if(_0x2729a['includes']('害羞')||_0x2729a[_0x16253e(0x1831)]('脸红')||_0x2729a[_0x16253e(0x1831)]('不好意思'))_0x22639d=0xa,_0x28ca26=0x1388;else{if(_0x2729a['includes']('兴奋')||_0x2729a[_0x16253e(0x1831)]('开心')||_0x2729a['includes']('激动'))_0x22639d=0x8,_0x28ca26=0xfa0;else{if(_0x2729a[_0x16253e(0x1831)]('紧张')||_0x2729a[_0x16253e(0x1831)]('担心')||_0x2729a[_0x16253e(0x1831)]('焦虑'))_0x22639d=0xc,_0x28ca26=0x1770;else(_0x2729a['includes']('爱')||_0x2729a[_0x16253e(0x1831)]('喜欢')||_0x2729a[_0x16253e(0x1831)]('想'))&&(_0x22639d=0xf,_0x28ca26=0x1b58);}}}currentHeartrate=Math[_0x16253e(0x658)](0x37,Math[_0x16253e(0x21ff)](0x82,currentHeartrate+_0x22639d)),setTimeout(()=>{const _0x3ec4a9=_0x16253e,_0x354e03=Math[_0x3ec4a9(0x2180)](_0x22639d*0.6);currentHeartrate=Math[_0x3ec4a9(0x658)](0x41,currentHeartrate-_0x354e03),setTimeout(()=>{const _0x5ef566=_0x3ec4a9,_0x158034=Math[_0x5ef566(0x2180)](_0x22639d*0.3);currentHeartrate=Math['max'](0x41,currentHeartrate-_0x158034);},_0x28ca26*0.5);},_0x28ca26);}async function processAIFriendRequestResponse(_0x36a18f,_0x3ec955){const _0x415911=_0x211817,_0x1030af=characters[_0x415911(0xaf4)](_0x2cc863=>_0x2cc863['id']===_0x36a18f);if(!_0x1030af)return;const _0x41e648='\x0a#\x20指令：好友申请决策\x0a你是\x20'+_0x1030af[_0x415911(0x1a1c)]+_0x415911(0xbc0)+_0x1030af['name']+_0x415911(0x206c)+_0x1030af[_0x415911(0x1f0b)]+_0x415911(0x1653)+(_0x3ec955||_0x415911(0x56d))+'\x22\x0a-\x20用户主动道歉并请求重新做朋友\x0a\x0a##\x20你的任务:\x0a根据你的角色性格、用户的申请理由，以及你对这种情况的态度，决定是否同意重新添加用户为好友。\x0a\x0a考虑因素：\x0a1.\x20你的性格是否容易原谅别人？\x0a2.\x20用户的道歉是否真诚？\x0a3.\x20你是否愿意给对方第二次机会？\x0a4.\x20你当初拉黑的原因是否严重？\x0a\x0a你的回答必须非常简洁，只能是以下两个词之一：\x0a-\x20\x22同意\x22\x20(如果你愿意原谅并重新开始)\x0a-\x20\x22拒绝\x22\x20(如果你还不想原谅或重新联系)\x0a\x0a请现在做出你的决定：\x0a';try{const _0xd5c171=await callChatAPI(_0x41e648,_0x1030af),_0x41c837=Array['isArray'](_0xd5c171)?_0xd5c171[0x0][_0x415911(0x49e)]():_0xd5c171[_0x415911(0x49e)]();console['log']('🤖\x20AI对好友申请的决策:\x20'+_0x41c837);if(_0x41c837['includes']('同意')){await aiUnblockUser(_0x36a18f);const _0x5753fe={'id':_0x415911(0xb7e)+Date['now'](),'sender':_0x415911(0x1744),'content':_0x415911(0x2219),'timestamp':Date[_0x415911(0x2eb)](),'isFriendAddedMessage':!![]};addMessageToChat(_0x5753fe),showToast('✅\x20'+_0x1030af[_0x415911(0x1a1c)]+_0x415911(0x69b),_0x415911(0x11cb));}else{const _0x3cf90a={'id':_0x415911(0xb7e)+Date[_0x415911(0x2eb)](),'sender':_0x415911(0x1744),'content':_0x1030af[_0x415911(0x1a1c)]+_0x415911(0x1f82),'timestamp':Date[_0x415911(0x2eb)]()};addMessageToChat(_0x3cf90a),showToast('❌\x20'+_0x1030af['name']+_0x415911(0x127d),_0x415911(0x1816));}}catch(_0x384960){console['error'](_0x415911(0x19eb),_0x384960),showToast(_0x415911(0x1ed9),_0x415911(0x174a));}}async function aiUnblockUser(_0x482355){const _0x12ed77=_0x211817;try{const _0x37f585=blacklistData[_0x12ed77(0xaf4)](_0x5a74f9=>_0x5a74f9['blockerId']===_0x482355&&_0x5a74f9['blockedId']===_0x12ed77(0xa80)&&!_0x5a74f9[_0x12ed77(0xf55)]);if(!_0x37f585){console[_0x12ed77(0x1f43)](_0x12ed77(0x1f49));return;}_0x37f585[_0x12ed77(0xf55)]=!![],_0x37f585[_0x12ed77(0x10d5)]=new Date()['toISOString'](),await db[_0x12ed77(0x233)][_0x12ed77(0x1561)](_0x37f585),console[_0x12ed77(0x2187)]('✅\x20'+_0x482355+_0x12ed77(0x209f)),currentChatCharacter&&currentChatCharacter['id']===_0x482355&&updateChatBlockedStatus(),renderContactList(),renderMessageList();}catch(_0x49ede7){console['error']('AI解除拉黑失败:',_0x49ede7);}}console[_0x211817(0x2187)](_0x211817(0x228b));async function notifyCharacterBlocked(_0x233d21,_0x3d27c8=''){const _0x35b869=_0x211817;try{const _0x5ba4c0=characters[_0x35b869(0xaf4)](_0x483395=>_0x483395['id']===_0x233d21);if(!_0x5ba4c0)return;const _0x520c8b=_0x35b869(0xcfa)+(_0x3d27c8?_0x35b869(0x3ee)+_0x3d27c8:_0x35b869(0x1c39))+']\x0a\x0a你是'+_0x5ba4c0[_0x35b869(0x1a1c)]+_0x35b869(0x1032)+_0x5ba4c0['bio']+_0x35b869(0xdb0),_0x4b80ce=await generateAIResponse(_0x520c8b,_0x5ba4c0),_0x37fd0d=await parseAiResponse(_0x4b80ce);for(let _0x1ecb32=0x0;_0x1ecb32<_0x37fd0d['length'];_0x1ecb32++){const _0x18dfa2=_0x37fd0d[_0x1ecb32];if(typeof _0x18dfa2===_0x35b869(0x28d)&&_0x18dfa2!==null&&_0x18dfa2[_0x35b869(0x1a4b)]==='block_user')continue;let _0x37da1d;if(typeof _0x18dfa2===_0x35b869(0x11b7))_0x37da1d={'id':(Date[_0x35b869(0x2eb)]()+_0x1ecb32)[_0x35b869(0x1878)](),'sender':'received','content':_0x18dfa2,'timestamp':Date[_0x35b869(0x2eb)]()+_0x1ecb32*0x64,'isBlockReaction':!![]};else{if(typeof _0x18dfa2===_0x35b869(0x28d)&&_0x18dfa2!==null){if(_0x18dfa2['type']==='friend_request')_0x37da1d={'id':(Date[_0x35b869(0x2eb)]()+_0x1ecb32)[_0x35b869(0x1878)](),'sender':_0x35b869(0xb11),'type':_0x35b869(0x2051),'message':_0x18dfa2[_0x35b869(0x1e8e)]||_0x35b869(0x160b),'timestamp':Date[_0x35b869(0x2eb)]()+_0x1ecb32*0x64,'isBlockReaction':!![]};else{const _0x49b9cc=_0x18dfa2[_0x35b869(0x211c)]||_0x18dfa2[_0x35b869(0x1e8e)]||_0x18dfa2[_0x35b869(0x1378)]||'[角色反应]';_0x37da1d={'id':(Date[_0x35b869(0x2eb)]()+_0x1ecb32)[_0x35b869(0x1878)](),'sender':_0x35b869(0xb11),'content':_0x49b9cc,'timestamp':Date[_0x35b869(0x2eb)]()+_0x1ecb32*0x64,'isBlockReaction':!![]};}}}_0x37da1d&&(!chatMessages[_0x233d21]&&(chatMessages[_0x233d21]=[]),chatMessages[_0x233d21]['push'](_0x37da1d),currentChatCharacter&&currentChatCharacter['id']===_0x233d21&&addMessageWithAnimation(_0x37da1d,_0x233d21));}try{await saveChatMessagesImmediate([_0x233d21]),console['log'](_0x35b869(0xaa2));}catch(_0x207015){console[_0x35b869(0x174a)](_0x35b869(0x2218),_0x207015),await saveChatMessages();}console[_0x35b869(0x2187)]('✅\x20'+_0x5ba4c0[_0x35b869(0x1a1c)]+_0x35b869(0x7ce));}catch(_0x3d5c65){console['error'](_0x35b869(0xd88),_0x3d5c65);}}async function notifyCharacterUnblocked(_0x2f9a65){const _0x1f85e2=_0x211817;try{const _0x54c110=characters['find'](_0x294a8e=>_0x294a8e['id']===_0x2f9a65);if(!_0x54c110)return;const _0x436faf=_0x1f85e2(0xc9a)+_0x54c110[_0x1f85e2(0x1a1c)]+'，人设如下：'+_0x54c110[_0x1f85e2(0x1f0b)]+_0x1f85e2(0x142c),_0x525dcd=await callChatAPI(_0x436faf,_0x54c110),_0x2a46d2=await parseAiResponse(_0x525dcd);for(let _0x4e3000=0x0;_0x4e3000<_0x2a46d2[_0x1f85e2(0x19ee)];_0x4e3000++){const _0x1e5696=_0x2a46d2[_0x4e3000];if(typeof _0x1e5696==='object'&&_0x1e5696!==null&&_0x1e5696[_0x1f85e2(0x1a4b)]===_0x1f85e2(0x21f))continue;let _0x3914b4;if(typeof _0x1e5696===_0x1f85e2(0x11b7))_0x3914b4={'id':(Date[_0x1f85e2(0x2eb)]()+_0x4e3000)['toString'](),'sender':'received','content':_0x1e5696,'timestamp':Date[_0x1f85e2(0x2eb)]()+_0x4e3000*0x64,'isUnblockReaction':!![]};else{if(typeof _0x1e5696===_0x1f85e2(0x28d)&&_0x1e5696!==null){const _0x6f1c77=_0x1e5696[_0x1f85e2(0x211c)]||_0x1e5696['message']||_0x1e5696['text']||_0x1f85e2(0xbe3);_0x3914b4={'id':(Date['now']()+_0x4e3000)[_0x1f85e2(0x1878)](),'sender':'received','content':_0x6f1c77,'timestamp':Date[_0x1f85e2(0x2eb)]()+_0x4e3000*0x64,'isUnblockReaction':!![]};}}_0x3914b4&&(!chatMessages[_0x2f9a65]&&(chatMessages[_0x2f9a65]=[]),chatMessages[_0x2f9a65]['push'](_0x3914b4),currentChatCharacter&&currentChatCharacter['id']===_0x2f9a65&&addMessageWithAnimation(_0x3914b4,_0x2f9a65));}try{await saveChatMessagesImmediate([_0x2f9a65]),console[_0x1f85e2(0x2187)](_0x1f85e2(0x2f3));}catch(_0x3bdf84){console[_0x1f85e2(0x174a)](_0x1f85e2(0x1555),_0x3bdf84),await saveChatMessages();}console[_0x1f85e2(0x2187)]('✅\x20'+_0x54c110[_0x1f85e2(0x1a1c)]+_0x1f85e2(0x1535));}catch(_0x2e60b4){console[_0x1f85e2(0x174a)](_0x1f85e2(0x2313),_0x2e60b4);}}console[_0x211817(0x2187)]('🚫\x20角色拉黑/解除拉黑通知功能已加载');async function showInnerThoughtsModal(_0x1f2bd8){const _0x53aed6=_0x211817;if(!_0x1f2bd8)return;const _0x2a5c3f=document[_0x53aed6(0x1262)]('inner-thoughts-modal'),_0x3a293a=document[_0x53aed6(0x1262)]('inner-thoughts-content');_0x2a5c3f[_0x53aed6(0x14eb)][_0x53aed6(0x4da)]=_0x53aed6(0x1fb7);try{const _0x4796f8=await db['innerThoughts'][_0x53aed6(0xb78)](_0x1f2bd8);_0x4796f8?(console['log'](_0x53aed6(0x9a5)),displayInnerThoughts(_0x4796f8[_0x53aed6(0x211c)],_0x1f2bd8)):(console[_0x53aed6(0x2187)](_0x53aed6(0xdf9)),_0x3a293a[_0x53aed6(0x33a)]=_0x53aed6(0x18f7),await generateInnerThoughts(_0x1f2bd8));}catch(_0xe6a201){console['error'](_0x53aed6(0xb79),_0xe6a201),displayInnerThoughtsError(_0x53aed6(0x17e1));}}function hideInnerThoughtsModal(){const _0x4c7710=_0x211817,_0x5adc87=document[_0x4c7710(0x1262)]('inner-thoughts-modal');_0x5adc87[_0x4c7710(0x14eb)][_0x4c7710(0x4da)]='none';}async function generateInnerThoughts(_0x4a02a5,_0x21e489=![]){const _0xa0d75e=_0x211817;try{const _0x22178c=chatMessages[currentChatCharacter['id']]||[],_0x309b74=_0x22178c[_0xa0d75e(0xaf4)](_0x44dfff=>_0x44dfff['id']===_0x4a02a5);if(!_0x309b74||_0x309b74['sender']!==_0xa0d75e(0xb11))throw new Error('无法找到对应的AI消息');let _0x26e8af=currentChatCharacter,_0x1f6227=_0x26e8af['name'];if(_0x26e8af[_0xa0d75e(0x1f68)]&&_0x309b74[_0xa0d75e(0x12c8)]){const _0x118346=_0x26e8af[_0xa0d75e(0x12a6)]['find'](_0x769fea=>_0x769fea['id']===_0x309b74[_0xa0d75e(0x12c8)]);if(_0x118346){const _0x293f2c=characters[_0xa0d75e(0xaf4)](_0x41a202=>_0x41a202['id']===_0x118346['id']);_0x293f2c?(_0x26e8af=_0x293f2c,_0x1f6227=_0x118346['name'],console[_0xa0d75e(0x2187)]('🔍\x20群聊心声\x20-\x20找到角色:\x20'+_0x1f6227+'\x20('+_0x118346['id']+')')):console[_0xa0d75e(0x1f43)](_0xa0d75e(0x132c)+_0x118346['id']);}else throw new Error(_0xa0d75e(0xdd5)+_0x309b74[_0xa0d75e(0x12c8)]);}else{if(_0x26e8af[_0xa0d75e(0x1f68)]&&_0x309b74[_0xa0d75e(0x1a1c)]){const _0x48ae5d=_0x26e8af['members'][_0xa0d75e(0xaf4)](_0x3c8de7=>_0x3c8de7[_0xa0d75e(0x1a1c)]===_0x309b74[_0xa0d75e(0x1a1c)]);if(_0x48ae5d){const _0x46642c=characters['find'](_0x32c9b5=>_0x32c9b5['id']===_0x48ae5d['id']);_0x46642c&&(_0x26e8af=_0x46642c,_0x1f6227=_0x48ae5d[_0xa0d75e(0x1a1c)],console['log'](_0xa0d75e(0x3fb)+_0x1f6227+'\x20('+_0x48ae5d['id']+')'));}else throw new Error(_0xa0d75e(0x13f5)+_0x309b74[_0xa0d75e(0x1a1c)]);}}if(!_0x26e8af)throw new Error('当前角色信息不存在');if(!_0x21e489){const _0x23a1e2=await db['innerThoughts']['get'](_0x4a02a5);if(_0x23a1e2){displayInnerThoughts(_0x23a1e2[_0xa0d75e(0x211c)],_0x4a02a5);return;}}const _0x10ba3a=buildInnerThoughtsPrompt(_0x309b74,_0x26e8af,_0x22178c,{'isGroupChat':currentChatCharacter[_0xa0d75e(0x1f68)],'groupName':currentChatCharacter['isGroup']?currentChatCharacter[_0xa0d75e(0x1a1c)]:null,'characterName':_0x1f6227,'groupMembers':currentChatCharacter[_0xa0d75e(0x1f68)]?currentChatCharacter[_0xa0d75e(0x12a6)]:null}),_0x5336bb=await generateAIResponse(_0x10ba3a,_0x26e8af);if(_0x5336bb&&_0x5336bb['trim']()){const _0x49fef4=_0x5336bb[_0xa0d75e(0x19d7)]();await db[_0xa0d75e(0x1253)]['put']({'id':_0x4a02a5,'messageId':_0x4a02a5,'characterId':_0x26e8af['id'],'content':_0x49fef4,'timestamp':Date['now']()}),console[_0xa0d75e(0x2187)](_0xa0d75e(0x1985)),displayInnerThoughts(_0x49fef4,_0x4a02a5);}else throw new Error(_0xa0d75e(0x905));}catch(_0xf4bfb7){console[_0xa0d75e(0x174a)](_0xa0d75e(0x1796),_0xf4bfb7),displayInnerThoughtsError(_0xf4bfb7[_0xa0d75e(0x1e8e)]);}}function extractMessageText(_0x939565){const _0x268a5e=_0x211817;if(!_0x939565||!_0x939565['content'])return'';if(Array[_0x268a5e(0x1496)](_0x939565[_0x268a5e(0x211c)])){const _0x43895c=_0x939565[_0x268a5e(0x211c)][_0x268a5e(0x1e1f)](_0x4504ea=>_0x4504ea[_0x268a5e(0x1a4b)]===_0x268a5e(0x1378));let _0xaec8e5=_0x43895c[_0x268a5e(0x6a4)](_0x5f53a6=>_0x5f53a6[_0x268a5e(0x1378)])[_0x268a5e(0x122b)]('\x20');const _0x1e8405=_0x939565['content'][_0x268a5e(0x1e1f)](_0x30eab6=>_0x30eab6[_0x268a5e(0x1a4b)]===_0x268a5e(0x910));return _0x1e8405[_0x268a5e(0x19ee)]>0x0&&(_0xaec8e5+='\x20[包含'+_0x1e8405[_0x268a5e(0x19ee)]+'张图片]'),_0xaec8e5;}else return typeof _0x939565[_0x268a5e(0x211c)]===_0x268a5e(0x11b7)?_0x939565['content']:String(_0x939565[_0x268a5e(0x211c)]);}function buildInnerThoughtsPrompt(_0x4b284d,_0x29f67f,_0x4f2477,_0x11235c={}){const _0x3f470c=_0x211817,_0xb5fe96=_0x4f2477[_0x3f470c(0x150c)](_0x3e5037=>_0x3e5037['id']===_0x4b284d['id']),_0x14c5f1=Math[_0x3f470c(0x658)](0x0,_0xb5fe96-0x3),_0x4483e0=Math['min'](_0x4f2477['length'],_0xb5fe96+0x1),_0x8d2781=_0x4f2477[_0x3f470c(0x6d5)](_0x14c5f1,_0x4483e0),_0x23e4dc=_0x8d2781['map'](_0x32e50e=>{const _0x2cc80e=_0x3f470c;if(_0x32e50e['sender']===_0x2cc80e(0x1e6d)){const _0x5bacad=extractMessageText(_0x32e50e);return _0x2cc80e(0x4ec)+_0x5bacad;}else{if(_0x32e50e[_0x2cc80e(0x8a1)]===_0x2cc80e(0xb11)){const _0x39827d=extractMessageText(_0x32e50e);if(_0x11235c[_0x2cc80e(0x16a3)]){let _0xa373f4='未知角色';if(_0x32e50e['senderId']&&_0x11235c['groupMembers']){const _0xce1b8d=_0x11235c[_0x2cc80e(0x2112)][_0x2cc80e(0xaf4)](_0x139bd2=>_0x139bd2['id']===_0x32e50e[_0x2cc80e(0x12c8)]);_0xa373f4=_0xce1b8d?_0xce1b8d['name']:_0x32e50e[_0x2cc80e(0x12c8)];}else _0x32e50e[_0x2cc80e(0x1a1c)]&&(_0xa373f4=_0x32e50e[_0x2cc80e(0x1a1c)]);return _0xa373f4+'：'+_0x39827d;}else return _0x29f67f[_0x2cc80e(0x1a1c)]+'：'+_0x39827d;}}return'';})[_0x3f470c(0x1e1f)](Boolean)[_0x3f470c(0x122b)]('\x0a');let _0x3d6ebd='';_0x11235c[_0x3f470c(0x16a3)]&&(_0x3d6ebd='\x0a\x0a##\x20当前场景：\x0a你现在在群聊\x22'+_0x11235c[_0x3f470c(0x1301)]+_0x3f470c(0xd20)+(_0x11235c[_0x3f470c(0x2112)]?_0x11235c[_0x3f470c(0x2112)][_0x3f470c(0x6a4)](_0x2ba20e=>_0x2ba20e[_0x3f470c(0x1a1c)])[_0x3f470c(0x122b)]('、'):_0x3f470c(0x2306))+_0x3f470c(0x1fc4));const _0x1f30fb=_0x3f470c(0x5b1)+(_0x11235c[_0x3f470c(0xdbc)]||_0x29f67f[_0x3f470c(0x1a1c)])+_0x3f470c(0x15d5)+(_0x29f67f[_0x3f470c(0x1f0b)]||_0x3f470c(0xf76))+_0x3d6ebd+_0x3f470c(0x139e)+_0x23e4dc+_0x3f470c(0x108c)+extractMessageText(_0x4b284d)+_0x3f470c(0x670)+(_0x11235c[_0x3f470c(0x16a3)]?_0x3f470c(0x46a):'')+_0x3f470c(0x4b7);return _0x1f30fb;}function displayInnerThoughts(_0x32ace1,_0x18a401){const _0x5647b9=_0x211817,_0x3db60d=document[_0x5647b9(0x1262)](_0x5647b9(0xfdf)),_0x530336=chatMessages[currentChatCharacter['id']]||[],_0x15db40=_0x530336['find'](_0x276a3d=>_0x276a3d['id']===_0x18a401);let _0x5e0ce3='';if(currentChatCharacter[_0x5647b9(0x1f68)]&&_0x15db40){let _0x33f5ca=_0x5647b9(0x882),_0x32f09c='';if(_0x15db40[_0x5647b9(0x12c8)]){const _0x2f8135=currentChatCharacter[_0x5647b9(0x12a6)][_0x5647b9(0xaf4)](_0x235829=>_0x235829['id']===_0x15db40[_0x5647b9(0x12c8)]);_0x2f8135&&(_0x33f5ca=_0x2f8135[_0x5647b9(0x1a1c)],_0x32f09c=_0x2f8135[_0x5647b9(0x1f8a)]||'');}else _0x15db40['name']&&(_0x33f5ca=_0x15db40['name']);_0x5e0ce3=_0x5647b9(0x22f7)+(_0x32f09c?'<img\x20src=\x22'+_0x32f09c+_0x5647b9(0x222c)+_0x33f5ca+_0x5647b9(0xb3e):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22character-name\x22>'+_0x33f5ca+'的心声</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}_0x3db60d['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5e0ce3+_0x5647b9(0x1c50)+_0x32ace1+_0x5647b9(0xee4);const _0x4c012d=document[_0x5647b9(0xb30)]('.inner-thoughts-refresh-btn');_0x4c012d&&(_0x4c012d[_0x5647b9(0x1f36)]=()=>refreshInnerThoughts(_0x18a401));}async function refreshInnerThoughts(_0x171b38){const _0x5c6ad3=_0x211817;if(!_0x171b38)return;const _0x54816f=document[_0x5c6ad3(0x1262)](_0x5c6ad3(0xfdf));_0x54816f['innerHTML']=_0x5c6ad3(0x21c9);try{await db[_0x5c6ad3(0x1253)][_0x5c6ad3(0x1f4a)](_0x171b38),console[_0x5c6ad3(0x2187)](_0x5c6ad3(0x1472)),await generateInnerThoughts(_0x171b38,!![]);}catch(_0x20eafc){console[_0x5c6ad3(0x174a)]('刷新心声失败:',_0x20eafc),displayInnerThoughtsError(_0x5c6ad3(0x2299));}}function displayInnerThoughtsError(_0x3ad15b){const _0xa764d9=_0x211817,_0x151465=document[_0xa764d9(0x1262)](_0xa764d9(0xfdf));_0x151465[_0xa764d9(0x33a)]=_0xa764d9(0x137d)+_0x3ad15b+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}console['log'](_0x211817(0x15c3)),function fixImportIssues(){const _0x27a52b=_0x211817,_0x5efc54=window['importDataFromFile'];window[_0x27a52b(0x205e)]=function(){const _0xb808ea=_0x27a52b,_0x44ce75=document[_0xb808ea(0xac6)]('input');_0x44ce75[_0xb808ea(0x1a4b)]=_0xb808ea(0x1b7a),_0x44ce75[_0xb808ea(0x1515)]=_0xb808ea(0x1817),_0x44ce75[_0xb808ea(0x1980)]=async function(_0x7f2c59){const _0x393b68=_0xb808ea,_0x3cdb39=_0x7f2c59['target'][_0x393b68(0xf26)][0x0];if(!_0x3cdb39)return;try{showToast(_0x393b68(0x1c4c),_0x393b68(0x477));const _0x4f66f9=await _0x3cdb39[_0x393b68(0x1378)]();let _0x52758f;try{_0x52758f=JSON['parse'](_0x4f66f9);}catch(_0x52394e){throw new Error(_0x393b68(0xad0)+_0x52394e['message']+_0x393b68(0xce8));}if(!_0x52758f||typeof _0x52758f!==_0x393b68(0x28d))throw new Error(_0x393b68(0x1a85));const _0x1453b0=[];if(_0x52758f['characters']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1ac5)+_0x52758f['characters'][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x19a2)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1575)+_0x52758f[_0x393b68(0x19a2)]['length']+'条');if(_0x52758f[_0x393b68(0x1789)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1d21)+_0x52758f[_0x393b68(0x1789)][_0x393b68(0x19ee)]+'个');if(_0x52758f['groupChats']?.[_0x393b68(0x19ee)]){_0x1453b0['push']('群聊:\x20'+_0x52758f['groupChats'][_0x393b68(0x19ee)]+'个');let _0x461eb4=0x0;if(_0x52758f[_0x393b68(0x19a2)]?.['length']&&_0x52758f[_0x393b68(0x1076)]?.['length']){const _0x115e9f=_0x52758f[_0x393b68(0x1076)][_0x393b68(0x6a4)](_0x218313=>_0x218313['id']);_0x461eb4=_0x52758f[_0x393b68(0x19a2)]['filter'](_0x3b7745=>_0x115e9f[_0x393b68(0x1831)](_0x3b7745[_0x393b68(0xaf5)]))[_0x393b68(0x19ee)];}_0x461eb4>0x0&&_0x1453b0['push'](_0x393b68(0x22ac)+_0x461eb4+'条');let _0x51f350=0x0;_0x52758f['groupChats']?.[_0x393b68(0x19ee)]&&_0x52758f[_0x393b68(0x1076)][_0x393b68(0x19fb)](_0x711fb8=>{const _0x3bcbbb=_0x393b68;_0x711fb8[_0x3bcbbb(0x12a6)]&&Array['isArray'](_0x711fb8[_0x3bcbbb(0x12a6)])&&(_0x51f350+=_0x711fb8['members'][_0x3bcbbb(0x19ee)]);}),_0x51f350>0x0&&_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x16f8)+_0x51f350+'个');}if(_0x52758f[_0x393b68(0x1687)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x5be)+_0x52758f[_0x393b68(0x1687)][_0x393b68(0x19ee)]+'条');if(_0x52758f['coreMemories']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1350)+_0x52758f[_0x393b68(0x127e)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x19c1)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x17ef)+_0x52758f[_0x393b68(0x19c1)][_0x393b68(0x19ee)]+'条');if(_0x52758f['episodicMemories']?.['length'])_0x1453b0[_0x393b68(0x1cd6)]('情景记忆:\x20'+_0x52758f[_0x393b68(0x156f)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x112d)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x180a)+_0x52758f[_0x393b68(0x112d)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x203a)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)]('记忆总结:\x20'+_0x52758f[_0x393b68(0x203a)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0xd61)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)]('记忆事件:\x20'+_0x52758f[_0x393b68(0xd61)][_0x393b68(0x19ee)]+'条');if(_0x52758f['crossAppTimeline']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)]('时间线:\x20'+_0x52758f[_0x393b68(0x8ac)][_0x393b68(0x19ee)]+'条');if(_0x52758f['customEmojis']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x6a0)+_0x52758f[_0x393b68(0x223)][_0x393b68(0x19ee)]+'个');if(_0x52758f['recentEmojis']?.['length'])_0x1453b0[_0x393b68(0x1cd6)]('最近表情:\x20'+_0x52758f[_0x393b68(0x1651)][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x13c7)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xd7c)+_0x52758f[_0x393b68(0x13c7)][_0x393b68(0x19ee)]+'个');if(_0x52758f['appIcons']?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1bd7)+_0x52758f['appIcons']['length']+'个');if(_0x52758f[_0x393b68(0x12e9)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x175f)+_0x52758f[_0x393b68(0x12e9)][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x1a86)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x95a)+_0x52758f[_0x393b68(0x1a86)]['length']+'个');if(_0x52758f[_0x393b68(0x1f0c)]?.[_0x393b68(0x19ee)])_0x1453b0['push']('API设置:\x20'+_0x52758f['apiSettings']['length']+'个');if(_0x52758f[_0x393b68(0x181d)]?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0x228)+_0x52758f['globalSettings']['length']+'个');if(_0x52758f[_0x393b68(0x2077)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1cde)+_0x52758f[_0x393b68(0x2077)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x9c7)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x821)+_0x52758f[_0x393b68(0x9c7)]['length']+'条');if(_0x52758f['momentComments']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xd89)+_0x52758f[_0x393b68(0x17d5)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x40a)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x32e)+_0x52758f[_0x393b68(0x40a)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x2147)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)]('论坛:\x20'+_0x52758f['forums']['length']+'个');if(_0x52758f[_0x393b68(0x14c4)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xcda)+_0x52758f[_0x393b68(0x14c4)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x789)]?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0x1a67)+_0x52758f[_0x393b68(0x789)][_0x393b68(0x19ee)]+'条');if(_0x52758f['forumFavorites']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1210)+_0x52758f[_0x393b68(0x145c)][_0x393b68(0x19ee)]+'条');if(_0x52758f['forumPostImages']?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x7d9)+_0x52758f[_0x393b68(0x1867)][_0x393b68(0x19ee)]+'张');if(_0x52758f[_0x393b68(0x481)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xf5a)+_0x52758f['forumMountedWorldbooks'][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x21f8)]?.[_0x393b68(0x19ee)])_0x1453b0['push']('世界书:\x20'+_0x52758f[_0x393b68(0x21f8)]['length']+'个');if(_0x52758f[_0x393b68(0x1a91)]?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0x52f)+_0x52758f['worldbookEntries']['length']+'条');if(_0x52758f[_0x393b68(0x1d0c)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x9ef)+_0x52758f['anniversaries'][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x125e)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xdb3)+_0x52758f[_0x393b68(0x125e)][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x1253)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1f0e)+_0x52758f[_0x393b68(0x1253)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x233)]?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0xf57)+_0x52758f['blacklist']['length']+'条');if(_0x52758f[_0x393b68(0xd7e)]?.['length'])_0x1453b0['push'](_0x393b68(0x181e)+_0x52758f[_0x393b68(0xd7e)][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x123d)]?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0xb71)+_0x52758f[_0x393b68(0x123d)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x793)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x2246)+_0x52758f[_0x393b68(0x793)][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x86e)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xeda)+_0x52758f['offlineHistoryRecords'][_0x393b68(0x19ee)]+'条');if(_0x52758f[_0x393b68(0x1486)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1766)+_0x52758f['offlineUISettings'][_0x393b68(0x19ee)]+'个');if(_0x52758f[_0x393b68(0x17ea)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1354)+_0x52758f[_0x393b68(0x17ea)][_0x393b68(0x19ee)]+'个');if(_0x52758f['musicPlaylist']?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x1e41)+_0x52758f[_0x393b68(0x128d)][_0x393b68(0x19ee)]+'首');if(_0x52758f['musicCovers']?.[_0x393b68(0x19ee)])_0x1453b0['push'](_0x393b68(0xc56)+_0x52758f[_0x393b68(0xe05)]['length']+'个');if(_0x52758f[_0x393b68(0xdaa)]?.[_0x393b68(0x19ee)])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0xa6a)+_0x52758f[_0x393b68(0xdaa)]['length']+'个');if(_0x52758f[_0x393b68(0x1b6a)]?.['length'])_0x1453b0[_0x393b68(0x1cd6)](_0x393b68(0x39d)+_0x52758f[_0x393b68(0x1b6a)][_0x393b68(0x19ee)]+'条');const _0xe5ec76=_0x1453b0[_0x393b68(0x19ee)]?_0x393b68(0xb0b)+_0x1453b0['join']('\x0a')+_0x393b68(0x2a0):_0x393b68(0x1995);if(!confirm(_0xe5ec76))return;showToast(_0x393b68(0x18ce),_0x393b68(0x477));let _0x4879e8=0x0,_0x3bbd49=[];if(_0x52758f[_0x393b68(0x2005)]?.['length'])try{await db[_0x393b68(0x2005)][_0x393b68(0xa4f)]();const _0x43541b=_0x52758f['characters'][_0x393b68(0x1e1f)](_0x439c92=>_0x439c92?.[_0x393b68(0x1a1c)])[_0x393b68(0x6a4)](_0x3e21fd=>({..._0x3e21fd,'id':_0x3e21fd['id']||'char_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9),'groupId':_0x3e21fd[_0x393b68(0x22be)]||_0x393b68(0xa74)}));await db[_0x393b68(0x2005)][_0x393b68(0x1883)](_0x43541b),_0x4879e8++;}catch(_0xa0a50e){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1ac5)+_0xa0a50e[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x19a2)]?.['length'])try{console[_0x393b68(0x2187)](_0x393b68(0x1f1e));let _0x223baa=[];const _0x491600=_0x52758f[_0x393b68(0x19a2)][_0x393b68(0x19fa)](_0x3728a8=>_0x3728a8[_0x393b68(0x1ea3)]);if(_0x491600)_0x223baa=_0x52758f[_0x393b68(0x19a2)][_0x393b68(0x6a4)](_0x469d1c=>({..._0x469d1c,'id':_0x469d1c['id']||_0x393b68(0xf5b)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));else{const _0x1a4b06={};for(const _0x4c3d15 of _0x52758f[_0x393b68(0x19a2)]){if(!_0x4c3d15?.[_0x393b68(0x211c)])continue;const _0x77af8f=_0x4c3d15[_0x393b68(0xaf5)]||_0x393b68(0x1482);!_0x1a4b06[_0x77af8f]&&(_0x1a4b06[_0x77af8f]=[]);const _0x2d5cf6={..._0x4c3d15};_0x4c3d15['replyTo']&&(_0x2d5cf6['replyTo']={'id':_0x4c3d15[_0x393b68(0x1dbe)]['id']||'unknown','content':_0x4c3d15[_0x393b68(0x1dbe)]['content']||_0x393b68(0xa31),'sender':_0x4c3d15[_0x393b68(0x1dbe)][_0x393b68(0x8a1)]||'unknown','senderName':_0x4c3d15[_0x393b68(0x1dbe)][_0x393b68(0x909)]||'未知','timestamp':_0x4c3d15['replyTo'][_0x393b68(0x1716)]||Date[_0x393b68(0x2eb)](),'_fixed':!![]}),_0x1a4b06[_0x77af8f][_0x393b68(0x1cd6)](_0x2d5cf6);}let _0x5cd78e=0x0;for(const [_0xb9f308,_0x549286]of Object['entries'](_0x1a4b06)){for(let _0x5c7a5b=0x0;_0x5c7a5b<_0x549286[_0x393b68(0x19ee)];_0x5c7a5b++){const _0x2e56ea=_0x549286[_0x5c7a5b];_0x223baa[_0x393b68(0x1cd6)]({'id':_0xb9f308+'_'+_0x5cd78e++,'characterId':_0xb9f308,'timestamp':_0x2e56ea[_0x393b68(0x1716)],'messageOrder':_0x5c7a5b,'originalMessageId':_0x2e56ea['id'],'messageData':_0x2e56ea});}}}await db[_0x393b68(0x19a2)][_0x393b68(0xa4f)](),await db[_0x393b68(0x19a2)]['bulkPut'](_0x223baa),_0x4879e8++,console[_0x393b68(0x2187)](_0x393b68(0x721)+_0x223baa[_0x393b68(0x19ee)]+_0x393b68(0x197b));}catch(_0x171fa7){console['error']('❌\x20修复脚本：消息导入失败:',_0x171fa7),_0x3bbd49['push'](_0x393b68(0x1575)+_0x171fa7[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1789)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1789)]['clear']();const _0x45c8e3=_0x52758f[_0x393b68(0x1789)][_0x393b68(0x6a4)](_0x26dc24=>({..._0x26dc24,'id':_0x26dc24['id']||_0x393b68(0x6d7)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1789)][_0x393b68(0x1883)](_0x45c8e3),_0x4879e8++;}catch(_0x49493d){_0x3bbd49['push'](_0x393b68(0x1d21)+_0x49493d[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x127e)]?.['length'])try{await db[_0x393b68(0x127e)][_0x393b68(0xa4f)]();const _0x13b658=_0x52758f[_0x393b68(0x127e)]['map'](_0x383a1c=>({..._0x383a1c,'id':_0x383a1c['id']||_0x393b68(0x77f)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0x127e)][_0x393b68(0x1883)](_0x13b658),_0x4879e8++;}catch(_0x1233c2){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x5be)+_0x1233c2[_0x393b68(0x1e8e)]);}if(_0x52758f['episodicMemories']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x156f)]['clear']();const _0x5ece51=_0x52758f[_0x393b68(0x156f)][_0x393b68(0x6a4)](_0x5c3df3=>({..._0x5c3df3,'id':_0x5c3df3['id']||'episodic_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x156f)][_0x393b68(0x1883)](_0x5ece51),_0x4879e8++;}catch(_0xca661c){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x17ef)+_0xca661c[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x8ac)]?.[_0x393b68(0x19ee)])try{await db['crossAppTimeline'][_0x393b68(0xa4f)]();const _0xbc5908=_0x52758f[_0x393b68(0x8ac)]['map'](_0x439e5b=>({..._0x439e5b,'id':_0x439e5b['id']||_0x393b68(0x8e6)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0x8ac)][_0x393b68(0x1883)](_0xbc5908),_0x4879e8++;}catch(_0x4886bb){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1132)+_0x4886bb[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x223)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x223)][_0x393b68(0x1e1f)](_0x22d6bc=>_0x22d6bc[_0x393b68(0x1a83)]!==![])[_0x393b68(0x1f4a)]();const _0x1c91ed=_0x52758f[_0x393b68(0x223)]['map'](_0x24ec8a=>({..._0x24ec8a,'id':_0x24ec8a['id']||_0x393b68(0x1cb8)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9),'isPersonal':_0x24ec8a[_0x393b68(0x1a83)]!==![]?!![]:![]}));await db[_0x393b68(0x223)]['bulkPut'](_0x1c91ed),_0x4879e8++;}catch(_0x59242b){_0x3bbd49[_0x393b68(0x1cd6)]('表情包:\x20'+_0x59242b[_0x393b68(0x1e8e)]);}if(_0x52758f['personas']?.['length'])try{await db[_0x393b68(0x1a86)][_0x393b68(0xa4f)]();const _0x25d4fc=_0x52758f[_0x393b68(0x1a86)][_0x393b68(0x6a4)](_0x9f368=>({..._0x9f368,'id':_0x9f368['id']||_0x393b68(0x3f2)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0x1a86)]['bulkPut'](_0x25d4fc),_0x4879e8++;}catch(_0x4b22dc){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x95a)+_0x4b22dc[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x9c7)]?.['length'])try{await db[_0x393b68(0x9c7)][_0x393b68(0xa4f)]();const _0x5b5173=_0x52758f[_0x393b68(0x9c7)][_0x393b68(0x6a4)](_0x3dff54=>({..._0x3dff54,'id':_0x3dff54['id']||_0x393b68(0x778)+Date['now']()+'_'+Math['random']()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['moments'][_0x393b68(0x1883)](_0x5b5173),_0x4879e8++;}catch(_0x2b4ac1){_0x3bbd49['push'](_0x393b68(0x821)+_0x2b4ac1[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x17d5)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x17d5)][_0x393b68(0xa4f)]();const _0x564a28=_0x52758f[_0x393b68(0x17d5)][_0x393b68(0x6a4)](_0x147e6d=>({..._0x147e6d,'id':_0x147e6d['id']||_0x393b68(0xcd4)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x17d5)][_0x393b68(0x1883)](_0x564a28),_0x4879e8++;}catch(_0x2e4f47){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xd89)+_0x2e4f47['message']);}if(_0x52758f[_0x393b68(0x2077)]?.['length'])try{await db[_0x393b68(0x2077)][_0x393b68(0xa4f)]();const _0x4e6cda=_0x52758f[_0x393b68(0x2077)]['map'](_0x3b2170=>({..._0x3b2170,'id':_0x3b2170['id']||_0x3b2170[_0x393b68(0xaf5)]+'_'+_0x3b2170['date'],'timestamp':_0x3b2170[_0x393b68(0x1716)]||new Date(_0x3b2170[_0x393b68(0x20d4)])[_0x393b68(0x704)](),'weather':_0x3b2170['weather']||'☀️'}));await db[_0x393b68(0x2077)][_0x393b68(0x1883)](_0x4e6cda),_0x4879e8++;}catch(_0x5d1be8){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1cde)+_0x5d1be8[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x2147)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x2147)][_0x393b68(0xa4f)]();const _0x4babd1=_0x52758f['forums'][_0x393b68(0x6a4)](_0x43d729=>({..._0x43d729,'id':_0x43d729['id']||Date[_0x393b68(0x2eb)]()+Math[_0x393b68(0x2180)](Math[_0x393b68(0x11a8)]()*0x3e8)}));await db['forums'][_0x393b68(0x1883)](_0x4babd1),_0x4879e8++;}catch(_0x280929){_0x3bbd49[_0x393b68(0x1cd6)]('论坛:\x20'+_0x280929['message']);}if(_0x52758f[_0x393b68(0x14c4)]?.['length'])try{await db[_0x393b68(0x14c4)][_0x393b68(0xa4f)]();const _0x2d2a53=_0x52758f[_0x393b68(0x14c4)][_0x393b68(0x6a4)](_0x4d7ac4=>({..._0x4d7ac4,'id':_0x4d7ac4['id']||Date[_0x393b68(0x2eb)]()+Math[_0x393b68(0x2180)](Math[_0x393b68(0x11a8)]()*0x3e8)}));await db[_0x393b68(0x14c4)][_0x393b68(0x1883)](_0x2d2a53),_0x4879e8++;}catch(_0x9f7405){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xcda)+_0x9f7405['message']);}if(_0x52758f['forumReplies']?.[_0x393b68(0x19ee)])try{await db['forumReplies'][_0x393b68(0xa4f)]();const _0xe97b88=_0x52758f[_0x393b68(0x789)][_0x393b68(0x6a4)](_0x5b092b=>({..._0x5b092b,'id':_0x5b092b['id']||Date[_0x393b68(0x2eb)]()+Math[_0x393b68(0x2180)](Math[_0x393b68(0x11a8)]()*0x3e8)}));await db['forumReplies']['bulkPut'](_0xe97b88),_0x4879e8++;}catch(_0xf096d3){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1a67)+_0xf096d3[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x145c)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x145c)][_0x393b68(0xa4f)]();const _0x3393bb=_0x52758f['forumFavorites'][_0x393b68(0x6a4)](_0x5d62f4=>({..._0x5d62f4,'id':_0x5d62f4['id']||Date['now']()+Math[_0x393b68(0x2180)](Math['random']()*0x3e8)}));await db[_0x393b68(0x145c)][_0x393b68(0x1883)](_0x3393bb),_0x4879e8++;}catch(_0x439f9a){_0x3bbd49['push']('论坛收藏:\x20'+_0x439f9a[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1076)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1076)]['clear']();const _0x268407=_0x52758f[_0x393b68(0x1076)][_0x393b68(0x6a4)](_0x8af60c=>({..._0x8af60c,'id':_0x8af60c['id']||_0x393b68(0x121f)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1076)]['bulkPut'](_0x268407),_0x4879e8++,console[_0x393b68(0x2187)](_0x393b68(0x721)+_0x268407['length']+_0x393b68(0x1f35));}catch(_0x47c2d4){console['error']('❌\x20修复脚本：群聊导入失败:',_0x47c2d4),_0x3bbd49['push'](_0x393b68(0x816)+_0x47c2d4[_0x393b68(0x1e8e)]);}if(_0x52758f['worldbooks']?.['length'])try{await db[_0x393b68(0x21f8)][_0x393b68(0xa4f)]();const _0x239b27=_0x52758f[_0x393b68(0x21f8)][_0x393b68(0x6a4)](_0x251db9=>({..._0x251db9,'id':_0x251db9['id']||_0x393b68(0x18f3)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['worldbooks']['bulkPut'](_0x239b27),_0x4879e8++;}catch(_0x4323a0){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1440)+_0x4323a0[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1a91)]?.['length'])try{await db[_0x393b68(0x1a91)][_0x393b68(0xa4f)]();const _0x27a33a=_0x52758f[_0x393b68(0x1a91)][_0x393b68(0x6a4)](_0x16b5f1=>({..._0x16b5f1,'id':_0x16b5f1['id']||_0x393b68(0x358)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1a91)][_0x393b68(0x1883)](_0x27a33a),_0x4879e8++;}catch(_0x2e262c){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x52f)+_0x2e262c[_0x393b68(0x1e8e)]);}if(_0x52758f['workingMemory']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x112d)][_0x393b68(0xa4f)]();const _0xe40610=_0x52758f[_0x393b68(0x112d)][_0x393b68(0x6a4)](_0x40d588=>({..._0x40d588,'id':_0x40d588['id']||_0x393b68(0x324)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db['workingMemory'][_0x393b68(0x1883)](_0xe40610),_0x4879e8++;}catch(_0x4b8a0f){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x180a)+_0x4b8a0f[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x203a)]?.['length'])try{await db['memorySummaries'][_0x393b68(0xa4f)]();const _0x140f95=_0x52758f[_0x393b68(0x203a)][_0x393b68(0x6a4)](_0x2c20fe=>({..._0x2c20fe,'id':_0x2c20fe['id']||_0x393b68(0xab2)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x203a)][_0x393b68(0x1883)](_0x140f95),_0x4879e8++;}catch(_0xa39172){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1ce3)+_0xa39172[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0xd61)]?.['length'])try{await db[_0x393b68(0xd61)][_0x393b68(0xa4f)]();const _0x330a15=_0x52758f[_0x393b68(0xd61)][_0x393b68(0x6a4)](_0x136954=>({..._0x136954,'id':_0x136954['id']||'event_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0xd61)][_0x393b68(0x1883)](_0x330a15),_0x4879e8++;}catch(_0x3f2567){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1230)+_0x3f2567[_0x393b68(0x1e8e)]);}if(_0x52758f['recentEmojis']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1651)][_0x393b68(0xa4f)]();const _0x3bf70e=_0x52758f[_0x393b68(0x1651)][_0x393b68(0x6a4)](_0x480584=>({..._0x480584,'id':_0x480584['id']||_0x393b68(0xf33)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1651)][_0x393b68(0x1883)](_0x3bf70e),_0x4879e8++;}catch(_0x25933c){_0x3bbd49[_0x393b68(0x1cd6)]('最近表情:\x20'+_0x25933c[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x13c7)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x13c7)][_0x393b68(0xa4f)]();const _0x53bb6d=_0x52758f[_0x393b68(0x13c7)][_0x393b68(0x6a4)](_0x2cdbf3=>({..._0x2cdbf3,'id':_0x2cdbf3['id']||_0x393b68(0x1d96)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db['wallpapers'][_0x393b68(0x1883)](_0x53bb6d),_0x4879e8++;}catch(_0x534da3){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xd7c)+_0x534da3[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x11fd)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x11fd)][_0x393b68(0xa4f)]();const _0x2a8c7d=_0x52758f[_0x393b68(0x11fd)][_0x393b68(0x6a4)](_0x4468dc=>({..._0x4468dc,'id':_0x4468dc['id']||_0x393b68(0x1968)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x11fd)][_0x393b68(0x1883)](_0x2a8c7d),_0x4879e8++;}catch(_0x5c1e87){_0x3bbd49[_0x393b68(0x1cd6)]('应用图标:\x20'+_0x5c1e87['message']);}if(_0x52758f[_0x393b68(0x12e9)]?.['length'])try{await db['characterGroups'][_0x393b68(0xa4f)]();const _0x2374a6=_0x52758f['characterGroups'][_0x393b68(0x6a4)](_0x5be3e5=>({..._0x5be3e5,'id':_0x5be3e5['id']||_0x393b68(0xcdf)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['characterGroups'][_0x393b68(0x1883)](_0x2374a6),_0x4879e8++;}catch(_0x2077dd){_0x3bbd49['push'](_0x393b68(0x175f)+_0x2077dd[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1a86)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1a86)][_0x393b68(0xa4f)]();const _0x4d119f=_0x52758f[_0x393b68(0x1a86)][_0x393b68(0x6a4)](_0x5d7a1b=>({..._0x5d7a1b,'id':_0x5d7a1b['id']||_0x393b68(0x3f2)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0x1a86)][_0x393b68(0x1883)](_0x4d119f),_0x4879e8++;}catch(_0x143f8a){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x95a)+_0x143f8a[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1f0c)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1f0c)][_0x393b68(0xa4f)]();const _0xb58afd=_0x52758f[_0x393b68(0x1f0c)][_0x393b68(0x6a4)](_0x427668=>({..._0x427668,'id':_0x427668['id']||'api_'+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db['apiSettings']['bulkPut'](_0xb58afd),_0x4879e8++;}catch(_0x37c265){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1c01)+_0x37c265[_0x393b68(0x1e8e)]);}if(_0x52758f['globalSettings']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x181d)][_0x393b68(0xa4f)]();const _0x1b3860=_0x52758f[_0x393b68(0x181d)][_0x393b68(0x6a4)](_0x1044a9=>({..._0x1044a9,'id':_0x1044a9['id']||_0x393b68(0x1df2)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x181d)][_0x393b68(0x1883)](_0x1b3860),_0x4879e8++;}catch(_0x414172){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x228)+_0x414172[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x40a)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x40a)][_0x393b68(0xa4f)]();const _0x1fa92d=_0x52758f[_0x393b68(0x40a)][_0x393b68(0x6a4)](_0x558292=>({..._0x558292,'id':_0x558292['id']||'like_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x40a)][_0x393b68(0x1883)](_0x1fa92d),_0x4879e8++;}catch(_0x5b0dd5){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x32e)+_0x5b0dd5[_0x393b68(0x1e8e)]);}if(_0x52758f['forumPostImages']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1867)]['clear']();const _0x1c6184=_0x52758f[_0x393b68(0x1867)]['map'](_0x896de=>({..._0x896de,'id':_0x896de['id']||'img_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['forumPostImages'][_0x393b68(0x1883)](_0x1c6184),_0x4879e8++;}catch(_0x453113){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x7d9)+_0x453113['message']);}if(_0x52758f[_0x393b68(0x481)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x481)][_0x393b68(0xa4f)]();const _0x34f9a7=_0x52758f[_0x393b68(0x481)][_0x393b68(0x6a4)](_0x2e854b=>({..._0x2e854b,'id':_0x2e854b['id']||_0x393b68(0x1ef6)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['forumMountedWorldbooks'][_0x393b68(0x1883)](_0x34f9a7),_0x4879e8++;}catch(_0x2a8dfe){_0x3bbd49['push'](_0x393b68(0xf5a)+_0x2a8dfe[_0x393b68(0x1e8e)]);}if(_0x52758f['anniversaries']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1d0c)][_0x393b68(0xa4f)]();const _0x227274=_0x52758f[_0x393b68(0x1d0c)][_0x393b68(0x6a4)](_0x37d81a=>({..._0x37d81a,'id':_0x37d81a['id']||_0x393b68(0x1c06)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0x1d0c)]['bulkPut'](_0x227274),_0x4879e8++;}catch(_0x1850f1){_0x3bbd49['push']('纪念日:\x20'+_0x1850f1[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x125e)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x125e)][_0x393b68(0xa4f)]();const _0x5e1883=_0x52758f[_0x393b68(0x125e)][_0x393b68(0x6a4)](_0x401b0a=>({..._0x401b0a,'id':_0x401b0a['id']||_0x393b68(0x6f1)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x125e)]['bulkPut'](_0x5e1883),_0x4879e8++;}catch(_0x65d7e7){_0x3bbd49[_0x393b68(0x1cd6)]('日记设置:\x20'+_0x65d7e7[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x1253)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x1253)][_0x393b68(0xa4f)]();const _0xa79f93=_0x52758f[_0x393b68(0x1253)][_0x393b68(0x6a4)](_0x21dee1=>({..._0x21dee1,'id':_0x21dee1['id']||_0x393b68(0x1628)+Date['now']()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1253)][_0x393b68(0x1883)](_0xa79f93),_0x4879e8++;}catch(_0x1790ae){_0x3bbd49[_0x393b68(0x1cd6)]('心声:\x20'+_0x1790ae[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x233)]?.[_0x393b68(0x19ee)])try{await db['blacklist'][_0x393b68(0xa4f)]();const _0x54e159=_0x52758f[_0x393b68(0x233)][_0x393b68(0x6a4)](_0x8ec173=>({..._0x8ec173,'id':_0x8ec173['id']||_0x393b68(0xf49)+Date['now']()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x233)][_0x393b68(0x1883)](_0x54e159),_0x4879e8++;}catch(_0x97380d){_0x3bbd49[_0x393b68(0x1cd6)]('拉黑列表:\x20'+_0x97380d[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0xd7e)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0xd7e)][_0x393b68(0xa4f)]();const _0x22fba0=_0x52758f[_0x393b68(0xd7e)][_0x393b68(0x6a4)](_0x472dc2=>({..._0x472dc2,'id':_0x472dc2['id']||_0x393b68(0x15f4)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0xd7e)][_0x393b68(0x1883)](_0x22fba0),_0x4879e8++;}catch(_0x1dcdc1){_0x3bbd49['push'](_0x393b68(0x181e)+_0x1dcdc1[_0x393b68(0x1e8e)]);}if(_0x52758f['friendRequests']?.[_0x393b68(0x19ee)])try{await db['friendRequests'][_0x393b68(0xa4f)]();const _0x3da1a8=_0x52758f['friendRequests'][_0x393b68(0x6a4)](_0x5b5481=>({..._0x5b5481,'id':_0x5b5481['id']||_0x393b68(0x17d3)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x123d)]['bulkPut'](_0x3da1a8),_0x4879e8++;}catch(_0x20aaff){_0x3bbd49[_0x393b68(0x1cd6)]('好友申请:\x20'+_0x20aaff[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x793)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x793)][_0x393b68(0xa4f)]();const _0x29d544=_0x52758f[_0x393b68(0x793)]['map'](_0x16a07c=>({..._0x16a07c,'id':_0x16a07c['id']||'status_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['characterStatus'][_0x393b68(0x1883)](_0x29d544),_0x4879e8++;}catch(_0x28d6a1){_0x3bbd49[_0x393b68(0x1cd6)]('角色状态:\x20'+_0x28d6a1[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x86e)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x86e)][_0x393b68(0xa4f)]();const _0x42ee8d=_0x52758f[_0x393b68(0x86e)][_0x393b68(0x6a4)](_0x1e604f=>({..._0x1e604f,'id':_0x1e604f['id']||_0x393b68(0x1f29)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x86e)][_0x393b68(0x1883)](_0x42ee8d),_0x4879e8++;}catch(_0x4ff3ad){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xeda)+_0x4ff3ad[_0x393b68(0x1e8e)]);}if(_0x52758f['offlineUISettings']?.['length'])try{await db[_0x393b68(0x1486)][_0x393b68(0xa4f)]();const _0xbcb127=_0x52758f[_0x393b68(0x1486)][_0x393b68(0x6a4)](_0x3b0a82=>({..._0x3b0a82,'id':_0x3b0a82['id']||_0x393b68(0x216f)+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0x1486)]['bulkPut'](_0xbcb127),_0x4879e8++;}catch(_0x2e3d84){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1766)+_0x2e3d84[_0x393b68(0x1e8e)]);}if(_0x52758f[_0x393b68(0x17ea)]?.['length'])try{await db[_0x393b68(0x17ea)][_0x393b68(0xa4f)]();const _0x2d2cbf=_0x52758f['offlinePresets'][_0x393b68(0x6a4)](_0x89cd80=>({..._0x89cd80,'id':_0x89cd80['id']||'preset_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db['offlinePresets']['bulkPut'](_0x2d2cbf),_0x4879e8++;}catch(_0x40ef9b){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x1354)+_0x40ef9b[_0x393b68(0x1e8e)]);}if(_0x52758f['musicPlaylist']?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0x128d)][_0x393b68(0xa4f)]();const _0x2baa80=_0x52758f[_0x393b68(0x128d)]['map'](_0x416fce=>({..._0x416fce,'id':_0x416fce['id']||_0x393b68(0x1f3)+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()['toString'](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['musicPlaylist']['bulkPut'](_0x2baa80),_0x4879e8++;}catch(_0xff8d56){_0x3bbd49[_0x393b68(0x1cd6)]('音乐:\x20'+_0xff8d56['message']);}if(_0x52758f[_0x393b68(0xe05)]?.[_0x393b68(0x19ee)])try{await db['musicCovers'][_0x393b68(0xa4f)]();const _0x44dced=_0x52758f[_0x393b68(0xe05)]['map'](_0x567e12=>({..._0x567e12,'id':_0x567e12['id']||'cover_'+Date[_0x393b68(0x2eb)]()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db[_0x393b68(0xe05)][_0x393b68(0x1883)](_0x44dced),_0x4879e8++;}catch(_0x2767fd){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xc56)+_0x2767fd['message']);}if(_0x52758f[_0x393b68(0xdaa)]?.[_0x393b68(0x19ee)])try{await db[_0x393b68(0xdaa)]['clear']();const _0x2761ef=_0x52758f[_0x393b68(0xdaa)][_0x393b68(0x6a4)](_0x507262=>({..._0x507262,'id':_0x507262['id']||_0x393b68(0x1e17)+Date['now']()+'_'+Math['random']()[_0x393b68(0x1878)](0x24)['substr'](0x2,0x9)}));await db[_0x393b68(0xdaa)][_0x393b68(0x1883)](_0x2761ef),_0x4879e8++;}catch(_0x18834b){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0xa6a)+_0x18834b[_0x393b68(0x1e8e)]);}if(_0x52758f['smsMessages']?.['length'])try{await db[_0x393b68(0x1b6a)][_0x393b68(0xa4f)]();const _0x13df56=_0x52758f[_0x393b68(0x1b6a)][_0x393b68(0x6a4)](_0x1c31e7=>({..._0x1c31e7,'id':_0x1c31e7['id']||'smsg_'+Date[_0x393b68(0x2eb)]()+'_'+Math[_0x393b68(0x11a8)]()[_0x393b68(0x1878)](0x24)[_0x393b68(0x15fb)](0x2,0x9)}));await db['smsMessages']['bulkPut'](_0x13df56),_0x4879e8++;}catch(_0x2c4b71){_0x3bbd49[_0x393b68(0x1cd6)](_0x393b68(0x39d)+_0x2c4b71[_0x393b68(0x1e8e)]);}await loadCharacters(),await loadChatMessages(),await loadChatSettings(),await loadGroupChats(),await loadWorldbooks(),renderCharacterList(),renderMessageList();try{await renderForumArchives(),renderWorldbookList();}catch(_0x493f77){console['error'](_0x393b68(0x15ac),_0x493f77);}const _0x5abba1=_0x4879e8>0x0?_0x393b68(0x1a24)+_0x4879e8+'\x20项'+(_0x3bbd49[_0x393b68(0x19ee)]?_0x393b68(0x14a6)+_0x3bbd49[_0x393b68(0x19ee)]+_0x393b68(0x265):''):_0x393b68(0x108a)+_0x3bbd49[_0x393b68(0x122b)]('\x0a');showToast(_0x5abba1,_0x4879e8>0x0?'success':_0x393b68(0x174a));}catch(_0x4c92ee){showToast(_0x393b68(0x956)+_0x4c92ee['message'],'error'),_0x4c92ee[_0x393b68(0x1e8e)]['includes'](_0x393b68(0x1793))&&setTimeout(()=>alert(_0x393b68(0x10a1)),0x3e8);}},_0x44ce75['click']();};}(),function fixReplyIssues(){const _0x2a4f9d=_0x211817,_0x571316=window[_0x2a4f9d(0x1ad)];window[_0x2a4f9d(0x1ad)]=function(_0x588416){const _0x527e3a=_0x2a4f9d;if(!_0x588416)return'';let _0x5f2a99={'id':_0x588416['id']||'unknown','senderName':_0x588416[_0x527e3a(0x909)]||'未知','content':_0x588416[_0x527e3a(0x211c)]||'[已删除]'};if(_0x588416['id']!==_0x527e3a(0x1482)&&currentChatCharacter){const _0x590817=chatMessages[currentChatCharacter['id']]||[],_0x49171c=_0x590817[_0x527e3a(0xaf4)](_0x3664a0=>_0x3664a0['id']===_0x588416['id']);if(_0x49171c){if(Array[_0x527e3a(0x1496)](_0x49171c[_0x527e3a(0x211c)])){const _0xfd3adb=_0x49171c[_0x527e3a(0x211c)][_0x527e3a(0xaf4)](_0x4b74ca=>_0x4b74ca['type']===_0x527e3a(0x1378)),_0x5980e4=_0x49171c['content'][_0x527e3a(0xaf4)](_0x466a6d=>_0x466a6d['type']===_0x527e3a(0x910));if(_0xfd3adb?.['text'])_0x5f2a99[_0x527e3a(0x211c)]=_0xfd3adb[_0x527e3a(0x1378)];else _0x5980e4?_0x5f2a99[_0x527e3a(0x211c)]=_0x527e3a(0x1bb6):_0x5f2a99['content']=_0x527e3a(0x1ced);}else _0x5f2a99['content']=_0x49171c[_0x527e3a(0x211c)]||_0x527e3a(0x1bb6);_0x5f2a99[_0x527e3a(0x909)]=getSenderDisplayName(_0x49171c);}}const _0x11e967=truncateText(_0x5f2a99['content'],0x14);return _0x527e3a(0x1d66)+_0x5f2a99['id']+_0x527e3a(0x4e9)+_0x5f2a99['senderName']+_0x527e3a(0x268)+_0x11e967+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';};}();async function diagnoseDatabaseIssue(){const _0x20a2a9=_0x211817;try{console[_0x20a2a9(0x2187)](_0x20a2a9(0x1c2));if(!db){console['error'](_0x20a2a9(0x5bd));return;}const _0x3d0e02=[_0x20a2a9(0x8ac),_0x20a2a9(0xd61),'characterStatus'];for(const _0x557bb8 of _0x3d0e02){if(db[_0x557bb8]){console[_0x20a2a9(0x2187)]('✅\x20表\x20'+_0x557bb8+_0x20a2a9(0x19b));try{const _0x535367=await db[_0x557bb8][_0x20a2a9(0xc44)]();console[_0x20a2a9(0x2187)](_0x20a2a9(0x1bf)+_0x557bb8+'\x20记录数:\x20'+_0x535367);}catch(_0x525f8c){console[_0x20a2a9(0x174a)](_0x20a2a9(0x2098)+_0x557bb8+_0x20a2a9(0xecb),_0x525f8c);}}else console[_0x20a2a9(0x174a)](_0x20a2a9(0x67b)+_0x557bb8+_0x20a2a9(0x1872));}const _0x5298e3={'id':_0x20a2a9(0x8c5)+Date[_0x20a2a9(0x2eb)](),'characterId':_0x20a2a9(0x168a),'appType':_0x20a2a9(0x11b8),'action':_0x20a2a9(0x19e4),'timestamp':Date[_0x20a2a9(0x2eb)](),'context':{'test':!![]},'messageId':null};try{await db[_0x20a2a9(0x8ac)][_0x20a2a9(0x21e2)](_0x5298e3),console[_0x20a2a9(0x2187)](_0x20a2a9(0x90a)),await db[_0x20a2a9(0x8ac)]['delete'](_0x5298e3['id']),console[_0x20a2a9(0x2187)](_0x20a2a9(0x15f9));}catch(_0x37185a){console[_0x20a2a9(0x174a)](_0x20a2a9(0x513),_0x37185a);}}catch(_0x35876b){console[_0x20a2a9(0x174a)](_0x20a2a9(0x1113),_0x35876b);}}setTimeout(()=>{diagnoseDatabaseIssue();},0x1388);async function emergencyDataRecovery(){const _0x303f8f=_0x211817;console[_0x303f8f(0x2187)](_0x303f8f(0x1e9));try{const _0x414bf9=await db['characters']['toArray'](),_0x2fab95=await db['chatMessages'][_0x303f8f(0xf13)](),_0x2ce84b=await db[_0x303f8f(0x1404)][_0x303f8f(0xf13)]();console['log'](_0x303f8f(0x1fe5),_0x414bf9),console['log'](_0x303f8f(0x19c6),_0x2fab95),console[_0x303f8f(0x2187)](_0x303f8f(0x14ba),_0x2ce84b);const _0x5c57a1=localStorage['getItem']('characters'),_0x524ef6=localStorage['getItem']('chatMessages'),_0xd5b377=localStorage['getItem'](_0x303f8f(0x1404));return console[_0x303f8f(0x2187)](_0x303f8f(0x1dd3),_0x5c57a1?JSON[_0x303f8f(0x22d3)](_0x5c57a1):null),console[_0x303f8f(0x2187)](_0x303f8f(0x1fe0),_0x524ef6?JSON[_0x303f8f(0x22d3)](_0x524ef6):null),console[_0x303f8f(0x2187)](_0x303f8f(0x11fc),_0xd5b377?JSON[_0x303f8f(0x22d3)](_0xd5b377):null),{'indexedDB':{'characters':_0x414bf9,'chatMessages':_0x2fab95,'contacts':_0x2ce84b},'localStorage':{'characters':_0x5c57a1?JSON[_0x303f8f(0x22d3)](_0x5c57a1):null,'chatMessages':_0x524ef6?JSON[_0x303f8f(0x22d3)](_0x524ef6):null,'contacts':_0xd5b377?JSON[_0x303f8f(0x22d3)](_0xd5b377):null}};}catch(_0x4e4c6d){return console['error'](_0x303f8f(0x1fbd),_0x4e4c6d),null;}}async function recoverFromExportData(_0x1984be){const _0x3350b4=_0x211817;try{console[_0x3350b4(0x2187)](_0x3350b4(0x223f));if(_0x1984be['characters']&&_0x1984be[_0x3350b4(0x2005)][_0x3350b4(0x19ee)]>0x0){const _0xc57274=_0x1984be['characters'][_0x3350b4(0x1e1f)](_0x3f8947=>_0x3f8947[_0x3350b4(0x1a1c)]!=='张三'&&_0x3f8947['name']!=='李四');console[_0x3350b4(0x2187)](_0x3350b4(0x2152),_0xc57274),await safeDataSave(_0x3350b4(0x2005),_0xc57274),characters=_0xc57274;const _0x4a6750=_0xc57274[_0x3350b4(0x6a4)](_0x1966cf=>_0x1966cf['id']);contacts=_0x4a6750,await saveContacts(),console['log']('角色数据恢复完成');}if(_0x1984be[_0x3350b4(0x19a2)]){await db[_0x3350b4(0x19a2)]['clear']();for(const [_0x1815ed,_0x541c22]of Object[_0x3350b4(0x2bc)](_0x1984be[_0x3350b4(0x19a2)])){if(_0x541c22&&_0x541c22[_0x3350b4(0x19ee)]>0x0)for(const _0x41bf9d of _0x541c22){await db[_0x3350b4(0x19a2)][_0x3350b4(0x21e2)]({'characterId':_0x1815ed,..._0x41bf9d});}}chatMessages=_0x1984be[_0x3350b4(0x19a2)],console[_0x3350b4(0x2187)](_0x3350b4(0x2dd));}return renderCharacterList(),renderContactList(),renderMessageList(),showToast(_0x3350b4(0x1d9f),_0x3350b4(0x11cb)),!![];}catch(_0x2bc8f9){return console[_0x3350b4(0x174a)](_0x3350b4(0x26b),_0x2bc8f9),showToast(_0x3350b4(0x1613)+_0x2bc8f9[_0x3350b4(0x1e8e)],_0x3350b4(0x174a)),![];}}function addRecoveryLog(_0x384195){const _0x4c5e32=_0x211817,_0x574933=document['getElementById'](_0x4c5e32(0x1940)),_0xfcb88f=document[_0x4c5e32(0x1262)](_0x4c5e32(0x1c5f));if(_0x574933&&_0xfcb88f){_0x574933[_0x4c5e32(0x14eb)][_0x4c5e32(0x4da)]=_0x4c5e32(0x13de);const _0x4fb5bb=new Date()['toLocaleTimeString']();_0xfcb88f['innerHTML']+='['+_0x4fb5bb+']\x20'+_0x384195+'\x0a',_0xfcb88f[_0x4c5e32(0x98c)]=_0xfcb88f[_0x4c5e32(0xfe3)];}}async function checkDataStatus(){const _0x42773d=_0x211817;addRecoveryLog(_0x42773d(0x1c8e));try{const _0x373ddc=await db[_0x42773d(0x2005)]['toArray'](),_0x4911bd=await db[_0x42773d(0x19a2)][_0x42773d(0xf13)](),_0x471915=await db[_0x42773d(0x1404)][_0x42773d(0xf13)](),_0x4c2381=localStorage['getItem'](_0x42773d(0x2005)),_0xf65746=localStorage['getItem']('chatMessages'),_0x38559b=localStorage['getItem'](_0x42773d(0x1404)),_0x47133b=_0x42773d(0x22bd)+_0x373ddc[_0x42773d(0x19ee)]+'\x0a-\x20聊天记录:\x20'+_0x4911bd[_0x42773d(0x19ee)]+_0x42773d(0x17a8)+_0x471915[_0x42773d(0x19ee)]+_0x42773d(0x880)+(_0x4c2381?JSON[_0x42773d(0x22d3)](_0x4c2381)['length']:0x0)+_0x42773d(0x29e)+(_0xf65746?Object[_0x42773d(0x1c9f)](JSON['parse'](_0xf65746))[_0x42773d(0x19ee)]:0x0)+'\x20个对话\x0a-\x20联系人备份:\x20'+(_0x38559b?JSON[_0x42773d(0x22d3)](_0x38559b)[_0x42773d(0x19ee)]:0x0)+'\x20个\x0a\x0a🔍\x20当前内存状态：\x0a-\x20角色列表:\x20'+characters['length']+_0x42773d(0x1f08)+contacts[_0x42773d(0x19ee)]+_0x42773d(0x9ca)+Object['keys'](chatMessages)[_0x42773d(0x19ee)]+'\x20个对话\x0a\x0a⚠️\x20异常角色检测：\x0a'+(_0x373ddc['filter'](_0x99c6fe=>_0x99c6fe[_0x42773d(0x1a1c)]==='张三'||_0x99c6fe['name']==='李四')[_0x42773d(0x6a4)](_0x417f21=>'-\x20'+_0x417f21[_0x42773d(0x1a1c)]+_0x42773d(0x1d3e)+_0x417f21['id']+')')[_0x42773d(0x122b)]('\x0a')||'未发现异常角色')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';document[_0x42773d(0x1262)](_0x42773d(0x460))[_0x42773d(0x14eb)]['display']=_0x42773d(0x13de),document[_0x42773d(0x1262)]('data-status-text')[_0x42773d(0x13be)]=_0x47133b,addRecoveryLog(_0x42773d(0xbd1));}catch(_0x1f7f16){addRecoveryLog(_0x42773d(0x12d9)+_0x1f7f16['message']);}}async function deepDataSearch(){const _0x19f76b=_0x211817;addRecoveryLog('开始深度搜索残留数据...');try{const _0x4e4971=[];addRecoveryLog(_0x19f76b(0x1885));for(let _0x2268ea=0x0;_0x2268ea<localStorage[_0x19f76b(0x19ee)];_0x2268ea++){const _0x2ec2c6=localStorage[_0x19f76b(0x213c)](_0x2268ea);if(_0x2ec2c6&&(_0x2ec2c6[_0x19f76b(0x1831)](_0x19f76b(0x1dbb))||_0x2ec2c6[_0x19f76b(0x1831)](_0x19f76b(0x1a70)))){const _0x2bdf19=localStorage['getItem'](_0x2ec2c6);if(_0x2bdf19&&_0x2bdf19[_0x19f76b(0x19ee)]>0x64){_0x4e4971['push'](_0x19f76b(0x17c8)+_0x2ec2c6+_0x19f76b(0x5a0)+_0x2bdf19[_0x19f76b(0x19ee)]+_0x19f76b(0x1cd0));if(_0x2ec2c6===_0x19f76b(0x1a73))_0x4e4971['push']('\x20\x20⚠️\x20发现全局紧急备份！这可能包含重要的聊天设置数据'),_0x4e4971[_0x19f76b(0x1cd6)](_0x19f76b(0xc0e));else{if(_0x2ec2c6['startsWith'](_0x19f76b(0xc3e))){const _0x4fb539=_0x2ec2c6['replace'](_0x19f76b(0xc3e),'');_0x4e4971[_0x19f76b(0x1cd6)](_0x19f76b(0x149c)+_0x4fb539+_0x19f76b(0x1b27)),_0x4e4971['push'](_0x19f76b(0xc0e));}}}}}addRecoveryLog(_0x19f76b(0xe71));const _0x18547b=[_0x19f76b(0x2005),_0x19f76b(0x19a2),_0x19f76b(0x1404),_0x19f76b(0x1789),_0x19f76b(0x223),_0x19f76b(0x21f8),_0x19f76b(0x9c7),'personas',_0x19f76b(0x1076)];for(const _0x3cb03f of _0x18547b){try{const _0x1acfd0=await db[_0x3cb03f][_0x19f76b(0xf13)]();_0x1acfd0['length']>0x0&&(_0x4e4971['push'](_0x19f76b(0x55a)+_0x3cb03f+_0x19f76b(0x5a0)+_0x1acfd0[_0x19f76b(0x19ee)]+_0x19f76b(0x834)),_0x3cb03f===_0x19f76b(0x2005)&&_0x1acfd0[_0x19f76b(0x19fb)](_0xb96150=>{const _0x1c8dba=_0x19f76b;_0xb96150[_0x1c8dba(0x1a1c)]!=='张三'&&_0xb96150[_0x1c8dba(0x1a1c)]!=='李四'&&_0x4e4971[_0x1c8dba(0x1cd6)](_0x1c8dba(0x1a4d)+_0xb96150['name']+_0x1c8dba(0x1d3e)+_0xb96150['id']+')');}));}catch(_0x30d930){}}addRecoveryLog(_0x19f76b(0x210e));const _0xc683cf=await db[_0x19f76b(0x19a2)][_0x19f76b(0xf13)](),_0x4ba127=new Set();_0xc683cf[_0x19f76b(0x19fb)](_0x3e8fa2=>{const _0xd87c5c=_0x19f76b;_0x3e8fa2[_0xd87c5c(0xaf5)]&&_0x3e8fa2[_0xd87c5c(0xaf5)]!==_0xd87c5c(0xa80)&&_0x4ba127[_0xd87c5c(0x21e2)](_0x3e8fa2['characterId']);});_0x4ba127[_0x19f76b(0x2d8)]>0x0&&(_0x4e4971['push'](_0x19f76b(0x19ac)+_0x4ba127[_0x19f76b(0x2d8)]+_0x19f76b(0x9b3)),_0x4ba127['forEach'](_0x38dbaa=>{const _0x2ffd4a=_0x19f76b;_0x4e4971[_0x2ffd4a(0x1cd6)](_0x2ffd4a(0x105f)+_0x38dbaa);}));const _0x16eccd=_0x4e4971[_0x19f76b(0x19ee)]>0x0?_0x4e4971[_0x19f76b(0x122b)]('\x0a'):_0x19f76b(0x783);document[_0x19f76b(0x1262)](_0x19f76b(0x1204))[_0x19f76b(0x14eb)]['display']=_0x19f76b(0x13de),document[_0x19f76b(0x1262)](_0x19f76b(0x1278))[_0x19f76b(0x13be)]=_0x16eccd;const _0x2abbf7=localStorage[_0x19f76b(0x15d8)]('chatSettings_emergency_backup'),_0x5c5d85=Object[_0x19f76b(0x1c9f)](localStorage)[_0x19f76b(0x19fa)](_0x583380=>_0x583380[_0x19f76b(0x1b30)](_0x19f76b(0xc3e)));if(_0x2abbf7||_0x5c5d85){const _0x3f8fd6=document[_0x19f76b(0xac6)]('button');_0x3f8fd6[_0x19f76b(0x13be)]=_0x19f76b(0x222b),_0x3f8fd6['style']['cssText']=_0x19f76b(0xbda),_0x3f8fd6[_0x19f76b(0x1f36)]=()=>restoreEmergencyBackup();const _0x1ae3cb=document[_0x19f76b(0x1262)](_0x19f76b(0x1204)),_0x5a46c0=_0x1ae3cb[_0x19f76b(0xb30)](_0x19f76b(0xca7));if(_0x5a46c0)_0x5a46c0[_0x19f76b(0x1493)]();_0x1ae3cb[_0x19f76b(0x497)](_0x3f8fd6);}addRecoveryLog(_0x19f76b(0x13e9)+_0x4e4971[_0x19f76b(0x19ee)]+_0x19f76b(0x1a93));}catch(_0x553270){addRecoveryLog(_0x19f76b(0x2151)+_0x553270[_0x19f76b(0x1e8e)]);}}async function restoreEmergencyBackup(){const _0xba68c5=_0x211817;addRecoveryLog(_0xba68c5(0x1e0a));try{let _0x3a1685={},_0xa79b76=0x0;const _0x3a7dfb=localStorage[_0xba68c5(0x15d8)](_0xba68c5(0x1a73));if(_0x3a7dfb)try{const _0x332f91=JSON[_0xba68c5(0x22d3)](_0x3a7dfb);Object['assign'](_0x3a1685,_0x332f91),_0xa79b76++,addRecoveryLog(_0xba68c5(0x1c3d)+Object[_0xba68c5(0x1c9f)](_0x332f91)[_0xba68c5(0x19ee)]+_0xba68c5(0x121d));}catch(_0x45ca7d){addRecoveryLog(_0xba68c5(0xd66)+_0x45ca7d['message']);}Object['keys'](localStorage)['forEach'](_0x3cff13=>{const _0x2238d8=_0xba68c5;if(_0x3cff13['startsWith'](_0x2238d8(0xc3e))){const _0x1781b4=_0x3cff13[_0x2238d8(0xe16)](_0x2238d8(0xc3e),'');try{const _0x5041b8=JSON[_0x2238d8(0x22d3)](localStorage['getItem'](_0x3cff13));_0x3a1685[_0x1781b4]=_0x5041b8,_0xa79b76++,addRecoveryLog('✅\x20发现聊天'+_0x1781b4+_0x2238d8(0x19d4));}catch(_0x8e5cdc){addRecoveryLog(_0x2238d8(0x147f)+_0x1781b4+'的紧急备份数据格式错误:\x20'+_0x8e5cdc[_0x2238d8(0x1e8e)]);}}});if(Object[_0xba68c5(0x1c9f)](_0x3a1685)[_0xba68c5(0x19ee)]===0x0){addRecoveryLog(_0xba68c5(0x554)),showToast(_0xba68c5(0x503),_0xba68c5(0x174a));return;}addRecoveryLog(_0xba68c5(0x1ba1)+_0xa79b76+_0xba68c5(0x656)+Object[_0xba68c5(0x1c9f)](_0x3a1685)[_0xba68c5(0x19ee)]+_0xba68c5(0x121d));let _0x2ccbff=0x0;Object[_0xba68c5(0x1c9f)](_0x3a1685)[_0xba68c5(0x19fb)](_0x4cce5b=>{const _0x3f46df=_0xba68c5;_0x3a1685[_0x4cce5b]&&typeof _0x3a1685[_0x4cce5b]===_0x3f46df(0x28d)&&(!chatSettings&&(chatSettings={}),chatSettings[_0x4cce5b]={...chatSettings[_0x4cce5b],..._0x3a1685[_0x4cce5b]},_0x2ccbff++,addRecoveryLog(_0x3f46df(0xdee)+_0x4cce5b));});try{await saveChatSettings(),addRecoveryLog(_0xba68c5(0x53f)+_0x2ccbff+_0xba68c5(0x2094)),showToast(_0xba68c5(0x2309)+_0x2ccbff+_0xba68c5(0x121d),'success');}catch(_0x1cf620){addRecoveryLog(_0xba68c5(0x4de)+_0x1cf620[_0xba68c5(0x1e8e)]),showToast(_0xba68c5(0x115e),_0xba68c5(0x1816));}const _0x42ef4c=Object[_0xba68c5(0x1c9f)](_0x3a1685)[_0xba68c5(0x6a4)](_0x2b7109=>{const _0x151c61=_0xba68c5,_0xdeb8c0=_0x3a1685[_0x2b7109],_0x3909c2=[];if(_0xdeb8c0[_0x151c61(0x1813)])_0x3909c2['push'](_0x151c61(0xa70)+_0xdeb8c0['bubbleStyle']);if(_0xdeb8c0[_0x151c61(0x179f)])_0x3909c2[_0x151c61(0x1cd6)](_0x151c61(0x1a9b));if(_0xdeb8c0['myChatAvatar'])_0x3909c2['push'](_0x151c61(0x2ab));if(_0xdeb8c0[_0x151c61(0x159c)])_0x3909c2[_0x151c61(0x1cd6)](_0x151c61(0x792));if(_0xdeb8c0['fontSize'])_0x3909c2[_0x151c61(0x1cd6)](_0x151c61(0x41f)+_0xdeb8c0['fontSize']);return _0x151c61(0x755)+_0x2b7109+_0x151c61(0x2222)+_0x3909c2[_0x151c61(0x122b)]('\x0a\x20\x20-\x20');})[_0xba68c5(0x122b)]('\x0a\x0a');document[_0xba68c5(0x1262)](_0xba68c5(0x1278))[_0xba68c5(0x13be)]=_0xba68c5(0x754)+_0xa79b76+_0xba68c5(0x15b3)+_0x2ccbff+_0xba68c5(0x31a)+_0x42ef4c+'\x0a\x0a💡\x20建议：刷新页面以确保所有设置生效',addRecoveryLog(_0xba68c5(0x122c));}catch(_0x358071){addRecoveryLog(_0xba68c5(0x27f)+_0x358071[_0xba68c5(0x1e8e)]),showToast(_0xba68c5(0xb9c),_0xba68c5(0x174a)),console[_0xba68c5(0x174a)](_0xba68c5(0x1f5),_0x358071);}}async function searchChatHistory(){const _0x5f214b=_0x211817;addRecoveryLog(_0x5f214b(0x98f));try{const _0x51bea1=await db[_0x5f214b(0x19a2)][_0x5f214b(0xf13)](),_0x1e158d=new Map();_0x51bea1[_0x5f214b(0x19fb)](_0x2501ab=>{const _0x35110a=_0x5f214b;if(_0x2501ab[_0x35110a(0xaf5)]&&_0x2501ab[_0x35110a(0xaf5)]!==_0x35110a(0xa80)){!_0x1e158d[_0x35110a(0x975)](_0x2501ab['characterId'])&&_0x1e158d[_0x35110a(0x83c)](_0x2501ab[_0x35110a(0xaf5)],{'id':_0x2501ab['characterId'],'messageCount':0x0,'lastMessage':null,'firstMessage':null});const _0x224154=_0x1e158d['get'](_0x2501ab[_0x35110a(0xaf5)]);_0x224154[_0x35110a(0x356)]++,(!_0x224154['firstMessage']||_0x2501ab[_0x35110a(0x1716)]<_0x224154['firstMessage']['timestamp'])&&(_0x224154[_0x35110a(0x1bb1)]=_0x2501ab),(!_0x224154[_0x35110a(0x189d)]||_0x2501ab[_0x35110a(0x1716)]>_0x224154[_0x35110a(0x189d)]['timestamp'])&&(_0x224154[_0x35110a(0x189d)]=_0x2501ab);}});let _0xa72c22=_0x5f214b(0xefb);_0x1e158d[_0x5f214b(0x2d8)]===0x0?_0xa72c22+=_0x5f214b(0x2192):(_0xa72c22+=_0x5f214b(0x11b0)+_0x1e158d[_0x5f214b(0x2d8)]+'\x20个角色的聊天记录:\x0a\x0a',_0x1e158d[_0x5f214b(0x19fb)]((_0x4d2e75,_0x1e7d42)=>{const _0x311a3e=_0x5f214b;_0xa72c22+=_0x311a3e(0x22e5)+_0x1e7d42+'\x0a',_0xa72c22+='消息数量:\x20'+_0x4d2e75[_0x311a3e(0x356)]+_0x311a3e(0x1658),_0xa72c22+=_0x311a3e(0x23d)+new Date(_0x4d2e75[_0x311a3e(0x1bb1)][_0x311a3e(0x1716)])[_0x311a3e(0xecc)]()+'\x0a',_0xa72c22+=_0x311a3e(0x1616)+new Date(_0x4d2e75[_0x311a3e(0x189d)][_0x311a3e(0x1716)])[_0x311a3e(0xecc)]()+'\x0a',_0xa72c22+=_0x311a3e(0x16ca)+_0x4d2e75['lastMessage'][_0x311a3e(0x211c)]?.[_0x311a3e(0x17ca)](0x0,0x32)+_0x311a3e(0x18d3);}),_0xa72c22+=_0x5f214b(0x19d8)),document[_0x5f214b(0x1262)](_0x5f214b(0x1204))[_0x5f214b(0x14eb)][_0x5f214b(0x4da)]='block',document[_0x5f214b(0x1262)](_0x5f214b(0x1278))[_0x5f214b(0x13be)]=_0xa72c22,addRecoveryLog(_0x5f214b(0x2047));}catch(_0x287279){addRecoveryLog('聊天记录分析失败:\x20'+_0x287279['message']);}}async function rebuildCharactersFromChat(){const _0x327623=_0x211817;addRecoveryLog('开始从聊天记录重建角色...');try{const _0x19b83e=await db[_0x327623(0x19a2)][_0x327623(0xf13)](),_0x8b08c9=new Map();_0x19b83e[_0x327623(0x19fb)](_0x47223a=>{const _0x3ccf21=_0x327623;if(_0x47223a[_0x3ccf21(0xaf5)]&&_0x47223a[_0x3ccf21(0xaf5)]!==_0x3ccf21(0xa80)){!_0x8b08c9[_0x3ccf21(0x975)](_0x47223a[_0x3ccf21(0xaf5)])&&_0x8b08c9[_0x3ccf21(0x83c)](_0x47223a['characterId'],{'id':_0x47223a[_0x3ccf21(0xaf5)],'messages':[],'firstMessage':null,'lastMessage':null});const _0xb087a2=_0x8b08c9[_0x3ccf21(0xb78)](_0x47223a[_0x3ccf21(0xaf5)]);_0xb087a2['messages'][_0x3ccf21(0x1cd6)](_0x47223a),(!_0xb087a2['firstMessage']||_0x47223a[_0x3ccf21(0x1716)]<_0xb087a2[_0x3ccf21(0x1bb1)][_0x3ccf21(0x1716)])&&(_0xb087a2[_0x3ccf21(0x1bb1)]=_0x47223a),(!_0xb087a2[_0x3ccf21(0x189d)]||_0x47223a[_0x3ccf21(0x1716)]>_0xb087a2[_0x3ccf21(0x189d)]['timestamp'])&&(_0xb087a2[_0x3ccf21(0x189d)]=_0x47223a);}}),addRecoveryLog(_0x327623(0x11b0)+_0x8b08c9[_0x327623(0x2d8)]+_0x327623(0x1aa));const _0x5f39a9=[];let _0x287b99=0x0;for(const [_0x33ec18,_0x3d02d8]of _0x8b08c9){if(_0x33ec18==='张三'||_0x33ec18==='李四')continue;let _0x1d3734='角色_'+_0x33ec18['slice'](-0x4);const _0x5e8b39=_0x3d02d8[_0x327623(0x1828)][_0x327623(0x6d5)](0x0,0x14),_0x57eae2=_0x5e8b39[_0x327623(0x1e1f)](_0x5edb5b=>_0x5edb5b[_0x327623(0x8a1)]===_0x327623(0x1e6d));for(const _0x3e6d5f of _0x57eae2){const _0x58ce10=_0x3e6d5f[_0x327623(0x211c)]||'',_0x543c56=[/(?:你好|嗨|hi|hello)[，,\s]*([^\s，,。！？]{1,8})/i,/([^\s，,。！？]{1,8})[，,\s]*(?:你好|在吗|在不在)/i,/^([^\s，,。！？]{1,8})[，,\s]/,/叫你([^\s，,。！？]{1,8})/i];for(const _0x95794d of _0x543c56){const _0x1de87b=_0x58ce10[_0x327623(0x1b87)](_0x95794d);if(_0x1de87b&&_0x1de87b[0x1]&&_0x1de87b[0x1][_0x327623(0x19ee)]<=0x8&&_0x1de87b[0x1][_0x327623(0x19ee)]>=0x2){_0x1d3734=_0x1de87b[0x1];break;}}if(_0x1d3734!=='角色_'+_0x33ec18['slice'](-0x4))break;}if(_0x1d3734===_0x327623(0xe1b)+_0x33ec18[_0x327623(0x6d5)](-0x4)){const _0x2d25fc=_0x5e8b39[_0x327623(0x1e1f)](_0x1415d7=>_0x1415d7['sender']===_0x327623(0x1dbb));for(const _0x2cf074 of _0x2d25fc[_0x327623(0x6d5)](0x0,0x5)){const _0x2864da=_0x2cf074[_0x327623(0x211c)]||'',_0x28ac81=[/我是([^\s，,。！？]{1,8})/i,/我叫([^\s，,。！？]{1,8})/i,/叫我([^\s，,。！？]{1,8})/i,/^([^\s，,。！？]{1,8})(?:在这里|来了|回来了)/i];for(const _0x2a091c of _0x28ac81){const _0x50c0fd=_0x2864da['match'](_0x2a091c);if(_0x50c0fd&&_0x50c0fd[0x1]&&_0x50c0fd[0x1][_0x327623(0x19ee)]<=0x8&&_0x50c0fd[0x1][_0x327623(0x19ee)]>=0x2){_0x1d3734=_0x50c0fd[0x1];break;}}if(_0x1d3734!==_0x327623(0xe1b)+_0x33ec18['slice'](-0x4))break;}}const _0x3a4982={'id':_0x33ec18,'name':_0x1d3734,'description':_0x327623(0x830)+_0x3d02d8[_0x327623(0x1828)][_0x327623(0x19ee)]+_0x327623(0x730),'personality':'温和友善，善于交流','scenario':'日常聊天场景','firstMessage':_0x3d02d8['firstMessage']?.[_0x327623(0x211c)]||'你好！','avatar':'','createdAt':_0x3d02d8['firstMessage']?.[_0x327623(0x1716)]||Date[_0x327623(0x2eb)](),'updatedAt':_0x3d02d8[_0x327623(0x189d)]?.[_0x327623(0x1716)]||Date['now'](),'tags':[_0x327623(0xacf)],'isPublic':![],'messageCount':_0x3d02d8[_0x327623(0x1828)][_0x327623(0x19ee)]};_0x5f39a9['push'](_0x3a4982),_0x287b99++,addRecoveryLog(_0x327623(0x2161)+_0x1d3734+'\x20(ID:\x20'+_0x33ec18[_0x327623(0x6d5)](-0x6)+'...)');}if(_0x5f39a9[_0x327623(0x19ee)]===0x0)throw new Error(_0x327623(0xeaa));await safeDataSave('characters',_0x5f39a9),characters=_0x5f39a9,contacts=_0x5f39a9[_0x327623(0x6a4)](_0x570a62=>_0x570a62['id']),await saveContacts(),await loadCharacters(),await loadContacts(),await loadChatMessages(),renderCharacterList(),renderContactList(),renderMessageList();if(currentCharacterId){const _0x51207f=characters[_0x327623(0xaf4)](_0x175247=>_0x175247['id']===currentCharacterId);_0x51207f&&renderChatHeader();}addRecoveryLog(_0x327623(0x1c6d)+_0x287b99+_0x327623(0x14be)),addRecoveryLog(_0x327623(0x1887)+_0x5f39a9['map'](_0x1694d5=>_0x1694d5[_0x327623(0x1a1c)])['join'](',\x20')),alert(_0x327623(0x13b9)+_0x287b99+'\x20个角色，聊天记录已保留。\x0a\x0a恢复的角色:\x20'+_0x5f39a9['map'](_0x540dfc=>_0x540dfc[_0x327623(0x1a1c)])[_0x327623(0x122b)](',\x20'));}catch(_0x5a55be){addRecoveryLog(_0x327623(0x1285)+_0x5a55be[_0x327623(0x1e8e)]),alert(_0x327623(0x1703)+_0x5a55be[_0x327623(0x1e8e)]);}}async function showManualRebuild(){const _0x2d5be5=_0x211817;try{const _0x20cb8c=await db[_0x2d5be5(0x19a2)]['toArray'](),_0x3da2d8=new Map();_0x20cb8c[_0x2d5be5(0x19fb)](_0x572ee6=>{const _0xdc81df=_0x2d5be5;if(_0x572ee6[_0xdc81df(0xaf5)]&&_0x572ee6[_0xdc81df(0xaf5)]!==_0xdc81df(0xa80)&&_0x572ee6[_0xdc81df(0xaf5)]!=='张三'&&_0x572ee6[_0xdc81df(0xaf5)]!=='李四'){!_0x3da2d8[_0xdc81df(0x975)](_0x572ee6['characterId'])&&_0x3da2d8[_0xdc81df(0x83c)](_0x572ee6[_0xdc81df(0xaf5)],{'id':_0x572ee6['characterId'],'messageCount':0x0,'lastMessage':null});const _0x1d5eb9=_0x3da2d8[_0xdc81df(0xb78)](_0x572ee6[_0xdc81df(0xaf5)]);_0x1d5eb9[_0xdc81df(0x356)]++,(!_0x1d5eb9[_0xdc81df(0x189d)]||_0x572ee6[_0xdc81df(0x1716)]>_0x1d5eb9[_0xdc81df(0x189d)]['timestamp'])&&(_0x1d5eb9[_0xdc81df(0x189d)]=_0x572ee6);}});if(_0x3da2d8['size']===0x0){alert(_0x2d5be5(0x213a));return;}let _0x2a8bec=_0x2d5be5(0x1375);_0x2a8bec+=_0x2d5be5(0x144f),_0x3da2d8['forEach']((_0x32aba0,_0x2b7101)=>{const _0x1c568a=_0x2d5be5,_0xc64314=_0x2b7101[_0x1c568a(0x6d5)](-0x6),_0x26948f=_0x32aba0[_0x1c568a(0x189d)]?.[_0x1c568a(0x211c)]?.[_0x1c568a(0x17ca)](0x0,0x1e)||'';_0x2a8bec+=_0x1c568a(0x143f)+_0xc64314+_0x1c568a(0x1a17)+_0x32aba0[_0x1c568a(0x356)]+_0x1c568a(0x6b4)+_0x26948f+_0x1c568a(0x1381)+_0x2b7101+_0x1c568a(0x14ef)+_0x2b7101+_0x1c568a(0x4a5);}),_0x2a8bec+=_0x2d5be5(0x1844),_0x2a8bec+=_0x2d5be5(0x74a),document[_0x2d5be5(0x1262)](_0x2d5be5(0x1204))[_0x2d5be5(0x14eb)][_0x2d5be5(0x4da)]=_0x2d5be5(0x13de),document[_0x2d5be5(0x1262)](_0x2d5be5(0x1278))[_0x2d5be5(0x33a)]=_0x2a8bec,window['manualRebuildInfo']=_0x3da2d8;}catch(_0x326448){alert(_0x2d5be5(0x1d1d)+_0x326448[_0x2d5be5(0x1e8e)]);}}async function debugCurrentState(){const _0x520d06=_0x211817;addRecoveryLog(_0x520d06(0x521));try{addRecoveryLog(_0x520d06(0x21f0)+characters['length']),addRecoveryLog(_0x520d06(0x38c)+contacts['length']);characters[_0x520d06(0x19ee)]>0x0&&(addRecoveryLog(_0x520d06(0x1c32)),characters[_0x520d06(0x19fb)](_0x19bb20=>{const _0x5a83ba=_0x520d06;addRecoveryLog(_0x5a83ba(0x189)+_0x19bb20[_0x5a83ba(0x1a1c)]+_0x5a83ba(0x1d3e)+_0x19bb20['id'][_0x5a83ba(0x6d5)](-0x6)+_0x5a83ba(0x1073));}));const _0x26bd9a=await db[_0x520d06(0x2005)]['toArray'](),_0x37163b=await db[_0x520d06(0x1404)][_0x520d06(0xf13)](),_0x4f3a9f=await db[_0x520d06(0x19a2)][_0x520d06(0xf13)]();addRecoveryLog('数据库中角色数量:\x20'+_0x26bd9a[_0x520d06(0x19ee)]),addRecoveryLog(_0x520d06(0x2136)+_0x37163b[_0x520d06(0x19ee)]),addRecoveryLog(_0x520d06(0x353)+_0x4f3a9f[_0x520d06(0x19ee)]);_0x26bd9a[_0x520d06(0x19ee)]>0x0&&(addRecoveryLog(_0x520d06(0x147d)),_0x26bd9a[_0x520d06(0x19fb)](_0x45485e=>{const _0x3d2112=_0x520d06;addRecoveryLog('\x20\x20-\x20'+_0x45485e['name']+_0x3d2112(0x1d3e)+_0x45485e['id'][_0x3d2112(0x6d5)](-0x6)+_0x3d2112(0x1073));}));const _0x2ee0e0=document[_0x520d06(0x1262)]('character-list'),_0xe9d1e2=document[_0x520d06(0x1262)](_0x520d06(0x1838));addRecoveryLog('角色列表元素存在:\x20'+!!_0x2ee0e0),addRecoveryLog(_0x520d06(0x2208)+!!_0xe9d1e2),_0x2ee0e0&&addRecoveryLog(_0x520d06(0x12a7)+_0x2ee0e0['children']['length']),_0xe9d1e2&&addRecoveryLog(_0x520d06(0x1b10)+_0xe9d1e2[_0x520d06(0xe48)][_0x520d06(0x19ee)]),addRecoveryLog(_0x520d06(0xf15)+currentPage),addRecoveryLog('当前角色ID:\x20'+(currentCharacterId||'无')),addRecoveryLog(_0x520d06(0x692));}catch(_0x246215){addRecoveryLog(_0x520d06(0x20ed)+_0x246215[_0x520d06(0x1e8e)]);}}async function forceRefreshAll(){const _0x565a2c=_0x211817;addRecoveryLog('开始强制刷新所有界面...');try{await loadCharacters(),await loadContacts(),await loadChatMessages(),addRecoveryLog('重新加载后角色数量:\x20'+characters['length']),addRecoveryLog('重新加载后联系人数量:\x20'+contacts[_0x565a2c(0x19ee)]),renderCharacterList(),renderContactList(),renderMessageList();if(currentPage===_0x565a2c(0x1a70)&&currentCharacterId){const _0x4eb931=characters[_0x565a2c(0xaf4)](_0x11fa8b=>_0x11fa8b['id']===currentCharacterId);_0x4eb931?(renderChatHeader(),renderChatMessages()):hideApp(_0x565a2c(0xcf2));}currentPage==='characters'&&renderCharacterList(),addRecoveryLog(_0x565a2c(0x16c2)),alert(_0x565a2c(0xeb7));}catch(_0x4ac82f){addRecoveryLog(_0x565a2c(0x6fd)+_0x4ac82f[_0x565a2c(0x1e8e)]),alert(_0x565a2c(0x6fd)+_0x4ac82f['message']);}}async function executeManualRebuild(){const _0x5d8767=_0x211817;try{const _0x3a4f0a=[];for(const [_0x462cb7,_0x2e1b3]of window['manualRebuildInfo']){const _0x854c9a=document[_0x5d8767(0x1262)](_0x5d8767(0x103f)+_0x462cb7),_0xa43ece=document[_0x5d8767(0x1262)](_0x5d8767(0x2100)+_0x462cb7);if(_0x854c9a&&_0x854c9a[_0x5d8767(0x14c1)]){const _0x2b6e0d=_0xa43ece['value'][_0x5d8767(0x19d7)]()||_0x5d8767(0xe1b)+_0x462cb7[_0x5d8767(0x6d5)](-0x4),_0x16754f={'id':_0x462cb7,'name':_0x2b6e0d,'description':'手动重建的角色，共有\x20'+_0x2e1b3[_0x5d8767(0x356)]+'\x20条对话记录','personality':'请根据聊天记录调整性格设定','scenario':_0x5d8767(0x10fc),'firstMessage':_0x2e1b3[_0x5d8767(0x189d)]?.[_0x5d8767(0x211c)]||_0x5d8767(0xdab),'avatar':'','createdAt':Date[_0x5d8767(0x2eb)]()-0x5265c00,'updatedAt':Date[_0x5d8767(0x2eb)](),'tags':[_0x5d8767(0x1c54)],'isPublic':![],'messageCount':_0x2e1b3[_0x5d8767(0x356)]};_0x3a4f0a['push'](_0x16754f);}}if(_0x3a4f0a[_0x5d8767(0x19ee)]===0x0){alert(_0x5d8767(0x1b61));return;}await safeDataSave(_0x5d8767(0x2005),_0x3a4f0a),characters=_0x3a4f0a,contacts=_0x3a4f0a[_0x5d8767(0x6a4)](_0x2a3d8b=>_0x2a3d8b['id']),await saveContacts(),renderCharacterList(),renderContactList(),addRecoveryLog(_0x5d8767(0x895)+_0x3a4f0a[_0x5d8767(0x19ee)]+_0x5d8767(0x7a8)),alert(_0x5d8767(0x1bc4)+_0x3a4f0a[_0x5d8767(0x19ee)]+_0x5d8767(0x870)),document[_0x5d8767(0x1262)](_0x5d8767(0x1204))[_0x5d8767(0x14eb)][_0x5d8767(0x4da)]=_0x5d8767(0x102b);}catch(_0x5a4b1f){alert(_0x5d8767(0x95f)+_0x5a4b1f[_0x5d8767(0x1e8e)]);}}async function recoverFromFile(){const _0x507dc1=_0x211817,_0x24f520=document['getElementById'](_0x507dc1(0x19c9)),_0x1a0583=_0x24f520[_0x507dc1(0xf26)][0x0];if(!_0x1a0583){alert('请先选择一个备份文件');return;}try{addRecoveryLog(_0x507dc1(0xf23)+_0x1a0583[_0x507dc1(0x1a1c)]+'\x20('+(_0x1a0583[_0x507dc1(0x2d8)]/0x400/0x400)[_0x507dc1(0x13ad)](0x2)+_0x507dc1(0xc0d));const _0x4f1b52=await _0x1a0583[_0x507dc1(0x1378)](),_0x51c577=JSON[_0x507dc1(0x22d3)](_0x4f1b52);if(!_0x51c577['characters']||!Array['isArray'](_0x51c577[_0x507dc1(0x2005)]))throw new Error('文件格式不正确，缺少角色信息');addRecoveryLog('文件中发现\x20'+_0x51c577[_0x507dc1(0x2005)][_0x507dc1(0x19ee)]+_0x507dc1(0x7a8));const _0x3d6672=_0x51c577['characters']['filter'](_0x362d13=>_0x362d13['name']!=='张三'&&_0x362d13['name']!=='李四');addRecoveryLog(_0x507dc1(0x20b7)+_0x3d6672[_0x507dc1(0x19ee)]+'\x20个');if(_0x3d6672[_0x507dc1(0x19ee)]===0x0)throw new Error(_0x507dc1(0x2043));await safeDataSave('characters',_0x3d6672),characters=_0x3d6672;const _0x5bd0da=_0x3d6672[_0x507dc1(0x6a4)](_0x5ef156=>_0x5ef156['id']);contacts=_0x5bd0da,await saveContacts(),addRecoveryLog('角色数据恢复完成');if(_0x51c577[_0x507dc1(0x19a2)]){await db['chatMessages']['clear']();let _0x25990f=0x0;for(const [_0x567d56,_0x1d78d7]of Object[_0x507dc1(0x2bc)](_0x51c577[_0x507dc1(0x19a2)])){if(_0x1d78d7&&_0x1d78d7[_0x507dc1(0x19ee)]>0x0)for(const _0xc56b47 of _0x1d78d7){await db['chatMessages']['add']({'characterId':_0x567d56,..._0xc56b47}),_0x25990f++;}}chatMessages=_0x51c577[_0x507dc1(0x19a2)],addRecoveryLog(_0x507dc1(0x536)+_0x25990f+_0x507dc1(0x197b));}renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog(_0x507dc1(0xd07)),alert('数据恢复成功！您的角色和聊天记录已恢复。');}catch(_0x522dc4){addRecoveryLog(_0x507dc1(0x1479)+_0x522dc4[_0x507dc1(0x1e8e)]),alert(_0x507dc1(0x20a2)+_0x522dc4[_0x507dc1(0x1e8e)]);}}async function cleanupBadData(){const _0x3bdf82=_0x211817;try{addRecoveryLog(_0x3bdf82(0x1b1a));const _0x65ac94=await db[_0x3bdf82(0x2005)][_0x3bdf82(0xa24)](_0x3bdf82(0x1a1c))[_0x3bdf82(0x1fa1)](['张三','李四'])[_0x3bdf82(0x1f4a)]();addRecoveryLog(_0x3bdf82(0xdd9)+_0x65ac94+_0x3bdf82(0x1dd4)),characters=characters[_0x3bdf82(0x1e1f)](_0x140961=>_0x140961['name']!=='张三'&&_0x140961[_0x3bdf82(0x1a1c)]!=='李四'),contacts=contacts[_0x3bdf82(0x1e1f)](_0x40217e=>{const _0x5c69af=_0x3bdf82,_0x5f4a08=characters['find'](_0x1a5ffe=>_0x1a5ffe['id']===_0x40217e);return _0x5f4a08&&_0x5f4a08[_0x5c69af(0x1a1c)]!=='张三'&&_0x5f4a08['name']!=='李四';}),await saveContacts(),renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog(_0x3bdf82(0x1ad5)),alert(_0x3bdf82(0x7dd));}catch(_0x3825b3){addRecoveryLog(_0x3bdf82(0x133b)+_0x3825b3['message']),alert(_0x3bdf82(0x1ef8)+_0x3825b3[_0x3bdf82(0x1e8e)]);}}async function forceReload(){const _0x1fccd1=_0x211817;try{addRecoveryLog(_0x1fccd1(0x66a)),await loadCharacterGroups(),await loadCharacters(),await loadContacts(),await loadChatMessages(),await loadChatSettings(),await loadPersonas(),await loadGroupChats(),renderCharacterList(),renderContactList(),renderMessageList(),addRecoveryLog('✅\x20数据重新加载完成'),alert(_0x1fccd1(0x52d));}catch(_0x23705f){addRecoveryLog('❌\x20重新加载失败:\x20'+_0x23705f[_0x1fccd1(0x1e8e)]),alert(_0x1fccd1(0x1d5d)+_0x23705f[_0x1fccd1(0x1e8e)]);}}let isOfflineMode=![],offlinePresets=[],currentOfflinePreset=null,offlineMessages=[],windowId=null;function initializeWindowId(){const _0x20a644=_0x211817;windowId=sessionStorage[_0x20a644(0x15d8)](_0x20a644(0x72a)),!windowId&&(windowId='window_'+Date['now']()+'_'+Math[_0x20a644(0x11a8)]()[_0x20a644(0x1878)](0x24)['substr'](0x2,0x9),sessionStorage['setItem'](_0x20a644(0x72a),windowId)),console[_0x20a644(0x2187)](_0x20a644(0x1aa2),windowId);}function toggleOfflineMode(){const _0x3dbe62=_0x211817;if(!currentChatCharacter){showToast(_0x3dbe62(0x1346),'warning');return;}offlineMessages=[],isOfflineMode=!isOfflineMode;const _0x50e1b5=document[_0x3dbe62(0x1262)]('offline-mode-overlay'),_0x112e4f=document['getElementById'](_0x3dbe62(0x17dc)),_0xbd33e1=document[_0x3dbe62(0x1262)](_0x3dbe62(0xcf2)),_0x58630d=document[_0x3dbe62(0x1262)](_0x3dbe62(0xf67));isOfflineMode?(_0x50e1b5[_0x3dbe62(0x14eb)][_0x3dbe62(0x4da)]='flex',_0x112e4f[_0x3dbe62(0x1722)]=_0x3dbe62(0x17b7),_0xbd33e1[_0x3dbe62(0x1c1b)]['add'](_0x3dbe62(0xbaf)),_0x58630d&&currentChatCharacter&&(_0x58630d['textContent']=currentChatCharacter['name']),pauseProactiveChatTimer(currentChatCharacter['id']),loadOfflineMessages(),loadAndApplyOfflineUISettings(),showToast('已进入线下剧情模式',_0x3dbe62(0x11cb))):exitOfflineMode();}function exitOfflineMode(){const _0x5f5366=_0x211817;offlineMessages[_0x5f5366(0x19ee)]>0x0?showOfflineExitModal():doExitOfflineMode();}function showOfflineExitModal(){const _0x4e6c9f=_0x211817,_0x3eccbb=document[_0x4e6c9f(0xac6)](_0x4e6c9f(0xbbc));_0x3eccbb[_0x4e6c9f(0x1722)]=_0x4e6c9f(0x2092),_0x3eccbb[_0x4e6c9f(0x14eb)][_0x4e6c9f(0x4da)]='flex',_0x3eccbb['style']['zIndex']='10001',_0x3eccbb[_0x4e6c9f(0x33a)]=_0x4e6c9f(0xe4d),document['body'][_0x4e6c9f(0x497)](_0x3eccbb);}async function exitWithSummary(){const _0x5beb93=_0x211817;try{const _0x1cad88=document[_0x5beb93(0xb30)]('#summary-btn'),_0x401a1b=_0x1cad88['innerHTML'];_0x1cad88[_0x5beb93(0x33a)]=_0x5beb93(0xe32),_0x1cad88[_0x5beb93(0x559)]=!![];const _0x37a141=document['querySelectorAll'](_0x5beb93(0x213d));_0x37a141[_0x5beb93(0x19fb)](_0x19f7f1=>_0x19f7f1[_0x5beb93(0x559)]=!![]),showToast(_0x5beb93(0x1d0),_0x5beb93(0x477)),await generateOfflineStorylineSummary();const _0x2a9b6d=document[_0x5beb93(0xb30)](_0x5beb93(0x1845));if(_0x2a9b6d)_0x2a9b6d[_0x5beb93(0x1493)]();doExitOfflineMode(),showToast(_0x5beb93(0x160c),_0x5beb93(0x11cb));}catch(_0x4225d1){console[_0x5beb93(0x174a)](_0x5beb93(0x1fc),_0x4225d1);const _0x3df5c6=document[_0x5beb93(0xb30)](_0x5beb93(0x8c2));_0x3df5c6&&(_0x3df5c6[_0x5beb93(0x33a)]=_0x5beb93(0x182b),_0x3df5c6[_0x5beb93(0x559)]=![]);const _0x1584c6=document['querySelectorAll']('.offline-exit-modal\x20.btn:not(#summary-btn)');_0x1584c6['forEach'](_0x41a22f=>_0x41a22f[_0x5beb93(0x559)]=![]);const _0x1b9563=document[_0x5beb93(0xb30)]('.offline-exit-modal');if(_0x1b9563)_0x1b9563[_0x5beb93(0x1493)]();doExitOfflineMode(),showToast(_0x5beb93(0x889),'warning');}}function exitTemporarily(){const _0x537ad6=_0x211817,_0x39ed1d=document[_0x537ad6(0xb30)](_0x537ad6(0x1845));_0x39ed1d?(_0x39ed1d[_0x537ad6(0x1493)](),console[_0x537ad6(0x2187)]('✅\x20暂时离开：模态框已关闭')):console[_0x537ad6(0x2187)](_0x537ad6(0xd62)),console[_0x537ad6(0x2187)](_0x537ad6(0x12f8)+offlineMessages['length']+_0x537ad6(0xd75)),doExitOfflineMode(),showToast('已暂时离开线下模式',_0x537ad6(0x477));}async function exitWithoutSummary(){const _0x2a140c=_0x211817,_0x2c00d1=document['querySelector']('.offline-exit-modal');_0x2c00d1?(_0x2c00d1[_0x2a140c(0x1493)](),console[_0x2a140c(0x2187)]('✅\x20结束且不总结：模态框已关闭')):console[_0x2a140c(0x2187)](_0x2a140c(0x1f48));if(offlineMessages[_0x2a140c(0x19ee)]>0x0){console[_0x2a140c(0x2187)](_0x2a140c(0x157d)+offlineMessages[_0x2a140c(0x19ee)]+_0x2a140c(0xd75));const _0x1ec71d=_0x2a140c(0x1298)+new Date()[_0x2a140c(0xecc)]()+'\x20('+offlineMessages[_0x2a140c(0x19ee)]+_0x2a140c(0x1cbe);await saveOfflineHistoryRecord(_0x1ec71d,offlineMessages[_0x2a140c(0x6d5)]());const _0x1f1ba7=currentChatCharacter['id'];if(chatMessages[_0x1f1ba7]){const _0x3be8ba=chatMessages[_0x1f1ba7]['filter'](_0x545dc6=>_0x545dc6[_0x2a140c(0x208c)]);console[_0x2a140c(0x2187)]('📊\x20主聊天记录中的线下消息:\x20'+_0x3be8ba[_0x2a140c(0x19ee)]+'条'),console['log']('📊\x20当前线下消息数组:\x20'+offlineMessages[_0x2a140c(0x19ee)]+'条'),await saveChatMessages(_0x1f1ba7),console['log']('✅\x20已确保线下模式消息保存到主聊天记录中');}else console[_0x2a140c(0x1f43)]('⚠️\x20主聊天记录为空，这可能导致记忆连接问题');offlineMessages=[],saveOfflineMessages(),showToast(_0x2a140c(0x49f),_0x2a140c(0x11cb));}else console[_0x2a140c(0x2187)]('📝\x20没有线下模式对话需要保存'),showToast(_0x2a140c(0x22a7),_0x2a140c(0x11cb));doExitOfflineMode();}function doExitOfflineMode(){const _0x2a5533=_0x211817;isOfflineMode=![];const _0x12449d=document[_0x2a5533(0x1262)](_0x2a5533(0xf37)),_0x36d938=document[_0x2a5533(0x1262)](_0x2a5533(0x17dc)),_0x4a22c9=document[_0x2a5533(0x1262)](_0x2a5533(0xcf2));_0x12449d[_0x2a5533(0x14eb)][_0x2a5533(0x4da)]='none',_0x36d938[_0x2a5533(0x1722)]='fas\x20fa-door-open',_0x4a22c9[_0x2a5533(0x1c1b)][_0x2a5533(0x1493)](_0x2a5533(0xbaf));currentChatCharacter&&resumeProactiveChatTimer(currentChatCharacter['id']);const _0x21cc32=document[_0x2a5533(0x1262)]('offline-chat-messages');_0x21cc32&&(_0x21cc32[_0x2a5533(0x33a)]='',console['log'](_0x2a5533(0x1379)));}async function generateOfflineStorylineSummary(){const _0x14f761=_0x211817;if(!currentChatCharacter||offlineMessages[_0x14f761(0x19ee)]===0x0)return;console['log']('📖\x20开始生成线下模式剧情总结...');try{let _0x5da330='';offlineMessages['forEach']((_0x563f2f,_0x556a43)=>{const _0x4ffa97=_0x14f761,_0x240cf3=_0x563f2f[_0x4ffa97(0x8a1)]==='user'?'用户':currentChatCharacter['name'],_0x148374=safeExtractMessageContent(_0x563f2f);_0x5da330+=_0x240cf3+'：'+_0x148374+'\x0a';});const _0x446cc5='请为以下线下剧情模式的对话生成一个简洁客观的剧情总结，要求：\x0a1.\x20使用客观的上帝视角，加入合理的文学性描写\x0a2.\x20避免过多的修辞和形容词\x0a3.\x20简明扼要地描述事件发生的顺序和关键情节与细节\x0a4.\x20不要添加任何不在原文中的情感描写\x0a5.\x20使用清晰的时间和因果关系\x0a6.\x20统一使用第三人称叙述：用\x22用户\x22指代用户，用\x22'+currentChatCharacter['name']+_0x14f761(0xa6d)+currentChatCharacter[_0x14f761(0x1a1c)]+'\x0a\x0a对话历史：\x0a'+_0x5da330+_0x14f761(0x1de5)+currentChatCharacter[_0x14f761(0x1a1c)]+_0x14f761(0xeb5)+currentChatCharacter[_0x14f761(0x1a1c)]+_0x14f761(0x1160);console[_0x14f761(0x2187)](_0x14f761(0xf06),_0x446cc5);const _0x2de268=await callOfflineChatAPI(_0x446cc5,currentChatCharacter);console[_0x14f761(0x2187)](_0x14f761(0x15ed),_0x2de268);if(_0x2de268&&_0x2de268[_0x14f761(0x19d7)]()){const _0x6bbf17={'id':_0x14f761(0x833)+currentChatCharacter['id']+'_'+Date[_0x14f761(0x2eb)](),'characterId':currentChatCharacter['id'],'appType':_0x14f761(0x13dd),'action':_0x14f761(0x1323),'timestamp':Date['now'](),'context':{'type':_0x14f761(0x1216),'content':_0x14f761(0x1959)+_0x2de268[_0x14f761(0x19d7)](),'date':new Date()[_0x14f761(0x1034)]()['split']('T')[0x0],'messageCount':offlineMessages['length'],'importance':0.9},'messageId':'offline_summary_'+Date[_0x14f761(0x2eb)]()};await db['crossAppTimeline']['add'](_0x6bbf17),console[_0x14f761(0x2187)]('📖\x20线下模式剧情总结已保存到跨应用时间线:',_0x6bbf17),saveOfflineHistoryRecord(_0x2de268[_0x14f761(0x19d7)](),offlineMessages[_0x14f761(0x6d5)]());const _0x5c63e1=currentChatCharacter['id'];if(chatMessages[_0x5c63e1]){const _0x501c66=chatMessages[_0x5c63e1][_0x14f761(0x1e1f)](_0x2fd20d=>_0x2fd20d[_0x14f761(0x208c)]);console[_0x14f761(0x2187)](_0x14f761(0x110e)+_0x501c66[_0x14f761(0x19ee)]+'条'),console['log'](_0x14f761(0x2225)+offlineMessages[_0x14f761(0x19ee)]+'条'),await saveChatMessages(_0x5c63e1),console['log'](_0x14f761(0x5fe));}else console[_0x14f761(0x1f43)](_0x14f761(0xa6c));offlineMessages=[],saveOfflineMessages();}else throw new Error(_0x14f761(0x165e));}catch(_0x374d16){console[_0x14f761(0x174a)](_0x14f761(0xfc1),_0x374d16);throw _0x374d16;}}function showOfflinePresetSettings(){const _0x2d74c6=_0x211817;document[_0x2d74c6(0x1262)](_0x2d74c6(0x82d))[_0x2d74c6(0x14eb)][_0x2d74c6(0x4da)]=_0x2d74c6(0x1fb7),loadAndDisplayPresets(),clearPresetForm();}function closeOfflinePresetSettings(){const _0xc33d9=_0x211817;document[_0xc33d9(0x1262)](_0xc33d9(0x82d))[_0xc33d9(0x14eb)][_0xc33d9(0x4da)]='none',delete window[_0xc33d9(0x1221)];}function clearPresetForm(){const _0x52c4a9=_0x211817;document['getElementById'](_0x52c4a9(0xfd1))['value']='',document['getElementById'](_0x52c4a9(0x1e01))[_0x52c4a9(0x1ebc)]='';}async function loadAndDisplayPresets(){const _0x2aee66=_0x211817;try{const _0x2a15ae=await db['offlinePresets'][_0x2aee66(0xf13)](),_0x3bac5a=_0x2a15ae['filter'](_0x68726f=>_0x68726f[_0x2aee66(0xd92)]===!![]),_0x12b01b=document['getElementById']('saved-presets-list');_0x12b01b[_0x2aee66(0x33a)]='';if(_0x3bac5a['length']===0x0)return;_0x3bac5a[_0x2aee66(0x1104)]((_0x3ae0b8,_0xcce2b)=>_0xcce2b[_0x2aee66(0x1716)]-_0x3ae0b8[_0x2aee66(0x1716)]),_0x3bac5a[_0x2aee66(0x19fb)](_0x457c71=>{const _0x1e5e9c=_0x2aee66,_0x5b79d9=document['createElement'](_0x1e5e9c(0xbbc));_0x5b79d9[_0x1e5e9c(0x1722)]=_0x1e5e9c(0x52b);currentOfflinePreset&&currentOfflinePreset['id']===_0x457c71['id']&&_0x5b79d9[_0x1e5e9c(0x1c1b)][_0x1e5e9c(0x21e2)](_0x1e5e9c(0x1a14));const _0x152eed=document[_0x1e5e9c(0xac6)](_0x1e5e9c(0xbbc));_0x152eed[_0x1e5e9c(0x1722)]=_0x1e5e9c(0x431);const _0x119820=document['createElement'](_0x1e5e9c(0xbbc));_0x119820['className']=_0x1e5e9c(0x183b),_0x119820[_0x1e5e9c(0x13be)]=_0x457c71[_0x1e5e9c(0x1a1c)];const _0x32feaa=document[_0x1e5e9c(0xac6)](_0x1e5e9c(0xbbc));_0x32feaa[_0x1e5e9c(0x1722)]=_0x1e5e9c(0x1d18),_0x32feaa['textContent']=_0x457c71[_0x1e5e9c(0x211c)][_0x1e5e9c(0x17ca)](0x0,0x32)+(_0x457c71['content']['length']>0x32?_0x1e5e9c(0x1520):''),_0x152eed[_0x1e5e9c(0x497)](_0x119820),_0x152eed['appendChild'](_0x32feaa);const _0x548da7=document['createElement']('div');_0x548da7['className']=_0x1e5e9c(0x1b49);const _0x2bfad8=document['createElement'](_0x1e5e9c(0xca7));_0x2bfad8['className']=_0x1e5e9c(0x224a),_0x2bfad8[_0x1e5e9c(0x33a)]=_0x1e5e9c(0xd31),_0x2bfad8[_0x1e5e9c(0x378)]=_0x1e5e9c(0x8d9),_0x2bfad8[_0x1e5e9c(0x1f36)]=()=>usePreset(_0x457c71);const _0x3c2cbf=document[_0x1e5e9c(0xac6)](_0x1e5e9c(0xca7));_0x3c2cbf[_0x1e5e9c(0x1722)]=_0x1e5e9c(0x182d),_0x3c2cbf[_0x1e5e9c(0x33a)]=_0x1e5e9c(0x744),_0x3c2cbf['title']=_0x1e5e9c(0x9b7),_0x3c2cbf[_0x1e5e9c(0x1f36)]=()=>editPreset(_0x457c71);const _0x47dcc7=document[_0x1e5e9c(0xac6)]('button');_0x47dcc7[_0x1e5e9c(0x1722)]=_0x1e5e9c(0x388),_0x47dcc7[_0x1e5e9c(0x33a)]='<i\x20class=\x22fas\x20fa-trash\x22></i>',_0x47dcc7[_0x1e5e9c(0x378)]=_0x1e5e9c(0x153b),_0x47dcc7[_0x1e5e9c(0x1f36)]=()=>deletePreset(_0x457c71['id']),_0x548da7['appendChild'](_0x2bfad8),_0x548da7['appendChild'](_0x3c2cbf),_0x548da7[_0x1e5e9c(0x497)](_0x47dcc7),_0x5b79d9[_0x1e5e9c(0x497)](_0x152eed),_0x5b79d9[_0x1e5e9c(0x497)](_0x548da7),_0x12b01b[_0x1e5e9c(0x497)](_0x5b79d9);}),console[_0x2aee66(0x2187)]('✅\x20加载了\x20'+_0x3bac5a[_0x2aee66(0x19ee)]+'\x20个线下模式预设');}catch(_0x5f1050){console[_0x2aee66(0x174a)](_0x2aee66(0x1185),_0x5f1050),showToast('加载预设失败',_0x2aee66(0x174a));}}function usePreset(_0x1a2be0){const _0x3c2ca6=_0x211817;currentOfflinePreset=_0x1a2be0,loadAndDisplayPresets(),showToast('已启用预设\x22'+_0x1a2be0[_0x3c2ca6(0x1a1c)]+'\x22',_0x3c2ca6(0x11cb));}function editPreset(_0x1006f5){const _0x2eb513=_0x211817;document[_0x2eb513(0x1262)]('offline-preset-name')[_0x2eb513(0x1ebc)]=_0x1006f5['name'],document['getElementById']('offline-preset-content')[_0x2eb513(0x1ebc)]=_0x1006f5['content'],window[_0x2eb513(0x1221)]=_0x1006f5['id'];}async function deletePreset(_0x3b4970){const _0xe1e2ac=_0x211817;if(!confirm(_0xe1e2ac(0x10ea)))return;try{const _0x1f0739=await db['offlinePresets'][_0xe1e2ac(0xb78)](_0x3b4970);if(!_0x1f0739){showToast(_0xe1e2ac(0x19b4),_0xe1e2ac(0x1816));return;}await db[_0xe1e2ac(0x17ea)]['delete'](_0x3b4970),currentOfflinePreset&&currentOfflinePreset['id']===_0x3b4970&&(currentOfflinePreset=null),await loadAndDisplayPresets(),showToast(_0xe1e2ac(0x11a7)+_0x1f0739[_0xe1e2ac(0x1a1c)]+'\x22已删除','info'),console[_0xe1e2ac(0x2187)](_0xe1e2ac(0x1d51)+_0x1f0739['name']+'\x20('+_0x3b4970+')');}catch(_0x2bb5ea){console[_0xe1e2ac(0x174a)](_0xe1e2ac(0x15ef),_0x2bb5ea),showToast(_0xe1e2ac(0x94e),'error');}}async function saveOfflinePreset(){const _0x290583=_0x211817,_0x2e4eb0=document[_0x290583(0x1262)]('offline-preset-name')[_0x290583(0x1ebc)]['trim'](),_0x59bfdb=document[_0x290583(0x1262)]('offline-preset-content')[_0x290583(0x1ebc)][_0x290583(0x19d7)]();if(!_0x2e4eb0){showToast(_0x290583(0x1430),'warning');return;}if(!_0x59bfdb){showToast('请输入预设内容',_0x290583(0x1816));return;}try{if(window[_0x290583(0x1221)]){const _0x18e42c=await db[_0x290583(0x17ea)]['get'](window[_0x290583(0x1221)]);if(_0x18e42c){_0x18e42c[_0x290583(0x1a1c)]=_0x2e4eb0,_0x18e42c[_0x290583(0x211c)]=_0x59bfdb,_0x18e42c[_0x290583(0x1716)]=Date[_0x290583(0x2eb)](),await db['offlinePresets']['put'](_0x18e42c);currentOfflinePreset&&currentOfflinePreset['id']===window[_0x290583(0x1221)]&&(currentOfflinePreset=_0x18e42c);delete window[_0x290583(0x1221)],await loadAndDisplayPresets(),clearPresetForm(),showToast('预设\x22'+_0x2e4eb0+_0x290583(0x128e),_0x290583(0x11cb)),console['log']('✅\x20更新预设:\x20'+_0x2e4eb0+'\x20('+_0x18e42c['id']+')');return;}delete window[_0x290583(0x1221)];}const _0x467c96={'id':_0x290583(0xb5b)+Date[_0x290583(0x2eb)]()+'_'+Math[_0x290583(0x11a8)]()[_0x290583(0x1878)](0x24)[_0x290583(0x15fb)](0x2,0x9),'name':_0x2e4eb0,'content':_0x59bfdb,'timestamp':Date['now'](),'isGlobal':!![]};await db[_0x290583(0x17ea)]['add'](_0x467c96),currentOfflinePreset=_0x467c96,await loadAndDisplayPresets(),clearPresetForm(),showToast(_0x290583(0x11a7)+_0x2e4eb0+_0x290583(0x17a4),_0x290583(0x11cb)),console[_0x290583(0x2187)](_0x290583(0x1d5a)+_0x2e4eb0+'\x20('+_0x467c96['id']+')');}catch(_0x25f026){console[_0x290583(0x174a)](_0x290583(0x1471),_0x25f026),showToast('保存预设失败','error');}}function loadOfflineMessages(){const _0x166e75=_0x211817;if(!currentChatCharacter||!windowId)return;if(!offlineMessages||offlineMessages[_0x166e75(0x19ee)]===0x0){const _0x252592=_0x166e75(0x22c3)+currentChatCharacter['id']+'_'+windowId;offlineMessages=JSON[_0x166e75(0x22d3)](localStorage[_0x166e75(0x15d8)](_0x252592)||'[]'),console[_0x166e75(0x2187)]('📱\x20从localStorage加载线下消息\x20(窗口'+windowId+_0x166e75(0x18a8)+offlineMessages['length']+'条');}else console['log']('📱\x20使用内存中的线下消息\x20(窗口'+windowId+_0x166e75(0x18a8)+offlineMessages['length']+'条');loadLatestOfflinePreset(),renderOfflineMessages();}async function loadLatestOfflinePreset(){const _0x56d89e=_0x211817;try{const _0x38a080=await db[_0x56d89e(0x17ea)][_0x56d89e(0xf13)](),_0xa98ce2=_0x38a080[_0x56d89e(0x1e1f)](_0x142d52=>_0x142d52[_0x56d89e(0xd92)]===!![]);_0xa98ce2[_0x56d89e(0x19ee)]>0x0?(_0xa98ce2[_0x56d89e(0x1104)]((_0x4a72c,_0x1211b0)=>_0x1211b0['timestamp']-_0x4a72c[_0x56d89e(0x1716)]),currentOfflinePreset=_0xa98ce2[0x0],console[_0x56d89e(0x2187)](_0x56d89e(0x1dfc)+currentOfflinePreset[_0x56d89e(0x1a1c)])):(currentOfflinePreset=null,console[_0x56d89e(0x2187)](_0x56d89e(0x1431)));}catch(_0x422f5a){console['error'](_0x56d89e(0x1185),_0x422f5a),currentOfflinePreset=null;}}function renderOfflineMessages(){const _0x527fc2=_0x211817,_0x263634=document['getElementById'](_0x527fc2(0x160f));_0x263634[_0x527fc2(0x33a)]='',offlineMessages[_0x527fc2(0x19fb)](_0x2d0b89=>{const _0x36e49e=_0x527fc2,_0x423feb=document[_0x36e49e(0xac6)]('div');_0x423feb[_0x36e49e(0x1722)]=_0x36e49e(0xcce)+_0x2d0b89[_0x36e49e(0x8a1)],_0x423feb[_0x36e49e(0x1ecd)]['messageId']=_0x2d0b89['id'];const _0x5a217c=document['createElement'](_0x36e49e(0xbbc));_0x5a217c[_0x36e49e(0x1722)]=_0x36e49e(0x186)+(_0x2d0b89[_0x36e49e(0x8a1)]===_0x36e49e(0xa80)?'user-avatar':_0x36e49e(0x1388));if(_0x2d0b89[_0x36e49e(0x8a1)]===_0x36e49e(0xa80)){let _0xedc1d4=null,_0x1556ac='用户';const _0x14167=getCurrentChatSettings();_0x14167['myChatAvatar']&&(_0xedc1d4=_0x14167[_0x36e49e(0x11cd)]);if(!_0xedc1d4&&_0x14167[_0x36e49e(0x145e)]){const _0x5af11a=personas[_0x36e49e(0xaf4)](_0x182835=>_0x182835['id']===_0x14167[_0x36e49e(0x145e)]);_0x5af11a&&(_0xedc1d4=_0x5af11a[_0x36e49e(0x1994)],_0x1556ac=_0x5af11a[_0x36e49e(0x1a1c)]);}!_0xedc1d4&&window[_0x36e49e(0x865)]&&(_0xedc1d4=window[_0x36e49e(0x865)]);if(_0xedc1d4&&_0xedc1d4[_0x36e49e(0x19d7)]())_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x159c)]='url('+_0xedc1d4+')',_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x15d0)]='cover',_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x1530)]='center',_0x5a217c[_0x36e49e(0x13be)]='';else{const _0x60a080=createDefaultAvatar(_0x1556ac);_0x5a217c['style'][_0x36e49e(0x159c)]=_0x36e49e(0x9f1)+_0x60a080+')',_0x5a217c['style'][_0x36e49e(0x15d0)]=_0x36e49e(0x12bb),_0x5a217c[_0x36e49e(0x14eb)]['backgroundPosition']='center',_0x5a217c[_0x36e49e(0x13be)]='';}}else{let _0x22e786=null;if(currentChatCharacter){const _0x54bbe6=getCurrentChatSettings();if(_0x54bbe6[_0x36e49e(0x179f)])_0x22e786=_0x54bbe6['aiChatAvatar'];else{if(currentChatCharacter['avatarUrl'])_0x22e786=currentChatCharacter[_0x36e49e(0x1994)];else currentChatCharacter[_0x36e49e(0x1f8a)]&&(_0x22e786=currentChatCharacter[_0x36e49e(0x1f8a)]);}}if(_0x22e786&&_0x22e786[_0x36e49e(0x19d7)]())_0x5a217c['style'][_0x36e49e(0x159c)]=_0x36e49e(0x9f1)+_0x22e786+')',_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x15d0)]=_0x36e49e(0x12bb),_0x5a217c['style'][_0x36e49e(0x1530)]=_0x36e49e(0xcef),_0x5a217c[_0x36e49e(0x13be)]='';else{const _0x4b1c02=currentChatCharacter?.['name']||'AI',_0xb38e07=createDefaultAvatar(_0x4b1c02);_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x159c)]=_0x36e49e(0x9f1)+_0xb38e07+')',_0x5a217c[_0x36e49e(0x14eb)]['backgroundSize']=_0x36e49e(0x12bb),_0x5a217c[_0x36e49e(0x14eb)][_0x36e49e(0x1530)]=_0x36e49e(0xcef),_0x5a217c['textContent']='';}}const _0x3790ee=document['createElement'](_0x36e49e(0xbbc));_0x3790ee[_0x36e49e(0x1722)]=_0x36e49e(0x1bff),_0x3790ee[_0x36e49e(0x33a)]=formatOfflineText(_0x2d0b89[_0x36e49e(0x211c)]),_0x423feb[_0x36e49e(0x497)](_0x5a217c),_0x423feb[_0x36e49e(0x497)](_0x3790ee),addOfflineMessageLongPressListener(_0x423feb,_0x2d0b89['id']),_0x263634['appendChild'](_0x423feb);}),setTimeout(()=>{requestAnimationFrame(()=>{const _0x31e4d2=_0x167f;_0x263634[_0x31e4d2(0x98c)]=_0x263634[_0x31e4d2(0xfe3)];});},0x32),applyOfflineUISettings();}async function sendOfflineMessage(){const _0x534b58=_0x211817,_0x248fd1=document[_0x534b58(0x1262)](_0x534b58(0x595)),_0xe24d4c=_0x248fd1[_0x534b58(0x1ebc)][_0x534b58(0x19d7)]();if(!_0xe24d4c)return;if(!currentChatCharacter)return;const _0x3a5ccd=currentChatCharacter['id'];!chatMessages[_0x3a5ccd]&&(chatMessages[_0x3a5ccd]=[]);const _0x4f689d={'id':Date[_0x534b58(0x2eb)](),'sender':_0x534b58(0x1e6d),'content':_0xe24d4c,'timestamp':Date[_0x534b58(0x2eb)](),'type':_0x534b58(0x1378),'isOfflineMode':!![]};chatMessages[_0x3a5ccd][_0x534b58(0x1cd6)](_0x4f689d);try{await saveChatMessagesImmediate([_0x3a5ccd]),console[_0x534b58(0x2187)](_0x534b58(0x966));}catch(_0x28f874){console[_0x534b58(0x174a)](_0x534b58(0x1c0e),_0x28f874),await saveChatMessages(_0x3a5ccd);}const _0x52e357={'id':Date['now']()['toString'](),'sender':_0x534b58(0xa80),'content':_0xe24d4c,'timestamp':new Date()['toISOString']()};offlineMessages['push'](_0x52e357),_0x248fd1['value']='',renderOfflineMessages(),saveOfflineMessages(),showOfflineLoadingMessage();try{const _0x2a340c=await generateOfflineResponse(_0xe24d4c),_0x179600={'id':Date[_0x534b58(0x2eb)]()+0x1,'sender':_0x534b58(0xb11),'content':_0x2a340c,'timestamp':Date[_0x534b58(0x2eb)]()+0x1,'type':'text','isOfflineMode':!![]};chatMessages[_0x3a5ccd][_0x534b58(0x1cd6)](_0x179600);try{const _0x4515aa=_0x3a5ccd+_0x534b58(0x1c60)+_0x179600[_0x534b58(0x1716)]+'_'+Math[_0x534b58(0x11a8)]()[_0x534b58(0x1878)](0x24)[_0x534b58(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x3a5ccd][_0x534b58(0x19ee)]-0x1);await db[_0x534b58(0x19a2)]['add']({'id':_0x4515aa,'characterId':_0x3a5ccd,'timestamp':_0x179600[_0x534b58(0x1716)],'messageOrder':chatMessages[_0x3a5ccd][_0x534b58(0x19ee)]-0x1,'originalMessageId':_0x179600['id'],'messageData':_0x179600}),console['log']('✅\x20[高效线下AI消息]\x20单条消息已保存到数据库');}catch(_0x5ee241){console['error'](_0x534b58(0x1c76),_0x5ee241),await saveChatMessages();}const _0x207d29={'id':(Date[_0x534b58(0x2eb)]()+0x1)['toString'](),'sender':'ai','content':_0x2a340c,'timestamp':new Date()[_0x534b58(0x1034)]()};offlineMessages[_0x534b58(0x1cd6)](_0x207d29),hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages();}catch(_0x27a040){console[_0x534b58(0x174a)](_0x534b58(0xfa1),_0x27a040),hideOfflineLoadingMessage(),showToast(_0x534b58(0x273),_0x534b58(0x174a));}}async function callOfflineChatAPI(_0x544305,_0x1b43e8){const _0x3864bb=_0x211817;if(!apiSettings['key'])throw new Error(_0x3864bb(0x1e69));const _0x33c22b=apiSettings[_0x3864bb(0x1208)][_0x3864bb(0x1831)](_0x3864bb(0x1d80));if(_0x33c22b){const _0xf71e8e=apiSettings[_0x3864bb(0x1208)]+_0x3864bb(0x1107)+apiSettings[_0x3864bb(0x1976)]+_0x3864bb(0x40c)+apiSettings[_0x3864bb(0x213c)],_0x1885cb={'contents':[{'role':_0x3864bb(0xa80),'parts':[{'text':'你是'+_0x1b43e8['name']+'，'+_0x1b43e8[_0x3864bb(0x7a1)]+'。现在处于线下剧情模式，请以纯文本形式回复，专注于情景描写和剧情发展。\x0a\x0a'+_0x544305}]}],'generationConfig':{'temperature':apiSettings[_0x3864bb(0x11c5)]||0.8}},_0x118907=await fetch(_0xf71e8e,{'method':_0x3864bb(0x1dd5),'headers':{'Content-Type':_0x3864bb(0x1b82)},'body':JSON[_0x3864bb(0x6b8)](_0x1885cb)});if(!_0x118907['ok'])throw new Error(_0x3864bb(0x61b)+_0x118907[_0x3864bb(0x12e2)]);const _0x207729=await _0x118907[_0x3864bb(0xe52)]();console[_0x3864bb(0x2187)]('🔥\x20线下模式Gemini\x20API完整响应:',JSON[_0x3864bb(0x6b8)](_0x207729,null,0x2));const _0x2b7938=_0x207729[_0x3864bb(0x1153)]?.[0x0]?.[_0x3864bb(0x211c)]?.[_0x3864bb(0x2308)]?.[0x0]?.[_0x3864bb(0x1378)];if(!_0x2b7938)return console['log'](_0x3864bb(0x7df),_0x207729),console[_0x3864bb(0x2187)](_0x3864bb(0xec0),_0x207729[_0x3864bb(0x1153)]?.[0x0]),_0x207729['candidates']?.[0x0]?.[_0x3864bb(0x211c)]&&console[_0x3864bb(0x2187)](_0x3864bb(0xd14),_0x207729[_0x3864bb(0x1153)][0x0][_0x3864bb(0x211c)]),_0x207729[_0x3864bb(0x1153)]?.[0x0]?.[_0x3864bb(0x211c)]?.[_0x3864bb(0x2308)]&&console[_0x3864bb(0x2187)](_0x3864bb(0xc41),_0x207729['candidates'][0x0][_0x3864bb(0x211c)][_0x3864bb(0x2308)]),_0x3864bb(0x2223);return _0x2b7938;}else{let _0x256535=apiSettings[_0x3864bb(0x1208)],_0x5c64a8;if(_0x256535[_0x3864bb(0x81f)](_0x3864bb(0x1439)))_0x5c64a8=_0x256535+_0x3864bb(0x1bea);else _0x256535[_0x3864bb(0x1831)](_0x3864bb(0x1dac))?_0x5c64a8=_0x256535+_0x3864bb(0x1bea):_0x5c64a8=_0x256535+_0x3864bb(0x666);const _0x1540eb={'model':apiSettings[_0x3864bb(0x1976)],'messages':[{'role':_0x3864bb(0x1744),'content':'你是'+_0x1b43e8[_0x3864bb(0x1a1c)]+'，'+_0x1b43e8[_0x3864bb(0x7a1)]+_0x3864bb(0x1c8)},{'role':_0x3864bb(0xa80),'content':_0x544305}],'temperature':apiSettings[_0x3864bb(0x11c5)]||0.8},_0x2281ec=await fetch(_0x5c64a8,{'method':_0x3864bb(0x1dd5),'headers':{'Content-Type':'application/json','Authorization':_0x3864bb(0x1e3c)+apiSettings[_0x3864bb(0x213c)]},'body':JSON['stringify'](_0x1540eb)});if(!_0x2281ec['ok'])throw new Error(_0x3864bb(0x61b)+_0x2281ec[_0x3864bb(0x12e2)]);const _0x560ed2=await _0x2281ec[_0x3864bb(0xe52)]();console[_0x3864bb(0x2187)](_0x3864bb(0x11f3),_0x560ed2);const _0x12aca0=_0x560ed2['choices']?.[0x0]?.['message']?.[_0x3864bb(0x211c)];if(!_0x12aca0){console[_0x3864bb(0x174a)]('OpenAI\x20API返回了空内容或格式异常:',_0x560ed2);throw new Error(_0x3864bb(0x21b3));}return _0x12aca0;}}async function generateOfflineResponse(_0x25244c){const _0x5dece1=_0x211817,_0x4f721c=currentChatCharacter;console[_0x5dece1(0x2187)](_0x5dece1(0x36d)),console[_0x5dece1(0x2187)]('🎭\x20当前角色:',_0x4f721c[_0x5dece1(0x1a1c)]),console[_0x5dece1(0x2187)](_0x5dece1(0x2f7),_0x25244c);let _0x3ecc0b=_0x5dece1(0x1825);const _0x3b1689=getCurrentChatSettings();console[_0x5dece1(0x2187)](_0x5dece1(0x14f5),_0x3b1689);let _0x14b675='';const _0x54eede=_0x3b1689['enableDynamicMemory']!==![];console['log'](_0x5dece1(0x83e),_0x54eede);if(_0x54eede)try{const _0x203409=await getVisibleMomentsForCharacter(_0x4f721c['id'],0x5);console['log'](_0x5dece1(0x594),_0x203409[_0x5dece1(0x19ee)]),_0x203409[_0x5dece1(0x19ee)]>0x0?(_0x14b675=_0x5dece1(0x1771),_0x203409[_0x5dece1(0x19fb)]((_0x40f127,_0x13f0e4)=>{const _0x3760e9=_0x5dece1,_0x48d362=_0x40f127[_0x3760e9(0x22d2)]==='user'?'用户':_0x40f127[_0x3760e9(0x215c)];let _0x12d40e='';if(_0x40f127[_0x3760e9(0x1716)]){const _0x1b196e=Date[_0x3760e9(0x2eb)](),_0x3263da=_0x1b196e-_0x40f127[_0x3760e9(0x1716)],_0x4ab6a6=Math['floor'](_0x3263da/(0x3e8*0x3c)),_0x38e1b4=Math[_0x3760e9(0x2180)](_0x3263da/(0x3e8*0x3c*0x3c)),_0x55d684=Math['floor'](_0x3263da/(0x3e8*0x3c*0x3c*0x18));if(_0x55d684>0x0)_0x12d40e='\x20('+_0x55d684+_0x3760e9(0x1d2);else{if(_0x38e1b4>0x0)_0x12d40e='\x20('+_0x38e1b4+_0x3760e9(0x188f);else _0x4ab6a6>0x0?_0x12d40e='\x20('+_0x4ab6a6+_0x3760e9(0x9c1):_0x12d40e=_0x3760e9(0x267);}}const _0x29c82e=_0x13f0e4+0x1+'.\x20'+_0x48d362+':\x20'+_0x40f127[_0x3760e9(0x1378)]+_0x12d40e+(_0x40f127[_0x3760e9(0x1135)]||'');_0x14b675+=_0x29c82e,console[_0x3760e9(0x2187)](_0x3760e9(0x1ffe)+(_0x13f0e4+0x1)+':\x20'+_0x48d362+_0x3760e9(0x1811)+_0x40f127[_0x3760e9(0x1378)]+(_0x40f127[_0x3760e9(0x1748)]>0x0?'\x20('+_0x40f127['commentsCount']+_0x3760e9(0x1ab):''));})):console[_0x5dece1(0x2187)](_0x5dece1(0xc29));}catch(_0x57581a){console[_0x5dece1(0x174a)](_0x5dece1(0x12b3),_0x57581a);}let _0x39ef38='';if(_0x4f721c&&!currentChatCharacter?.['isGroup']){const _0x3170b4=isBlocked(_0x4f721c['id'],_0x5dece1(0xa80));if(_0x3170b4){const _0x213d7c=_0x5dece1(0x736)+_0x4f721c['id'],_0x464719=parseInt(localStorage[_0x5dece1(0x15d8)](_0x213d7c)||'0');_0x39ef38='\x0a\x0a🚨\x20**【重要状态提醒】**\x20🚨\x0a你目前被用户拉黑了！这个状态会持续影响你的行为和情绪。\x0a'+(_0x464719>0x0?_0x5dece1(0xc59)+_0x464719+_0x5dece1(0x394):'你还没有尝试发送好友申请来修复关系。')+_0x5dece1(0x163a);}}let _0x12ef4d='';try{const _0x3d850d=getGlobalMemorySettings();console[_0x5dece1(0x2187)](_0x5dece1(0xd9b),_0x3d850d);const _0x4e27f3={'type':_0x5dece1(0x219),'id':_0x4f721c['id']};console[_0x5dece1(0x2187)]('🧠\x20当前上下文:',_0x4e27f3),console[_0x5dece1(0x2187)]('🧠\x20线下模式：强制启用全局记忆读取...'),_0x12ef4d=await buildGlobalMemoryContext(_0x4f721c['id'],_0x4e27f3,_0x3d850d['memoryDays']),console['log'](_0x5dece1(0xb99),_0x12ef4d),_0x12ef4d&&_0x12ef4d[_0x5dece1(0x19d7)]()?(console[_0x5dece1(0x2187)]('🧠\x20线下模式已获取全局记忆上下文，总长度:',_0x12ef4d['length']),console['log'](_0x5dece1(0xf04),_0x12ef4d[_0x5dece1(0x17ca)](0x0,0xc8)+'...')):console[_0x5dece1(0x2187)](_0x5dece1(0x1bb5));}catch(_0x42235a){console[_0x5dece1(0x174a)](_0x5dece1(0x16ab),_0x42235a);}const _0x5ce89a=_0x4f721c['prompt']||_0x4f721c[_0x5dece1(0x1f0b)]||'你是'+_0x4f721c[_0x5dece1(0x1a1c)]+'。';console[_0x5dece1(0x2187)]('👤\x20角色人设:',_0x5ce89a),console[_0x5dece1(0x2187)](_0x5dece1(0x1b0),_0x4f721c),_0x3ecc0b+='角色信息：\x0a'+_0x5ce89a+'\x0a\x0a';let _0x37f74e='';try{const _0x594739=_0x3b1689['selectedWorldbooks']||[],_0x22694c=window[_0x5dece1(0x1a4e)]||[],_0xb1a118=[...new Set([..._0x22694c,..._0x594739])];console[_0x5dece1(0x2187)](_0x5dece1(0x1d13),_0xb1a118),console[_0x5dece1(0x2187)]('📚\x20全局世界书:',_0x22694c),console['log'](_0x5dece1(0x13dc),_0x594739),console[_0x5dece1(0x2187)](_0x5dece1(0x1288),worldbooks),_0xb1a118[_0x5dece1(0x19ee)]>0x0?(_0x37f74e=_0x5dece1(0x6d0),_0xb1a118['forEach']((_0x5b7ba6,_0xb72364)=>{const _0x46842b=_0x5dece1,_0x57fd3a=worldbooks[_0x46842b(0xaf4)](_0x3b165f=>_0x3b165f['id']===_0x5b7ba6);_0x57fd3a?(console[_0x46842b(0x2187)]('📚\x20找到世界书\x20'+(_0xb72364+0x1)+':\x20'+(_0x57fd3a[_0x46842b(0x1a1c)]||_0x57fd3a[_0x46842b(0x378)])),_0x37f74e+=_0xb72364+0x1+'.\x20'+(_0x57fd3a[_0x46842b(0x1a1c)]||_0x57fd3a['title'])+':\x20'+_0x57fd3a[_0x46842b(0x211c)]+'\x0a'):console['log'](_0x46842b(0xa4d)+_0x5b7ba6);}),_0x3ecc0b+=_0x37f74e+'\x0a',console[_0x5dece1(0x2187)](_0x5dece1(0x1328),_0x37f74e[_0x5dece1(0x19ee)])):console[_0x5dece1(0x2187)]('📚\x20没有可用的世界书');}catch(_0x368622){console['error'](_0x5dece1(0x2fa),_0x368622);}_0x12ef4d&&_0x12ef4d[_0x5dece1(0x19d7)]()&&(_0x3ecc0b+=_0x5dece1(0x1166)+_0x12ef4d+'\x0a');_0x14b675&&(_0x3ecc0b+=_0x14b675+'\x0a');_0x39ef38&&(_0x3ecc0b+=_0x39ef38+'\x0a');currentOfflinePreset?_0x3ecc0b+=_0x5dece1(0x59d)+currentOfflinePreset[_0x5dece1(0x211c)]+'\x0a\x0a':_0x3ecc0b+=_0x5dece1(0x89a);const _0x3ff32b=_0x3b1689[_0x5dece1(0x2062)]||0x5,_0x375073=chatMessages[_0x4f721c['id']]||[],_0x18ec78=_0x375073[_0x5dece1(0x6d5)](-_0x3ff32b),_0x2b6c53=_0x18ec78['filter'](_0x3afe16=>!_0x3afe16[_0x5dece1(0x208c)])[_0x5dece1(0x19ee)],_0x32cab2=_0x18ec78[_0x5dece1(0x1e1f)](_0x5b5a7b=>_0x5b5a7b[_0x5dece1(0x208c)])[_0x5dece1(0x19ee)];console[_0x5dece1(0x2187)](_0x5dece1(0x1e43),_0x18ec78),console[_0x5dece1(0x2187)](_0x5dece1(0xca8)+_0x2b6c53+_0x5dece1(0x3d9)+_0x32cab2+_0x5dece1(0x1e58)+_0x18ec78['length']+_0x5dece1(0x3ba)+_0x3ff32b+'条)');_0x18ec78[_0x5dece1(0x19ee)]>0x0&&(_0x3ecc0b+=_0x5dece1(0x1708),_0x18ec78[_0x5dece1(0x19fb)](_0x1b166c=>{const _0x18deef=_0x5dece1,_0xa86bc0=_0x1b166c[_0x18deef(0x8a1)]===_0x18deef(0x1e6d)||_0x1b166c['sender']===_0x18deef(0xa80)?'用户':_0x4f721c[_0x18deef(0x1a1c)],_0xdd06d3=_0x1b166c[_0x18deef(0x208c)]?_0x18deef(0xa93):_0x18deef(0x10e2),_0x170231=safeExtractMessageContent(_0x1b166c);_0x3ecc0b+=''+_0xa86bc0+_0xdd06d3+'：'+_0x170231+'\x0a';}),_0x3ecc0b+='\x0a');_0x3ecc0b+='用户刚才说：'+_0x25244c+'\x0a\x0a请直接以纯文本形式回复，不要使用JSON数组格式，注重情景描写和氛围营造。',console[_0x5dece1(0x2187)]('📝\x20=====\x20完整的Prompt内容\x20====='),console[_0x5dece1(0x2187)](_0x3ecc0b),console['log'](_0x5dece1(0xc24));try{const _0x2dc6d6=await callOfflineChatAPI(_0x3ecc0b,_0x4f721c);return _0x2dc6d6||'抱歉，我现在无法回复。';}catch(_0xbee99d){console['error'](_0x5dece1(0x2114),_0xbee99d);throw _0xbee99d;}}function saveOfflineMessages(){const _0x54bbef=_0x211817;if(!currentChatCharacter||!windowId)return;const _0x477fbc=_0x54bbef(0x22c3)+currentChatCharacter['id']+'_'+windowId;localStorage[_0x54bbef(0x192)](_0x477fbc,JSON[_0x54bbef(0x6b8)](offlineMessages)),console[_0x54bbef(0x2187)](_0x54bbef(0x60e)+windowId+'):\x20'+offlineMessages['length']+'条');}async function regenerateLastOfflineMessage(){const _0x488b26=_0x211817;if(!currentChatCharacter)return;if(offlineMessages['length']===0x0)return;let _0x526b6a=-0x1;for(let _0x54f96d=offlineMessages[_0x488b26(0x19ee)]-0x1;_0x54f96d>=0x0;_0x54f96d--){if(offlineMessages[_0x54f96d]['sender']==='ai'){_0x526b6a=_0x54f96d;break;}}if(_0x526b6a===-0x1){showToast('没有找到可重新生成的AI消息',_0x488b26(0x1816));return;}let _0x53e03c=-0x1;for(let _0x2bed3d=_0x526b6a-0x1;_0x2bed3d>=0x0;_0x2bed3d--){if(offlineMessages[_0x2bed3d]['sender']==='user'){_0x53e03c=_0x2bed3d;break;}}if(_0x53e03c===-0x1){showToast(_0x488b26(0x18f4),_0x488b26(0x1816));return;}offlineMessages[_0x488b26(0x19b2)](_0x526b6a,0x1),renderOfflineMessages(),saveOfflineMessages(),showOfflineLoadingMessage();try{const _0xde9f8a=offlineMessages[_0x53e03c],_0x27927e=await generateOfflineResponse(_0xde9f8a['content']),_0x10163e={'id':Date['now']()['toString'](),'sender':'ai','content':_0x27927e,'timestamp':new Date()[_0x488b26(0x1034)]()};offlineMessages['push'](_0x10163e),hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages(),showToast(_0x488b26(0x1696),_0x488b26(0x11cb));}catch(_0x59ca4e){console[_0x488b26(0x174a)](_0x488b26(0xf63),_0x59ca4e),hideOfflineLoadingMessage(),showToast(_0x488b26(0x118b),_0x488b26(0x174a));}}function addOfflineMessageLongPressListener(_0x38816c,_0x499baf){const _0x47fbee=_0x211817;let _0xf943b6=null,_0x318783=![];const _0x2dce32=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x47fbee(0x11b8)](navigator[_0x47fbee(0x214b)])||_0x47fbee(0x1eaf)in window||navigator[_0x47fbee(0x102c)]>0x0||window[_0x47fbee(0x44f)]<=0x300,_0x1729ef=_0x46ae93=>{_0x318783=![];const _0x487641=_0x2dce32?0x258:0x3e8;_0xf943b6=setTimeout(()=>{const _0x360205=_0x167f;_0x318783=!![],navigator['vibrate']&&_0x2dce32&&navigator[_0x360205(0xe3e)](0x32),showOfflineMessageMenu(_0x499baf,_0x46ae93),_0x46ae93['preventDefault']();},_0x487641);},_0x419fe2=()=>{_0xf943b6&&(clearTimeout(_0xf943b6),_0xf943b6=null),setTimeout(()=>{_0x318783=![];},0x32);},_0x1cc2b7=_0x25460f=>{const _0x5bfb80=_0x47fbee;if(_0x318783)return _0x25460f['preventDefault'](),_0x25460f[_0x5bfb80(0x902)](),![];};_0x38816c['addEventListener']('touchstart',_0x1729ef,{'passive':![]}),_0x38816c[_0x47fbee(0x21e9)]('touchend',_0x419fe2),_0x38816c[_0x47fbee(0x21e9)](_0x47fbee(0x20a4),_0x419fe2),_0x38816c[_0x47fbee(0x21e9)](_0x47fbee(0x5ac),_0x1729ef),_0x38816c[_0x47fbee(0x21e9)](_0x47fbee(0x2276),_0x419fe2),_0x38816c['addEventListener'](_0x47fbee(0x1e80),_0x419fe2),_0x38816c['addEventListener'](_0x47fbee(0x1679),_0x50dcc6=>{const _0x475a46=_0x47fbee;_0x50dcc6[_0x475a46(0x36f)](),showOfflineMessageMenu(_0x499baf,_0x50dcc6);}),_0x38816c['addEventListener'](_0x47fbee(0x1859),_0x1cc2b7,!![]);}function showOfflineMessageMenu(_0x436ea5,_0x28455b){const _0x44b106=_0x211817,_0x59c44a=offlineMessages[_0x44b106(0xaf4)](_0x62fb01=>_0x62fb01['id']===_0x436ea5);if(!_0x59c44a)return;const _0x4ffd07=document[_0x44b106(0xac6)](_0x44b106(0xbbc));_0x4ffd07[_0x44b106(0x1722)]=_0x44b106(0x81b);_0x59c44a[_0x44b106(0x8a1)]===_0x44b106(0xa80)?_0x4ffd07['innerHTML']=_0x44b106(0x1693)+_0x436ea5+_0x44b106(0x1b3f)+_0x436ea5+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':_0x4ffd07[_0x44b106(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22editOfflineMessage(\x27'+_0x436ea5+_0x44b106(0x1b3f)+_0x436ea5+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20fa-trash\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>删除消息</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22menu-item\x22\x20onclick=\x22regenerateOfflineMessage(\x27'+_0x436ea5+_0x44b106(0x2157);const _0x7a16c5=document[_0x44b106(0xb30)](_0x44b106(0xa58));_0x7a16c5&&_0x7a16c5[_0x44b106(0x1493)]();const _0x4c94f0=document[_0x44b106(0x1262)]('offline-mode-overlay');_0x4c94f0?_0x4c94f0[_0x44b106(0x497)](_0x4ffd07):document[_0x44b106(0x1da9)][_0x44b106(0x497)](_0x4ffd07);const _0x237905=_0x28455b['target'][_0x44b106(0x1fc0)](),_0xb5dfcf=_0x4c94f0?_0x4c94f0[_0x44b106(0x1fc0)]():{'left':0x0,'top':0x0},_0x3feea1=_0x237905[_0x44b106(0x15dc)]-_0xb5dfcf[_0x44b106(0x15dc)],_0x379e99=_0x237905[_0x44b106(0x825)]-_0xb5dfcf[_0x44b106(0x825)];_0x4ffd07['style']['position']='absolute',_0x4ffd07['style'][_0x44b106(0x1b76)]=_0x44b106(0x1170),setTimeout(()=>{const _0x3bc98f=_0x44b106,_0x2023e9=_0x4ffd07[_0x3bc98f(0x3ef)]||0x8c,_0x8b249=_0x4ffd07['offsetHeight']||0x64,_0x1dcbaa=_0x4c94f0?.[_0x3bc98f(0x3ef)]||0x190,_0x348745=_0x4c94f0?.[_0x3bc98f(0x804)]||0x258;let _0x10c18e=Math[_0x3bc98f(0x21ff)](_0x3feea1,_0x1dcbaa-_0x2023e9-0xa),_0x1dd936=_0x379e99-_0x8b249-0x5;_0x1dd936<0xa&&(_0x1dd936=_0x379e99+0x1e),_0x10c18e=Math['max'](0xa,_0x10c18e),_0x1dd936=Math[_0x3bc98f(0x658)](0xa,Math[_0x3bc98f(0x21ff)](_0x1dd936,_0x348745-_0x8b249-0xa)),_0x4ffd07['style'][_0x3bc98f(0x15dc)]=_0x10c18e+'px',_0x4ffd07[_0x3bc98f(0x14eb)]['top']=_0x1dd936+'px';},0x0);const _0x17268c=_0xed81fd=>{const _0x3374df=_0x44b106;!_0x4ffd07[_0x3374df(0x971)](_0xed81fd[_0x3374df(0x193d)])&&(_0x4ffd07['remove'](),document[_0x3374df(0xa21)](_0x3374df(0x1859),_0x17268c));};setTimeout(()=>{const _0x167683=_0x44b106;document[_0x167683(0x21e9)](_0x167683(0x1859),_0x17268c);},0x64);}function editOfflineMessage(_0x1f5a98){const _0xb4ab6d=_0x211817,_0xc2d594=offlineMessages[_0xb4ab6d(0xaf4)](_0x13de9b=>_0x13de9b['id']===_0x1f5a98);if(!_0xc2d594)return;const _0x160357=document[_0xb4ab6d(0xac6)](_0xb4ab6d(0xbbc));_0x160357[_0xb4ab6d(0x1722)]=_0xb4ab6d(0x1139),_0x160357[_0xb4ab6d(0x14eb)]['display']=_0xb4ab6d(0x1fb7),_0x160357[_0xb4ab6d(0x33a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22\x20style=\x22max-width:\x20500px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>'+(_0xc2d594[_0xb4ab6d(0x8a1)]===_0xb4ab6d(0xa80)?_0xb4ab6d(0x17fd):_0xb4ab6d(0xf03))+_0xb4ab6d(0x1e93)+_0xc2d594[_0xb4ab6d(0x211c)]+'</textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0xc2d594[_0xb4ab6d(0x8a1)]==='ai'?_0xb4ab6d(0xd03):'')+_0xb4ab6d(0x21aa)+_0x1f5a98+_0xb4ab6d(0x1c3a),document[_0xb4ab6d(0x1da9)][_0xb4ab6d(0x497)](_0x160357);const _0x3be4d4=_0x160357[_0xb4ab6d(0xb30)](_0xb4ab6d(0x184d));_0x3be4d4[_0xb4ab6d(0x13cf)](),_0x3be4d4[_0xb4ab6d(0x207)](_0x3be4d4[_0xb4ab6d(0x1ebc)][_0xb4ab6d(0x19ee)],_0x3be4d4[_0xb4ab6d(0x1ebc)][_0xb4ab6d(0x19ee)]);const _0x41767c=document[_0xb4ab6d(0xb30)](_0xb4ab6d(0xa58));if(_0x41767c)_0x41767c[_0xb4ab6d(0x1493)]();}async function saveEditedOfflineMessage(_0x30c361){const _0x43e27b=_0x211817,_0xd04959=document[_0x43e27b(0x1262)]('edit-offline-message-content'),_0x5a1d4e=_0xd04959['value'][_0x43e27b(0x19d7)]();if(!_0x5a1d4e){showToast(_0x43e27b(0x655),_0x43e27b(0x1816));return;}const _0x7df5d7=offlineMessages[_0x43e27b(0xaf4)](_0x4139ab=>_0x4139ab['id']===_0x30c361);if(_0x7df5d7){console[_0x43e27b(0x2187)]('✏️\x20编辑线下模式消息:',_0x30c361,_0x43e27b(0x106b),_0x5a1d4e);const _0x33f56f=currentChatCharacter['id'];if(chatMessages[_0x33f56f]){const _0x241c36=new Date(_0x7df5d7[_0x43e27b(0x1716)])[_0x43e27b(0x704)]();chatMessages[_0x33f56f][_0x43e27b(0x19fb)](_0x35fc25=>{const _0x46fe3b=_0x43e27b;_0x35fc25['isOfflineMode']&&(_0x35fc25['sender']===_0x46fe3b(0x1e6d)&&_0x7df5d7['sender']===_0x46fe3b(0xa80)||_0x35fc25[_0x46fe3b(0x8a1)]===_0x46fe3b(0xb11)&&_0x7df5d7[_0x46fe3b(0x8a1)]==='ai')&&Math[_0x46fe3b(0x1b24)](_0x35fc25['timestamp']-_0x241c36)<0x1388&&(console['log'](_0x46fe3b(0xca5),_0x35fc25[_0x46fe3b(0x211c)],'->',_0x5a1d4e),_0x35fc25[_0x46fe3b(0x211c)]=_0x5a1d4e);}),await saveChatMessages(_0x33f56f);}_0x7df5d7[_0x43e27b(0x211c)]=_0x5a1d4e,saveOfflineMessages(),renderOfflineMessages(),showToast(_0x43e27b(0x1f88),_0x43e27b(0x11cb));}const _0x12352c=document[_0x43e27b(0xb30)]('.modal');if(_0x12352c)_0x12352c[_0x43e27b(0x1493)]();}async function regenerateOfflineMessage(_0x105677){const _0xc30457=_0x211817,_0x2739a6=offlineMessages[_0xc30457(0x150c)](_0x59081b=>_0x59081b['id']===_0x105677);if(_0x2739a6===-0x1)return;const _0x5d8f8d=offlineMessages[_0x2739a6];if(_0x5d8f8d[_0xc30457(0x8a1)]!=='ai')return;let _0xbe2bad=_0x2739a6-0x1;while(_0xbe2bad>=0x0&&offlineMessages[_0xbe2bad][_0xc30457(0x8a1)]!==_0xc30457(0xa80)){_0xbe2bad--;}if(_0xbe2bad<0x0){showToast(_0xc30457(0x21d4),'error');return;}if(confirm(_0xc30457(0x11dd))){console[_0xc30457(0x2187)](_0xc30457(0x1422),_0x105677),await deleteOfflineMessage(_0x105677),showOfflineLoadingMessage();try{const _0xc23d50=offlineMessages[_0xbe2bad],_0x28e827=await generateOfflineResponse(_0xc23d50[_0xc30457(0x211c)]),_0x4a322a={'id':Date[_0xc30457(0x2eb)]()+0x1,'sender':'received','content':_0x28e827,'timestamp':Date[_0xc30457(0x2eb)]()+0x1,'type':_0xc30457(0x1378),'isOfflineMode':!![]},_0x57bd0f=currentChatCharacter['id'];!chatMessages[_0x57bd0f]&&(chatMessages[_0x57bd0f]=[]);chatMessages[_0x57bd0f][_0xc30457(0x1cd6)](_0x4a322a);try{const _0x15fe83=_0x57bd0f+_0xc30457(0x286)+_0x4a322a[_0xc30457(0x1716)]+'_'+Math['random']()[_0xc30457(0x1878)](0x24)[_0xc30457(0x15fb)](0x2,0x9)+'_'+(chatMessages[_0x57bd0f][_0xc30457(0x19ee)]-0x1);await db[_0xc30457(0x19a2)][_0xc30457(0x21e2)]({'id':_0x15fe83,'characterId':_0x57bd0f,'timestamp':_0x4a322a[_0xc30457(0x1716)],'messageOrder':chatMessages[_0x57bd0f][_0xc30457(0x19ee)]-0x1,'originalMessageId':_0x4a322a['id'],'messageData':_0x4a322a}),console[_0xc30457(0x2187)](_0xc30457(0x1cd2));}catch(_0x25a9b9){console[_0xc30457(0x174a)](_0xc30457(0x1ad4),_0x25a9b9),await saveChatMessages();}const _0x1f46ff={'id':Date['now']()[_0xc30457(0x1878)](),'sender':'ai','content':_0x28e827,'timestamp':new Date()['toISOString']()};offlineMessages['push'](_0x1f46ff),hideOfflineLoadingMessage(),renderOfflineMessages(),saveOfflineMessages(),showToast(_0xc30457(0x1696),_0xc30457(0x11cb));}catch(_0x522022){console[_0xc30457(0x174a)](_0xc30457(0xf63),_0x522022),hideOfflineLoadingMessage(),showToast(_0xc30457(0x118b),_0xc30457(0x174a));}}}async function deleteOfflineMessage(_0x3633fa){const _0x5b7a33=_0x211817,_0x1f541f=offlineMessages[_0x5b7a33(0x150c)](_0x528a03=>_0x528a03['id']===_0x3633fa);if(_0x1f541f===-0x1)return;const _0x27db52=offlineMessages[_0x1f541f],_0x52d583=_0x27db52[_0x5b7a33(0x8a1)]===_0x5b7a33(0xa80)?_0x5b7a33(0x11ad):_0x5b7a33(0x1954);if(confirm(_0x52d583)){console[_0x5b7a33(0x2187)](_0x5b7a33(0x1d37),_0x3633fa,_0x5b7a33(0x9f4),_0x27db52[_0x5b7a33(0x8a1)]);const _0x42499c=currentChatCharacter['id'];if(chatMessages[_0x42499c]){const _0x13a85d=offlineMessages[_0x1f541f],_0x25b5cb=new Date(_0x13a85d[_0x5b7a33(0x1716)])[_0x5b7a33(0x704)](),_0x39f06f=[];chatMessages[_0x42499c][_0x5b7a33(0x19fb)]((_0x109fb4,_0x4c22b5)=>{const _0x3b38ac=_0x5b7a33;_0x109fb4[_0x3b38ac(0x208c)]&&Math[_0x3b38ac(0x1b24)](_0x109fb4['timestamp']-_0x25b5cb)<0x1388&&_0x39f06f[_0x3b38ac(0x1cd6)](_0x4c22b5);}),_0x39f06f[_0x5b7a33(0x16b0)]()[_0x5b7a33(0x19fb)](_0x4fe3b0=>{const _0x1bff51=_0x5b7a33;console[_0x1bff51(0x2187)](_0x1bff51(0x89c),chatMessages[_0x42499c][_0x4fe3b0]),chatMessages[_0x42499c]['splice'](_0x4fe3b0,0x1);});}if(_0x27db52[_0x5b7a33(0x8a1)]===_0x5b7a33(0xa80)){offlineMessages['splice'](_0x1f541f,0x1);if(_0x1f541f<offlineMessages[_0x5b7a33(0x19ee)]&&offlineMessages[_0x1f541f][_0x5b7a33(0x8a1)]==='ai'){const _0x31cb8c=offlineMessages[_0x1f541f],_0x5afde3=new Date(_0x31cb8c[_0x5b7a33(0x1716)])[_0x5b7a33(0x704)](),_0x54cca4=[];chatMessages[_0x42499c][_0x5b7a33(0x19fb)]((_0x210dbd,_0x2461f2)=>{const _0x452315=_0x5b7a33;_0x210dbd[_0x452315(0x208c)]&&_0x210dbd[_0x452315(0x8a1)]===_0x452315(0xb11)&&Math[_0x452315(0x1b24)](_0x210dbd['timestamp']-_0x5afde3)<0x1388&&_0x54cca4[_0x452315(0x1cd6)](_0x2461f2);}),_0x54cca4[_0x5b7a33(0x16b0)]()[_0x5b7a33(0x19fb)](_0x26a786=>{const _0x1aa9b0=_0x5b7a33;console[_0x1aa9b0(0x2187)]('🗑️\x20删除AI回复记忆数据:',chatMessages[_0x42499c][_0x26a786]),chatMessages[_0x42499c][_0x1aa9b0(0x19b2)](_0x26a786,0x1);}),offlineMessages[_0x5b7a33(0x19b2)](_0x1f541f,0x1);}}else offlineMessages[_0x5b7a33(0x19b2)](_0x1f541f,0x1);saveOfflineMessages(),renderOfflineMessages(),showToast(_0x5b7a33(0x1edc),_0x5b7a33(0x11cb));}const _0x59c924=document[_0x5b7a33(0xb30)](_0x5b7a33(0xa58));if(_0x59c924)_0x59c924[_0x5b7a33(0x1493)]();}function showOfflineLoadingMessage(){const _0x1bc159=_0x211817,_0x590931=document[_0x1bc159(0x1262)](_0x1bc159(0x160f)),_0x411798=_0x590931[_0x1bc159(0xb30)](_0x1bc159(0xa1f));_0x411798&&_0x411798['remove']();const _0x280aac=document[_0x1bc159(0xac6)](_0x1bc159(0xbbc));_0x280aac['className']=_0x1bc159(0x17b2),_0x280aac['id']='offline-loading-indicator';const _0x38db56=document[_0x1bc159(0xac6)](_0x1bc159(0xbbc));_0x38db56[_0x1bc159(0x1722)]=_0x1bc159(0x1d1b);const _0x4d98ec=document[_0x1bc159(0xac6)](_0x1bc159(0xbbc));_0x4d98ec[_0x1bc159(0x1722)]='offline-loading-dots';for(let _0x33a642=0x0;_0x33a642<0x3;_0x33a642++){const _0x5ccbb9=document['createElement'](_0x1bc159(0xbbc));_0x5ccbb9['className']=_0x1bc159(0x625),_0x4d98ec[_0x1bc159(0x497)](_0x5ccbb9);}_0x38db56[_0x1bc159(0x497)](_0x4d98ec),_0x280aac[_0x1bc159(0x497)](_0x38db56),_0x590931[_0x1bc159(0x497)](_0x280aac),_0x590931[_0x1bc159(0x98c)]=_0x590931[_0x1bc159(0xfe3)];}function hideOfflineLoadingMessage(){const _0x5e1493=_0x211817,_0x34baaa=document[_0x5e1493(0x1262)](_0x5e1493(0x149d));_0x34baaa&&_0x34baaa[_0x5e1493(0x1493)]();}function showLoadingModal(_0x25b87d,_0xa1b11e){const _0x43c595=_0x211817,_0x136456=_0x43c595(0xd35)+Date[_0x43c595(0x2eb)](),_0xf67a1a=_0x43c595(0x1e48)+_0x136456+'\x22\x20class=\x22waiting-modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22waiting-spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22waiting-text\x22>'+_0x25b87d+_0x43c595(0xb7f)+(_0xa1b11e?_0x43c595(0x194c)+_0xa1b11e+'</p>':'')+_0x43c595(0x217d);return document[_0x43c595(0x1da9)][_0x43c595(0x1b7)](_0x43c595(0x42e),_0xf67a1a),_0x136456;}function hideLoadingModal(_0x37bbb1){const _0x2f518b=_0x211817,_0x5a581d=document[_0x2f518b(0x1262)](_0x37bbb1);_0x5a581d&&_0x5a581d[_0x2f518b(0x1493)]();}function formatOfflineText(_0x5317dd){const _0x120b12=_0x211817;if(!_0x5317dd)return'';let _0x503672=_0x5317dd;const _0x51eb2b=[];return _0x503672=_0x503672['replace'](/<details[^>]*>[\s\S]*?<\/details>/gi,_0x4fa427=>{const _0x9423a6=_0x167f,_0x5d9a1b=_0x9423a6(0x1203)+_0x51eb2b[_0x9423a6(0x19ee)]+'__';return _0x51eb2b[_0x9423a6(0x1cd6)](_0x4fa427),_0x5d9a1b;}),_0x503672=_0x503672[_0x120b12(0xe16)](/<p>/gi,'')['replace'](/<\/p>/gi,'\x0a\x0a')['replace'](/<br\s*\/?>/gi,'\x0a')[_0x120b12(0xe16)](/<[^>]*>/g,''),_0x51eb2b[_0x120b12(0x19fb)]((_0x4a0b31,_0x34a39b)=>{const _0x47c918=_0x120b12,_0x5a9569=_0x47c918(0x1203)+_0x34a39b+'__';_0x503672=_0x503672[_0x47c918(0xe16)](_0x5a9569,_0x4a0b31);}),_0x503672=_0x503672[_0x120b12(0xe16)](/\*\*([^*]+)\*\*/g,_0x120b12(0x20f)),_0x503672=_0x503672[_0x120b12(0xe16)](/\*([^*]+)\*/g,'<em>$1</em>'),_0x503672=_0x503672['replace'](/\n/g,_0x120b12(0xa71)),_0x503672=_0x503672[_0x120b12(0xe16)](/(<br>\s*){3,}/g,_0x120b12(0x1b5e)),_0x503672;}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x260e7a=_0x211817,_0x117f4c=document[_0x260e7a(0x1262)]('offline-input');_0x117f4c&&_0x117f4c[_0x260e7a(0x21e9)](_0x260e7a(0xf5c),function(_0xfba93){const _0x259079=_0x260e7a;_0xfba93[_0x259079(0x213c)]===_0x259079(0xdcf)&&!_0xfba93[_0x259079(0x4aa)]&&(_0xfba93['preventDefault'](),sendOfflineMessage());});});async function saveOfflineHistoryRecord(_0x4ca30b,_0x37dc01){const _0x1ae6bd=_0x211817;if(!currentChatCharacter||!_0x37dc01||_0x37dc01[_0x1ae6bd(0x19ee)]===0x0)return;try{const _0x858a0b={'id':'offline_history_'+currentChatCharacter['id']+'_'+Date[_0x1ae6bd(0x2eb)](),'characterId':currentChatCharacter['id'],'timestamp':Date[_0x1ae6bd(0x2eb)](),'summary':_0x4ca30b,'messages':_0x37dc01,'messageCount':_0x37dc01[_0x1ae6bd(0x19ee)]};await db['offlineHistoryRecords'][_0x1ae6bd(0x21e2)](_0x858a0b);const _0x3b8cb1=await db[_0x1ae6bd(0x86e)][_0x1ae6bd(0xa24)]('characterId')[_0x1ae6bd(0x1694)](currentChatCharacter['id'])[_0x1ae6bd(0x16b0)]()[_0x1ae6bd(0xd90)](_0x1ae6bd(0x1716));if(_0x3b8cb1[_0x1ae6bd(0x19ee)]>0x14){const _0x266350=_0x3b8cb1[_0x1ae6bd(0x6d5)](0x14);for(const _0xca6e9 of _0x266350){await db['offlineHistoryRecords'][_0x1ae6bd(0x1f4a)](_0xca6e9['id']);}}console[_0x1ae6bd(0x2187)](_0x1ae6bd(0xa88),_0x858a0b);}catch(_0xbcb0a1){console[_0x1ae6bd(0x174a)](_0x1ae6bd(0xfea),_0xbcb0a1);}}function showOfflineHistoryModal(){const _0x8cad1c=_0x211817;if(!currentChatCharacter)return;document[_0x8cad1c(0x1262)](_0x8cad1c(0x2232))[_0x8cad1c(0x14eb)]['display']=_0x8cad1c(0x1fb7),loadOfflineHistoryList();}function closeOfflineHistoryModal(){const _0x3dcb59=_0x211817;document[_0x3dcb59(0x1262)](_0x3dcb59(0x2232))[_0x3dcb59(0x14eb)][_0x3dcb59(0x4da)]=_0x3dcb59(0x102b);}async function loadOfflineHistoryList(){const _0x96857d=_0x211817;if(!currentChatCharacter)return;try{const _0x5d321a=await db['offlineHistoryRecords'][_0x96857d(0xa24)](_0x96857d(0xaf5))[_0x96857d(0x1694)](currentChatCharacter['id'])[_0x96857d(0x16b0)]()[_0x96857d(0xd90)](_0x96857d(0x1716)),_0x27747e=document[_0x96857d(0x1262)](_0x96857d(0x163f));_0x27747e[_0x96857d(0x33a)]='';if(_0x5d321a[_0x96857d(0x19ee)]===0x0){_0x27747e[_0x96857d(0x33a)]=_0x96857d(0x22ab);return;}_0x5d321a[_0x96857d(0x19fb)]((_0x30d584,_0x125b8d)=>{const _0x30acc1=_0x96857d,_0x336e68=document[_0x30acc1(0xac6)]('div');_0x336e68[_0x30acc1(0x1722)]='history-record-item';const _0x508dfa=new Date(_0x30d584['timestamp'])[_0x30acc1(0xbf7)]();_0x336e68['innerHTML']=_0x30acc1(0x12c6)+(_0x5d321a[_0x30acc1(0x19ee)]-_0x125b8d)+_0x30acc1(0x19b3)+_0x508dfa+'\x20•\x20'+_0x30d584['messageCount']+_0x30acc1(0x1583)+_0x30d584['id']+_0x30acc1(0x228d)+_0x30d584['id']+_0x30acc1(0x1a88)+_0x30d584['summary'][_0x30acc1(0x17ca)](0x0,0x64)+(_0x30d584[_0x30acc1(0x1490)][_0x30acc1(0x19ee)]>0x64?_0x30acc1(0x1520):'')+_0x30acc1(0x19f3),_0x27747e[_0x30acc1(0x497)](_0x336e68);});}catch(_0xdf02b5){console[_0x96857d(0x174a)](_0x96857d(0x180),_0xdf02b5);}}async function viewOfflineHistory(_0x8ba486){const _0xad18c0=_0x211817;if(!currentChatCharacter)return;try{const _0x16c4d1=await db['offlineHistoryRecords'][_0xad18c0(0xb78)](_0x8ba486);if(!_0x16c4d1){showToast('找不到该聊天记录',_0xad18c0(0x174a));return;}const _0xabfb08=document[_0xad18c0(0xac6)]('div');_0xabfb08[_0xad18c0(0x1722)]=_0xad18c0(0x1139),_0xabfb08[_0xad18c0(0x14eb)]['display']=_0xad18c0(0x1fb7),_0xabfb08[_0xad18c0(0x33a)]=_0xad18c0(0x16a9)+_0x16c4d1['date']+_0xad18c0(0x1840)+_0x16c4d1[_0xad18c0(0x356)]+_0xad18c0(0x10f9)+_0x16c4d1['summary']+_0xad18c0(0x5c8)+_0x16c4d1[_0xad18c0(0x1828)][_0xad18c0(0x6a4)](_0x2fc714=>_0xad18c0(0xc8b)+_0x2fc714['sender']+_0xad18c0(0x14f6)+(_0x2fc714[_0xad18c0(0x8a1)]===_0xad18c0(0xa80)?'用户':currentChatCharacter[_0xad18c0(0x1a1c)])+_0xad18c0(0x2064)+_0x2fc714[_0xad18c0(0x211c)]+_0xad18c0(0x221)+new Date(_0x2fc714['timestamp'])['toLocaleTimeString']()+_0xad18c0(0x1ab8))['join']('')+_0xad18c0(0x1bce),document[_0xad18c0(0x1da9)][_0xad18c0(0x497)](_0xabfb08);}catch(_0x5848b1){console[_0xad18c0(0x174a)]('查看线下模式聊天记录失败:',_0x5848b1),showToast(_0xad18c0(0x1fd7),_0xad18c0(0x174a));}}async function deleteOfflineHistory(_0xc78ebb){const _0x22069b=_0x211817;if(!confirm(_0x22069b(0x962)))return;if(!currentChatCharacter)return;try{await db['offlineHistoryRecords']['delete'](_0xc78ebb),loadOfflineHistoryList(),showToast(_0x22069b(0x454),_0x22069b(0x11cb));}catch(_0x36bc9e){console[_0x22069b(0x174a)](_0x22069b(0x171a),_0x36bc9e),showToast('删除聊天记录失败',_0x22069b(0x174a));}}async function clearAllOfflineHistory(){const _0x482b05=_0x211817;if(!confirm(_0x482b05(0x1eb7)))return;if(!currentChatCharacter)return;try{await db[_0x482b05(0x86e)][_0x482b05(0xa24)](_0x482b05(0xaf5))['equals'](currentChatCharacter['id'])[_0x482b05(0x1f4a)](),loadOfflineHistoryList(),showToast(_0x482b05(0x8b0),_0x482b05(0x11cb));}catch(_0x2ae95a){console[_0x482b05(0x174a)](_0x482b05(0x1f8d),_0x2ae95a),showToast('清空聊天记录失败','error');}}let offlineUISettings={};async function preloadOfflineUISettings(){const _0xe6a023=_0x211817;try{console[_0xe6a023(0x2187)]('🔄\x20开始预加载线下模式设置...');const _0x4533f4=await db['offlineUISettings'][_0xe6a023(0xf13)]();console[_0xe6a023(0x2187)](_0xe6a023(0x2012)+_0x4533f4[_0xe6a023(0x19ee)]+_0xe6a023(0x166d));if(_0x4533f4[_0xe6a023(0x19ee)]===0x0){console[_0xe6a023(0x2187)]('🔄\x20数据库中无设置，尝试从localStorage迁移...');for(let _0x30b3e6=0x0;_0x30b3e6<localStorage['length'];_0x30b3e6++){const _0x483d6a=localStorage[_0xe6a023(0x213c)](_0x30b3e6);if(_0x483d6a&&_0x483d6a['startsWith'](_0xe6a023(0xc39)))try{const _0x917a7e=localStorage['getItem'](_0x483d6a);if(_0x917a7e){const _0x3a88e3=JSON['parse'](_0x917a7e),_0x198494=_0x483d6a['replace'](_0xe6a023(0xc39),'')[_0xe6a023(0x204b)]('_')[0x0],_0x3ab701=_0x198494+_0xe6a023(0x21c1);await db[_0xe6a023(0x1486)][_0xe6a023(0x1561)]({'id':_0x3ab701,'characterId':_0x198494,'windowId':null,'settings':_0x3a88e3,'timestamp':Date[_0xe6a023(0x2eb)]()}),console[_0xe6a023(0x2187)](_0xe6a023(0xa0e)+_0x198494+'\x20的线下模式设置到数据库');}}catch(_0x52579b){console[_0xe6a023(0x1f43)]('⚠️\x20迁移设置失败\x20('+_0x483d6a+'):',_0x52579b);}}}console[_0xe6a023(0x2187)](_0xe6a023(0x912));}catch(_0x4e11a5){console[_0xe6a023(0x174a)](_0xe6a023(0x12e5),_0x4e11a5);}}function showOfflineUISettings(){const _0x3b5d0d=_0x211817;if(!currentChatCharacter){showToast(_0x3b5d0d(0x1346),'warning');return;}document['getElementById'](_0x3b5d0d(0x1d6f))['style'][_0x3b5d0d(0x4da)]='flex',loadOfflineUISettings();}function closeOfflineUISettings(){const _0x53a665=_0x211817;document[_0x53a665(0x1262)](_0x53a665(0x1d6f))[_0x53a665(0x14eb)]['display']='none';}async function loadOfflineUISettings(){const _0x2631ad=_0x211817;if(!currentChatCharacter)return;const _0x439851=currentChatCharacter['id'];try{let _0x521baf=null,_0x2b310d=![];if(windowId)try{_0x521baf=await db[_0x2631ad(0x1486)]['get'](_0x439851+'_'+windowId+'_ui_settings'),_0x521baf&&_0x521baf[_0x2631ad(0x1512)]&&(_0x2b310d=!![],console[_0x2631ad(0x2187)]('✅\x20从数据库加载窗口隔离设置成功\x20(窗口'+windowId+')'));}catch(_0x28d2c8){console[_0x2631ad(0x1f43)](_0x2631ad(0x2017),_0x28d2c8);}if(!_0x2b310d)try{_0x521baf=await db['offlineUISettings'][_0x2631ad(0xb78)](_0x439851+_0x2631ad(0x21c1)),_0x521baf&&_0x521baf['settings']&&(_0x2b310d=!![],console[_0x2631ad(0x2187)](_0x2631ad(0x179d)));}catch(_0x5770c0){console[_0x2631ad(0x1f43)](_0x2631ad(0x1e54),_0x5770c0);}if(!_0x2b310d)try{let _0x19dce2=null,_0x4aea35=null;windowId&&(_0x4aea35='offlineUISettings_'+_0x439851+'_'+windowId,_0x19dce2=localStorage[_0x2631ad(0x15d8)](_0x4aea35));!_0x19dce2&&(_0x4aea35=_0x2631ad(0xc39)+_0x439851,_0x19dce2=localStorage[_0x2631ad(0x15d8)](_0x4aea35));if(_0x19dce2){const _0x41ae22=JSON[_0x2631ad(0x22d3)](_0x19dce2);_0x521baf={'settings':_0x41ae22},console['log']('✅\x20从localStorage加载设置成功\x20('+_0x4aea35+')'),setTimeout(async()=>{const _0x257e6e=_0x2631ad;try{const _0x559bb0=windowId?_0x439851+'_'+windowId+'_ui_settings':_0x439851+_0x257e6e(0x21c1);await db[_0x257e6e(0x1486)]['put']({'id':_0x559bb0,'characterId':_0x439851,'windowId':windowId||null,'settings':_0x41ae22,'timestamp':Date['now']()}),console[_0x257e6e(0x2187)](_0x257e6e(0x1fe8)+_0x559bb0+')');}catch(_0x5f2149){console['warn'](_0x257e6e(0x1c22),_0x5f2149);}},0x64);}}catch(_0x4b90e0){console['warn']('localStorage加载也失败:',_0x4b90e0);}_0x521baf&&_0x521baf[_0x2631ad(0x1512)]?(offlineUISettings=_0x521baf[_0x2631ad(0x1512)],console[_0x2631ad(0x2187)]('✅\x20线下模式界面设置加载成功')):(console[_0x2631ad(0x2187)]('📝\x20未找到设置，使用默认设置'),offlineUISettings={'myBubbleColor':_0x2631ad(0x4ea),'aiBubbleColor':'#f0f0f0','bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':_0x2631ad(0x1cf5),'userItalicTextColor':'#333333','userBoldTextColor':_0x2631ad(0x1cf5),'aiNormalTextColor':_0x2631ad(0x1cf5),'aiItalicTextColor':'#666666','aiBoldTextColor':_0x2631ad(0x1b19),'showUserAvatar':![],'showAiAvatar':![],'avatarPosition':_0x2631ad(0x3fc),'bubbleWidth':_0x2631ad(0x1094),'bubbleStyle':'default','customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}}),updateOfflineUISettingsForm(),updateOfflinePreview();}catch(_0x50d49d){console[_0x2631ad(0x174a)]('加载线下模式界面设置完全失败:',_0x50d49d),offlineUISettings={'myBubbleColor':_0x2631ad(0x4ea),'aiBubbleColor':_0x2631ad(0x7ae),'bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':_0x2631ad(0x1cf5),'userItalicTextColor':_0x2631ad(0x1b19),'userBoldTextColor':_0x2631ad(0x1cf5),'aiNormalTextColor':_0x2631ad(0x1cf5),'aiItalicTextColor':_0x2631ad(0x2135),'aiBoldTextColor':'#333333','showUserAvatar':![],'showAiAvatar':![],'avatarPosition':_0x2631ad(0x3fc),'bubbleWidth':'default','bubbleStyle':_0x2631ad(0x1094),'customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},updateOfflineUISettingsForm(),updateOfflinePreview();}}function updateOfflineUISettingsForm(){const _0x400746=_0x211817;document[_0x400746(0x1262)](_0x400746(0xa7c))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0xbfa)],document['getElementById'](_0x400746(0x252))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0xeaf)],document[_0x400746(0x1262)](_0x400746(0x1395))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x1d83)],document[_0x400746(0x1262)](_0x400746(0x2172))[_0x400746(0x13be)]=Math[_0x400746(0x13e2)](offlineUISettings[_0x400746(0x1d83)]*0x64)+'%',document[_0x400746(0x1262)](_0x400746(0x10c6))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x3f4)]||0xf,document['getElementById']('offline-font-size-value')[_0x400746(0x13be)]=(offlineUISettings['fontSize']||0xf)+'px',document[_0x400746(0x1262)](_0x400746(0x724))['value']=offlineUISettings[_0x400746(0x1d58)]||'';offlineUISettings[_0x400746(0x1d58)]==='custom'?(document[_0x400746(0x1262)]('custom-font-input')[_0x400746(0x14eb)][_0x400746(0x4da)]='block',document[_0x400746(0x1262)](_0x400746(0xcd8))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x101c)]||''):document[_0x400746(0x1262)](_0x400746(0x800))[_0x400746(0x14eb)]['display']=_0x400746(0x102b);document[_0x400746(0x1262)]('offline-user-normal-text-color')[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x1a98)]||_0x400746(0xbd6),document[_0x400746(0x1262)](_0x400746(0x114c))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x61d)]||_0x400746(0x7ae),document[_0x400746(0x1262)](_0x400746(0x15a4))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x326)]||_0x400746(0xbd6),document['getElementById'](_0x400746(0xa5b))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0xf1b)]||_0x400746(0x1cf5),document[_0x400746(0x1262)](_0x400746(0x121b))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0xed4)]||_0x400746(0x2135),document[_0x400746(0x1262)](_0x400746(0x58b))['value']=offlineUISettings['aiBoldTextColor']||_0x400746(0x1b19),document[_0x400746(0x1262)](_0x400746(0x13fd))[_0x400746(0x14c1)]=offlineUISettings['showUserAvatar']===!![],document[_0x400746(0x1262)]('offline-show-ai-avatar')[_0x400746(0x14c1)]=offlineUISettings[_0x400746(0x1525)]===!![];const _0x54019=offlineUISettings[_0x400746(0x1609)]||'side';document[_0x400746(0xb30)](_0x400746(0x1119)+_0x54019+'\x22]')[_0x400746(0x14c1)]=!![];const _0x35b4ab=offlineUISettings[_0x400746(0xd6e)]||'default';document[_0x400746(0xb30)]('input[name=\x22offline-bubble-width\x22][value=\x22'+_0x35b4ab+'\x22]')['checked']=!![];const _0x496de8=offlineUISettings[_0x400746(0x1813)]||'default';document[_0x400746(0xb30)](_0x400746(0x1ce8)+_0x496de8+'\x22]')['checked']=!![],document['getElementById'](_0x400746(0x1d6d))[_0x400746(0x1ebc)]=offlineUISettings[_0x400746(0x1e65)]||'',updateSavedColorsDisplay();const _0x1a259e=document[_0x400746(0x1262)](_0x400746(0x1395));_0x1a259e[_0x400746(0x20b1)]=function(){const _0x115495=_0x400746,_0x4c92e8=Math[_0x115495(0x13e2)](this[_0x115495(0x1ebc)]*0x64);document[_0x115495(0x1262)]('offline-opacity-value')[_0x115495(0x13be)]=_0x4c92e8+'%',updateOfflinePreview();};const _0x1c1386=document[_0x400746(0x1262)]('offline-font-size');_0x1c1386[_0x400746(0x20b1)]=function(){const _0x4f921a=_0x400746,_0x32b821=this[_0x4f921a(0x1ebc)];document[_0x4f921a(0x1262)](_0x4f921a(0x1e28))[_0x4f921a(0x13be)]=_0x32b821+'px',updateOfflinePreview();},[_0x400746(0xa7c),_0x400746(0x252),_0x400746(0x1eb9),'offline-user-italic-text-color',_0x400746(0x15a4),_0x400746(0xa5b),_0x400746(0x121b),'offline-ai-bold-text-color']['forEach'](_0x53b52d=>{const _0x4d91ca=_0x400746;document['getElementById'](_0x53b52d)[_0x4d91ca(0x20b1)]=updateOfflinePreview;}),document[_0x400746(0x1262)]('offline-show-user-avatar')['onchange']=updateOfflinePreview,document[_0x400746(0x1262)](_0x400746(0x144c))[_0x400746(0x1980)]=updateOfflinePreview,document[_0x400746(0x1897)](_0x400746(0xf73))['forEach'](_0x5ab929=>{const _0x356330=_0x400746;_0x5ab929[_0x356330(0x1980)]=updateOfflinePreview;}),document[_0x400746(0x1897)](_0x400746(0x1cb0))[_0x400746(0x19fb)](_0x422838=>{_0x422838['onchange']=updateOfflinePreview;}),document[_0x400746(0x1897)](_0x400746(0x609))[_0x400746(0x19fb)](_0x2e0ea8=>{const _0x1f5281=_0x400746;_0x2e0ea8[_0x1f5281(0x1980)]=updateOfflinePreview;}),document[_0x400746(0x1897)]('input[name=\x22offline-avatar-position\x22]')[_0x400746(0x19fb)](_0x30a460=>{_0x30a460['onchange']=function(){const _0x3c4f52=_0x167f;this['value']==='custom'&&showToast('请在下方CSS代码区域自定义头像位置',_0x3c4f52(0x477));};}),document['querySelectorAll'](_0x400746(0x1cb0))[_0x400746(0x19fb)](_0x24b421=>{const _0x28a72c=_0x400746;_0x24b421[_0x28a72c(0x1980)]=function(){const _0x5e73a6=_0x28a72c;this[_0x5e73a6(0x1ebc)]===_0x5e73a6(0x2b0)?showToast(_0x5e73a6(0x1ae0),_0x5e73a6(0x477)):applyDefaultBubbleWidth();};}),document['querySelectorAll'](_0x400746(0x609))['forEach'](_0x162303=>{const _0x16b353=_0x400746;_0x162303[_0x16b353(0x1980)]=function(){const _0x2d4b3c=_0x16b353;this[_0x2d4b3c(0x1ebc)]===_0x2d4b3c(0x2b0)?showToast(_0x2d4b3c(0x225),'info'):applyDefaultBubbleStyle();};});}function applyDefaultBubbleWidth(){const _0xfde85c=_0x211817,_0x46009b=document['getElementById']('offline-custom-width-style');_0x46009b&&_0x46009b[_0xfde85c(0x1493)](),showToast(_0xfde85c(0x1c0a),'success');}function applyDefaultBubbleStyle(){const _0x2c2b80=_0x211817,_0x11d8eb=document[_0x2c2b80(0x1262)](_0x2c2b80(0x253));_0x11d8eb&&_0x11d8eb[_0x2c2b80(0x1493)](),showToast(_0x2c2b80(0x1dba),_0x2c2b80(0x11cb));}function updateSavedColorsDisplay(){const _0x2eee26=_0x211817,_0x97a635=[_0x2eee26(0x1a99),_0x2eee26(0x1a2a),'userBold','aiNormal','aiItalic',_0x2eee26(0x115a)],_0x351d64={'userNormal':_0x2eee26(0x1f5f),'userItalic':_0x2eee26(0x1e24),'userBold':_0x2eee26(0x9be),'aiNormal':_0x2eee26(0x1d7d),'aiItalic':_0x2eee26(0x1737),'aiBold':_0x2eee26(0x75d)};_0x97a635[_0x2eee26(0x19fb)](_0x35e241=>{const _0x5cd8b1=_0x2eee26,_0x511db6=document[_0x5cd8b1(0x1262)](_0x351d64[_0x35e241]+_0x5cd8b1(0x1bf5));_0x511db6&&(_0x511db6[_0x5cd8b1(0x33a)]='',offlineUISettings[_0x5cd8b1(0x10fa)][_0x35e241]&&offlineUISettings[_0x5cd8b1(0x10fa)][_0x35e241]['forEach'](_0x1e6ca0=>{const _0x84479=_0x5cd8b1,_0x45e627=document[_0x84479(0xac6)](_0x84479(0xbbc));_0x45e627[_0x84479(0x1722)]='saved-color-item',_0x45e627[_0x84479(0x14eb)][_0x84479(0x577)]=_0x1e6ca0,_0x45e627[_0x84479(0x378)]=_0x1e6ca0,_0x45e627[_0x84479(0x1f36)]=()=>{const _0x375e11=_0x84479;document[_0x375e11(0x1262)](_0x351d64[_0x35e241]+_0x375e11(0x749))['value']=_0x1e6ca0,updateOfflinePreview();},_0x511db6[_0x84479(0x497)](_0x45e627);}));});}function updateOfflinePreview(){const _0x10889a=_0x211817,_0x18be90=document[_0x10889a(0x1262)](_0x10889a(0xa7c))[_0x10889a(0x1ebc)],_0x370a7c=document[_0x10889a(0x1262)](_0x10889a(0x252))[_0x10889a(0x1ebc)],_0x205524=document['getElementById'](_0x10889a(0x1395))[_0x10889a(0x1ebc)],_0x2815b3=document[_0x10889a(0x1262)](_0x10889a(0x1eb9))[_0x10889a(0x1ebc)],_0x3f44dc=document['getElementById'](_0x10889a(0x114c))['value'],_0x4434b1=document[_0x10889a(0x1262)](_0x10889a(0x15a4))[_0x10889a(0x1ebc)],_0x90fae7=document[_0x10889a(0x1262)](_0x10889a(0xa5b))[_0x10889a(0x1ebc)],_0x151512=document['getElementById'](_0x10889a(0x121b))[_0x10889a(0x1ebc)],_0x41b801=document[_0x10889a(0x1262)]('offline-ai-bold-text-color')[_0x10889a(0x1ebc)],_0x4e2fad=document['documentElement'];_0x4e2fad[_0x10889a(0x14eb)]['setProperty']('--offline-my-bubble-color',_0x18be90),_0x4e2fad[_0x10889a(0x14eb)][_0x10889a(0xcf0)](_0x10889a(0x17bc),_0x370a7c),_0x4e2fad[_0x10889a(0x14eb)][_0x10889a(0xcf0)](_0x10889a(0x9e5),_0x2815b3),_0x4e2fad[_0x10889a(0x14eb)]['setProperty'](_0x10889a(0x507),_0x3f44dc),_0x4e2fad[_0x10889a(0x14eb)][_0x10889a(0xcf0)](_0x10889a(0x17a1),_0x4434b1),_0x4e2fad['style']['setProperty'](_0x10889a(0x1499),_0x90fae7),_0x4e2fad[_0x10889a(0x14eb)][_0x10889a(0xcf0)]('--offline-ai-italic-text-color',_0x151512),_0x4e2fad[_0x10889a(0x14eb)][_0x10889a(0xcf0)](_0x10889a(0x21fc),_0x41b801);const _0x4f417a=document[_0x10889a(0xb30)](_0x10889a(0x11bf)),_0x420c49=document[_0x10889a(0xb30)](_0x10889a(0x34f));if(_0x4f417a){const _0x3c691a=convertColorWithOpacity(_0x18be90,_0x205524);_0x4f417a[_0x10889a(0x14eb)][_0x10889a(0x577)]=_0x3c691a,_0x4f417a[_0x10889a(0x14eb)][_0x10889a(0x11af)]=0x1,_0x4f417a[_0x10889a(0x14eb)][_0x10889a(0xc3d)]=_0x2815b3;const _0x2b222d=_0x4f417a[_0x10889a(0xb30)]('em'),_0x1e3998=_0x4f417a[_0x10889a(0xb30)]('strong');if(_0x2b222d)_0x2b222d['style'][_0x10889a(0xc3d)]=_0x3f44dc;if(_0x1e3998)_0x1e3998[_0x10889a(0x14eb)][_0x10889a(0xc3d)]=_0x4434b1;}if(_0x420c49){const _0x438c68=convertColorWithOpacity(_0x370a7c,_0x205524);_0x420c49['style']['backgroundColor']=_0x438c68,_0x420c49[_0x10889a(0x14eb)][_0x10889a(0x11af)]=0x1,_0x420c49[_0x10889a(0x14eb)][_0x10889a(0xc3d)]=_0x90fae7;const _0x9ad993=_0x420c49[_0x10889a(0xb30)]('em'),_0x54b1c1=_0x420c49[_0x10889a(0xb30)](_0x10889a(0x16a1));if(_0x9ad993)_0x9ad993['style'][_0x10889a(0xc3d)]=_0x151512;if(_0x54b1c1)_0x54b1c1['style'][_0x10889a(0xc3d)]=_0x41b801;}const _0x5ad6eb=document['getElementById'](_0x10889a(0x13fd))['checked'],_0x1c31c2=document[_0x10889a(0x1262)](_0x10889a(0x144c))[_0x10889a(0x14c1)],_0x1109e9=document[_0x10889a(0x1262)](_0x10889a(0x1746)),_0x5c9e09=document[_0x10889a(0x1262)](_0x10889a(0x4a0)),_0x365fea=document[_0x10889a(0x1897)](_0x10889a(0x1aeb));_0x365fea['forEach'](_0x298b98=>{const _0x4de1a3=_0x10889a;_0x298b98[_0x4de1a3(0x1c1b)]['remove'](_0x4de1a3(0x1bbe),'no-ai-avatar');});_0x1109e9&&(_0x1109e9[_0x10889a(0x14eb)][_0x10889a(0x4da)]=_0x5ad6eb?'flex':_0x10889a(0x102b));_0x5c9e09&&(_0x5c9e09['style'][_0x10889a(0x4da)]=_0x1c31c2?_0x10889a(0x1fb7):_0x10889a(0x102b));_0x365fea[_0x10889a(0x19fb)](_0x3a7e68=>{const _0x13c8e6=_0x10889a;!_0x5ad6eb&&_0x3a7e68[_0x13c8e6(0x1c1b)][_0x13c8e6(0x21e2)]('no-user-avatar'),!_0x1c31c2&&_0x3a7e68['classList']['add']('no-ai-avatar');});const _0x507f3d=document[_0x10889a(0xb30)](_0x10889a(0x18e6))[_0x10889a(0x1ebc)],_0x137ba1=document[_0x10889a(0xb30)](_0x10889a(0x1597))[_0x10889a(0x1ebc)],_0x5d5db8=document[_0x10889a(0xb30)](_0x10889a(0x16cb))[_0x10889a(0x1ebc)],_0x3654c8=document[_0x10889a(0x1897)](_0x10889a(0x380)),_0x3ff7b5=document[_0x10889a(0x1897)]('.offline-preview-message');_0x3654c8[_0x10889a(0x19fb)](_0x267adb=>{const _0x25412f=_0x10889a;if(_0x507f3d==='default')_0x267adb[_0x25412f(0x14eb)][_0x25412f(0x891)]='';else{const _0x532aaf=document[_0x25412f(0x1262)](_0x25412f(0x1d6d))[_0x25412f(0x1ebc)][_0x25412f(0x19d7)]();if(_0x532aaf){}}}),_0x3ff7b5[_0x10889a(0x19fb)](_0x2db283=>{const _0x27ecc6=_0x10889a;_0x137ba1===_0x27ecc6(0x3fc)?_0x2db283[_0x27ecc6(0x1c1b)][_0x27ecc6(0x971)](_0x27ecc6(0xa80))?_0x2db283[_0x27ecc6(0x14eb)]['flexDirection']=_0x27ecc6(0x1b3e):_0x2db283['style'][_0x27ecc6(0x1601)]=_0x27ecc6(0x206f):_0x2db283[_0x27ecc6(0x14eb)][_0x27ecc6(0x1601)]='';});}function handleOfflineWallpaperUpload(_0x55c04d){const _0xb6862d=_0x211817,_0x18297c=_0x55c04d[_0xb6862d(0xf26)][0x0];if(!_0x18297c)return;if(!_0x18297c[_0xb6862d(0x1a4b)][_0xb6862d(0x1b30)](_0xb6862d(0x1d60))){showToast(_0xb6862d(0x118e),'warning'),_0x55c04d['value']='';return;}if(_0x18297c[_0xb6862d(0x2d8)]>0x5*0x400*0x400){showToast('图片文件不能超过5MB','warning'),_0x55c04d[_0xb6862d(0x1ebc)]='';return;}const _0x57cb1f=new FileReader();_0x57cb1f[_0xb6862d(0xc55)]=function(_0x4f55a3){const _0x5ca829=_0xb6862d,_0x518c0e=_0x4f55a3['target'][_0x5ca829(0x4ee)],_0x22f7e1=document[_0x5ca829(0x1262)]('offline-preview-area');_0x22f7e1[_0x5ca829(0x14eb)][_0x5ca829(0x159c)]='url('+_0x518c0e+')',_0x22f7e1[_0x5ca829(0x14eb)][_0x5ca829(0x15d0)]='cover',_0x22f7e1[_0x5ca829(0x14eb)][_0x5ca829(0x1530)]='center',offlineUISettings[_0x5ca829(0x22e3)]=_0x518c0e,showToast(_0x5ca829(0x1dfb),_0x5ca829(0x11cb));},_0x57cb1f['readAsDataURL'](_0x18297c);}function clearOfflineWallpaper(){const _0x3c858f=_0x211817;document['getElementById'](_0x3c858f(0x1a7c))['value']='';const _0x1b44f4=document[_0x3c858f(0x1262)]('offline-preview-area');_0x1b44f4[_0x3c858f(0x14eb)]['backgroundImage']='',offlineUISettings['wallpaperData']='',showToast(_0x3c858f(0x6f8),_0x3c858f(0x11cb));}function handleOfflineFontChange(){const _0x4a7810=_0x211817,_0x4961db=document[_0x4a7810(0x1262)](_0x4a7810(0x724)),_0x523254=document[_0x4a7810(0x1262)]('custom-font-input');_0x4961db['value']===_0x4a7810(0x2b0)?_0x523254[_0x4a7810(0x14eb)][_0x4a7810(0x4da)]='block':(_0x523254[_0x4a7810(0x14eb)][_0x4a7810(0x4da)]=_0x4a7810(0x102b),applyBuiltinFont(_0x4961db['value']));}function applyBuiltinFont(_0x270714){const _0x5cdcaf=_0x211817,_0x25a78d=document[_0x5cdcaf(0x1262)](_0x5cdcaf(0x1b6));_0x25a78d&&_0x25a78d[_0x5cdcaf(0x1493)](),_0x270714&&showToast('已恢复系统默认字体',_0x5cdcaf(0x11cb));}function previewOfflineCSS(){const _0x4b0e3b=_0x211817,_0x319e84=document['getElementById'](_0x4b0e3b(0x1d6d))['value'][_0x4b0e3b(0x19d7)](),_0x1f1c6d=document[_0x4b0e3b(0x1262)](_0x4b0e3b(0xfee));_0x1f1c6d&&_0x1f1c6d[_0x4b0e3b(0x1493)]();if(!_0x319e84){showToast(_0x4b0e3b(0xc13),'warning');return;}try{const _0x2c9d72=document[_0x4b0e3b(0xac6)]('style');_0x2c9d72['id']='offline-custom-css-preview';const _0x49a9b3=_0x319e84[_0x4b0e3b(0xe16)](/\.offline-/g,_0x4b0e3b(0x111f));_0x2c9d72[_0x4b0e3b(0x13be)]=_0x49a9b3,document[_0x4b0e3b(0x65a)][_0x4b0e3b(0x497)](_0x2c9d72),showToast(_0x4b0e3b(0xcd2),_0x4b0e3b(0x11cb));}catch(_0x4070ba){console[_0x4b0e3b(0x174a)](_0x4b0e3b(0x1c78),_0x4070ba),showToast(_0x4b0e3b(0x98a),_0x4b0e3b(0x174a));}}function clearOfflineCSS(){const _0xe02326=_0x211817;document[_0xe02326(0x1262)](_0xe02326(0x1d6d))[_0xe02326(0x1ebc)]='';const _0x4fa614=document[_0xe02326(0x1262)](_0xe02326(0xfee));_0x4fa614&&_0x4fa614[_0xe02326(0x1493)](),showToast(_0xe02326(0x3be),_0xe02326(0x11cb));}function previewOfflineFont(){const _0x23d422=_0x211817,_0x543d97=document[_0x23d422(0x1262)]('offline-font-url')[_0x23d422(0x1ebc)]['trim']();if(!_0x543d97){showToast(_0x23d422(0x197f),_0x23d422(0x1816));return;}const _0x425514=document[_0x23d422(0x1262)](_0x23d422(0x1b6));_0x425514&&_0x425514['remove']();const _0x1a11b9=document[_0x23d422(0x1262)](_0x23d422(0x10d1));_0x1a11b9&&_0x1a11b9['remove']();if(_0x543d97[_0x23d422(0x1831)](_0x23d422(0xa96))||_0x543d97[_0x23d422(0x1831)](_0x23d422(0x15ab))||_0x543d97['endsWith'](_0x23d422(0x501))||_0x543d97['includes'](_0x23d422(0xd47))||_0x543d97[_0x23d422(0x1831)](_0x23d422(0x2166))){console[_0x23d422(0x2187)](_0x23d422(0x8c6),_0x543d97);const _0x2d862f=document[_0x23d422(0xac6)]('link');_0x2d862f['id']=_0x23d422(0x10d1),_0x2d862f['rel']=_0x23d422(0x18bd),_0x2d862f[_0x23d422(0x1f9)]=_0x543d97,_0x2d862f[_0x23d422(0x98e)]='anonymous',_0x2d862f[_0x23d422(0xc55)]=function(){const _0x3b8a0d=_0x23d422;let _0x222079=extractFontFamilyFromGoogleFonts(_0x543d97)||_0x3b8a0d(0x1f47);console[_0x3b8a0d(0x2187)]('🎨\x20字体CSS加载成功，提取的字体名称:',_0x222079),console[_0x3b8a0d(0x2187)]('🎨\x20字体URL:',_0x543d97);try{const _0x16936d=document['styleSheets'];for(let _0x3c96a1=_0x16936d[_0x3b8a0d(0x19ee)]-0x1;_0x3c96a1>=0x0;_0x3c96a1--){const _0x3238f6=_0x16936d[_0x3c96a1];if(_0x3238f6[_0x3b8a0d(0x1f9)]===_0x543d97){try{const _0x385ca9=_0x3238f6['cssRules']||_0x3238f6['rules'];for(let _0x2c459c=0x0;_0x2c459c<_0x385ca9[_0x3b8a0d(0x19ee)];_0x2c459c++){const _0x5d7697=_0x385ca9[_0x2c459c];if(_0x5d7697['type']===CSSRule[_0x3b8a0d(0x639)]&&_0x5d7697[_0x3b8a0d(0x14eb)]['fontFamily']){_0x222079=_0x5d7697[_0x3b8a0d(0x14eb)][_0x3b8a0d(0x1d58)]['replace'](/['"]/g,''),console['log'](_0x3b8a0d(0x1d1c),_0x222079);break;}}}catch(_0x3d7729){console['log'](_0x3b8a0d(0x16fd));}break;}}}catch(_0x488244){console['log'](_0x3b8a0d(0x6d6));}const _0x45748d=document[_0x3b8a0d(0xac6)]('style');_0x45748d['id']='offline-custom-font-style',_0x45748d[_0x3b8a0d(0x13be)]=_0x3b8a0d(0x1003)+_0x222079+_0x3b8a0d(0x1ccd),document[_0x3b8a0d(0x65a)][_0x3b8a0d(0x497)](_0x45748d),console[_0x3b8a0d(0x2187)]('🎨\x20字体样式已应用到页面，最终字体名称:',_0x222079),window[_0x3b8a0d(0x1e4e)]=_0x222079,setTimeout(()=>{const _0x456639=_0x3b8a0d,_0x1091d4=document[_0x456639(0xb30)]('#offline-mode-overlay\x20.offline-message-content');if(_0x1091d4){const _0x3b6f60=window['getComputedStyle'](_0x1091d4);console[_0x456639(0x2187)]('🎨\x20实际应用的字体:',_0x3b6f60[_0x456639(0x1d58)]);}},0x3e8),showToast(_0x3b8a0d(0xc09)+_0x222079,'success');},_0x2d862f[_0x23d422(0x21ec)]=function(){const _0x3f16c5=_0x23d422;console[_0x3f16c5(0x174a)](_0x3f16c5(0x1dfe),_0x543d97),showToast(_0x3f16c5(0x168b),_0x3f16c5(0x174a));},document[_0x23d422(0x65a)]['appendChild'](_0x2d862f);}else{const _0x2dcce0=_0x23d422(0xa8a),_0x52fa03=document['createElement'](_0x23d422(0x14eb));_0x52fa03['id']=_0x23d422(0x1b6),_0x52fa03[_0x23d422(0x13be)]=_0x23d422(0x178f)+_0x2dcce0+_0x23d422(0x1042)+_0x543d97+_0x23d422(0x1777)+_0x2dcce0+_0x23d422(0x1367),document[_0x23d422(0x65a)][_0x23d422(0x497)](_0x52fa03),showToast('字体文件预览已应用','success');}}function extractFontFamilyFromGoogleFonts(_0x259ffa){const _0x4803d5=_0x211817;try{const _0x1b1b32=_0x259ffa[_0x4803d5(0x1b87)](/family=([^&:]+)/);if(_0x1b1b32){let _0x360011=decodeURIComponent(_0x1b1b32[0x1]);return _0x360011=_0x360011[_0x4803d5(0xe16)](/\+/g,'\x20')[_0x4803d5(0xe16)](/:.*$/,''),_0x360011;}const _0x3d5bd1=_0x259ffa[_0x4803d5(0x1b87)](/family=([^&]+)/);if(_0x3d5bd1){let _0x3c0821=decodeURIComponent(_0x3d5bd1[0x1]);return _0x3c0821=_0x3c0821[_0x4803d5(0xe16)](/\+/g,'\x20')['split'](':')[0x0],_0x3c0821;}const _0x14a37=_0x259ffa[_0x4803d5(0x1b87)](/\/([^\/]+)\.css/);if(_0x14a37)return _0x14a37[0x1][_0x4803d5(0xe16)](/[-_]/g,'\x20');const _0x5f0d2b=_0x259ffa['match'](/\/(\d+)\//);if(_0x5f0d2b)return _0x4803d5(0x776)+_0x5f0d2b[0x1];const _0x56b5d6=_0x259ffa[_0x4803d5(0x1b87)](/\/\/([^.]+)/);if(_0x56b5d6)return _0x56b5d6[0x1]+_0x4803d5(0x10dd);}catch(_0x2228a7){console[_0x4803d5(0x1f43)](_0x4803d5(0x144a),_0x2228a7);}return _0x4803d5(0x1f47);}function clearOfflineFont(){const _0x59dfe7=_0x211817;document[_0x59dfe7(0x1262)](_0x59dfe7(0xcd8))[_0x59dfe7(0x1ebc)]='';const _0x15a836=document['getElementById'](_0x59dfe7(0x1b6));_0x15a836&&_0x15a836[_0x59dfe7(0x1493)](),showToast(_0x59dfe7(0x841),_0x59dfe7(0x11cb));}function saveCurrentOfflineColors(){const _0x17d312=_0x211817,_0x3946f8=document[_0x17d312(0x1262)](_0x17d312(0x1eb9))[_0x17d312(0x1ebc)],_0x19195c=document[_0x17d312(0x1262)]('offline-user-italic-text-color')[_0x17d312(0x1ebc)],_0x11124f=document[_0x17d312(0x1262)](_0x17d312(0x15a4))[_0x17d312(0x1ebc)],_0x10958e=document[_0x17d312(0x1262)](_0x17d312(0xa5b))[_0x17d312(0x1ebc)],_0x43c80d=document[_0x17d312(0x1262)](_0x17d312(0x121b))[_0x17d312(0x1ebc)],_0x57677d=document[_0x17d312(0x1262)]('offline-ai-bold-text-color')[_0x17d312(0x1ebc)],_0x44157d=[{'type':'userNormal','color':_0x3946f8},{'type':_0x17d312(0x1a2a),'color':_0x19195c},{'type':_0x17d312(0xb75),'color':_0x11124f},{'type':_0x17d312(0x1d70),'color':_0x10958e},{'type':_0x17d312(0xbec),'color':_0x43c80d},{'type':_0x17d312(0x115a),'color':_0x57677d}];_0x44157d[_0x17d312(0x19fb)](({type:_0x5c5a4a,color:_0x5cbea8})=>{const _0x14df1a=_0x17d312;!offlineUISettings[_0x14df1a(0x10fa)][_0x5c5a4a]&&(offlineUISettings[_0x14df1a(0x10fa)][_0x5c5a4a]=[]),!offlineUISettings[_0x14df1a(0x10fa)][_0x5c5a4a][_0x14df1a(0x1831)](_0x5cbea8)&&offlineUISettings[_0x14df1a(0x10fa)][_0x5c5a4a]['push'](_0x5cbea8),offlineUISettings[_0x14df1a(0x10fa)][_0x5c5a4a]['length']>0xa&&(offlineUISettings['savedColors'][_0x5c5a4a]=offlineUISettings['savedColors'][_0x5c5a4a]['slice'](-0xa));}),updateSavedColorsDisplay(),showToast(_0x17d312(0xd4b),_0x17d312(0x11cb));}function resetOfflineColors(){const _0x263f71=_0x211817;document[_0x263f71(0x1262)](_0x263f71(0xa7c))[_0x263f71(0x1ebc)]=_0x263f71(0x4ea),document[_0x263f71(0x1262)](_0x263f71(0x252))[_0x263f71(0x1ebc)]=_0x263f71(0x7ae),document[_0x263f71(0x1262)]('offline-bubble-opacity')[_0x263f71(0x1ebc)]=0.9,document[_0x263f71(0x1262)](_0x263f71(0x2172))[_0x263f71(0x13be)]='90%',document[_0x263f71(0x1262)]('offline-font-size')[_0x263f71(0x1ebc)]=0xf,document[_0x263f71(0x1262)]('offline-font-size-value')['textContent']=_0x263f71(0x1a05),document[_0x263f71(0x1262)]('offline-user-normal-text-color')['value']=_0x263f71(0x1cf5),document['getElementById'](_0x263f71(0x114c))[_0x263f71(0x1ebc)]='#333333',document[_0x263f71(0x1262)](_0x263f71(0x15a4))[_0x263f71(0x1ebc)]=_0x263f71(0x1cf5),document[_0x263f71(0x1262)](_0x263f71(0xa5b))[_0x263f71(0x1ebc)]=_0x263f71(0x1cf5),document['getElementById'](_0x263f71(0x121b))['value']=_0x263f71(0x2135),document[_0x263f71(0x1262)](_0x263f71(0x58b))['value']=_0x263f71(0x1b19),updateOfflinePreview(),showToast('颜色已重置为默认',_0x263f71(0x11cb));}async function saveOfflineUISettings(){const _0xf6ed24=_0x211817,_0x2ebba8=currentChatCharacter['id'];try{offlineUISettings={'myBubbleColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0xa7c))[_0xf6ed24(0x1ebc)],'aiBubbleColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0x252))[_0xf6ed24(0x1ebc)],'bubbleOpacity':parseFloat(document[_0xf6ed24(0x1262)]('offline-bubble-opacity')['value']),'fontSize':parseInt(document['getElementById'](_0xf6ed24(0x10c6))[_0xf6ed24(0x1ebc)]),'wallpaperData':offlineUISettings['wallpaperData']||'','fontFamily':document['getElementById']('offline-font-select')[_0xf6ed24(0x1ebc)],'fontUrl':document[_0xf6ed24(0x1262)](_0xf6ed24(0xcd8))[_0xf6ed24(0x1ebc)][_0xf6ed24(0x19d7)](),'realFontName':window['previewedFontName']||'','userNormalTextColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0x1eb9))[_0xf6ed24(0x1ebc)],'userItalicTextColor':document['getElementById'](_0xf6ed24(0x114c))[_0xf6ed24(0x1ebc)],'userBoldTextColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0x15a4))[_0xf6ed24(0x1ebc)],'aiNormalTextColor':document[_0xf6ed24(0x1262)]('offline-ai-normal-text-color')[_0xf6ed24(0x1ebc)],'aiItalicTextColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0x121b))[_0xf6ed24(0x1ebc)],'aiBoldTextColor':document[_0xf6ed24(0x1262)](_0xf6ed24(0x58b))['value'],'showUserAvatar':document[_0xf6ed24(0x1262)]('offline-show-user-avatar')['checked'],'showAiAvatar':document['getElementById'](_0xf6ed24(0x144c))[_0xf6ed24(0x14c1)],'avatarPosition':document[_0xf6ed24(0xb30)](_0xf6ed24(0x1597))[_0xf6ed24(0x1ebc)],'bubbleWidth':document[_0xf6ed24(0xb30)](_0xf6ed24(0x18e6))[_0xf6ed24(0x1ebc)],'bubbleStyle':document[_0xf6ed24(0xb30)]('input[name=\x22offline-bubble-style\x22]:checked')[_0xf6ed24(0x1ebc)],'customCSS':document[_0xf6ed24(0x1262)](_0xf6ed24(0x1d6d))[_0xf6ed24(0x1ebc)][_0xf6ed24(0x19d7)](),'savedColors':offlineUISettings[_0xf6ed24(0x10fa)]||{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},await saveOfflineUISettingsToDB(),applyOfflineUISettings(),closeOfflineUISettings(),showToast(_0xf6ed24(0x38e),_0xf6ed24(0x11cb));}catch(_0x1a9685){console['error'](_0xf6ed24(0x24d),_0x1a9685),showToast(_0xf6ed24(0x1397),_0xf6ed24(0x174a));}}async function saveOfflineUISettingsToDB(){const _0xe4d21a=_0x211817;if(!currentChatCharacter||!offlineUISettings)return;const _0x4a805c=currentChatCharacter['id'];let _0x43200d=![],_0x2676f2=![];try{const _0x1d3844=windowId?_0x4a805c+'_'+windowId+_0xe4d21a(0x21c1):_0x4a805c+_0xe4d21a(0x21c1);await db[_0xe4d21a(0x1486)]['put']({'id':_0x1d3844,'characterId':_0x4a805c,'windowId':windowId||null,'settings':offlineUISettings,'timestamp':Date[_0xe4d21a(0x2eb)]()}),_0x43200d=!![],console['log'](_0xe4d21a(0x2050)+_0x1d3844+')');}catch(_0x362174){console[_0xe4d21a(0x1f43)](_0xe4d21a(0x1441),_0x362174);}try{const _0x381467=windowId?_0xe4d21a(0xc39)+_0x4a805c+'_'+windowId:'offlineUISettings_'+_0x4a805c;localStorage[_0xe4d21a(0x192)](_0x381467,JSON[_0xe4d21a(0x6b8)](offlineUISettings)),_0x2676f2=!![],console[_0xe4d21a(0x2187)](_0xe4d21a(0xc28)+_0x381467+')');}catch(_0x2f9b1f){console[_0xe4d21a(0x1f43)]('❌\x20保存到localStorage失败:',_0x2f9b1f);}if(!_0x43200d&&!_0x2676f2)throw new Error('所有保存方式都失败了');}function applyOfflineUISettings(){const _0x156a27=_0x211817;if(!offlineUISettings||!currentChatCharacter)return;const _0x137bda=document[_0x156a27(0x1262)]('offline-mode-overlay');if(!_0x137bda)return;const _0x4db1be=_0x137bda[_0x156a27(0xb30)](_0x156a27(0x114a));_0x4db1be&&(_0x4db1be[_0x156a27(0x14eb)][_0x156a27(0x159c)]='',_0x4db1be['style'][_0x156a27(0x577)]='');const _0x48f7d8=offlineUISettings['myBubbleColor']||_0x156a27(0xa44),_0x2f74fc=offlineUISettings[_0x156a27(0xeaf)]||_0x156a27(0x7ae),_0x5076cb=offlineUISettings[_0x156a27(0x1d83)]!==undefined?offlineUISettings[_0x156a27(0x1d83)]:0.9,_0x588d4c=offlineUISettings[_0x156a27(0x1a98)]||_0x156a27(0xbd6),_0x142556=offlineUISettings[_0x156a27(0x61d)]||'#f0f0f0',_0x58813b=offlineUISettings[_0x156a27(0x326)]||_0x156a27(0xbd6),_0x2a2bd5=offlineUISettings[_0x156a27(0xf1b)]||'#000000',_0x31ec6c=offlineUISettings[_0x156a27(0xed4)]||_0x156a27(0x2135),_0x7af5a9=offlineUISettings['aiBoldTextColor']||_0x156a27(0x1b19),_0x522ed1=_0x137bda['querySelectorAll'](_0x156a27(0x1e7e)),_0x45a4b8=_0x137bda['querySelectorAll'](_0x156a27(0x2006));_0x522ed1[_0x156a27(0x19fb)](_0x31c84b=>{const _0x6729c3=_0x156a27,_0x494bb5=convertColorWithOpacity(_0x48f7d8,_0x5076cb);_0x31c84b[_0x6729c3(0x14eb)][_0x6729c3(0x577)]=_0x494bb5,_0x31c84b[_0x6729c3(0x14eb)][_0x6729c3(0x11af)]=0x1,_0x31c84b['style'][_0x6729c3(0xc3d)]=_0x588d4c;const _0x1b0d29=_0x31c84b[_0x6729c3(0x1897)]('em'),_0x13d09f=_0x31c84b[_0x6729c3(0x1897)](_0x6729c3(0x16a1));_0x1b0d29[_0x6729c3(0x19fb)](_0x4c1894=>_0x4c1894['style'][_0x6729c3(0xc3d)]=_0x142556),_0x13d09f['forEach'](_0xa6d7ea=>_0xa6d7ea['style'][_0x6729c3(0xc3d)]=_0x58813b);}),_0x45a4b8['forEach'](_0x569ae0=>{const _0x5676cf=_0x156a27,_0x47593b=convertColorWithOpacity(_0x2f74fc,_0x5076cb);_0x569ae0[_0x5676cf(0x14eb)][_0x5676cf(0x577)]=_0x47593b,_0x569ae0[_0x5676cf(0x14eb)][_0x5676cf(0x11af)]=0x1,_0x569ae0[_0x5676cf(0x14eb)]['color']=_0x2a2bd5;const _0x44ba65=_0x569ae0[_0x5676cf(0x1897)]('em'),_0x2f0081=_0x569ae0['querySelectorAll'](_0x5676cf(0x16a1));_0x44ba65['forEach'](_0xa82be0=>_0xa82be0['style']['color']=_0x31ec6c),_0x2f0081[_0x5676cf(0x19fb)](_0x14c854=>_0x14c854[_0x5676cf(0x14eb)][_0x5676cf(0xc3d)]=_0x7af5a9);});_0x4db1be&&offlineUISettings[_0x156a27(0x22e3)]&&(_0x4db1be[_0x156a27(0x14eb)][_0x156a27(0x159c)]='url('+offlineUISettings['wallpaperData']+')',_0x4db1be['style']['backgroundSize']='cover',_0x4db1be[_0x156a27(0x14eb)][_0x156a27(0x1530)]=_0x156a27(0xcef),_0x4db1be[_0x156a27(0x14eb)][_0x156a27(0x1e2d)]=_0x156a27(0x19a4));const _0x5dcd1a=_0x156a27(0x6e7)+currentChatCharacter['id'],_0x216078=document[_0x156a27(0x1262)](_0x156a27(0x1963)+currentChatCharacter['id']);_0x216078&&_0x216078[_0x156a27(0x1493)]();const _0x70050f=document[_0x156a27(0x1262)]('offline-font-link-'+currentChatCharacter['id']);_0x70050f&&_0x70050f['remove']();if(offlineUISettings['fontFamily']==='custom'&&offlineUISettings['fontUrl']){const _0xcfed32=offlineUISettings[_0x156a27(0x101c)];if(_0xcfed32[_0x156a27(0x1831)](_0x156a27(0xa96))||_0xcfed32[_0x156a27(0x1831)](_0x156a27(0x15ab))||_0xcfed32[_0x156a27(0x81f)](_0x156a27(0x501))||_0xcfed32[_0x156a27(0x1831)](_0x156a27(0xd47))||_0xcfed32[_0x156a27(0x1831)](_0x156a27(0x2166))){const _0x480fc1=document[_0x156a27(0xac6)](_0x156a27(0x9d6));_0x480fc1['id']=_0x156a27(0x1f26)+currentChatCharacter['id'],_0x480fc1[_0x156a27(0xfcb)]='stylesheet',_0x480fc1[_0x156a27(0x1f9)]=_0xcfed32,_0x480fc1['onload']=function(){const _0x13a2e5=_0x156a27;let _0x9e1b6f=offlineUISettings[_0x13a2e5(0x1565)]||extractFontFamilyFromGoogleFonts(_0xcfed32)||_0x13a2e5(0x1f47);if(!offlineUISettings[_0x13a2e5(0x1565)])try{const _0x428003=document['styleSheets'];for(let _0x520c09=_0x428003[_0x13a2e5(0x19ee)]-0x1;_0x520c09>=0x0;_0x520c09--){const _0x112d73=_0x428003[_0x520c09];if(_0x112d73['href']===_0xcfed32){try{const _0x59b575=_0x112d73[_0x13a2e5(0x13a4)]||_0x112d73[_0x13a2e5(0x17e4)];for(let _0x3e86ce=0x0;_0x3e86ce<_0x59b575[_0x13a2e5(0x19ee)];_0x3e86ce++){const _0x1c34b0=_0x59b575[_0x3e86ce];if(_0x1c34b0[_0x13a2e5(0x1a4b)]===CSSRule[_0x13a2e5(0x639)]&&_0x1c34b0[_0x13a2e5(0x14eb)][_0x13a2e5(0x1d58)]){_0x9e1b6f=_0x1c34b0[_0x13a2e5(0x14eb)][_0x13a2e5(0x1d58)][_0x13a2e5(0xe16)](/['"]/g,''),console[_0x13a2e5(0x2187)](_0x13a2e5(0xaa4),_0x9e1b6f);break;}}}catch(_0x1640f7){console['log'](_0x13a2e5(0x313));}break;}}}catch(_0x264373){console[_0x13a2e5(0x2187)]('🎨\x20应用设置时CSS解析失败，使用提取的名称');}else console[_0x13a2e5(0x2187)](_0x13a2e5(0x9b6),_0x9e1b6f);const _0x55fb18=document[_0x13a2e5(0xac6)](_0x13a2e5(0x14eb));_0x55fb18['id']='offline-font-'+currentChatCharacter['id'],_0x55fb18[_0x13a2e5(0x13be)]=_0x13a2e5(0x60b)+_0x9e1b6f+_0x13a2e5(0xd99),document['head'][_0x13a2e5(0x497)](_0x55fb18),console[_0x13a2e5(0x2187)](_0x13a2e5(0x551),_0x9e1b6f);},document[_0x156a27(0x65a)][_0x156a27(0x497)](_0x480fc1);}else{const _0x24d88f=document[_0x156a27(0xac6)]('style');_0x24d88f['id']='offline-font-'+currentChatCharacter['id'],_0x24d88f[_0x156a27(0x13be)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27'+_0x5dcd1a+'\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x27'+_0xcfed32+_0x156a27(0x87d)+_0x5dcd1a+'\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',document[_0x156a27(0x65a)]['appendChild'](_0x24d88f),console[_0x156a27(0x2187)](_0x156a27(0x551),_0x5dcd1a);}}else{if(globalFontSettings&&globalFontSettings['isApplied']&&globalFontSettings[_0x156a27(0x2054)]){const _0x15698a=document['createElement'](_0x156a27(0x14eb));_0x15698a['id']=_0x156a27(0x1963)+currentChatCharacter['id'],_0x15698a[_0x156a27(0x13be)]=_0x156a27(0x7c4)+globalFontSettings[_0x156a27(0x2054)]+_0x156a27(0x1367),document[_0x156a27(0x65a)][_0x156a27(0x497)](_0x15698a),console[_0x156a27(0x2187)](_0x156a27(0x779),globalFontSettings['fontName']);}}const _0x4e9fa2=_0x137bda['querySelectorAll'](_0x156a27(0x1deb));_0x4e9fa2[_0x156a27(0x19fb)](_0x422fa1=>{const _0x577533=_0x156a27,_0x199da0=_0x422fa1[_0x577533(0xb30)](_0x577533(0xdf2)),_0x5f315a=_0x422fa1[_0x577533(0xb30)]('.offline-avatar.ai-avatar');_0x422fa1['classList'][_0x577533(0x1493)](_0x577533(0x1bbe),_0x577533(0x1f90)),_0x199da0&&(_0x199da0[_0x577533(0x14eb)][_0x577533(0x4da)]=offlineUISettings['showUserAvatar']?_0x577533(0x1fb7):_0x577533(0x102b)),_0x5f315a&&(_0x5f315a[_0x577533(0x14eb)]['display']=offlineUISettings[_0x577533(0x1525)]?'flex':'none'),!offlineUISettings[_0x577533(0x1ec9)]&&_0x422fa1[_0x577533(0x1c1b)][_0x577533(0x21e2)]('no-user-avatar'),!offlineUISettings[_0x577533(0x1525)]&&_0x422fa1[_0x577533(0x1c1b)][_0x577533(0x21e2)]('no-ai-avatar');});if(offlineUISettings[_0x156a27(0xd6e)]===_0x156a27(0x1094)){const _0x4a67f5=_0x156a27(0x745)+currentChatCharacter['id'],_0x27d9b9=document[_0x156a27(0x1262)](_0x4a67f5);_0x27d9b9&&_0x27d9b9[_0x156a27(0x1493)]();}if(offlineUISettings[_0x156a27(0x1609)]===_0x156a27(0x3fc)){const _0x6a9873=_0x156a27(0xfc3)+currentChatCharacter['id'],_0x3c29af=document[_0x156a27(0x1262)](_0x6a9873);_0x3c29af&&_0x3c29af[_0x156a27(0x1493)]();const _0x4f06e0=document[_0x156a27(0xac6)](_0x156a27(0x14eb));_0x4f06e0['id']=_0x6a9873,_0x4f06e0[_0x156a27(0x13be)]=_0x156a27(0x16a8),document['head'][_0x156a27(0x497)](_0x4f06e0);}if(offlineUISettings[_0x156a27(0x1e65)]&&(offlineUISettings['avatarPosition']===_0x156a27(0x2b0)||offlineUISettings['bubbleWidth']==='custom'||offlineUISettings[_0x156a27(0x1813)]===_0x156a27(0x2b0))){const _0x55f432='offline-custom-'+currentChatCharacter['id'],_0x3958d9=document[_0x156a27(0x1262)](_0x55f432);_0x3958d9&&_0x3958d9[_0x156a27(0x1493)]();const _0x2a1ee9=document['createElement'](_0x156a27(0x14eb));_0x2a1ee9['id']=_0x55f432;const _0x3192a8=offlineUISettings[_0x156a27(0x1e65)][_0x156a27(0xe16)](/\.offline-/g,_0x156a27(0x12ad));_0x2a1ee9[_0x156a27(0x13be)]=_0x3192a8,document[_0x156a27(0x65a)][_0x156a27(0x497)](_0x2a1ee9);}if(offlineUISettings[_0x156a27(0x3f4)]!==undefined){const _0x215be3=_0x137bda[_0x156a27(0x1897)](_0x156a27(0x1f23));_0x215be3[_0x156a27(0x19fb)](_0x3f7b4d=>{const _0x28571d=_0x156a27;_0x3f7b4d[_0x28571d(0x14eb)][_0x28571d(0x3f4)]=offlineUISettings[_0x28571d(0x3f4)]+'px';});}}async function resetOfflineUISettings(){const _0x503062=_0x211817;if(confirm(_0x503062(0x21a1))){offlineUISettings={'myBubbleColor':_0x503062(0x4ea),'aiBubbleColor':_0x503062(0x7ae),'bubbleOpacity':0.9,'fontSize':0xf,'wallpaperData':'','fontFamily':'','fontUrl':'','userNormalTextColor':_0x503062(0x1cf5),'userItalicTextColor':_0x503062(0x1b19),'userBoldTextColor':'#000000','aiNormalTextColor':'#000000','aiItalicTextColor':_0x503062(0x2135),'aiBoldTextColor':'#333333','showUserAvatar':![],'showAiAvatar':![],'avatarPosition':_0x503062(0x3fc),'bubbleWidth':_0x503062(0x1094),'bubbleStyle':_0x503062(0x1094),'customCSS':'','savedColors':{'userNormal':[],'userItalic':[],'userBold':[],'aiNormal':[],'aiItalic':[],'aiBold':[]}},document['getElementById'](_0x503062(0x1a7c))[_0x503062(0x1ebc)]='';if(currentChatCharacter)try{await db[_0x503062(0x1486)][_0x503062(0x1f4a)](currentChatCharacter['id']+_0x503062(0x21c1)),console[_0x503062(0x2187)](_0x503062(0x372));}catch(_0xf442ce){console['error'](_0x503062(0x10e8),_0xf442ce);}updateOfflineUISettingsForm(),updateOfflinePreview(),showToast(_0x503062(0x2269),_0x503062(0x11cb));}}async function loadAndApplyOfflineUISettings(){const _0x582731=_0x211817;if(!currentChatCharacter)return;const _0x200666=currentChatCharacter['id'];try{let _0x33779e=![];try{let _0x4dc05b=null,_0x4c1bc4=null;windowId&&(_0x4c1bc4=_0x582731(0xc39)+_0x200666+'_'+windowId,_0x4dc05b=localStorage[_0x582731(0x15d8)](_0x4c1bc4)),!_0x4dc05b&&(_0x4c1bc4='offlineUISettings_'+_0x200666,_0x4dc05b=localStorage[_0x582731(0x15d8)](_0x4c1bc4)),_0x4dc05b&&(offlineUISettings=JSON['parse'](_0x4dc05b),_0x33779e=!![],console[_0x582731(0x2187)](_0x582731(0x1849)+_0x4c1bc4+')'));}catch(_0x50d924){console[_0x582731(0x1f43)](_0x582731(0x2075),_0x50d924);}if(!_0x33779e)try{let _0x26b4ef=null;windowId&&(_0x26b4ef=await db[_0x582731(0x1486)]['get'](_0x200666+'_'+windowId+_0x582731(0x21c1))),!_0x26b4ef&&(_0x26b4ef=await db['offlineUISettings'][_0x582731(0xb78)](_0x200666+'_ui_settings')),_0x26b4ef&&_0x26b4ef[_0x582731(0x1512)]&&(offlineUISettings=_0x26b4ef['settings'],_0x33779e=!![],console['log'](_0x582731(0x194b)));}catch(_0x385ccd){console[_0x582731(0x1f43)](_0x582731(0x1147),_0x385ccd);}_0x33779e&&(applyOfflineUISettings(),console[_0x582731(0x2187)](_0x582731(0x9cc)));}catch(_0x5dca9c){console['error'](_0x582731(0x16d9),_0x5dca9c);}}function selectAvatarPosition(_0x43e200,_0x5698ec){const _0x41b142=_0x211817,_0x503c2f=_0x5698ec[_0x41b142(0x148c)][_0x41b142(0x1897)](_0x41b142(0x955));_0x503c2f[_0x41b142(0x19fb)](_0x5cc134=>_0x5cc134[_0x41b142(0x1c1b)][_0x41b142(0x1493)]('selected')),_0x5698ec[_0x41b142(0x1c1b)][_0x41b142(0x21e2)](_0x41b142(0x176b));const _0x5cefee=_0x5698ec[_0x41b142(0x148c)]['querySelectorAll'](_0x41b142(0xf73));_0x5cefee[_0x41b142(0x19fb)](_0x1adcae=>{const _0x58f0aa=_0x41b142;_0x1adcae[_0x58f0aa(0x14c1)]=_0x1adcae[_0x58f0aa(0x1ebc)]===_0x43e200;});}function selectBubbleWidth(_0x26c431,_0x55df81){const _0x4c99bf=_0x211817,_0x1a8a84=_0x55df81[_0x4c99bf(0x148c)][_0x4c99bf(0x1897)](_0x4c99bf(0x955));_0x1a8a84[_0x4c99bf(0x19fb)](_0x3f6a43=>_0x3f6a43[_0x4c99bf(0x1c1b)][_0x4c99bf(0x1493)](_0x4c99bf(0x176b))),_0x55df81[_0x4c99bf(0x1c1b)][_0x4c99bf(0x21e2)](_0x4c99bf(0x176b));const _0x577b4c=_0x55df81['parentNode']['querySelectorAll'](_0x4c99bf(0x1cb0));_0x577b4c[_0x4c99bf(0x19fb)](_0xdba84e=>{const _0x3e6fca=_0x4c99bf;_0xdba84e[_0x3e6fca(0x14c1)]=_0xdba84e[_0x3e6fca(0x1ebc)]===_0x26c431;});}function selectBubbleStyle(_0x2f546,_0x29f904){const _0xffbb78=_0x211817,_0x1fd669=_0x29f904['parentNode']['querySelectorAll'](_0xffbb78(0x955));_0x1fd669[_0xffbb78(0x19fb)](_0x1f3b05=>_0x1f3b05[_0xffbb78(0x1c1b)][_0xffbb78(0x1493)](_0xffbb78(0x176b))),_0x29f904[_0xffbb78(0x1c1b)]['add']('selected');const _0x1a1727=_0x29f904[_0xffbb78(0x148c)][_0xffbb78(0x1897)](_0xffbb78(0x609));_0x1a1727[_0xffbb78(0x19fb)](_0x5bb1d9=>{const _0x25c05f=_0xffbb78;_0x5bb1d9[_0x25c05f(0x14c1)]=_0x5bb1d9['value']===_0x2f546;});}document['addEventListener'](_0x211817(0x20f0),function(){const _0x35cffd=_0x211817,_0x4b13ce=document[_0x35cffd(0x1262)]('phone-screen');if(!_0x4b13ce)return;if(document[_0x35cffd(0x5e6)]==='visible'){console[_0x35cffd(0x2187)](_0x35cffd(0x1075)),_0x4b13ce[_0x35cffd(0x14eb)]['animationPlayState']='running';const _0x4c0fc3=document[_0x35cffd(0x1897)](_0x35cffd(0x1eb6));_0x4c0fc3[_0x35cffd(0x19fb)](_0x1e71f5=>_0x1e71f5[_0x35cffd(0x14eb)][_0x35cffd(0x698)]='running'),_0x4b13ce[_0x35cffd(0x14eb)][_0x35cffd(0x11af)]=_0x35cffd(0x1f7c),setTimeout(()=>{const _0x40f985=_0x35cffd;_0x4b13ce['style'][_0x40f985(0x11af)]='1';},0x10);if(typeof updateTime===_0x35cffd(0xe59)){}}else{console['log'](_0x35cffd(0x2315)),_0x4b13ce['style'][_0x35cffd(0x698)]='paused';const _0x53fdf0=document[_0x35cffd(0x1897)]('[style*=\x22animation\x22]');_0x53fdf0[_0x35cffd(0x19fb)](_0x544b3b=>_0x544b3b[_0x35cffd(0x14eb)]['animationPlayState']=_0x35cffd(0x434));}});function showMakeNewsModal(){const _0x99a579=_0x211817,_0x113cdf=_0x99a579(0x1d55);document[_0x99a579(0x1da9)][_0x99a579(0x1b7)](_0x99a579(0x42e),_0x113cdf),setTimeout(()=>document[_0x99a579(0x1262)](_0x99a579(0x17a3))[_0x99a579(0x13cf)](),0x64);}function submitMakeNews(){const _0x468ba=_0x211817,_0x4c6b83=document[_0x468ba(0x1262)]('news-content-input'),_0x231611=_0x4c6b83[_0x468ba(0x1ebc)][_0x468ba(0x19d7)]();if(!_0x231611){alert(_0x468ba(0x1cc3));return;}worldEvent={'content':_0x231611,'expires':Date[_0x468ba(0x2eb)]()+0x18*0x3c*0x3c*0x3e8};const _0xa7d268=document['getElementById']('make-news-modal');if(_0xa7d268)_0xa7d268['remove']();showToast(_0x468ba(0xe12),'success'),refreshPosts();}function switchProfileTab(_0x318699){const _0x4e9ed2=_0x211817,_0x2950e5=document[_0x4e9ed2(0x1262)](_0x4e9ed2(0xffb)),_0x3fc7fd=document[_0x4e9ed2(0x1262)]('favorite-posts-list'),_0x304e93=document['querySelectorAll'](_0x4e9ed2(0x1084));_0x304e93[_0x4e9ed2(0x19fb)](_0x3ed264=>_0x3ed264[_0x4e9ed2(0x1c1b)]['remove'](_0x4e9ed2(0x1a14))),document[_0x4e9ed2(0xb30)](_0x4e9ed2(0x2cb)+_0x318699+'\x22]')[_0x4e9ed2(0x1c1b)][_0x4e9ed2(0x21e2)](_0x4e9ed2(0x1a14)),_0x318699===_0x4e9ed2(0x1900)?(_0x2950e5[_0x4e9ed2(0x14eb)][_0x4e9ed2(0x4da)]=_0x4e9ed2(0x13de),_0x3fc7fd[_0x4e9ed2(0x14eb)]['display']='none'):(_0x2950e5['style'][_0x4e9ed2(0x4da)]=_0x4e9ed2(0x102b),_0x3fc7fd[_0x4e9ed2(0x14eb)][_0x4e9ed2(0x4da)]=_0x4e9ed2(0x13de)),isForumMultiSelectMode&&(selectedPostIds[_0x4e9ed2(0xa4f)](),renderPostsWithCheckboxes(),updateDeleteButtonState());}async function showSharePostModal(){const _0x5c24d2=_0x211817,_0x173561=[];characters[_0x5c24d2(0x19fb)](_0x3330f9=>{const _0x24c71f=_0x5c24d2;contacts['includes'](_0x3330f9['id'])&&_0x173561[_0x24c71f(0x1cd6)]({'id':_0x3330f9['id'],'name':_0x3330f9['name'],'avatarUrl':_0x3330f9[_0x24c71f(0x1994)],'isGroup':![]});}),groupChats['forEach'](_0x38673c=>{const _0x130285=_0x5c24d2;_0x173561[_0x130285(0x1cd6)]({'id':_0x38673c['id'],'name':_0x38673c['name'],'avatarUrl':_0x38673c[_0x130285(0x1994)],'isGroup':!![]});});const _0x56e1d7='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22share-post-modal\x22\x20class=\x22modal\x22\x20style=\x22display:\x20flex;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22modal-title\x22>分享到...</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22modal-close\x22\x20onclick=\x22this.closest(\x27.modal\x27).remove()\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-body\x22\x20style=\x22max-height:\x20400px;\x20overflow-y:\x20auto;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x173561[_0x5c24d2(0x6a4)](_0x416122=>_0x5c24d2(0x1fad)+_0x416122['id']+_0x5c24d2(0xafe)+(_0x416122['avatarUrl']||createDefaultAvatar(_0x416122[_0x5c24d2(0x1a1c)]))+_0x5c24d2(0x1aff)+(_0x416122[_0x5c24d2(0x1f68)]&&!_0x416122[_0x5c24d2(0x1994)]?'群':'')+_0x5c24d2(0x215a)+_0x416122[_0x5c24d2(0x1a1c)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x5c24d2(0x122b)]('')+_0x5c24d2(0x1027);document['body'][_0x5c24d2(0x1b7)](_0x5c24d2(0x42e),_0x56e1d7);}async function sharePostToChat(_0xd3b74d){const _0x1f278c=_0x211817;if(!window[_0x1f278c(0x6b7)])return;try{const _0x3ff63f=await db[_0x1f278c(0x14c4)][_0x1f278c(0xb78)](window['currentPostId']);if(!_0x3ff63f){showToast('帖子不存在',_0x1f278c(0x174a));return;}const _0x1f30c4=await db[_0x1f278c(0x2147)]['get'](parseInt(currentForumId)),_0x30002b=personas['find'](_0x28d37f=>_0x28d37f['id']===_0x1f30c4['personaId']),_0x6beae9=await db['forumReplies'][_0x1f278c(0xa24)](_0x1f278c(0x9fc))[_0x1f278c(0x1694)](window[_0x1f278c(0x6b7)])[_0x1f278c(0xd90)]('timestamp');let _0x30ccc2=_0x1f278c(0x2095)+_0x3ff63f[_0x1f278c(0x378)]+'\x0a\x0a【作者】'+_0x3ff63f[_0x1f278c(0xa42)]+_0x1f278c(0x2096)+_0x3ff63f['content'];_0x6beae9&&_0x6beae9[_0x1f278c(0x19ee)]>0x0&&(_0x30ccc2+=_0x1f278c(0x20fd),_0x6beae9[_0x1f278c(0x19fb)]((_0x42a392,_0xca1744)=>{const _0x420290=_0x1f278c,_0x570efa=new Date(_0x42a392[_0x420290(0x1716)])['toLocaleString']('zh-CN',{'month':_0x420290(0xc79),'day':_0x420290(0xc79),'hour':_0x420290(0xc79),'minute':_0x420290(0xc79)});let _0x42bb8a=_0x42a392[_0x420290(0xa42)];if(_0x42a392[_0x420290(0x15a6)]&&_0x42a392[_0x420290(0x22d2)]===_0x420290(0xa80))_0x42bb8a=_0x42a392['authorName'];else _0x42a392['authorId']===_0x420290(0xa80)&&!_0x42a392[_0x420290(0x15a6)]&&(_0x42bb8a=_0x30002b?_0x30002b[_0x420290(0x1a1c)]:_0x42a392['authorName']);_0x30ccc2+='\x0a'+(_0xca1744+0x1)+'楼\x20'+_0x42bb8a+'\x20('+_0x570efa+_0x420290(0x17d1)+_0x42a392[_0x420290(0x211c)]+'\x0a';}));const _0x5cf4c8=(_0x3ff63f[_0x1f278c(0x211c)]||'')[_0x1f278c(0xe16)](/<[^>]*>/g,'\x20')[_0x1f278c(0xe16)](/\s+/g,'\x20')[_0x1f278c(0x19d7)](),_0x31e2fa={'id':Date['now']()[_0x1f278c(0x1878)](),'sender':_0x1f278c(0x1e6d),'type':_0x1f278c(0xa0c),'postData':{'id':_0x3ff63f['id'],'title':_0x3ff63f['title'],'authorName':_0x3ff63f[_0x1f278c(0xa42)],'content':_0x5cf4c8,'replies':_0x6beae9},'timestamp':Date[_0x1f278c(0x2eb)](),'senderName':_0x30002b[_0x1f278c(0x1a1c)],'content':_0x30ccc2};!chatMessages[_0xd3b74d]&&(chatMessages[_0xd3b74d]=[]);chatMessages[_0xd3b74d]['push'](_0x31e2fa);try{const _0x283715=_0xd3b74d+'_'+_0x31e2fa['id']+'_'+(chatMessages[_0xd3b74d][_0x1f278c(0x19ee)]-0x1);await db[_0x1f278c(0x19a2)]['add']({'id':_0x283715,'characterId':_0xd3b74d,'timestamp':_0x31e2fa[_0x1f278c(0x1716)],'messageOrder':chatMessages[_0xd3b74d][_0x1f278c(0x19ee)]-0x1,'originalMessageId':_0x31e2fa['id'],'messageData':_0x31e2fa}),console[_0x1f278c(0x2187)](_0x1f278c(0x1cd7));}catch(_0x1ee9b6){console[_0x1f278c(0x174a)](_0x1f278c(0xee2),_0x1ee9b6),await saveChatMessages();}const _0x29c766=document[_0x1f278c(0x1262)]('share-post-modal');if(_0x29c766)_0x29c766[_0x1f278c(0x1493)]();showToast('成功分享到对话！',_0x1f278c(0x11cb)),currentChatCharacter&&currentChatCharacter['id']===_0xd3b74d&&renderChatMessages(_0xd3b74d),renderMessageList();}catch(_0x521fad){console[_0x1f278c(0x174a)](_0x1f278c(0xc7b),_0x521fad),showToast('分享失败',_0x1f278c(0x174a));}}document[_0x211817(0x21e9)](_0x211817(0x20dc),function(){const _0x3b1da5=_0x211817,_0x4b3758=document[_0x3b1da5(0x1262)]('local-music-input');_0x4b3758&&_0x4b3758[_0x3b1da5(0x21e9)](_0x3b1da5(0x5af),function(_0x17d855){const _0x2ef328=_0x3b1da5,_0x266764=_0x17d855[_0x2ef328(0x193d)][_0x2ef328(0xf26)][0x0];if(_0x266764){const _0x18620f=document[_0x2ef328(0x1262)](_0x2ef328(0x2190)),_0x52d939=document[_0x2ef328(0x1262)](_0x2ef328(0x193e));_0x18620f['placeholder']=_0x2ef328(0x6a3)+_0x266764[_0x2ef328(0x1a1c)],_0x18620f[_0x2ef328(0x14eb)][_0x2ef328(0xc3d)]=_0x2ef328(0xa44),_0x18620f[_0x2ef328(0x1ebc)]='',!_0x52d939['value'][_0x2ef328(0x19d7)]()&&(_0x52d939[_0x2ef328(0x1ebc)]=_0x266764['name'][_0x2ef328(0xe16)](/\.[^/.]+$/,''));}});const _0x1abd17=document[_0x3b1da5(0x1262)](_0x3b1da5(0x546));_0x1abd17&&_0x1abd17[_0x3b1da5(0x21e9)](_0x3b1da5(0x5af),function(_0x162fbe){const _0x1aec6a=_0x3b1da5,_0x36a79d=_0x162fbe[_0x1aec6a(0x193d)][_0x1aec6a(0xf26)][0x0];if(_0x36a79d){const _0x94dd52=document[_0x1aec6a(0x1262)](_0x1aec6a(0x699)),_0x32b2aa=_0x36a79d[_0x1aec6a(0x1a1c)][_0x1aec6a(0x49e)]();let _0x21c22b='歌词文件';if(_0x32b2aa[_0x1aec6a(0x81f)](_0x1aec6a(0x1841)))_0x21c22b=_0x1aec6a(0xd6b);else{if(_0x32b2aa[_0x1aec6a(0x81f)]('.bin'))_0x21c22b=_0x1aec6a(0x16d6);else _0x32b2aa[_0x1aec6a(0x81f)](_0x1aec6a(0xbef))?_0x21c22b=_0x1aec6a(0xb3a):(_0x21c22b='文件',console[_0x1aec6a(0x2187)]('选择的文件可能不是标准歌词格式，但仍会尝试处理:',_0x36a79d[_0x1aec6a(0x1a1c)]));}_0x94dd52&&(_0x94dd52[_0x1aec6a(0x13be)]=_0x1aec6a(0x328)+_0x21c22b+':\x20'+_0x36a79d[_0x1aec6a(0x1a1c)],_0x94dd52['style'][_0x1aec6a(0x4da)]=_0x1aec6a(0x13de),_0x94dd52['style'][_0x1aec6a(0xc3d)]=_0x1aec6a(0xa44));}});});function closeModal(){const _0x48d761=_0x211817,_0x3443b7=document[_0x48d761(0xb30)]('.modal-overlay');_0x3443b7&&_0x3443b7['remove']();}function clearVoteHistory(){const _0x233280=_0x211817;if(confirm(_0x233280(0x2248)))try{Object[_0x233280(0x1c9f)](localStorage)[_0x233280(0x1e1f)](_0x29f472=>_0x29f472['startsWith']('poll_voted_')||_0x29f472[_0x233280(0x1b30)](_0x233280(0x545)))[_0x233280(0x19fb)](_0x21b22b=>localStorage['removeItem'](_0x21b22b)),showToast(_0x233280(0x2057),_0x233280(0x11cb)),closeModal();}catch(_0x156def){console[_0x233280(0x174a)](_0x233280(0xee8),_0x156def),showToast(_0x233280(0xd45),'error');}}let isForumMultiSelectMode=![],selectedPostIds=new Set();function toggleMultiSelectMode(){const _0x49ff61=_0x211817;isForumMultiSelectMode=!isForumMultiSelectMode,selectedPostIds[_0x49ff61(0xa4f)]();const _0x42c7e5=document[_0x49ff61(0x1262)](_0x49ff61(0xada)),_0x4c76f1=_0x42c7e5[_0x49ff61(0xb30)]('i');isForumMultiSelectMode?(_0x4c76f1[_0x49ff61(0x1722)]=_0x49ff61(0x7c5),_0x42c7e5['title']='退出多选',_0x42c7e5[_0x49ff61(0x14eb)][_0x49ff61(0xc3d)]='#ff3b30',renderPostsWithCheckboxes(),showDeleteButton()):(_0x4c76f1[_0x49ff61(0x1722)]=_0x49ff61(0x19e2),_0x42c7e5['title']=_0x49ff61(0x192c),_0x42c7e5[_0x49ff61(0x14eb)][_0x49ff61(0xc3d)]='',showForumProfile(),hideDeleteButton());}async function renderPostsWithCheckboxes(){const _0x5298c0=_0x211817,_0x4645ad=document[_0x5298c0(0xb30)](_0x5298c0(0xcaf))[_0x5298c0(0x13be)];_0x4645ad==='我的帖子'?await renderMyPostsWithCheckboxes():await renderFavoritePostsWithCheckboxes();}async function renderMyPostsWithCheckboxes(){const _0x507fcd=_0x211817,_0x1770a8=document[_0x507fcd(0x1262)](_0x507fcd(0xffb)),_0x532376=await db['forumPosts'][_0x507fcd(0xf13)](),_0x982140=_0x532376[_0x507fcd(0x1e1f)](_0x307a20=>_0x307a20[_0x507fcd(0x680)]===!![])[_0x507fcd(0x1104)]((_0x173067,_0xc35862)=>_0xc35862['timestamp']-_0x173067[_0x507fcd(0x1716)]);if(_0x982140[_0x507fcd(0x19ee)]===0x0){_0x1770a8[_0x507fcd(0x33a)]=_0x507fcd(0xcae);return;}const _0x5b5204=await Promise['all'](_0x982140[_0x507fcd(0x6a4)](async _0x1ab05c=>{const _0x38dc20=_0x507fcd,_0x55edd5=await db['forumPostImages'][_0x38dc20(0xa24)](_0x38dc20(0x9fc))[_0x38dc20(0x1694)](_0x1ab05c['id'])[_0x38dc20(0xc44)]()>0x0,_0x36a36d=selectedPostIds['has'](_0x1ab05c['id']);return _0x38dc20(0x12ee)+(_0x36a36d?_0x38dc20(0x176b):'')+_0x38dc20(0x11f8)+_0x1ab05c['id']+_0x38dc20(0x1b2c)+_0x1ab05c['id']+',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<i\x20class=\x22fas\x20'+(_0x36a36d?_0x38dc20(0x852):_0x38dc20(0xa95))+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1ab05c['title']+_0x38dc20(0xbe0)+(_0x55edd5?_0x38dc20(0x7fa):'')+_0x38dc20(0x12b6)+_0x1ab05c['authorName']+_0x38dc20(0x1212)+formatTime(_0x1ab05c['timestamp'])+_0x38dc20(0xdbf);}));_0x1770a8[_0x507fcd(0x33a)]=_0x5b5204['join']('');}async function renderFavoritePostsWithCheckboxes(){const _0x4e184b=_0x211817,_0x334fb7=document[_0x4e184b(0x1262)](_0x4e184b(0x1e92)),_0x231a81=await db[_0x4e184b(0x145c)][_0x4e184b(0xa24)](_0x4e184b(0x3c3))[_0x4e184b(0x1694)](_0x4e184b(0xa80))[_0x4e184b(0xf13)](),_0x495908=_0x231a81[_0x4e184b(0x6a4)](_0x72a079=>_0x72a079[_0x4e184b(0x9fc)]);if(_0x495908[_0x4e184b(0x19ee)]===0x0){_0x334fb7[_0x4e184b(0x33a)]=_0x4e184b(0x766);return;}const _0x2a4a1e=await db[_0x4e184b(0x14c4)]['where']('id')[_0x4e184b(0x1fa1)](_0x495908)[_0x4e184b(0xf13)](),_0x7bf3b1=await Promise[_0x4e184b(0x1a47)](_0x2a4a1e[_0x4e184b(0x1104)]((_0x369c96,_0x38fe3c)=>_0x38fe3c[_0x4e184b(0x1716)]-_0x369c96[_0x4e184b(0x1716)])[_0x4e184b(0x6a4)](async _0x252d80=>{const _0x1cc661=_0x4e184b,_0xe1679a=await db[_0x1cc661(0x1867)][_0x1cc661(0xa24)]('postId')['equals'](_0x252d80['id'])['count']()>0x0,_0x4beb21=selectedPostIds[_0x1cc661(0x975)](_0x252d80['id']);return _0x1cc661(0x12ee)+(_0x4beb21?_0x1cc661(0x176b):'')+'\x22\x20data-post-id=\x22'+_0x252d80['id']+_0x1cc661(0x1b2c)+_0x252d80['id']+_0x1cc661(0x135e)+(_0x4beb21?'fa-check-square':_0x1cc661(0xa95))+'\x22></i>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-title\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x252d80['title']+_0x1cc661(0xbe0)+(_0xe1679a?_0x1cc661(0x7fa):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x252d80[_0x1cc661(0x680)]?_0x1cc661(0x3d3):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22post-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22post-author\x22>'+_0x252d80[_0x1cc661(0xa42)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+formatTime(_0x252d80[_0x1cc661(0x1716)])+_0x1cc661(0xdbf);}));_0x334fb7[_0x4e184b(0x33a)]=_0x7bf3b1[_0x4e184b(0x122b)]('');}function togglePostSelection(_0x205566,_0x4e3867){const _0x135921=_0x211817;_0x4e3867[_0x135921(0x902)]();const _0xaca35a=document['querySelector'](_0x135921(0x2195)+_0x205566+'\x22]'),_0x2006f5=_0xaca35a[_0x135921(0xb30)](_0x135921(0x4f5));selectedPostIds[_0x135921(0x975)](_0x205566)?(selectedPostIds[_0x135921(0x1f4a)](_0x205566),_0xaca35a[_0x135921(0x1c1b)]['remove'](_0x135921(0x176b)),_0x2006f5['className']=_0x135921(0x2102)):(selectedPostIds[_0x135921(0x21e2)](_0x205566),_0xaca35a[_0x135921(0x1c1b)][_0x135921(0x21e2)](_0x135921(0x176b)),_0x2006f5['className']='fas\x20fa-check-square'),updateDeleteButtonState();}function showDeleteButton(){const _0x34a26a=_0x211817,_0x277474=document[_0x34a26a(0x1262)](_0x34a26a(0x17e0));if(_0x277474)return;const _0x288c12=document[_0x34a26a(0xac6)]('div');_0x288c12['id']='multi-delete-btn',_0x288c12['className']=_0x34a26a(0x1ff0),_0x288c12[_0x34a26a(0x33a)]=_0x34a26a(0x8d8),document['getElementById']('forum-profile-screen')[_0x34a26a(0x497)](_0x288c12);}function hideDeleteButton(){const _0x5b4997=_0x211817,_0x4778cc=document[_0x5b4997(0x1262)](_0x5b4997(0x17e0));_0x4778cc&&_0x4778cc[_0x5b4997(0x1493)]();}function updateDeleteButtonState(){const _0x358773=_0x211817,_0x422497=document['getElementById']('selected-count'),_0x3c01c4=document[_0x358773(0x1262)](_0x358773(0x17e0));_0x422497&&(_0x422497[_0x358773(0x13be)]=selectedPostIds[_0x358773(0x2d8)]),_0x3c01c4&&(_0x3c01c4[_0x358773(0x14eb)][_0x358773(0x11af)]=selectedPostIds[_0x358773(0x2d8)]>0x0?'1':_0x358773(0x1a21),_0x3c01c4[_0x358773(0x14eb)][_0x358773(0x18a4)]=selectedPostIds['size']>0x0?_0x358773(0x1033):_0x358773(0x102b));}async function confirmDeleteSelectedPosts(){const _0x5d026b=_0x211817;if(selectedPostIds[_0x5d026b(0x2d8)]===0x0){showToast(_0x5d026b(0x22b7),'warning');return;}const _0x184886=document[_0x5d026b(0xb30)](_0x5d026b(0xcaf))[_0x5d026b(0x13be)],_0x2279cd=_0x184886===_0x5d026b(0x1297)?_0x5d026b(0x14b1):_0x5d026b(0x196);if(!confirm(_0x5d026b(0x87b)+_0x2279cd+'吗？共\x20'+selectedPostIds[_0x5d026b(0x2d8)]+_0x5d026b(0x13bd)+(_0x184886===_0x5d026b(0x1297)?'\x0a\x0a注意：删除帖子将同时删除所有回复和相关数据，此操作不可撤销！':'')))return;try{_0x184886===_0x5d026b(0x1297)?await deleteSelectedPosts():await unfavoriteSelectedPosts(),showToast('成功'+_0x2279cd,_0x5d026b(0x11cb)),toggleMultiSelectMode();}catch(_0x4b5d4e){console[_0x5d026b(0x174a)](_0x5d026b(0x1114),_0x4b5d4e),showToast(_0x5d026b(0x12bd),'error');}}async function deleteSelectedPosts(){const _0x54ce0b=_0x211817,_0x51a9c7=Array[_0x54ce0b(0x13c0)](selectedPostIds);await Promise[_0x54ce0b(0x1a47)]([db[_0x54ce0b(0x14c4)]['where']('id')[_0x54ce0b(0x1fa1)](_0x51a9c7)[_0x54ce0b(0x1f4a)](),db[_0x54ce0b(0x789)][_0x54ce0b(0xa24)]('postId')[_0x54ce0b(0x1fa1)](_0x51a9c7)[_0x54ce0b(0x1f4a)](),db[_0x54ce0b(0x145c)][_0x54ce0b(0xa24)](_0x54ce0b(0x9fc))[_0x54ce0b(0x1fa1)](_0x51a9c7)[_0x54ce0b(0x1f4a)](),db[_0x54ce0b(0x1867)]['where'](_0x54ce0b(0x9fc))[_0x54ce0b(0x1fa1)](_0x51a9c7)[_0x54ce0b(0x1f4a)](),db[_0x54ce0b(0xa46)][_0x54ce0b(0xa24)](_0x54ce0b(0x9fc))['anyOf'](_0x51a9c7)[_0x54ce0b(0x1f4a)]()]);}async function unfavoriteSelectedPosts(){const _0x3877b2=_0x211817,_0x2eb97c=Array['from'](selectedPostIds);await db[_0x3877b2(0x145c)][_0x3877b2(0xa24)]('postId')[_0x3877b2(0x1fa1)](_0x2eb97c)[_0x3877b2(0x82f)](_0xa220b3=>_0xa220b3['userId']===_0x3877b2(0xa80))['delete']();}function toggleSelectAll(){const _0x2211dc=_0x211817,_0x27d75e=document[_0x2211dc(0x1897)](_0x2211dc(0x19df)),_0x395ed0=Array[_0x2211dc(0x13c0)](_0x27d75e)[_0x2211dc(0x6a4)](_0x24683b=>parseInt(_0x24683b['dataset'][_0x2211dc(0x9fc)])),_0x453dc5=_0x395ed0['every'](_0x32df55=>selectedPostIds[_0x2211dc(0x975)](_0x32df55));_0x453dc5?(selectedPostIds[_0x2211dc(0xa4f)](),_0x27d75e[_0x2211dc(0x19fb)](_0xab70b9=>{const _0x40c796=_0x2211dc;_0xab70b9[_0x40c796(0x1c1b)][_0x40c796(0x1493)](_0x40c796(0x176b));const _0x40fff3=_0xab70b9['querySelector'](_0x40c796(0x4f5));_0x40fff3[_0x40c796(0x1722)]='fas\x20fa-square';})):(_0x395ed0['forEach'](_0x31fdf0=>selectedPostIds[_0x2211dc(0x21e2)](_0x31fdf0)),_0x27d75e[_0x2211dc(0x19fb)](_0x36e9cc=>{const _0x51b489=_0x2211dc;_0x36e9cc[_0x51b489(0x1c1b)]['add']('selected');const _0x49d5af=_0x36e9cc[_0x51b489(0xb30)](_0x51b489(0x4f5));_0x49d5af['className']=_0x51b489(0xdb5);})),updateDeleteButtonState();}function startEmojiSelection(){const _0x106e83=_0x211817;document[_0x106e83(0x1262)](_0x106e83(0x2250))[_0x106e83(0x14eb)][_0x106e83(0x4da)]=_0x106e83(0x102b),document['getElementById'](_0x106e83(0xe10))['style'][_0x106e83(0x4da)]=_0x106e83(0x1fb7);const _0x54afa8=document[_0x106e83(0x1897)](_0x106e83(0x48a));_0x54afa8[_0x106e83(0x19fb)](_0x179628=>_0x179628[_0x106e83(0x14eb)][_0x106e83(0x4da)]='block');}function selectAllEmojis(){const _0x55a784=_0x211817,_0x196a7c=document[_0x55a784(0x1897)](_0x55a784(0x48a));_0x196a7c['forEach'](_0x1848f2=>_0x1848f2[_0x55a784(0x14c1)]=!![]);}function deleteSelectedEmojis(){const _0x3d4f2d=_0x211817,_0x5477aa=document['querySelectorAll'](_0x3d4f2d(0xdac));if(_0x5477aa[_0x3d4f2d(0x19ee)]===0x0){alert(_0x3d4f2d(0x1b0d));return;}if(!confirm(_0x3d4f2d(0xda3)+_0x5477aa[_0x3d4f2d(0x19ee)]+'\x20个表情包吗？'))return;_0x5477aa[_0x3d4f2d(0x19fb)](_0x4680e1=>{removeEmojiFromLibrary(_0x4680e1['dataset']['emojiId']);}),cancelSelection();}function cancelSelection(){const _0x387111=_0x211817;document[_0x387111(0x1262)](_0x387111(0x2250))[_0x387111(0x14eb)][_0x387111(0x4da)]=_0x387111(0x13de),document[_0x387111(0x1262)](_0x387111(0xe10))['style'][_0x387111(0x4da)]=_0x387111(0x102b);const _0x230dba=document['querySelectorAll'](_0x387111(0x48a));_0x230dba['forEach'](_0x528512=>{const _0x3668c2=_0x387111;_0x528512[_0x3668c2(0x14eb)][_0x3668c2(0x4da)]='none',_0x528512['checked']=![];});}'serviceWorker'in navigator&&window[_0x211817(0x21e9)]('load',()=>{const _0x53eeb1=_0x211817;navigator[_0x53eeb1(0xddb)][_0x53eeb1(0x2091)](_0x53eeb1(0x21d7))[_0x53eeb1(0x63d)](_0x13ab2b=>{const _0x12aa24=_0x53eeb1;console[_0x12aa24(0x2187)](_0x12aa24(0xdf6),_0x13ab2b['scope']);})[_0x53eeb1(0x1c82)](_0x3dddf0=>{const _0x557dc4=_0x53eeb1;console[_0x557dc4(0x2187)](_0x557dc4(0x8e9),_0x3dddf0);});});